(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"10VE":function(e,t,i){"use strict";i.d(t,"a",function(){return d}),i.d(t,"b",function(){return g});var n=i("8Y7J"),s=i("s7LF"),r=i("k5hD"),a=i("gnsf"),o=i("SVse"),l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const h=["blur","change","cleared","close","created","destroyed","focus","navigated","open","renderDayCell","valueChange"],c=["value"];let d=(()=>{let e=p=class extends a.b{constructor(e,t,i,n){super(),this.ngEle=e,this.srenderer=t,this.viewContainerRef=i,this.injector=n,this.skipFromEvent=!0,this.element=this.ngEle.nativeElement,this.injectedModules=this.injectedModules||[];try{let e=this.injector.get("CalendarsIslamic");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(s){}try{let e=this.injector.get("CalendarsMaskedDateTime");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(a){}this.registerEvents(h),this.addTwoWay.call(this,c),Object(r.g)("currentInstance",this,this.viewContainerRef),this.formContext=new r.e,this.formCompContext=new r.c}registerOnChange(e){}registerOnTouched(e){}writeValue(e){}setDisabledState(e){}ngOnInit(){this.formCompContext.ngOnInit(this)}ngAfterViewInit(){this.formContext.ngAfterViewInit(this)}ngOnDestroy(){this.formCompContext.ngOnDestroy(this)}ngAfterContentChecked(){this.formCompContext.ngAfterContentChecked(this)}};return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-datepicker"]],inputs:{allowEdit:"allowEdit",calendarMode:"calendarMode",cssClass:"cssClass",dayHeaderFormat:"dayHeaderFormat",depth:"depth",enableMask:"enableMask",enablePersistence:"enablePersistence",enableRtl:"enableRtl",enabled:"enabled",firstDayOfWeek:"firstDayOfWeek",floatLabelType:"floatLabelType",format:"format",htmlAttributes:"htmlAttributes",isMultiSelection:"isMultiSelection",keyConfigs:"keyConfigs",locale:"locale",maskPlaceholder:"maskPlaceholder",max:"max",min:"min",openOnFocus:"openOnFocus",placeholder:"placeholder",readonly:"readonly",serverTimezoneOffset:"serverTimezoneOffset",showClearButton:"showClearButton",showTodayButton:"showTodayButton",start:"start",strictMode:"strictMode",value:"value",values:"values",weekNumber:"weekNumber",weekRule:"weekRule",width:"width",zIndex:"zIndex"},outputs:{blur:"blur",change:"change",cleared:"cleared",close:"close",created:"created",destroyed:"destroyed",focus:"focus",navigated:"navigated",open:"open",renderDayCell:"renderDayCell",valueChange:"valueChange"},features:[n.Bb([{provide:s.d,useExisting:Object(n.U)(()=>p),multi:!0}]),n.zb],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),e=p=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a}([Object(r.d)([r.c,r.e]),l("design:paramtypes",[n.l,n.E,n.P,n.s])],e),e})();var p;let g=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[o.c]]}),e})()},"7YrF":function(e,t,i){"use strict";i.d(t,"a",function(){return oo}),i.d(t,"b",function(){return lo}),i.d(t,"g",function(){return po}),i.d(t,"h",function(){return go}),i.d(t,"c",function(){return fo}),i.d(t,"d",function(){return bo}),i.d(t,"e",function(){return vo}),i.d(t,"f",function(){return So}),i.d(t,"i",function(){return Eo}),i.d(t,"j",function(){return Lo}),i.d(t,"l",function(){return Ho}),i.d(t,"k",function(){return rl});var n=i("8Y7J"),s=i("k5hD"),r=i("4SUy"),a=i("H552"),o=i("5YkT"),l=i("ngVE"),h=i("TF3C"),c=i("OyPL"),d=i("72GX"),p=i("n6zm"),g=i("Naoh"),u=i("/ui1");class m{constructor(e){this.svgLink="http://www.w3.org/2000/svg",this.rootId=e}getOptionValue(e,t){return e[t]}createSvg(e){return Object(r.Z)(e.id)&&(e.id=this.rootId+"_svg"),this.svgObj=document.getElementById(e.id),Object(r.Z)(document.getElementById(e.id))&&(this.svgObj=document.createElementNS(this.svgLink,"svg")),this.svgObj=this.setElementAttributes(e,this.svgObj),this.setSVGSize(e.width,e.height),this.svgObj}setSVGSize(e,t){const i=document.getElementById(this.rootId),n=Object(r.Z)(i)?null:i.getBoundingClientRect();Object(r.Z)(this.width)||this.width<=0?this.svgObj.setAttribute("width",e?e.toString():n.width.toString()):this.svgObj.setAttribute("width",this.width.toString()),Object(r.Z)(this.height)||this.height<=0?this.svgObj.setAttribute("height",t?t.toString():"450"):this.svgObj.setAttribute("height",this.height.toString())}drawPath(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"path")),t=this.setElementAttributes(e,t),t}drawLine(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"line")),t=this.setElementAttributes(e,t),t}drawRectangle(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"rect")),t=this.setElementAttributes(e,t),t}drawCircle(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"circle")),t=this.setElementAttributes(e,t),t}drawPolyline(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"polyline")),t=this.setElementAttributes(e,t),t}drawEllipse(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"ellipse")),t=this.setElementAttributes(e,t),t}drawPolygon(e){let t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"polygon")),t=this.setElementAttributes(e,t),t}drawImage(e){const t=document.createElementNS(this.svgLink,"image");return t.setAttributeNS(null,"height",e.height.toString()),t.setAttributeNS(null,"width",e.width.toString()),t.setAttributeNS("http://www.w3.org/1999/xlink","href",e.href),t.setAttributeNS(null,"x",e.x.toString()),t.setAttributeNS(null,"y",e.y.toString()),t.setAttributeNS(null,"id",e.id),t.setAttributeNS(null,"visibility",e.visibility),Object(r.Z)(this.getOptionValue(e,"clip-path"))||t.setAttributeNS(null,"clip-path",this.getOptionValue(e,"clip-path")),Object(r.Z)(e.preserveAspectRatio)||t.setAttributeNS(null,"preserveAspectRatio",e.preserveAspectRatio),t}createText(e,t){let i=document.createElementNS(this.svgLink,"text");return i=this.setElementAttributes(e,i),Object(r.Z)(t)||(i.textContent=t),i}createTSpan(e,t){let i=document.createElementNS(this.svgLink,"tspan");return i=this.setElementAttributes(e,i),Object(r.Z)(t)||(i.textContent=t),i}createTitle(e){const t=document.createElementNS(this.svgLink,"title");return t.textContent=e,t}createDefs(){return document.createElementNS(this.svgLink,"defs")}createClipPath(e){let t=document.createElementNS(this.svgLink,"clipPath");return t=this.setElementAttributes(e,t),t}createForeignObject(e){let t=document.createElementNS(this.svgLink,"foreignObject");return t=this.setElementAttributes(e,t),t}createGroup(e){let t=document.createElementNS(this.svgLink,"g");return t=this.setElementAttributes(e,t),t}createPattern(e,t){let i=document.createElementNS(this.svgLink,t);return i=this.setElementAttributes(e,i),i}createRadialGradient(e,t,i){let n;return Object(r.Z)(e[0].colorStop)?n=e[0].color.toString():(this.drawGradient("radialGradient",{id:this.rootId+"_"+t+"radialGradient",cx:i.cx+"%",cy:i.cy+"%",r:i.r+"%",fx:i.fx+"%",fy:i.fy+"%"},e),n="url(#"+this.rootId+"_"+t+"radialGradient)"),n}createLinearGradient(e,t,i){let n;return Object(r.Z)(e[0].colorStop)?n=e[0].color.toString():(this.drawGradient("linearGradient",{id:this.rootId+"_"+t+"linearGradient",x1:i.x1+"%",y1:i.y1+"%",x2:i.x2+"%",y2:i.y2+"%"},e),n="url(#"+this.rootId+"_"+t+"linearGradient)"),n}drawGradient(e,t,i){const n=this.createDefs();let s=document.createElementNS(this.svgLink,e);s=this.setElementAttributes(t,s);for(let a=0;a<i.length;a++){const e=document.createElementNS(this.svgLink,"stop");e.setAttribute("offset",i[a].colorStop),e.setAttribute("stop-color",i[a].color),e.setAttribute("stop-opacity",i[a].opacity?i[a].opacity:"1"),Object(r.Z)(i[a].style)||e.setAttribute("style",i[a].style),s.appendChild(e)}return n.appendChild(s),n}drawClipPath(e){const t=this.createDefs(),i=this.createClipPath({id:e.id});e.id=e.id+"_Rect";const n=this.drawRectangle(e);return i.appendChild(n),t.appendChild(i),t}drawCircularClipPath(e){const t=this.createDefs(),i=this.createClipPath({id:e.id});e.id=e.id+"_Circle";const n=this.drawCircle(e);return i.appendChild(n),t.appendChild(i),t}setElementAttributes(e,t){const i=Object.keys(e);for(let n=0;n<i.length;n++)t.setAttribute(i[n],e[i[n]]);return t}createCanvas(){return null}}class f{constructor(e){this.rootId=e}getOptionValue(e,t){return e[t]}createCanvas(e){const t=document.createElement("canvas");return t.setAttribute("id",this.rootId+"_canvas"),this.ctx=t.getContext("2d"),this.canvasObj=t,this.setCanvasSize(e.width,e.height),this.canvasObj}setCanvasSize(e,t){const i=document.getElementById(this.rootId),n=Object(r.Z)(i)?null:i.getBoundingClientRect();Object(r.Z)(this.width)?this.canvasObj.setAttribute("width",e?e.toString():n.width.toString()):this.canvasObj.setAttribute("width",this.width.toString()),Object(r.Z)(this.height)?this.canvasObj.setAttribute("height",t?t.toString():"450"):this.canvasObj.setAttribute("height",this.height.toString())}setAttributes(e){this.ctx.lineWidth=this.getOptionValue(e,"stroke-width");const t=this.getOptionValue(e,"stroke-dasharray");if(!Object(r.Z)(t)){const e=t.split(",");this.ctx.setLineDash([parseInt(e[0],10),parseInt(e[1],10)])}this.ctx.strokeStyle=this.getOptionValue(e,"stroke")}drawLine(e){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.stroke(),this.ctx.restore()}drawRectangle(e,t){const i=this.ctx,n=e.rx;return this.ctx.save(),this.ctx.beginPath(),t&&this.ctx.translate(t[0],t[1]),this.ctx.globalAlpha=this.getOptionValue(e,"opacity"),this.setAttributes(e),this.ctx.rect(e.x,e.y,e.width,e.height),null!==n&&n>=0?this.drawCornerRadius(e):("none"===e.fill&&(e.fill="transparent"),this.ctx.fillStyle=e.fill,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.stroke()),this.ctx.restore(),this.ctx=i,this.canvasObj}drawCornerRadius(e){let t=e.rx;const i=e.x,n=e.y,s=e.width,r=e.height;"none"===e.fill&&(e.fill="transparent"),this.ctx.fillStyle=e.fill,s<2*t&&(t=s/2),r<2*t&&(t=r/2),this.ctx.beginPath(),this.ctx.moveTo(i+s-t,n),this.ctx.arcTo(i+s,n,i+s,n+r,t),this.ctx.arcTo(i+s,n+r,i,n+r,t),this.ctx.arcTo(i,n+r,i,n,t),this.ctx.arcTo(i,n,i+s,n,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}drawPath(e,t){const i=e.d.split(" "),n=this.getOptionValue(e,"stroke-width"),s=this.ctx;let r=!0;this.ctx.save(),this.ctx.beginPath(),t&&this.ctx.translate(t[0],t[1]),this.ctx.globalAlpha=e.opacity?e.opacity:this.getOptionValue(e,"fill-opacity"),this.setAttributes(e);for(let a=0;a<i.length;a+=3){const t=parseFloat(i[a+1]),n=parseFloat(i[a+2]);switch(i[a]){case"M":e.innerR||e.cx||this.ctx.moveTo(t,n);break;case"L":e.innerR||this.ctx.lineTo(t,n);break;case"Q":const s=parseFloat(i[a+3]),o=parseFloat(i[a+4]);this.ctx.quadraticCurveTo(t,n,s,o),a+=2;break;case"C":const l=parseFloat(i[a+3]),h=parseFloat(i[a+4]),c=parseFloat(i[a+5]),d=parseFloat(i[a+6]);this.ctx.bezierCurveTo(t,n,l,h,c,d),a+=4;break;case"A":e.innerR?r&&(this.ctx.arc(e.x,e.y,e.radius,e.start,e.end,e.counterClockWise),this.ctx.arc(e.x,e.y,e.innerR,e.end,e.start,!e.counterClockWise),r=!1):e.cx?this.ctx.arc(e.cx,e.cy,e.radius,0,2*Math.PI,e.counterClockWise):(this.ctx.moveTo(e.x,e.y),this.ctx.arc(e.x,e.y,e.radius,e.start,e.end,e.counterClockWise),this.ctx.lineTo(e.x,e.y)),a+=5;break;case"z":case"Z":this.ctx.closePath(),a-=2}}return"none"!==e.fill&&void 0!==e.fill&&(this.ctx.fillStyle=e.fill,this.ctx.fill()),n>0&&this.ctx.stroke(),this.ctx.restore(),this.ctx=s,this.canvasObj}createText(e,t,i,n,s,a){let o=this.getOptionValue(e,"font-weight");Object(r.Z)(o)||"regular"!==o.toLowerCase()||(o="normal");const l=this.getOptionValue(e,"font-size"),h=this.getOptionValue(e,"font-family"),c=this.getOptionValue(e,"font-style").toLowerCase()+" "+o+" "+l+" "+h;let d=this.getOptionValue(e,"text-anchor");const p=void 0!==e.opacity?e.opacity:1;return"middle"===d&&(d="center"),this.ctx.save(),this.ctx.fillStyle=e.fill,this.ctx.font=c,this.ctx.textAlign=d,this.ctx.globalAlpha=p,e.baseline&&(this.ctx.textBaseline=e.baseline),a||(this.ctx.translate(e.x+0+(i||0),e.y+(n||0)),this.ctx.rotate(e.labelRotation*Math.PI/180)),this.ctx.fillText(t,a?e.x:0,a?s:0),this.ctx.restore(),this.canvasObj}drawCircle(e,t){const i=this.ctx;return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.cx,e.cy,e.r,0,2*Math.PI),this.ctx.fillStyle=e.fill,this.ctx.globalAlpha=e.opacity,this.ctx.fill(),t&&this.ctx.translate(t[0],t[1]),this.setAttributes(e),this.ctx.stroke(),this.ctx.restore(),this.ctx=i,this.canvasObj}drawPolyline(e){this.ctx.save(),this.ctx.beginPath();const t=e.points.split(" ");for(let i=0;i<t.length-1;i++){const e=t[i].split(","),n=parseFloat(e[0]),s=parseFloat(e[1]);0===i?this.ctx.moveTo(n,s):this.ctx.lineTo(n,s)}this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.stroke(),this.ctx.restore()}drawEllipse(e,t){const i=this.ctx,n=Math.max(e.rx,e.ry),s=e.rx/n,r=e.ry/n;this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(e.cx,e.cy),t&&this.ctx.translate(t[0],t[1]),this.ctx.save(),this.ctx.scale(s,r),this.ctx.arc(0,0,n,0,2*Math.PI,!1),this.ctx.fillStyle=e.fill,this.ctx.fill(),this.ctx.restore(),this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.stroke(),this.ctx.restore(),this.ctx=i}drawImage(e){this.ctx.save();const t=new Image;Object(r.Z)(e.href)||(t.src=e.href,this.ctx.drawImage(t,e.x,e.y,e.width,e.height)),this.ctx.restore()}createLinearGradient(e){let t;return Object(r.Z)(e[0].colorStop)||(t=this.ctx.createLinearGradient(0,0,0,this.canvasObj.height)),this.setGradientValues(e,t)}createRadialGradient(e){let t;return Object(r.Z)(e[0].colorStop)||(t=this.ctx.createRadialGradient(0,0,0,0,0,this.canvasObj.height)),this.setGradientValues(e,t)}setGradientValues(e,t){let i;if(Object(r.Z)(e[0].colorStop))i=e[0].color.toString();else{for(let i=0;i<=e.length-1;i++){const n=e[i].color,s=e[i].colorStop.slice(0,-1),r=parseInt(s,10)/100;t.addColorStop(r,n)}i=t.toString()}return i}setElementAttributes(e,t){const i=Object.keys(e),n=Object.keys(e).map(t=>e[t]);for(let s=0;s<i.length;s++)t.setAttribute(i[s],n[s]);return null}updateCanvasAttributes(e){this.setElementAttributes(e,this.canvasObj);const t=this.ctx;if(!Object(r.Z)(this.dataUrl)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0)},e.src=this.dataUrl}}clearRect(e){this.ctx.restore(),this.ctx.clearRect(e.x,e.y,e.width,e.height)}createGroup(){return null}drawClipPath(){return null}canvasClip(e){this.ctx.save(),this.ctx.fillStyle="transparent",this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.fill(),this.ctx.clip()}canvasRestore(){this.ctx.restore()}drawPolygon(){return null}createDefs(){return null}createClipPath(){return null}createSvg(){return null}}function b(e,t){const i=e||"";let n=document.getElementById("chartmeasuretext");if(null===n&&(n=Object(r.G)("text",{id:"chartmeasuretext"}),document.body.appendChild(n)),"string"==typeof e&&(e.indexOf("<")>-1||e.indexOf(">")>-1)){const t=e.split(" ");for(let e=0;e<t.length;e++)-1===t[e].indexOf("<br/>")&&(t[e]=t[e].replace(/[<>]/g,"&"));e=t.join(" ")}return n.innerHTML=i.indexOf("<br>")>-1||i.indexOf("<br/>")>-1?i:e,n.style.position="fixed",n.style.fontSize=t.size,n.style.fontWeight=t.fontWeight,n.style.fontStyle=t.fontStyle,n.style.fontFamily=t.fontFamily,n.style.visibility="hidden",n.style.top="-100",n.style.left="0",n.style.whiteSpace="nowrap",n.style.lineHeight="normal",new x(n.clientWidth,n.clientHeight)}function y(e,t,i,n,s,r,a,o,l,h,c){let d="";const p=i.x,g=i.y,u=i.x+i.width,m=i.y+i.height;return c=c||0,r?(d=d.concat("M "+p+" "+(g+t)+" Q "+p+" "+g+" "+(p+e)+" "+g+"  L "+(u-e)+" "+g+" Q "+u+" "+g+" "+u+" "+(g+t)),d=d.concat(" L "+u+" "+(m-t)+" Q "+u+" "+m+" "+(u-e)+" "+m),0!==s&&(d=d.concat(" L "+(n.x+s/2)+" "+m),d=d.concat(" L "+(l+c)+" "+(m+s-c)),d+=" Q "+l+" "+(m+s)+" "+(l-c)+" "+(m+s-c)),d=d.concat(n.x-s/2>p?" L "+(n.x-s/2)+" "+m+" L "+(p+e)+" "+m+" Q "+p+" "+m+" "+p+" "+(m-t)+" z":0===s?" L "+(p+e)+" "+m+" Q "+p+" "+m+" "+p+" "+(m-t)+" z":" L "+p+" "+(m+t)+" z")):a?(d=d.concat("M "+p+" "+(g+t)+" Q "+p+" "+g+" "+(p+e)+" "+g+" L "+(n.x-s/2)+" "+g),d=d.concat(" L "+(l-c)+" "+(n.y+c)),d+=" Q "+l+" "+n.y+" "+(l+c)+" "+(n.y+c),d=d.concat(" L "+(n.x+s/2)+" "+g+" L "+(u-e)+" "+g+" Q "+u+" "+g+" "+u+" "+(g+t)),d=d.concat(" L "+u+" "+(m-t)+" Q "+u+" "+m+" "+(u-e)+" "+m+" L "+(p+e)+" "+m+" Q "+p+" "+m+" "+p+" "+(m-t)+" z")):o?(d=d.concat("M "+p+" "+(g+t)+" Q "+p+" "+g+" "+(p+e)+" "+g),d=d.concat(" L "+(u-e)+" "+g+" Q "+u+" "+g+" "+u+" "+(g+t)+" L "+u+" "+(n.y-s/2)),d=d.concat(" L "+(u+s-c)+" "+(h-c)),d+=" Q "+(u+s)+" "+h+" "+(u+s-c)+" "+(h+c),d=d.concat(" L "+u+" "+(n.y+s/2)+" L "+u+" "+(m-t)+" Q "+u+" "+m+" "+(u-e)+" "+m),d=d.concat(" L "+(p+e)+" "+m+" Q "+p+" "+m+" "+p+" "+(m-t)+" z")):(d=d.concat("M "+(p+e)+" "+g+" Q "+p+" "+g+" "+p+" "+(g+t)+" L "+p+" "+(n.y-s/2)),d=d.concat(" L "+(p-s+c)+" "+(h-c)),d+=" Q "+(p-s)+" "+h+" "+(p-s+c)+" "+(h+c),d=d.concat(" L "+p+" "+(n.y+s/2)+" L "+p+" "+(m-t)+" Q "+p+" "+m+" "+(p+e)+" "+m),d=d.concat(" L "+(u-e)+" "+m+" Q "+u+" "+m+" "+u+" "+(m-t)+" L "+u+" "+(g+t)+" Q "+u+" "+g+" "+(u-e)+" "+g+" z")),d}class x{constructor(e,t){this.width=e,this.height=t}}class C{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}}class v{constructor(e,t){this.isRight=t,this.isBottom=e}}class S{constructor(e){this.id=e}}class w extends S{constructor(e,t,i,n,s,r="",a,o){super(e),this.transform="",this.baseLine="auto",this.labelRotation=0,this.x=t,this.y=i,this.anchor=n,this.text=s,this.transform=r,this.baseLine=a,this.labelRotation=o}}function I(e){return document.getElementById(e)}function O(e){const t=I(e);t&&Object(r.kb)(t)}function R(e,t,i,n,s,a){const o=new m(""),l=function(e,t,i,n,s){let a,o="Path";const l=t.width,h=t.height,c=e.x,d=e.y,p=e.x+-l/2,g=e.y+-h/2;switch(i){case"Circle":case"Bubble":o="Ellipse",Object(r.gb)(n,{rx:l/2,ry:h/2,cx:c,cy:d});break;case"Cross":a="M "+p+" "+d+" L "+(c+l/2)+" "+d+" M "+c+" "+(d+h/2)+" L "+c+" "+(d+-h/2),Object(r.gb)(n,{d:a});break;case"HorizontalLine":a="M "+p+" "+d+" L "+(c+l/2)+" "+d,Object(r.gb)(n,{d:a});break;case"VerticalLine":a="M "+c+" "+(d+h/2)+" L "+c+" "+(d+-h/2),Object(r.gb)(n,{d:a});break;case"Diamond":a="M "+p+" "+d+" L "+c+" "+(d+-h/2)+" L "+(c+l/2)+" "+d+" L "+c+" "+(d+h/2)+" L "+p+" "+d+" z",Object(r.gb)(n,{d:a});break;case"Rectangle":a="M "+p+" "+(d+-h/2)+" L "+(c+l/2)+" "+(d+-h/2)+" L "+(c+l/2)+" "+(d+h/2)+" L "+p+" "+(d+h/2)+" L "+p+" "+(d+-h/2)+" z",Object(r.gb)(n,{d:a});break;case"Triangle":a="M "+p+" "+(d+h/2)+" L "+c+" "+(d+-h/2)+" L "+(c+l/2)+" "+(d+h/2)+" L "+p+" "+(d+h/2)+" z",Object(r.gb)(n,{d:a});break;case"InvertedTriangle":a="M "+(c+l/2)+" "+(d-h/2)+" L "+c+" "+(d+h/2)+" L "+(c-l/2)+" "+(d-h/2)+" L "+(c+l/2)+" "+(d-h/2)+" z",Object(r.gb)(n,{d:a});break;case"Pentagon":const e=72;let t,i;for(let n=0;n<=5;n++)t=l/2*Math.cos(Math.PI/180*(n*e)),i=h/2*Math.sin(Math.PI/180*(n*e)),a=0===n?"M "+(c+t)+" "+(d+i)+" ":a.concat("L "+(c+t)+" "+(d+i)+" ");a=a.concat("Z"),Object(r.gb)(n,{d:a});break;case"Image":o="Image",Object(r.gb)(n,{href:s,height:h,width:l,x:p,y:g})}return{renderOption:n,functionName:o}}(e,i,t,s,n),h=o["draw"+l.functionName](l.renderOption);return h.setAttribute("aria-label",a),h}class A extends S{constructor(e,t,i,n,s,r,a){super(e),this.opacity=s,this.fill=t,this.stroke=n,this["stroke-width"]=i,this["stroke-dasharray"]=r,this.d=a}}class k{constructor(e,t){this.x=e,this.y=t}}var E=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let L=(()=>{class e extends r.e{}return E([Object(r.t)(null)],e.prototype,"size",void 0),E([Object(r.t)("")],e.prototype,"color",void 0),E([Object(r.t)("Segoe UI")],e.prototype,"fontFamily",void 0),E([Object(r.t)("Normal")],e.prototype,"fontWeight",void 0),E([Object(r.t)("Normal")],e.prototype,"fontStyle",void 0),E([Object(r.t)(1)],e.prototype,"opacity",void 0),e})(),T=(()=>{class e extends r.e{}return E([Object(r.t)("")],e.prototype,"color",void 0),E([Object(r.t)(1)],e.prototype,"width",void 0),e})(),j=(()=>{class e extends r.e{}return E([Object(r.t)(0)],e.prototype,"x",void 0),E([Object(r.t)(0)],e.prototype,"y",void 0),E([Object(r.t)(0)],e.prototype,"width",void 0),E([Object(r.t)(0)],e.prototype,"height",void 0),e})(),D=(()=>{class e extends r.e{}return E([Object(r.t)(0)],e.prototype,"x",void 0),E([Object(r.t)(0)],e.prototype,"y",void 0),e})(),M=(()=>{let e=class extends r.h{constructor(e,t){super(e,t)}preRender(){this.allowServerDataBinding=!1,this.initPrivateVariable(),this.isCanvas||this.removeSVG(),this.createTooltipElement()}initPrivateVariable(){this.renderer=new m(this.element.id),this.themeStyle=function(e){let t;switch(e){case"Highcontrast":case"HighContrast":t={tooltipFill:"#ffffff",tooltipBoldLabel:"#000000",tooltipLightLabel:"#000000",tooltipHeaderLine:"#969696"};break;case"MaterialDark":case"FabricDark":case"BootstrapDark":t={tooltipFill:"#F4F4F4",tooltipBoldLabel:"#282727",tooltipLightLabel:"#333232",tooltipHeaderLine:"#9A9A9A"};break;case"Bootstrap4":t={tooltipFill:"rgba(0, 0, 0, 0.9)",tooltipBoldLabel:"rgba(255, 255, 255)",tooltipLightLabel:"rgba(255, 255, 255, 0.9)",tooltipHeaderLine:"rgba(255, 255, 255, 0.2)"};break;case"Tailwind":t={tooltipFill:"#111827",tooltipBoldLabel:"#D1D5DB",tooltipLightLabel:"#F9FAFB",tooltipHeaderLine:"#6B7280"};break;case"TailwindDark":t={tooltipFill:"#F9FAFB",tooltipBoldLabel:"#6B7280",tooltipLightLabel:"#1F2937",tooltipHeaderLine:"#9CA3AF"};break;default:t={tooltipFill:"rgba(0, 8, 22, 0.75)",tooltipBoldLabel:"#ffffff",tooltipLightLabel:"#dbdbdb",tooltipHeaderLine:"#ffffff"}}return t}(this.theme),this.formattedText=[],this.padding=5,this.isFirst=!0,this.markerPoint=[]}removeSVG(){const e=document.getElementById(this.element.id+"_svg"),t=document.getElementById(this.element.id+"parent_template");this.blazorTemplate&&Object(r.mb)(this.element.id+"parent_template_blazorTemplate"),e&&e.parentNode&&Object(r.kb)(e),t&&t.parentNode&&Object(r.kb)(t)}render(){if(this.fadeOuted=!1,this.template)this.updateTemplateFn(),this.createTemplate(this.areaBounds,this.location);else{this.renderText(this.isFirst),this.trigger("tooltipRender",{cancel:!1,name:"tooltipRender",tooltip:this});const e=this.renderTooltipElement(this.areaBounds,this.location);this.drawMarker(e.isBottom,e.isRight,this.markerSize)}this.trigger("loaded",{tooltip:this});const e=document.getElementById("chartmeasuretext");e&&Object(r.kb)(e),this.allowServerDataBinding=!0}createTooltipElement(){if(this.textElements=[],!this.template||this.shared){const e=this.renderer.createSvg({id:this.element.id+"_svg"});this.element.appendChild(e);let t=document.getElementById(this.element.id+"_group");t||(t=this.renderer.createGroup({id:this.element.id+"_group"}),t.setAttribute("transform","translate(0,0)")),e.appendChild(t);const i=this.renderer.drawPath({id:this.element.id+"_path","stroke-width":this.border.width,fill:this.fill||this.themeStyle.tooltipFill,opacity:"TailwindDark"!==this.theme&&"Tailwind"!==this.theme||.75!==this.opacity?this.opacity:1,stroke:this.border.color});t.appendChild(i)}}drawMarker(e,t,i){if(this.shapes.length<=0)return null;let n,s=0;const r=this.renderer.createGroup({id:this.element.id+"_trackball_group"}),a=I(this.element.id+"_group"),o=2*this.marginX+i/2+(t?this.arrowPadding:0);for(const l of this.shapes)"None"!==l&&(n=new A(this.element.id+"_Trackball_"+s,this.palette[s],1,"#cccccc",1,null),this.markerPoint[s]&&r.appendChild(R(new k(o,this.markerPoint[s]-this.padding+(e?this.arrowPadding:0)),l,new x(i,i),"",n,null)),s++);a.appendChild(r)}renderTooltipElement(e,t){const i=I(this.element.id),n=new k(0,0),s=new k(0,0),a=I(this.element.id+"_svg"),o=I(this.element.id+"_group"),l=I(this.element.id+"_path");let h,c=!1,d=!1,p=!1,g=0,u=0;if(this.tipRadius=1,""!==this.header&&(this.elementSize.height+=this.marginY),this.content.length>1?(h=this.sharedTooltipLocation(e,this.location.x,this.location.y),c=!0):(h=this.tooltipLocation(e,t,n,s),this.inverted?(d=h.x<t.x+this.clipBounds.x,g=d?0:this.arrowPadding):(c=h.y<t.y+this.clipBounds.y,p=!c,u=c?0:this.arrowPadding)),""!==this.header){const e=b(this.isWrap?this.wrappedText:this.header,this.textStyle).height+2*this.marginY+(p?this.arrowPadding:0)+(this.isWrap?5:0),t=this.renderer.drawPath({id:this.element.id+"_header_path","stroke-width":1,fill:null,opacity:.8,stroke:this.themeStyle.tooltipHeaderLine,d:"M "+(3*this.marginX+(d||c||p?0:this.arrowPadding))+" "+e+"L "+(h.width+(d||c||p?0:this.arrowPadding)-2*this.marginX)+" "+e});o.appendChild(t)}const m=this.border.width/2,f=new C(m+g,m+u,h.width-m,h.height-m);if(o.setAttribute("opacity","1"),!this.enableAnimation||this.shared||this.isFirst?this.updateDiv(i,h.x,h.y):this.animateTooltipDiv(i,h),a.setAttribute("height",(h.height+this.border.width+(this.inverted?0:this.arrowPadding)+5).toString()),a.setAttribute("width",(h.width+this.border.width+(this.inverted?this.arrowPadding:0)+5).toString()),a.setAttribute("opacity","1"),Object(r.Z)(this.tooltipPlacement)||(c=this.tooltipPlacement.indexOf("Top")>-1,p=this.tooltipPlacement.indexOf("Bottom")>-1,d=this.tooltipPlacement.indexOf("Left")>-1),l.setAttribute("d",y(this.rx,this.ry,f,n,this.arrowPadding,c,p,d,s.x,s.y,this.tipRadius)),this.enableShadow&&"Bootstrap4"!==this.theme){const e=this.element.id+"_shadow";"Tailwind"===this.theme||"TailwindDark"===this.theme?l.setAttribute("box-shadow","0px 1px 2px rgba(0, 0, 0, 0.06), 0px 1px 3px rgba(0, 0, 0, 0.1)"):l.setAttribute("filter",r.d.isIE?"":"url(#"+e+")");let t='<filter id="'+e+'" height="130%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/>';t+='<feOffset dx="3" dy="3" result="offsetblur"/><feComponentTransfer><feFuncA type="linear" slope="0.5"/>',t+='</feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';const i=this.renderer.createDefs();i.setAttribute("id",this.element.id+"SVG_tooltip_definition"),o.appendChild(i),i.innerHTML=t}return l.setAttribute("stroke",this.border.color),this.changeText(new k(g,u),p,!d&&!c&&!p),new v(p,!d&&!c&&!p)}changeText(e,t,i){const n=document.getElementById(this.element.id+"_text");t&&n.setAttribute("transform","translate(0,"+this.arrowPadding+")"),i&&n.setAttribute("transform","translate("+this.arrowPadding+" 0)")}findFormattedText(){this.formattedText=[],""!==this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim()&&(this.formattedText=this.formattedText.concat(this.header)),this.formattedText=this.formattedText.concat(this.content)}renderText(e){let t,i=0,n=0,s=0;const a=Object(r.L)({},this.textStyle,null,!0).properties,o=I(this.element.id+"_group");let l,h,c,d,p="";this.findFormattedText();const g="rtl"===document.body.getAttribute("dir")?"end":"start";this.leftSpace=this.areaBounds.x+this.location.x,this.rightSpace=this.areaBounds.x+this.areaBounds.width-this.leftSpace;const u=this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim(),f=this.header.indexOf("<b>")>-1&&this.header.indexOf("</b>")>-1,y=b(this.formattedText[0],a).width+2*this.marginX+this.arrowPadding,C=this.location.x-y<this.location.x,v=this.areaBounds.x+this.areaBounds.width<this.location.x+y;let S,R=""!==u?this.marginY:0,A=!0,k=!0;this.markerPoint=[];const E=this.shapes.length>0?10:0,L=this.shapes.length>0?5:0;let T,j="Normal",D=this.themeStyle.tooltipLightLabel;const M=22/parseFloat("13px")*parseFloat(a.size);e&&!this.isCanvas||(O(this.element.id+"_text"),O(this.element.id+"_header_path"),O(this.element.id+"_trackball_group"),O(this.element.id+"SVG_tooltip_definition"));const F=new w(this.element.id+"_text",2*this.marginX,2*this.marginY+2*this.padding+(2===this.marginY?3:0),g,""),P=function(e,t,i,n){let s={};const r=new m("");s={id:e.id,x:e.x,y:e.y,fill:null,"font-size":t.size,"font-style":t.fontStyle,"font-family":t.fontFamily,"font-weight":t.fontWeight,"text-anchor":e.anchor,transform:e.transform,opacity:t.opacity,"dominant-baseline":e.baseLine};const a=r.createText(s,"string"==typeof e.text?e.text:e.text[0]);return a.style.fontFamily=t.fontFamily,a.style.fontStyle=t.fontStyle,a.style.fontSize=t.size,a.style.fontWeight=t.fontWeight,a.style.color=t.color,n.appendChild(a),a}(F,a,0,o),N=1===this.formattedText.length&&this.formattedText[0].indexOf(" : <b>")>-1,B=""!==this.header,H=B&&f?16:13;for(let r=0,m=this.formattedText.length;r<m;r++)if(h=this.formattedText[r].replace(/<(b|strong)>/g,"<b>").replace(/<\/(b|strong)>/g,"</b>").split(/<br.*?>/g),0===r&&!N&&this.isTextWrap&&(this.leftSpace<y||C)&&(this.rightSpace<y||v)&&(T=Math.round(this.leftSpace>this.rightSpace?this.leftSpace/H:this.rightSpace/H),S=""!==u?u:this.formattedText[r],h=S.match(new RegExp(".{1,"+T+"}","g")),this.wrappedText=f?"<b>"+h.join("<br>")+"</b>":h.join("<br>"),this.isWrap=h.length>1),""!==h[0]){0===r&&""!==u||this.markerPoint.push((""!==u?this.marginY:0)+F.y+i);for(let e=0,o=h.length;e<o;e++){t=h[e].replace(/<b>/g,"<br><b>").replace(/<\/b>/g,"</b><br>").replace(/:/g,"<br>\u200e:<br>").split("<br>"),s=0,k=!0,i+=M;for(let e=0,i=t.length;e<i;e++)c=t[e],/\S/.test(c)||""===c||(c=" "),(!k&&" "===c||""!==c.replace(/<b>/g,"").replace(/<\/b>/g,"").trim())&&(s+=" "!==c?4:0,k&&!A?(d={x:2*this.marginX+(E+L),dy:M+(k?R:0),fill:""},R=null):d=A&&k?{x:""===u?2*this.marginX+(E+L):2*this.marginX+(this.isWrap?E+L:0)}:{},k=!1,l=this.renderer.createTSpan(d,""),P.appendChild(l),c.indexOf("<b>")>-1||f&&0===e&&0===r&&(B||this.isWrap)?(j="bold",D=this.themeStyle.tooltipBoldLabel,p="font-weight:"+j,a.fontWeight=j,l.setAttribute("fill",this.textStyle.color||D)):(p="bold"===j?"font-weight:"+j:"",a.fontWeight=j,l.setAttribute("fill",this.textStyle.color||D)),(c.indexOf("</b>")>-1||f&&e===i-1&&0===r&&(B||this.isWrap))&&(j="Normal",D=this.themeStyle.tooltipLightLabel),l.textContent=c=this.getTooltipTextContent(c),s+=b(c,a).width,""!==p&&(l.style.fontWeight=p.split("font-weight:")[1],l.style.color=l.getAttribute("fill")),l.style.fontFamily="inherit",l.style.fontStyle="inherit",l.style.fontSize="inherit",A=!1);s-=4,n=Math.max(n,s)}}this.elementSize=new x(n+(n>0?2*this.marginX:0),i),this.elementSize.width+=E+L;const _=P.childNodes[0];if(""!==u&&_&&!this.isWrap){a.fontWeight="bold";const e=(this.elementSize.width+2*this.padding)/2-b(u,a).width/2;_.setAttribute("x",e.toString())}}getTooltipTextContent(e){let t=e.match(/<[a-zA-Z\/](.|\n)*?>/g);if(Object(r.Z)(t))return e;const i=/[\u0590-\u07FF\u200F\u202B\u202E\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(e);for(let n=0;n<t.length;n++)this.isValidHTMLElement(t[n].replace("<","").replace("/","").replace(">","").trim())&&(e=e.replace(t[n],i?"\u200e":""));return e}isValidHTMLElement(e){return"[object HTMLUnknownElement]"!=document.createElement(e).toString()}createTemplate(e,t){const i={cancel:!1,name:"tooltipRender",tooltip:this};this.trigger("tooltipRender",i);const n=document.getElementById(this.element.id);this.isCanvas&&this.removeSVG();const s=n.firstElementChild;if(s&&Object(r.kb)(s),i.cancel)Object(r.kb)(I(this.element.id+"_tooltip"));else{const i=Object(r.G)("div",{id:this.element.id+"parent_template"});let s=this.templateFn(this.data,this.controlInstance,i.id,i.id+"_blazorTemplate","");for(;s&&s.length>0;)Object(r.Y)()||1===s.length?(i.appendChild(s[0]),s=null):i.appendChild(s[0]);n.appendChild(i);const a=this.isCanvas?i:this.element,o=a.getBoundingClientRect();this.padding=0,this.elementSize=new x(o.width,o.height);const l=this.shared?this.sharedTooltipLocation(e,this.location.x,this.location.y):this.tooltipLocation(e,t,new k(0,0),new k(0,0));if(!this.enableAnimation||this.shared||this.isFirst?this.updateDiv(a,l.x,l.y):this.animateTooltipDiv(this.element,l),this.blazorTemplate){const i=()=>{const i=I(n.element.id).getBoundingClientRect();n.elementSize=new x(i.width,i.height);const s=n.tooltipLocation(e,t,new k(0,0),new k(0,0));n.updateDiv(I(n.element.id),s.x,s.y)},n=this;i.bind(n,e,t),Object(r.vb)(this.element.id+"parent_template_blazorTemplate",this.blazorTemplate.name,this.blazorTemplate.parent,void 0,i)}}}sharedTooltipLocation(e,t,i){const n=this.elementSize.height+2*this.marginY,s=new C(t+2*this.padding,i-n-this.padding,this.elementSize.width+2*this.marginX,n);return s.y<e.y&&(s.y+=s.height+2*this.padding),s.x+s.width>e.x+e.width&&(s.x-=s.width+4*this.padding),s}getCurrentPosition(e,t,i,n){const s=this.tooltipPlacement,r=this.clipBounds.x,a=this.clipBounds.y,o=this.offset,l=this.elementSize.width+2*this.marginX,h=this.elementSize.height+2*this.marginY;let c=new k(t.x,t.y);return"Top"===s||"Bottom"===s?(c=new k(c.x+r-this.elementSize.width/2-this.padding,c.y+a-this.elementSize.height-2*this.padding-this.arrowPadding-o),i.x=n.x=l/2,"Bottom"===s&&(c.y=t.y+a+o),e.x+e.width<c.x+l?(c.x=e.width>l?e.x+e.width-l+6:e.x,i.x=n.x=e.width>l?e.x+t.x-c.x:t.x):e.x>c.x&&(c.x=e.x,i.x=n.x=t.x)):(c=new k(c.x+r+o,c.y+a-this.elementSize.height/2-this.padding),i.y=n.y=h/2,"Left"===s&&(c.x=t.x+r-o-(l+this.arrowPadding)),e.y+e.height<c.y+h?(c.y=e.height>h?e.y+e.height-h+6:e.y,i.y=n.y=e.height>h?e.y+t.y-c.y:t.y):e.y>c.y&&(c.y=e.y,i.y=n.y=t.y)),new C(c.x,c.y,l,h)}tooltipLocation(e,t,i,n){if(!Object(r.Z)(this.tooltipPlacement))return this.getCurrentPosition(e,t,i,n);let s=new k(t.x,t.y);const a=this.elementSize.width+2*this.marginX,o=this.elementSize.height+2*this.marginY,l=this.offset,h=this.clipBounds.x,c=this.clipBounds.y,d=e.x,p=e.y;return this.inverted?(s=new k(s.x+h+l,s.y+c-this.elementSize.height/2-this.padding),i.y=n.y=o/2,(s.x+a+this.arrowPadding>d+e.width||this.isNegative)&&(s.x=(t.x>e.width?e.width:t.x)+h-l-(a+this.arrowPadding)),s.x<d&&(s.x=(t.x<0?0:t.x)+h+l),s.y<=p&&(i.y-=p-s.y,n.y-=p-s.y,s.y=p),s.y+o>=p+e.height&&(i.y+=s.y+o-(p+e.height),n.y+=s.y+o-(p+e.height),s.y-=s.y+o-(p+e.height)),i.y+this.arrowPadding/2>o-this.ry&&(i.y=o-this.ry-this.arrowPadding/2,n.y=o,this.tipRadius=0),i.y-this.arrowPadding/2<this.ry&&(i.y=this.ry+this.arrowPadding/2,n.y=0,this.tipRadius=0)):(s=new k(s.x+h-this.elementSize.width/2-this.padding,s.y+c-this.elementSize.height-2*this.padding-this.arrowPadding-l),i.x=n.x=a/2,(s.y<p||this.isNegative)&&(s.y=(t.y<0?0:t.y)+c+l),s.y+o+this.arrowPadding>p+e.height&&(s.y=Math.min(t.y,p+e.height)+c-this.elementSize.height-2*this.padding-this.arrowPadding-l),n.x=a/2,s.x<d&&(i.x-=d-s.x,n.x-=d-s.x,s.x=d),s.x+a>d+e.width&&(i.x+=s.x+a-(d+e.width),n.x+=s.x+a-(d+e.width),s.x-=s.x+a-(d+e.width)),i.x+this.arrowPadding/2>a-this.rx&&(i.x=a-this.rx-this.arrowPadding/2,n.x=a,this.tipRadius=0),i.x-this.arrowPadding/2<this.rx&&(i.x=this.rx+this.arrowPadding/2,n.x=0,this.tipRadius=0)),new C(s.x,s.y,a,o)}animateTooltipDiv(e,t){const i=parseFloat(e.style.left),n=parseFloat(e.style.top);let s;new r.b({}).animate(e,{duration:this.duration,progress:r=>{s=r.timeStamp/r.duration,e.style.animation=null,e.style.left=i+s*(t.x-i)+"px",e.style.top=n+s*(t.y-n)+"px"},end:i=>{this.updateDiv(e,t.x,t.y),this.trigger("animationComplete",{tooltip:this})}})}updateDiv(e,t,i){e.style.left=t+"px",e.style.top=i+"px"}updateTemplateFn(){if(this.template)try{document.querySelectorAll(this.template).length&&(this.templateFn=Object(r.F)(document.querySelector(this.template).innerHTML.trim()))}catch(e){this.templateFn=Object(r.F)(this.template)}}fadeOut(){const e=I(this.isCanvas&&!this.template?this.element.id+"_svg":this.element.id);if(e){let t=e.firstChild;if(this.isCanvas&&!this.template&&(t=document.getElementById(this.element.id+"_group")?document.getElementById(this.element.id+"_group"):t),!t)return null;const i=parseFloat(t.getAttribute("opacity"))||1;new r.b({}).animate(t,{duration:200,progress:e=>{this.progressAnimation(t,i,e.timeStamp/e.duration)},end:()=>{this.fadeOuted=!0,this.endAnimation(t)}})}}progressAnimation(e,t,i){e.style.animation="",e.setAttribute("opacity",(t-i).toString())}endAnimation(e){e.setAttribute("opacity","0"),this.template&&(e.style.display="none"),this.trigger("animationComplete",{tooltip:this})}getPersistData(){return this.addOnPersist([])}getModuleName(){return"tooltip"}destroy(){super.destroy(),this.element.classList.remove("e-tooltip")}onPropertyChanged(e,t){this.blazorTemplate&&Object(r.mb)(this.element.id+"parent_template_blazorTemplate"),this.isFirst=!1,this.render()}};return E([Object(r.t)(!1)],e.prototype,"enable",void 0),E([Object(r.t)(!1)],e.prototype,"shared",void 0),E([Object(r.t)(!0)],e.prototype,"enableShadow",void 0),E([Object(r.t)(null)],e.prototype,"fill",void 0),E([Object(r.t)("")],e.prototype,"header",void 0),E([Object(r.t)(.75)],e.prototype,"opacity",void 0),E([Object(r.g)({size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},L)],e.prototype,"textStyle",void 0),E([Object(r.t)(null)],e.prototype,"template",void 0),E([Object(r.t)(!0)],e.prototype,"enableAnimation",void 0),E([Object(r.t)(300)],e.prototype,"duration",void 0),E([Object(r.t)(!1)],e.prototype,"inverted",void 0),E([Object(r.t)(!1)],e.prototype,"isNegative",void 0),E([Object(r.g)({color:"#cccccc",width:.5},T)],e.prototype,"border",void 0),E([Object(r.t)([])],e.prototype,"content",void 0),E([Object(r.t)(10)],e.prototype,"markerSize",void 0),E([Object(r.g)({x:0,y:0},D)],e.prototype,"clipBounds",void 0),E([Object(r.t)([])],e.prototype,"palette",void 0),E([Object(r.t)([])],e.prototype,"shapes",void 0),E([Object(r.g)({x:0,y:0},D)],e.prototype,"location",void 0),E([Object(r.t)(0)],e.prototype,"offset",void 0),E([Object(r.t)(2)],e.prototype,"rx",void 0),E([Object(r.t)(2)],e.prototype,"ry",void 0),E([Object(r.t)(5)],e.prototype,"marginX",void 0),E([Object(r.t)(5)],e.prototype,"marginY",void 0),E([Object(r.t)(12)],e.prototype,"arrowPadding",void 0),E([Object(r.t)(null)],e.prototype,"data",void 0),E([Object(r.t)("Material")],e.prototype,"theme",void 0),E([Object(r.g)({x:0,y:0,width:0,height:0},j)],e.prototype,"areaBounds",void 0),E([Object(r.t)(null)],e.prototype,"availableSize",void 0),E([Object(r.t)()],e.prototype,"blazorTemplate",void 0),E([Object(r.t)(!1)],e.prototype,"isCanvas",void 0),E([Object(r.t)(!1)],e.prototype,"isTextWrap",void 0),E([Object(r.t)(null)],e.prototype,"tooltipPlacement",void 0),E([Object(r.t)(null)],e.prototype,"controlInstance",void 0),E([Object(r.k)()],e.prototype,"tooltipRender",void 0),E([Object(r.k)()],e.prototype,"loaded",void 0),E([Object(r.k)()],e.prototype,"animationComplete",void 0),e=E([r.r],e),e})();var F,P=i("eNK/");function N(e){let t;switch(e){case"Fabric":t=["#4472c4","#ed7d31","#ffc000","#70ad47","#5b9bd5","#c1c1c1","#6f6fe2","#e269ae","#9e480e","#997300"];break;case"Bootstrap4":case"Bootstrap":t=["#a16ee5","#f7ce69","#55a5c2","#7ddf1e","#ff6ea6","#7953ac","#b99b4f","#407c92","#5ea716","#b91c52"];break;case"HighContrastLight":case"Highcontrast":case"HighContrast":t=["#79ECE4","#E98272","#DFE6B6","#C6E773","#BA98FF","#FA83C3","#00C27A","#43ACEF","#D681EF","#D8BC6E"];break;case"MaterialDark":t=["#00bdae","#404041","#357cd2","#e56590","#f8b883","#70ad47","#dd8abd","#7f84e8","#7bb4eb","#ea7a57"];break;case"FabricDark":t=["#4472c4","#ed7d31","#ffc000","#70ad47","#5b9bd5","#c1c1c1","#6f6fe2","#e269ae","#9e480e","#997300"];break;case"BootstrapDark":t=["#a16ee5","#f7ce69","#55a5c2","#7ddf1e","#ff6ea6","#7953ac","#b99b4f","#407c92","#5ea716","#b91c52"];break;case"Tailwind":t=["#5A61F6","#65A30D","#334155","#14B8A6","#8B5CF6","#0369A1","#F97316","#9333EA","#F59E0B","#15803D"];break;case"TailwindDark":t=["#8B5CF6","#22D3EE","#F87171","#4ADE80","#E879F9","#FCD34D","#F97316","#2DD4BF","#F472B6","#10B981"];break;default:t=["#00bdae","#404041","#357cd2","#e56590","#f8b883","#70ad47","#dd8abd","#7f84e8","#7bb4eb","#ea7a57"]}return t}function B(e){let t;const i="MaterialDark"===e?"#303030":"FabricDark"===e?"#201F1F":"1A1A1A";switch(e){case"HighContrastLight":case"Highcontrast":case"HighContrast":t={axisLabel:"#ffffff",axisTitle:"#ffffff",axisLine:"#ffffff",majorGridLine:"#BFBFBF",minorGridLine:"#969696",majorTickLine:"#BFBFBF",minorTickLine:"#969696",chartTitle:"#ffffff",legendLabel:"#ffffff",background:"#000000",areaBorder:"#ffffff",errorBar:"#ffffff",crosshairLine:"#ffffff",crosshairFill:"#ffffff",crosshairLabel:"#000000",tooltipFill:"#ffffff",tooltipBoldLabel:"#000000",tooltipLightLabel:"#000000",tooltipHeaderLine:"#969696",markerShadow:"#BFBFBF",selectionRectFill:"rgba(255, 217, 57, 0.3)",selectionRectStroke:"#ffffff",selectionCircleStroke:"#FFD939"};break;case"MaterialDark":case"FabricDark":case"BootstrapDark":t={axisLabel:"#DADADA",axisTitle:"#ffffff",axisLine:" #6F6C6C",majorGridLine:"#414040",minorGridLine:"#514F4F",majorTickLine:"#414040",minorTickLine:" #4A4848",chartTitle:"#ffffff",legendLabel:"#DADADA",background:i,areaBorder:" #9A9A9A",errorBar:"#ffffff",crosshairLine:"#F4F4F4",crosshairFill:"#F4F4F4",crosshairLabel:"#282727",tooltipFill:"#F4F4F4",tooltipBoldLabel:"#282727",tooltipLightLabel:"#333232",tooltipHeaderLine:"#9A9A9A",markerShadow:null,selectionRectFill:"rgba(56,169,255, 0.1)",selectionRectStroke:"#38A9FF",selectionCircleStroke:"#282727"};break;case"Bootstrap4":t={axisLabel:"#212529",axisTitle:"#212529",axisLine:"#CED4DA",majorGridLine:"#CED4DA",minorGridLine:"#DEE2E6",majorTickLine:"#ADB5BD",minorTickLine:"#CED4DA",chartTitle:"#212529",legendLabel:"#212529",background:"#FFFFFF",areaBorder:"#DEE2E6",errorBar:"#000000",crosshairLine:"#6C757D",crosshairFill:"#495057",crosshairLabel:"#FFFFFF",tooltipFill:"rgba(0, 0, 0, 0.9)",tooltipBoldLabel:"rgba(255,255,255)",tooltipLightLabel:"rgba(255,255,255, 0.9)",tooltipHeaderLine:"rgba(255,255,255, 0.2)",markerShadow:null,selectionRectFill:"rgba(255,255,255, 0.1)",selectionRectStroke:"rgba(0, 123, 255)",selectionCircleStroke:"#495057"};break;case"Tailwind":t={axisLabel:"#6B728",axisTitle:"#374151",axisLine:" #D1D5DB",majorGridLine:"#E5E7EB",minorGridLine:"#E5E7EB",majorTickLine:"#D1D5DB",minorTickLine:" #D1D5DB",chartTitle:"#374151",legendLabel:"#374151",background:"rgba(255,255,255, 0.0)",areaBorder:" #E5E7EB",errorBar:"#374151",crosshairLine:"#1F2937",crosshairFill:"#111827",crosshairLabel:"#F9FAFB",tooltipFill:"#111827",tooltipBoldLabel:"#D1D5DB",tooltipLightLabel:"#F9FAFB",tooltipHeaderLine:"#6B7280",markerShadow:null,selectionRectFill:"rgba(79,70,229, 0.1)",selectionRectStroke:"#4F46E5",selectionCircleStroke:"#6B7280"};break;case"TailwindDark":t={axisLabel:"#9CA3AF",axisTitle:"#9CA3AF",axisLine:" #4B5563",majorGridLine:"#374151",minorGridLine:"#374151",majorTickLine:"#4B5563",minorTickLine:" #4B5563",chartTitle:"#D1D5DB",legendLabel:"#D1D5DB",background:"rgba(255,255,255, 0.0)",areaBorder:" #374151",errorBar:"#374151",crosshairLine:"#9CA3AF",crosshairFill:"#F9FAFB",crosshairLabel:"#1F2937",tooltipFill:"#F9FAFB",tooltipBoldLabel:"#6B7280",tooltipLightLabel:"#1F2937",tooltipHeaderLine:"#9CA3AF",markerShadow:null,selectionRectFill:"rgba(34,211,238, 0.1)",selectionRectStroke:"#22D3EE",selectionCircleStroke:"#282727"};break;default:t={axisLabel:"#686868",axisTitle:"#424242",axisLine:"#b5b5b5",majorGridLine:"#dbdbdb",minorGridLine:"#eaeaea",majorTickLine:"#b5b5b5",minorTickLine:"#d6d6d6",chartTitle:"#424242",legendLabel:"#353535",background:"#FFFFFF",areaBorder:"Gray",errorBar:"#000000",crosshairLine:"#4f4f4f",crosshairFill:"#4f4f4f",crosshairLabel:"#e5e5e5",tooltipFill:"rgba(0, 8, 22, 0.75)",tooltipBoldLabel:"#ffffff",tooltipLightLabel:"#dbdbdb",tooltipHeaderLine:"#ffffff",markerShadow:null,selectionRectFill:"rgba(41, 171, 226, 0.1)",selectionRectStroke:"#29abe2",selectionCircleStroke:"#29abe2"}}return t}i("gnsf"),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.axisTitleFont={size:"14px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartTitleFont={size:"15px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartSubTitleFont={size:"11px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.crosshairLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.tooltipLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendTitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.stripLineLabelFont={size:"12px",fontWeight:"Regular",color:"#353535",fontStyle:"Normal",fontFamily:"Segoe UI"},e.stockEventFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"}}(F||(F={}));var H=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let _=(()=>{class e extends r.e{}return H([Object(r.t)("Line")],e.prototype,"type",void 0),H([Object(r.t)(null)],e.prototype,"color",void 0),H([Object(r.t)(1)],e.prototype,"width",void 0),H([Object(r.t)(null)],e.prototype,"length",void 0),H([Object(r.t)("")],e.prototype,"dashArray",void 0),e})(),z=(()=>{class e extends r.e{}return H([Object(r.t)("Normal")],e.prototype,"fontStyle",void 0),H([Object(r.t)("16px")],e.prototype,"size",void 0),H([Object(r.t)("Normal")],e.prototype,"fontWeight",void 0),H([Object(r.t)("")],e.prototype,"color",void 0),H([Object(r.t)("Center")],e.prototype,"textAlignment",void 0),H([Object(r.t)("Segoe UI")],e.prototype,"fontFamily",void 0),H([Object(r.t)(1)],e.prototype,"opacity",void 0),H([Object(r.t)("Trim")],e.prototype,"textOverflow",void 0),e})(),V=(()=>{class e extends r.e{}return H([Object(r.t)("")],e.prototype,"color",void 0),H([Object(r.t)(1)],e.prototype,"width",void 0),e})(),U=(()=>{class e extends r.e{}return H([Object(r.t)(0)],e.prototype,"x",void 0),H([Object(r.t)(0)],e.prototype,"y",void 0),e})(),q=(()=>{class e extends r.e{}return H([Object(r.g)({},V)],e.prototype,"border",void 0),H([Object(r.t)("transparent")],e.prototype,"background",void 0),H([Object(r.t)(1)],e.prototype,"opacity",void 0),H([Object(r.t)(null)],e.prototype,"backgroundImage",void 0),e})(),W=(()=>{class e extends r.e{}return H([Object(r.t)(10)],e.prototype,"left",void 0),H([Object(r.t)(10)],e.prototype,"right",void 0),H([Object(r.t)(10)],e.prototype,"top",void 0),H([Object(r.t)(10)],e.prototype,"bottom",void 0),e})(),Z=(()=>{class e extends r.e{}return H([Object(r.t)(0)],e.prototype,"left",void 0),H([Object(r.t)(0)],e.prototype,"right",void 0),H([Object(r.t)(0)],e.prototype,"top",void 0),H([Object(r.t)(0)],e.prototype,"bottom",void 0),e})(),G=(()=>{class e extends r.e{}return H([Object(r.t)(!0)],e.prototype,"enable",void 0),H([Object(r.t)(1e3)],e.prototype,"duration",void 0),H([Object(r.t)(0)],e.prototype,"delay",void 0),e})(),Y=(()=>{class e extends r.e{}return H([Object(r.t)(0)],e.prototype,"series",void 0),H([Object(r.t)(0)],e.prototype,"point",void 0),e})(),X=(()=>{class e extends r.e{}return H([Object(r.t)(0)],e.prototype,"topLeft",void 0),H([Object(r.t)(0)],e.prototype,"topRight",void 0),H([Object(r.t)(0)],e.prototype,"bottomLeft",void 0),H([Object(r.t)(0)],e.prototype,"bottomRight",void 0),e})();class ${constructor(e,t){this.series=e,this.point=t}}let K=(()=>{class e extends r.e{}return H([Object(r.t)(null)],e.prototype,"fill",void 0),H([Object(r.g)({color:"transparent",width:0},V)],e.prototype,"border",void 0),H([Object(r.t)("Gap")],e.prototype,"mode",void 0),e})(),J=(()=>{class e extends r.e{}return H([Object(r.t)(!1)],e.prototype,"enable",void 0),H([Object(r.t)(null)],e.prototype,"minY",void 0),H([Object(r.t)(null)],e.prototype,"maxY",void 0),H([Object(r.t)(null)],e.prototype,"fill",void 0),e})(),Q=(()=>{class e extends r.e{}return H([Object(r.t)(!1)],e.prototype,"enable",void 0),H([Object(r.t)(!0)],e.prototype,"enableMarker",void 0),H([Object(r.t)(!1)],e.prototype,"shared",void 0),H([Object(r.t)(null)],e.prototype,"fill",void 0),H([Object(r.t)(null)],e.prototype,"header",void 0),H([Object(r.t)(.75)],e.prototype,"opacity",void 0),H([Object(r.g)(F.tooltipLabelFont,z)],e.prototype,"textStyle",void 0),H([Object(r.t)(null)],e.prototype,"format",void 0),H([Object(r.t)(null)],e.prototype,"template",void 0),H([Object(r.t)(!0)],e.prototype,"enableAnimation",void 0),H([Object(r.t)(300)],e.prototype,"duration",void 0),H([Object(r.t)(1e3)],e.prototype,"fadeOutDuration",void 0),H([Object(r.t)("Move")],e.prototype,"fadeOutMode",void 0),H([Object(r.t)(!1)],e.prototype,"enableTextWrap",void 0),H([Object(r.g)({color:"#cccccc",width:.5},V)],e.prototype,"border",void 0),e})();class ee{get start(){return this.mStart}get end(){return this.mEnd}get delta(){return this.mEnd-this.mStart}get median(){return this.mStart+(this.mEnd-this.mStart)/2}constructor(e,t){e<t?(this.mStart=e,this.mEnd=t):(this.mStart=t,this.mEnd=e)}}class te{constructor(e){this.isColumn=0,this.chart=e}calculateNumericNiceInterval(e,t,i){const n=et(i,e);let s=t/n;if(!Object(r.Z)(e.desiredIntervals))return s;const a=Math.pow(10,Math.floor(Re(s,10)));for(const r of e.intervalDivs){const e=a*r;if(n<t/e)break;s=e}return s}getActualRange(e,t){this.initializeDoubleRange(e),!e.startFromZero&&this.isColumn>0?(e.actualRange.interval=e.interval||this.calculateNumericNiceInterval(e,e.doubleRange.delta,t),e.actualRange.max=e.doubleRange.end+e.actualRange.interval,e.actualRange.min=e.doubleRange.start-e.actualRange.interval<0&&e.doubleRange.start>0?0:e.doubleRange.start-e.actualRange.interval):(e.actualRange.interval=e.interval||this.calculateNumericNiceInterval(e,e.doubleRange.delta,t),e.actualRange.min=e.doubleRange.start,e.actualRange.max=e.doubleRange.end)}initializeDoubleRange(e){null!==e.minimum?this.min=e.minimum:null!==this.min&&this.min!==Number.POSITIVE_INFINITY||(this.min=0),null!==e.maximum?this.max=e.maximum:null!==this.max&&this.max!==Number.NEGATIVE_INFINITY||(this.max=5),this.min===this.max&&(this.max=e.valueType.indexOf("Category")>-1?this.max:this.min+1),e.doubleRange=new ee(this.min,this.max),e.actualRange={}}calculateRangeAndInterval(e,t){this.calculateRange(t),this.getActualRange(t,e),this.applyRangePadding(t,e),this.calculateVisibleLabels(t,this.chart)}calculateRange(e){if(this.min=null,this.max=null,!Je(e))for(const t of e.series)t.visible&&(this.paddingInterval=0,e.maxPointLength=t.points.length,((t.type.indexOf("Column")>-1||t.type.indexOf("Histogram")>-1)&&"Horizontal"===e.orientation||t.type.indexOf("Bar")>-1&&"Vertical"===e.orientation)&&("Double"!==t.xAxis.valueType&&"DateTime"!==t.xAxis.valueType||"Auto"!==t.xAxis.rangePadding||(this.paddingInterval=.5*We(t.xAxis,e.series))),"Horizontal"===e.orientation&&(this.chart.requireInvertedAxis?this.yAxisRange(e,t):this.findMinMax(t.xMin-this.paddingInterval,t.xMax+this.paddingInterval)),"Vertical"===e.orientation&&(this.isColumn+="Column"===t.type||"Bar"===t.type||"Column"===t.drawType?1:0,this.chart.requireInvertedAxis?this.findMinMax(t.xMin-this.paddingInterval,t.xMax+this.paddingInterval):this.yAxisRange(e,t)))}yAxisRange(e,t){t.dragSettings.enable&&this.chart.dragY&&(this.chart.dragY>=e.visibleRange.max&&(t.yMax=this.chart.dragY+e.visibleRange.interval),this.chart.dragY<=e.visibleRange.min&&(t.yMin=this.chart.dragY-e.visibleRange.interval)),this.findMinMax(t.yMin,t.yMax)}findMinMax(e,t){(null===this.min||this.min>e)&&(this.min=e),(null===this.max||this.max<t)&&(this.max=t),this.max===this.min&&this.max<0&&this.min<0&&(this.max=0)}applyRangePadding(e,t){const i=e.actualRange.min,n=e.actualRange.max;if(!Je(e)){const s=e.actualRange.interval,r=e.getRangePadding(this.chart);"Additional"===r||"Round"===r?this.findAdditional(e,i,n,s):"Normal"===r?this.findNormal(e,i,n,s,t):this.updateActualRange(e,i,n,s)}e.actualRange.delta=e.actualRange.max-e.actualRange.min,this.calculateVisibleRange(t,e)}updateActualRange(e,t,i,n){e.actualRange={min:null!=e.minimum?e.minimum:t,max:null!=e.maximum?e.maximum:i,interval:null!=e.interval?e.interval:n,delta:e.actualRange.delta}}findAdditional(e,t,i,n){let s,r;s=Math.floor(t/n)*n,r=Math.ceil(i/n)*n,"Additional"===e.rangePadding&&(s-=n,r+=n),this.updateActualRange(e,s,r,n)}findNormal(e,t,i,n,s){let r,a,o,l=t;t<0?(l=0,a=t+.05*t,r=n+a%n,.365*n>=r&&(a-=n),a%n<0&&(a=a-n-a%n)):(a=t<5/6*i?0:t-.5*(i-t),a%n>0&&(a-=a%n)),o=i>0?i+.05*(i-l):i-.05*(i-l),r=n-o%n,.365*n>=r&&(o+=n),o%n>0&&(o=o+n-o%n),e.doubleRange=new ee(a,o),0===a&&(n=this.calculateNumericNiceInterval(e,e.doubleRange.delta,s),o=Math.ceil(o/n)*n),this.updateActualRange(e,a,o,n)}calculateVisibleRange(e,t){if(t.visibleRange={max:t.actualRange.max,min:t.actualRange.min,delta:t.actualRange.delta,interval:t.actualRange.interval},"Cartesian"===this.chart.chartAreaType){const i=!Object(r.Z)(t.zoomingScrollBar)&&t.zoomingScrollBar.isLazyLoad;(t.zoomFactor<1||t.zoomPosition>0)&&!i&&(t.calculateVisibleRangeOnZooming(this.chart),t.calculateAxisRange(e,this.chart),t.visibleRange.interval=t.enableAutoIntervalOnZooming&&"Category"!==t.valueType?this.calculateNumericNiceInterval(t,t.doubleRange.delta,e):t.visibleRange.interval)}t.triggerRangeRender(this.chart,t.visibleRange.min,t.visibleRange.max,t.visibleRange.interval)}calculateVisibleLabels(e,t){e.visibleLabels=[];let i,n=e.visibleRange.min;("chart"!==t.getModuleName()||"PolarRadar"!==t.chartAreaType)&&(e.zoomFactor<1||e.zoomPosition>0||this.paddingInterval)&&(n=e.visibleRange.min-e.visibleRange.min%e.visibleRange.interval);const s=this.getFormat(e),a=null!==s.match("{value}");let o,l=0,h=0;for(e.labelFormat&&e.labelFormat.indexOf("n")>-1&&(h=parseInt(e.labelFormat.substring(1,e.labelFormat.length),10)),e.format=t.intl.getNumberFormat({format:a?"":s,useGrouping:t.useGroupingSeparator}),e.startLabel=e.format(e.visibleRange.min),e.endLabel=e.format(e.visibleRange.max),e.visibleRange.interval&&(e.visibleRange.interval+"").indexOf(".")>=0&&(l=(e.visibleRange.interval+"").split(".")[1].length);n<=e.visibleRange.max&&o!==n;n+=e.visibleRange.interval)o=n,i=Object(r.L)({},Object(r.X)("properties",e.labelStyle),null,!0),Ee(n,e.visibleRange)&&Ke(t,n,this.formatValue(e,a,s,n),i,e);n&&(n+"").indexOf(".")>=0&&(n+"").split(".")[1].length>10&&(n=(n+"").split(".")[1].length>(h||l)?+n.toFixed(h||l):n,n<=e.visibleRange.max&&Ke(t,n,this.formatValue(e,a,s,n),i,e)),e.getMaxLabelWidth&&e.getMaxLabelWidth(this.chart)}getFormat(e){return e.labelFormat?0===e.labelFormat.indexOf("p")&&-1===e.labelFormat.indexOf("{value}")&&e.isStack100?"{value}%":e.labelFormat:e.isStack100?"{value}%":""}formatValue(e,t,i,n){return t?i.replace("{value}",e.format(n)):e.format(n)}}const ie=/~\d+~/g,ne=/\^\d+\^/g;var se=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let re=(()=>{class e extends r.e{}return se([Object(r.t)("0")],e.prototype,"x",void 0),se([Object(r.t)("0")],e.prototype,"y",void 0),se([Object(r.t)(null)],e.prototype,"content",void 0),se([Object(r.t)("Center")],e.prototype,"horizontalAlignment",void 0),se([Object(r.t)("Pixel")],e.prototype,"coordinateUnits",void 0),se([Object(r.t)("Chart")],e.prototype,"region",void 0),se([Object(r.t)("Middle")],e.prototype,"verticalAlignment",void 0),se([Object(r.t)(null)],e.prototype,"xAxisName",void 0),se([Object(r.t)(null)],e.prototype,"yAxisName",void 0),se([Object(r.t)(null)],e.prototype,"description",void 0),e})(),ae=(()=>{class e extends r.e{}return se([Object(r.t)("")],e.prototype,"color",void 0),se([Object(r.t)(1)],e.prototype,"width",void 0),se([Object(r.t)("Rectangle")],e.prototype,"type",void 0),e})(),oe=(()=>{class e extends r.e{}return se([Object(r.t)(null)],e.prototype,"start",void 0),se([Object(r.t)(null)],e.prototype,"end",void 0),se([Object(r.t)("")],e.prototype,"text",void 0),se([Object(r.t)(null)],e.prototype,"maximumTextWidth",void 0),se([Object(r.t)(null)],e.prototype,"customAttributes",void 0),se([Object(r.t)("")],e.prototype,"type",void 0),e})(),le=(()=>{class e extends r.e{}return se([Object(r.t)(!0)],e.prototype,"visible",void 0),se([Object(r.t)(!1)],e.prototype,"startFromAxis",void 0),se([Object(r.t)(null)],e.prototype,"start",void 0),se([Object(r.t)(null)],e.prototype,"end",void 0),se([Object(r.t)(null)],e.prototype,"size",void 0),se([Object(r.t)("#808080")],e.prototype,"color",void 0),se([Object(r.t)(null)],e.prototype,"dashArray",void 0),se([Object(r.t)("Auto")],e.prototype,"sizeType",void 0),se([Object(r.t)(!1)],e.prototype,"isRepeat",void 0),se([Object(r.t)(null)],e.prototype,"repeatEvery",void 0),se([Object(r.t)(null)],e.prototype,"repeatUntil",void 0),se([Object(r.t)(!1)],e.prototype,"isSegmented",void 0),se([Object(r.t)(null)],e.prototype,"segmentStart",void 0),se([Object(r.t)(null)],e.prototype,"segmentEnd",void 0),se([Object(r.t)(null)],e.prototype,"segmentAxisName",void 0),se([Object(r.g)({color:"transparent",width:1},V)],e.prototype,"border",void 0),se([Object(r.t)("")],e.prototype,"text",void 0),se([Object(r.t)(null)],e.prototype,"rotation",void 0),se([Object(r.t)("Middle")],e.prototype,"horizontalAlignment",void 0),se([Object(r.t)("Middle")],e.prototype,"verticalAlignment",void 0),se([Object(r.g)(F.stripLineLabelFont,z)],e.prototype,"textStyle",void 0),se([Object(r.t)("Behind")],e.prototype,"zIndex",void 0),se([Object(r.t)(1)],e.prototype,"opacity",void 0),e})(),he=(()=>{class e extends r.e{}return se([Object(r.t)("Center")],e.prototype,"alignment",void 0),se([Object(r.t)("Wrap")],e.prototype,"overflow",void 0),se([Object(r.g)(F.axisLabelFont,z)],e.prototype,"textStyle",void 0),se([Object(r.g)({color:null,width:1,type:"Rectangle"},ae)],e.prototype,"border",void 0),se([Object(r.f)([],oe)],e.prototype,"categories",void 0),e})(),ce=(()=>{class e extends r.e{}return se([Object(r.t)(null)],e.prototype,"minimum",void 0),se([Object(r.t)(null)],e.prototype,"maximum",void 0),e})(),de=(()=>{class e extends r.e{}return se([Object(r.t)(!1)],e.prototype,"enable",void 0),se([Object(r.t)(null)],e.prototype,"pointsLength",void 0),se([Object(r.g)({},ce)],e.prototype,"range",void 0),e})();var pe=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ge=(()=>{class e extends r.e{constructor(){super(...arguments),this.axes=[],this.nearSizes=[],this.farSizes=[]}computeSize(e,t){let i=0;e.visible&&e.internalVisibility&&(i+=e.findTickSize(e.crossInAxis)+t+e.findLabelSize(e.crossInAxis,5)+.5*e.lineStyle.width),e.opposedPosition?this.farSizes.push(i):this.nearSizes.push(i)}}return pe([Object(r.t)("100%")],e.prototype,"height",void 0),pe([Object(r.g)({},V)],e.prototype,"border",void 0),e})(),ue=(()=>{class e extends r.e{constructor(){super(...arguments),this.axes=[],this.nearSizes=[],this.farSizes=[],this.padding=0}computeSize(e,t){let i=0;e.visible&&e.internalVisibility&&(i+=e.findTickSize(e.crossInAxis)+t+e.findLabelSize(e.crossInAxis,5)+.5*e.lineStyle.width),e.opposedPosition?this.farSizes.push(i):this.nearSizes.push(i)}}return pe([Object(r.t)("100%")],e.prototype,"width",void 0),pe([Object(r.g)({},V)],e.prototype,"border",void 0),e})(),me=(()=>{class e extends r.e{}return pe([Object(r.t)(1)],e.prototype,"width",void 0),pe([Object(r.t)("")],e.prototype,"dashArray",void 0),pe([Object(r.t)(null)],e.prototype,"color",void 0),e})(),fe=(()=>{class e extends r.e{}return pe([Object(r.t)(.7)],e.prototype,"width",void 0),pe([Object(r.t)("")],e.prototype,"dashArray",void 0),pe([Object(r.t)(null)],e.prototype,"color",void 0),e})(),be=(()=>{class e extends r.e{}return pe([Object(r.t)(1)],e.prototype,"width",void 0),pe([Object(r.t)("")],e.prototype,"dashArray",void 0),pe([Object(r.t)(null)],e.prototype,"color",void 0),e})(),ye=(()=>{class e extends r.e{}return pe([Object(r.t)(1)],e.prototype,"width",void 0),pe([Object(r.t)(5)],e.prototype,"height",void 0),pe([Object(r.t)(null)],e.prototype,"color",void 0),e})(),xe=(()=>{class e extends r.e{}return pe([Object(r.t)(.7)],e.prototype,"width",void 0),pe([Object(r.t)(5)],e.prototype,"height",void 0),pe([Object(r.t)(null)],e.prototype,"color",void 0),e})(),Ce=(()=>{class e extends r.e{}return pe([Object(r.t)(!1)],e.prototype,"enable",void 0),pe([Object(r.t)(null)],e.prototype,"fill",void 0),pe([Object(r.g)(F.crosshairLabelFont,z)],e.prototype,"textStyle",void 0),e})(),ve=(()=>{class e extends r.e{constructor(e,t,i,n){super(e,t,i,n),this.visibleLabels=[],this.series=[],this.rect=new C(void 0,void 0,0,0),this.axisBottomLine=null,this.intervalDivs=[10,5,2,1],this.isStack100=!1,this.crossAt=null,this.updatedRect=null,this.multiLevelLabelHeight=0,this.isChart=!0,this.isIntervalInDecimal=!0,this.titleCollection=[],this.titleSize=new x(0,0),this.internalVisibility=!0,this.angle=this.labelRotation}findTickSize(e){return"Inside"===this.tickPosition?0:!e||e.visibleRange&&!this.isInside(e.visibleRange)?this.majorTickLines.height:0}isInside(e){return ke(this.crossAt,e)||!this.opposedPosition&&this.crossAt>=e.max||this.opposedPosition&&this.crossAt<=e.min}findLabelSize(e,t){let i=0;const n="Horizontal"===this.orientation;if(this.title&&(this.titleSize=b(this.title,this.titleStyle),i=this.titleSize.height+t,this.rect.width||this.rect.height)&&(this.titleCollection=At(this.title,this.titleStyle,n?this.rect.width:this.rect.height),i*=this.titleCollection.length),"Inside"===this.labelPosition)return i+t;let s,r,a=i+t+this.titlePadding+this.labelPadding+("Vertical"===this.orientation?this.maxLabelSize.width:this.maxLabelSize.height)+this.multiLevelLabelHeight;if(e&&this.placeNextToAxisLine){const t=e.visibleRange,i="Horizontal"===e.orientation?e.rect.width:e.rect.height;if(!t||!i)return 0;this.isInside(t)&&(r=this.findDifference(e),s=r*(i/t.delta),s=r*((i-(s<a?a-s:0))/t.delta),a=s<a?a-s:0)}return a}updateCrossValue(){let e=this.crossAt;if(null===e||!this.isInside(this.crossInAxis.visibleRange))return this.updatedRect=this.rect,null;const t=this.crossInAxis.visibleRange;this.opposedPosition?this.crossAt<t.min&&(e=t.min):this.crossAt>t.max&&(e=t.max),this.updatedRect=Object(r.L)({},this.rect,null,!0),"Horizontal"===this.orientation?(e=this.crossInAxis.rect.height-He(e,this.crossInAxis)*this.crossInAxis.rect.height,this.updatedRect.y=this.crossInAxis.rect.y+e):(e=He(e,this.crossInAxis)*this.crossInAxis.rect.width,this.updatedRect.x=this.crossInAxis.rect.x+e)}findDifference(e){let t=0;return t=this.opposedPosition?e.isInversed?e.visibleRange.min:e.visibleRange.max:e.isInversed?e.visibleRange.max:e.visibleRange.min,Math.abs(this.crossAt-t)}calculateVisibleRangeOnZooming(e){if(Qe(this)){const t=this.actualRange;let i,n;!this.isInversed||e.zoomModule?(i=this.actualRange.min+this.zoomPosition*this.actualRange.delta,n=i+this.zoomFactor*this.actualRange.delta):(i=this.actualRange.max-this.zoomPosition*this.actualRange.delta,n=i-this.zoomFactor*this.actualRange.delta),i<t.min&&(n+=t.min-i,i=t.min),n>t.max&&(i-=n-t.max,n=t.max),this.doubleRange=new ee(i,n),this.visibleRange={min:this.doubleRange.start,max:this.doubleRange.end,delta:this.doubleRange.delta,interval:this.visibleRange.interval}}}calculateAxisRange(e,t){if(t.enableAutoIntervalOnBothAxis){if("Horizontal"===this.orientation&&"X"===t.zoomSettings.mode)for(let i=0;i<this.series.length;i++){const n=[];for(const e of this.series[i].visiblePoints)e.xValue>this.visibleRange.min&&e.xValue<this.visibleRange.max&&n.push(e.yValue);for(const s of t.axisCollections)"Vertical"!==s.orientation||Object(r.Z)(s.series[i])||(s.series[i].yMin=Math.min(...n),s.series[i].yMax=Math.max(...n),s.baseModule.calculateRangeAndInterval(e,s))}if("Vertical"===this.orientation&&"Y"===t.zoomSettings.mode)for(let i=0;i<this.series.length;i++){const n=[];for(const e of this.series[i].visiblePoints)e.yValue>this.visibleRange.min&&e.yValue<this.visibleRange.max&&n.push(e.xValue);for(const s of t.axisCollections)"Horizontal"!==s.orientation||Object(r.Z)(s.series[i])||(s.series[i].xMin=Math.min(...n),s.series[i].xMax=Math.max(...n),s.baseModule.calculateRangeAndInterval(e,s))}}}triggerRangeRender(e,t,i,n){const s={cancel:!1,name:"axisRangeCalculated",axis:this,minimum:t,maximum:i,interval:n};e.trigger("axisRangeCalculated",s),s.cancel||(this.visibleRange={min:s.minimum,max:s.maximum,interval:s.interval,delta:s.maximum-s.minimum})}getRangePadding(e){let t=this.rangePadding;if("Auto"!==t)return t;switch(this.orientation){case"Horizontal":t=e.requireInvertedAxis?this.isStack100||this.baseModule.chart.stockChart?"Round":"Normal":"None";break;case"Vertical":t=e.requireInvertedAxis?"None":this.isStack100||this.baseModule.chart.stockChart?"Round":"Normal"}return t}getMaxLabelWidth(e){let t,i,n=0,s=!1;this.angle=this.labelRotation,this.maxLabelSize=new x(0,0);const a=this.labelIntersectAction;let o;for(let r=0,l=this.visibleLabels.length;r<l;r++){o=this.visibleLabels[r],i=we(o.originalText),i?(o.size=b(o.originalText.replace(/<br>/g," "),this.labelStyle),o.breakLabelSize=b(this.enableTrim?o.text.join("<br>"):o.originalText,this.labelStyle)):o.size=b(o.text,this.labelStyle);const e=i?o.breakLabelSize.width:o.size.width;e>this.maxLabelSize.width&&(this.maxLabelSize.width=e,this.rotatedLabel=o.text);const l=i?o.breakLabelSize.height:o.size.height;if(l>this.maxLabelSize.height&&(this.maxLabelSize.height=l),i&&(o.text=this.enableTrim?o.text:o.originalText.split("<br>")),"None"!==a&&"Hide"!==a&&"Trim"!==a&&("None"!==a||this.angle%360==0)&&"Horizontal"===this.orientation&&this.rect.width>0&&!s){const e=i?o.breakLabelSize.width:o.size.width;switch(t=He(o.value,this)*this.rect.width+this.rect.x,t-=e/2,"Shift"===this.edgeLabelPlacement&&(0===r&&t<this.rect.x&&(t=this.rect.x),r===this.visibleLabels.length-1&&t+e>this.rect.x+this.rect.width&&(t=this.rect.x+this.rect.width-e)),a){case"MultipleRows":r>0&&this.findMultiRows(r,t,o,i);break;case"Rotate45":case"Rotate90":r>0&&(this.isInversed?t+e>=n:t<=n)&&(this.angle="Rotate45"===a?45:90,s=!0);break;default:if(i){let e;const t=[];let i;for(let n=0;n<o.text.length;n++)if(e=Et(o.text[n],this.rect.width/this.visibleLabels.length,this.labelStyle),e.length>1)for(let s=0;s<e.length;s++)i=e[s],t.push(i);else t.push(e[0]);o.text=t}else o.text=Et(o.text,this.rect.width/this.visibleLabels.length,this.labelStyle);const l=o.size.height*o.text.length;l>this.maxLabelSize.height&&(this.maxLabelSize.height=l)}n=this.isInversed?t:t+e}}if(0!==this.angle&&"Horizontal"===this.orientation){this.rotatedLabel=Object(r.Z)(this.rotatedLabel)?"":this.rotatedLabel;const t=-360===this.angle||0===this.angle||-180===this.angle||180===this.angle||360===this.angle;this.maxLabelSize="Outside"===this.labelPosition&&!t&&we(this.rotatedLabel)?new x(this.maxLabelSize.height,this.maxLabelSize.width):function(e,t,i,n){const s=new m(n.element.id);let a,o,l,h,c,d=[];const p={id:"rotate_text",x:n.initialClipRect.x,y:n.initialClipRect.y,"font-size":e.size,"font-style":e.fontStyle,"font-family":e.fontFamily,"font-weight":e.fontWeight,transform:"rotate("+i+", 0, 0)","text-anchor":"middle"};we(t)?(d=t.split("<br>"),a=d[0]):a=t;const g=s.createText(p,a);if(n.delayRedraw||n.redraw||n.element.appendChild(n.svgObject),"string"!=typeof d&&d.length>1)for(let r=1,m=d.length;r<m;r++)o=b(d[r],e).height,l=p.y+r*o,h=d[r],c=s.createTSpan({x:p.x,id:p.id,y:l},h),g.appendChild(c);n.svgObject.appendChild(g);const u=g.getBoundingClientRect();return Object(r.kb)(g),n.delayRedraw||n.redraw||Object(r.kb)(n.svgObject),new x(u.right-u.left,u.bottom-u.top)}(this.labelStyle,this.rotatedLabel,this.angle,e)}e.multiLevelLabelModule&&this.multiLevelLabels.length>0&&e.multiLevelLabelModule.getMultilevelLabelsHeight(this)}findMultiRows(e,t,i,n){let s,r,a;const o=[];let l;for(let c=e-1;c>=0;c--)s=this.visibleLabels[c],a=n?s.breakLabelSize.width:s.size.width,r=He(s.value,this)*this.rect.width+this.rect.x,l=this.isInversed?t+i.size.width>r-.5*a:t<r+.5*a,l?(o.push(s.index),i.index=i.index>s.index?i.index:s.index+1):i.index=o.indexOf(s.index)>-1?i.index:s.index;const h=(n?i.breakLabelSize.height:i.size.height)*i.index+5*(i.index-1);h>this.maxLabelSize.height&&(this.maxLabelSize.height=h)}getModule(e){this.baseModule="Double"===this.valueType?new te(e):e[qe(this.valueType)+"Module"]}}return pe([Object(r.g)(F.axisLabelFont,z)],e.prototype,"labelStyle",void 0),pe([Object(r.g)({},Ce)],e.prototype,"crosshairTooltip",void 0),pe([Object(r.t)("")],e.prototype,"title",void 0),pe([Object(r.g)(F.axisTitleFont,z)],e.prototype,"titleStyle",void 0),pe([Object(r.t)("")],e.prototype,"labelFormat",void 0),pe([Object(r.t)("")],e.prototype,"skeleton",void 0),pe([Object(r.t)("DateTime")],e.prototype,"skeletonType",void 0),pe([Object(r.t)("Center")],e.prototype,"lineBreakAlignment",void 0),pe([Object(r.t)(0)],e.prototype,"plotOffset",void 0),pe([Object(r.t)(null)],e.prototype,"plotOffsetLeft",void 0),pe([Object(r.t)(null)],e.prototype,"plotOffsetTop",void 0),pe([Object(r.t)(null)],e.prototype,"plotOffsetRight",void 0),pe([Object(r.t)(null)],e.prototype,"plotOffsetBottom",void 0),pe([Object(r.t)(!1)],e.prototype,"isIndexed",void 0),pe([Object(r.t)(10)],e.prototype,"logBase",void 0),pe([Object(r.t)(0)],e.prototype,"columnIndex",void 0),pe([Object(r.t)(0)],e.prototype,"rowIndex",void 0),pe([Object(r.t)(1)],e.prototype,"span",void 0),pe([Object(r.t)(null)],e.prototype,"desiredIntervals",void 0),pe([Object(r.t)(3)],e.prototype,"maximumLabels",void 0),pe([Object(r.t)(1)],e.prototype,"zoomFactor",void 0),pe([Object(r.t)(0)],e.prototype,"zoomPosition",void 0),pe([Object(r.t)(!0)],e.prototype,"enableScrollbarOnZooming",void 0),pe([Object(r.t)(!1)],e.prototype,"opposedPosition",void 0),pe([Object(r.t)(!0)],e.prototype,"enableAutoIntervalOnZooming",void 0),pe([Object(r.t)("Auto")],e.prototype,"rangePadding",void 0),pe([Object(r.t)("Double")],e.prototype,"valueType",void 0),pe([Object(r.t)("None")],e.prototype,"edgeLabelPlacement",void 0),pe([Object(r.t)("Auto")],e.prototype,"intervalType",void 0),pe([Object(r.t)("BetweenTicks")],e.prototype,"labelPlacement",void 0),pe([Object(r.t)("Outside")],e.prototype,"tickPosition",void 0),pe([Object(r.t)("Outside")],e.prototype,"labelPosition",void 0),pe([Object(r.t)("")],e.prototype,"name",void 0),pe([Object(r.t)(!0)],e.prototype,"visible",void 0),pe([Object(r.t)(0)],e.prototype,"minorTicksPerInterval",void 0),pe([Object(r.t)(0)],e.prototype,"labelRotation",void 0),pe([Object(r.t)(null)],e.prototype,"crossesAt",void 0),pe([Object(r.t)(!0)],e.prototype,"placeNextToAxisLine",void 0),pe([Object(r.t)(null)],e.prototype,"crossesInAxis",void 0),pe([Object(r.t)(null)],e.prototype,"minimum",void 0),pe([Object(r.t)(null)],e.prototype,"maximum",void 0),pe([Object(r.t)(null)],e.prototype,"interval",void 0),pe([Object(r.t)(34)],e.prototype,"maximumLabelWidth",void 0),pe([Object(r.t)(!1)],e.prototype,"enableTrim",void 0),pe([Object(r.t)(5)],e.prototype,"labelPadding",void 0),pe([Object(r.t)(5)],e.prototype,"titlePadding",void 0),pe([Object(r.g)({},ye)],e.prototype,"majorTickLines",void 0),pe([Object(r.g)({},xe)],e.prototype,"minorTickLines",void 0),pe([Object(r.g)({},me)],e.prototype,"majorGridLines",void 0),pe([Object(r.g)({},fe)],e.prototype,"minorGridLines",void 0),pe([Object(r.g)({},be)],e.prototype,"lineStyle",void 0),pe([Object(r.t)("Trim")],e.prototype,"labelIntersectAction",void 0),pe([Object(r.t)(!1)],e.prototype,"isInversed",void 0),pe([Object(r.t)(100)],e.prototype,"coefficient",void 0),pe([Object(r.t)(0)],e.prototype,"startAngle",void 0),pe([Object(r.t)(!0)],e.prototype,"startFromZero",void 0),pe([Object(r.t)(null)],e.prototype,"description",void 0),pe([Object(r.t)(2)],e.prototype,"tabIndex",void 0),pe([Object(r.f)([],le)],e.prototype,"stripLines",void 0),pe([Object(r.f)([],he)],e.prototype,"multiLevelLabels",void 0),pe([Object(r.g)({color:null,width:0,type:"Rectangle"},ae)],e.prototype,"border",void 0),pe([Object(r.g)({},de)],e.prototype,"scrollbarSettings",void 0),e})();class Se{constructor(e,t,i,n,s=new x(0,0),r=new x(0,0),a=1){this.text=e,this.originalText=n,this.value=t,this.labelStyle=i,this.size=s,this.breakLabelSize=r,this.index=a}}function we(e){return-1!==e.indexOf("<br>")}function Ie(e){const t=Object(r.L)([],e.points,null,!0),i=[];let n,s=0;for(let a=0;a<t.length;a++)n=t[a],Object(r.Z)(n.x)||""===n.x||(n.index=s++,i.push(n));return i}function Oe(e){if(!e)return null;const t="string"==typeof e?nt(e):e;t&&Object(r.kb)(t)}function Re(e,t){return Math.log(e)/Math.log(t)}function Ae(e,t,i,n,s,a,o,l){let h=document.getElementById(s);const c=b(e,{fontFamily:"Segoe UI",size:"12px",fontStyle:"Normal",fontWeight:"Regular"}),d=c.width+5;t=t+d>n?t-(d+15):t,i=l?i-c.height/2:i+15,h?(h.innerHTML=e,h.style.top=i.toString()+"px",h.style.left=(t+15).toString()+"px"):(h=Object(r.G)("div",{innerHTML:e,id:s,styles:"top:"+i.toString()+"px;left:"+(t+15).toString()+'px;background-color: rgb(255, 255, 255) !important; color:black !important; position:absolute;border:1px solid rgb(112, 112, 112); padding-left : 3px; padding-right : 2px;padding-bottom : 2px; padding-top : 2px; font-size:12px; font-family: "Segoe UI"'}),a.appendChild(h),parseInt(h.style.left.replace("px",""),10)<0&&(h.style.left="0px")),o&&setTimeout(()=>{Oe(s)},1500)}function ke(e,t){return e<t.max&&e>t.min}function Ee(e,t){return e<=t.max&&e>=t.min}function Le(e,t){return"Logarithmic"===t.valueType?Re(e,t.logBase):e}function Te(e,t,i,n){const s=Le(t.xValue,n.xAxis),r=e?Le(e.xValue,n.xAxis):s,a=i?Le(i.xValue,n.xAxis):s,o=Math.floor(n.xAxis.visibleRange.min),l=Math.ceil(n.xAxis.visibleRange.max);return r>=o&&r<=l||s>=o&&s<=l||a>=o&&a<=l||o>=r&&o<=a}function je(e){let t=0;for(const i of e)t+=i;return t}function De(e,t){return e.x+=t.left,e.y+=t.top,e.width-=t.left+t.right,e.height-=t.top+t.bottom,e}function Me(e,t,i){const n=e*Math.PI/180;return new Pt(Math.cos(n)*t+i.x,Math.sin(n)*t+i.y)}function Fe(e){return e*(Math.PI/180)}function Pe(e,t,i,n){const s=[];for(let r=0;r<4;r++){const a=e[r],o=a.x-t,l=a.y-i,h=o*Math.cos(Fe(n))-l*Math.sin(Fe(n)),c=o*Math.sin(Fe(n))+l*Math.cos(Fe(n));a.x=h+t,a.y=c+i,s.push(new Pt(a.x,a.y))}return s}function Ne(e,t){const i=[e,t];let n,s,a,o,l,h,c,d;for(o=0;o<i.length;o++){const p=i[o];for(l=0;l<p.length;l++){const i=p[l],o=p[(l+1)%p.length],g=new Pt(o.y-i.y,i.x-o.x);for(n=s=void 0,h=0;h<e.length;h++)a=g.x*e[h].x+g.y*e[h].y,(Object(r.Z)(n)||a<n)&&(n=a),(Object(r.Z)(s)||a>s)&&(s=a);for(c=d=void 0,h=0;h<t.length;h++)a=g.x*t[h].x+g.y*t[h].y,(Object(r.Z)(c)||a<c)&&(c=a),(Object(r.Z)(d)||a>d)&&(d=a);if(s<c||d<n)return!1}}return!0}function Be(e,t){const i=[];for(let n=0;n<=t-1;n++)i.push(e[n]);return i}function He(e,t){const i=t.visibleRange,n=(e-i.min)/i.delta;return t.isInversed?1-n:n}function _e(e,t,i,n,s,r){e="Logarithmic"===i.valueType?Re(e>1?e:1,i.logBase):e,t="Logarithmic"===n.valueType?Re(t>1?t:1,n.logBase):t,e+="Category"===i.valueType&&"BetweenTicks"===i.labelPlacement&&"Radar"!==r.type?.5:0;const a=r.chart.radius*He(t,n),o=function(e,t){t=t<0?t+360:t;let i=Math.PI*(1.5-2*e);return i+=t*Math.PI/180,{x:Math.cos(i),y:Math.sin(i)}}(function(e,t){const i=t.visibleRange;let n,s;return"Category"!==t.valueType?(n=i.max-("DateTime"===t.valueType?t.dateTimeInterval:i.interval)-i.min,s=t.visibleLabels.length-1,n=0===n?1:n):(n=1===t.visibleLabels.length?1:t.visibleLabels[t.visibleLabels.length-1].value-t.visibleLabels[0].value,s=t.visibleLabels.length),t.isInversed?(e-i.min)/n*(1-1/s):1-(e-i.min)/n*(1-1/s)}(e,i),r.chart.primaryXAxis.startAngle);return{x:r.clipRect.width/2+r.clipRect.x+a*o.x,y:r.clipRect.height/2+r.clipRect.y+a*o.y}}function ze(e,t=!1){let i=["NaN","NaN"];return e.indexOf("_Point_")>-1?i=e.split("_Series_")[1].split("_Point_"):e.indexOf("_shape_")>-1&&(!t||t&&-1===e.indexOf("_legend_"))?(i=e.split("_shape_"),i[0]="0"):e.indexOf("_text_")>-1&&(!t||t&&-1===e.indexOf("_legend_"))&&(i=e.split("_text_"),i[0]="0"),new $(parseInt(i[0],10),parseInt(i[1],10))}function Ve(e,t,i,n=0,s=0){return e>=i.x-n&&e<=i.x+i.width+n&&t>=i.y-s&&t<=i.y+i.height+s}function Ue(e){const t=e.clipRect;e.chart.requireInvertedAxis?(t.x=e.yAxis.rect.x,t.y=e.xAxis.rect.y,t.width=e.yAxis.rect.width,t.height=e.xAxis.rect.height):(t.x=e.xAxis.rect.x,t.y=e.yAxis.rect.y,t.width=e.xAxis.rect.width,t.height=e.yAxis.rect.height)}function qe(e){return e.substr(0,1).toLowerCase()+e.substr(1)}function We(e,t){let i,n,s,a=Number.MAX_VALUE;for(let o=0;o<t.length;o++){const l=t[o];if(i=[],l.visible&&(e.name===l.xAxisName||"primaryXAxis"===e.name&&null===l.xAxisName||e.name===l.chart.primaryXAxis.name&&!l.xAxisName))if(i=l.points.map(e=>e.xValue),i.sort((e,t)=>e-t),1===i.length)s="DateTime"===e.valueType&&l.xMin===l.xMax?l.xMin-2592e6:l.xMin,n=i[0]-(Object(r.Z)(s)?e.visibleRange.min:s),0!==n&&(a=Math.min(a,n));else for(let e=0;e<i.length;e++){const t=i[e];e>0&&t&&(n=t-i[e-1],0!==n&&(a=Math.min(a,n)))}}return a===Number.MAX_VALUE&&(a=1),a}function Ze(e){let t;switch(e){case"Linear":t=Ge}return t}function Ge(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}function Ye(e,t,i,n,s,a,o){const l=a.x,h=a.y;let c=0;e.style.visibility="hidden",new r.b({}).animate(e,{duration:i,delay:t,progress:t=>{t.timeStamp>t.delay&&(t.element.style.visibility="visible",c=(t.timeStamp-t.delay)/t.duration,e.setAttribute("transform","translate("+l+" "+h+") scale("+c+") translate("+-l+" "+-h+")"))},end:()=>{e.style.visibility="","Scatter"!==n.type&&"Bubble"!==n.type||o||s!==n.points.length-1||n.chart.trigger("animationComplete",{series:n.chart.isBlazor?{}:n})}})}function Xe(e,t,i,n,s){if(!i||!n&&!e)return null;let a=300;s&&(a=s);const o=n||e.getAttribute("d"),l=o.split(/(?=[LMCZAQ])/),h=t.split(/(?=[LMCZAQ])/);let c,d,p,g=[],u=[];e.setAttribute("d",o),new r.b({}).animate(Object(r.G)("div"),{duration:a,progress:t=>{c="",l.map((e,i)=>{if(g=e.split(" "),u=h[i]?h[i].split(" "):g,c+="Z"===g[0]?"Z ":g[0]+" "+Ge(t.timeStamp,+g[1],+u[1]-+g[1],t.duration)+" "+Ge(t.timeStamp,+g[2],+u[2]-+g[2],t.duration)+" ","C"===g[0]||"Q"===g[0])for(d=3,p="Q"===g[0]?4:6;d<p;)c+=Ge(t.timeStamp,+g[d],+u[d]-+g[d],t.duration)+" "+Ge(t.timeStamp,+g[++d],+u[d]-+g[d],t.duration)+" ",++d;"A"===g[0]&&(c+="0 0 1 "+Ge(t.timeStamp,+g[6],+u[6]-+g[6],t.duration)+" "+Ge(t.timeStamp,+g[7],+u[7]-+g[7],t.duration)+" ")}),e.setAttribute("d",c)},end:()=>{e.setAttribute("d",t)}})}function $e(e,t,i,n="drawClipPath"){const s=wt(e,t.id,t,i);if(s){const e=i.createDefs();return e.appendChild(s),e}return i[n](t)}function Ke(e,t,i,n,s){const r={cancel:!1,name:"axisLabelRender",axis:s,text:i,value:t,labelStyle:n};if(e.trigger("axisLabelRender",r),!r.cancel){const e=-1!==r.text.indexOf("<br>"),t=s.enableTrim?e?function(e,t,i){const n=[],s=t.split("<br>");for(let r=0;r<s.length;r++){let a=b(t=s[r],i).width;if(a>e){for(let s=t.length-1;s>=0;--s)if(a=b(t=t.substring(0,s)+"...",i).width,a<=e){n.push(t);break}}else n.push(t)}return n}(s.maximumLabelWidth,r.text,s.labelStyle):vt(s.maximumLabelWidth,r.text,s.labelStyle):r.text;s.visibleLabels.push(new Se(t,r.value,r.labelStyle,r.text))}}function Je(e){return null!=e.minimum&&null!=e.maximum}function Qe(e){return e.zoomFactor<1&&e.zoomPosition>=0}function et(e,t){const i="Horizontal"===t.orientation?e.width:e.height;if(Object(r.Z)(t.desiredIntervals)){let e=("Horizontal"===t.orientation?.533:1)*t.maximumLabels;return e=Math.max(i*(e/100),1),e}return t.desiredIntervals}function tt(e,t,i,n,s){new r.b({}).animate(e,{duration:i,delay:t,name:n,progress:e=>{e.element.style.visibility="visible"},end:e=>{s?Object(r.kb)(e.element):e.element.style.visibility="visible"}})}function it(e,t,i,n,s,a,o,l,h,c){const d=o||new m(""),p=function(e,t,i,n,s,a,o){let l,h="Path";const c=a&&"Circle"===i?t.width-2:t.width,d=a&&"Circle"===i?t.height-2:t.height,p=a?o.targetWidth:0,g=e.x,u=e.y,m=e.y+-d/2,f=e.x+-c/2;let b,y;switch(i){case"Bubble":case"Circle":h="Ellipse",Object(r.gb)(n,{rx:c/2,ry:d/2,cx:g,cy:u});break;case"Cross":l="M "+f+" "+u+" L "+(g+c/2)+" "+u+" M "+g+" "+(u+d/2)+" L "+g+" "+(u+-d/2),Object(r.gb)(n,{d:l,stroke:n.fill});break;case"Multiply":l="M "+(g-p)+" "+(u-p)+" L "+(g+p)+" "+(u+p)+" M "+(g-p)+" "+(u+p)+" L "+(g+p)+" "+(u-p),Object(r.gb)(n,{d:l,stroke:n.fill});break;case"HorizontalLine":l="M "+f+" "+u+" L "+(g+c/2)+" "+u,Object(r.gb)(n,{d:l});break;case"VerticalLine":l="M "+g+" "+(u+d/2)+" L "+g+" "+(u+-d/2),Object(r.gb)(n,{d:l});break;case"Diamond":l="M "+f+" "+u+" L "+g+" "+(u+-d/2)+" L "+(g+c/2)+" "+u+" L "+g+" "+(u+d/2)+" L "+f+" "+u+" z",Object(r.gb)(n,{d:l});break;case"ActualRect":l="M "+f+" "+(u+-d/8)+" L "+(g+p)+" "+(u+-d/8)+" L "+(g+p)+" "+(u+d/8)+" L "+f+" "+(u+d/8)+" L "+f+" "+(u+-d/8)+" z",Object(r.gb)(n,{d:l});break;case"TargetRect":l="M "+(f+p)+" "+(u+-d/2)+" L "+(g+p/2)+" "+(u+-d/2)+" L "+(g+p/2)+" "+(u+d/2)+" L "+(f+p)+" "+(u+d/2)+" L "+(f+p)+" "+(u+-d/2)+" z",Object(r.gb)(n,{d:l});break;case"Rectangle":case"Hilo":case"HiloOpenClose":case"Candle":case"Waterfall":case"BoxAndWhisker":case"StepArea":case"StackingStepArea":case"Square":case"Flag":l="M "+f+" "+(u+-d/2)+" L "+(g+c/2)+" "+(u+-d/2)+" L "+(g+c/2)+" "+(u+d/2)+" L "+f+" "+(u+d/2)+" L "+f+" "+(u+-d/2)+" z",Object(r.gb)(n,{d:l});break;case"Pyramid":case"Triangle":l="M "+f+" "+(u+d/2)+" L "+g+" "+(u+-d/2)+" L "+(g+c/2)+" "+(u+d/2)+" L "+f+" "+(u+d/2)+" z",Object(r.gb)(n,{d:l});break;case"Funnel":case"InvertedTriangle":l="M "+(g+c/2)+" "+(u-d/2)+" L "+g+" "+(u+d/2)+" L "+(g-c/2)+" "+(u-d/2)+" L "+(g+c/2)+" "+(u-d/2)+" z",Object(r.gb)(n,{d:l});break;case"Pentagon":for(let e=0;e<=5;e++)b=c/2*Math.cos(Math.PI/180*(72*e)),y=d/2*Math.sin(Math.PI/180*(72*e)),l=0===e?"M "+(g+b)+" "+(u+y)+" ":l.concat("L "+(g+b)+" "+(u+y)+" ");l=l.concat("Z"),Object(r.gb)(n,{d:l});break;case"Image":h="Image",Object(r.gb)(n,{href:s,height:d,width:c,x:f,y:m})}return{renderOption:n=function(e,t,i,n){let s="";const a=t.height,o=t.width,l=e.x,h=e.y;switch(i){case"MultiColoredLine":case"Line":case"StackingLine":case"StackingLine100":s="M "+(l+-o/2)+" "+h+" L "+(l+o/2)+" "+h,Object(r.gb)(n,{d:s});break;case"StepLine":n.fill="transparent",s="M "+(l+-o/2-2.5)+" "+(h+a/2)+" L "+(l+-o/2+o/10)+" "+(h+a/2)+" L "+(l+-o/2+o/10)+" "+h+" L "+(l+-o/10)+" "+h+" L "+(l+-o/10)+" "+(h+a/2)+" L "+(l+o/5)+" "+(h+a/2)+" L "+(l+o/5)+" "+(h+-a/2)+" L "+(l+o/2)+" "+(h+-a/2)+"L "+(l+o/2)+" "+(h+a/2)+" L"+(l+o/2+2.5)+" "+(h+a/2),Object(r.gb)(n,{d:s});break;case"UpArrow":n.fill=n.stroke,n.stroke="transparent",s="M "+(l+-o/2)+" "+(h+a/2)+" L "+l+" "+(h-a/2)+" L "+(l+o/2)+" "+(h+a/2)+"L "+(l+o/2-2)+" "+(h+a/2)+" L "+l+" "+(h-a/2+4)+"L"+(l-o/2+2)+" "+(h+a/2)+" Z",Object(r.gb)(n,{d:s});break;case"DownArrow":s="M "+(l-o/2)+" "+(h-a/2)+" L "+l+" "+(h+a/2)+" L "+(l+o/2)+" "+(h-a/2)+"L "+(l+o/2-2)+" "+(h-a/2)+" L "+l+" "+(h+a/2-4)+"L"+(l-o/2+2)+" "+(h-a/2)+" Z",Object(r.gb)(n,{d:s});break;case"RightArrow":s="M "+(l+-o/2)+" "+(h-a/2)+" L "+(l+o/2)+" "+h+" L "+(l+-o/2)+" "+(h+a/2)+" L "+(l+-o/2)+" "+(h+a/2-2)+" L "+(l+o/2-4)+" "+h+" L"+(l+-o/2)+" "+(h-a/2+2)+" Z",Object(r.gb)(n,{d:s});break;case"LeftArrow":n.fill=n.stroke,n.stroke="transparent",s="M "+(l+o/2)+" "+(h-a/2)+" L "+(l+-o/2)+" "+h+" L "+(l+o/2)+" "+(h+a/2)+" L "+(l+o/2)+" "+(h+a/2-2)+" L "+(l+-o/2+4)+" "+h+" L"+(l+o/2)+" "+(h-a/2+2)+" Z",Object(r.gb)(n,{d:s});break;case"Column":case"Pareto":case"StackingColumn":case"StackingColumn100":case"RangeColumn":case"Histogram":s="M "+(l-o/5*3)+" "+(h-a/5)+" L "+(l+-o/10*3)+" "+(h-a/5)+" L "+(l+-o/10*3)+" "+(h+a/2)+" L "+(l-o/5*3)+" "+(h+a/2)+" Z M "+(l+-o/10-o/20)+" "+(h-a/4-5)+" L "+(l+o/10+o/20)+" "+(h-a/4-5)+" L "+(l+o/10+o/20)+" "+(h+a/2)+" L "+(l+-o/10-o/20)+" "+(h+a/2)+" Z M "+(l+o/10*3)+" "+h+" L "+(l+o/5*3)+" "+h+" L "+(l+o/5*3)+" "+(h+a/2)+" L "+(l+o/10*3)+" "+(h+a/2)+" Z",Object(r.gb)(n,{d:s});break;case"Bar":case"StackingBar":case"StackingBar100":s="M "+(l+-o/2+-2.5)+" "+(h-a/5*3)+" L "+(l+o/10*3)+" "+(h-a/5*3)+" L "+(l+o/10*3)+" "+(h-a/10*3)+" L "+(l-o/2-2.5)+" "+(h-a/10*3)+" Z M "+(l+-o/2+-2.5)+" "+(h-a/5+.5)+" L "+(l+o/2+2.5)+" "+(h-a/5+.5)+" L "+(l+o/2+2.5)+" "+(h+a/10+.5)+" L "+(l-o/2-2.5)+" "+(h+a/10+.5)+" Z M "+(l-o/2-2.5)+" "+(h+a/5+1)+" L "+(l+-o/4)+" "+(h+a/5+1)+" L "+(l+-o/4)+" "+(h+a/2+1)+" L "+(l-o/2-2.5)+" "+(h+a/2+1)+" Z",Object(r.gb)(n,{d:s});break;case"Spline":n.fill="transparent",s="M "+(l-o/2)+" "+(h+a/5)+" Q "+l+" "+(h-a)+" "+l+" "+(h+a/5)+" M "+l+" "+(h+a/5)+" Q "+(l+o/2)+" "+(h+a/2)+" "+(l+o/2)+" "+(h-a/2),Object(r.gb)(n,{d:s});break;case"Area":case"MultiColoredArea":case"RangeArea":case"StackingArea":case"StackingArea100":s="M "+(l-o/2-2.5)+" "+(h+a/2)+" L "+(l+-o/4+-1.25)+" "+(h-a/2)+" L "+l+" "+(h+a/4)+" L "+(l+o/4+1.25)+" "+(h+-a/2+a/4)+" L "+(l+a/2+2.5)+" "+(h+a/2)+" Z",Object(r.gb)(n,{d:s});break;case"SplineArea":case"SplineRangeArea":s="M "+(l-o/2)+" "+(h+a/5)+" Q "+l+" "+(h-a)+" "+l+" "+(h+a/5)+" Z M "+l+" "+(h+a/5)+" Q "+(l+o/2)+" "+(h+a/2)+" "+(l+o/2)+" "+(h-a/2)+"  Z",Object(r.gb)(n,{d:s});break;case"Pie":case"Doughnut":n.stroke="transparent",s=function(e,t,i,n,s,r){const a=Me(270,i,new Pt(e,t)),o=Me(270,i,new Pt(e+s/10,t));return"M "+e+" "+t+" L "+(e+i)+" "+t+" A "+i+" "+i+" 0 1 1 "+a.x+" "+a.y+" Z M "+(e+s/10)+" "+(t-n/10)+" L"+(e+i)+" "+(t-n/10)+" A "+i+" "+i+" 0 0 0 "+o.x+" "+o.y+" Z"}(l,h,Math.min(a,o)/2,a,o),Object(r.gb)(n,{d:s})}return{renderOption:n}}(e,new x(c,d),i,n).renderOption,functionName:h}}(e,i,t,s,n,h,c);return d["draw"+p.functionName](p.renderOption,l?new Int32Array([l.x,l.y]):null)}function nt(e){return document.getElementById(e)}function st(e,t,i,n,s,r,a,o,l,h){let c=e.getBoundingClientRect();t.accumulationDataLabelModule.calculateLabelSize(i,e,r,n,s,a,o,l,h,c,!0)}function rt(e,t,i,n,s,r){let a=document.getElementById(t.element.id+"_Series_"+(void 0===n.index?n.category:n.index)+"_DataLabelCollections");a&&(0===i.index&&(t.dataLabelCollections=[]),t.dataLabelModule.calculateTemplateLabelSize(a,e,i,n,n.marker.dataLabel,s,n.clipRect,r,!0))}function at(e,t,i,n,s,a,o,l,h,c,d,p,g,u,m){const f=function(e){let t=null;try{document.querySelectorAll(e).length&&(t=Object(r.F)(document.querySelector(e).innerHTML.trim()))}catch(i){t=Object(r.F)(e)}return t}(i);let b;try{const i=window.Blazor?o?s:{point:s}:{chart:n,series:a,point:s},r=o?o+"_template":"template",y=f?f(i,n,r,o||e.id.replace(/[^a-zA-Z0-9]/g,"")):[];if(y.length){b=Array.prototype.slice.call(y);const t=b.length;for(let i=0;i<t;i++)e.appendChild(b[i])}let x;"accumulationchart"===n.getModuleName()?(x=st.bind(this,e,n,c,d,h,d[t],p,g,u,m),n.isReact&&n.renderReactTemplates(x)):"chart"===n.getModuleName()&&(x=s&&a?rt.bind(this,e,n,s,a,l,m):x,n.isReact&&n.renderReactTemplates(x))}catch(y){return e}return e}function ot(e){let t="";return t="font-size:"+e.size+"; font-style:"+e.fontStyle+"; font-weight:"+e.fontWeight+"; font-family:"+e.fontFamily+";opacity:"+e.opacity+"; color:"+e.color+";",t}function lt(e,t=!1,i){i||document.body.appendChild(e);const n=e.getBoundingClientRect();return t?Object(r.kb)(e):i||Oe(e.id),n}function ht(e,t,i,n,s){e="Logarithmic"===i.valueType?Re(e>0?e:Math.pow(i.logBase,i.visibleRange.min),i.logBase):e,t="Logarithmic"===n.valueType?Re(t>0?t:Math.pow(n.logBase,n.visibleRange.min),n.logBase):t,e=He(e,i),t=He(t,n);const r=s?i.rect.height:i.rect.width,a=s?n.rect.width:n.rect.height;return new Pt(s?t*a:e*r,s?(1-e)*r:(1-t)*a)}function ct(e,t,i,n,s=!1,a="x",o="y",l,h,c=!1,d=!1,p=null,g){if(e)return null;const u=t.querySelector("#"+i.id),m=u||nt(i.id),f=i,b=g||300;if(n&&s&&m)if(l=l||("DIV"===m.tagName?new Pt(+m.style[a].split("px")[0],+m.style[o].split("px")[0]):new Pt(+m.getAttribute(a),+m.getAttribute(o))),h&&"undefined"!==h)Xe(i,i.getAttribute("d"),n,h,b);else if(d&&p)!function(e,t,i,n,s){const a=t=>{e.setAttribute("x",t.x+""),e.setAttribute("y",t.y+""),e.setAttribute("width",t.width+""),e.setAttribute("height",t.height+"")};new r.b({}).animate(Object(r.G)("div"),{duration:i,delay:0,progress:e=>{a(new C(Ge(e.timeStamp,s.x,n.x-s.x,e.duration),Ge(e.timeStamp,s.y,n.y-s.y,e.duration),Ge(e.timeStamp,s.width,n.width-s.width,e.duration),Ge(e.timeStamp,s.height,n.height-s.height,e.duration)))},end:()=>{a(n)}})}(f,0,b,new C(+m.getAttribute("x"),+m.getAttribute("y"),+m.getAttribute("width"),+m.getAttribute("height")),p);else{const e="DIV"===f.tagName?new Pt(+f.style[a].split("px")[0],+f.style[o].split("px")[0]):new Pt(+f.getAttribute(a),+f.getAttribute(o));!function(e,t,i,n,s="x",a="y"){const o="DIV"===e.tagName,l=(t,i)=>{o?(e.style[s]=t+"px",e.style[a]=i+"px"):(e.setAttribute(s,t+""),e.setAttribute(a,i+""))};l(i.x,i.y),new r.b({}).animate(Object(r.G)("div"),{duration:t,progress:e=>{l(Ge(e.timeStamp,i.x,n.x-i.x,e.duration),Ge(e.timeStamp,i.y,n.y-i.y,e.duration))},end:()=>{l(n.x,n.y)}})}(f,b,l,e,a,o)}else n&&s&&!m&&c&&tt(f,0,600,"FadeIn");u?t.replaceChild(f,m):t.appendChild(f)}function dt(e,t,i){const n=t.yAxis.labelFormat,s=[],r=null!==n.match("{value}");switch(t.seriesType){case"XY":"PolarRadar"===t.chart.chartAreaType?-1!==t.drawType.indexOf("Stacking")?("Logarithmic"===t.yAxis.valueType&&Le(t.stackedValues.endValues[e.index],t.yAxis)||Ee(t.stackedValues.endValues[e.index],t.yAxis.visibleRange))&&s.push(e.text||e.yValue.toString()):("Logarithmic"===t.yAxis.valueType&&Le(e.yValue,t.yAxis)||Ee(e.yValue,t.yAxis.visibleRange))&&s.push(e.text||e.yValue.toString()):s.push(e.text||e.yValue.toString());break;case"HighLow":s.push(e.text||Math.max(e.high,e.low).toString()),s.push(e.text||Math.min(e.high,e.low).toString());break;case"HighLowOpenClose":s.push(e.text||Math.max(e.high,e.low).toString()),s.push(e.text||Math.min(e.high,e.low).toString()),s.push(e.text||Math.max(e.open,e.close).toString()),s.push(e.text||Math.min(e.open,e.close).toString());break;case"BoxPlot":s.push(e.text||e.median.toString()),s.push(e.text||e.maximum.toString()),s.push(e.text||e.minimum.toString()),s.push(e.text||e.upperQuartile.toString()),s.push(e.text||e.lowerQuartile.toString());for(const t of e.outliers)s.push(e.text||t.toString())}if(n&&!e.text){t.yAxis.format=i.intl.getNumberFormat({format:r?"":n,useGrouping:i.useGroupingSeparator});for(let e=0;e<s.length;e++)s[e]=r?n.replace("{value}",t.yAxis.format(parseFloat(s[e]))):t.yAxis.format(parseFloat(s[e]))}return s}function pt(e){window.clearInterval(e)}function gt(e,t,i){const n=new C(e.x+i.x,e.y+i.y,e.width,e.height);return t.some(e=>n.x<e.x+e.width&&n.x+n.width>e.x&&n.y<e.y+e.height&&n.height+n.y>e.y)}function ut(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.height+e.y>t.y}function mt(e,t,i){return new C(e.x-t.width/2-i.left,e.y-t.height/2-i.top,t.width+i.left+i.right,t.height+i.top+i.bottom)}function ft(e){return"#"+bt(e.r)+bt(e.g)+bt(e.b)}function bt(e){const t=e.toString(16);return 1===t.length?"0"+t:t}function yt(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new Bt(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):new Bt(255,255,255)}function xt(e){e="transparent"===e?"white":e,document.body.appendChild(Object(r.G)("text",{id:"chartmeasuretext"}));const t=document.getElementById("chartmeasuretext");t.style.color=e,e=window.getComputedStyle(t).color,Object(r.kb)(t);const i=/^(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/.exec(e);return ft(new Bt(parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10)))}function Ct(e,t){(e=(e=xt(e)).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;let i,n="#";for(let s=0;s<3;s++)i=parseInt(e.substr(2*s,2),16),i=Math.round(Math.min(Math.max(0,i+i*t),255)),n+=("00"+i.toString(16)).substr(i.toString(16).length);return n}function vt(e,t,i){let n=t,s=b(t,i).width;if(s>e)for(let r=t.length-1;r>=0;--r)if(n=t.substring(0,r)+"...",s=b(n,i).width,s<=e)return n;return n}function St(e,t){return null!=e?-1!==e.indexOf("%")?t/100*parseInt(e,10):parseInt(e,10):null}function wt(e,t,i,n){if(!e)return null;const s=nt(t);return s&&i&&n.setElementAttributes(i,"clipPath"===s.tagName?s.childNodes[0]:s),s}function It(e,t,i,n,s,r=!1,a,o,l=!1,h,c,d,p,g){let u,m,y,x,C={};C={id:t.id,x:t.x,y:t.y,fill:n||"black","font-size":i.size,"font-style":i.fontStyle,"font-family":i.fontFamily,"font-weight":i.fontWeight,"text-anchor":t.anchor,labelRotation:t.labelRotation,transform:t.transform,opacity:i.opacity,"dominant-baseline":t.baseLine};const v=e.createText(C,"string"==typeof t.text?t.text:r?t.text[t.text.length-1]:t.text[0],c?c.x:0,c?c.y:0);if(v.style.fontFamily=i.fontFamily,v.style.fontStyle=i.fontStyle,v.style.fontSize=i.size,v.style.fontWeight=i.fontWeight,v.style.color=i.color,v.style.textAnchor=t.anchor,"string"!=typeof t.text&&t.text.length>1)for(let f=1,S=t.text.length;f<S;f++)m=b(t.text[f],i).height,y=t.y+(r?-f*m:f*m),x=r?t.text[t.text.length-(f+1)]:t.text[f],g?u=e.createText(C,x,null,null,y,!0):(u=e.createTSpan({x:t.x,id:t.id,y},x),v.appendChild(u));return p||ct(e instanceof f,s,v,a,o,"x","y",null,null,l,!1,null,h),v}function Ot(e){let t=e.element.clientWidth||e.element.offsetWidth,i=e.element.clientHeight;e.stockChart&&(t=e.stockChart.availableSize.width,i=e.stockChart.availableSize.height);let n,s=450;if("rangeNavigator"===e.getModuleName()){const t=e,i=t.periodSelectorSettings.periods.length?t.periodSelectorSettings.height:0;n=t.margin.top+t.margin.bottom+(t.tooltip.enable?35:0);const a=b("tempString",t.labelStyle).height,o=15;s=(e.series.length?r.d.isDevice?80:120:(t.enableGrouping?40+o+a:40)+n)+i,t.disableRangeSelector&&(s=i)}e.availableSize=new x(St(e.width,t)||t||600,St(e.height,i||s)||i||s)}function Rt(e){e.canvasRender=new f(e.element.id),e.renderer=e.enableCanvas?e.canvasRender:new m(e.element.id),Ot(e),e.svgObject=e.stockChart&&"chart"===e.getModuleName()?e.stockChart.chartObject:e.stockChart&&"rangeNavigator"===e.getModuleName()?e.stockChart.selectorObject:e.enableCanvas?e.renderer.createCanvas({id:e.element.id+"_canvas",width:e.availableSize.width,height:e.availableSize.height}):e.renderer.createSvg({id:e.element.id+"_svg",width:e.availableSize.width,height:e.availableSize.height})}function At(e,t,i){let n=[];switch(t.textOverflow){case"Wrap":n=Et(e,i,t);break;case"Trim":n.push(vt(i,e,t));break;default:n.push(e)}return n}function kt(e,t){let i;return i="Near"===t.textAlignment?e.x:"Center"===t.textAlignment?e.x+e.width/2:e.x+e.width,i}function Et(e,t,i){const n=e.split(" ");let s="";const r=[];let a;for(let o=0,l=n.length;o<l;o++)a=n[o],b(s.concat(a),i).width<t?s=s.concat((""===s?"":" ")+a):""!==s?(r.push(vt(t,s,i)),s=a):(r.push(vt(t,a,i)),a=""),s&&o===l-1&&r.push(vt(t,s,i));return r}function Lt(e,t){const i=e.replace(t," "),n=e.match(t);let s=" ",r=" ",a=0;const o={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"},l={0:"\u2070",1:"\xb9",2:"\xb2",3:"\xb3",4:"\u2074",5:"\u2075",6:"\u2076",7:"\u2077",8:"\u2078",9:"\u2079"};for(let h=0;h<=i.length-1;h++)if(" "===i[h]){s=n[a].replace(t===ie?/~/g:/\^/g,"");for(let e=0;e<s.length;e++)r+=t===ie?o[s[e]]:l[s[e]];a++}else r+=i[h];return r.trim()}function Tt(e){for(let t=0;t<e.annotations.length;t++)Object(r.mb)((e.element.id+"_Annotation_"+t).replace(/[^a-zA-Z0-9]/g,""),"ContentTemplate");Object(r.mb)(e.element.id+"_tooltipparent_template_blazorTemplate","Template"),Object(r.mb)(e.element.id+"_DataLabel")}class jt{constructor(e,t){this.startValues=e,this.endValues=t}}class Dt extends A{constructor(e,t,i,n,s,r,a,o,l){super(e,t,i.width,i.color,n,l),this.y=s.y,this.x=s.x,this.height=s.height,this.width=s.width,this.rx=r||0,this.ry=a||0,this.transform=o||"",this.stroke=0!==i.width&&""!==this.stroke?i.color:"transparent"}}class Mt{constructor(e,t,i,n,s,r,a,o){this.height=e,this.width=t,this.href=i,this.x=n,this.y=s,this.id=r,this.visibility=a,this.preserveAspectRatio=o}}class Ft extends A{constructor(e,t,i,n,s,r,a){super(e,t,i.width,i.color,n),this.cy=r,this.cx=s,this.r=a}}class Pt{constructor(e,t){this.x=e,this.y=t}}class Nt{constructor(e,t,i,n){this.left=e,this.right=t,this.top=i,this.bottom=n}}class Bt{constructor(e,t,i){this.r=e,this.g=t,this.b=i}}class Ht{constructor(e,t,i=0){this.point=e,this.series=t,this.lierIndex=i}}class _t{constructor(e,t,i=0){this.point=e,this.series=t,this.index=i}}function zt(e,t){let i,n="";return Number(t)===e.start?n=e.colors[0]:Number(t)===e.end?n=e.colors[e.colors.length-1]:(i=function(e,t){const i=t.start,n=t.end;let s=0;const r=n-i;let a,o,l;if(s=(e-i)/r,t.colors.length<=2)o="#"===t.colors[0].charAt(0)?t.colors[0]:xt(t.colors[0]),l="#"===t.colors[t.colors.length-1].charAt(0)?t.colors[t.colors.length-1]:xt(t.colors[t.colors.length-1]);else{o="#"===t.colors[0].charAt(0)?t.colors[0]:xt(t.colors[0]),l="#"===t.colors[t.colors.length-1].charAt(0)?t.colors[t.colors.length-1]:xt(t.colors[t.colors.length-1]);const h=r/(t.colors.length-1);let c,d;const p=t.colors.length-1,g=[];let u={};for(let e=1;e<p;e++)d=e*h,c=i+d,u={b:c,color:t.colors[e]},g.push(u);for(let t=0;t<g.length;t++)i<=e&&e<=g[t].b&&0===t?(a="#"===g[t].color.charAt(0)?g[t].color:xt(g[t].color),l=a,s=e<=g[t].b?1-Math.abs((e-g[t].b)/h):(e-g[t].b)/h):g[t].b<=e&&e<=n&&t===g.length-1&&(a="#"===g[t].color.charAt(0)?g[t].color:xt(g[t].color),o=a,s=e<g[t].b?1-Math.abs((e-g[t].b)/h):(e-g[t].b)/h),t!==g.length-1&&t<g.length&&g[t].b<=e&&e<=g[t+1].b&&(a="#"===g[t].color.charAt(0)?g[t].color:xt(g[t].color),o=a,l="#"===g[t+1].color.charAt(0)?g[t+1].color:xt(g[t+1].color),s=Math.abs(e-g[t+1].b)/h)}return function(e,t,i){const n=i.split("#")[1],s=t.split("#")[1],r=Vt(e,parseInt(s.substr(0,2),16),parseInt(n.substr(0,2),16)),a=Vt(e,parseInt(s.substr(2,2),16),parseInt(n.substr(2,2),16)),o=Vt(e,parseInt(s.substr(4,2),16),parseInt(n.substr(4,2),16));return new Bt(r,a,o)}(s,o,l)}(Number(t),e),n=ft(i)),n}function Vt(e,t,i){return Math.round(t+(i-t)*e)}class Ut{constructor(e){this.chart=e,this.padding=5}measureAxis(e){const t=this.chart;this.crossAt(t),this.seriesClipRect=new C(e.x,e.y,e.width,e.height),this.initialClipRect=e,this.leftSize=0,this.rightSize=0,this.topSize=0,this.bottomSize=0,this.measureRowAxis(t,this.initialClipRect),this.initialClipRect=De(this.initialClipRect,new Nt(this.leftSize,this.rightSize,0,0)),this.measureColumnAxis(t,this.initialClipRect),this.initialClipRect=De(this.initialClipRect,new Nt(0,0,this.topSize,this.bottomSize)),this.chart.delayRedraw||this.calculateAxisSize(this.initialClipRect),this.leftSize=0,this.rightSize=0,this.topSize=0,this.bottomSize=0,this.measureRowAxis(t,this.initialClipRect),this.seriesClipRect=De(this.seriesClipRect,new Nt(this.leftSize,this.rightSize,0,0)),this.measureColumnAxis(t,this.initialClipRect),this.seriesClipRect=De(this.seriesClipRect,new Nt(0,0,this.topSize,this.bottomSize)),this.chart.delayRedraw||(t.refreshAxis(),this.calculateAxisSize(this.seriesClipRect))}measureRowAxis(e,t){let i;this.calculateRowSize(t);for(const n of e.rows)i=n,i.nearSizes=[],i.farSizes=[],this.arrangeAxis(i),this.measureDefinition(i,e,new x(e.availableSize.width,i.computedHeight)),this.leftSize<je(i.nearSizes)&&(this.leftSize=je(i.nearSizes)),this.rightSize<je(i.farSizes)&&(this.rightSize=je(i.farSizes))}measureColumnAxis(e,t){let i;this.calculateColumnSize(t);for(const n of e.columns)i=n,i.farSizes=[],i.nearSizes=[],this.arrangeAxis(i),this.measureDefinition(i,e,new x(i.computedWidth,e.availableSize.height)),this.bottomSize<je(i.nearSizes)&&(this.bottomSize=je(i.nearSizes)),this.topSize<je(i.farSizes)&&(this.topSize=je(i.farSizes))}measureDefinition(e,t,i){for(const n of e.axes)n.scrollBarHeight=t.scrollBarModule&&t.zoomModule&&t.zoomSettings.enableScrollbar&&n.enableScrollbarOnZooming&&t.zoomModule.isZoomed&&(n.zoomFactor<1||n.zoomPosition>0)?16:0,n.scrollBarHeight=t.scrollBarModule&&(t.zoomModule&&t.zoomSettings.enableScrollbar&&n.enableScrollbarOnZooming&&t.zoomModule.isZoomed&&(n.zoomFactor<1||n.zoomPosition>0)||n.scrollbarSettings.enable)?16:0,n.getModule(t),n.baseModule.calculateRangeAndInterval(i,n),e.computeSize(n,n.scrollBarHeight);e.farSizes.length>0&&(e.farSizes[e.farSizes.length-1]-=10),e.nearSizes.length>0&&(e.nearSizes[e.nearSizes.length-1]-=10)}calculateAxisSize(e){const t=this.chart;let i,n,s,r,a,o,l,h=0,c=0,d=0;this.calculateRowSize(e);for(let p=0,g=t.rows.length;p<g;p++){i=t.rows[p],h=0,c=0;for(let n=0,o=i.axes.length;n<o;n++){if(r=i.axes[n],l=r.plotOffset,0===r.rect.height){r.rect.height=i.computedHeight,d=0;for(let e=p+1,i=p+r.span;e<i;e++)s=t.rows[e],d+=s.computedHeight;r.rect.y=i.computedTop-d+(r.plotOffsetTop?r.plotOffsetTop:l),r.rect.height=r.rect.height+d-this.getAxisOffsetValue(r.plotOffsetTop,r.plotOffsetBottom,r.plotOffset),r.rect.width=0}r.opposedPosition?(a=e.x+e.width+je(Be(i.farSizes,c)),r.rect.x=r.rect.x>=a?r.rect.x:a,c++):(a=e.x-je(Be(i.nearSizes,h)),r.rect.x=r.rect.x<=a?r.rect.x:a,h++)}}this.calculateColumnSize(e);for(let p=0,g=t.columns.length;p<g;p++){n=t.columns[p],h=0,c=0;for(let i=0,a=n.axes.length;i<a;i++){if(r=n.axes[i],l=r.plotOffset,0===r.rect.width){for(let e=p,i=p+r.span;e<i;e++)s=t.columns[e],r.rect.width+=s.computedWidth;r.rect.x=n.computedLeft+(r.plotOffsetLeft?r.plotOffsetLeft:l),r.rect.width-=this.getAxisOffsetValue(r.plotOffsetLeft,r.plotOffsetRight,r.plotOffset),r.rect.height=0}r.opposedPosition?(o=e.y-je(Be(n.farSizes,c)),r.rect.y=r.rect.y<=o?r.rect.y:o,c++):(o=e.y+e.height+je(Be(n.nearSizes,h)),r.rect.y=r.rect.y>=o?r.rect.y:o,h++)}}}measure(){const e=this.chart;let t,i,n,s,r;for(const a of e.axisCollections)if("Vertical"===a.orientation){e.verticalAxes.push(a),s=this.getActualRow(a),t=e.rows[s],this.pushAxis(t,a),r=s+a.span>e.rows.length?e.rows.length:s+a.span;for(let i=s+1;i<r;i++)n=e.rows[i],n.axes[t.axes.length-1]=a,e.rows[i]=n;e.rows[s]=t}else{e.horizontalAxes.push(a),s=this.getActualColumn(a),i=e.columns[s],this.pushAxis(i,a),r=s+a.span>e.columns.length?e.columns.length:s+a.span;for(let t=s+1;t<r;t++)n=e.columns[t],n.axes[i.axes.length-1]=a,e.columns[t]=n;e.columns[s]=i}}getAxisOffsetValue(e,t,i){return e?e+(t||i):t?t+i:2*i}crossAt(e){for(const t of e.axisCollections)if(null!==t.crossesAt)if(t.crossesInAxis)for(let i=2,n=e.axisCollections.length;i<n;i++)t.crossesInAxis!==e.axisCollections[i].name||(t.crossInAxis=e.axisCollections[i],t.crossAt=this.updateCrossAt(t.crossInAxis,t.crossesAt));else t.crossInAxis=e.requireInvertedAxis?"Horizontal"===t.orientation?e.primaryXAxis:e.primaryYAxis:"Horizontal"===t.orientation?e.primaryYAxis:e.primaryXAxis,t.crossAt=this.updateCrossAt(t.crossInAxis,t.crossesAt)}updateCrossAt(e,t){switch(e.valueType){case"DateTime":const i={skeleton:"full",type:"dateTime"},n=this.chart.intl.getDateParser(i),s=this.chart.intl.getDateFormat(i);return Date.parse(n(s(new Date(a.c.parse.parseJson({val:t}).val))));case"Category":return parseFloat(t)?parseFloat(t):e.labels.indexOf(t);case"Logarithmic":return Re(t,e.logBase);default:return t}}pushAxis(e,t){for(let i=0,n=e.axes.length;i<=n;i++)if(!e.axes[i]){e.axes[i]=t;break}}arrangeAxis(e){const t=[];for(let i=0,n=e.axes.length;i<=n;i++)e.axes[i]&&t.push(e.axes[i]);e.axes=t}getActualColumn(e){const t=this.chart.columns.length,i=e.columnIndex;return i>=t?t-1:i<0?0:i}getActualRow(e){const t=this.chart.rows.length,i=e.rowIndex;return i>=t?t-1:i<0?0:i}calculateRowSize(e){const t=this.chart;let i,n=e.y+e.height,s=0,r=Math.max(0,e.height);for(let a=0,o=t.rows.length;a<o;a++)i=t.rows[a],s=-1!==i.height.indexOf("%")?Math.min(r,e.height*parseInt(i.height,10)/100):Math.min(r,parseInt(i.height,10)),s=a!==o-1?s:r,i.computedHeight=s,n-=s,i.computedTop=n,r-=s}calculateColumnSize(e){const t=this.chart;let i,n=e.x,s=0,r=Math.max(0,e.width);for(let a=0,o=t.columns.length;a<o;a++)i=t.columns[a],s=-1!==i.width.indexOf("%")?Math.min(r,e.width*parseInt(i.width,10)/100):Math.min(r,parseInt(i.width,10)),s=a!==o-1?s:r,i.computedWidth=s,i.computedLeft=n,n+=s,r-=s}renderAxes(){const e=this.chart;let t;const i=e.renderer.createGroup({id:e.element.id+"AxisInsideCollection"}),n=e.renderer.createGroup({id:e.element.id+"AxisOutsideCollection"});let s,r;for(let a=0,o=e.axisCollections.length;a<o;a++)t=e.axisCollections[a],this.element=e.renderer.createGroup({id:e.element.id+"AxisGroup"+a+"Inside"}),s=e.renderer.createGroup({id:e.element.id+"AxisGroup"+a+"Outside"}),r=this.findAxisPosition(t),"Horizontal"===t.orientation?(t.updateCrossValue(),t.visible&&t.internalVisibility&&t.lineStyle.width>0&&this.drawAxisLine(t,a,t.plotOffset,0,r?s:this.element,t.updatedRect),(t.majorGridLines.width>0||t.majorTickLines.width>0)&&this.drawXAxisGridLine(t,a,r||"Inside"===t.tickPosition?s:this.element,t.updatedRect),t.visible&&t.internalVisibility&&(this.drawXAxisLabels(t,a,r||"Inside"===t.labelPosition?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect),this.drawXAxisBorder(t,a,r||"Inside"===t.labelPosition?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect),this.drawXAxisTitle(t,a,r?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect))):(t.updateCrossValue(),t.visible&&t.internalVisibility&&t.lineStyle.width>0&&this.drawAxisLine(t,a,0,t.plotOffset,r?s:this.element,t.updatedRect),(t.majorGridLines.width>0||t.majorTickLines.width>0)&&this.drawYAxisGridLine(t,a,r||"Inside"===t.tickPosition?s:this.element,t.updatedRect),t.visible&&t.internalVisibility&&(this.drawYAxisLabels(t,a,r||"Inside"===t.labelPosition?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect),this.drawYAxisBorder(t,a,r||"Inside"===t.labelPosition?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect),this.drawYAxisTitle(t,a,r?s:this.element,t.placeNextToAxisLine?t.updatedRect:t.rect))),this.chart.enableCanvas||(i.appendChild(this.element),s&&s.childNodes.length>0&&n.appendChild(s)),e.scrollBarModule&&(e.zoomSettings.enableScrollbar&&t.enableScrollbarOnZooming||t.scrollbarSettings.enable)&&this.renderScrollbar(e,t);this.element=e.renderer.createGroup({id:e.element.id+"DefinitionLine"});for(let a=0,o=e.rows.length;a<o;a++){const t=e.rows[a];t.border.color&&this.drawBottomLine(t,a,!0)}for(let a=0,o=e.columns.length;a<o;a++){const t=e.columns[a];t.border.color&&this.drawBottomLine(t,a,!1)}return this.chart.enableCanvas||i.appendChild(this.element),ct(e.enableCanvas,e.svgObject,i,e.redraw),n}renderScrollbar(e,t){(!Object(r.Z)(e.zoomModule)&&e.zoomModule.isZoomed&&(t.zoomFactor<1||t.zoomPosition>0)||t.scrollbarSettings.enable&&(t.zoomFactor<=1||t.zoomPosition>=0))&&(!t.zoomingScrollBar.isScrollUI||e.visibleSeries[0].type.indexOf("Bar")>=0)?(e.scrollElement||(e.scrollElement=wt(e.redraw,e.element.id+"_scrollElement")||Object(r.G)("div",{id:e.element.id+"_scrollElement"})),ct(!1,e.scrollElement,t.zoomingScrollBar.render(!0),!0)):1===t.zoomFactor&&0===t.zoomPosition&&t.zoomingScrollBar.svgObject&&!t.scrollbarSettings.enable&&t.zoomingScrollBar.destroy(),t.zoomingScrollBar.isScrollUI&&(t.zoomingScrollBar.isScrollUI=!1)}findAxisPosition(e){return null!==e.crossAt&&e.isInside(e.crossInAxis.visibleRange)}drawBottomLine(e,t,i){const n=this.chart;let s,r,a,o,l,h={};i?(a=o=(e=e).computedTop+e.computedHeight,s=this.seriesClipRect.x,r=s+this.seriesClipRect.width,l="Row"):(s=r=(e=e).computedLeft,a=this.seriesClipRect.y,o=a+this.seriesClipRect.height,l="Column"),h={id:n.element.id+"_AxisBottom_"+l+t,x1:s,y1:a,x2:r,y2:o,"stroke-width":e.border.width,stroke:e.border.color},this.htmlObject=n.renderer.drawLine(h),this.element.appendChild(this.htmlObject)}drawAxisLine(e,t,i,n,s,r){const a=this.chart;let o={},l=nt(a.element.id+"AxisLine_"+t);const h=l?l.getAttribute("d"):"";l=null,o={id:a.element.id+"AxisLine_"+t,d:"M "+(r.x-i)+" "+(r.y-n)+" L "+(r.x+r.width+i)+" "+(r.y+r.height+n),"stroke-dasharray":e.lineStyle.dashArray,"stroke-width":e.lineStyle.width,stroke:e.lineStyle.color||a.themeStyle.axisLine},this.htmlObject=a.renderer.drawPath(o),ct(a.enableCanvas,s,this.htmlObject,a.redraw,!0,"x","y",null,h)}drawYAxisGridLine(e,t,i,n){const s="Logarithmic"===e.valueType,a=e.valueType.indexOf("Category")>-1;let o,l,h=0,c="",d="";const p=e.opposedPosition?e.majorTickLines.height:-e.majorTickLines.height,g=e.opposedPosition?.5*e.lineStyle.width:.5*-e.lineStyle.width,u="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?.5:0,m=Object(r.Z)(e.crossesAt)?e.opposedPosition?e.scrollBarHeight:-e.scrollBarHeight:0,f="Inside"===e.tickPosition,b=f?n.x-p-g:n.x+p+g+m;let y=e.visibleLabels.length;const x=this.chart.themeStyle;e.valueType.indexOf("Category")>-1&&"BetweenTicks"===e.labelPlacement&&y>0&&(y+=1);const C=e.minorGridLines,v=e.minorTickLines;for(let r=0;r<y;r++)o=e.visibleLabels[r]?e.visibleLabels[r].value-u:e.visibleLabels[r-1].value+e.visibleRange.interval-u,h=He(o,e)*n.height,h=-1*h+(n.y+n.height),h>=n.y&&n.y+n.height>=h&&((ke(o,e.visibleRange)||this.isBorder(e,r,h))&&(c="M "+this.seriesClipRect.x+" "+h+" L "+(this.seriesClipRect.x+this.seriesClipRect.width)+" "+h,this.renderGridLine(e,t,c,e.majorGridLines,"_MajorGridLine_",r,this.element,x.majorGridLine,e.majorGridLines.dashArray)),d="M "+(n.x+g+(f?m:0))+" "+h+" L "+b+" "+h,this.renderGridLine(e,t,d,e.majorTickLines,"_MajorTickLine_",r,i,x.majorTickLine),(C.width>0||v.width>0)&&e.minorTicksPerInterval>0&&(0!==r||!Qe(e)||s||a||this.renderMinorGridOnZooming(e,o,n,r,t,x,i),l=this.drawAxisMinorLine(e,o,n,r),this.renderGridLine(e,t,l[0],C,"_MinorGridLine_",r,this.element,x.minorGridLine,C.dashArray),this.renderGridLine(e,t,l[1],v,"_MinorTickLine_",r,i,x.minorTickLine),r===y-1&&Qe(e)&&s&&!a&&this.renderMinorGridOnZooming(e,o+e.visibleRange.interval,n,r,t,x,i)))}isBorder(e,t,i){const n=this.chart.chartArea.border,s=this.seriesClipRect,r=e.orientation,a="Horizontal"===r?s.x:s.y,o="Horizontal"===r?s.width:s.height;return e.plotOffset>0||(i===a||i===a+o)&&(n.width<=0||"transparent"===n.color)||i!==a&&t===("Horizontal"===r?0:e.visibleLabels.length-1)||i!==a+o&&t===("Horizontal"===r?e.visibleLabels.length-1:0)}drawYAxisLabels(e,t,i,n){const s=this.chart;let a,o,l,h=0,c=0;const d="Inside"===e.labelPosition,p=e.opposedPosition;let g=(e.labelPosition===e.tickPosition?e.majorTickLines.height:0)+e.labelPadding+.5*e.lineStyle.width;g=e.opposedPosition?g:-g;let u=p&&d||!p&&!d?"end":"start";u=s.isRtlEnabled?e.opposedPosition?"end":"start":u;const m=s.renderer.createGroup({id:s.element.id+"AxisLabels"+t}),f=Object(r.Z)(e.crossesAt)?e.scrollBarHeight*(p?1:-1):0;let b,y,x;for(let r=0,C=e.visibleLabels.length;r<C;r++){l=we(e.visibleLabels[r].originalText),h=d?n.x-g:n.x+g+f,a=l?e.visibleLabels[r].breakLabelSize:e.visibleLabels[r].size,c=He(e.visibleLabels[r].value,e)*n.height+(s.stockChart?7:0),c=Math.floor(-1*c+(n.y+n.height)),b=a.height/8*e.visibleLabels[r].text.length/2,y=a.height/4*3+3,c=l?"Inside"===e.labelPosition?c-a.height/2-b+y:c-b:"Inside"===e.labelPosition?c+y:c+a.height/4,x=e.majorGridLines.width>e.majorTickLines.width?e.majorGridLines.width:e.majorTickLines.width,"Far"===e.labelStyle.textAlignment?c=c-x-10:"Near"===e.labelStyle.textAlignment?c=c+x+10:"Center"===e.labelStyle.textAlignment&&(c=c),h=l?this.getAxisLabelXvalue(h,e,a.width):h;const i=l?this.getAnchor(e):u;if(o=new w(s.element.id+t+"_AxisLabel_"+r,h,c,i,e.visibleLabels[r].text),e.edgeLabelPlacement)switch(e.edgeLabelPlacement){case"None":break;case"Hide":((0===r||e.isInversed&&r===C-1)&&o.y>n.y+n.height||(r===C-1||e.isInversed&&0===r)&&o.y-.5*a.height<n.y)&&(o.text="");break;case"Shift":(0===r||e.isInversed&&r===C-1)&&o.y>n.y+n.height?o.y=c=n.y+n.height:(r===C-1||e.isInversed&&0===r)&&o.y-.5*a.height<n.y&&(o.y=c=n.y+.5*a.height)}It(s.renderer,o,e.labelStyle,e.labelStyle.color||s.themeStyle.axisLabel,m,!1,s.redraw,!0,!0,null,null,0,null,s.enableCanvas)}this.chart.enableCanvas||(s.delayRedraw?e.visible&&e.internalVisibility&&this.createZoomingLabel(this.chart,m,e,t,n):ct(s.enableCanvas,i,m,s.redraw))}getAxisLabelXvalue(e,t,i){const n=t.lineBreakAlignment,s="Inside"===t.labelPosition,r=t.opposedPosition;return r&&s||!r&&!s?"Right"===n?e:"Center"===n?e-i/2:e-i:"Left"===n?e:"Center"===n?e+i/2:e+i}drawYAxisBorder(e,t,i,n){if(e.border.width>0){let s,r,a="Outside"===e.labelPosition?e.scrollBarHeight:0;a*=e.opposedPosition?1:-1;const o=n.height/e.visibleRange.delta*("DateTime"===e.valueType?e.dateTimeInterval:e.visibleRange.interval);let l;const h=e.maxLabelSize.width+10+(e.tickPosition===e.labelPosition?e.majorTickLines.height:0);let c="";const d="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?-.5:0,p=e.opposedPosition&&"Inside"===e.labelPosition||!e.opposedPosition&&"Outside"===e.labelPosition?n.x-h+a:n.x+h+a;for(let t=0,i=e.visibleLabels.length;t<i;t++)switch(r=He(e.visibleLabels[t].value+d,e),r=(e.isInversed?1-r:r)*n.height,"Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?(s=-1*r+(n.y+n.height),l=-1*r-o+(n.y+n.height)):(s=-1*r+o/2+(n.y+n.height),l=-1*r-o/2+(n.y+n.height)),e.border.type){case"Rectangle":case"WithoutTopBorder":s>n.y+n.height?c+="M "+p+" "+(n.y+n.height)+" L "+p+" "+l+" ":Math.floor(n.y)>l?c+="M "+(n.x+a)+" "+s+" L "+p+" "+s+" L "+p+" "+n.y+" ":(c+="M "+(n.x+a)+" "+s+" L "+p+" "+s+" L "+p+" "+l+" ",t===e.visibleLabels.length-1&&(c+="M "+(n.x+a)+" "+l+" L "+p+" "+l+" "));break;case"WithoutTopandBottomBorder":s>n.y+n.height||l<Math.floor(n.y)||(c+="M "+(n.x+a)+" "+s+" L "+p+" "+s+" M "+p+" "+l+" L "+(n.x+a)+" "+l)}c+="Rectangle"===e.border.type?"M "+(n.x+a)+" "+n.y+" L "+(n.x+a)+" "+(n.y+n.height)+" ":"",""!==c&&this.createAxisBorderElement(e,t,c,i)}e.multiLevelLabels.length>0&&this.chart.multiLevelLabelModule&&this.chart.multiLevelLabelModule.renderYAxisMultiLevelLabels(e,t,i,n)}drawYAxisTitle(e,t,i,n){if(e.title){const s=this.chart,r=e.opposedPosition?90:-90;let a=("Inside"===e.tickPosition?0:e.majorTickLines.height+e.titlePadding)+("Inside"===e.labelPosition?0:e.maxLabelSize.width+e.multiLevelLabelHeight+this.padding);a=e.opposedPosition?a+e.scrollBarHeight:-a-e.scrollBarHeight;const o=n.x+a,l=n.y+.5*n.height,h=new w(s.element.id+"_AxisTitle_"+t,o,l-e.labelPadding-e.titleSize.height*(e.titleCollection.length-1),"middle",e.titleCollection,"rotate("+r+","+o+","+l+")",null,r),c=It(s.renderer,h,e.titleStyle,e.titleStyle.color||s.themeStyle.axisTitle,i,null,null,null,null,null,null,0,null,s.enableCanvas);c.setAttribute("tabindex",e.tabIndex.toString()),c.setAttribute("aria-label",e.description||e.title)}}drawXAxisGridLine(e,t,i,n){const s="Logarithmic"===e.valueType,a=e.valueType.indexOf("Category")>-1;let o,l,h=0,c="",d="";const p=e.opposedPosition?-e.majorTickLines.height:e.majorTickLines.height,g=e.opposedPosition?.5*-e.lineStyle.width:.5*e.lineStyle.width,u=Object(r.Z)(e.crossesAt)?e.opposedPosition?-e.scrollBarHeight:e.scrollBarHeight:0,m=e.valueType.indexOf("Category")>-1&&"BetweenTicks"===e.labelPlacement?.5:0;let f=e.visibleLabels.length;const b="Inside"===e.tickPosition,y=b?n.y-p-g:n.y+p+g+u,x=this.chart.themeStyle;e.valueType.indexOf("Category")>-1&&f>0&&"BetweenTicks"===e.labelPlacement&&(f+=1);for(let r=0;r<f;r++)o="DateTimeCategory"!==e.valueType?e.visibleLabels[r]?e.visibleLabels[r].value-m:e.visibleLabels[r-1].value+e.visibleRange.interval-m:e.visibleLabels[r]?e.visibleLabels[r].value-m:e.visibleRange.max,h=He(o,e)*n.width+n.x,h>=n.x&&n.x+n.width>=h&&((ke(o,e.visibleRange)||this.isBorder(e,r,h))&&(c="M "+h+" "+(this.seriesClipRect.y+this.seriesClipRect.height)+" L "+h+" "+this.seriesClipRect.y,this.renderGridLine(e,t,c,e.majorGridLines,"_MajorGridLine_",r,this.element,x.majorGridLine,e.majorGridLines.dashArray)),d="M "+h+" "+(n.y+g+(b?u:0))+" L "+h+" "+y,this.renderGridLine(e,t,d,e.majorTickLines,"_MajorTickLine_",r,i,x.majorTickLine),e.minorTicksPerInterval>0&&(e.minorGridLines.width>0||e.minorTickLines.width>0)&&(0!==r||!Qe(e)||s||a||this.renderMinorGridOnZooming(e,o,n,r,t,x,i),l=this.drawAxisMinorLine(e,o,n,r),this.renderGridLine(e,t,l[0],e.minorGridLines,"_MinorGridLine_",r,this.element,x.minorGridLine,e.minorGridLines.dashArray),this.renderGridLine(e,t,l[1],e.minorTickLines,"_MinorTickLine_",r,i,x.minorTickLine),r===f-1&&Qe(e)&&s&&!a&&this.renderMinorGridOnZooming(e,o+e.visibleRange.interval,n,r,t,x,i)))}renderMinorGridOnZooming(e,t,i,n,s,r,a){const o=this.drawAxisMinorLine(e,t,i,n,!0);this.renderGridLine(e,s,o[0],e.minorGridLines,"_MinorGridLine_",-1,this.element,r.minorGridLine,e.minorGridLines.dashArray),this.renderGridLine(e,s,o[1],e.minorTickLines,"_MinorTickLine_",-1,a,r.minorTickLine)}drawAxisMinorLine(e,t,i,n,s){let r=t,a=0,o=0;const l=e.visibleRange,h="Inside"===e.tickPosition,c=[],d=e.opposedPosition?-e.minorTickLines.height:e.minorTickLines.height;let p,g,u=1,m=1;const f=h?i.y-d:i.y+d,b=h?i.x+d:i.x-d;let y="",x="";if("Logarithmic"===e.valueType&&(p=Math.pow(e.logBase,r-l.interval),g=Math.pow(e.logBase,r),u=(g-p)/(e.minorTicksPerInterval+1),m=p+u),"Horizontal"===e.orientation)for(let C=0;C<e.minorTicksPerInterval;C++)r=this.findLogNumeric(e,m,r,n,s),m+=u,ke(r,l)&&(o=(r-l.min)/(l.max-l.min),o=Math.ceil((e.isInversed?1-o:o)*i.width),a=Math.floor(o+i.x),y=y.concat("M "+a+" "+this.seriesClipRect.y+"L "+a+" "+(this.seriesClipRect.y+this.seriesClipRect.height)),a=Math.floor(o+i.x),x=x.concat("M "+a+" "+i.y+"L "+a+" "+(f+e.scrollBarHeight)));else for(let C=0;C<e.minorTicksPerInterval;C++)r=this.findLogNumeric(e,m,r,n,s),ke(r,l)&&(o=(r-l.min)/(l.max-l.min),o=-1*Math.ceil((e.isInversed?1-o:o)*i.height),a=Math.floor(o+i.y+i.height),y=y.concat("M "+this.seriesClipRect.x+" "+a+"L "+(this.seriesClipRect.x+this.seriesClipRect.width)+" "+a+" "),a=Math.floor(o+i.y+i.height),x=x.concat("M "+i.x+" "+a+"L "+(b-e.scrollBarHeight)+" "+a+" ")),m+=u;return c.push(y),c.push(x),c}findLogNumeric(e,t,i,n,s){const r=e.visibleRange;let a;if("Logarithmic"===e.valueType)i=Re(t,e.logBase);else if("DateTime"===e.valueType)a=e.dateTimeInterval/(e.minorTicksPerInterval+1),i=s?i-a:i+a;else if("DateTimeCategory"===e.valueType){const t="BetweenTicks"===e.labelPlacement?.5:0;i+=((e.visibleLabels[n+1]?e.visibleLabels[n+1].value-t:e.visibleRange.max)-(e.visibleLabels[n]?e.visibleLabels[n].value-t:e.visibleRange.min))/(e.minorTicksPerInterval+1)}else a=r.interval/(e.minorTicksPerInterval+1),i=s?i-a:i+a;return i}drawXAxisLabels(e,t,i,n){const s=this.chart;let a=0,o=0;const l=e.labelPadding;let h,c,d,p;const g=s.renderer.createGroup({id:s.element.id+"AxisLabels"+t}),u="Inside"===e.labelPosition,m=e.opposedPosition,f=e.labelPosition===e.tickPosition?e.majorTickLines.height:0;let b=f+l+.5*e.lineStyle.width;const y=e.angle%360,x=0===y||-180===y||180===y;let v,S,I=e.isInversed?n.x+n.width:n.x,O=0;const R=e.visibleLabels.length;let A,k,E;const L=e.scrollbarSettings.enable||!u&&Object(r.Z)(e.crossesAt)&&(e.zoomFactor<1||e.zoomPosition>0)?e.scrollBarHeight:0,T=[];let j=!1;b+=90===y||270===y||-90===y||-270===y?u?5:-5:0;const D=!m&&!u||m&&u,M=D?360>=y&&y>=180||-1>=y&&y>=-180:1<=y&&y<=180||-181>=y&&y>=-360;for(let r=0,F=R;r<F;r++){k=e.visibleLabels[r],E=we(k.originalText),a=He(k.value,e)*n.width+n.x,c=k.size,A=n.width/R,S=E?k.breakLabelSize.width:c.width,O=("Trim"===e.labelIntersectAction||"Wrap"===e.labelIntersectAction)&&0===y&&S>A?A:S,h=c.height/4,a-=E||0!==y?0:O/2,0!==y&&(a-=E?"Left"===e.lineBreakAlignment?k.breakLabelSize.width/2:"Right"===e.lineBreakAlignment?-k.breakLabelSize.width/2:0:-90===y||270===y?-h:90===y||-270===y?h:0),"Far"===e.labelStyle.textAlignment?a=a+O-10:"Near"===e.labelStyle.textAlignment?a=a-O+10:"Center"===e.labelStyle.textAlignment&&(a=a),E&&"Center"!==e.lineBreakAlignment&&0===y&&(a+="Left"===e.lineBreakAlignment?-O/2:O/2);const i=E?x?c.height:k.breakLabelSize.width/2:0;if(b=E?f+l+.5*e.lineStyle.width:b,u&&y?o=E?m?n.y+b+i:n.y-b-i:m?n.y+b+h:n.y-b-h:(d=E?D?b+L+(y?i:3*h):-(b+L+i):D?b+L+(y?1:3)*h:-(b+L+(y?h:k.index>1?2*h:0)),o=n.y+d*k.index),p=E?this.getAnchor(e):s.isRtlEnabled||M?"end":"",v=new w(s.element.id+t+"_AxisLabel_"+r,a,o,p),e.edgeLabelPlacement&&0===y)switch(e.edgeLabelPlacement){case"None":break;case"Hide":if((0===r||e.isInversed&&r===F-1)&&v.x<n.x||(r===F-1||e.isInversed&&0===r)&&v.x+O>n.x+n.width)continue;break;case"Shift":(0===r||e.isInversed&&r===F-1)&&v.x<n.x?(A-=n.x-v.x,v.x=a=n.x):(r===F-1||e.isInversed&&0===r)&&v.x+O>n.x+n.width&&(c.width>A&&"Trim"===e.labelIntersectAction?A-=v.x+O-(n.x+n.width):A=O,v.x=a=n.x+n.width-A)}let P,N;if(v.text=this.getLabelText(k,e,A),E&&0===y?"Right"===e.lineBreakAlignment?(P=v.x-O,N=v.x):"Center"===e.lineBreakAlignment?(P=v.x-O/2,N=v.x+O/2):(P=v.x,N=v.x+O):(P=v.x,N=v.x+O),0!==y||"Hide"!==e.labelIntersectAction||0===r||!(e.isInversed?N>=I:P<=I)){if(I=E?"Right"===e.lineBreakAlignment?e.isInversed?v.x-O:v.x:"Center"===e.lineBreakAlignment?e.isInversed?v.x-O/2:v.x+O/2:e.isInversed?v.x:v.x+O:e.isInversed?v.x:v.x+O,0!==y){let t,i;if(E){let n=0,s=0;t=k.breakLabelSize.height,s=k.breakLabelSize.height-4,"Center"===e.lineBreakAlignment?n=-k.breakLabelSize.width/2:"Right"===e.lineBreakAlignment&&(n=-k.breakLabelSize.width),D&&(s=k.breakLabelSize.height/(v.text.length+1)),i=new C(v.x+n,v.y-s,k.breakLabelSize.width,t)}else t=o-(v.y-(k.size.height/2+10)),i=new C(v.x,v.y-(k.size.height/2-5),k.size.width,t);const n=this.getRectanglePoints(i),s=E?i.x+i.width/2:a,l=E?i.y+i.height/2:o-t/2;v.transform=E?"rotate("+y+","+s+","+l+")":"rotate("+y+","+a+","+o+")",T.push(Pe(n,s,l,y)),j=!1;for(let e=r;e>0;e--)if(T[r]&&T[e-1]&&Ne(T[r],T[e-1])){j=!0,T[r]=null;break}}It(s.renderer,v,k.labelStyle,k.labelStyle.color||s.themeStyle.axisLabel,g,e.opposedPosition!==("Inside"===e.labelPosition),s.redraw,!0,null,null,null,0,j,s.enableCanvas)}}this.chart.enableCanvas||(s.delayRedraw?e.visible&&e.internalVisibility&&this.createZoomingLabel(this.chart,g,e,t,n):i.appendChild(g))}getAnchor(e){return"Center"===e.lineBreakAlignment?"middle":"Left"===e.lineBreakAlignment?"start":"end"}getRectanglePoints(e){return[new Pt(e.x,e.y),new Pt(e.x+e.width,e.y),new Pt(e.x+e.width,e.y+e.height),new Pt(e.x,e.y+e.height)]}getLabelText(e,t,i){if(we(e.originalText)){const n=[];let s;for(let r=0;r<e.text.length;r++)s=this.findAxisLabel(t,e.text[r],i),n.push(s);return n}return this.findAxisLabel(t,e.text,i)}drawXAxisBorder(e,t,i,n){if(e.border.width>0){const s="Outside"===e.labelPosition?e.scrollBarHeight:0;let r;const a=n.y+(e.opposedPosition?-1:1)*s,o=10;let l;const h=n.width/e.visibleRange.delta*("DateTime"===e.valueType?e.dateTimeInterval:e.visibleRange.interval);let c;const d=e.maxLabelSize.height+(e.tickPosition===e.labelPosition?e.majorTickLines.height:0);let p="";const g="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?-.5:0,u=e.opposedPosition&&"Inside"===e.labelPosition||!e.opposedPosition&&"Outside"===e.labelPosition?n.y+d+o+s:n.y-d-o-s;for(let t=0,i=e.visibleLabels.length;t<i;t++)switch(l=He(e.visibleLabels[t].value+g,e),l=(e.isInversed?1-l:l)*n.width,"Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?(r=l+n.x,c=l+h+n.x):(r=l-.5*h+n.x,c=l+.5*h+n.x),e.border.type){case"Rectangle":case"WithoutTopBorder":r<n.x?p+="M "+n.x+" "+u+" L "+c+" "+u+" ":Math.floor(c)>n.width+n.x&&1!==e.visibleLabels.length?p+="M "+r+" "+a+" L "+r+" "+u+" L "+(n.width+n.x)+" "+u+" ":(p+="M "+r+" "+a+" L "+r+" "+u+" L "+c+" "+u+" ",0===t&&(p+="M "+r+" "+a+" L "+r+" "+u+" M "+r+" "+u+" L "+n.x+" "+u),t===e.visibleLabels.length-1&&(p+="M "+c+" "+a+" L "+c+" "+u+" M "+c+" "+u+" L "+(n.width+n.x)+" "+u));break;case"WithoutTopandBottomBorder":r<n.x||Math.floor(c)>n.width+n.x||(p+="M "+r+" "+a+" L "+r+" "+u+" M "+c+" "+a+" L "+c+" "+u)}p+="Rectangle"===e.border.type?"M  "+n.x+" "+a+"L "+(n.x+n.width)+" "+a:"",""!==p&&this.createAxisBorderElement(e,t,p,i)}this.chart.multiLevelLabelModule&&e.multiLevelLabels.length>0&&this.chart.multiLevelLabelModule.renderXAxisMultiLevelLabels(e,t,i,n)}createAxisBorderElement(e,t,i,n){const s=nt(this.chart.element.id+"_BorderLine_"+t),r=s?s.getAttribute("d"):"",a=this.chart.renderer.drawPath(new A(this.chart.element.id+"_BorderLine_"+t,"transparent",e.border.width,e.border.color||this.chart.themeStyle.axisLine,1,"",i));a.setAttribute("style","pointer-events: none"),ct(this.chart.enableCanvas,n,a,this.chart.redraw,!0,"x","y",null,r,!0)}findAxisLabel(e,t,i){return"Trim"===e.labelIntersectAction?e.angle%360!=0||e.enableTrim?t:vt(i,t,e.labelStyle):t}drawXAxisTitle(e,t,i,n){if(e.title){const s=this.chart,a=b(e.title,e.titleStyle),o=Object(r.Z)(e.crossesAt)?e.scrollBarHeight:0;let l=("Inside"===e.tickPosition?0:e.majorTickLines.height+e.titlePadding)+("Inside"===e.labelPosition?0:e.maxLabelSize.height+e.multiLevelLabelHeight+e.labelPadding);const h=e.titleSize.height*(e.titleCollection.length-1);l=e.opposedPosition?-(l+a.height/4+o+h):l+3*a.height/4+o;const c=new w(s.element.id+"_AxisTitle_"+t,n.x+.5*n.width,n.y+l,"middle",e.titleCollection),d=It(s.renderer,c,e.titleStyle,e.titleStyle.color||s.themeStyle.axisTitle,i,null,null,null,null,null,null,0,null,s.enableCanvas);d.setAttribute("aria-label",e.description||e.title),d.setAttribute("tabindex",e.tabIndex.toString())}}renderGridLine(e,t,i,n,s,r,a,o,l=null){const h=this.chart;let c,d;n.width>0&&e.visible&&e.internalVisibility&&i&&(d=nt(h.element.id+s+t+"_"+r),c=d?d.getAttribute("d"):null,d=null,this.htmlObject=h.renderer.drawPath(new A(h.element.id+s+t+"_"+r,"transparent",n.width,n.color||o,null,l,i)),ct(h.enableCanvas,a,this.htmlObject,h.redraw,!0,"x","y",null,c,!0))}findParentNode(e,t,i){return document.getElementById(e+"AxisGroup"+i+"Inside").contains(document.getElementById(t.id))?document.getElementById(e+"AxisGroup"+i+"Inside"):document.getElementById(e+"AxisGroup"+i+"Outside")}createZoomingLabel(e,t,i,n,s){const r=this.findParentNode(e.element.id,t,n);t.setAttribute("opacity","0.3");let a=e.renderer.createGroup({id:e.element.id+"AxisLabels_Zoom"+n});a=function(e,t,i,n,s,r){const a=t.opposedPosition,o=s?"start":"auto";let l;const h=e.availableSize.width;let c,d,p,g;const u=t.scrollbarSettings.enable||t.zoomingScrollBar&&t.zoomingScrollBar.svgObject?t.scrollBarHeight:0;for(let m=0;m<2;m++)l=b(m?t.endLabel:t.startLabel,t.labelStyle),s?(p=m?new Pt(r.x-u,r.y+3):new Pt(t.rect.x-u,r.y+r.height-3),c=r.x+(a?r.width+5+u:-(l.width+5+5+u)),d=r.y+(m?0:r.height-l.height-5),c+=c<0||h<c+l.width+5?a?-l.width/2:l.width/2:0,g=y(3,3,new C(c,d,l.width+5,l.height+5),p,5,!1,!1,!a,p.x,p.y+(m?-3:3))):(p=new Pt(m?r.x+r.width-3:r.x+3,r.y+r.height+u),c=r.x+(m?r.width-l.width-5:0),d=a?r.y-l.height-10-u:r.y+r.height+5+u,g=y(3,3,new C(c,d,l.width+5,l.height+5),p,5,a,!a,!1,p.x+(m?3:-3),p.y)),c+=2.5,d=d+l.height/4*3+2.5,i.appendChild(e.renderer.drawPath(new A(e.element.id+"_Zoom_"+n+"_AxisLabel_Shape_"+m,e.themeStyle.crosshairFill,2,e.themeStyle.crosshairFill,1,null,g))),It(e.renderer,new w(e.element.id+"_Zoom_"+n+"_AxisLabel_"+m,c,d,o,m?t.endLabel:t.startLabel),{color:e.themeStyle.crosshairLabel,fontFamily:"Segoe UI",fontWeight:"Regular",size:"11px"},e.themeStyle.crosshairLabel,i);return i}(e,i,a,n,"Vertical"===i.orientation,s),r.replaceChild(t,document.getElementById(t.id)),nt(e.element.id+"AxisLabels_Zoom"+n)?r.replaceChild(a,document.getElementById(a.id)):r.appendChild(a)}}class qt{constructor(e){this.currentPoints=[],this.previousPoints=[],this.insideRegion=!1,this.chart=e,this.lierIndex=0}getData(){const e=this.chart;let t,i,n,s,r=null,a=null;for(let o=e.visibleSeries.length-1;o>=0;o--){if(a=e.visibleSeries[o],t="Scatter"===a.type||"Scatter"===a.drawType||a.marker.visible?(a.marker.height+5)/2:0,i="Scatter"===a.type||"Scatter"===a.drawType||a.marker.visible?(a.marker.width+5)/2:0,n=e.mouseX,s=e.mouseY,a.dragSettings.enable&&a.isRectSeries)if("Bar"===a.type&&e.isTransposed||!e.isTransposed&&"Bar"!==a.type){const e=a.marker.height/2;s=a.yAxis.isInversed?s-e:s+e}else{const e=a.marker.width/2;n=a.yAxis.isInversed?n+e:n-e}if(a.visible&&Ve(n,s,a.clipRect,t,i)&&(r=this.getRectPoint(a,a.clipRect,n,s)),r)return new Ht(r,a)}return new Ht(r,a)}isSelected(e){return(e.selectionMode.indexOf("Drag")>-1||e.selectionMode.indexOf("Lasso")>-1)&&e.selectionModule&&null!==e.selectionModule.rectPoints}getRectPoint(e,t,i,n){let s,r,a,o,l,h,c=0;if(this.chart.isScrolling)return null;for(const d of e.points)if(d.regionData||d.regions&&d.regions.length){if(d.regionData&&"PolarRadar"===this.chart.chartAreaType&&e.drawType.indexOf("Column")>-1&&(s=i-(e.clipRect.width/2+e.clipRect.x),r=n-(e.clipRect.height/2+e.clipRect.y),c=2*Math.PI*(d.regionData.currentXPosition<0?1+d.regionData.currentXPosition:d.regionData.currentXPosition),a=(Math.atan2(r,s)+.5*Math.PI-c)%(2*Math.PI),a=a<0?2*Math.PI+a:a,a+=2*Math.PI*e.chart.primaryXAxis.startAngle,o=d.regionData.startAngle,o-=c,o=o<0?2*Math.PI+o:o,l=d.regionData.endAngle,l-=c,l=l<0?2*Math.PI+l:l,h=Math.sqrt(Math.pow(Math.abs(s),2)+Math.pow(Math.abs(r),2)),a>=o&&a<=l&&(h>=d.regionData.innerRadius&&h<=d.regionData.radius||h<=d.regionData.innerRadius&&h>=d.regionData.radius)&&h<=e.chart.radius))return d;if((e.dragSettings.enable&&e.isRectSeries||e.isRectSeries&&e.marker.visible)&&this.isPointInThresholdRegion(i,n,d,t,e))return this.insideRegion=!0,d;if(!this.insideRegion&&this.checkRegionContainsPoint(d.regions,t,i,n))return d;if(this.insideRegion&&this.checkRegionContainsPoint(d.regions,t,i,n))return d}return null}checkRegionContainsPoint(e,t,i,n){return e.some((e,s)=>(this.lierIndex=s,Ve(i,n,new C(("Cartesian"===this.chart.chartAreaType?t.x:0)+e.x,("Cartesian"===this.chart.chartAreaType?t.y:0)+e.y,e.width,e.height))))}isPointInThresholdRegion(e,t,i,n,s){const r="Bar"===s.type,a=s.yAxis.isInversed,o=s.chart.isTransposed;let l,h=0,c=0,d=l=20;return a&&o?r?(h=i.regions[0].height-10,l=i.regions[0].width):(c=-10,d=i.regions[0].height):a||i.yValue<0?r?(c=-10,d=i.regions[0].height):(h=i.regions[0].height-10,l=i.regions[0].width):o?r?(h=-10,l=i.regions[0].width):(c=i.regions[0].width-10,d=i.regions[0].height):r?(c=i.regions[0].width-10,d=i.regions[0].height):(h=-10,l=i.regions[0].width),i.regions.some(i=>Ve(e,t,new C(("Cartesian"===this.chart.chartAreaType?n.x:0)+i.x+c,("Cartesian"===this.chart.chartAreaType?n.y:0)+i.y+h,l,d)))}getClosest(e,t,i){let n,s;const r=i||e.xData;if(t>=e.xAxis.visibleRange.min&&t<=e.xAxis.visibleRange.max)for(let a=0;a<r.length;a++)s=r[a],(null==n||Math.abs(s-t)<Math.abs(n-t))&&(n=s);return-1!==e.xData.indexOf(n)?n:null}getClosestX(e,t,i){let n;const s=t.clipRect;n=e.requireInvertedAxis?function(e,t,i){return(i.isInversed?e/t:1-e/t)*i.visibleRange.delta+i.visibleRange.min}(e.mouseY-s.y,s.height,t.xAxis):function(e,t,i){return(i.isInversed?1-e/t:e/t)*i.visibleRange.delta+i.visibleRange.min}(e.mouseX-s.x,s.width,t.xAxis);const r=this.getClosest(t,n,i);for(const a of t.points)if(r===a.xValue&&a.visible)return new Ht(a,t);return null}mergeXvalues(e){let t=[];for(let i=0;i<e.length;i++)t=t.concat(e[i].xData);return t.filter((e,i)=>i===t.indexOf(e))}}var Wt=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let Zt=(()=>{class e extends r.e{}return Wt([Object(r.t)(!1)],e.prototype,"visible",void 0),Wt([Object(r.t)(!0)],e.prototype,"showZero",void 0),Wt([Object(r.t)(null)],e.prototype,"name",void 0),Wt([Object(r.t)("transparent")],e.prototype,"fill",void 0),Wt([Object(r.t)(1)],e.prototype,"opacity",void 0),Wt([Object(r.t)(0)],e.prototype,"angle",void 0),Wt([Object(r.t)(!1)],e.prototype,"enableRotation",void 0),Wt([Object(r.t)("Auto")],e.prototype,"position",void 0),Wt([Object(r.t)(5)],e.prototype,"rx",void 0),Wt([Object(r.t)(5)],e.prototype,"ry",void 0),Wt([Object(r.t)("Center")],e.prototype,"alignment",void 0),Wt([Object(r.g)({width:null,color:null},V)],e.prototype,"border",void 0),Wt([Object(r.g)({left:5,right:5,top:5,bottom:5},W)],e.prototype,"margin",void 0),Wt([Object(r.g)({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},z)],e.prototype,"font",void 0),Wt([Object(r.t)(null)],e.prototype,"template",void 0),Wt([Object(r.t)("Hide")],e.prototype,"labelIntersectAction",void 0),e})(),Gt=(()=>{class e extends r.e{}return Wt([Object(r.t)(!1)],e.prototype,"visible",void 0),Wt([Object(r.t)("Circle")],e.prototype,"shape",void 0),Wt([Object(r.t)("")],e.prototype,"imageUrl",void 0),Wt([Object(r.t)(5)],e.prototype,"height",void 0),Wt([Object(r.t)(5)],e.prototype,"width",void 0),Wt([Object(r.g)({width:2,color:null},V)],e.prototype,"border",void 0),Wt([Object(r.g)({x:0,y:0},U)],e.prototype,"offset",void 0),Wt([Object(r.t)(null)],e.prototype,"fill",void 0),Wt([Object(r.t)(1)],e.prototype,"opacity",void 0),Wt([Object(r.g)({},Zt)],e.prototype,"dataLabel",void 0),e})();class Yt{constructor(){this.symbolLocations=null,this.regions=null,this.percentage=null,this.regionData=null,this.isSelect=!1,this.marker={visible:!1},this.isPointInRange=!0}}let Xt=(()=>{class e extends r.e{constructor(){super(...arguments),this.clipRect=new C(0,0,0,0)}setDataSource(e,t){e&&(this.points=e.points),t.trendLineModule.initDataSource(this),t.visibleSeriesCount++}}return Wt([Object(r.t)("")],e.prototype,"name",void 0),Wt([Object(r.t)("0")],e.prototype,"dashArray",void 0),Wt([Object(r.t)(!0)],e.prototype,"visible",void 0),Wt([Object(r.t)("Linear")],e.prototype,"type",void 0),Wt([Object(r.t)(2)],e.prototype,"period",void 0),Wt([Object(r.t)(2)],e.prototype,"polynomialOrder",void 0),Wt([Object(r.t)(0)],e.prototype,"backwardForecast",void 0),Wt([Object(r.t)(0)],e.prototype,"forwardForecast",void 0),Wt([Object(r.g)({},G)],e.prototype,"animation",void 0),Wt([Object(r.g)({},Gt)],e.prototype,"marker",void 0),Wt([Object(r.t)(!0)],e.prototype,"enableTooltip",void 0),Wt([Object(r.t)(null)],e.prototype,"intercept",void 0),Wt([Object(r.t)("")],e.prototype,"fill",void 0),Wt([Object(r.t)(1)],e.prototype,"width",void 0),Wt([Object(r.t)("SeriesType")],e.prototype,"legendShape",void 0),e})(),$t=(()=>{class e extends r.e{}return Wt([Object(r.t)(1)],e.prototype,"width",void 0),Wt([Object(r.t)(10)],e.prototype,"length",void 0),Wt([Object(r.t)(null)],e.prototype,"color",void 0),Wt([Object(r.t)(1)],e.prototype,"opacity",void 0),e})(),Kt=(()=>{class e extends r.e{}return Wt([Object(r.t)(null)],e.prototype,"value",void 0),Wt([Object(r.t)(null)],e.prototype,"color",void 0),Wt([Object(r.t)("0")],e.prototype,"dashArray",void 0),e})(),Jt=(()=>{class e extends r.e{}return Wt([Object(r.t)(!1)],e.prototype,"visible",void 0),Wt([Object(r.t)("Fixed")],e.prototype,"type",void 0),Wt([Object(r.t)("Both")],e.prototype,"direction",void 0),Wt([Object(r.t)("Vertical")],e.prototype,"mode",void 0),Wt([Object(r.t)(null)],e.prototype,"color",void 0),Wt([Object(r.t)(1)],e.prototype,"verticalError",void 0),Wt([Object(r.t)(1)],e.prototype,"width",void 0),Wt([Object(r.t)(1)],e.prototype,"horizontalError",void 0),Wt([Object(r.t)(3)],e.prototype,"verticalPositiveError",void 0),Wt([Object(r.t)(3)],e.prototype,"verticalNegativeError",void 0),Wt([Object(r.t)(1)],e.prototype,"horizontalPositiveError",void 0),Wt([Object(r.t)(1)],e.prototype,"horizontalNegativeError",void 0),Wt([Object(r.g)(null,$t)],e.prototype,"errorBarCap",void 0),e})(),Qt=(()=>{class e extends r.e{constructor(){super(...arguments),this.currentViewData=[],this.clipRect=new C(0,0,0,0),this.seriesType="XY",this.isRectTypeSeries=!1}processJsonData(){let e=0,t=new Yt;const i=this instanceof ei&&"Histogram"===this.type?"x":this.xName,n=this instanceof ei&&this.marker.dataLabel.name?this.marker.dataLabel.name:"";this instanceof ei&&("Waterfall"!==this.type&&"Histogram"!==this.type||(this.currentViewData=this.chart[qe(this.type)+"SeriesModule"].processInternalData(Object(r.L)([],this.currentViewData,null,!0),this)),"Pareto"===this.category&&(this.currentViewData=function(e,t,i){const n=Object(r.L)([],e,null);return n.sort((e,i)=>{let n=0,s=0;for(let r=0;r<t.length;r++)n+=e[t[r]],s+=i[t[r]];return n>s?-1:n===s?0:1}),n}(Object(r.L)([],this.currentViewData,null,!0),[this.yName]),"Line"===this.type&&(this.currentViewData=this.chart.paretoSeriesModule.performCumulativeCalculation(this.currentViewData,this))),this.isRectTypeSeries=this.type.indexOf("Column")>-1||this.type.indexOf("Bar")>-1||this.type.indexOf("Histogram")>-1);const s=Object.keys(this.currentViewData).length;if(this.points=[],this.xMin=1/0,this.xMax=-1/0,this.yMin=1/0,this.yMax=-1/0,this.sizeMax=-1/0,this.getSeriesType(),"Category"===this.xAxis.valueType)for(;e<s;)t=this.dataPoint(e,n,i),this.pushCategoryData(t,e,t.x),this.pushData(t,e),this.setEmptyPoint(t,e),e++;else if(this.xAxis.valueType.indexOf("DateTime")>-1){const o={skeleton:"full",type:"dateTime"},l=this.chart.intl.getDateParser(o),h=this.chart.intl.getDateFormat(o);for(;e<s;)t=this.dataPoint(e,n,i),Object(r.Z)(t.x)||""===t.x?t.visible=!1:(t.x=new Date(a.c.parse.parseJson({val:t.x}).val),"DateTime"===this.xAxis.valueType?t.xValue=Date.parse(t.x.toString()):this.pushCategoryData(t,e,this.chart.isBlazor?Date.parse(t.x.toString()).toString():Date.parse(l(h(t.x))).toString()),this.pushData(t,e),this.setEmptyPoint(t,e)),e++}else for(;e<s;)t=this.dataPoint(e,n,i),t.xValue=t.x,this.pushData(t,e),this.setEmptyPoint(t,e),e++;if(this instanceof ei)if(this.type.indexOf("Spline")>-1||this.drawType.indexOf("Spline")>-1&&"PolarRadar"===this.chart.chartAreaType){const e=this.type.indexOf("Area")>-1||this.drawType.indexOf("Area")>-1,t=this.type.indexOf("Range")>-1;this.chart["spline"+(e?t?"RangeArea":"Area":"")+"SeriesModule"].findSplinePoint(this)}else this.type.indexOf("Histogram")>-1&&(this.xAxis.maximum||this.xAxis.minimum)&&this.chart.histogramSeriesModule.calculateBinValues(this)}pushData(e,t){e.index=t,e.yValue=e.y,this.xMin=Math.min(this.xMin,e.xValue),this.xMax=Math.max(this.xMax,e.xValue),this.xData.push(e.xValue)}dataPoint(e,t,i){this.points[e]=new Yt;const n=this.points[e],s=this.currentViewData,a=this.enableComplexProperty?r.X:this.getObjectValue;return n.x=a(i,s[e]),n.high=a(this.high,s[e]),n.low=a(this.low,s[e]),n.open=a(this.open,s[e]),n.close=a(this.close,s[e]),n.volume=a(this.volume,s[e]),n.interior=a(this.pointColorMapping,s[e]),this instanceof ei&&(n.y=a(this.yName,s[e]),n.size=a(this.size,s[e]),n.text=a(t,s[e]),n.tooltip=a(this.tooltipMappingName,s[e]),this.chart.rangeColorSettings&&this.chart.rangeColorSettings.length>0&&this.isAdvancedColorSupported()&&(n.colorValue=a(this.colorName&&this.colorName.length>0?this.colorName:this.yName,s[e]),n.interior=this.getPointFillColor(n.interior,n.colorValue))),n}isAdvancedColorSupported(){return 1===this.chart.visibleSeries.length&&("Column"===this.chart.series[0].type||"Bar"===this.chart.series[0].type||"Scatter"===this.chart.series[0].type||"Bubble"===this.chart.series[0].type)}getPointFillColor(e,t){let i=e;if(t&&this.chart.rangeColorSettings&&this.chart.rangeColorSettings.length>0)for(const n of this.chart.rangeColorSettings)t>=n.start&&t<=n.end&&(i=n.colors.length>1?zt(n,t):n.colors[0]);return i}getObjectValue(e,t){return t[e]}setEmptyPoint(e,t){if(!this.findVisibility(e))return e.visible=!0,null;switch(e.isEmpty=!0,this instanceof ei&&e.isPointInRange?this.emptyPointSettings.mode:"Drop"){case"Zero":e.visible=!0,this instanceof ei&&this.seriesType.indexOf("HighLow")>-1?(e.high=e.low=0,this.seriesType.indexOf("HighLowOpenClose")>-1&&(e.open=e.close=0)):e.y=e.yValue=this.yData[t]=0;break;case"Average":this instanceof ei&&(this.seriesType.indexOf("HighLow")>-1?(e.high=Object(r.Z)(e.high)||isNaN(+e.high)?this.getAverage(this.high,t):e.high,e.low=Object(r.Z)(e.low)||isNaN(+e.low)?this.getAverage(this.low,t):e.low,this.seriesType.indexOf("HighLowOpenClose")>-1&&(e.open=Object(r.Z)(e.open)||isNaN(+e.open)?this.getAverage(this.open,t):e.open,e.close=Object(r.Z)(e.close)||isNaN(+e.close)?this.getAverage(this.close,t):e.close)):e.y=e.yValue=this.yData[t]=this.getAverage(this.yName,t)),e.visible=!0;break;case"Drop":case"Gap":this.yData[t]=null,e.visible=!1}}findVisibility(e){let t;const i=this.yAxis.minimum,n=this.yAxis.maximum;switch(this instanceof ei?this.seriesType:"HighLowOpenClose"){case"XY":return"PolarRadar"===this.chart.chartAreaType&&(!Object(r.Z)(i)&&e.yValue<i||!Object(r.Z)(n)&&e.yValue>n)?(e.isPointInRange=!1,!0):(this.setXYMinMax(e.yValue),this.yData.push(e.yValue),this instanceof ei&&"Bubble"===this.type&&(this.sizeMax=Math.max(this.sizeMax,Object(r.Z)(e.size)||isNaN(+e.size)?this.sizeMax:e.size)),Object(r.Z)(e.x)||Object(r.Z)(e.y)||isNaN(+e.y));case"HighLow":return this.setHiloMinMax(e.high,e.low),Object(r.Z)(e.x)||Object(r.Z)(e.low)||isNaN(+e.low)||Object(r.Z)(e.high)||isNaN(+e.high);case"HighLowOpenClose":return this.setHiloMinMax(e.high,e.low),Object(r.Z)(e.x)||Object(r.Z)(e.low)||isNaN(+e.low)||Object(r.Z)(e.open)||isNaN(+e.open)||Object(r.Z)(e.close)||isNaN(+e.close)||Object(r.Z)(e.high)||isNaN(+e.high);case"BoxPlot":return t=(e.y||[null]).filter(e=>!Object(r.Z)(e)&&!isNaN(e)).sort((e,t)=>e-t),e.y=t,this.yMin=Math.min(this.yMin,Math.min(...t)),this.yMax=Math.max(this.yMax,Math.max(...t)),!t.length}}setXYMinMax(e){const t="Logarithmic"===this.yAxis.valueType||"Logarithmic"===this.xAxis.valueType,i=e<0;let n;n=this.isRectTypeSeries&&!Je(this.yAxis)?t||i?e:0:e,this.yMin=t?Math.min(this.yMin,Object(r.Z)(n)||isNaN(n)||0===n?this.yMin:n):Math.min(this.yMin,Object(r.Z)(n)||isNaN(n)?this.yMin:n),this.yMax=Math.max(this.yMax,Object(r.Z)(e)||isNaN(e)?this.yMax:e)}setHiloMinMax(e,t){this.yMin=Math.min(this.yMin,Math.min(Object(r.Z)(t)||isNaN(t)?this.yMin:t,Object(r.Z)(e)||isNaN(e)?this.yMin:e)),this.yMax=Math.max(this.yMax,Math.max(Object(r.Z)(t)||isNaN(t)?this.yMax:t,Object(r.Z)(e)||isNaN(e)?this.yMax:e))}getSeriesType(){let e;if(this instanceof ei){const t="PolarRadar"===this.chart.chartAreaType?this.drawType:this.type;if(t)switch(t){case"RangeColumn":case"RangeArea":case"SplineRangeArea":case"Hilo":e="HighLow";break;case"HiloOpenClose":case"Candle":e="HighLowOpenClose";break;case"BoxAndWhisker":e="BoxPlot";break;default:e="XY"}}this.seriesType=e}pushCategoryData(e,t,i){if(!this.chart.tooltip.shared&&!this.visible)return null;this.xAxis.isIndexed?(this.xAxis.labels[t]?this.xAxis.labels[t]+=", "+i:this.xAxis.labels.push(i),e.xValue=t):(this.xAxis.labels.indexOf(i)<0&&this.xAxis.labels.push(i),e.xValue=this.xAxis.labels.indexOf(i))}getAverage(e,t,i=this.currentViewData){return((i[t-1]&&i[t-1][e]||0)+(i[t+1]&&i[t+1][e]||0))/2}refreshDataManager(e){let t;this.chart=e,t=e.isAngular?Object.keys(this.dataSource).length?this.dataSource:e.dataSource:this.dataSource||e.dataSource,t instanceof a.b||!Object(r.Z)(this.query)?this.dataModule.getData(this.dataModule.generateQuery().requiresCount()).then(e=>this.dataManagerSuccess(e)):this.dataManagerSuccess({result:t,count:t.length},!1)}dataManagerSuccess(e,t=!0){if(this.currentViewData=e.count?e.result:[],this.chart.allowServerDataBinding=!1,this instanceof ei){this.chart.stockChart&&(this.chart.stockChart.series[this.index].localData=this.currentViewData);const e={name:"seriesRender",series:this,data:this.currentViewData,fill:this.interior};this.chart.trigger("seriesRender",e),this.interior=e.fill,this.currentViewData=e.data}!this.chart.stockChart||this instanceof ei||(this.currentViewData=this.chart.stockChart.findCurrentData(this.chart.stockChart.series[0].localData,this.chart.stockChart.series[0].xName)),this.processJsonData(),this.recordsCount=e.count,this.refreshChart(t),this.currentViewData=null}refreshChart(e){const t=this.chart;if(this instanceof ei&&(t.visibleSeriesCount+=e?1:0),t.refreshTechnicalIndicator(this),this instanceof ei&&"TrendLine"!==this.category)for(const i of this.trendlines)i.setDataSource(this,t);t.visibleSeries.length===t.visibleSeriesCount&&(t.refreshBound(),t.trigger("loaded",{chart:t.isBlazor?{}:t}),this.chart.stockChart&&this.chart.stockChart.initialRender&&(this.chart.stockChart.initialRender=!1,this.chart.stockChart.stockChartDataManagerSuccess())),this instanceof ei&&(t.visibleSeriesCount+=e?0:1)}}return Wt([Object(r.t)("")],e.prototype,"xName",void 0),Wt([Object(r.t)("")],e.prototype,"colorName",void 0),Wt([Object(r.t)("")],e.prototype,"high",void 0),Wt([Object(r.t)("")],e.prototype,"low",void 0),Wt([Object(r.t)("")],e.prototype,"open",void 0),Wt([Object(r.t)("")],e.prototype,"close",void 0),Wt([Object(r.t)("")],e.prototype,"volume",void 0),Wt([Object(r.t)("")],e.prototype,"pointColorMapping",void 0),Wt([Object(r.t)(!0)],e.prototype,"visible",void 0),Wt([Object(r.t)(null)],e.prototype,"xAxisName",void 0),Wt([Object(r.t)(null)],e.prototype,"yAxisName",void 0),Wt([Object(r.g)(null,G)],e.prototype,"animation",void 0),Wt([Object(r.t)(null)],e.prototype,"fill",void 0),Wt([Object(r.t)(1)],e.prototype,"width",void 0),Wt([Object(r.t)("0")],e.prototype,"dashArray",void 0),Wt([Object(r.t)("")],e.prototype,"dataSource",void 0),Wt([Object(r.t)()],e.prototype,"query",void 0),Wt([Object(r.f)([],Kt)],e.prototype,"segments",void 0),Wt([Object(r.t)("X")],e.prototype,"segmentAxis",void 0),Wt([Object(r.t)(!1)],e.prototype,"enableComplexProperty",void 0),e})(),ei=(()=>{class e extends Qt{constructor(e,t,i,n){super(e,t,i,n),this.visibleSeriesCount=0,this.category="Series",this.isRectSeries=!1,this.drawPoints=[],this.lowDrawPoints=[],this.delayedAnimation=!1}refreshAxisLabel(){if("Category"!==this.xAxis.valueType)return null;this.xAxis.labels=[];for(const e of this.xAxis.series)if(e.visible&&"TrendLine"!==e.category){e.xMin=1/0,e.xMax=-1/0;for(const t of e.points)e.pushCategoryData(t,t.index,t.x),e.xMin=Math.min(e.xMin,t.xValue),e.xMax=Math.max(e.xMax,t.xValue)}}findSeriesCollection(e,t,i){const n=[];for(const s of t.axes)for(const t of s.series)for(const s of e.axes)for(const e of s.series)e===t&&e.visible&&this.rectSeriesInChart(e,i)&&n.push(e);return n}rectSeriesInChart(e,t){const i=e.type.toLowerCase();return-1!==i.indexOf("column")||-1!==i.indexOf("bar")||-1!==i.indexOf("histogram")||-1!==i.indexOf("hiloopenclose")||-1!==i.indexOf("candle")||-1!==i.indexOf("pareto")||-1!==i.indexOf("hilo")||-1!==e.drawType.indexOf("Column")||-1!==i.indexOf("waterfall")||-1!==i.indexOf("boxandwhisker")||t}calculateStackedValue(e,t){for(const i of t.columns)for(const n of t.rows)this.calculateStackingValues(this.findSeriesCollection(i,n,!0),e)}calculateStackingValues(e,t){let i,n,s=[];const r=[],a=[];let o,l,h,c=[];t&&(c=this.findFrequencies(e));const d=[],p=[];let g=[];for(const u of e)if(-1!==u.type.indexOf("Stacking")||-1!==u.drawType.indexOf("Stacking")&&"PolarRadar"===u.chart.chartAreaType){o=-1!==u.type.indexOf("StackingArea")?"StackingArea100":-1!==u.type.indexOf("StackingLine")?"StackingLine100":u.stackingGroup,r[o]||(r[o]=[],a[o]=[]),s=u.yData,i=[],n=[],d.push(u),g=Ie(u);for(let d=0,u=g.length;d<u;d++)l=0,h=+s[d],void 0===r[o][g[d].xValue]&&(r[o][g[d].xValue]=0),void 0===a[o][g[d].xValue]&&(a[o][g[d].xValue]=0),t?(h=h/c[o][g[d].xValue]*100,h=isNaN(h)?0:h,g[d].percentage=+h.toFixed(2)):p[d]=p[d]?p[d]+Math.abs(h):Math.abs(h),h>=0?(l=r[o][g[d].xValue],r[o][g[d].xValue]+=h):(l=a[o][g[d].xValue],a[o][g[d].xValue]+=h),i.push(l),n.push(h+l),t&&n[d]>100&&(n[d]=100);u.stackedValues=new jt(i,n);let e="Logarithmic"===u.yAxis.valueType,m=-1!==u.type.indexOf("Column")||-1!==u.type.indexOf("Bar");u.yMin=e&&m&&u.yMin<1?u.yMin:Math.min.apply(0,i),u.yMax=Math.max.apply(0,n),u.yMin>Math.min.apply(0,n)&&(u.yMin=t?-100:e&&m&&u.yMin<1?u.yMin:Math.min.apply(0,n)),u.yMax<Math.max.apply(0,i)&&(u.yMax=0)}this.findPercentageOfStacking(d,p,t)}findPercentageOfStacking(e,t,i){for(const n of e){if(i)return null;for(const e of Ie(n))e.percentage=Math.abs(+(e.y/t[e.index]*100).toFixed(2))}}findFrequencies(e){const t=[];let i,n=[];for(const s of e)if(s.yAxis.isStack100=-1!==s.type.indexOf("100"),n=Ie(s),-1!==s.type.indexOf("Stacking")){i=-1!==s.type.indexOf("StackingArea")?"StackingArea100":-1!==s.type.indexOf("StackingLine")?"StackingLine100":s.stackingGroup,t[i]||(t[i]=[]);for(let e=0,r=n.length;e<r;e++)void 0===t[i][n[e].xValue]&&(t[i][n[e].xValue]=0),s.yData[e]>0?t[i][n[e].xValue]+=s.yData[e]:t[i][n[e].xValue]-=s.yData[e]}return t}renderSeries(e){let t=qe(this.type);t=t.replace("100",""),e[t+"SeriesModule"]&&("Indicator"!==this.category&&"TrendLine"!==this.category&&this.createSeriesElements(e),this.visiblePoints=Ie(this),e[t+"SeriesModule"].render(this,this.xAxis,this.yAxis,e.requireInvertedAxis),"Indicator"!==this.category&&(this.errorBar.visible&&this.chart.errorBarModule.render(this),this.marker.dataLabel.visible&&e.dataLabelModule.render(this,this.chart,this.marker.dataLabel),this.appendSeriesElement(e.seriesElements,e)),this.chart.enableCanvas||this.performAnimation(e,t,this.errorBar,this.marker,this.marker.dataLabel))}createSeriesElements(e){if("Indicator"!==this.category){const t=e.element.id,i=this.marker.border.width+8+5,n="Scatter"===this.type||"Bubble"===this.type?e.svgRenderer:e.renderer,s=void 0===this.index?this.category:this.index;let r,a,o;if("Scatter"===this.type?(r=e.primaryYAxis.maximum||e.primaryXAxis.maximum?0:(this.marker.height+i)/2,a=e.primaryYAxis.maximum||e.primaryXAxis.maximum?0:(this.marker.width+i)/2):(r=0,a=0),"PolarRadar"===e.chartAreaType){const i="Scatter"===this.drawType?Math.max(this.marker.width,this.marker.height):0;o=new Ft(t+"_ChartSeriesClipRect_"+s,"transparent",{width:1,color:"Gray"},1,this.clipRect.width/2+this.clipRect.x,this.clipRect.height/2+this.clipRect.y,e.radius+i),this.clipRectElement=$e(e.redraw,o,n,"drawCircularClipPath")}else o=new Dt(t+"_ChartSeriesClipRect_"+s,"transparent",{width:1,color:"Gray"},1,{x:-a,y:-r,width:this.clipRect.width+2*a,height:this.clipRect.height+2*r}),this.clipRectElement=$e(e.redraw,o,n);const l="Cartesian"===e.chartAreaType?"translate("+this.clipRect.x+","+this.clipRect.y+")":"";this.symbolElement=null,this.seriesElement=n.createGroup({id:t+"SeriesGroup"+s,transform:l,"clip-path":"url(#"+t+"_ChartSeriesClipRect_"+s+")"}),this.chart.enableCanvas&&"Scatter"!==this.type&&"Bubble"!==this.type||this.seriesElement.appendChild(this.clipRectElement)}}appendSeriesElement(e,t){const i=this.marker,n=i.dataLabel,s=t.redraw;"TrendLine"!==this.category&&(ct(t.enableCanvas,t.seriesElements,this.seriesElement,s),this.errorBar.visible&&ct(t.enableCanvas,t.seriesElements,"PolarRadar"===t.chartAreaType?this.seriesElement:this.errorBarElement,s),"Scatter"!==this.type&&"Bubble"!==this.type||ct(!1,t.seriesElements,this.seriesElement,s)),i.visible&&("Cartesian"===t.chartAreaType||"Scatter"!==this.drawType&&"PolarRadar"===t.chartAreaType)&&"Scatter"!==this.type&&"Bubble"!==this.type&&"Candle"!==this.type&&"Hilo"!==this.type&&"HiloOpenClose"!==this.type&&this.symbolElement&&ct(t.enableCanvas,t.seriesElements,this.symbolElement,s),n.visible&&this.textElement&&(ct(t.enableCanvas,t.dataLabelElements,this.shapeElement,s),ct(t.enableCanvas,t.dataLabelElements,this.textElement,s)),!t.enableCanvas&&t.dataLabelElements.hasChildNodes()&&t.seriesElements.appendChild(t.dataLabelElements)}performAnimation(e,t,i,n,s){this.animation.enable&&e.animateSeries&&(e[t+"SeriesModule"].doAnimation(this),i.visible&&e.errorBarModule.doErrorBarAnimation(this),n.visible&&e.markerRender.doMarkerAnimation(this),s.visible&&"edge"!==r.d.info.name&&!r.d.isIE&&e.dataLabelModule.doDataLabelAnimation(this))}setPointColor(e,t){return t=e.interior||t,e.isEmpty&&this.emptyPointSettings.fill||t}setBorderColor(e,t){return t.width=e.isEmpty&&this.emptyPointSettings.border.width||t.width,t.color=e.isEmpty&&this.emptyPointSettings.border.color||t.color,t}}return Wt([Object(r.t)("")],e.prototype,"name",void 0),Wt([Object(r.t)("")],e.prototype,"yName",void 0),Wt([Object(r.t)("Line")],e.prototype,"drawType",void 0),Wt([Object(r.t)(!0)],e.prototype,"isClosed",void 0),Wt([Object(r.t)("#2ecd71")],e.prototype,"bearFillColor",void 0),Wt([Object(r.t)("#e74c3d")],e.prototype,"bullFillColor",void 0),Wt([Object(r.t)(!1)],e.prototype,"enableSolidCandles",void 0),Wt([Object(r.t)("")],e.prototype,"size",void 0),Wt([Object(r.t)(null)],e.prototype,"binInterval",void 0),Wt([Object(r.t)(!1)],e.prototype,"showNormalDistribution",void 0),Wt([Object(r.t)("")],e.prototype,"stackingGroup",void 0),Wt([Object(r.g)({color:"transparent",width:0},V)],e.prototype,"border",void 0),Wt([Object(r.t)(1)],e.prototype,"opacity",void 0),Wt([Object(r.t)(0)],e.prototype,"zOrder",void 0),Wt([Object(r.t)("Line")],e.prototype,"type",void 0),Wt([Object(r.g)(null,Jt)],e.prototype,"errorBar",void 0),Wt([Object(r.g)(null,Gt)],e.prototype,"marker",void 0),Wt([Object(r.g)({},J)],e.prototype,"dragSettings",void 0),Wt([Object(r.f)([],Xt)],e.prototype,"trendlines",void 0),Wt([Object(r.t)(!0)],e.prototype,"enableTooltip",void 0),Wt([Object(r.t)("")],e.prototype,"tooltipFormat",void 0),Wt([Object(r.t)("")],e.prototype,"tooltipMappingName",void 0),Wt([Object(r.t)("SeriesType")],e.prototype,"legendShape",void 0),Wt([Object(r.t)("")],e.prototype,"legendImageUrl",void 0),Wt([Object(r.t)(null)],e.prototype,"selectionStyle",void 0),Wt([Object(r.t)(null)],e.prototype,"unSelectedStyle",void 0),Wt([Object(r.t)(null)],e.prototype,"nonHighlightStyle",void 0),Wt([Object(r.t)(1)],e.prototype,"minRadius",void 0),Wt([Object(r.t)(3)],e.prototype,"maxRadius",void 0),Wt([Object(r.t)("Natural")],e.prototype,"splineType",void 0),Wt([Object(r.t)(.5)],e.prototype,"cardinalSplineTension",void 0),Wt([Object(r.g)(null,K)],e.prototype,"emptyPointSettings",void 0),Wt([Object(r.t)(!0)],e.prototype,"showMean",void 0),Wt([Object(r.t)("Normal")],e.prototype,"boxPlotMode",void 0),Wt([Object(r.t)(null)],e.prototype,"columnWidth",void 0),Wt([Object(r.t)(0)],e.prototype,"columnSpacing",void 0),Wt([Object(r.t)("#C64E4A")],e.prototype,"negativeFillColor",void 0),Wt([Object(r.t)("#4E81BC")],e.prototype,"summaryFillColor",void 0),Wt([Object(r.t)()],e.prototype,"intermediateSumIndexes",void 0),Wt([Object(r.t)()],e.prototype,"sumIndexes",void 0),Wt([Object(r.g)({color:"black",width:2},_)],e.prototype,"connector",void 0),Wt([Object(r.g)(null,X)],e.prototype,"cornerRadius",void 0),e})();class ti{constructor(e,t){this.initDataManager(e,t)}initDataManager(e,t){this.dataManager=e instanceof a.b?e:new a.b(e),this.query=t instanceof a.h?t:new a.h}generateQuery(){return this.query.clone()}getData(e){if(this.dataManager.ready){const t=new a.d;return this.dataManager.ready.then(()=>{this.dataManager.executeQuery(e).then(e=>{t.resolve(e)})}).catch(e=>{t.reject(e)}),t.promise}return this.dataManager.executeQuery(e)}}class ii extends qt{constructor(e){super(e),this.elementId=e.element.id}addEventListener(){this.chart.isDestroyed||(this.chart.on(r.d.touchMoveEvent,this.mouseMoveHandler,this),this.chart.on(r.d.touchEndEvent,this.mouseUpHandler,this))}removeEventListener(){this.chart.isDestroyed||(this.chart.off(r.d.touchMoveEvent,this.mouseMoveHandler),this.chart.off(r.d.touchEndEvent,this.mouseUpHandler))}mouseUpHandler(){const e=this.chart;!e.isTouch||e.crosshair.enable||this.isSelected(e)||this.markerMove(!0)}mouseMoveHandler(){const e=this.chart;e.crosshair.enable&&!e.tooltip.enable||e.isTouch&&!e.startMove||this.isSelected(e)||this.markerMove(!1)}markerMove(e){const t=this.chart;let i,n,s,a;if(this.currentPoints=[],t.tooltip.shared&&t.tooltip.enable){if(!Ve(t.mouseX,t.mouseY,t.chartAxisLayoutPanel.seriesClipRect))return null;if(t.tooltip.enable){const e="PolarRadar"===t.chartAreaType?this.getData():null,n=this.mergeXvalues(this.chart.visibleSeries);for(const s of t.visibleSeries)s.enableTooltip&&"Indicator"!==s.category&&("Cartesian"===t.chartAreaType&&s.visible?i=this.getClosestX(t,s,n):"PolarRadar"===t.chartAreaType&&s.visible&&null!==e.point&&(i=new Ht(s.points[e.point.index],s)),i&&(this.currentPoints.push(i),i=null))}}else i=this.getData(),a=i.series,n=this.previousPoints[0],s=a&&("Bubble"===a.type||"Scatter"===a.drawType||"Scatter"===a.type||"Candle"!==a.type&&"Hilo"!==a.type&&"HiloOpenClose"!==a.type&&a.marker.visible&&0!==a.marker.width&&0!==a.marker.height),i.lierIndex=this.lierIndex,i.point&&s&&(!n||n.point!==i.point||n&&n.lierIndex>3&&n.lierIndex!==this.lierIndex)&&this.currentPoints.push(i),i.point&&s&&t.isPointMouseDown&&this.currentPoints.push(i);const o=this.previousPoints.length;if(this.currentPoints.length>0&&(0===o||t.isPointMouseDown||o>0&&this.previousPoints[0].point!==this.currentPoints[0].point)){this.previousPoints.length>0&&this.removeHighlightedMarker();for(const e of this.currentPoints)(e&&e.point||"Candle"!==a.type&&"Hilo"!==a.type&&"HiloOpenClose"!==a.type)&&(pt(this.markerExplode),this.isRemove=!0,e.point.symbolLocations.map((t,i)=>{e.series.isRectSeries&&!e.point.marker.visible||this.drawTrackBall(e.series,e.point,t,i)}));this.previousPoints=Object(r.L)([],this.currentPoints,null,!0)}t.tooltip.enable||!(0===this.currentPoints.length&&this.isRemove||e&&this.isRemove)&&Ve(t.mouseX,t.mouseY,t.chartAxisLayoutPanel.seriesClipRect)||(this.isRemove=!1,this.markerExplode=+setTimeout(()=>{this.removeHighlightedMarker()},2e3)),this.currentPoints=[]}drawTrackBall(e,t,i,n){const s=t.marker,a=e.marker,o=s.shape||a.shape;if("None"===o)return null;const l=e.symbolElement||e.seriesElement;let h;this.chart.highlightModule&&"None"!==this.chart.highlightMode&&(h=this.chart.highlightModule.generateStyle(e)),this.chart.selectionModule&&"None"!==this.chart.selectionMode&&(h=this.chart.selectionModule.generateStyle(e));const c=this.elementId+"_Series_"+e.index+"_Point_"+t.index+"_Trackball"+(n||""),d=new x((s.width||a.width)+5,(s.height||a.height)+5),p=s.border||e.border,g="BoxAndWhisker"===e.type||"Bubble"===e.type||"Scatter"===e.type,u=p.color&&"transparent"!==p.color?p.color:s.fill||t.interior||(g?t.color:e.interior),m=yt(xt(u)),f=s.border?s.border.width:a.border.width,b=e.chart.themeStyle.markerShadow||"rgba("+m.r+","+m.g+","+m.b+",0.2)";for(let y=0;y<2;y++){const n=new A(c+"_"+y,y?s.fill||t.color||(g?e.interior:"#ffffff"):"transparent",f+(y?0:8),y?u:b,s.opacity||a.opacity,null,null),p=it(i,o,d,s.imageUrl,n,0,this.chart.svgRenderer,e.clipRect);p.setAttribute("class","EJ2-Trackball");const m=-1!==l.id.indexOf("Symbol")?"_Symbol":"",x=document.getElementById(this.elementId+"_Series_"+e.index+"_Point_"+t.index+m);""===h||Object(r.Z)(h)||Object(r.Z)(x)||!x.hasAttribute("class")||h!==x.getAttribute("class")||p.classList.add(h),p.setAttribute("clip-path",l.getAttribute("clip-path")),p.setAttribute("transform",l.getAttribute("transform")),this.chart.svgObject.appendChild(p)}}removeHighlightedMarker(){const e=document.getElementsByClassName("EJ2-Trackball");for(let t=0,i=e.length;t<i;t++)Object(r.kb)(e[0]);this.previousPoints=[]}}class ni extends ii{constructor(e){super(e),this.addEventListener()}render(e){const t=e.chart.redraw;this.createElement(e,t);for(const i of e.points)i.visible&&i.symbolLocations&&i.symbolLocations.length&&i.symbolLocations.map((n,s)=>{"None"!==e.marker.shape&&this.renderMarker(e,i,n,s,t)})}renderMarker(e,t,i,n,s){const a=void 0===e.index?e.category:e.index,o=e.marker,l={color:o.border.color,width:o.border.width},h=o.border.color;let c,d,p,g;i.x=i.x+o.offset.x,i.y=i.y-o.offset.y;const u="BoxAndWhisker"===e.type,m=o.fill||(u?t.interior||e.interior:"#ffffff");let f;const b=u?function(e,t){let i;for(let n=0,s=e.length;n<s;n++)e[n].id.indexOf(t)>-1&&(i=e[n]);return i}(e.seriesElement.childNodes,"Series_"+e.index+"_Point_"+t.index):e.symbolElement;l.color=h||e.setPointColor(t,e.interior);const y=this.elementId+"_Series_"+a+"_Point_"+t.index+"_Symbol"+(n||""),C={cancel:!1,name:"pointRender",series:e,point:t,fill:t.isEmpty&&e.emptyPointSettings.fill||m,border:{color:"BoxAndWhisker"===e.type?Object(r.Z)(h)||"transparent"===h?Ct(m,-.6):h:l.color,width:l.width},height:o.height,width:o.width,shape:o.shape};if(C.border=e.setBorderColor(t,{width:C.border.width,color:C.border.color}),e.isRectSeries&&"BoxAndWhisker"!==e.type||(this.chart.trigger("pointRender",C),t.color=C.fill),t.color=C.fill,C.cancel)i=null,t.marker={visible:!1};else{let a;a="RangeArea"===e.type||"RangeColumn"===e.type||"RangeColumn"===e.drawType||"SplineRangeArea"===e.type?n?t.low:t.high:u?t.outliers[n]:t.y;const l=C.point.marker.fill||C.fill;let h;h=Object(r.Z)(C.point.marker.border)?{color:C.border.color,width:C.border.width}:{color:C.point.marker.border.color||C.border.color,width:C.point.marker.border.width||C.border.width};const m=C.point.marker.width||C.width,v=C.point.marker.height||C.height,S=C.point.marker.shape||C.shape,w=C.point.marker.imageUrl||o.imageUrl;g=new A(y,l,h.width,h.color,C.point.marker.opacity||o.opacity,null),(null!=b||this.chart.enableCanvas)&&(s&&nt(g.id)&&(f=nt(g.id),p="Circle"===S?"c":"",c={x:+f.getAttribute(p+"x"),y:+f.getAttribute(p+"y")},d=f.getAttribute("d")),f=it(i,S,new x(m,v),w,g,(t.x.toString(),a.toString()),this.chart.renderer,e.clipRect),ct(this.chart.enableCanvas,b,f,s,!0,p+"x",p+"y",c,d,!1,!1,null,e.chart.duration)),t.marker={border:h,fill:l,height:v,visible:!0,shape:S,width:m,imageUrl:w}}}createElement(e,t){let i;const n=e.marker,s=n.border.width+8+5,r=e.chart.svgRenderer,a=void 0===e.index?e.category:e.index;let o;const l="Cartesian"===e.chart.chartAreaType?"translate("+e.clipRect.x+","+e.clipRect.y+")":"";if(n.visible){const h=(n.height+s)/2,c=(n.width+s)/2;"Cartesian"===e.chart.chartAreaType?(o=new Dt(this.elementId+"_ChartMarkerClipRect_"+a,"transparent",{width:1,color:"Gray"},1,{x:-c,y:-h,width:e.clipRect.width+2*c,height:e.clipRect.height+2*h}),i=$e(t,o,r)):(o=new Ft(this.elementId+"_ChartMarkerClipRect_"+a,"transparent",{width:1,color:"Gray"},1,e.clipRect.width/2+e.clipRect.x,e.clipRect.height/2+e.clipRect.y,e.chart.radius+Math.max(h,c)),i=$e(t,o,r,"drawCircularClipPath")),o={id:this.elementId+"SymbolGroup"+a,transform:l,"clip-path":"url(#"+this.elementId+"_ChartMarkerClipRect_"+a+")"},e.symbolElement=r.createGroup(o),e.symbolElement.appendChild(i),this.chart.enableCanvas&&document.getElementById(this.chart.element.id+"_tooltip_svg").appendChild(e.symbolElement)}}getRangeLowPoint(e,t){let i=e.x,n=e.y;return t.chart.requireInvertedAxis?(n+=e.height/2,i+=t.yAxis.isInversed?e.width:0):(n+=t.yAxis.isInversed?0:e.height,i+=e.width/2),{x:i,y:n}}doMarkerAnimation(e){if("Scatter"!==e.type&&"Bubble"!==e.type&&"Candle"!==e.type&&"Hilo"!==e.type&&"HiloOpenClose"!==e.type&&("PolarRadar"!==e.chart.chartAreaType||"Scatter"!==e.drawType)){const t=e.symbolElement.childNodes,i=e.animation.delay+e.animation.duration,n=e.chart.animated?e.chart.duration:200;let s=1;const r="RangeArea"===e.type||"RangeColumn"===e.type||"SplineRangeArea"===e.type?2:1;for(let a=0;a<e.points.length;a++)if(e.points[a].symbolLocations){if(!e.points[a].symbolLocations.length||!t[s])continue;if(Ye(t[s],i,n,e,a,e.points[a].symbolLocations[0],!1),2===r){const r=this.getRangeLowPoint(e.points[a].regions[0],e);Ye(t[s+1],i,n,e,a,r,!1)}s+=r}}}}var si=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ri=(()=>{class e extends r.e{}return si([Object(r.t)(0)],e.prototype,"x",void 0),si([Object(r.t)(0)],e.prototype,"y",void 0),e})(),ai=(()=>{class e extends r.e{}return si([Object(r.t)(!0)],e.prototype,"visible",void 0),si([Object(r.t)(null)],e.prototype,"height",void 0),si([Object(r.t)(null)],e.prototype,"width",void 0),si([Object(r.g)({x:0,y:0},ri)],e.prototype,"location",void 0),si([Object(r.t)("Auto")],e.prototype,"position",void 0),si([Object(r.t)("Series")],e.prototype,"mode",void 0),si([Object(r.t)(8)],e.prototype,"padding",void 0),si([Object(r.t)("Center")],e.prototype,"alignment",void 0),si([Object(r.g)(F.legendLabelFont,z)],e.prototype,"textStyle",void 0),si([Object(r.t)(10)],e.prototype,"shapeHeight",void 0),si([Object(r.t)(10)],e.prototype,"shapeWidth",void 0),si([Object(r.g)({},V)],e.prototype,"border",void 0),si([Object(r.g)({left:0,right:0,top:0,bottom:0},W)],e.prototype,"margin",void 0),si([Object(r.g)({left:0,right:0,top:0,bottom:0},Z)],e.prototype,"containerPadding",void 0),si([Object(r.t)(5)],e.prototype,"shapePadding",void 0),si([Object(r.t)("transparent")],e.prototype,"background",void 0),si([Object(r.t)(1)],e.prototype,"opacity",void 0),si([Object(r.t)(!0)],e.prototype,"toggleVisibility",void 0),si([Object(r.t)(null)],e.prototype,"description",void 0),si([Object(r.t)(3)],e.prototype,"tabIndex",void 0),si([Object(r.t)(null)],e.prototype,"title",void 0),si([Object(r.g)(F.legendTitleFont,z)],e.prototype,"titleStyle",void 0),si([Object(r.t)("Top")],e.prototype,"titlePosition",void 0),si([Object(r.t)(100)],e.prototype,"maximumTitleWidth",void 0),si([Object(r.t)(!0)],e.prototype,"enablePages",void 0),si([Object(r.t)(!1)],e.prototype,"isInversed",void 0),e})();class oi{constructor(e){this.pageXCollections=[],this.legendTitleCollections=[],this.legendRegions=[],this.pagingRegions=[],this.chart=e,this.legend=e.legendSettings,this.legendID=e.element.id+"_chart_legend",this.isChartControl="chart"===e.getModuleName(),this.isBulletChartControl="bulletChart"===e.getModuleName(),this.isStockChartControl="stockChart"===e.getModuleName(),this.bulletChart=this.chart,this.fivePixel=5,this.rowCount=0,this.pageButtonSize=8,this.maxColumns=0,this.maxWidth=0,this.currentPage=1,this.backwardArrowOpacity=0,this.forwardArrowOpacity=1,this.arrowWidth=2*(this.fivePixel+this.pageButtonSize+this.fivePixel),this.arrowHeight=this.arrowWidth,this.isTop=!1,this.isTitle=!1,this.currentPageNumber=1}calculateLegendBounds(e,t,i){const n=this.legend,s=this.isBulletChartControl?"40%":"20%";this.getPosition(n.position,t),this.legendBounds=new C(e.x,e.y,0,0),this.isVertical="Left"===this.position||"Right"===this.position,this.isVertical?(this.legendBounds.height=St(n.height,t.height-(e.y-this.chart.margin.top))||e.height,this.legendBounds.width=St(n.width||s,t.width)):(this.legendBounds.width=St(n.width,t.width)||e.width,this.legendBounds.height=St(n.height||s,t.height)),this.library.getLegendBounds(t,this.legendBounds,n),this.isBulletChartControl||(this.legendBounds.width+=this.legend.containerPadding.left+this.legend.containerPadding.right,this.legendBounds.height+=this.legend.containerPadding.top+this.legend.containerPadding.bottom),this.getLocation(this.position,n.alignment,this.legendBounds,e,t,i)}getPosition(e,t){const i=this.chart,n=this.chart;this.isChartControl||this.isBulletChartControl||this.isStockChartControl?this.position="Auto"!==e?e:"Bottom":("Auto"===e&&((i||n).visibleSeries&&"Funnel"===(i||n).visibleSeries[0].type||"Pyramid"===(i||n).visibleSeries[0].type)&&(e="Top"),this.position="Auto"!==e?e:t.width>t.height?"Right":"Bottom")}setBounds(e,t,i,n){let s=i.title&&"Top"===i.titlePosition?this.legendTitleSize.height+this.fivePixel:0;this.isVertical&&this.isPaging&&!i.enablePages&&!this.isBulletChartControl&&(s=i.title&&"Top"===i.titlePosition?this.legendTitleSize.height+this.fivePixel:0,s+=this.pageButtonSize+this.fivePixel),e=Math.min(e,n.width),t=Math.min(t,n.height),"Gradient"===i.mode?(n.width=i.width?n.width:this.isVertical?e:.75*n.width,n.height=i.height?n.height:this.isVertical?.75*n.height:t):(n.width=i.width?n.width:e,n.height=i.height?n.height:t),this.isBulletChartControl||this.isTop&&"None"!==i.titleStyle.textOverflow&&(this.calculateLegendTitle(i,n),n.height+="Wrap"===i.titleStyle.textOverflow&&this.legendTitleCollections.length>1?this.legendTitleSize.height-this.legendTitleSize.height/this.legendTitleCollections.length:0),this.rowCount=Math.max(1,Math.ceil((n.height-i.padding-s)/(this.maxItemHeight+i.padding)))}getLocation(e,t,i,n,s,r){const a=this.legend.border.width,o=this.isBulletChartControl,l=this.bulletChart,h="Inside"===l.labelPosition,c="Inside"===l.tickPosition,d="Vertical"===l.orientation,p=o&&""!==l.categoryField?r.width+this.chart.border.width+3*a:0,g=this.chart.margin.bottom;let u=i.height+a+this.legend.margin.top+this.legend.margin.bottom,m=i.width+a+this.legend.margin.left+this.legend.margin.right;"Bottom"===e?(i.x=this.alignLegend(i.x,s.width,i.width,t),i.y=n.y+(n.height-u)+a+this.legend.margin.top,i.y+=!o||l.opposedPosition||h||c||d?d&&""!==l.categoryField?r.height+2*a:0:l.majorTickLines.height+g+this.legend.border.width+2*a,De(n,new Nt(0,0,0,u))):"Top"===e?(i.x=this.alignLegend(i.x,s.width,i.width,t),i.y=n.y+a+this.legend.margin.top,i.y-=!o||!l.opposedPosition||h||c||d?0:l.majorTickLines.height+this.chart.margin.top,u-=o?2*-a:0,De(n,new Nt(0,0,u,0))):"Right"===e?(i.x=n.x+(n.width-i.width)-this.legend.margin.right,i.y=n.y+this.alignLegend(0,s.height-(n.y+g),i.height,t),m+=o&&l.opposedPosition&&!h&&!c&&d?this.chart.margin.left+this.chart.margin.right+l.majorTickLines.height:0,De(n,new Nt(0,m,0,0))):"Left"===e?(i.x=i.x+this.legend.margin.left,i.y=n.y+this.alignLegend(0,s.height-(n.y+g),i.height,t),m+=!o||l.opposedPosition||h||c||!d?"Vertical"!==l.orientation&&""!==l.categoryField?p:0:i.x-this.chart.margin.left+a+l.majorTickLines.height,De(n,new Nt(m,0,0,0))):(i.x=this.legend.location.x,i.y=this.legend.location.y,De(n,new Nt(0,0,0,0)))}alignLegend(e,t,i,n){switch(n){case"Far":e=t-i-e;break;case"Center":e=(t-i)/2}return e}renderLegend(e,t,i,n){let s=0,r=0,a=new C(0,0,0,0),o=new C(0,0,0,0);const l=this.findFirstLegendPosition(this.legendCollections),h=t.padding,c=t.enablePages,d=t.titlePosition,p=this.isPaging&&!t.enablePages&&this.isVertical?this.pageButtonSize:0,g=e.renderer.createGroup({id:this.legendID+"_g"}),u=this.createLegendElements(e,i,g,t,this.legendID,n);this.legendRegions=[];let m=0;for(let f=0;f<this.legendCollections.length;f++)if(""!==this.legendCollections[f].text){m=Math.max(this.legendCollections[f].textSize.height,m);break}if(this.maxItemHeight=Math.max(m,t.shapeHeight),c||!this.isPaging||this.isVertical?this.isPaging||this.isVertical||(r=this.isTitle&&"Left"===d?this.fivePixel+this.legendTitleSize.width:0):(r=this.isTitle&&"Left"===d?this.legendTitleSize.width:0,r+=this.pageButtonSize+2*this.fivePixel),s=this.isTitle&&(this.isTop||this.isVertical)?this.legendTitleSize.height:0,"Gradient"===e.legendSettings.mode&&this.legendCollections.length>1)this.getLinearLegend(i,e,t,u),this.totalPages=1;else if(l!==this.legendCollections.length){let n,c=0,m=this.legendCollections[l];const f=new Pt(this.isBulletChartControl?i.x+r+h+t.shapeWidth/2:i.x+r+h+t.shapeWidth/2+t.containerPadding.left,this.isBulletChartControl?i.y+s+p+h+this.maxItemHeight/2:i.y+s+p+h+this.maxItemHeight/2+t.containerPadding.top),b=new w("",f.x,f.y,e.isRtlEnabled?"end":"start"),y=t.shapePadding+h+t.shapeWidth;if(this.totalPages=this.totalPages=this.isChartControl||this.isBulletChartControl||this.isStockChartControl?this.totalPages:0,this.pageXCollections=[],this.legendCollections[l].location=f,!t.enablePages&&this.isPaging){const e=f.x-this.fivePixel,t=f.y-this.fivePixel,n=this.isTitle&&!this.isVertical&&"Left"===d?this.legendTitleSize.width+this.fivePixel:0,s=this.isVertical?this.pageButtonSize+Math.abs(t-i.y):0;let r=this.isTitle&&!this.isVertical&&"Right"===d?this.legendTitleSize.width+this.fivePixel:0;r+=this.isVertical?0:this.fivePixel+this.pageButtonSize+this.fivePixel,a=new C(e,t,i.width-r-n,i.height-s),o=a}else o=i;for(const i of this.legendCollections)"accumulationchart"===this.chart.getModuleName()&&(i.fill=(this.chart||this.chart||this.chart).visibleSeries[0].points[i.pointIndex].color),"stockChart"===this.chart.getModuleName()&&(i.type=this.chart.visibleSeries[c].type),this.accessbilityText=this.isBulletChartControl?"Legend of bullet chart"+i.text:"Click to show or hide the "+i.text+" series",i.render&&""!==i.text&&(n=e.renderer.createGroup({id:this.legendID+this.generateId(i,"_g_",c)}),n&&(n.setAttribute("tabindex",t.tabIndex.toString()),n.setAttribute("aria-label",t.description||this.accessbilityText)),this.library.getRenderPoint(i,f,y,m,o,c,l),this.renderSymbol(i,n,c),this.renderText(e,i,n,b,c),n&&n.setAttribute("style","outline: none; cursor: "+(!t.toggleVisibility&&("None"===e.selectionMode||"None"===e.highlightMode||"None"===e.selectionMode)||this.isBulletChartControl?"auto":"pointer")),u&&u.appendChild(n),m=i),c++;this.isPaging?this.renderPagingElements(e,i,b,g):this.totalPages=1}ct(e.enableCanvas,e.svgObject,g,n)}getLinearLegend(e,t,i,n){const s="http://www.w3.org/2000/svg",r=this.legendCollections[0],a=this.legendCollections[1],o=this.chart.renderer.createDefs(),l=document.createElementNS(s,"linearGradient"),h=[],c=[];i.title&&(this.isVertical?(e.y+=this.legendTitleSize.height,e.height-=this.legendTitleSize.height):"Left"===i.titlePosition?(e.x+=this.legendTitleSize.width,e.width-=this.legendTitleSize.width):"Right"===i.titlePosition?e.width-=this.legendTitleSize.width:"Top"===i.titlePosition&&(e.y+=this.legendTitleSize.height,e.height-=this.legendTitleSize.height));for(const b of this.chart.rangeColorSettings){if(c.indexOf(b.start)<0&&c.push(b.start),b.colors.length>2){let e=b.end-b.start;const t=b.colors.length-1;if(e>0){e/=t;for(let i=1;i<t;i++)c.push(b.start+e*i)}else for(let i=1;i<t;i++)c.push(b.start)}c.indexOf(b.end)<0&&c.push(b.end);for(const e of b.colors)h.indexOf(e)<0&&h.push(e);b.colors.length>0&&b.colors.length<2&&h.push(b.colors[0])}const d=this.isVertical?"0":"100",p=this.isVertical?"100":"0";l.setAttribute("id",this.generateId(r,"linearGradient",0)),l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2",d+"%"),l.setAttribute("y2",p+"%");const g=c[c.length-1]-c[0];for(let b=0;b<h.length;b++){let e=c[b]-c[0];e/=g;const t=document.createElementNS(s,"stop");t.setAttribute("offset",e.toString()),t.setAttribute("stop-color",h[b]),t.setAttribute("stop-opacity",1..toString()),l.appendChild(t)}const u=r.text.toString(),m=a.text.toString(),f=b(u,i.textStyle),y=b(m,i.textStyle),x=f.width>y.width?f.width:y.width,v=f.height>y.height?f.height:y.height;let S,I,O,R,A=2*x+4*i.padding,k=e.width,E=e.height,L=e.x+x+2*i.padding,T=e.y+i.padding;if(this.isVertical){if(A=2*v+4*i.padding,k=e.width-2*i.padding,E=e.height-A,L=e.x+i.padding,T=e.y+v+2*i.padding,S=e.y+i.padding+v,I=T+E+v,O=e.x+.5*e.width-.5*x,R=O,k>30){const e=k-30;k=30,L+=e/2}}else if(k=e.width-A,E=e.height-2*i.padding,O=e.x+i.padding+(x-f.width),R=e.x+k+3*i.padding+x,S=e.y+.5*e.height+.25*v,I=S,E>30){const e=E-30;E=30,T+=e/2}let j=new w("",O,S,"",u);j.id=this.legendID+this.generateId(r,"_text_",1);const D=r.visible?i.textStyle.color||t.themeStyle.legendLabel:"#D3D3D3",M=!this.isStockChartControl&&this.chart.enableCanvas;It(t.renderer,j,i.textStyle,D,n,!1,!1,!1,!1,null,this.currentPageNumber&&M?new C(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null),j=new w("",R,I,"",m),j.id=this.legendID+this.generateId(r,"_text_",2),It(t.renderer,j,i.textStyle,D,n,!1,!1,!1,!1,null,this.currentPageNumber&&M?new C(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null);const F=t.renderer.drawRectangle({width:k,height:E,x:L,y:T,fill:"url(#"+this.generateId(r,"linearGradient",0)+")"});o.appendChild(l),n.appendChild(o),n.appendChild(F)}findFirstLegendPosition(e){let t=0;for(const i of e){if(i.render&&""!==i.text)break;t++}return t}calculateLegendTitle(e,t){if(e.title){this.isTop="Top"===e.titlePosition;const i="Trim"===e.titleStyle.textOverflow?2*e.padding:0;this.isTop||this.isVertical?this.legendTitleCollections=At(e.title,e.titleStyle,t.width-i):this.legendTitleCollections[0]=vt(e.maximumTitleWidth,e.title,e.titleStyle),this.legendTitleSize=b(this.isTop?e.title:this.legendTitleCollections[0],e.titleStyle),this.legendTitleSize.height*=this.legendTitleCollections.length}else this.legendTitleSize=new x(0,0)}renderLegendTitle(e,t,i,n){const s=t.padding,r=t.titleStyle.textAlignment;this.isTop="Top"===t.titlePosition;let a="Near"===r?"start":"Far"===r?"end":"middle",o=kt(i,t.titleStyle);a=this.isTop||this.isVertical?a:"",o="Near"===r?o+s:"Far"===r?o-s:o,o=this.isTop||this.isVertical?o:i.x+("Left"===t.titlePosition?5:i.width-this.legendTitleSize.width-5);const l=new w(this.legendID+"_title",o,i.y+(this.isTop||this.isVertical?this.legendTitleSize.height/this.legendTitleCollections.length:i.height/2+this.legendTitleSize.height/4),a,this.legendTitleCollections);It(e.renderer,l,t.titleStyle,t.titleStyle.color,n)}createLegendElements(e,t,i,n,s,r){const a=n.padding,o=new Dt(s+"_element",n.background,n.border,n.opacity,t),l=e.renderer.createGroup({id:s+"_collections"}),h=!this.isStockChartControl&&e.enableCanvas,c=e.renderer.createClipPath({id:s+"_clipPath"});return i?i.appendChild(e.renderer.drawRectangle(o)):e.renderer.drawRectangle(o),n.title&&this.renderLegendTitle(e,n,t,i),h||i.appendChild(l),this.legendTranslateGroup=e.renderer.createGroup({id:s+"_translate_g"}),h||l.appendChild(this.legendTranslateGroup),o.y+=a+(this.isTop?this.legendTitleSize.height:0),o.id+="_clipPath_rect",o.width=this.isChartControl||"bulletChart"===e.getModuleName()||this.isStockChartControl||!this.isVertical?t.width:this.maxWidth-a+n.containerPadding.left+n.containerPadding.right,h?this.pagingClipRect=o:(this.clipRect=e.renderer.drawRectangle(o),c.appendChild(this.clipRect)),ct(h,e.svgObject,c,r),h||l.setAttribute("style","clip-path:url(#"+c.id+")"),this.legendTranslateGroup}renderSymbol(e,t,i){const n=this.isBulletChartControl?this.chart:null,s=e.visible?e.fill:"#D3D3D3",r=("chart"===this.chart.getModuleName()||"stockChart"===this.chart.getModuleName())&&"SeriesType"===e.shape&&e.type.toLowerCase().indexOf("line")>-1&&-1===e.type.toLowerCase().indexOf("area"),a=!("chart"!==this.chart.getModuleName()&&"stockChart"!==this.chart.getModuleName()||"Scatter"!==e.type&&"Bubble"!==e.type),o=!this.isStockChartControl&&this.chart.enableCanvas;let l,h,c="SeriesType"===e.shape?e.type:e.shape,d=r?"Series"===this.legend.mode?this.chart.visibleSeries[i].width:this.chart.visibleSeries[0].width:this.isBulletChartControl&&"Multiply"===e.shape?4:1;if(c="Scatter"===c?e.markerShape:c,a&&i<this.chart.visibleSeries.length){const e=this.chart.visibleSeries[i].border;l=e.color?e.color:s,d=e.width?e.width:1}const p=new A(this.legendID+this.generateId(e,"_shape_",i),s,d,a?l:s,1,"","");let g=b(e.text,this.legend.textStyle),u=this.legend.isInversed?e.location.x+g.width+this.legend.shapePadding:e.location.x,m=e.location.y;o?(h=-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),it({x:u,y:m},c,new x(this.legend.shapeWidth,this.legend.shapeHeight),"",p,0,this.chart.renderer,this.currentPageNumber?new C(0,h,0,0):null,this.isBulletChartControl,n),this.legendRegions.push({rect:new C(e.location.x,e.location.y,this.legend.shapeWidth,this.legend.shapeHeight+h),index:i})):t.appendChild(it({x:u,y:m},c,new x(this.legend.shapeWidth,this.legend.shapeHeight),e.url,p,0,this.chart.renderer,null,this.isBulletChartControl,n)),("Line"===c&&e.markerVisibility&&"Image"!==e.markerShape||"Doughnut"===e.type&&"Doughnut"===c)&&(p.id=this.legendID+this.generateId(e,"_shape_marker_",i),c="Doughnut"===e.type?"Circle":e.markerShape,p.fill="Doughnut"===e.type?"#FFFFFF":p.fill,o?it({x:u,y:m},c,new x(this.legend.shapeWidth/2,this.legend.shapeHeight/2),"",p,0,this.chart.renderer,this.currentPageNumber?new C(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null,this.isBulletChartControl,n):t.appendChild(it({x:u,y:m},c,new x(this.legend.shapeWidth/2,this.legend.shapeHeight/2),"",p,0,null,null,this.isBulletChartControl,n)))}renderText(e,t,i,n,s){const r=e.legendSettings,a=t.visible?r.textStyle.color||e.themeStyle.legendLabel:"#D3D3D3",o=!this.isStockChartControl&&this.chart.enableCanvas;n.id=this.legendID+this.generateId(t,"_text_",s),n.text=t.text,n.x=r.isInversed?t.location.x-r.shapeWidth/2:t.location.x+r.shapeWidth/2+r.shapePadding,n.y=t.location.y+this.maxItemHeight/4;const l=It(e.renderer,n,r.textStyle,a,i,!1,!1,!1,!1,null,this.currentPageNumber&&o?new C(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null);if(l&&l.setAttribute("aria-label",r.description||this.accessbilityText),o){const e=b(n.text,r.textStyle);this.legendRegions[s].rect.y=n.y<this.legendRegions[s].rect.y?n.y:this.legendRegions[s].rect.y,this.legendRegions[s].rect.width+=e.width,this.legendRegions[s].rect.height=e.height,this.legendRegions[s].rect.y-=.5*e.height}}renderPagingElements(e,t,i,n){const s=e.renderer.createGroup({id:this.legendID+"_navigation"}),r=!this.isStockChartControl&&e.enableCanvas,a=this.isBulletChartControl?0:this.legendTitleSize.height,o=e.legendSettings,l=new A(this.legendID+"_pageup","transparent",5,"#545454",1,"",""),h=this.pageButtonSize,c=o.enablePages||!this.isPaging||this.isVertical||this.isBulletChartControl?this.rowCount-1:1,d=this.isTitle&&"Left"===o.titlePosition?this.legendTitleSize.width:0;let p;this.pagingRegions=[],this.backwardArrowOpacity=1!==this.currentPage?1:0,this.forwardArrowOpacity=this.currentPage===this.totalPages?0:1,r||n.appendChild(s),this.totalPages=this.isChartControl||this.isBulletChartControl||this.isStockChartControl||!this.isVertical?Math.ceil(this.totalPages/Math.max(1,this.rowCount-1)):Math.ceil(this.totalPages/this.maxColumns),s&&s.setAttribute("style","cursor: pointer"),this.clipPathHeight=c*(this.maxItemHeight+o.padding),r?(this.pagingClipRect.height=this.legendBounds.height-this.clipPathHeight-(this.pagingClipRect.y-this.legendBounds.y)-o.border.width,this.pagingClipRect.y=this.pagingClipRect.y+this.clipPathHeight,this.pagingClipRect.x+=o.border.width,this.pagingClipRect.width-=o.border.width+o.border.width/2,this.chart.renderer.clearRect(new C(this.pagingClipRect.x,this.pagingClipRect.y,this.pagingClipRect.width,this.pagingClipRect.height))):this.clipRect.setAttribute("height",this.clipPathHeight.toString());let g=t.x+h/2,u=t.y+this.clipPathHeight+(a+t.height-this.clipPathHeight)/2;!this.isPaging||o.enablePages||this.isVertical||this.isBulletChartControl||(g=t.x+this.fivePixel+this.pageButtonSize+d,u=o.title&&this.isTop?t.y+8+a+h/1+.5:t.y+8+h+.5);const m=b(this.totalPages+"/"+this.totalPages,o.textStyle);r?it({x:g,y:u},"LeftArrow",new x(h,h),"",l,0,this.chart.renderer,new C(t.width-(2*(h+8)+8+m.width),0,0,0)):!this.isVertical||o.enablePages||this.isBulletChartControl?(l.opacity=this.isBulletChartControl?l.opacity:o.enablePages?1:this.backwardArrowOpacity,s.appendChild(it({x:g,y:u},"LeftArrow",new x(h,h),"",l))):(g=t.x+t.width/2,u=t.y+h/2+8+a,l.opacity=this.backwardArrowOpacity,s.appendChild(it({x:g,y:u},"UpArrow",new x(h,h),"",l))),this.pagingRegions.push(new C(g+t.width-(2*(h+8)+8+m.width)-.5*h,u-.5*h,h,h)),i.x=g+h/2+8,i.y=u+m.height/4,i.id=this.legendID+"_pagenumber",i.text="1/"+this.totalPages,r&&this.totalNoOfPages&&(i.text=this.currentPageNumber+"/"+this.totalNoOfPages),(o.enablePages||this.isBulletChartControl)&&(p=It(e.renderer,i,o.textStyle,o.textStyle.color,s,!1,!1,!1,!1,null,new C(t.width-(2*(h+8)+8+m.width),0,0,0))),g=i.x+8+h/2+m.width,!this.isPaging||o.enablePages||this.isVertical||(g=t.x+t.width-this.fivePixel-this.pageButtonSize-(o.title&&"Right"===o.titlePosition?this.legendTitleSize.width+this.fivePixel:0)),l.id=this.legendID+"_pagedown",l.opacity=o.enablePages?1:this.forwardArrowOpacity,r?it({x:g,y:u},"RightArrow",new x(h,h),"",l,0,this.chart.renderer,new C(t.width-(2*(h+8)+8+m.width),0,0,0)):!this.isVertical||o.enablePages||this.isBulletChartControl?s.appendChild(it({x:g,y:u},"RightArrow",new x(h,h),"",l)):(g=t.x+t.width/2,u=t.y+t.height-h/2-8,s.appendChild(it({x:g,y:u},"DownArrow",new x(h,h),"",l))),this.pagingRegions.push(new C(g+(t.width-(2*(h+8)+8+m.width)-.5*h),u-.5*h,h,h)),r||!o.enablePages&&!this.isBulletChartControl?(1===this.currentPageNumber&&this.calTotalPage&&(o.enablePages||this.isBulletChartControl)&&(this.totalNoOfPages=this.totalPages,this.calTotalPage=!1),o.enablePages||this.isBulletChartControl||this.translatePage(null,this.currentPage-1,this.currentPage,o)):s.setAttribute("transform","translate("+(t.width-(2*(h+8)+8+m.width))+", 0)"),(o.enablePages||this.isBulletChartControl)&&this.translatePage(p,this.currentPage-1,this.currentPage,o)}translatePage(e,t,i,n){let s=this.clipPathHeight*t,r="translate(0,-"+s+")";return this.isChartControl||this.isBulletChartControl||this.isStockChartControl||!this.isVertical||(s=this.pageXCollections[t*this.maxColumns]-this.legendBounds.x,s=s<0?0:s,r="translate(-"+s+",0)"),this.chart.enableCanvas||this.legendTranslateGroup.setAttribute("transform",r),this.chart.enableCanvas||!n.enablePages&&!this.isBulletChartControl||(e.textContent=i+"/"+this.totalPages),this.currentPage=i,s}changePage(e,t){const i=this.chart.legendSettings,n=document.getElementById(this.legendID+"_pageup"),s=document.getElementById(this.legendID+"_pagedown"),r=i.enablePages||this.isBulletChartControl?document.getElementById(this.legendID+"_pagenumber"):null,a=i.enablePages||this.isBulletChartControl?parseInt(r.textContent.split("/")[0],10):this.currentPage;t&&a>1?this.translatePage(r,a-2,a-1,i):!t&&a<this.totalPages&&this.translatePage(r,a,a+1,i),!this.isPaging||i.enablePages||this.isBulletChartControl||(this.currentPage===this.totalPages?this.hideArrow(s):this.showArrow(s),1===this.currentPage?this.hideArrow(n):this.showArrow(n))}hideArrow(e){e.setAttribute("opacity","0")}showArrow(e){e.setAttribute("opacity","1")}generateId(e,t,i){return this.isChartControl||this.isStockChartControl?t+i:t+e.pointIndex}move(e){const t=this.chart.mouseX,i=this.chart.mouseY;if(e.target.textContent.indexOf("...")>-1){const n=e.target.id.split(this.legendID+"_text_");if(2===n.length){const e=parseInt(n[1],10),s=this.chart.element;isNaN(e)||(this.chart.isTouch&&Oe(this.chart.element.id+"_EJ2_Legend_Tooltip"),this.isChartControl?Ae(this.chart.series[e].name,t,i,s.offsetWidth,s.id+"_EJ2_Legend_Tooltip",nt(this.chart.element.id+"_Secondary_Element")):Ae(this.chart.visibleSeries[0].points[e].x.toString(),t+10,i+10,s.offsetWidth,s.id+"_EJ2_Legend_Tooltip",nt(this.chart.element.id+"_Secondary_Element")))}}else Oe(this.chart.element.id+"_EJ2_Legend_Tooltip");this.chart.isTouch&&(clearTimeout(this.clearTooltip),this.clearTooltip=+setTimeout(()=>{Oe(this.chart.element.id+"_EJ2_Legend_Tooltip")},1e3))}}class li{constructor(e,t,i,n,s,r,a,o,l,h){this.location={x:0,y:0},this.text=e,this.fill=t,this.shape=i,this.url=r,this.visible=n,this.type=s,this.markerVisibility=o,this.markerShape=a,this.pointIndex=l,this.seriesIndex=h}}var hi=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ci=(()=>{class e extends Qt{constructor(){super(...arguments),this.clipRect=new C(0,0,0,0)}setDataSource(e,t){e&&(this.xData=e.xData,this.yData=e.yData,this.points=e.points),t[qe(this.type)+"IndicatorModule"].initDataSource(this,t),t.visibleSeriesCount+=this.targetSeries.length}}return hi([Object(r.t)("Sma")],e.prototype,"type",void 0),hi([Object(r.t)(14)],e.prototype,"period",void 0),hi([Object(r.t)(14)],e.prototype,"kPeriod",void 0),hi([Object(r.t)(3)],e.prototype,"dPeriod",void 0),hi([Object(r.t)(80)],e.prototype,"overBought",void 0),hi([Object(r.t)(20)],e.prototype,"overSold",void 0),hi([Object(r.t)(2)],e.prototype,"standardDeviation",void 0),hi([Object(r.t)("Close")],e.prototype,"field",void 0),hi([Object(r.t)(12)],e.prototype,"slowPeriod",void 0),hi([Object(r.t)(26)],e.prototype,"fastPeriod",void 0),hi([Object(r.t)(!0)],e.prototype,"showZones",void 0),hi([Object(r.g)({color:"#ff9933",width:2},_)],e.prototype,"macdLine",void 0),hi([Object(r.t)("Both")],e.prototype,"macdType",void 0),hi([Object(r.t)("#2ecd71")],e.prototype,"macdPositiveColor",void 0),hi([Object(r.t)("#e74c3d")],e.prototype,"macdNegativeColor",void 0),hi([Object(r.t)("rgba(211,211,211,0.25)")],e.prototype,"bandColor",void 0),hi([Object(r.g)({color:"#ffb735",width:1},_)],e.prototype,"upperLine",void 0),hi([Object(r.g)({color:"#f2ec2f",width:1},_)],e.prototype,"lowerLine",void 0),hi([Object(r.g)({color:"#f2ec2f",width:1},_)],e.prototype,"periodLine",void 0),hi([Object(r.t)("")],e.prototype,"seriesName",void 0),e})();class di{constructor(e){this.control=e}print(e){this.printWindow=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth+",tabbar=no"),this.printWindow.moveTo(0,0),this.printWindow.resizeTo(screen.availWidth,screen.availHeight);const t={cancel:!1,htmlContent:this.getHTMLContent(e),name:"beforePrint"};this.control.trigger("beforePrint",t),t.cancel||Object(r.jb)(t.htmlContent,this.printWindow)}getHTMLContent(e){const t=Object(r.G)("div");if(e)if(e instanceof Array)for(let i=0;i<e.length;i++)t.appendChild(nt(e[i]).cloneNode(!0));else e instanceof Element?t.appendChild(e.cloneNode(!0)):t.appendChild(nt(e).cloneNode(!0));else t.appendChild(this.control.element.cloneNode(!0));return t}export(e,t,i,n,s,a,o,l,h){const c=this.getControlsValue(n,o);s=s||c.width,a=a||c.height;let d=this.control.svgObject;const p=this.control.enableCanvas;let g;p||(d=Object(r.G)("canvas",{id:"ej2-canvas",attrs:{width:s.toString(),height:a.toString()}}));const u=!(r.d.userAgent.toString().indexOf("HeadlessChrome")>-1);i=Object(r.Z)(i)?P.l.Landscape:i;const m=window.URL.createObjectURL(new Blob("SVG"===e?['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+c.svg.outerHTML+"</svg>"]:[(new XMLSerializer).serializeToString(c.svg)],{type:"image/svg+xml"}));if("SVG"===e)if("msie"===r.d.info.name){const i=new Blob([(new XMLSerializer).serializeToString(c.svg)],{type:"application/octet-stream"});window.navigator.msSaveOrOpenBlob(i,t+"."+e.toLocaleLowerCase())}else this.triggerDownload(t,e,m,u);else if("msie"===r.d.info.name){let n=d;p||(n=this.createCanvas()),g=n.toDataURL(),"PDF"===e?this.exportPdf(n,i,s,a,u,t,l,h):this.doexport(e,g,t)}else{const n=new Image,r=d.getContext("2d");n.onload=()=>{r.drawImage(n,0,0),window.URL.revokeObjectURL(m),"PDF"===e?this.exportPdf(d,i,s,a,u,t,l,h):window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(d.toBlob(null),t+"."+e.toLocaleLowerCase()):this.triggerDownload(t,e,d.toDataURL("image/"+e.toLowerCase()),u)},n.src=m}p||Oe(document.getElementById(this.control.element.id+"_canvas"))}getDataUrl(e){const t=this.getControlsValue([e]);let i=this.control.svgObject;const n=this.control.enableCanvas;n||(i=Object(r.G)("canvas",{id:"ej2-canvas",attrs:{width:t.width.toString(),height:t.height.toString()}}));const s=window.URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t.svg)],{type:"image/svg+xml"}));if("msie"===r.d.info.name){let t=i;n||(t=this.createCanvas());const s={name:"afterExport",cancel:!1,dataUrl:i.toDataURL("image/png")};return e.trigger("afterExport",s),{element:t,dataUrl:t.toDataURL()}}{const t=new Image,n=i.getContext("2d");return t.onload=()=>{n.drawImage(t,0,0),window.URL.revokeObjectURL(s);const r={name:"afterExport",cancel:!1,dataUrl:i.toDataURL("image/png")};return e.trigger("afterExport",r),r.dataUrl},t.src=s,{element:i,blobUrl:s}}}triggerDownload(e,t,i,n){Object(r.G)("a",{attrs:{download:e+"."+t.toLocaleLowerCase(),href:i}}).dispatchEvent(new MouseEvent(n?"click":"move",{view:window,bubbles:!1,cancelable:!0}))}getControlsValue(e,t){let i=0,n=0;const s=this.control.enableCanvas,a=new m("").createSvg({id:"Svg_Export_Element",width:200,height:200});return e.map(e=>{const o=e.svgObject.cloneNode(!0),l=e.renderer.createGroup({style:Object(r.Z)(t)||t?"transform: translateY("+n+"px)":"transform: translateX("+i+"px)"}),h=o.childNodes[0].getAttribute("fill");"Tailwind"!==e.theme&&"TailwindDark"!==e.theme||"rgba(255,255,255, 0.0)"!==h&&"transparent"!==h||o.childNodes[0].setAttribute("fill","rgba(255,255,255, 1)"),s||l.appendChild(o),i=Object(r.Z)(t)||t?Math.max(e.availableSize.width,i):i+e.availableSize.width,n=Object(r.Z)(t)||t?n+e.availableSize.height:Math.max(e.availableSize.height,n),s||a.appendChild(l)}),s||(a.setAttribute("width",i+""),a.setAttribute("height",n+"")),{width:i,height:n,svg:a}}createCanvas(){const e=this.control;this.canvasRender(!0,e);const t=e.svgObject;return this.canvasRender(!1,e),t}canvasRender(e,t){t.enableCanvas=e,t.preRender(),t.render()}exportPdf(e,t,i,n,s,r,a,o){const l=new P.e,h=l.pageSettings.margins,c=l.pageSettings.width,d=l.pageSettings.height;let p=e.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream");l.pageSettings.orientation=t;const g=c<i?i+h.left+h.right:c,u=d<n?n+h.top+h.bottom:d;if(void 0!==a){const e=new P.q(1,a.fontSize||15),t=new P.n(g,40);t.graphics.drawString(a.content+"",e,null,new P.p(new P.c(0,0,0)),a.x,a.y,null),l.template.top=t}if(void 0!==o){const e=new P.q(1,o.fontSize||15),t=new P.n(g,40);t.graphics.drawString(o.content+"",e,null,new P.p(new P.c(0,0,0)),o.x,o.y,null),l.template.bottom=t}l.pageSettings.size=new P.y(g,u),p=p.slice(p.indexOf(",")+1),l.pages.add().graphics.drawImage(new P.a(p),0,0,i,n),s&&(l.save(r+".pdf"),l.destroy())}doexport(e,t,i){let n=[];n=[t],this.exportImage(n,i,e||"JPG",t)}exportImage(e,t,i,n){const s=[],a=e instanceof HTMLElement?0:e.length;for(let r=0;r<a;r++){const t=e[r].replace(/^data:[a-z]*;,/,"").split(","),i=atob(t[1]),n=new ArrayBuffer(i.length),a=new Uint8Array(n);for(let e=0;e<i.length;e++)a[e]=i.charCodeAt(e);s.push(n)}for(let o=0;o<s.length;o++){const e=new Blob([s[o]],{type:"application/octet-stream"});"msie"===r.d.info.name&&window.navigator.msSaveOrOpenBlob(e,t+"."+i.toLocaleLowerCase())}}}var pi=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let gi=(()=>{class e extends r.e{}return pi([Object(r.t)()],e.prototype,"start",void 0),pi([Object(r.t)()],e.prototype,"end",void 0),pi([Object(r.t)([])],e.prototype,"colors",void 0),pi([Object(r.t)("")],e.prototype,"label",void 0),e})(),ui=(()=>{class e extends r.e{}return pi([Object(r.t)(!1)],e.prototype,"enable",void 0),pi([Object(r.t)("")],e.prototype,"dashArray",void 0),pi([Object(r.g)({color:null,width:1},V)],e.prototype,"line",void 0),pi([Object(r.t)("Both")],e.prototype,"lineType",void 0),pi([Object(r.t)("")],e.prototype,"verticalLineColor",void 0),pi([Object(r.t)("")],e.prototype,"horizontalLineColor",void 0),pi([Object(r.t)(1)],e.prototype,"opacity",void 0),e})(),mi=(()=>{class e extends r.e{}return pi([Object(r.t)(!1)],e.prototype,"enableSelectionZooming",void 0),pi([Object(r.t)(!1)],e.prototype,"enablePinchZooming",void 0),pi([Object(r.t)(!1)],e.prototype,"enableMouseWheelZooming",void 0),pi([Object(r.t)(!0)],e.prototype,"enableDeferredZooming",void 0),pi([Object(r.t)("XY")],e.prototype,"mode",void 0),pi([Object(r.t)(["Zoom","ZoomIn","ZoomOut","Pan","Reset"])],e.prototype,"toolbarItems",void 0),pi([Object(r.t)(!1)],e.prototype,"enablePan",void 0),pi([Object(r.t)(!1)],e.prototype,"enableScrollbar",void 0),e})(),fi=(()=>{let e=class extends r.h{constructor(e,t){super(e,t),this.rotatedDataLabelCollections=[],this.animated=!1,this.isPointMouseDown=!1,this.isScrolling=!1,this.checkResize=0,this.visible=0,this.clickCount=0,this.singleClickTimer=0,this.chartAreaType="Cartesian",this.isRtlEnabled=!1,this.chartid=57723,Object(r.tb)("mergePersistData",this.mergePersistChartData,this)}mergePersistChartData(){const e=window.localStorage.getItem(this.getModuleName()+this.element.id);if(!Object(r.Z)(e)&&""!==e){const t=JSON.parse(e),i=Object.keys(t);this.isProtectedOnChange=!0;for(const e of i)"object"!=typeof this[e]||Object(r.Z)(this[e])?this[e]=t[e]:Object(r.L)(this[e],t[e]);this.isProtectedOnChange=!1}}isIdHasSpecialCharacter(e){const t=/^[A-Za-z ]+$/,i=/^[0-9 ]+$/;let n="";if(t.test(e))return e;{let s=0;i.test(e[0])&&(n+="\\3"+e[0],s=1);for(let r=s;r<e.length;r++)t.test(e[r])||-1!==e.indexOf("-")||-1!==e.indexOf("_")||-1!==e.indexOf("\\")||i.test(e[r])?n+=e[r]:n+="\\"+e[r];return n}}preRender(){this.element.id=this.isIdHasSpecialCharacter(this.element.id),this.isBlazor=window.Blazor,this.allowServerDataBinding=!1,this.unWireEvents(),this.initPrivateVariable(),this.setCulture(),this.wireEvents(),this.stockChart&&(null===this.stockChart.tooltip.header&&(this.tooltip.header="<b>${point.x}</b>"),null===this.stockChart.tooltip.format&&(this.tooltip.format="High : <b>${point.high}</b><br/>Low : <b>${point.low}</b><br/>Open : <b>${point.open}</b><br/>Close : <b>${point.close}</b>",""!==this.stockChart.series[0].volume&&(this.tooltip.format+="<br/>Volume : <b>${point.volume}</b>")),this.animateSeries=!1)}initPrivateVariable(){if(this.animateSeries=!0,this.delayRedraw=!1,this.horizontalAxes=[],this.verticalAxes=[],this.refreshAxis(),this.refreshDefinition(this.rows),this.refreshDefinition(this.columns),this.tooltipModule&&(this.tooltipModule.previousPoints=[]),""===this.element.id){const e=document.getElementsByClassName("e-chart").length;this.element.id="chart_"+this.chartid+"_"+e}this.svgId=this.stockChart?this.stockChart.element.id+"_stockChart_chart":this.element.id+(this.enableCanvas?"_canvas":"_svg")}render(){this.svgRenderer=new m(this.element.id);const e={chart:this.isBlazor?{}:this,theme:this.theme,name:"load",cancel:!1};this.stockChart?(this.isRtlEnabled="rtl"===window.getComputedStyle(document.querySelector("body")).direction,this.cartesianChartRendering(e)):this.trigger("load",e,()=>{e.cancel||this.cartesianChartRendering(e)})}cartesianChartRendering(e){this.theme=this.isBlazor?e.theme:this.theme,this.createChartSvg(),this.setTheme(),this.markerRender=new ni(this),this.calculateAreaType(),this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.calculateVisibleAxis(),this.processData(),this.renderComplete(),this.allowServerDataBinding=!0}getLocalizedLabel(e){return this.localeObject.getConstant(e)}animate(e){this.redraw=!0,this.animated=!0,this.duration=e||1e3}refreshBound(){if(this.rotatedDataLabelCollections=[],this.legendModule&&this.legendSettings.visible&&this.legendModule.getLegendOptions(this.visibleSeries,this),this.tooltip.enable&&this.tooltipModule&&(this.tooltipModule.previousPoints=[]),this.calculateStackValues(),this.calculateBounds(),this.stockChart&&!this.stockChart.rangeFound&&(this.stockChart.enablePeriodSelector||this.stockChart.enableSelector))return null;this.renderElements(),Oe("chartmeasuretext"),this.removeSelection()}calculateStackValues(){let e,t=!1;for(let i=0,n=this.visibleSeries.length;i<n;i++)e=this.visibleSeries[i],e.position=e.rectCount=void 0,-1===e.type.indexOf("Stacking")&&(-1===e.drawType.indexOf("Stacking")||"PolarRadar"!==this.chartAreaType)||t||(e.calculateStackedValue(e.type.indexOf("100")>-1,this),t=!0)}removeSelection(){for(const e of this.visibleSeries)if(e.visible)for(const t of e.points)t.isSelect=!1;nt(this.element.id+"_ej2_drag_multi_group")?(this.selectionMode.indexOf("Drag")>-1&&(this.selectionModule.filterArray=[]),Oe(this.element.id+"_ej2_drag_multi_group"),this.selectionModule.calculateDragSelectedElements(this,new C(0,0,0,0),!0)):nt(this.element.id+"_ej2_drag_group")&&("Lasso"!==this.selectionMode&&(this.selectionModule.filterArray=[]),Oe(this.element.id+"_ej2_drag_group"),this.selectionModule.calculateDragSelectedElements(this,new C(0,0,0,0),!0))}renderElements(){this.renderBorder(),this.renderTitle(),this.renderAreaBorder(),this.renderSeriesElements(this.renderAxes()),this.renderLegend(),this.applyZoomkit(),this.performSelection(),this.setSecondaryElementPosition();for(const e of this.visibleSeries)Object(r.vb)(this.element.id+"_DataLabel","Template",e.marker.dataLabel);this.renderAnnotation()}renderAxes(){let e;return this.yAxisElements=this.renderer.createGroup({id:this.element.id+"yAxisCollection"}),this.rows.length>0&&this.columns.length>0&&(e=this.chartAxisLayoutPanel.renderAxes()),this.stripLineModule&&this.stripLineModule.renderStripLine(this,"Behind",this.axisCollections),e}renderLegend(){if(this.legendModule&&this.legendModule.legendCollections.length&&this.legendSettings.visible){this.legendModule.calTotalPage=!0;const e=this.legendSettings.border.width,t=this.legendModule.legendBounds;let i=new C(t.x,t.y,t.width,t.height);this.enableCanvas&&(i=new C(i.x-e/2,i.y-e/2,i.width+e,i.height+e),this.renderer.canvasClip(i)),this.legendModule.renderLegend(this,this.legendSettings,t),this.enableCanvas&&this.renderer.canvasRestore()}this.redraw||(this.stockChart?nt(this.stockChart.chartObject.id)||this.stockChart.mainObject.appendChild(this.svgObject):this.element.appendChild(this.svgObject))}setSecondaryElementPosition(){const e=nt(this.element.id+"_Secondary_Element");if(!e)return;const t=this.element.getBoundingClientRect(),i=nt(this.svgId).getBoundingClientRect();e.style.left=Math.max(i.left-t.left,0)+"px",e.style.top=Math.max(i.top-t.top,0)+"px"}initializeModuleElements(){this.dataLabelCollections=[];const e=this.element.id;this.series.length&&(this.seriesElements="Scatter"===this.series[0].type||"Bubble"===this.series[0].type?this.svgRenderer.createGroup({id:e+"SeriesCollection"}):this.renderer.createGroup({id:e+"SeriesCollection"})),this.indicators.length&&(this.indicatorElements=this.renderer.createGroup({id:e+"IndicatorCollection"})),this.hasTrendlines()&&(this.trendLineElements=this.renderer.createGroup({id:e+"TrendLineCollection"})),this.dataLabelElements=this.renderer.createGroup({id:e+"DataLabelCollection"})}hasTrendlines(){let e;for(const t of this.series)if(e=!!t.trendlines.length,e)break;return e}renderSeriesElements(e){this.initializeModuleElements();const t=this.element.id;if("g"!==this.element.tagName){const e=wt(this.redraw,t+"_Secondary_Element")||this.createElement("div");e.id=t+"_Secondary_Element",e.setAttribute("style","position: relative"),ct(!1,this.element,e,this.redraw)}if(this.enableCanvas){let e=document.getElementById(t+"_Secondary_Element");e=e||this.createElement("div",{id:t+"_Secondary_Element",attrs:{style:"position: relative; left:0px; top:0px"}});const i=this.svgRenderer.createSvg({id:t+"_tooltip_svg",width:this.availableSize.width,height:this.availableSize.height});i.setAttribute("style","position: absolute; pointer-events: none"),e.appendChild(i)}this.tooltip.enable&&ct(this.enableCanvas,this.svgObject,this.renderer.createGroup({id:t+"_UserInteraction",style:"pointer-events:none;"}),this.redraw),this.rows.length>0&&this.columns.length>0&&(this.initializeIndicator(),this.initializeTrendLine(),this.renderSeries(),this.trendLineElements&&ct(this.enableCanvas,this.svgObject,this.trendLineElements,this.redraw),this.appendElementsAfterSeries(e))}renderSeries(){let e;this.enableCanvas&&this.renderer.canvasClip(this.chartAxisLayoutPanel.seriesClipRect);for(const i of this.visibleSeries)e="TrendLine"===i.category?this.series[i.sourceIndex].trendlines[i.index].visible:i.visible,e&&(this.visible++,Ue(i),this.enableCanvas&&this.renderCanvasSeries(i),i.renderSeries(this));if(this.enableCanvas&&this.renderer.canvasRestore(),this.visible=0,!this.seriesElements)return;this.enableCanvas||this.seriesElements.appendChild($e(this.redraw,{id:this.element.id+"_ChartAreaClipRect_",x:this.chartAxisLayoutPanel.seriesClipRect.x,y:this.chartAxisLayoutPanel.seriesClipRect.y,width:this.chartAxisLayoutPanel.seriesClipRect.width,height:this.chartAxisLayoutPanel.seriesClipRect.height,fill:"transparent","stroke-width":1,stroke:"Gray"},this.renderer));const t=document.getElementById(this.element.id+"_series_svg");t?ct(!1,t,this.seriesElements,this.redraw):ct(this.enableCanvas,this.svgObject,this.seriesElements,this.redraw)}renderCanvasSeries(e){let t,i;if("Bubble"===e.type||"Scatter"===e.type){t=t||this.svgRenderer.createSvg({id:this.element.id+"_series_svg",width:this.availableSize.width,height:this.availableSize.height}),i=i||this.createElement("div",{id:this.element.id+"_series"}),i.setAttribute("style","position: absolute");const e=document.getElementById(this.element.id+"_Secondary_Element");i.appendChild(t),e.appendChild(i)}t=!this.enableCanvas||"Bubble"!==e.type&&"Scatter"!==e.type?this.svgObject:t}initializeIndicator(){for(const e of this.indicators)this[qe(e.type)+"IndicatorModule"]&&this[qe(e.type)+"IndicatorModule"].createIndicatorElements(this,e,e.index);this.indicatorElements&&ct(this.enableCanvas,this.svgObject,this.indicatorElements,this.redraw)}initializeTrendLine(){for(const e of this.visibleSeries)e.trendlines.length&&this.trendLineModule.getTrendLineElements(e,this)}appendElementsAfterSeries(e){"PolarRadar"===this.chartAreaType&&ct(this.enableCanvas,this.svgObject,this.yAxisElements,this.redraw),ct(this.enableCanvas,this.svgObject,e,this.redraw),(this.zoomModule&&this.zoomSettings.enableScrollbar&&this.scrollElement.childElementCount||this.scrollElement&&this.scrollElement.childElementCount)&&ct(!1,nt(this.element.id+"_Secondary_Element"),this.scrollElement,this.redraw),this.stripLineModule&&this.stripLineModule.renderStripLine(this,"Over",this.axisCollections),this.tooltip.enable||ct(this.enableCanvas,this.svgObject,this.renderer.createGroup({id:this.element.id+"_UserInteraction",style:"pointer-events:none;"}),this.redraw),this.stockChart&&this.stockChart.calculateStockEvents()}applyZoomkit(){"PolarRadar"!==this.chartAreaType&&(this.redraw||!this.zoomModule||this.zoomSettings.enablePan&&!this.zoomModule.performedUI||this.zoomModule.applyZoomToolkit(this,this.axisCollections))}renderAnnotation(){this.annotationModule&&this.annotationModule.renderAnnotations(nt((this.stockChart?this.stockChart.element.id:this.element.id)+"_Secondary_Element"))}performSelection(){let e=[];this.selectionModule&&(e=Object(r.L)([],this.selectionModule.selectedDataIndexes,null,!0),this.selectionModule.invokeSelection(this)),this.highlightModule&&this.highlightModule.invokeHighlight(this),e.length>0&&(this.selectionModule.selectedDataIndexes=e,this.selectionModule.redrawSelection(this,this.selectionMode))}processData(e=!0){this.visibleSeriesCount=0;let t=!0;for(const i of this.visibleSeries)i.visible||this.legendSettings.visible?"Indicator"!==i.category&&"TrendLine"!==i.category&&this.initializeDataModule(i):this.visibleSeriesCount++;for(const i of this.indicators)i.dataSource&&(this.initializeDataModule(i),t=!1);e&&(!this.visibleSeries.length||this.visibleSeriesCount===this.visibleSeries.length&&t)&&(this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}))}initializeDataModule(e){let t;e.xData=[],e.yData=[],t=this.isAngular?Object.keys(e.dataSource).length?e.dataSource:this.dataSource:e.dataSource||this.dataSource,e.dataModule=new ti(t,e.query),e.points=[],e.refreshDataManager(this)}calculateBounds(){const e=this.margin;let t=0,i=0,n=0,s=e.left;const r=this.availableSize.width-s-e.right-this.border.width;if(this.titleCollection=[],this.subTitleCollection=[],this.title&&(this.titleCollection=At(this.title,this.titleStyle,r),t=b(this.title,this.titleStyle).height*this.titleCollection.length+15,this.subTitle)){let e=0;for(const t of this.titleCollection)n=b(t,this.titleStyle).width,e=n>e?n:e;this.subTitleCollection=At(this.subTitle,this.subTitleStyle,e),i=b(this.subTitle,this.subTitleStyle).height*this.subTitleCollection.length+15}let a=e.top+i+t+.5*this.chartArea.border.width;const o=this.availableSize.height-a-this.border.width-e.bottom;this.stockChart&&this.stockChart.legendSettings.visible&&this.stockChart.stockLegendModule&&("Top"===this.stockChart.legendSettings.position?a+=this.stockChart.stockLegendModule.legendBounds.height:"Left"===this.stockChart.legendSettings.position&&(s+=this.stockChart.stockLegendModule.legendBounds.width)),this.initialClipRect=new C(s,a,r,o),this.legendModule&&this.legendSettings.visible&&this.legendModule.calculateLegendBounds(this.initialClipRect,this.availableSize,null),this.chartAxisLayoutPanel.measureAxis(this.initialClipRect)}print(e){new di(this).print(e)}initTrendLines(){this.isProtectedOnChange=!0;for(const e of this.visibleSeries){let t=0;for(const i of e.trendlines){const n=i;this.trendLineModule&&(n.index=t,n.sourceIndex=e.index,this.trendLineModule.initSeriesCollection(n,this),n.targetSeries&&(n.targetSeries.xAxisName=e.xAxisName,n.targetSeries.yAxisName=e.yAxisName,this.visibleSeries.push(n.targetSeries))),t++}}this.isProtectedOnChange=!1}calculateAreaType(){const e=this.series[0];this.chartArea.border.width=this.stockChart?0:this.chartArea.border.width,e&&(this.requireInvertedAxis=-1!==e.type.indexOf("Bar")&&!this.isTransposed||-1===e.type.indexOf("Bar")&&this.isTransposed&&"PolarRadar"!==this.chartAreaType),this.chartAxisLayoutPanel="PolarRadar"===this.chartAreaType?this.polarSeriesModule||this.radarSeriesModule:new Ut(this)}calculateVisibleAxis(){let e,t=[this.primaryXAxis,this.primaryYAxis];t="Cartesian"===this.chartAreaType?t.concat(this.axes):t,this.paretoSeriesModule&&"Pareto"===this.series[0].type&&(t=t.concat(this.paretoSeriesModule.paretoAxes)),this.axisCollections=[],this.zoomModule&&(this.zoomModule.isPanning=this.zoomModule.isAxisZoomed(t)&&this.zoomSettings.enablePan,this.svgObject.setAttribute("cursor",this.zoomModule.isPanning?"pointer":"auto"),this.scrollBarModule&&(this.scrollBarModule.axes=t)),this.scrollSettingEnabled&&this.scrollBarModule&&(this.scrollBarModule.axes=t);for(let i=0,n=t.length;i<n;i++){e=t[i],e.series=[],e.labels=[];for(const t of this.visibleSeries)this.initAxis(t,e,!0);for(const t of this.indicators)this.initAxis(t,e,!1);this.scrollBarModule&&!e.zoomingScrollBar&&this.scrollBarModule.injectTo(e,this),null!=e.orientation&&this.axisCollections.push(e)}this.rows.length>0&&this.columns.length>0&&this.chartAxisLayoutPanel.measure()}initAxis(e,t,i){e.xAxisName===t.name||null==e.xAxisName&&"primaryXAxis"===t.name?(t.orientation=this.requireInvertedAxis?"Vertical":"Horizontal",e.xAxis=t,i&&t.series.push(e)):(e.yAxisName===t.name||null==e.yAxisName&&"primaryYAxis"===t.name)&&(t.orientation=this.requireInvertedAxis?"Horizontal":"Vertical",e.yAxis=t,i&&t.series.push(e))}initTechnicalIndicators(){let e=0;for(const t of this.indicators){const i=t,n=qe(i.type);if(this[n+"IndicatorModule"]){i.index=e,this[n+"IndicatorModule"].initSeriesCollection(i,this);for(const e of i.targetSeries)(t.seriesName||t.dataSource)&&this.visibleSeries.push(e)}e++}}refreshTechnicalIndicator(e){if(this.indicators.length){let t=null;if(e instanceof ei&&"Indicator"!==e.category)for(const i of this.indicators)i.seriesName!==e.name||i.dataSource||(t=i,t.setDataSource(e,this));else e instanceof ci&&(t=e,t.setDataSource(e instanceof ei?e:null,this))}}calculateVisibleSeries(){let e;this.visibleSeries=[];const t=this.palettes.length?this.palettes:N(this.theme),i=t.length,n=this.series.sort((e,t)=>e.zOrder-t.zOrder);for(let s=0,r=n.length;s<r;s++){switch(e=n[s],e.category="Pareto"===n[0].type?"Pareto":"Series",e.index=s,e.interior=e.fill||t[s%i],e.type){case"Bar":case"StackingBar":case"StackingBar100":if(-1===n[0].type.indexOf("Bar"))continue;break;case"Polar":case"Radar":if("PolarRadar"!==this.chartAreaType)continue;if("PolarRadar"===this.chartAreaType&&(null===e.xAxisName&&null!==e.yAxisName||null!==e.xAxisName&&null===e.yAxisName||null!==e.xAxisName&&null!==e.yAxisName))continue;break;case"Pareto":this.visibleSeries.push(e),this.paretoSeriesModule.initSeries(e,this);continue;default:if("PolarRadar"===this.chartAreaType||n[0].type.indexOf("Bar")>-1)continue}this.visibleSeries.push(e),n[s]=e}}renderTitle(){let e;const t=this.margin;if(this.title){const i=this.titleStyle.textAlignment,n="Near"===i?"start":"Far"===i?"end":"middle",s=b(this.title,this.titleStyle);e=new C(t.left,0,this.availableSize.width-t.left-t.right,0);const r=new w(this.element.id+"_ChartTitle",kt(e,this.titleStyle),this.margin.top+3*s.height/4,n,this.titleCollection,"","auto"),a=wt(this.redraw,this.element.id+"_ChartTitle",r,this.renderer)||It(this.renderer,r,this.titleStyle,this.titleStyle.color||this.themeStyle.chartTitle,this.svgObject,null,null,null,null,null,null,0,null,this.enableCanvas);a&&(a.setAttribute("aria-label",this.description||this.title),a.setAttribute("tabindex",this.tabIndex.toString())),this.subTitle&&this.renderSubTitle(r)}}renderSubTitle(e){let t=0,i=0;const n=this.titleStyle.textAlignment;for(const l of this.titleCollection)i=b(l,this.titleStyle).width,t=i>t?i:t;const s=b(this.subTitle,this.subTitleStyle),r=new C("Center"===n?e.x-.5*t:"Far"===n?e.x-t:e.x,0,t,0),a=new w(this.element.id+"_ChartSubTitle",kt(r,this.subTitleStyle),e.y*e.text.length+3*s.height/4+10,(e=>"Near"===e?"start":"Far"===e?"end":"middle")(this.subTitleStyle.textAlignment),this.subTitleCollection,"","auto"),o=wt(this.redraw,this.element.id+"_ChartSubTitle",a,this.renderer)||It(this.renderer,a,this.subTitleStyle,this.subTitleStyle.color||this.themeStyle.chartTitle,this.svgObject,null,null,null,null,null,null,0,null,this.enableCanvas);o&&(o.setAttribute("aria-label",this.description||this.subTitle),o.setAttribute("tabindex",this.tabIndex.toString()))}renderBorder(){if(this.stockChart)return;const e=this.border.width,t=this.backgroundImage,i=new Dt(this.element.id+"_ChartBorder",t?"transparent":this.background||this.themeStyle.background,this.border,1,new C(.5*e,.5*e,this.availableSize.width-e,this.availableSize.height-e));if(this.htmlObject=wt(this.redraw,this.element.id+"_ChartBorder",i,this.renderer)||this.renderer.drawRectangle(i),ct(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw),t){const i=new Mt(this.availableSize.height-e,this.availableSize.width-e,t,0,0,this.element.id+"_ChartBackground","visible","none");this.htmlObject=wt(this.redraw,this.element.id+"_ChartBackground",i,this.renderer)||this.renderer.drawImage(i),ct(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw)}}renderAreaBorder(){if("PolarRadar"===this.chartAreaType)return null;{const e=nt(this.element.id+"_ChartAreaBorder"),t=e?new C(+e.getAttribute("x"),+e.getAttribute("y"),+e.getAttribute("width"),+e.getAttribute("height")):null,i=new Dt(this.element.id+"_ChartAreaBorder",this.chartArea.background,{width:this.chartArea.border.width,color:this.chartArea.border.color||this.themeStyle.areaBorder},this.chartArea.opacity,this.chartAxisLayoutPanel.seriesClipRect);this.htmlObject=this.renderer.drawRectangle(i),ct(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw,!0,"x","y",null,null,!0,!0,t),this.htmlObject=null}const e=this.chartArea.backgroundImage;if(e){const t=this.chartArea.border.width,i=new Mt(this.initialClipRect.height-t,this.initialClipRect.width-t,e,this.initialClipRect.x,this.initialClipRect.y,this.element.id+"_ChartAreaBackground","visible","none");this.htmlObject=this.renderer.drawImage(i),ct(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw,!0,"x","y",null,null,!0,!0)}}addSeries(e){for(let t of e)t=new ei(this,"series",t),this.series.push(t);this.refresh()}removeSeries(e){this.redraw=!1,this.series.splice(e,1),this.refresh()}clearSeries(){this.series=[],this.refresh()}addAxes(e){for(let t of e)t=new ve(this,"axes",t),this.isBlazor&&(t.interval=isNaN(t.interval)?null:t.interval,t.desiredIntervals=isNaN(t.desiredIntervals)?null:t.desiredIntervals),this.axes.push(t);this.refresh()}removeAxis(e){this.redraw=!1,this.axes.splice(e,1),this.refresh()}destroy(){this.scrollBarModule&&this.scrollBarModule.destroy(),this.markerRender&&(this.markerRender.removeEventListener(),this.markerRender=null),this.horizontalAxes=[],this.verticalAxes=[],this.visibleSeries=[],this.axisCollections=[],this.rotatedDataLabelCollections=[],this.seriesElements=null,this.chartAxisLayoutPanel=null,this.dataLabelCollections=null,this.dataLabelElements=null,this.yAxisElements=null,this.element&&(this.unWireEvents(),this.isReact&&this.clearTemplate(),super.destroy(),this.enableCanvas||(this.removeSvg(),this.svgObject=null))}getModuleName(){return"chart"}getPersistData(){return this.addOnPersist(["loaded","animationComplete","primaryXAxis","primaryYAxis"])}createChartSvg(){this.removeSvg(),Rt(this)}unWireEvents(){const e=r.d.touchMoveEvent,t=r.d.touchEndEvent,i=r.d.isPointer?"pointerleave":"mouseleave";r.l.remove(this.element,r.d.touchStartEvent,this.chartOnMouseDown),r.l.remove(this.element,e,this.mouseMove),r.l.remove(this.element,t,this.mouseEnd),r.l.remove(this.element,"click",this.chartOnMouseClick),r.l.remove(this.element,"contextmenu",this.chartRightClick),r.l.remove(this.element,i,this.mouseLeave),window.removeEventListener(r.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.resizeBound),this.touchObject&&(this.touchObject.destroy(),this.touchObject=null)}wireEvents(){if(!this.element)return;const e=r.d.isPointer?"pointerleave":"mouseleave";r.l.add(this.element,r.d.touchStartEvent,this.chartOnMouseDown,this),r.l.add(this.element,r.d.touchMoveEvent,this.mouseMove,this),r.l.add(this.element,r.d.touchEndEvent,this.mouseEnd,this),r.l.add(this.element,"click",this.chartOnMouseClick,this),r.l.add(this.element,"contextmenu",this.chartRightClick,this),r.l.add(this.element,e,this.mouseLeave,this),this.resizeBound=this.chartResize.bind(this),window.addEventListener(r.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.resizeBound),this.longPressBound=this.longPress.bind(this),this.touchObject=new r.v(this.element,{tapHold:this.longPressBound,tapHoldThreshold:500}),this.setStyle(this.element)}chartRightClick(e){return!this.crosshair.enable||!this.crosshairModule||2!==e.buttons&&0!==e.which&&"touch"!==e.pointerType||(e.preventDefault(),e.stopPropagation(),!1)}setStyle(e){const t=this.zoomSettings,i=t.enableSelectionZooming||t.enablePinchZooming||"None"!==this.selectionMode||this.crosshair.enable||"None"!==this.highlightMode;e.style.touchAction=i?"none":"element",e.style.msTouchAction=i?"none":"element",e.style.msContentZooming="none",e.style.msUserSelect="none",e.style.webkitUserSelect="none",e.style.position="relative",e.style.display="block",e.style.overflow="hidden"}isOrientation(){return"orientation"in window&&"onorientationchange"in window}longPress(e){return this.mouseX=e&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].clientX:0,this.mouseY=e&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].clientY:0,this.startMove=!0,this.setMouseXY(this.mouseX,this.mouseY),this.notify("tapHold",e),!1}setMouseXY(e,t){if(nt(this.svgId)){const i=nt(this.svgId).getBoundingClientRect(),n=this.element.getBoundingClientRect();this.mouseY=t-n.top-Math.max(i.top-n.top,0),this.mouseX=e-n.left-Math.max(i.left-n.left,0)}}export(e,t){this.exportModule&&(this.exportModule.export(e,t),this.afterExport&&this.exportModule.getDataUrl(this))}chartResize(){this.animateSeries=!1;const e={chart:this.isBlazor?{}:this,name:"resized",currentSize:new x(0,0),previousSize:new x(this.availableSize.width,this.availableSize.height)},t={name:"beforeResize",cancelResizedEvent:!1};return this.resizeTo&&clearTimeout(this.resizeTo),this.trigger("beforeResize",t),t.cancelResizedEvent||(this.resizeTo=+setTimeout(()=>{this.isDestroyed||this.stockChart?clearTimeout(this.resizeTo):(this.createChartSvg(),e.currentSize=this.availableSize,this.trigger("resized",e),this.refreshAxis(),this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}))},500)),!1}mouseMove(e){let t,i,n;return"touchmove"===e.type?(this.isTouch=!0,n=e,t=n.changedTouches[0].clientX,i=n.changedTouches[0].clientY):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType||this.isTouch,t=e.clientX,i=e.clientY),nt(this.svgId)&&(this.setMouseXY(t,i),this.chartOnMouseMove(e)),!1}mouseLeave(e){let t,i,n;return"touchleave"===e.type?(this.isTouch=!0,n=e,t=n.changedTouches[0].clientX,i=n.changedTouches[0].clientY):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType,t=e.clientX,i=e.clientY),this.setMouseXY(t,i),this.chartOnMouseLeave(e),!1}chartOnMouseLeave(e){const t=r.d.isPointer?"pointerleave":"mouseleave";return this.trigger("chartMouseLeave",{target:e.target.id,x:this.mouseX,y:this.mouseY}),Oe(this.element.id+"_EJ2_AxisLabel_Tooltip"),this.isChartDrag=this.isPointMouseDown=!1,this.notify(t,e),!1}chartOnMouseClick(e){this.trigger("chartMouseClick",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.clickCount++;let t=0;return t=this.isAngular?this.pointDoubleClick.observers.length>0?400:0:this.pointDoubleClick?400:0,1===this.clickCount&&this.pointClick?this.singleClickTimer=+setTimeout(()=>{this.clickCount=0,this.triggerPointEvent("pointClick",e)},t):2===this.clickCount&&this.pointDoubleClick&&(clearTimeout(this.singleClickTimer),this.clickCount=0,this.triggerPointEvent("pointDoubleClick",e)),this.axisLabelClick&&this.triggerAxisLabelClickEvent("axisLabelClick",e),this.notify("click",e),!1}triggerPointEvent(e,t){const i=t,n=new qt(this).getData();n.series&&n.point&&this.trigger(e,{series:this.isBlazor?{}:n.series,point:n.point,seriesIndex:n.series.index,pointIndex:n.point.index,x:this.mouseX,y:this.mouseY,pageX:i.pageX,pageY:i.pageY})}triggerAxisLabelClickEvent(e,t){const i=t.target,n=t;if(-1!==i.id.indexOf("_AxisLabel_")){const t=i.id.split("_AxisLabel_"),s=+t[0].slice(-1),r=+t[1],a=this.axisCollections[s];!a.visible||0!==s&&1!==s||this.trigger(e,{chart:this,axis:a,text:a.visibleLabels[r].text,labelID:i.id,index:r,location:new Pt(n.pageX,n.pageY),value:a.visibleLabels[r].value})}}chartOnMouseMove(e){return this.trigger("chartMouseMove",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointMove&&this.triggerPointEvent("pointMove",e),this.isTouch||(this.titleTooltip(e,this.mouseX,this.mouseY),this.axisTooltip(e,this.mouseX,this.mouseY)),this.dataEditingModule&&this.dataEditingModule.pointMouseMove(e),this.notify(r.d.touchMoveEvent,e),this.isTouch=!1,!1}titleTooltip(e,t,i,n){const s=e.target.id,r=s===this.element.id+"_ChartTitle"||s===this.element.id+"_ChartSubTitle"||s.indexOf("_AxisTitle")>-1||s.indexOf("_legend_title")>-1;let a=0;s.indexOf("_AxisTitle")>-1&&(a=parseInt(s.replace(this.element.id,"").replace("AxisLabel_","").split("_")[2],10)),r&&e.target.textContent.indexOf("...")>-1?Ae(s===this.element.id+"_ChartTitle"?this.title:s.indexOf("_AxisTitle")>-1?this.axisCollections[a].title:s.indexOf("_ChartSubTitle")>-1?this.subTitle:this.legendSettings.title,t,i,this.element.offsetWidth,this.element.id+"_EJ2_Title_Tooltip",nt(this.element.id+"_Secondary_Element"),n):Oe(this.element.id+"_EJ2_Title_Tooltip")}axisTooltip(e,t,i,n){const s=e.target.id;if((s.indexOf("AxisLabel")>-1||s.indexOf("Axis_MultiLevelLabel")>-1)&&e.target.textContent.indexOf("...")>-1){const e=this.legendSettings.visible||""===this.primaryXAxis.title;Ae(this.findAxisLabel(s),t,i,this.element.offsetWidth,this.element.id+"_EJ2_AxisLabel_Tooltip",nt(this.element.id+"_Secondary_Element"),n,e)}else Oe(this.element.id+"_EJ2_AxisLabel_Tooltip")}findAxisLabel(e){let t;return e.indexOf("AxisLabel")>-1?(t=e.replace(this.element.id,"").replace("AxisLabel_","").split("_"),this.axisCollections[parseInt(t[0],10)].visibleLabels[parseInt(t[1],10)].originalText):(t=e.replace(this.element.id,"").replace("Axis_MultiLevelLabel_Level_","").replace("Text_","").split("_"),this.axisCollections[parseInt(t[0],10)].multiLevelLabels[parseInt(t[1],10)].categories[parseInt(t[2],10)].text)}chartOnMouseDown(e){let t,i,n,s;const a=r.d.isDevice?20:30,o=this.element.getBoundingClientRect();this.trigger("chartMouseDown",{target:e.target.id,x:this.mouseX,y:this.mouseY}),"touchstart"===e.type?(this.isTouch=!0,s=e,t=s.changedTouches[0].clientX,i=s.changedTouches[0].clientY,n=s.target):(this.isTouch="touch"===e.pointerType,t=e.clientX,i=e.clientY,n=e.target);const l=nt(this.svgId).getBoundingClientRect();return this.mouseDownX=this.previousMouseMoveX=t-o.left-Math.max(l.left-o.left,0),this.mouseDownY=this.previousMouseMoveY=i-o.top-Math.max(l.top-o.top,0),this.isTouch&&(this.isDoubleTap=(new Date).getTime()<this.threshold&&-1===n.id.indexOf(this.element.id+"_Zooming_")&&(this.mouseDownX-a>=this.mouseX||this.mouseDownX+a>=this.mouseX)&&(this.mouseDownY-a>=this.mouseY||this.mouseDownY+a>=this.mouseY)&&(this.mouseX-a>=this.mouseDownX||this.mouseX+a>=this.mouseDownX)&&(this.mouseY-a>=this.mouseDownY||this.mouseY+a>=this.mouseDownY)),this.dataEditingModule&&this.dataEditingModule.pointMouseDown(),this.notify(r.d.touchStartEvent,e),!1}mouseEnd(e){let t,i,n;return"touchend"===e.type?(n=e,i=n.changedTouches[0].clientX,this.isTouch=!0,t=n.changedTouches[0].clientY):(t=e.clientY,i=e.clientX,this.isTouch="touch"===e.pointerType||"2"===e.pointerType),this.setMouseXY(i,t),this.chartOnMouseUp(e),!1}chartOnMouseUp(e){return this.trigger("chartMouseUp",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.isChartDrag=!1,this.isTouch&&(this.titleTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.axisTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.threshold=(new Date).getTime()+300),this.dataEditingModule&&this.dataEditingModule.pointMouseUp(),!this.enableCanvas&&this.seriesElements&&this.seriesElements.removeAttribute("clip-path"),this.notify(r.d.touchEndEvent,e),!1}setCulture(){this.intl=new r.n,this.setLocaleConstants(),this.localeObject=new r.q(this.getModuleName(),this.defaultLocalConstants,this.locale)}setAnnotationValue(e,t){const i=nt(this.element.id+"_Annotation_Collections"),n=this.annotations[e];let s;null!==t&&(n.content=t,i?(Oe(this.element.id+"_Annotation_"+e),s=this.createElement("div"),this.annotationModule.processAnnotation(n,e,s),i.appendChild(s.children[0])):this.annotationModule.renderAnnotations(nt(this.element.id+"_Secondary_Element")))}setLocaleConstants(){this.defaultLocalConstants={ZoomIn:"Zoom in",Zoom:"Zoom",ZoomOut:"Zoom out",Pan:"Pan",Reset:"Reset",ResetZoom:"Reset Zoom"}}setTheme(){this.themeStyle=B(this.theme)}requiredModules(){let e,t=[],i=this.series,n=!1,s=!1,r=!1,a=!1,o=this.zoomSettings;return this.chartAreaType=i.length>0&&("Polar"===i[0].type||"Radar"===i[0].type)?"PolarRadar":"Cartesian",this.tooltip.enable&&t.push({member:"Tooltip",args:[this]}),i.map(n=>{this.isLegend=this.legendSettings.visible&&(""!==n.name||!!this.isLegend),e=-1!==n.type.indexOf("100")?n.type.replace("100","")+"Series":n.type+"Series",s=n.errorBar.visible||s,a=n.marker.dataLabel.visible||a,r=n.dragSettings.enable||r,t.some(t=>t.member===e)||t.push({member:e,args:[this,i]}),"PolarRadar"===this.chartAreaType&&t.push({member:n.drawType+"Series",args:[this,i]}),"Pareto"===n.type&&(t.push({member:"ColumnSeries",args:[this,i]}),t.push({member:"LineSeries",args:[this,i]}))}),this.findIndicatorModules(t),this.findTrendLineModules(t),t=this.findAxisModule(t),n=this.annotations.some(e=>null!==e.content),s&&t.push({member:"ErrorBar",args:[this,i]}),this.isLegend&&t.push({member:"Legend",args:[this]}),(this.enableExport||this.allowExport)&&t.push({member:"Export",args:[this]}),"PolarRadar"!==this.chartAreaType&&!this.scrollSettingEnabled&&(o.enableSelectionZooming||o.enableMouseWheelZooming||o.enablePinchZooming||o.enablePan||o.enableScrollbar)&&(t.push({member:"Zoom",args:[this,this.zoomSettings]}),o.enableScrollbar&&t.push({member:"ScrollBar",args:[this]})),"None"===this.selectionMode||"PolarRadar"===this.chartAreaType&&this.selectionMode.indexOf("Drag")>-1||t.push({member:"Selection",args:[this]}),"None"!==this.highlightMode&&t.push({member:"Highlight",args:[this]}),a&&t.push({member:"DataLabel",args:[this,i]}),r&&t.push({member:"DataEditing",args:[this]}),n&&t.push({member:"Annotation",args:[this]}),"PolarRadar"!==this.chartAreaType&&this.crosshair.enable&&t.push({member:"Crosshair",args:[this]}),t}findAxisModule(e){let t=[];t.push(this.primaryXAxis),t.push(this.primaryYAxis),t=t.concat(this.axes);let i=!1,n=!1,s=!1,r=!1,a=!1,o=!1;for(let l of t)i="DateTime"===l.valueType||i,n="Category"===l.valueType||n,s="Logarithmic"===l.valueType||s,a="DateTimeCategory"===l.valueType||a,r=this.findStriplineVisibility(l.stripLines)||r,o=l.multiLevelLabels.length>0||o,this.scrollSettingEnabled=!!l.scrollbarSettings.enable||this.scrollSettingEnabled;return i&&e.push({member:"DateTime",args:[this]}),n&&e.push({member:"Category",args:[this]}),s&&e.push({member:"Logarithmic",args:[this]}),r&&e.push({member:"StripLine",args:[this]}),o&&e.push({member:"MultiLevelLabel",args:[this]}),a&&e.push({member:"DateTimeCategory",args:[this]}),this.scrollSettingEnabled&&e.push({member:"ScrollBar",args:[this]}),e}findIndicatorModules(e){let t,i,n=this.indicators;if(this.indicators.length){e.push({member:"LineSeries",args:[this]}),n.map(e=>{t=t||"Macd"===e.type,i=i||"BollingerBands"===e.type}),t&&e.push({member:"ColumnSeries",args:[this]}),i&&e.push({member:"RangeAreaSeries",args:[this]}),i&&e.push({member:"SplineRangeAreaSeries",args:[this]});for(let t of this.indicators)e.push({member:t.type+"Indicator",args:[this]})}}findTrendLineModules(e){let t,i;for(let n of this.series){let s;n.trendlines.map(e=>{s=s||e.marker.visible,t=!(!t&&"Linear"!==e.type&&"MovingAverage"!==e.type),i=!(!i&&t)}),s&&e.push({member:"Marker",args:[this,n]})}(t||i)&&e.push({member:"TrendLine",args:[this]}),t&&e.push({member:"LineSeries",args:[this]}),i&&e.push({member:"SplineSeries",args:[this]})}findStriplineVisibility(e){let t=!1;for(let i of e)if(i.visible){t=!0;break}return t}removeSvg(){if(this.redraw)return null;if(Tt(this),this.enableCanvas&&this.svgObject&&"CANVAS"===this.svgObject.tagName)return this.renderer.clearRect(new C(0,0,this.availableSize.width,this.availableSize.height)),this.svgObject.parentNode&&Object(r.kb)(this.svgObject),null;Oe(this.element.id+"_Secondary_Element"),this.isReact&&this.clearTemplate();let e=0;if(this.zoomModule&&this.zoomModule.pinchTarget&&(this.zoomModule.pinchTarget.id="",this.zoomModule.pinchTarget.setAttribute("opacity","0"),this.svgObject.appendChild(this.zoomModule.pinchTarget),e=1),!Object(r.Z)(this.resizeTo)){if(this.resizeTo!==this.checkResize&&this.isBlazor&&this.element.childElementCount){let e=document.querySelectorAll(".e-chart");for(let t=0;t<e.length;t++){let i=e[t];for(;i.firstChild;)Object(r.kb)(i.firstChild)}}this.checkResize=this.resizeTo}if(this.svgObject){for(;this.svgObject.childNodes.length>e;)this.svgObject.removeChild(this.svgObject.firstChild);this.svgObject.hasChildNodes()||!this.svgObject.parentNode||this.stockChart||Object(r.kb)(this.svgObject)}}refreshDefinition(e){for(let t of e)t.axes=[]}refreshAxis(){let e=this.primaryXAxis;e.rect=new C(void 0,void 0,0,0),e=this.primaryYAxis,e.isStack100=!1,e.rect=new C(void 0,void 0,0,0);for(let t of this.axes)e=t,e.rect=new C(void 0,void 0,0,0),e.isStack100=!1;if(this.paretoSeriesModule&&"Pareto"===this.series[0].type)for(let t of this.paretoSeriesModule.paretoAxes)e=t,e.rect=new C(void 0,void 0,0,0),e.isStack100=!1}axisChange(e){return!(!e.name&&!e.valueType||(this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(),0))}getVisibleSeries(e,t){for(let i of e)if(t===i.index)return i;return null}refreshLiveData(){this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(!1),this.isBlazor||(this.enableCanvas?this.createChartSvg():this.removeSvg(),this.refreshAxis(),this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}))}removeStyles(){Oe(this.element.id+"_ej2_chart_selection"),Oe(this.element.id+"_ej2_chart_highlight")}onPropertyChanged(e,t){let i=!1,n=!1;if(this.animateSeries=!1,!this.delayRedraw){for(let s of Object.keys(e))switch(s){case"primaryXAxis":n=this.axisChange(e.primaryXAxis),e.primaryXAxis.edgeLabelPlacement&&(i=!0),e.primaryXAxis.crosshairTooltip||(n=!0);break;case"primaryYAxis":n=this.axisChange(e.primaryYAxis),e.primaryYAxis.edgeLabelPlacement&&(i=!0),e.primaryYAxis.crosshairTooltip||(n=!0);break;case"axes":for(let t of Object.keys(e.axes))n=n||this.axisChange(e.axes[t]),e.axes[t].crosshairTooltip||(n=!0);break;case"height":case"width":this.createChartSvg(),n=!0;break;case"subTitle":case"title":n=!0;break;case"titleStyle":e.titleStyle&&(e.titleStyle.size||e.titleStyle.textOverflow)?n=!0:i=!0;break;case"subTitleStyle":e.subTitleStyle&&(e.subTitleStyle.size||e.subTitleStyle.textOverflow)?n=!0:i=!0;break;case"border":i=!0;break;case"dataSource":this.processData(!1),n=!0;break;case"enableCanvas":this.refresh();break;case"series":let s,a,o=this.series.length,l=!1;for(let i=0;i<o;i++)s=e.series[i],this.isBlazor&&s&&(s.visible!==t.series[i].visible||s.isClosed||s.marker||s.emptyPointSettings||s.type||s.boxPlotMode||s.showMean)&&(a=!0),s&&(s.dataSource||s.query||s.errorBar||s.xName||s.yName||s.size||s.high||s.low||s.open||s.close||s.fill||s.name||s.marker||a)&&(Object(r.L)(this.getVisibleSeries(this.visibleSeries,i),s,null,!0),l=!0);l&&(this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(!1),n=!0);break;case"indicators":n=!0;break;case"zoomSettings":(e.zoomSettings.enableScrollbar||t.zoomSettings.enableScrollbar)&&(n=!0),i=!0;break;case"background":i=!0;break;case"chartArea":e.chartArea.border&&e.chartArea.border.width&&(n=!0),i=!0;break;case"legendSettings":e.legendSettings.background&&e.legendSettings.opacity||(n=!0),i=!0;break;case"palettes":this.calculateVisibleSeries(),i=!0;break;case"selectedDataIndexes":this.selectionModule&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.selectedDataIndexes=this.selectedDataIndexes,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode,!0));break;case"selectionMode":this.selectionModule&&e.selectionMode&&-1===e.selectionMode.indexOf("Drag")&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode,!0));break;case"isMultiSelect":this.selectionModule&&!e.isMultiSelect&&this.selectionModule.selectedDataIndexes.length>1&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode));break;case"highlightMode":case"selectionPattern":case"highlightPattern":this.removeStyles(),i=!0;break;case"theme":this.animateSeries=!0;break;case"locale":case"currencyCode":this.isBlazor?(this.setCulture(),i=!0):this.refresh();break;case"tooltip":this.tooltipModule&&(this.tooltipModule.previousPoints=[])}!n&&i&&(this.removeSvg(),this.renderElements(),this.trigger("loaded",{chart:this.isBlazor?{}:this})),n&&(this.enableCanvas?this.createChartSvg():this.removeSvg(),this.isReact&&this.clearTemplate(),this.refreshAxis(),this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}),this.redraw=!1,this.animated=!1)}}};return pi([Object(r.t)(null)],e.prototype,"width",void 0),pi([Object(r.t)(null)],e.prototype,"height",void 0),pi([Object(r.t)("")],e.prototype,"title",void 0),pi([Object(r.t)("")],e.prototype,"dataSource",void 0),pi([Object(r.g)(F.chartTitleFont,z)],e.prototype,"titleStyle",void 0),pi([Object(r.t)("")],e.prototype,"subTitle",void 0),pi([Object(r.g)(F.chartSubTitleFont,z)],e.prototype,"subTitleStyle",void 0),pi([Object(r.g)({},W)],e.prototype,"margin",void 0),pi([Object(r.g)({color:"#DDDDDD",width:0},V)],e.prototype,"border",void 0),pi([Object(r.t)(null)],e.prototype,"background",void 0),pi([Object(r.g)({border:{color:null,width:.5},background:"transparent"},q)],e.prototype,"chartArea",void 0),pi([Object(r.g)({name:"primaryXAxis"},ve)],e.prototype,"primaryXAxis",void 0),pi([Object(r.g)({name:"primaryYAxis"},ve)],e.prototype,"primaryYAxis",void 0),pi([Object(r.f)([{}],ge)],e.prototype,"rows",void 0),pi([Object(r.f)([{}],ue)],e.prototype,"columns",void 0),pi([Object(r.f)([{}],ve)],e.prototype,"axes",void 0),pi([Object(r.f)([{}],ei)],e.prototype,"series",void 0),pi([Object(r.f)([{}],re)],e.prototype,"annotations",void 0),pi([Object(r.t)([])],e.prototype,"palettes",void 0),pi([Object(r.t)("Material")],e.prototype,"theme",void 0),pi([Object(r.g)({},Q)],e.prototype,"tooltip",void 0),pi([Object(r.g)({},ui)],e.prototype,"crosshair",void 0),pi([Object(r.g)({},ai)],e.prototype,"legendSettings",void 0),pi([Object(r.f)([{}],gi)],e.prototype,"rangeColorSettings",void 0),pi([Object(r.g)({},mi)],e.prototype,"zoomSettings",void 0),pi([Object(r.t)("None")],e.prototype,"selectionMode",void 0),pi([Object(r.t)("None")],e.prototype,"highlightMode",void 0),pi([Object(r.t)("None")],e.prototype,"selectionPattern",void 0),pi([Object(r.t)("None")],e.prototype,"highlightPattern",void 0),pi([Object(r.t)(!1)],e.prototype,"isMultiSelect",void 0),pi([Object(r.t)(!1)],e.prototype,"allowMultiSelection",void 0),pi([Object(r.t)(!0)],e.prototype,"enableExport",void 0),pi([Object(r.t)(!1)],e.prototype,"allowExport",void 0),pi([Object(r.f)([],Y)],e.prototype,"selectedDataIndexes",void 0),pi([Object(r.t)(!1)],e.prototype,"useGroupingSeparator",void 0),pi([Object(r.t)(!1)],e.prototype,"enableAutoIntervalOnBothAxis",void 0),pi([Object(r.t)(!1)],e.prototype,"isTransposed",void 0),pi([Object(r.t)(!1)],e.prototype,"enableCanvas",void 0),pi([Object(r.t)(null)],e.prototype,"backgroundImage",void 0),pi([Object(r.f)([],ci)],e.prototype,"indicators",void 0),pi([Object(r.t)(!0)],e.prototype,"enableAnimation",void 0),pi([Object(r.t)(null)],e.prototype,"description",void 0),pi([Object(r.t)(1)],e.prototype,"tabIndex",void 0),pi([Object(r.t)(!0)],e.prototype,"enableSideBySidePlacement",void 0),pi([Object(r.k)()],e.prototype,"resized",void 0),pi([Object(r.k)()],e.prototype,"beforeResize",void 0),pi([Object(r.k)()],e.prototype,"annotationRender",void 0),pi([Object(r.k)()],e.prototype,"beforePrint",void 0),pi([Object(r.k)()],e.prototype,"loaded",void 0),pi([Object(r.k)()],e.prototype,"beforeExport",void 0),pi([Object(r.k)()],e.prototype,"afterExport",void 0),pi([Object(r.k)()],e.prototype,"load",void 0),pi([Object(r.k)()],e.prototype,"animationComplete",void 0),pi([Object(r.k)()],e.prototype,"legendRender",void 0),pi([Object(r.k)()],e.prototype,"textRender",void 0),pi([Object(r.k)()],e.prototype,"pointRender",void 0),pi([Object(r.k)()],e.prototype,"seriesRender",void 0),pi([Object(r.k)()],e.prototype,"axisLabelRender",void 0),pi([Object(r.k)()],e.prototype,"axisLabelClick",void 0),pi([Object(r.k)()],e.prototype,"axisRangeCalculated",void 0),pi([Object(r.k)()],e.prototype,"axisMultiLabelRender",void 0),pi([Object(r.k)()],e.prototype,"legendClick",void 0),pi([Object(r.k)()],e.prototype,"multiLevelLabelClick",void 0),pi([Object(r.k)()],e.prototype,"tooltipRender",void 0),pi([Object(r.k)()],e.prototype,"sharedTooltipRender",void 0),pi([Object(r.k)()],e.prototype,"chartMouseMove",void 0),pi([Object(r.k)()],e.prototype,"chartMouseClick",void 0),pi([Object(r.k)()],e.prototype,"pointClick",void 0),pi([Object(r.k)()],e.prototype,"pointDoubleClick",void 0),pi([Object(r.k)()],e.prototype,"pointMove",void 0),pi([Object(r.k)()],e.prototype,"chartMouseLeave",void 0),pi([Object(r.k)()],e.prototype,"chartMouseDown",void 0),pi([Object(r.k)()],e.prototype,"chartMouseUp",void 0),pi([Object(r.k)()],e.prototype,"dragComplete",void 0),pi([Object(r.k)()],e.prototype,"selectionComplete",void 0),pi([Object(r.k)()],e.prototype,"zoomComplete",void 0),pi([Object(r.k)()],e.prototype,"onZooming",void 0),pi([Object(r.k)()],e.prototype,"scrollStart",void 0),pi([Object(r.k)()],e.prototype,"scrollEnd",void 0),pi([Object(r.k)()],e.prototype,"scrollChanged",void 0),pi([Object(r.k)()],e.prototype,"dragStart",void 0),pi([Object(r.k)()],e.prototype,"drag",void 0),pi([Object(r.k)()],e.prototype,"dragEnd",void 0),pi([Object(r.t)("USD")],e.prototype,"currencyCode",void 0),e=pi([r.r],e),e})();class bi extends te{calculateDateTimeNiceInterval(e,t,i,n,s=!0){const r=new Date(i),a=new Date(n),o=Math.abs((r.getTime()-a.getTime())/864e5);let l;switch(e.actualIntervalType=e.intervalType,e.intervalType){case"Years":l=this.calculateNumericNiceInterval(e,o/365,t);break;case"Quarter":l=this.calculateNumericNiceInterval(e,o/365*4,t);break;case"Months":l=this.calculateNumericNiceInterval(e,o/30,t);break;case"Weeks":l=this.calculateNumericNiceInterval(e,o/7,t);break;case"Days":l=this.calculateNumericNiceInterval(e,o,t);break;case"Hours":l=this.calculateNumericNiceInterval(e,24*o,t);break;case"Minutes":l=this.calculateNumericNiceInterval(e,24*o*60,t);break;case"Seconds":l=this.calculateNumericNiceInterval(e,24*o*60*60,t);break;case"Auto":return l=this.calculateNumericNiceInterval(e,o/365,t),l>=1?(e.actualIntervalType="Years",l):(l=this.calculateNumericNiceInterval(e,o/365*4,t),l>=1&&!s?(e.actualIntervalType="Quarter",l):(l=this.calculateNumericNiceInterval(e,o/30,t),l>=1?(e.actualIntervalType="Months",l):(l=this.calculateNumericNiceInterval(e,o/7,t),l>=1&&!s?(e.actualIntervalType="Weeks",l):(l=this.calculateNumericNiceInterval(e,o,t),l>=1?(e.actualIntervalType="Days",l):(l=this.calculateNumericNiceInterval(e,24*o,t),l>=1?(e.actualIntervalType="Hours",l):(l=this.calculateNumericNiceInterval(e,24*o*60,t),l>=1?(e.actualIntervalType="Minutes",l):(l=this.calculateNumericNiceInterval(e,24*o*60*60,t),e.actualIntervalType="Seconds",l)))))))}return l}getSkeleton(e,t,i,n){let s;const r=e.actualIntervalType;return e.skeleton?e.skeleton:(s="Years"===r?n?"y":e.isChart?"DateTime"===e.valueType&&e.isIntervalInDecimal?"y":"yMMM":"y":"Quarter"===r?n?"y":"yMMM":"Months"===r?n?"m":e.isChart?"MMMd":"MMM":"Weeks"===r?n?"m":"MEd":"Days"===r?n?"d":e.isChart?this.getDayFormat(e,t,i):"MMMd":"Hours"===r?n?"t":e.isChart?"DateTime"===e.valueType?"Hm":"EHm":"h":"Minutes"===r?n?"T":e.isChart?"Hms":"hm":n?"T":e.isChart?"Hms":"hms",s)}getMonthFormat(e,t,i){return new Date(t).getFullYear()===new Date(i).getFullYear()?e.isIntervalInDecimal?"MMM":"MMM d":"y MMM"}getDayFormat(e,t,i){return"DateTime"===e.valueType?new Date(t).getMonth()!==new Date(i).getMonth()?"MMMd":e.isIntervalInDecimal?"d":"Ehm":"yMd"}findCustomFormats(e,t,i){let n=e.labelFormat?e.labelFormat:"";return!e.isChart||e.skeleton||"Months"!==e.actualIntervalType||n||(n="DateTime"===e.valueType?this.getMonthFormat(e,t,i):"yMMM"),n}}class yi{constructor(e){this.chart=e}enableComplexProperty(e){const t=[],i=[],n=e.xAxis.visibleRange,s=e.yAxis.visibleRange,a=e.points,o=e.clipRect,l=Math.abs(n.delta/o.width),h=Math.abs(s.delta/o.height);let c,d=a[0]&&a[0].x>l?0:l,p=a[0]&&a[0].y>h?0:h,g=0,u=0;for(const r of a)r.symbolLocations=[],g=r.xValue?r.xValue:n.min,u=r.yValue?r.yValue:s.min,(Math.abs(d-g)>=l||Math.abs(p-u)>=h)&&(t.push(r),d=g,p=u);for(let m=0;m<t.length;m++)c=t[m],Object(r.Z)(c.x)||""===c.x||i.push(c);return i}getLineDirection(e,t,i,n,s,r){let a="";if(null!=e){const o=s(e.xValue,e.yValue,i.xAxis,i.yAxis,n,i),l=s(t.xValue,t.yValue,i.xAxis,i.yAxis,n,i);a=r+" "+o.x+" "+o.y+" L "+l.x+" "+l.y+" "}return a}appendLinePath(e,t,i){const n=nt(e.id),s=t.chart,r=n?n.getAttribute("d"):null,a=t.chart.renderer.drawPath(e,new Int32Array([t.clipRect.x,t.clipRect.y]));a&&a.setAttribute("clip-path",i),t.pathElement=a,t.chart.enableCanvas||t.seriesElement.appendChild(a),t.isRectSeries=!1,Xe(n,e.d,t.chart.redraw,r,s.duration)}renderMarker(e){e.marker&&e.marker.visible&&e.chart.markerRender.render(e)}doProgressiveAnimation(e,t){const i=new r.b({}),n=e.pathElement,s=n.getAttribute("stroke-dasharray"),a=e.pathElement.getTotalLength();let o;n.style.visibility="hidden",i.animate(n,{duration:t.duration,delay:t.delay,progress:e=>{e.timeStamp>=e.delay&&(n.style.visibility="visible",o=Math.abs(Math.round((e.timeStamp-e.delay)*a/e.duration)),n.setAttribute("stroke-dasharray",o+","+a))},end:()=>{n.setAttribute("stroke-dasharray",s),e.chart.trigger("animationComplete",{series:e.chart.isBlazor?{}:e})}})}storePointLocation(e,t,i,n){const s=t.marker&&t.marker.width?t.marker.width:0,r=t.marker&&t.marker.height?t.marker.height:0;e.symbolLocations.push(n(e.xValue,e.yValue,t.xAxis,t.yAxis,i,t)),e.regions.push(new C(e.symbolLocations[0].x-s,e.symbolLocations[0].y-r,2*s,2*r))}withinYRange(e,t){return e.yValue>=t.visibleRange.min&&e.yValue<=t.visibleRange.max}getFirstLastVisiblePoint(e){let t=null,i=null;for(const n of e)null===t&&n.visible&&(t=i=n),i=n.visible?n:i;return{first:t||e[0],last:i||e[e.length-1]}}doLinearAnimation(e,t){const i=e.clipRectElement.childNodes[0].childNodes[0],n=e.chart.animated?e.chart.duration:t.duration,s=Ze("Linear"),a=+i.getAttribute("height"),o=+i.getAttribute("width"),l=+i.getAttribute("x"),h=e.chart.requireInvertedAxis?+i.getAttribute("height")+ +i.getAttribute("y"):+i.getAttribute("y");let c;i.style.visibility="hidden",new r.b({}).animate(i,{duration:n,delay:t.delay,progress:t=>{t.timeStamp>=t.delay&&(i.style.visibility="visible",e.chart.requireInvertedAxis?(c=s(t.timeStamp-t.delay,0,a,t.duration),i.setAttribute("transform","translate("+l+" "+h+") scale(1,"+c/a+") translate("+-l+" "+-h+")")):(c=s(t.timeStamp-t.delay,0,o,t.duration),i.setAttribute("transform","translate("+l+" "+h+") scale("+c/o+", 1) translate("+-l+" "+-h+")")))},end:()=>{i.setAttribute("transform","translate(0,0)"),e.chart.trigger("animationComplete",{series:e.chart.isBlazor?{}:e})}})}}class xi{getSideBySideInfo(e){e.chart.enableSideBySidePlacement&&!e.position&&this.getSideBySidePositions(e);const t=e.chart.enableSideBySidePlacement?e.position:0,i=e.chart.enableSideBySidePlacement?e.rectCount:1;e.isRectSeries=!0;const n=e.chart.visibleSeries,s=e.chart.enableSideBySidePlacement?e.columnSpacing:0,r=null===e.columnWidth||isNaN(+e.columnWidth)?"Histogram"===e.type?1:.7:e.columnWidth,a=We(e.xAxis,n)*r;let o;const l=t/i-.5;let h=new ee(l,l+1/i);return isNaN(h.start)||isNaN(h.end)||(h=new ee(h.start*a,h.end*a),o=s*h.delta,h=new ee(h.start+o/2,h.end-o/2)),h}getRectangle(e,t,i,n,s){const r=ht(e,t,s.xAxis,s.yAxis,s.chart.requireInvertedAxis),a=ht(i,n,s.xAxis,s.yAxis,s.chart.requireInvertedAxis);return new C(Math.min(r.x,a.x),Math.min(r.y,a.y),Math.abs(a.x-r.x),Math.abs(a.y-r.y))}getSideBySidePositions(e){const t=e.chart;for(const i of t.columns)for(const n of t.rows)this.findRectPosition(e.findSeriesCollection(i,n,!1))}findRectPosition(e){const t=[],i={rectCount:0,position:null};for(let n=0;n<e.length;n++){const s=e[n];-1!==s.type.indexOf("Stacking")?s.stackingGroup?void 0===t[s.stackingGroup]?(s.position=i.rectCount,t[s.stackingGroup]=i.rectCount++):s.position=t[s.stackingGroup]:null===i.position?(s.position=i.rectCount,i.position=i.rectCount++):s.position=i.position:s.position=i.rectCount++}for(let n=0;n<e.length;n++)e[n].rectCount=i.rectCount}updateSymbolLocation(e,t,i){i.chart.requireInvertedAxis?this.updateYRegion(e,t,i):this.updateXRegion(e,t,i),"Histogram"===i.type&&(e.minimum=+e.x-i.histogramValues.binWidth/2,e.maximum=+e.x+i.histogramValues.binWidth/2)}updateXRegion(e,t,i){e.symbolLocations.push({x:t.x+t.width/2,y:"BoxPlot"===i.seriesType||-1!==i.seriesType.indexOf("HighLow")||e.yValue>=0==!i.yAxis.isInversed?t.y:t.y+t.height}),this.getRegion(e,t,i),"RangeColumn"===i.type&&e.symbolLocations.push({x:t.x+t.width/2,y:t.y+t.height})}updateYRegion(e,t,i){e.symbolLocations.push({x:"BoxPlot"===i.seriesType||-1!==i.seriesType.indexOf("HighLow")||e.yValue>=0==!i.yAxis.isInversed?t.x+t.width:t.x,y:t.y+t.height/2}),this.getRegion(e,t,i),"RangeColumn"===i.type&&e.symbolLocations.push({x:t.x,y:t.y+t.height/2})}renderMarker(e){e.marker&&e.marker.visible&&e.chart.markerRender.render(e)}getRegion(e,t,i){if(0===e.y){const t=i.marker&&i.marker.width?i.marker.width:0,n=i.marker&&i.marker.height?i.marker.height:0;e.regions.push(new C(e.symbolLocations[0].x-t,e.symbolLocations[0].y-n,2*t,2*n))}else e.regions.push(t)}triggerEvent(e,t,i,n){const s={cancel:!1,name:"pointRender",series:e,point:t,fill:e.setPointColor(t,i),border:e.setBorderColor(t,n)};return e.chart.trigger("pointRender",s),t.color=s.fill,s}drawRectangle(e,t,i,n){const s=e.chart;if((s.requireInvertedAxis?i.height:i.width)<=0)return null;let r;r=0===t.y?this.calculateRoundedRectPath(i,0,0,0,0):this.calculateRoundedRectPath(i,e.cornerRadius.topLeft,e.cornerRadius.topRight,e.cornerRadius.bottomLeft,e.cornerRadius.bottomRight);const a="Indicator"===e.category?s.element.id+"_Indicator_"+e.index+"_"+e.name+"_Point_"+t.index:s.element.id+"_Series_"+e.index+"_Point_"+t.index,o=wt(s.redraw,a),l=o?o.getAttribute("d"):"",h=new A(a,n.fill,n.border.width,n.border.color,e.opacity,e.dashArray,r),c=s.renderer.drawPath(h,new Int32Array([e.clipRect.x,e.clipRect.y]));switch(e.seriesType){case"XY":c.setAttribute("aria-label",t.x.toString()+":"+t.yValue.toString());break;case"HighLow":c.setAttribute("aria-label",t.x.toString()+":"+t.high.toString()+":"+t.low.toString())}ct(e.chart.enableCanvas,e.seriesElement,c,s.redraw),e.chart.enableCanvas||Xe(c,r,s.redraw,l,s.duration)}animate(e){const t=e.seriesElement.childNodes;let i="Indicator"===e.category?0:1;const n=Ie(e);for(const s of n)(s.symbolLocations.length||"BoxAndWhisker"===e.type&&s.regions.length)&&(this.animateRect(t[i],e,s),i++)}animateRect(e,t,i){const n=t.animation,s=t.chart.animated?t.chart.duration:n.duration,a=Ze("Linear"),o=i.yValue<0;let l,h,c,d,p,g=+i.regions[0].height,u=+i.regions[0].width;t.chart.requireInvertedAxis?(h=+i.regions[0].y,t.type.indexOf("Stacking")>-1?(l=He(0,t.yAxis)*t.yAxis.rect.width,c=l,d=h):(l=+i.regions[0].x,d=o?h:h+g,c=-1!==t.seriesType.indexOf("HighLow")||-1!==t.type.indexOf("Waterfall")?l+u/2:o!==t.yAxis.isInversed?l+u:l)):(l=+i.regions[0].x,t.type.indexOf("Stacking")>-1?(h=(1-He(0,t.yAxis))*t.yAxis.rect.height,c=l,d=h):(h=+i.regions[0].y,d=-1!==t.seriesType.indexOf("HighLow")||-1!==t.type.indexOf("Waterfall")?h+g/2:o!==t.yAxis.isInversed?h:h+g,c=o?l:l+u)),Object(r.Z)(e)||(e.style.visibility="hidden",new r.b({}).animate(e,{duration:s,delay:n.delay,progress:i=>{i.timeStamp>=i.delay&&(e.style.visibility="visible",t.chart.requireInvertedAxis?(u=u||1,p=a(i.timeStamp-i.delay,0,u,i.duration),e.setAttribute("transform","translate("+c+" "+d+") scale("+p/u+", 1) translate("+-c+" "+-d+")")):(g=g||1,p=a(i.timeStamp-i.delay,0,g,i.duration),e.setAttribute("transform","translate("+c+" "+d+") scale(1,"+p/g+") translate("+-c+" "+-d+")")))},end:()=>{e.setAttribute("transform","translate(0,0)");const n=t.seriesElement;if((e===n.lastElementChild||i.index===t.points.length-1||"Waterfall"===t.type&&e===n.children[n.childElementCount-2])&&(t.chart.trigger("animationComplete",{series:t.chart.isBlazor?{}:t}),"Waterfall"===t.type)){const e=n.childNodes;for(let t=0;t<e.length;t++)-1!==e[t].id.indexOf("Connector")&&(e[t].style.visibility="visible",e[t].setAttribute("transform","translate(0,0)"))}}}))}calculateRoundedRectPath(e,t,i,n,s){return"M "+e.x+" "+(t+e.y)+" Q "+e.x+" "+e.y+" "+(e.x+t)+" "+e.y+" L "+(e.x+e.width-i)+" "+e.y+" Q "+(e.x+e.width)+" "+e.y+" "+(e.x+e.width)+" "+(e.y+i)+" L "+(e.x+e.width)+" "+(e.y+e.height-s)+" Q "+(e.x+e.width)+" "+(e.y+e.height)+" "+(e.x+e.width-s)+" "+(e.y+e.height)+" L "+(e.x+n)+" "+(e.y+e.height)+" Q "+e.x+" "+(e.y+e.height)+" "+e.x+" "+(e.y+e.height-n)+" L "+e.x+" "+(t+e.y)+" Z"}}class Ci extends yi{getAreaPathDirection(e,t,i,n,s,r,a){let o,l="";return null===r&&(o=s(e,t,i.xAxis,i.yAxis,n,i),l+=a+" "+o.x+" "+o.y+" "),l}getAreaEmptyDirection(e,t,i,n,s){let r="";return r+=this.getAreaPathDirection(e.x,e.y,i,n,s,null,"L"),r+=this.getAreaPathDirection(t.x,t.y,i,n,s,null,"L"),r}setPointColor(e,t,i,n,s){if(""===i.pointColorMapping){let t,r;for(let a=0;a<s.length;a++)if(t=s[a],r=n?e.xValue:e.yValue,r<=this.getAxisValue(t.value,n?i.xAxis:i.yAxis,i.chart)||!t.value){e.interior=t.color;break}return null==e.interior&&(e.interior=i.interior),!1}return!!t&&i.setPointColor(e,i.interior)!==i.setPointColor(t,i.interior)}sortSegments(e,t){const i="X"===e.segmentAxis?e.xAxis:e.yAxis;return[].concat(t).sort((t,n)=>this.getAxisValue(t.value,i,e.chart)-this.getAxisValue(n.value,i,e.chart))}applySegmentAxis(e,t,i){if(""!==e.pointColorMapping)return t.map(t=>{this.appendLinePath(t,e,"")}),null;const n="X"===e.segmentAxis,s=n?e.xAxis:e.yAxis,r=e.chart;let a;this.includeSegment(i,s,e,i.length);const o=i.length;let l,h,c;for(let d=0;d<o;d++)a=i[d],l=this.getAxisValue(a.value,s,e.chart),h=this.createClipRect(d?this.getAxisValue(i[d-1].value,s,e.chart):s.visibleRange.min,l,e,d,n),h&&t.map(t=>{c={"clip-path":h,"stroke-dasharray":a.dashArray,opacity:t.opacity,stroke:e.type.indexOf("Line")>-1?a.color||e.interior:e.border.color,"stroke-width":t["stroke-width"],fill:e.type.indexOf("Line")>-1?"none":a.color||e.interior,id:t.id+"_Segment_"+d,d:t.d},Xe(nt(c.id),c.d,r.redraw),e.seriesElement.appendChild(r.renderer.drawPath(c))})}includeSegment(e,t,i,n){if(n<=0)return e.push({value:t.visibleRange.max,color:i.interior}),null;this.getAxisValue(e[n-1].value,t,i.chart)<t.visibleRange.max&&e.push({value:t.visibleRange.max,color:i.interior})}createClipRect(e,t,i,n,s){const r=i.chart.requireInvertedAxis;let a,o=ht(s?e:i.xAxis.visibleRange.min,s?i.yAxis.visibleRange.max:t,i.xAxis,i.yAxis,r),l=ht(s?t:i.xAxis.visibleRange.max,s?i.yAxis.visibleRange.min:e,i.xAxis,i.yAxis,r);return l=r?[o,o=l][0]:l,l.x-o.x>0&&l.y-o.y>0?(a=new Dt(i.chart.element.id+"_ChartSegment"+i.index+"ClipRect_"+n,"transparent",{width:1,color:"Gray"},1,{x:o.x,y:o.y,width:l.x-o.x,height:l.y-o.y}),i.seriesElement.appendChild($e(i.chart.redraw,a,i.chart.renderer)),"url(#"+i.chart.element.id+"_ChartSegment"+i.index+"ClipRect_"+n+")"):null}getAxisValue(e,t,i){if(null===e&&(e=t.visibleRange.max),"DateTime"===t.valueType){const t={skeleton:"full",type:"dateTime"};return Date.parse(i.intl.getDateParser(t)(i.intl.getDateFormat(t)(new Date(a.c.parse.parseJson({val:e}).val))))}if(t.valueType.indexOf("Category")>-1){const i="DateTimeCategory"===t.valueType?e.getTime().toString():e;return t.labels.indexOf(i)<0?+e:t.labels.indexOf(i)}return+e}}class vi extends qt{constructor(e){super(e),this.element=this.chart.element,this.textStyle=e.tooltip.textStyle,this.control=e}getElement(e){return document.getElementById(e)}getTooltipElement(e){this.inverted=this.chart.requireInvertedAxis,this.header=null===this.control.tooltip.header?this.control.tooltip.shared?"<b>${point.x}</b>":"<b>${series.name}</b>":this.control.tooltip.header,this.formattedText=[];const t=document.getElementById(this.chart.element.id+"_tooltip"),i=this.chart.element.id.indexOf("stockChart")>-1;return!e&&!t||i?this.createElement():null}createElement(){const e=document.createElement("div");return e.id=this.element.id+"_tooltip",e.className="ejSVGTooltip",e.setAttribute("style","pointer-events:none; position:absolute;z-index: 1"),e}pushData(e,t,i,n){return!!e.series.enableTooltip&&(this.currentPoints.push(e),this.stopAnimation(),i&&!document.getElementById(i.id)&&(this.chart.stockChart?document.getElementById(this.chart.stockChart.element.id+"_Secondary_Element").appendChild(i):document.getElementById(this.element.id+"_Secondary_Element").appendChild(i)),!0)}removeHighlight(){let e,t;for(let i=0,n=this.previousPoints.length;i<n;i++)e=this.previousPoints[i],e.series.isRectSeries?e.series.visible&&this.highlightPoint(e.series,e.point.index,!1):(t=e.series,t.marker.visible||"Scatter"===e.series.type||"Bubble"===e.series.type||(this.previousPoints.shift(),n-=1))}highlightPoint(e,t,i){const n=this.getElement(this.element.id+"_Series_"+e.index+"_Point_"+t),s=this.control.accumulationSelectionModule,r=!!(s&&s.selectedDataIndexes.length>0);n&&(!r||r&&n.getAttribute("class")&&-1===n.getAttribute("class").indexOf("_ej2_chart_selection_series_")?n.setAttribute("opacity",(i?e.opacity/2:e.opacity).toString()):n.setAttribute("opacity",e.opacity.toString()))}highlightPoints(){for(const e of this.currentPoints)e.series.isRectSeries&&"Series"===e.series.category&&this.highlightPoint(e.series,e.point.index,!0)}createTooltip(e,t,i,n,s,r,a,o,l=null,h=null,c){const d=this.currentPoints[0].series,p=e.tooltipModule||e.accumulationTooltipModule;if(!p)return;let g=d.isRectSeries&&"Waterfall"!==d.type&&s&&s.y<0,u=this.chart.requireInvertedAxis&&d.isRectSeries,m=null;if(this.text.length<=1){let t,n,a=c||e.tooltip.template;if(a&&"chart"===e.getModuleName()&&"#"!==a[0]&&"string"==typeof a){const e=document.createElement("div");e.id="testing_template",e.className="ejSVGTooltip",e.setAttribute("style","pointer-events:none; position:absolute;z-index: 1"),document.getElementById(this.chart.element.id+"_Secondary_Element").appendChild(e);const i=a.replaceAll("${x}",s.x).replaceAll("${y}",s.y);e.innerHTML=i,t=new x(e.firstElementChild.offsetWidth,e.firstElementChild.offsetHeight),n=new x(0,0),e.remove()}else t=b(this.text[0],e.tooltip.textStyle),n=""!==this.header&&"<b></b>"!==this.header?b(this.header,this.textStyle):new x(0,0);const l=47;t.width=Math.max(t.width,n.width)+(r.length>0?l:0),t.height=t.height+n.height+(32+(n.height>0?20:0)),m=this.getCurrentPosition(g,u),m=this.getPositionBySize(t,new C(0,0,o.width,o.height),i,m),g="Left"===m||"Bottom"===m,u="Left"===m||"Right"===m}t?this.svgTooltip=new M({opacity:e.tooltip.opacity,header:this.headerText,content:this.text,fill:e.tooltip.fill,border:e.tooltip.border,enableAnimation:e.tooltip.enableAnimation,location:i,shared:e.tooltip.shared,shapes:r,clipBounds:"PolarRadar"===this.chart.chartAreaType?new Pt(0,0):n,areaBounds:o,palette:this.findPalette(),template:c||e.tooltip.template,data:h,theme:e.theme,offset:a,textStyle:e.tooltip.textStyle,isNegative:g,inverted:u,arrowPadding:this.text.length>1||this.chart.stockChart?0:12,availableSize:e.availableSize,duration:this.chart.tooltip.duration,isCanvas:this.chart.enableCanvas,isTextWrap:e.tooltip.enableTextWrap&&"chart"===e.getModuleName(),blazorTemplate:{name:"Template",parent:this.chart.tooltip},controlInstance:this.chart,tooltipPlacement:m,tooltipRender:()=>{p.removeHighlight(),p.highlightPoints(),p.updatePreviousPoint(l)},animationComplete:e=>{e.tooltip.fadeOuted&&p.fadeOut(p.previousPoints)}},"#"+this.element.id+"_tooltip"):this.svgTooltip&&(this.svgTooltip.location=i,this.svgTooltip.content=this.text,this.svgTooltip.header=this.headerText,this.svgTooltip.offset=a,this.svgTooltip.palette=this.findPalette(),this.svgTooltip.shapes=r,this.svgTooltip.data=h,this.svgTooltip.template=e.tooltip.template,this.svgTooltip.textStyle=e.tooltip.textStyle,this.svgTooltip.isNegative=g,this.svgTooltip.inverted=u,this.svgTooltip.clipBounds="PolarRadar"===this.chart.chartAreaType?new Pt(0,0):n,this.svgTooltip.arrowPadding=this.text.length>1||this.chart.stockChart?0:12,this.svgTooltip.tooltipPlacement=m,this.svgTooltip.dataBind()),this.chart.isReact&&this.chart.renderReactTemplates()}getPositionBySize(e,t,i,n){const s=this.isTooltipFitPosition("Top",new C(0,0,t.width,t.height),i,e),r=this.isTooltipFitPosition("Bottom",new C(0,0,t.width,t.height),i,e),a=this.isTooltipFitPosition("Right",new C(0,0,t.width,t.height),i,e),o=this.isTooltipFitPosition("Left",new C(0,0,t.width,t.height),i,e);let l;if(!(s||r||a||o)){const e=[i.x-t.x,t.x+t.width-i.x,i.y-t.y,t.y+t.height-i.y],n=e.indexOf(Math.max.apply(this,e));return 0===n?"Left":1===n?"Right":2===n?"Top":"Bottom"}return l="Top"===n?s?"Top":r?"Bottom":a?"Right":"Left":"Bottom"===n?r?"Bottom":s?"Top":a?"Right":"Left":"Right"===n?a?"Right":o?"Left":s?"Top":"Bottom":o?"Left":a?"Right":s?"Top":"Bottom",l}isTooltipFitPosition(e,t,i,n){const s=new Pt(0,0),r=new Pt(0,0);switch(e){case"Top":s.x=i.x-n.width/2,s.y=i.y-n.height,r.x=i.x+n.width/2,r.y=i.y;break;case"Bottom":s.x=i.x-n.width/2,s.y=i.y,r.x=i.x+n.width/2,r.y=i.y+n.height;break;case"Right":s.x=i.x,s.y=i.y-n.height/2,r.x=i.x+n.width,r.y=i.y+n.height/2;break;case"Left":s.x=i.x-n.width,s.y=i.y-n.height/2,r.x=i.x,r.y=i.y+n.height/2}return Ve(s.x,s.y,t)&&Ve(r.x,r.y,t)}getCurrentPosition(e,t){let i;return i=t?e?"Left":"Right":e?"Bottom":"Top",i}findPalette(){const e=[];for(const t of this.currentPoints)e.push(this.findColor(t,t.series));return e}findColor(e,t){return!t.isRectSeries||"Candle"!==t.type&&"Hilo"!==t.type&&"HiloOpenClose"!==t.type?(e.point.color&&"#ffffff"!==e.point.color?e.point.color:e.point.interior)||t.marker.fill||t.interior:e.point.color}updatePreviousPoint(e){e&&(this.currentPoints=this.currentPoints.concat(e)),this.previousPoints=Object(r.L)([],this.currentPoints,null,!0)}fadeOut(e){const t=this.getElement(this.chart.enableCanvas?this.element.id+"_tooltip_group":this.element.id+"_tooltip_svg");t&&parseInt(t.getAttribute("opacity"),10)>0||(this.valueX=null,this.valueY=null,this.currentPoints=[],this.removeHighlight(),this.removeHighlightedMarker(e),this.svgTooltip=null,this.control.trigger("animationComplete",{}))}removeHighlightedMarker(e){if(this.chart.markerRender){for(const t of e)Oe(this.element.id+"_Series_"+t.series.index+"_Point_"+t.point.index+"_Trackball");this.chart.markerRender.removeHighlightedMarker()}this.previousPoints=[]}removeText(){this.textElements=[];const e=this.getElement(this.element.id+"_tooltip_group");if(e&&e.childNodes.length>0)for(;e.lastChild&&1!==e.childNodes.length;)e.removeChild(e.lastChild)}stopAnimation(){pt(this.toolTipInterval)}removeTooltip(e){const t=this.getElement(this.element.id+"_tooltip"),i=t?this.getElement(t.id+"parent_template"):null,n=i&&"<div></div>"!==i.innerHTML;this.stopAnimation(),this.chart.isReact&&n&&this.chart.clearTemplate([i.id],[0]),t&&this.previousPoints.length>0&&(this.toolTipInterval=+setTimeout(()=>{this.svgTooltip&&this.svgTooltip.fadeOut()},e))}}var Si=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let wi=(()=>{class e extends r.e{}return Si([Object(r.t)(null)],e.prototype,"content",void 0),Si([Object(r.t)("0")],e.prototype,"x",void 0),Si([Object(r.t)("0")],e.prototype,"y",void 0),Si([Object(r.t)("Pixel")],e.prototype,"coordinateUnits",void 0),Si([Object(r.t)("Chart")],e.prototype,"region",void 0),Si([Object(r.t)("Middle")],e.prototype,"verticalAlignment",void 0),Si([Object(r.t)("Center")],e.prototype,"horizontalAlignment",void 0),Si([Object(r.t)(null)],e.prototype,"description",void 0),e})(),Ii=(()=>{class e extends r.e{}return Si([Object(r.t)(!1)],e.prototype,"visible",void 0),Si([Object(r.t)(!0)],e.prototype,"showZero",void 0),Si([Object(r.t)(null)],e.prototype,"name",void 0),Si([Object(r.t)("transparent")],e.prototype,"fill",void 0),Si([Object(r.t)("Inside")],e.prototype,"position",void 0),Si([Object(r.t)(5)],e.prototype,"rx",void 0),Si([Object(r.t)(5)],e.prototype,"ry",void 0),Si([Object(r.t)(0)],e.prototype,"angle",void 0),Si([Object(r.t)(!1)],e.prototype,"enableRotation",void 0),Si([Object(r.g)({width:null,color:null},V)],e.prototype,"border",void 0),Si([Object(r.g)({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},z)],e.prototype,"font",void 0),Si([Object(r.g)({},_)],e.prototype,"connectorStyle",void 0),Si([Object(r.t)(null)],e.prototype,"template",void 0),e})(),Oi=(()=>{class e extends r.e{}return Si([Object(r.t)("50%")],e.prototype,"x",void 0),Si([Object(r.t)("50%")],e.prototype,"y",void 0),e})();class Ri{constructor(){this.visible=!0,this.symbolLocation=null,this.region=null,this.labelRegion=null,this.labelVisible=!0,this.regions=null,this.isExplode=!1,this.isClubbed=!1,this.isSliced=!1,this.argsData=null,this.isLabelUpdated=null,this.initialLabelRegion=null}}let Ai=(()=>{class e extends r.e{constructor(){super(...arguments),this.points=[],this.clubbedPoints=[],this.sumOfPoints=0,this.isRectSeries=!0,this.clipRect=new C(0,0,0,0),this.category="Series",this.rightSidePoints=[],this.leftSidePoints=[]}refreshDataManager(e,t){const i=this.dataSource||e.dataSource;i instanceof a.b||!Object(r.Z)(this.query)?this.dataModule.getData(this.dataModule.generateQuery().requiresCount()).then(t=>this.dataManagerSuccess(t,e)):this.dataManagerSuccess({result:i,count:i.length},e,t)}dataManagerSuccess(e,t,i=!0){const n={name:"seriesRender",series:this,data:e.result};t.allowServerDataBinding=!1,t.trigger("seriesRender",n),this.resultData=""!==e.result?e.result:[],t.isBlazor||i||this.getPoints(this.resultData,t),(++t.seriesCounts===t.visibleSeries.length&&i||window.Blazor&&!i&&1===t.seriesCounts)&&(this.getPoints(this.resultData,t),t.refreshChart())}getPoints(e,t){let i,n=Object.keys(e).length;if(this.sumOfPoints=0,0===n)return null;this.findSumOfPoints(e),this.points=[],this.clubbedPoints=[],this.sumOfClub=0;let s=this.palettes.length?this.palettes:N(t.theme),a=St(this.groupTo,this.sumOfPoints);for(let o=0;o<n;o++)i=this.setPoints(e,o,s,t),this.isClub(i,a,o)?(i.index=this.clubbedPoints.length,i.isExplode=!0,this.clubbedPoints.push(i),i.isSliced=!0):(Object(r.Z)(i.y)&&(i.visible=!1),this.pushPoints(i,s));if(this.lastGroupTo=this.groupTo,this.sumOfClub>0){let e=this.generateClubPoint();this.pushPoints(e,s);let t=this.points.length-1;this.clubbedPoints.map(i=>{i.index+=t,i.color=e.color})}this.clubbedPoints.length&&this.explode&&"Pie"===this.type&&(this.explodeAll||this.points[this.points.length-1].index===this.explodeIndex)&&(this.points.splice(this.points.length-1,1),this.points=this.points.concat(this.clubbedPoints))}generateClubPoint(){let e=new Ri;return e.isClubbed=!0,e.x="Others",e.y=this.sumOfClub,e.text=e.originalText=e.x+": "+this.sumOfClub,e.sliceRadius="80%",e}pushPoints(e,t){e.index=this.points.length,e.isExplode=this.explodeAll||e.index===this.explodeIndex,e.color=e.color||t[e.index%t.length],this.points.push(e)}isClub(e,t,i){if(!Object(r.Z)(t)){if("Value"===this.groupMode&&Math.abs(e.y)<=t)return this.sumOfClub+=Math.abs(e.y),!0;if("Point"===this.groupMode&&i>=t)return this.sumOfClub+=Math.abs(e.y),!0}return!1}findSumOfPoints(e){let t=Object.keys(e).length;for(let i=0;i<t;i++)Object(r.Z)(e[i])||Object(r.Z)(e[i][this.yName])||isNaN(e[i][this.yName])||(this.sumOfPoints+=Math.abs(e[i][this.yName]))}setPoints(e,t,i,n){let s=new Ri;return s.x=Object(r.X)(this.xName,e[t]),s.y=Object(r.X)(this.yName,e[t]),s.percentage=+(s.y/this.sumOfPoints*100).toFixed(2),s.legendImageUrl=Object(r.X)(this.legendImageUrl,e[t]),s.color=Object(r.X)(this.pointColorMapping,e[t]),s.text=s.originalText=Object(r.X)(this.dataLabel.name||"",e[t]),s.tooltip=Object(r.X)(this.tooltipMappingName||"",e[t]),s.sliceRadius=Object(r.X)(this.radius,e[t]),s.sliceRadius=Object(r.Z)(s.sliceRadius)?"80%":s.sliceRadius,s.separatorY=n.intl.formatNumber(s.y,{useGrouping:n.useGroupingSeparator}),this.setAccEmptyPoint(s,t,e,i),s}renderSeries(e,t){let i,n=t?nt(e.element.id+"_Series_"+this.index):e.renderer.createGroup({id:e.element.id+"_Series_"+this.index});this.renderPoints(e,n,t),e.accumulationDataLabelModule&&this.dataLabel.visible&&(i=e.renderer.createGroup({id:e.element.id+"_datalabel_Series_"+this.index}),i.style.visibility=this.animation.enable&&e.animateSeries&&"Pie"===this.type?"hidden":"visible",this.renderDataLabel(e,i,t)),"Pie"===this.type&&(this.findMaxBounds(this.labelBound,this.accumulationBound),e.pieSeriesModule.animateSeries(e,this.animation,this,n)),e.accumulationLegendModule&&(this.labelBound.x-=e.explodeDistance,this.labelBound.y-=e.explodeDistance,this.labelBound.height+=e.explodeDistance-this.labelBound.y,this.labelBound.width+=e.explodeDistance-this.labelBound.x)}renderPoints(e,t,i){let n,s=e.element.id+"_Series_"+this.index+"_Point_";for(let r of this.points){let a={cancel:!1,name:"pointRender",series:this,point:r,fill:r.color,border:this.isEmpty(r)?{width:this.emptyPointSettings.border.width,color:this.emptyPointSettings.border.color}:{width:this.border.width,color:this.border.color}};e.trigger("pointRender",a),r.color=a.fill,n=new A(s+r.index,r.color,a.border.width||1,a.border.color||r.color,this.opacity,"",""),e[qe(this.type)+"SeriesModule"].renderPoint(r,this,e,n,t,i)}ct(!1,e.getSeriesElement(),t,i)}renderDataLabel(e,t,i){e.accumulationDataLabelModule.findAreaRect();let n=Object(r.G)("div",{id:e.element.id+"_Series_0_DataLabelCollections"});this.leftSidePoints=[],this.rightSidePoints=[];let s=[],a=[];for(let r of this.points)r.visible&&(this.dataLabel.showZero||!this.dataLabel.showZero&&(0!==r.y||0===r.y&&"Zero"===this.emptyPointSettings.mode))&&e.accumulationDataLabelModule.renderDataLabel(r,this.dataLabel,t,this.points,this.index,n,i),r.midAngle>=90&&r.midAngle<=270?this.leftSidePoints.push(r):r.midAngle>=0&&r.midAngle<=90?a.push(r):s.push(r);if(s.sort((e,t)=>e.midAngle-t.midAngle),a.sort((e,t)=>e.midAngle-t.midAngle),this.leftSidePoints.sort((e,t)=>e.midAngle-t.midAngle),this.rightSidePoints=s.concat(a),e.accumulationDataLabelModule.drawDataLabels(this,this.dataLabel,t,n,i),null!==this.dataLabel.template&&n.childElementCount){let s=e.accumulationDataLabelModule.drawDataLabels.bind(e.accumulationDataLabelModule,this,this.dataLabel,t,n,i);e.isReact&&e.renderReactTemplates(s),ct(!1,nt(e.element.id+"_Secondary_Element"),n,i)}ct(!1,e.getSeriesElement(),t,i)}findMaxBounds(e,t){e.x=t.x<e.x?t.x:e.x,e.y=t.y<e.y?t.y:e.y,e.height=t.y+t.height>e.height?t.y+t.height:e.height,e.width=t.x+t.width>e.width?t.x+t.width:e.width}setAccEmptyPoint(e,t,i,n){if(!Object(r.Z)(e.y)&&!isNaN(e.y))return null;switch(e.color=this.emptyPointSettings.fill||e.color,this.emptyPointSettings.mode){case"Zero":e.y=0,e.visible=!0;break;case"Average":let n=i[t+1]&&i[t+1][this.yName]||0;e.y=(Math.abs(i[t-1]&&i[t-1][this.yName]||0)+Math.abs(n))/2,this.sumOfPoints+=e.y,e.visible=!0;break;default:e.visible=!1}}isEmpty(e){return e.color===this.emptyPointSettings.fill}}return Si([Object(r.t)("")],e.prototype,"dataSource",void 0),Si([Object(r.t)()],e.prototype,"query",void 0),Si([Object(r.t)("")],e.prototype,"xName",void 0),Si([Object(r.t)("")],e.prototype,"name",void 0),Si([Object(r.t)("")],e.prototype,"tooltipMappingName",void 0),Si([Object(r.t)("")],e.prototype,"yName",void 0),Si([Object(r.t)(!0)],e.prototype,"visible",void 0),Si([Object(r.g)({color:null,width:0},V)],e.prototype,"border",void 0),Si([Object(r.g)(null,G)],e.prototype,"animation",void 0),Si([Object(r.t)("SeriesType")],e.prototype,"legendShape",void 0),Si([Object(r.t)("")],e.prototype,"legendImageUrl",void 0),Si([Object(r.t)("")],e.prototype,"pointColorMapping",void 0),Si([Object(r.t)(null)],e.prototype,"selectionStyle",void 0),Si([Object(r.t)(null)],e.prototype,"groupTo",void 0),Si([Object(r.t)("Value")],e.prototype,"groupMode",void 0),Si([Object(r.g)({},Ii)],e.prototype,"dataLabel",void 0),Si([Object(r.t)([])],e.prototype,"palettes",void 0),Si([Object(r.t)(0)],e.prototype,"startAngle",void 0),Si([Object(r.t)(null)],e.prototype,"endAngle",void 0),Si([Object(r.t)("80%")],e.prototype,"radius",void 0),Si([Object(r.t)("0")],e.prototype,"innerRadius",void 0),Si([Object(r.t)("Pie")],e.prototype,"type",void 0),Si([Object(r.t)(!0)],e.prototype,"enableTooltip",void 0),Si([Object(r.t)(!1)],e.prototype,"explode",void 0),Si([Object(r.t)("30%")],e.prototype,"explodeOffset",void 0),Si([Object(r.t)(!1)],e.prototype,"explodeAll",void 0),Si([Object(r.t)(null)],e.prototype,"explodeIndex",void 0),Si([Object(r.g)({mode:"Drop"},K)],e.prototype,"emptyPointSettings",void 0),Si([Object(r.t)(0)],e.prototype,"gapRatio",void 0),Si([Object(r.t)("80%")],e.prototype,"width",void 0),Si([Object(r.t)("80%")],e.prototype,"height",void 0),Si([Object(r.t)("20%")],e.prototype,"neckWidth",void 0),Si([Object(r.t)("20%")],e.prototype,"neckHeight",void 0),Si([Object(r.t)("Linear")],e.prototype,"pyramidMode",void 0),Si([Object(r.t)(1)],e.prototype,"opacity",void 0),e})();function ki(e,t){for(let i of t)if(i.index===e)return i;return null}class Ei{constructor(e){this.accumulation=e}get center(){return this.pieCenter||("Pie"===this.accumulation.visibleSeries[0].type?this.accumulation.pieSeriesModule.pieBaseCenter:null)}set center(e){this.pieCenter=e}get radius(){return void 0!==this.pieRadius?this.pieRadius:this.accumulation.pieSeriesModule.pieBaseRadius}set radius(e){this.pieRadius=e}get labelRadius(){return void 0!==this.pieLabelRadius?this.pieLabelRadius:this.accumulation.pieSeriesModule.pieBaseLabelRadius}set labelRadius(e){this.pieLabelRadius=e}isCircular(){return"Pie"===this.accumulation.type}isVariousRadius(){return this.accumulation.pieSeriesModule.isRadiusMapped}processExplode(e){if(e.target.id.indexOf("_Series_")>-1||e.target.id.indexOf("_datalabel_")>-1){const t=ze(e.target.id).point;if(isNaN(t)||e.target.id.indexOf("_datalabel_")>-1&&"Outside"===this.accumulation.visibleSeries[0].points[t].labelPosition)return null;this.explodePoints(t,this.accumulation),this.deExplodeAll(t,this.accumulation.enableAnimation?300:0)}}invokeExplode(){const e=this.accumulation.visibleSeries[0],t=this.accumulation.enableAnimation?300:0;for(const i of e.points)i.isExplode&&this.pointExplode(i.index,i,t);if(this.accumulation.accumulationSelectionModule&&"None"!==this.accumulation.selectionMode&&this.accumulation.accumulationSelectionModule.selectedDataIndexes.length)for(const i of this.accumulation.accumulationSelectionModule.selectedDataIndexes)this.explodePoints(i.point,this.accumulation,!0),this.deExplodeAll(i.point,t)}deExplodeAll(e,t){const i=this.accumulation.element.id+"_Series_0_Point_",n=this.accumulation.visibleSeries[0].points;for(const s of n)(e!==s.index&&!s.isSliced||s.isClubbed)&&(s.isExplode=!1,this.deExplodeSlice(s.index,i,t))}explodePoints(e,t,i=!1){const n=t.visibleSeries[0],s=n.points,a=ki(e,s);let o=!0;const l=this.accumulation.enableAnimation?300:0;if(Object(r.Z)(a))return null;const h=!i&&(a.isSliced||n.clubbedPoints.length&&s[s.length-1].index===n.clubbedPoints[n.clubbedPoints.length-1].index);"Pie"===n.type&&(h||a.isClubbed)&&(o=this.clubPointExplode(e,a,n,s,t,l,h)),o&&this.pointExplode(e,a,l,i)}getSum(e){let t=0;return e.map(e=>{t+=e.visible?e.y:0}),t}clubPointExplode(e,t,i,n,s,r,a=!1){if(t.isClubbed)return s.animateSeries=!1,n.splice(n.length-1,1),i.clubbedPoints.map(e=>{e.visible=!0,e.isExplode=!0}),s.visibleSeries[0].points=n.concat(i.clubbedPoints),this.deExplodeAll(e,r),i.sumOfPoints=this.getSum(s.visibleSeries[0].points),s.refreshChart(),!1;if(a||t.isSliced){s.animateSeries=!1,n.splice(n.length-i.clubbedPoints.length,i.clubbedPoints.length);const a=i.generateClubPoint();if(a.index=n.length,a.color=i.clubbedPoints[0].color,n.push(a),i.sumOfPoints=this.getSum(n),this.deExplodeAll(e,r),a.isExplode=!1,s.visibleSeries[0].points=n,s.refreshChart(),this.pointExplode(a.index,n[a.index],0,!0),a.isExplode=!1,this.deExplodeSlice(a.index,s.element.id+"_Series_0_Point_",r),t.isSliced)return!1}return!0}pointExplode(e,t,i,n){let s;const r=this.accumulation.element.id+"_Series_0_Point_",a=this.accumulation;s=this.isCircular()?Me(t.midAngle,a.explodeDistance,this.center):{x:t.labelRegion&&t.labelRegion.x<t.region.x?-a.explodeDistance:a.explodeDistance,y:0},this.isExplode(r+e)||n?(t.isExplode=!0,this.explodeSlice(e,s,r,this.center||{x:0,y:0},i)):(t.isExplode=!1,this.deExplodeSlice(e,r,i))}isExplode(e){const t=nt(e),i=t?t.getAttribute("transform"):null;return t&&("translate(0, 0)"===i||null===i||"translate(0)"===i)}deExplodeSlice(e,t,i){const n=nt(t+e);n&&n.parentNode.lastChild.hasAttribute("transform")&&n.parentNode.lastChild.removeAttribute("transform");const s=n?n.getAttribute("transform"):null;if(this.accumulation.enableAnimation&&n&&s&&"translate(0, 0)"!==s&&"translate(0)"!==s){const n=/translate\((-?\d+\.?\d*),?\s*(-?\d+[.]?\d*)?\)/.exec(s);this.performAnimation(e,t,0,0,+n[1],+n[2]||0,i,!0)}else this.performAnimation(e,t,0,0,0,0,i,!0)}setTranslate(e,t,i,n){this.setElementTransform(t+e,i),this.accumulation.visibleSeries[0].dataLabel.visible&&(this.setElementTransform((t=this.accumulation.element.id+"_datalabel_Series_0_")+"shape_"+e,i),this.setElementTransform(t+"text_"+e,i+n),this.setElementTransform(t+"connector_"+e,i))}setElementTransform(e,t){const i=nt(e);i&&i.setAttribute("transform",t)}explodeSlice(e,t,i,n,s){this.performAnimation(e,i,0,0,t.x-n.x,t.y-n.y,s)}performAnimation(e,t,i,n,s,a,o,l){const h=this.accumulation,c=t.split("_"),d=parseInt(t.split("_")[c.length-3],10),p=h.visibleSeries[d].points[e];if(o<=0)return this.setTranslate(e,t,"translate("+s+", "+a+")",p.transform),null;let g,u;new r.b({}).animate(Object(r.G)("div"),{duration:o,progress:r=>{g=Ge(r.timeStamp,i,s,r.duration),u=Ge(r.timeStamp,n,a,r.duration),this.setTranslate(e,t,"translate("+(l?s-g:g)+", "+(l?a-u:u)+")",p.transform)},end:()=>{this.setTranslate(e,t,"translate("+(l?i:s)+", "+(l?i:a)+")",p.transform)}})}}class Li extends Ei{initProperties(e,t){this.accumulation=e,this.size=Math.min(e.initialClipRect.width,e.initialClipRect.height),this.initAngles(t);const i=parseInt(t.radius,10);if(-1===t.radius.indexOf("%")&&"number"!=typeof i||isNaN(i)){const e=[];this.isRadiusMapped=!0;for(let s=0;s<Object.keys(t.points).length;s++)e[s]=-1!==t.points[s].sliceRadius.indexOf("%")?St(t.points[s].sliceRadius,this.size/2):parseInt(t.points[s].sliceRadius,10);const i=Math.min.apply(null,e),n=Math.max.apply(null,e);this.pieBaseRadius=this.seriesRadius=n,this.innerRadius=St(t.innerRadius,this.seriesRadius),this.innerRadius=this.innerRadius>i?this.innerRadius/2:this.innerRadius}else this.isRadiusMapped=!1,this.pieBaseRadius=St(t.radius,this.size/2),this.innerRadius=St(t.innerRadius,this.pieBaseRadius),this.pieBaseLabelRadius="Inside"===t.dataLabel.position?(this.pieBaseRadius-this.innerRadius)/2+this.innerRadius:this.pieBaseRadius+St(t.dataLabel.connectorStyle.length||"4%",this.size/2);this.radius=this.pieBaseRadius,this.labelRadius=this.pieBaseLabelRadius,e.explodeDistance=t.explode?St(t.explodeOffset,this.pieBaseRadius):0,this.findCenter(e,t),this.center=this.pieBaseCenter,this.defaultLabelBound(t,t.dataLabel.visible,t.dataLabel.position),this.totalAngle-=.001}getLabelRadius(e,t){return"Inside"===e.dataLabel.position?(St(t.sliceRadius,this.pieBaseRadius)-this.innerRadius)/2+this.innerRadius:St(t.sliceRadius,this.seriesRadius)+St(e.dataLabel.connectorStyle.length||"4%",this.size/2)}findCenter(e,t){this.accumulation=e,this.pieBaseCenter={x:St(e.center.x,e.initialClipRect.width)+e.initialClipRect.x,y:St(e.center.y,e.initialClipRect.height)+e.initialClipRect.y};const i=this.getSeriesBound(t),n=new Pt(i.x+i.width/2,i.y+i.height/2);this.pieBaseCenter.x+=this.pieBaseCenter.x-n.x,this.pieBaseCenter.y+=this.pieBaseCenter.y-n.y,this.accumulation.origin=this.pieBaseCenter}initAngles(e){const t=Object(r.Z)(e.endAngle)?e.startAngle:e.endAngle;this.totalAngle=(t-e.startAngle)%360,this.startAngle=e.startAngle-90,this.totalAngle=this.totalAngle<=0?360+this.totalAngle:this.totalAngle,this.startAngle=(this.startAngle<0?this.startAngle+360:this.startAngle)%360}defaultLabelBound(e,t,i){const n=this.getSeriesBound(e);e.accumulationBound=n,e.labelBound=new C(n.x,n.y,n.width+n.x,n.height+n.y),t&&"Outside"===i&&(e.labelBound=new C(1/0,1/0,-1/0,-1/0))}getSeriesBound(e){const t=new C(1/0,1/0,-1/0,-1/0);this.initAngles(e);const i=this.startAngle,n=this.totalAngle;let s=(this.startAngle+n)%360;s=0===s?360:s,e.findMaxBounds(t,this.getRectFromAngle(i)),e.findMaxBounds(t,this.getRectFromAngle(s)),e.findMaxBounds(t,new C(this.pieBaseCenter.x,this.pieBaseCenter.y,0,0));let r=(90*Math.floor(i/90)+90)%360,a=90*Math.floor(s/90)%360;a=0===a?360:a,(n>=90||a===r)&&(e.findMaxBounds(t,this.getRectFromAngle(r)),e.findMaxBounds(t,this.getRectFromAngle(a))),(0===i||i+n>=360)&&e.findMaxBounds(t,this.getRectFromAngle(0));const o=r===a?0:Math.floor(n/90);for(let l=1;l<o;l++)r+=90,(r<a||s<i||360===n)&&e.findMaxBounds(t,this.getRectFromAngle(r));return t.width-=t.x,t.height-=t.y,t}getRectFromAngle(e){const t=Me(e,this.pieBaseRadius,this.pieBaseCenter);return new C(t.x,t.y,0,0)}getPathArc(e,t,i,n,s){let r=i-t;r=r<0?r+360:r;const a=r<180?0:1;return s||0!==s?this.getDoughnutPath(e,Me(t,n,e),Me(i,n,e),n,Me(t,s,e),Me(i,s,e),s,a):this.getPiePath(e,Me(t,n,e),Me(i,n,e),n,a)}getPiePath(e,t,i,n,s){return"M "+e.x+" "+e.y+" L "+t.x+" "+t.y+" A "+n+" "+n+" 0 "+s+" 1 "+i.x+" "+i.y+" Z"}getDoughnutPath(e,t,i,n,s,r,a,o){return"M "+t.x+" "+t.y+" A "+n+" "+n+" 0 "+o+" 1 "+i.x+" "+i.y+" L "+r.x+" "+r.y+" A "+a+" "+a+" 0 "+o+",0 "+s.x+" "+s.y+" Z"}doAnimation(e,t){const i=t.startAngle-90,n=this.accumulation.duration?this.accumulation.duration:t.animation.duration;let s;this.pieBaseCenter.x+=1;let a=.75*Math.max(this.accumulation.availableSize.height,this.accumulation.availableSize.width);a+=.414*a;const o=Ze("Linear");new r.b({}).animate(e,{duration:n,delay:t.animation.delay,progress:t=>{s=o(t.timeStamp,i,this.totalAngle,t.duration),e.setAttribute("d",this.getPathArc(this.pieBaseCenter,i,s,a,0))},end:()=>{this.pieBaseCenter.x-=1,e.setAttribute("d",this.getPathArc(this.pieBaseCenter,0,359.99999,a,0)),this.accumulation.trigger("animationComplete",this.accumulation.isBlazor?{}:{series:t,accumulation:this.accumulation,chart:this.accumulation}),nt(this.accumulation.element.id+"_datalabel_Series_"+t.index).style.visibility=this.accumulation.isDestroyed?"hidden":"visible"}})}}class Ti extends Li{renderPoint(e,t,i,n,s,r){const a=t.sumOfPoints;e.startAngle=this.startAngle;const o=a?Math.abs(e.visible?e.y:0)/a*this.totalAngle:null,l=Math.PI/180*(90-(360-this.startAngle)-90);this.radius=this.isRadiusMapped?St(e.sliceRadius,this.seriesRadius):this.radius,n.d=this.getPathOption(e,o,this.startAngle%360),e.midAngle=(this.startAngle-o/2)%360,e.endAngle=this.startAngle%360,e.symbolLocation=Me(e.midAngle,(this.radius+this.innerRadius)/2,this.center),r?(s.appendChild(i.renderer.drawPath(n)),this.refresh(e,o,l,i,n)):(s.appendChild(i.renderer.drawPath(n)),e.degree=o,e.start=l)}findSeries(e){const t=0===this.innerRadius?this.radius+3:this.innerRadius-3;this.toggleInnerPoint(e,t,0===this.innerRadius?t+2:t-2)}toggleInnerPoint(e,t,i){const n=ze(e.target.id,!0),s=e.target.id.substring(0,e.target.id.indexOf("Series")-1);let a,o=document.getElementById(this.accumulation.element.id+"PointHover_Border");const l=n.series,h=n.point,c=nt(s+"_Series_"+l+"_Point_"+h);if(!isNaN(n.series)&&c){if(!(Object(r.Z)(l)||isNaN(l)||Object(r.Z)(h)||isNaN(h))){const n=this.accumulation.visibleSeries[0].points[h],r=c.getAttribute("class")===s+"_ej2_deselected"?this.accumulation.tooltip.enable?.5:.3:this.accumulation.tooltip.enable?.5:1,d=this.getPathArc(this.accumulation.pieSeriesModule.center,n.startAngle%360,(n.startAngle+n.degree)%360,t,i);o&&s===this.accumulation.element.id&&(o.getAttribute("d")!==d||n.isExplode)&&(o.parentNode.removeChild(o),o=null);const p=nt(s+"_Series_"+l);if(!o&&(!n.isExplode||n.isExplode&&"click"!==e.type)){const t=new A(s+"PointHover_Border",n.color,1,n.color,r,"",d);if(a=this.accumulation.renderer.drawPath(t),a.removeAttribute("transform"),"None"!==this.accumulation.selectionMode&&e.target.hasAttribute("class")&&this.accumulation.accumulationSelectionModule.addSvgClass(a,e.target.getAttribute("class")),p.appendChild(a),n.isExplode&&a){const e=c.getAttribute("transform");a.setAttribute("transform",e)}}}}else o&&(this.removeBorder(o,1e3),o=null)}removeBorder(e,t){e&&setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},t)}refresh(e,t,i,n,s){const a=nt(s.id),o=n.duration?n.duration:300;new r.b({}).animate(Object(r.G)("div"),{duration:o,delay:0,progress:s=>{const r=Ge(s.timeStamp,e.degree,t-e.degree,s.duration);let o=Ge(s.timeStamp,e.start,i-e.start,s.duration);o=(o/(Math.PI/180)+360)%360,a.setAttribute("d",this.getPathOption(e,r,o)),e.isExplode&&n.accBaseModule.explodePoints(e.index,n,!0),a.style.visibility="visible"},end:()=>{a.style.visibility=e.visible?"visible":"hidden",a.setAttribute("d",s.d),e.degree=t,e.start=i}})}getPathOption(e,t,i){if(!t)return"";const n=this.getPathArc(this.center,i%360,(i+t)%360,this.isRadiusMapped?St(e.sliceRadius,this.seriesRadius):this.radius,this.innerRadius);return this.startAngle+=t,n}animateSeries(e,t,i,n){const s=e.element.id+"SeriesGroup"+i.index;if(i.animation.enable&&e.animateSeries){const t=e.renderer.createClipPath({id:s+"_clipPath"}),r=new A(s+"_slice","transparent",1,"transparent",1,"",""),a=e.renderer.drawPath(r);t.appendChild(a),e.svgObject.appendChild(t),n.setAttribute("style","clip-path:url(#"+t.id+"); -webkit-clip-path:url(#"+t.id+");"),this.doAnimation(a,i)}}getModuleName(){return"PieSeries"}destroy(){}}var ji=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let Di=(()=>{let e=class extends r.h{constructor(e,t){super(e,t),this.animateselected=!1,this.explodeDistance=0,this.chartid=57724}animate(e){this.duration=e||700,this.animateselected=!0,this.animateSeries=!1;let t=0;const i=[],n=[],s=[],r=this.visibleSeries[0];let a=[];if(a=r.dataSource,r.sumOfPoints=0,r.points.length<Object.keys(r.dataSource).length)this.refresh();else if(r.points.length>Object.keys(r.dataSource).length){const e=this.visibleSeries[0];e.points=e.points.filter(e=>(e.visible=!1,n.push(e.index),i.push(e.color),a.some(i=>{const n=i;return e.x===n.x&&(e.visible=!0,s.push(e.index),e.index=t,t++),e.x===n.x})));const r=n.filter(e=>s.indexOf(e)<0),o=n.length-r.length;for(let t=n.length-1;t>=o;t--)Oe("container_Series_0_Point_"+n[t]);for(let t=0;t<e.points.length;t++)e.points[t].y=e.dataSource[t].y,e.points[t].color=i[t],e.sumOfPoints+=e.dataSource[t].y;this.redraw=this.enableAnimation,this.animateSeries=!1,this.calculateBounds(),this.renderElements()}else{for(let e=0;e<r.points.length;e++)r.points[e].y=r.dataSource[e][r.yName],r.points[e].color=null!=r.dataSource[e][r.pointColorMapping]?r.dataSource[e][r.pointColorMapping]:r.points[e].color,r.sumOfPoints+=r.dataSource[e][r.yName];this.redraw=this.enableAnimation,this.animateSeries=!1,this.removeSvg(),this.refreshPoints(r.points),this.renderElements()}}get type(){return this.series&&this.series.length?this.series[0].type:"Pie"}preRender(){if(this.isBlazor=window.Blazor,this.allowServerDataBinding=!1,this.unWireEvents(),this.setCulture(),this.animateSeries=!0,""===this.element.id){const e=document.getElementsByClassName("e-accumulationchart").length;this.element.id="acc_chart_"+this.chartid+"_"+e}Ot(this),this.wireEvents()}setTheme(){this.themeStyle=B(this.theme)}render(){-1===this.element.className.indexOf("e-accumulationchart")&&this.element.classList.add("e-accumulationchart");const e={chart:this.isBlazor?{}:this,accumulation:this.isBlazor?{}:this,theme:this.theme,name:"load",cancel:!1};this.trigger("load",e,()=>{this.theme=this.isBlazor?e.theme:this.theme,this.setTheme(),this.accBaseModule=new Ei(this),this.pieSeriesModule=new Ti(this),this.calculateVisibleSeries(),this.processData(),this.renderComplete(),this.allowServerDataBinding=!0})}unWireEvents(){const e=r.d.touchStartEvent,t=r.d.touchEndEvent,i=r.d.isPointer?"pointerleave":"mouseleave";r.l.remove(this.element,r.d.touchMoveEvent,this.accumulationMouseMove),r.l.remove(this.element,t,this.accumulationMouseEnd),r.l.remove(this.element,e,this.accumulationMouseStart),r.l.remove(this.element,"click",this.accumulationOnMouseClick),r.l.remove(this.element,"contextmenu",this.accumulationRightClick),r.l.remove(this.element,i,this.accumulationMouseLeave),window.removeEventListener(r.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.accumulationResize)}wireEvents(){if(!this.element)return;const e=r.d.touchStartEvent,t=r.d.touchEndEvent,i=r.d.isPointer?"pointerleave":"mouseleave";r.l.add(this.element,r.d.touchMoveEvent,this.accumulationMouseMove,this),r.l.add(this.element,t,this.accumulationMouseEnd,this),r.l.add(this.element,e,this.accumulationMouseStart,this),r.l.add(this.element,"click",this.accumulationOnMouseClick,this),r.l.add(this.element,"contextmenu",this.accumulationRightClick,this),r.l.add(this.element,i,this.accumulationMouseLeave,this),window.addEventListener(r.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.accumulationResize.bind(this)),new r.v(this.element),this.setStyle(this.element)}setMouseXY(e){let t,i;const n=nt(this.element.id+"_svg");if(n&&this.element){const s=n.getBoundingClientRect(),r=this.element.getBoundingClientRect();e.type.indexOf("touch")>-1?(this.isTouch=!0,i=e.changedTouches[0].clientY,t=e.changedTouches[0].clientX):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType,t=e.clientX,i=e.clientY),this.mouseY=i-r.top-Math.max(s.top-r.top,0),this.mouseX=t-r.left-Math.max(s.left-r.left,0)}}accumulationMouseEnd(e){return this.setMouseXY(e),this.trigger("chartMouseUp",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.isTouch&&(this.titleTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.accumulationDataLabelModule&&this.visibleSeries[0].dataLabel.visible&&this.accumulationDataLabelModule.move(e,this.mouseX,this.mouseY,this.isTouch),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.move(e)),this.notify(r.d.touchEndEvent,e),!1}accumulationMouseStart(e){return this.setMouseXY(e),this.trigger("chartMouseDown",{target:e.target.id,x:this.mouseX,y:this.mouseY}),!1}accumulationResize(){this.animateSeries=!1;const e={accumulation:this.isBlazor?{}:this,previousSize:new x(this.availableSize.width,this.availableSize.height),name:"resized",currentSize:new x(0,0),chart:this.isBlazor?{}:this};let t={name:"beforeResize",cancelResizedEvent:!1};return this.resizeTo&&clearTimeout(this.resizeTo),this.trigger("beforeResize",t),t.cancelResizedEvent||(this.resizeTo=+setTimeout(()=>{this.isDestroyed?clearTimeout(this.resizeTo):(Ot(this),e.currentSize=this.availableSize,this.trigger("resized",e),this.refreshSeries(),this.refreshChart())},500)),!1}print(e){const t=document.getElementById(this.element.id+"_Series_0").style.clipPath;document.getElementById(this.element.id+"_Series_0").style.clipPath="",new di(this).print(e),document.getElementById(this.element.id+"_Series_0").style.clipPath=t}export(e,t){this.exportModule&&(this.exportModule.export(e,t),this.afterExport&&this.exportModule.getDataUrl(this))}setStyle(e){e.style.touchAction="element",e.style.msTouchAction="element",e.style.msContentZooming="none",e.style.msUserSelect="none",e.style.webkitUserSelect="none",e.style.position="relative",e.style.display="block"}setAnnotationValue(e,t){const i=this.annotations[e];let n;const s=nt(this.element.id+"_Annotation_Collections");t&&(i.content=t,s?(n=this.createElement("div"),Oe(this.element.id+"_Annotation_"+e),this.annotationModule.processAnnotation(i,e,n),s.appendChild(n.children[0])):this.annotationModule.renderAnnotations(nt(this.element.id+"_Secondary_Element")))}accumulationMouseMove(e){return!!nt(this.element.id+"_svg")&&(this.setMouseXY(e),this.trigger("chartMouseMove",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointMove&&this.triggerPointEvent("pointMove",e.target,e),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.move(e),this.accumulationDataLabelModule&&this.visibleSeries[0]&&this.visibleSeries[0].dataLabel.visible&&this.accumulationDataLabelModule.move(e,this.mouseX,this.mouseY),this.isTouch||this.titleTooltip(e,this.mouseX,this.mouseY),this.enableBorderOnMouseMove&&"Pie"===this.type&&this.pieSeriesModule&&Ve(this.mouseX,this.mouseY,this.initialClipRect)&&this.pieSeriesModule.findSeries(e),this.notify(r.d.touchMoveEvent,e),!1)}titleTooltip(e,t,i,n){const s=e.target.id,r=s===this.element.id+"_title"||s===this.element.id+"_subTitle"||s===this.element.id+"_chart_legend_title";e.target.textContent.indexOf("...")>-1&&r?Ae(s===this.element.id+"_title"?this.title:s===this.element.id+"_subTitle"?this.subTitle:this.legendSettings.title,t,i,this.element.offsetWidth,this.element.id+"_EJ2_Title_Tooltip",nt(this.element.id+"_Secondary_Element"),n):Oe(this.element.id+"_EJ2_Title_Tooltip")}accumulationOnMouseClick(e){return this.setMouseXY(e),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.click(e),"None"!==this.selectionMode&&this.accumulationSelectionModule&&this.accumulationSelectionModule.calculateSelectedElements(this,e),this.visibleSeries[0].explode&&this.accBaseModule.processExplode(e),this.enableBorderOnMouseMove&&this.pieSeriesModule&&"Pie"===this.type&&this.pieSeriesModule.findSeries(e),this.trigger("chartMouseClick",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointClick&&this.triggerPointEvent("pointClick",e.target,e),!1}triggerPointEvent(e,t,i){const n=i,s=ze(t.id,!0);s.series>=0&&s.point>=0&&this.trigger(e,{series:this.isBlazor?{}:this.series[s.series],point:this.series[s.series].points[s.point],seriesIndex:s.series,pointIndex:s.point,x:this.mouseX,y:this.mouseY,pageX:n.pageX,pageY:n.pageY})}accumulationRightClick(e){return 2!==e.buttons&&"touch"!==e.pointerType||(e.preventDefault(),e.stopPropagation(),!1)}accumulationMouseLeave(e){this.setMouseXY(e),this.trigger("chartMouseLeave",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.notify(r.d.isPointer?"pointerleave":"mouseleave",e);let t=document.getElementById(this.element.id+"PointHover_Border");return t&&(this.pieSeriesModule.removeBorder(t,1e3),t=null),!1}setCulture(){this.intl=new r.n}createPieSvg(){this.removeSvg(),Rt(this)}removeSvg(){if(this.redraw)return null;if(Tt(this),Oe(this.element.id+"_Secondary_Element"),this.svgObject){for(;this.svgObject.childNodes.length>0;)this.svgObject.removeChild(this.svgObject.firstChild);!this.svgObject.hasChildNodes()&&this.svgObject.parentNode&&Object(r.kb)(this.svgObject)}Oe("EJ2_legend_tooltip"),Oe("EJ2_datalabel_tooltip"),Oe(this.element.id+"PointHover_Border")}createSecondaryElement(){const e=wt(this.redraw,this.element.id+"_Secondary_Element")||this.createElement("div",{id:this.element.id+"_Secondary_Element",styles:"position: relative"});ct(!1,this.element,e,this.redraw)}calculateVisibleSeries(){this.visibleSeries=[];for(let e=0,t=this.series.length;e<t;e++)if(this.series[e].index=e,this.series[e].type===this.type&&0===this.visibleSeries.length){this.visibleSeries.push(this.series[e]);break}}processData(e=!0){this.seriesCounts=0;for(const t of this.visibleSeries)t.dataModule=new ti(t.dataSource||this.dataSource,t.query),t.refreshDataManager(this,e)}refreshChart(){this.doGrouppingProcess(),this.createPieSvg(),this.calculateBounds(),this.renderElements(),Oe("chartmeasuretext")}doGrouppingProcess(){const e=this.visibleSeries[0];Object(r.Z)(e.resultData)||Object(r.Z)(e.lastGroupTo)||e.lastGroupTo===e.groupTo||e.getPoints(e.resultData,this)}calculateBounds(){this.initialClipRect=new C(this.margin.left,this.margin.top,this.availableSize.width,this.availableSize.height),this.titleCollection=[],this.subTitleCollection=[];let e=0,t=0,i=0,n=0;if(this.titleCollection=At(this.title,this.titleStyle,this.initialClipRect.width),e=this.title?b(this.title,this.titleStyle).height*this.titleCollection.length:e,this.subTitle){for(const e of this.titleCollection)n=b(e,this.titleStyle).width,i=n>i?n:i;this.subTitleCollection=At(this.subTitle,this.subTitleStyle,i),t=b(this.subTitle,this.subTitleStyle).height*this.subTitleCollection.length}var s,r;s=this.initialClipRect,r=new C(0,t+e,this.margin.right+this.margin.left,this.margin.bottom+this.margin.top),s.x+=r.x,s.y+=r.y,s.width-=r.x+r.width,s.height-=r.y+r.height,this.calculateLegendBounds()}calculateLegendBounds(){if(!this.accumulationLegendModule||!this.legendSettings.visible)return null;this.accumulationLegendModule.getLegendOptions(this,this.visibleSeries),this.accumulationLegendModule.calculateLegendBounds(this.initialClipRect,this.availableSize,null)}renderElements(){this.renderBorder(),this.createSecondaryElement(),this.renderSeries(),this.renderTitle(),this.renderLegend(),ct(!1,this.element,this.svgObject,this.redraw),this.processSelection(),this.processExplode(),this.renderAnnotation(),this.setSecondaryElementPosition(),Object(r.vb)(this.element.id+"_DataLabel","Template",this.series[0].dataLabel),this.trigger("loaded",{accumulation:this.isBlazor?{}:this,chart:this.isBlazor?{}:this}),this.animateSeries=!1}setSecondaryElementPosition(){const e=nt(this.element.id+"_Secondary_Element");if(!e)return;const t=this.element.getBoundingClientRect(),i=nt(this.element.id+"_svg").getBoundingClientRect();e.style.left=Math.max(i.left-t.left,0)+"px",e.style.top=Math.max(i.top-t.top,0)+"px"}renderAnnotation(){this.annotationModule&&this.annotationModule.renderAnnotations(nt(this.element.id+"_Secondary_Element"))}processExplode(){return this.redraw?null:this.visibleSeries[0].explode?void this.accBaseModule.invokeExplode():null}renderSeries(){this.redraw||this.svgObject.appendChild(this.renderer.createGroup({id:this.element.id+"_SeriesCollection"}));for(const e of this.visibleSeries)e.visible&&this[qe(e.type)+"SeriesModule"]&&(this[qe(e.type)+"SeriesModule"].initProperties(this,e),e.renderSeries(this,this.redraw))}renderBorder(){const e=this.border.width;ct(!1,this.svgObject,this.renderer.drawRectangle(new Dt(this.element.id+"_border",this.background||this.themeStyle.background,this.border,1,new C(e/2,e/2,this.availableSize.width-e,this.availableSize.height-e))),this.redraw);const t=this.backgroundImage;if(t){const i=new Mt(this.availableSize.height-e,this.availableSize.width-e,t,0,0,this.element.id+"_background","visible","none");ct(!1,this.svgObject,this.renderer.drawImage(i),this.redraw)}}renderLegend(){if(!this.accumulationLegendModule||!this.legendSettings.visible)return null;this.accumulationLegendModule.legendCollections.length&&("Pie"===this.visibleSeries[0].type&&this.accumulationLegendModule.getSmartLegendLocation(this.visibleSeries[0].labelBound,this.accumulationLegendModule.legendBounds,this.margin),this.accumulationLegendModule.renderLegend(this,this.legendSettings,this.accumulationLegendModule.legendBounds,this.redraw))}processSelection(){if(!this.accumulationSelectionModule||"None"===this.selectionMode)return null;const e=Object(r.L)([],this.accumulationSelectionModule.selectedDataIndexes,null,!0);this.accumulationSelectionModule.invokeSelection(this),e.length>0&&(this.accumulationSelectionModule.selectedDataIndexes=e,this.accumulationSelectionModule.redrawSelection(this))}renderTitle(){const e=this.margin;if(!this.title)return null;const t=this.titleStyle.textAlignment,i="Near"===t?"start":"Far"===t?"end":"middle",n=b(this.title,this.titleStyle),s=new C(e.left,0,this.availableSize.width-e.left-e.right,0),r=new w(this.element.id+"_title",kt(s,this.titleStyle),this.margin.top+3*n.height/4,i,this.titleCollection,"","auto"),a=It(this.renderer,r,this.titleStyle,this.titleStyle.color||this.themeStyle.chartTitle,this.svgObject,!1,this.redraw);a&&a.setAttribute("aria-label",this.title),this.subTitle&&this.renderSubTitle(r)}renderSubTitle(e){let t=0,i=0;const n=this.titleStyle.textAlignment,s=b(this.subTitle,this.subTitleStyle);for(const o of this.titleCollection)i=b(o,this.titleStyle).width,t=i>t?i:t;const r=new C("Center"===n?e.x-t/2:"Far"===n?e.x-t:e.x,0,t,0),a=new w(this.element.id+"_subTitle",kt(r,this.subTitleStyle),e.y*e.text.length+3*s.height/4+10,(e=>"Near"===e?"start":"Far"===e?"end":"middle")(this.subTitleStyle.textAlignment),this.subTitleCollection,"","auto");It(this.renderer,a,this.subTitleStyle,this.subTitleStyle.color||this.themeStyle.chartTitle,this.svgObject,!1,this.redraw)}getSeriesElement(){return this.svgObject.getElementsByTagName("g")[0]}refreshSeries(){for(const e of this.visibleSeries)this.refreshPoints(e.points)}refreshPoints(e){for(const t of e)t.labelPosition=null,t.labelRegion=null,t.labelVisible=!0}getModuleName(){return"accumulationchart"}destroy(){this.element&&(this.unWireEvents(),super.destroy(),this.element.classList.remove("e-accumulationchart"),this.removeSvg(),this.svgObject=null)}requiredModules(){const e=[];let t=!1;return e.push({member:this.type+"Series",args:[this]}),this.legendSettings.visible&&e.push({member:"AccumulationLegend",args:[this]}),this.findDatalabelVisibility()&&e.push({member:"AccumulationDataLabel",args:[this]}),this.tooltip.enable&&e.push({member:"AccumulationTooltip",args:[this]}),"None"!==this.selectionMode&&e.push({member:"AccumulationSelection",args:[this]}),(this.enableExport||this.allowExport)&&e.push({member:"Export",args:[this]}),t=this.annotations.some(e=>null!==e.content),t&&e.push({member:"Annotation",args:[this]}),e}findDatalabelVisibility(){for(const e of this.series)if(e.dataLabel.visible)return!0;return!1}changeVisibleSeries(e,t){for(const i of e)if(t===i.index)return i;return null}getPersistData(){return""}onPropertyChanged(e,t){const i={refreshElements:!1,refreshBounds:!1};for(const n of Object.keys(e))switch(n){case"theme":this.animateSeries=!0;break;case"title":case"subTitle":case"height":case"width":case"margin":i.refreshBounds=!0;break;case"titleStyle":e.titleStyle&&(e.titleStyle.size||e.titleStyle.textOverflow)?i.refreshBounds=!0:i.refreshElements=!0;break;case"subTitleStyle":e.subTitleStyle&&(e.subTitleStyle.size||e.subTitleStyle.textOverflow)?i.refreshBounds=!0:i.refreshElements=!0;break;case"legendSettings":i.refreshBounds=!0,i.refreshElements=!0;break;case"dataSource":this.processData(!1),i.refreshBounds=!0;break;case"series":if(!this.animateselected){const n=this.series.length;let s,a,o=!1;for(let i=0;i<n;i++)s=e.series[i],this.isBlazor&&(s.startAngle||s.endAngle||s.explodeOffset||s.neckHeight||s.neckWidth||s.radius||s.innerRadius||s.groupMode||s.emptyPointSettings)&&(a=!0),e.series[i]&&(e.series[i].dataSource||e.series[i].yName||e.series[i].xName||e.series[i].dataLabel||a)&&(Object(r.L)(this.changeVisibleSeries(this.visibleSeries,i),s,null,!0),o=!0),e.series[i]&&!Object(r.Z)(e.series[i].explodeIndex)&&e.series[i].explodeIndex>=0&&e.series[i].explodeIndex!==t.series[i].explodeIndex&&(this.accBaseModule.explodePoints(e.series[i].explodeIndex,this),this.accBaseModule.deExplodeAll(e.series[i].explodeIndex,this.enableAnimation?300:0));o&&(this.processData(!1),i.refreshBounds=!0)}this.animateselected=!1,this.redraw=!1;break;case"locale":case"currencyCode":super.refresh();break;case"background":case"border":case"annotations":case"enableSmartLabels":i.refreshElements=!0;break;case"isMultiSelect":case"selectedDataIndexes":case"selectionMode":this.accumulationSelectionModule&&(Object(r.Z)(this.accumulationSelectionModule.selectedDataIndexes)?this.accumulationSelectionModule.invokeSelection(this):this.accumulationSelectionModule.redrawSelection(this))}!i.refreshBounds&&i.refreshElements?(this.createPieSvg(),this.renderElements()):i.refreshBounds&&(this.refreshSeries(),this.createPieSvg(),this.calculateBounds(),this.renderElements())}};return ji([Object(r.t)(null)],e.prototype,"width",void 0),ji([Object(r.t)(null)],e.prototype,"height",void 0),ji([Object(r.t)(null)],e.prototype,"title",void 0),ji([Object(r.t)(null)],e.prototype,"backgroundImage",void 0),ji([Object(r.g)({},Oi)],e.prototype,"center",void 0),ji([Object(r.t)("")],e.prototype,"dataSource",void 0),ji([Object(r.g)(F.chartTitleFont,z)],e.prototype,"titleStyle",void 0),ji([Object(r.t)(null)],e.prototype,"subTitle",void 0),ji([Object(r.g)(F.chartSubTitleFont,z)],e.prototype,"subTitleStyle",void 0),ji([Object(r.g)({},ai)],e.prototype,"legendSettings",void 0),ji([Object(r.g)({},Q)],e.prototype,"tooltip",void 0),ji([Object(r.t)("None")],e.prototype,"selectionMode",void 0),ji([Object(r.t)("None")],e.prototype,"highLightMode",void 0),ji([Object(r.t)("None")],e.prototype,"selectionPattern",void 0),ji([Object(r.t)("None")],e.prototype,"highlightPattern",void 0),ji([Object(r.t)(!0)],e.prototype,"enableBorderOnMouseMove",void 0),ji([Object(r.t)(!1)],e.prototype,"isMultiSelect",void 0),ji([Object(r.t)(!0)],e.prototype,"enableAnimation",void 0),ji([Object(r.f)([],Y)],e.prototype,"selectedDataIndexes",void 0),ji([Object(r.g)({},W)],e.prototype,"margin",void 0),ji([Object(r.t)(!0)],e.prototype,"enableSmartLabels",void 0),ji([Object(r.g)({color:"#DDDDDD",width:0},V)],e.prototype,"border",void 0),ji([Object(r.t)(null)],e.prototype,"background",void 0),ji([Object(r.f)([{}],Ai)],e.prototype,"series",void 0),ji([Object(r.f)([{}],wi)],e.prototype,"annotations",void 0),ji([Object(r.t)("Material")],e.prototype,"theme",void 0),ji([Object(r.t)(!1)],e.prototype,"useGroupingSeparator",void 0),ji([Object(r.t)(!0)],e.prototype,"enableExport",void 0),ji([Object(r.t)(!1)],e.prototype,"allowExport",void 0),ji([Object(r.k)()],e.prototype,"loaded",void 0),ji([Object(r.k)()],e.prototype,"load",void 0),ji([Object(r.k)()],e.prototype,"seriesRender",void 0),ji([Object(r.k)()],e.prototype,"legendRender",void 0),ji([Object(r.k)()],e.prototype,"textRender",void 0),ji([Object(r.k)()],e.prototype,"tooltipRender",void 0),ji([Object(r.k)()],e.prototype,"pointRender",void 0),ji([Object(r.k)()],e.prototype,"annotationRender",void 0),ji([Object(r.k)()],e.prototype,"beforePrint",void 0),ji([Object(r.k)()],e.prototype,"chartMouseMove",void 0),ji([Object(r.k)()],e.prototype,"chartMouseClick",void 0),ji([Object(r.k)()],e.prototype,"pointClick",void 0),ji([Object(r.k)()],e.prototype,"pointMove",void 0),ji([Object(r.k)()],e.prototype,"animationComplete",void 0),ji([Object(r.k)()],e.prototype,"chartMouseDown",void 0),ji([Object(r.k)()],e.prototype,"chartMouseLeave",void 0),ji([Object(r.k)()],e.prototype,"chartMouseUp",void 0),ji([Object(r.k)()],e.prototype,"beforeResize",void 0),ji([Object(r.k)()],e.prototype,"resized",void 0),ji([Object(r.k)()],e.prototype,"afterExport",void 0),ji([Object(r.t)("USD")],e.prototype,"currencyCode",void 0),e=ji([r.r],e),e})();var Mi,Fi,Pi;function Ni(e){let t;const i=[];return(e=-1===(e=e.indexOf("!")>-1?e.split("!")[1]:e).indexOf(":")?e+":"+e:e).split(":").forEach(e=>{t=Bi(e),i.push(t[0]),i.push(t[1])}),i}function Bi(e){return[parseInt(e.match(/\d+/)[0],10)-1,Hi(e.match(/[A-Z]+/i)[0].toUpperCase())]}function Hi(e){let t=0;for(let i=(e=e.split("").reverse().join("")).length-1;i>=0;i--)t+=(e[i].charCodeAt(0)-64)*Math.pow(26,i);return t-1}function _i(e,t){return Vi(t+1)+(e+1)}function zi(e){return _i(e[0],e[1])+":"+(Object(r.Z)(e[2])?_i(e[0],e[1]):_i(e[2],e[3]))}function Vi(e){return e/26>1?Vi(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function Ui(e){return Ni(qi(e))}function qi(e){return e.split("!")[1]||e}function Wi(e){const t=e.slice();return e[0]>e[2]&&Zi(t,0,2),e[1]>e[3]&&Zi(t,1,3),t}function Zi(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function Gi(e){return e[0]===e[2]&&e[1]===e[3]}function Yi(e,t,i,n,s){return new Xi(e,t,i,n,s)}!function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.tooltipLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"}}(Mi||(Mi={})),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"},e.tooltipLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.dataLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.titleFont={size:"15px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"},e.subTitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"}}(Fi||(Fi={})),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.smithchartTitleFont={size:"15px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.smithchartSubtitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.dataLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"}}(Pi||(Pi={}));class Xi{constructor(e,t,i,n,s){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=i,this.workerData=n,s&&(this.preventCallback=!0),this.initWorker()}terminate(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)}initWorker(){const e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)}messageFromWorker(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])}onError(e){throw this.terminate(),e.message||e}getFnCode(){let e,t,i="",n="",s=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),s=!0),i+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),s=!0),i+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return i+="self.onmessage = "+(s?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n",i}getCallbackMessageFn(e){postMessage(this.workerTask(...e.data))}getMessageFn(e){this.workerTask(...e.data)}}function $i(e){const t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";{const e=t.indexOf(".")>-1?t.split(".")[1]:0,i=Math.pow(10,e.toString().replace("-","").length),n=Math.abs(Ki(e,i));return e/n+"/"+i/n}}function Ki(e,t){return e=Number(e),(t=Number(t))?Ki(t,e%t):e}function Ji(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);const t=new Date("01/01/1900"),i=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+i).toUTCString().replace(" GMT",""))}function Qi(e,t,i){const n=new Date("01/01/1900"),s=en(e)?e:new Date(e),r=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),a=(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds())-r)/864e5;return(t?a:parseInt(a.toString(),10))+(i?0:a>60?2:1)}function en(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function tn(e){return e-parseFloat(e)>=0}function nn(e){return e&&/^\d*\.?\d*$/.test(e)?parseFloat(e):e}const sn="setCellFormat",rn="applyCellFormat",an="workbookFormulaOperation",on="ShowDialog",ln="setMerge",hn="activeCellMergedRange";class cn{constructor(e){this.parent=e,this.localeObj=Object(r.T)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}numberFormatting(e){let t=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(t=Ls(this.parent,e.range.split("!")[0]));const i=this.parent.sheets[t],n=Ni(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:i.selectedRange);let s;for(let r=n[0];r<=n[2];r++)for(let a=n[1];a<=n[3];a++)vs(r,a,i,{format:e.format},!0),s=Cs(r,a,i,!0),this.getFormattedCell({type:pn(s.format),value:s.value,format:s.format,rowIndex:r,colIndex:a,sheetIndex:t,cell:s})}getFormattedCell(e){const t=Object(r.Z)(e.value)?"":e.value,i=this.parent.sheets[Object(r.Z)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex],n=Ni(i.activeCell),s=Number(e.sheetIndex)?Number(e.sheetIndex):this.parent.activeSheetIndex;let a=e.cell?e.cell:Cs(n[0],n[1],i);const o=e.cell&&!Object(r.Z)(e.rowIdx)?e.rowIdx:n[0],l=e.cell&&!Object(r.Z)(e.colIdx)?e.colIdx:n[1];let h=!1;const c={},d=new r.n;d.getNumberFormat(c);const p=Object(r.S)(this.parent.locale,c.currency);if(""===e.format||"General"===e.format){a=a||{};const t={value:e.value,rowIndex:o,colIndex:l,sheetIndex:this.parent.activeSheetIndex,updatedVal:e.value,isDate:!1,isTime:!1};this.checkDateFormat(t),t.isDate?(h=!0,a.value=e.value=t.updatedVal,a.format=e.format=dn("ShortDate")):t.isTime&&(h=!0,a.value=e.value=t.updatedVal,a.format=e.format=dn("Time"))}e.type=e.format?pn(e.format):"General";const g=this.processFormats(e,t,h,a,d,p,c.currency);return this.parent.getActiveSheet().id-1===s&&this.parent.notify("refreshCellElem",{isRightAlign:g.rightAlign,result:g.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:p,value:e.value||""}),!e.onLoad&&(e.rowIndex>i.usedRange.rowIndex||e.colIndex>i.usedRange.colIndex)&&this.parent.setUsedRange(e.rowIndex,e.colIndex),e.formattedText=g.fResult||e.value,e.isRightAlign=g.rightAlign,e.curSymbol=p,e.formattedText}processFormats(e,t,i,n,s,r,a){let o;if(e.format=e.format?e.format:"General",""!==t)switch(e.type){case"General":o=this.autoDetectGeneralFormat({args:e,currencySymbol:r,fResult:t,intl:s,isRightAlign:i,curCode:a,cell:n,rowIdx:Number(e.rowIdx),colIdx:Number(e.colIdx)}),t=o.fResult,i=o.isRightAlign;break;case"Number":tn(t)&&(t=this.applyNumberFormat(e,s),i=!0);break;case"Currency":tn(t)&&(t=this.currencyFormat(e,s,a),i=!0);break;case"Percentage":tn(t)&&(t=this.percentageFormat(e,s),i=!0);break;case"Accounting":tn(t)&&(t=this.accountingFormat(e,s,r,a),i=!0);break;case"ShortDate":i=!!(t=this.shortDateFormat(e,s));break;case"LongDate":i=!!(t=this.longDateFormat(e,s));break;case"Time":i=!!(t=this.timeFormat(e,s));break;case"Fraction":tn(t)&&(t=this.fractionFormat(e),i=!0);break;case"Scientific":tn(t)&&(t=this.scientificFormat(e),i=!0);break;case"Text":i=!1}return{fResult:t,rightAlign:i}}autoDetectGeneralFormat(e){if(tn(e.fResult)&&(e.args.format&&""!==e.args.format&&(e.fResult=e.args.format.toString().indexOf("%")>-1?this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?this.currencyFormat(e.args,e.intl,e.curCode):this.applyNumberFormat(e.args,e.intl)),"General"===e.args.format&&e.fResult&&e.fResult.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args)),e.isRightAlign=!0),!Object(r.Z)(e.fResult)){const t=e.fResult.toString();t.indexOf("%")>-1&&""!==t.split("%")[0]&&""===t.split("%")[1].trim()&&"NaN"!==Number(t.split("%")[0].split(this.groupSep).join("")).toString()?(e.args.value=Number(t.split("%")[0].split(this.groupSep).join(""))/100,e.cell.format=e.args.format=this.getPercentageFormat(t),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0):t.indexOf(e.currencySymbol)>-1&&""!==t.split(e.currencySymbol)[1]&&"NaN"!==Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")).toString()&&(e.args.value=Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")),e.cell.format=e.args.format=dn("Currency"),e.fResult=this.currencyFormat(e.args,e.intl,e.curCode),e.cell.value=e.args.value.toString(),vs(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}return{isRightAlign:e.isRightAlign,fResult:e.fResult}}getPercentageFormat(e){return e.indexOf(this.decimalSep)>-1?dn("Percentage"):"0%"}findSuffix(e,t){const i=e.length-t.length;return e.substr(0,i<0?0:i)+t}applyNumberFormat(e,t){e.format=this.isCustomFormat(e.format.toString());const i=e.format.toString().split(";");if(Number(e.value)>0)e.format=i[0];else if(0===Number(e.value)){if(e.format=i[2]?i[2]:i[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=Object(r.Z)(i[1])?i[0]:i[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=i[3]?i[3]:i[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.decimalSep)>-1){const t=e.format.split(this.decimalSep)[1].length;let i="";Number(e.value)%1&&(i=t>e.value.toString().split(".")[1].length?" ":"0"),e.format=e.format.split("?").join(i)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&(e.format=e.cell.format),t.formatNumber(Number(e.value),{format:e.format})}isCustomFormat(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),(e=""===e?dn("Number"):e).toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")}currencyFormat(e,t,i){e.format=""===e.format?dn("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");const n=e.format.toString().split(";");return e.format=Number(e.value)>=0||Object(r.Z)(n[1])?n[0]:n[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),t.formatNumber(Number(e.value),{format:e.format,currency:i})}percentageFormat(e,t){return e.format=""===e.format?dn("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})}accountingFormat(e,t,i,n){e.format=""===e.format?dn("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");const s=e.format.split(";");return e.format=Number(e.value)>=0?s[0]:s[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),0===Number(e.value)?i+"- ":t.formatNumber(Number(e.value),{format:e.format,currency:n}).split("-").join("")}getFormatForOtherCurrency(e){if(e.indexOf("[$")>-1){const t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e}shortDateFormat(e,t){const i=Ji(e.value);let n,s=""===e.format||"General"===e.format?dn("ShortDate"):e.format.toString();return s===dn("ShortDate")?(s="M/d/yy",n={type:"date",skeleton:"yMd"}):n={type:"date",format:s},t.formatDate(i,n)}longDateFormat(e,t){const i=Ji(e.value);let n=""===e.format||"General"===e.format?dn("LongDate"):e.format.toString();return n===dn("LongDate")&&(n="EEEE, MMMM d, y"),t.formatDate(i,{type:"date",format:n})}timeFormat(e,t){if(Object(r.Z)(e.value))return"";Object(r.Z)(e.value.toString().split(this.decimalSep)[1])||(e.value=parseFloat("1"+this.decimalSep+e.value.toString().split(this.decimalSep)[1])||e.value);const i=Ji(e.value);let n=""===e.format||"General"===e.format?dn("Time"):e.format.toString();return n===dn("Time")&&(n="h:mm:ss a"),t.formatDate(i,{type:"time",skeleton:"medium",format:n})}scientificFormat(e){e.format=""===e.format?dn("Scientific"):e.format;const t=e.format.split("+")[1],i=this.findDecimalPlaces(e.format,"Scientific");let n=Number(e.value).toExponential(i);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(t,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(t,n.split("e-")[1])),n}fractionFormat(e){e.format=""===e.format?dn("Fraction"):e.format;let t,i="";return e.value.toString().indexOf(this.decimalSep)>-1&&tn(e.value)?(i=e.value.toString().split(this.decimalSep)[0],t=$i(Number(e.value)),0===Number(i)?" "+t:i+" "+t):i}findDecimalPlaces(e,t){let i,n;switch(t){case"Scientific":if(i=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep),i>-1)return e.substring(n+1,i).length}return 2}checkDateFormat(e){let t;const i=new r.n;let n=Object(r.Z)(e.value)?"":e.value.toString(),s=Cs(e.rowIndex,e.colIndex,Fs(this.parent,Object(r.Z)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex));const a=this.checkCustomDateFormat(n);n&&(n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&"Invalid"!==a&&(n=a,(n&&n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&(t=function(e,t,i,n){const s=r.o.getDependables(r.C,i,null).dateObject,a=s.dateTimeFormats.availableFormats,o={dateObj:null,isCustom:!1,type:""};if("string"==typeof e&&(e=e.toUpperCase()),n&&(o.dateObj=t.parseDate(e,{format:n}),o.dateObj&&(o.type=e.toString().indexOf(":")>-1?"time":"datetime",o.isCustom=!0)),Object(r.Z)(o.dateObj)){for(const i of Object.keys(s.dateFormats))if(o.dateObj=t.parseDate(e,{format:s.dateFormats[i],skeleton:i}),o.dateObj){o.type="date",o.isCustom=!1;break}if(Object(r.Z)(o.dateObj))for(const i of Object.keys(a))if(o.dateObj=t.parseDate(e,{format:a[i],skeleton:i}),o.dateObj){if(o.type=e.toString().indexOf(":")>-1?"time":"datetime","time"===o.type){const e=o.dateObj.toLocaleTimeString();o.dateObj=new Date("01/01/1900 "+e)}o.isCustom=!0;break}if(Object(r.Z)(o.dateObj))for(const i of Object.keys(s.timeFormats))if(o.dateObj=t.parseDate(e,{format:s.timeFormats[i],skeleton:i}),o.dateObj){const e=o.dateObj.toLocaleTimeString();o.dateObj=new Date("01/01/1900 "+e),o.type="time",o.isCustom=!1;break}}return"#DIV/0!"===e||o.dateObj||"Invalid Date"===new Date(e).toString()||(o.dateObj=new Date(e)),o}(n,i,this.parent.locale,s&&s.format),Object(r.Z)(t.dateObj)||"Invalid Date"===t.dateObj.toString()||(s=s||{},n=Qi(t.dateObj,n.indexOf(":")>-1,t.type&&"time"===t.type).toString(),s.format&&""!==s.format||(s.format=dn("time"===t.type?"Time":"ShortDate")),e.isDate="date"===t.type||"datetime"===t.type,e.isTime="time"===t.type,e.dateObj=t.dateObj)),e.updatedVal=n)}checkCustomDateFormat(e){const t=e.indexOf("/")>-1?e.split("/"):e.indexOf("-")>0?e.split("-"):[""],i=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];if(2===t.length)return i.indexOf(t[0].toLowerCase())>-1&&Number(t[1])<=31?"01-"+t[0]+"-"+t[1]:i.indexOf(t[1].toLowerCase())>-1&&Number(t[0])<=31||Number(t[0])<=31&&Number(t[1])<=12||Number(t[1])<=31&&Number(t[0])<=12?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[0])<=12&&Number(t[1])<=9999&&Number(t[1])>=1900?"01-"+t[0]+"-"+t[1]:"Invalid";if(t.length>2)for(let n=0;n<t.length;n++)if(!(Number(t[n])>-1||i.filter(e=>t[n].toLowerCase().includes(e)).length))return"Invalid";return e}formattedBarText(e){const t=pn(e.cell?e.cell.format:""),i=new r.n,n=e.value,s="ShortDate"===t&&e.cell&&e.cell.format?e.cell.format:dn("ShortDate"),a=dn("Time");switch(t){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:t,value:e.value,format:s},i);break;case"Time":e.value=n&&Number(n)>=1?this.shortDateFormat({type:t,value:e.value,format:s},i)+" "+this.timeFormat({type:t,value:e.value,format:a},i):this.timeFormat({type:t,value:e.value,format:a},i)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=n)}addEventListener(){this.parent.on("applyNumber",this.numberFormatting,this),this.parent.on("getFormattedCell",this.getFormattedCell,this),this.parent.on("checkDateFormat",this.checkDateFormat,this),this.parent.on("getFormattedBarText",this.formattedBarText,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("applyNumber",this.numberFormatting),this.parent.off("getFormattedCell",this.getFormattedCell),this.parent.off("checkDateFormat",this.checkDateFormat),this.parent.off("getFormattedBarText",this.formattedBarText))}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"workbookNumberFormat"}}function dn(e){let t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function pn(e){let t="General";switch(e){case"0.00":case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':t="Accounting";break;case"mm-dd-yyyy":case"dd-mm-yyyy":case"dd-mm-yy":case"mm-dd-yy":case"dd/MM/yyyy":case"yyyy-MM-dd":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text";break;default:e&&e.indexOf("[$")>-1&&(t=e.indexOf("* ")>-1?"Accounting":"Currency")}return t}class gn{constructor(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}addEventListener(){this.parent.on("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler,this),this.parent.on("dataSourceChanged",this.dataSourceChangedHandler,this),this.parent.on("dataChanged",this.dataChangedHandler,this),this.parent.on("triggerDataChange",this.triggerDataChangeHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler),this.parent.off("dataSourceChanged",this.dataSourceChangedHandler),this.parent.off("dataChanged",this.dataChangedHandler))}updateSheetFromDataSourceHandler(e){let t,i,n,s,r,o;const l=[],h=[];let c;const d=new a.d;let p,g,u;if(e.promise=d.promise,e.sheet&&e.sheet.ranges.length)for(let m=e.sheet.ranges.length-1;m>=0;m--){let f=e.indexes[0],b=e.indexes[2];const y=e.sheet.ranges[m];p=Ni(y.startCell)[0],o=y.dataSource instanceof a.b?y.dataSource:y.dataSource?new a.b(y.dataSource):new a.b,r=r||o.dataSource.url,e.sheet.isLocalData=!o.dataSource.url,p<=f?f-=p:p<=b?(b-=p,f=0):f=-1,y.showFieldAsHeader&&0!==f&&(f-=1);let x=!1,C=0;this.initRangeInfo(y);let v=this.getMaxCount(y);if(u=this.getLoadedInfo(f,b,y),f=u.unloadedRange[0],b=u.unloadedRange[1],y.info.insertRowRange&&(y.info.insertRowRange.forEach(e=>{C+=e[1]-e[0]+1}),f-=C,b-=C),f>v?x=!0:b>v&&(b=v),this.requestedInfo.push({deferred:d,indexes:e.indexes,isNotLoaded:u.isNotLoaded}),f>=0&&u.isNotLoaded&&!x){h[m]=f,l[m]=!1;const r=(y.query?y.query:new a.h).clone();o.executeQuery(r.range(f,b>=v?b:b+1).requiresCount()).then(r=>{if(this.parent&&!this.parent.isDestroyed){if(s=r.result&&r.result.result?r.result.result:r.result,n=Ni(y.startCell),p=n[0],g=n[1],s&&s.length){if(y.info.count||(v=r.count,y.info.count=r.count),i=Object.keys(s[0]),y.info.fldLen||(y.info.fldLen=i.length,y.info.flds=i),y.info.insertColumnRange){let e=0;y.info.insertColumnRange.forEach(t=>{for(let n=t[0];n<=t[1];n++)i.splice(n<=g?0:n-g,0,`emptyCell${e}`),e++})}0===h[m]&&y.showFieldAsHeader&&(c=p+h[m]+C,i.forEach((i,n)=>{t=Cs(c,g+n,e.sheet,!0),t?t.value&&!e.dataSourceChange||i.includes("emptyCell")||(t.value=i):e.sheet.rows[p+h[m]].cells[g+n]=i.includes("emptyCell")?{}:{value:i}}));const n=e.formulaCellRef?Ts(this.parent,e.sheet.id):void 0;s.forEach((s,r)=>{c=p+h[m]+r+(y.showFieldAsHeader?1:0)+C;for(let a=0;a<i.length;a++)t=Cs(c,g+a,e.sheet,!0),t?t.value&&!e.dataSourceChange||i[a].includes("emptyCell")||vs(c,g+a,e.sheet,this.getCellDataFromProp(s[i[a]]),!0):e.sheet.rows[c].cells[g+a]=i[a].includes("emptyCell")?{}:this.getCellDataFromProp(s[i[a]]),this.checkDataForFormat({args:e,cell:t,colIndex:g+a,rowIndex:c,i:r,j:a,k:m,range:y,sRanges:h,value:s[i[a]],sheetIndex:n})})}else i=[];if(e.sheet.usedRange.rowIndex=Math.max(p+(v||r.count)+(y.showFieldAsHeader?1:0)+C-1,e.sheet.usedRange.rowIndex),e.sheet.usedRange.colIndex=Math.max(g+i.length-1,e.sheet.usedRange.colIndex),C?(u=this.getLoadedInfo(f,b,y),f=u.unloadedRange[0],b=u.unloadedRange[1],f>v&&(u.isNotLoaded=!1),u.isNotLoaded&&(b>v&&(b=v),y.info.loadedRange.push([f,b]))):y.info.loadedRange.push([f,b]),l[m]=!0,-1===l.indexOf(!1)){if(b+p<p+y.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(m);const t={sheet:e.sheet,indexes:[0,0,e.sheet.usedRange.rowIndex,e.sheet.usedRange.colIndex],promise:new Promise((e,t)=>{e(void 0)}),rangeSettingCount:e.rangeSettingCount};this.updateSheetFromDataSourceHandler(t),t.promise.then(()=>{"workbook"!==this.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||this.parent.notify("created",null),e.formulaCellRef&&this.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex))})}else e.formulaCellRef&&this.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex);this.checkResolve(e.indexes)}}})}else 0===m&&-1===l.indexOf(!1)&&this.checkResolve(e.indexes)}else d.resolve()}notfyFormulaCellRefresh(e,t){this.parent.formulaRefCell=null,this.parent.notify("updateView",{indexes:Ni(e),sheetIndex:t,refreshing:!0})}checkResolve(e){let t,i,n=0;this.requestedInfo.forEach((s,r)=>{i=JSON.stringify(s.indexes)===JSON.stringify(e),(i||t)&&(0===r?(s.deferred.resolve(),n++,t=!0):!t||!s.isLoaded&&s.isNotLoaded?i&&t?(s.deferred.resolve(),n++):i?s.isLoaded=!0:t=!1:(s.deferred.resolve(),n++))}),this.requestedInfo.splice(0,n)}getCellDataFromProp(e){const t={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?t.formula=e.formula:e.value&&("string"!=typeof e.value||0!==e.value.indexOf("http://")&&0!==e.value.indexOf("https://")&&0!==e.value.indexOf("ftp://")&&0!==e.value.indexOf("www.")?t.value=e.value:t.hyperlink=e.value):hs(e)?t.formula=e:"string"!=typeof e||0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("ftp://")&&0!==e.indexOf("www.")?t.value=e:t.hyperlink=e,t}checkDataForFormat(e){if(""!==e.value){const t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1,sheetIndex:e.sheetIndex};this.parent.notify("checkDateFormat",t),t.isDate?e.cell?(e.cell.format=dn("ShortDate"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=dn("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format=dn("Time"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=dn("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}}getLoadedInfo(e,t,i){let n=!0;return i.info.loadedRange.forEach(i=>{i[0]<=e&&e<=i[1]?i[0]<=t&&t<=i[1]?n=!1:e=i[1]+1:i[0]<=t&&t<=i[1]&&(t=i[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}}getMaxCount(e){if(e.query){const t=e.query.queries;for(let i=0;i<t.length;i++)if("onTake"===t[i].fn)return Math.min(t[i].e.nos,e.info.count||t[i].e.nos)}return e.info.count}initRangeInfo(e){e.info||(e.info={loadedRange:[]})}dataSourceChangedHandler(e){let t;const i=this.parent.sheets[e.sheetIdx],n=i.ranges[e.rangeIdx];if(n&&(this.checkRangeHasChanges(i,e.rangeIdx)||!n.info)){const s=n.showFieldAsHeader,r=Bi(n.startCell);n.info&&(n.info.loadedRange.forEach(e=>{for(let a=e[0];a<=e[1]&&a<n.info.count+(s?1:0);a++)if(t=i.rows[a+r[0]],t)for(let e=r[1];e<r[1]+n.info.fldLen;e++)t.cells&&t.cells[e]&&delete t.cells[e]}),n.info=null);const a=this.parent.viewport,o=[a.topIndex,a.leftIndex,a.bottomIndex,a.rightIndex],l={sheet:i,indexes:o,dataSourceChange:!0,promise:new Promise((e,t)=>{e(void 0)})};this.updateSheetFromDataSourceHandler(l),l.promise.then(()=>{this.parent.notify("updateView",{indexes:o,checkWrap:!0}),this.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:Number(e.rangeIdx),sheetIndex:Number(e.sheetIdx)})})}}checkRangeHasChanges(e,t){if(this.parent.isAngular){const i="changedRangeIdx";return e[i]===parseInt(t,10)&&(delete e[i],!0)}return!0}dataChangedHandler(e){const t=[{}];let i,n,s,r,a,o,l;const h=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,c=this.parent.sheets[h];let d,p;c.ranges.forEach((g,u)=>{if(g.dataSource){let m;if(r=Bi(g.startCell),s=[...r,r[0]+g.info.count+(g.showFieldAsHeader?0:-1),r[1]+g.info.fldLen-1],"Row"===e.modelType)e.insertType?(a=(g.showFieldAsHeader||"above"!==e.insertType?s[0]<e.index:s[0]<=e.index)&&s[2]>=e.index,d=[e.index],a||s[2]+1===e.index&&"below"===e.insertType?(m=!0,g.info.count+=e.model.length):s[0]>=e.index&&(g.startCell=_i(r[0]+e.model.length,r[1]))):(a=s[0]<=e.startIndex&&s[2]>=e.startIndex,e.isDataRequest?d=[e.startIndex,s[1],e.startIndex,s[1]]:i="delete");else{d=Ni("paste"===e.requestType?e.pastedRange.split("!")[1]:e.sheetIdx>-1?e.address:(e.address||e.range).split("!")[1]);const t=[g.showFieldAsHeader?s[0]+1:s[0],...s.slice(1,4)];a=gs(t,d,!0),"paste"===e.requestType&&e.copiedInfo.isCut&&(p=[].slice.call(e.copiedInfo.range),o=gs(t,p,!0))}if(a||m||o){if("Row"!==e.modelType||e.insertType||e.isDataRequest){i=m?"add":"edit";let s=0;if(o){s=p[2]-p[0]+1;for(let e=0;e<s;e++)t[e]={},g.info.flds.forEach((i,s)=>{n=Cs(p[0]+e,r[1]+s,c),t[e][i]=this.getFormattedValue(n)})}if(a||m)for(let i=0;i<(m?e.model.length:d[2]-d[0]+1||1);i++)t[i+s]={},g.info.flds.forEach((e,a)=>{n=Cs(d[0]+i,r[1]+a,c),t[i+s][e]=this.getFormattedValue(n)})}else e.deletedModel.forEach((e,i)=>{t[i]={},g.info.flds.forEach((s,a)=>{e.cells?(n=e.cells[r[1]+a],t[i][s]=this.getFormattedValue(n)):t[i][s]=null}),g.info.count-=1}),l={count:e.deletedModel.length,index:e.endIndex};e.isDataRequest?e.data=t:this.parent.trigger("dataSourceChanged",{data:t,action:i,rangeIndex:u,sheetIndex:h})}else l&&l.count&&s[0]>l.index&&(g.startCell=_i(r[0]-l.count,r[1]))}})}getFormattedValue(e){const t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t}triggerDataChangeHandler(e){let t=!0;(("delete"===e.action||"insert"===e.action)&&["Column","Sheet"].indexOf(e.eventArgs.modelType)>-1||"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1||"clipboard"===e.action&&"Formats"===e.eventArgs.requestType)&&(t=!1),!e.isUndo||"delete"!==e.action&&"insert"!==e.action||("delete"===e.action?(e.eventArgs.index=e.eventArgs.startIndex,e.eventArgs.model=e.eventArgs.deletedModel,e.eventArgs.insertType="below"):(e.eventArgs.startIndex=e.eventArgs.index,e.eventArgs.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,e.eventArgs.deletedModel=e.eventArgs.model,delete e.eventArgs.insertType)),t&&["insert","delete","edit","cellDelete","cellSave","clipboard","clear"].indexOf(e.action)>-1&&this.parent.notify("dataChanged",e.eventArgs)}getModuleName(){return"dataBind"}destroy(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]}}const un="editOperation",mn="keyUp",fn="keyDown",bn="contextmenuBeforeOpen",yn="paste",xn="autoFitRowsColumns",Cn="actionComplete",vn="actionBegin",Sn="renderGotoDlgt",wn="renderFindDlg";class In{constructor(e){this.parent=e,this.addEventListener()}open(e){if(!this.parent.allowOpen)return;if(e.jsonObject)return void this.fetchSuccess(e.jsonObject,null,!0);const t=new FormData;if(!e.file)return void(this.parent.isOpen=!1);t.append("file",e.file);const i={passWord:""};e.password&&e.password.length&&(i.passWord=e.password),i.passWord&&i.passWord.length&&(e.password=i.passWord),e.password&&t.append("password",e.password);const n={file:e.file||null,cancel:!1,requestData:{method:"POST",body:t},password:i.passWord};this.parent.trigger("beforeOpen",n),this.parent.notify(vn,{eventArgs:n,action:"beforeOpen"}),n.cancel||fetch(this.parent.openUrl,n.requestData).then(e=>e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})).then(e=>this.fetchSuccess(e,n)).catch(e=>this.fetchFailure(e))}fetchFailure(e){Object(r.cb)(e.status)&&Object(r.cb)(e.statusText)&&(e.statusText="Improper response"),this.parent.notify("openFailure",e),this.parent.isOpen=!1}fetchSuccess(e,t,i){let n=e;n="string"==typeof e?JSON.parse(e):e;const s=n.Workbook;["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword"].indexOf(s)>-1?this.parent.notify("openSuccess",{context:this,data:s,eventArgs:t}):(this.updateModel(s,i),this.parent.notify("openSuccess",{context:this,data:s}),this.parent.isOpen=!1,t&&t.password&&t.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password=""))}updateModel(e,t){this.parent.notify(an,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,t),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify("sheetsDestroyed",{}),e.activeSheetIndex=e.activeSheetIndex||0,this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[]},!0),Bs(this.parent),this.parent.notify("sheetCreated",null),this.parent.notify(an,{action:"registerSheet",isImport:!0}),this.parent.notify(an,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null),this.parent.notify("updateFilter",{isOpen:!0})}setSelectAllRange(e,t){let i,n;e.forEach(e=>{if(e.selectedRange){const t=Ni(e.selectedRange),i=(Object(r.cb)(e.rowCount)?100:e.rowCount)-1,n=(Object(r.cb)(e.colCount)?100:e.colCount)-1;65535===t[2]&&(t[2]=i),255===t[3]&&(t[3]=n),65535===t[0]&&(t[0]=i),255===t[1]&&(t[1]=n),e.selectedRange=zi(t)}if(t&&this.parent.isAngular)for(let t=0;t<this.parent.sheets.length;t++)if(i=this.parent.sheets[t],e.name===i.name){e.ranges&&e.ranges.forEach((e,t)=>{n=i.ranges[t],n&&n.template&&(e.template=n.template)});break}})}addEventListener(){this.parent.on("workbookOpen",this.open.bind(this))}removeEventListener(){this.parent.isDestroyed||this.parent.off("workbookOpen",this.open.bind(this))}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"workbookOpen"}}class On extends class{constructor(e){this.parent=e}processSheet(e,t){return[t,JSON.parse(e,(e,t)=>{if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]}processSave(e,t,i){const n=new FormData;let s,r=Object.keys(t);for(n.append("JSONData",JSON.stringify(e)),s=0;s<r.length;s++)n.append(r[s],t[r[s]]);for(r=Object.keys(i),s=0;s<r.length;s++)n.append(r[s],i[r[s]]);fetch(t.url,{method:"POST",body:n}).then(e=>e.ok?e.blob():Promise.reject({message:e.statusText})).then(e=>{new Promise(t=>{const i=new FileReader;i.onload=()=>{let n=i.result.toString();if(n.indexOf("data:text/plain;base64,")>-1||n.indexOf("data:text/html;base64,")>-1||n.indexOf("data:application/json;base64,")>-1){let e;if(n=n.replace("data:text/plain;base64,",""),n=n.replace("data:text/html;base64,",""),n.indexOf("data:application/json;base64,")>-1?(n=n.replace("data:application/json;base64,",""),e=atob(n).split(".")):e=atob(n).split(/(\r\n|\n|\r)/gm),e.length){const t=e[0].length>1&&'"'===e[0][0]?e[0].split('"')[1]+".":e[0];postMessage({dialog:t})}}else postMessage(e);t(i.result)},i.readAsDataURL(e)})}).catch(e=>{postMessage({error:e.message})})}}{constructor(e){super(e),this.isProcessCompleted=!1,this.saveJSON={},this.isFullPost=!1,this.needBlobData=!1,this.customParams=null,this.addEventListener()}getModuleName(){return"workbookSave"}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("beginSave",this.initiateSave,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("beginSave",this.initiateSave)}initiateSave(e){const t=e.saveSettings;this.parent.notify("getFilteredCollection",null),this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.updateBasicSettings(),this.processSheets()}updateBasicSettings(){const e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t}processSheets(){let e=0;const t=this.parent.sheets.length,i=["dataSource","startCell","query","showFieldAsHeader"];for(this.parent.isAngular&&i.push("template");e<t;)Yi(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[e],i),e]),e++}updateSheet(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)}getSheetLength(e){let t=0;return e.forEach(e=>{e&&t++}),t}save(e){const t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify("onSave",t),t.cancel||(this.isFullPost?this.initiateFullPostSave():Yi(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams],!0)),this.saveJSON={}}updateSaveResult(e){const t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify("saveError",{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify("saveCompleted",t)}ClientFileDownload(e){const t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),i=URL.createObjectURL(e);t.href=i,document.body.appendChild(t),t.click(),URL.revokeObjectURL(i),document.body.removeChild(t)}initiateFullPostSave(){let e,t=Object.keys(this.saveSettings);const i=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}});let n=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(n.value=JSON.stringify(this.saveJSON),i.appendChild(n),e=0;e<t.length;e++)n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}}),n.value=this.saveSettings[t[e]],i.appendChild(n);for(t=Object.keys(this.customParams),e=0;e<t.length;e++)n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}}),n.value=this.customParams[t[e]],i.appendChild(n);document.body.appendChild(i),i.submit(),Object(r.J)(i),this.parent.notify("saveCompleted",{})}getStringifyObject(e,t=[]){return JSON.stringify(e,(e,i)=>t.indexOf(e)>-1?void 0:i&&"object"==typeof i&&i.hasOwnProperty("properties")?i.properties:null!==i?i:void 0)}getFileNameWithExtension(e){e||(e=this.saveSettings.fileName);const t=this.getFileExtension(),i=e.lastIndexOf(".");return i>-1&&(e=e.substr(0,i)),e+t}getFileExtension(){return"."+this.saveSettings.saveType.toLowerCase()}}function Rn(e,t){let i=t;const n=e.replace(/\[/g,".").replace(/\]/g,"").split(".");for(let s=0;s<n.length&&!Object(r.cb)(i);s++)i=i[n[s]];return i}function An(e,t,i){const n=e.replace(/\[/g,".").replace(/\]/g,"").split("."),s=i||{};let a,o=s;const l=n.length;let h;for(a=0;a<l;a++)h=n[a],a+1===l?o[h]=void 0===t?{}:t:Object(r.Z)(o[h])&&(o[h]={}),o=o[h];return s}class kn{constructor(e){this.loadedModules=[],this.parent=e}inject(e,t){const i=e.length;if(0!==i){this.loadedModules.length&&this.clearUnusedModule(e);for(let n=0;n<i;n++){const i=e[n];for(const e of t){const t=i.member;if(e.prototype.getModuleName()===i.member&&!this.isModuleLoaded(t)){const n=this.createInstance(e,i.args),s=this.getMemberName(t);An(s,i.isProperty?e:n,this.parent);const r=i;r.member=s,this.loadedModules.push(r)}}}}else this.clean()}createInstance(e,t){const i=t;return i.unshift(void 0),new(Function.prototype.bind.apply(e,i))}clean(){for(const e of this.loadedModules)e.isProperty||Rn(e.member,this.parent).destroy();this.loadedModules=[]}clearUnusedModule(e){const t=e.map(e=>this.getMemberName(e.member)),i=this.loadedModules.filter(e=>-1===t.indexOf(e.member));for(const n of i)n.isProperty||Rn(n.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(n),1),this.deleteObject(this.parent,n.member)}getMemberName(e){return e[0].toLowerCase()+e.substring(1)+"Module"}deleteObject(e,t){delete e[t]}isModuleLoaded(e){for(const t of this.loadedModules)if(t.member===this.getMemberName(e))return!0;return!1}}var En=function(e){return e[e.na=0]="na",e[e.value=1]="value",e[e.ref=2]="ref",e[e.divzero=3]="divzero",e[e.num=4]="num",e[e.name=5]="name",e[e.null=6]="null",e}({}),Ln=function(e){return e[e.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",e[e.reservedWord_And=1]="reservedWord_And",e[e.reservedWord_Xor=2]="reservedWord_Xor",e[e.reservedWord_If=3]="reservedWord_If",e[e.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",e[e.reservedWord_Else=5]="reservedWord_Else",e[e.reservedWord_Not=6]="reservedWord_Not",e[e.invalid_char_in_number=7]="invalid_char_in_number",e[e.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",e[e.mismatched_parentheses=8]="mismatched_parentheses",e[e.unknown_formula_name=9]="unknown_formula_name",e[e.requires_a_single_argument=10]="requires_a_single_argument",e[e.requires_3_args=11]="requires_3_args",e[e.invalid_Math_argument=12]="invalid_Math_argument",e[e.requires_2_args=13]="requires_2_args",e[e.bad_index=14]="bad_index",e[e.too_complex=15]="too_complex",e[e.circular_reference=16]="circular_reference",e[e.missing_formula=17]="missing_formula",e[e.improper_formula=18]="improper_formula",e[e.invalid_expression=19]="invalid_expression",e[e.cell_empty=20]="cell_empty",e[e.bad_formula=21]="bad_formula",e[e.empty_expression=22]="empty_expression",e[e.virtual_mode_required=23]="virtual_mode_required",e[e.mismatched_tics=24]="mismatched_tics",e[e.wrong_number_arguments=25]="wrong_number_arguments",e[e.invalid_arguments=26]="invalid_arguments",e[e.iterations_do_not_converge=27]="iterations_do_not_converge",e[e.calculation_overflow=29]="calculation_overflow",e[e.already_registered=28]="already_registered",e[e.missing_sheet=30]="missing_sheet",e[e.cannot_parse=31]="cannot_parse",e[e.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator",e[e.spill=33]="spill",e}({});class Tn{constructor(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"T",category:"Text",description:"Checks whether a value is text and returns the text if it is, or returns empty string if it is not."}],this.isConcat=!1,this.parent=e,this.init()}init(){let e;for(let t=0;t<this.formulas.length;t++)e=Object(r.X)("Compute"+this.formulas[t].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[t].formulaName.toUpperCase(),e,this.formulas[t].category,this.formulas[t].description)}addFormulaCollection(e,t,i,n){this.parent.libraryFormulas={fName:e,handler:t,category:i,description:n}}ComputeSUM(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];let t,i,n=0;if(!Object(r.Z)(e)){const s=e;for(let e=0;e<s.length;e++){const a=s[e].toString();if(a.indexOf(":")>-1&&this.parent.isCellReference(a)){const e=this.parent.getCellCollection(a.split(this.parent.tic).join(""));for(let i=0;i<e.length;i++){if(t=this.parent.getValueFromArg(e[i]),this.parent.getErrorStrings().indexOf(t)>-1)return t;Object(r.Z)(t[0])||isNaN(this.parent.parseFloat(t))||(n+=this.parent.parseFloat(t))}}else{if(s[e].split(this.parent.tic).join("")===this.parent.trueValue&&(s[e]="1"),s[e].split(this.parent.tic).join("")===this.parent.falseValue&&(s[e]="0"),i=this.parent.getValueFromArg(s[e].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(Object(r.Z)(i)||isNaN(this.parent.parseFloat(i)))continue;i.length>0&&(n+=this.parent.parseFloat(i+""))}}}return n}ComputeT(...e){let t="";if(Object(r.Z)(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];let i=e[0];return i=i.indexOf(":")>-1?i.split(":")[0]:i,i=this.parent.getValueFromArg(i),null===i.match(/^[0-9.]+$/)&&"TRUE"!==i.toUpperCase()&&"FALSE"!==i.toUpperCase()&&(t=i),t}ComputeINT(...e){let t,i,n;return(!Object(r.Z)(e)&&1!==e.length||""===e[0])&&(t=this.parent.formulaErrorStrings[Ln.invalid_arguments]),""!==e[0]&&1===e.length&&(t=e[0],n=t.indexOf('"'),t=t.indexOf('"')>-1?t.replace('"',""):t,t=t.indexOf('"')>-1?t.replace('"',""):t,t=this.parent.getValueFromArg(t),t="TRUE"===t.toUpperCase()?"1":"FALSE"===t?"0":t,i=this.parent.parseFloat(t),i=Math.floor(i)),isNaN(i)&&(t=n>-1?this.parent.getErrorStrings()[En.value]:this.parent.getErrorStrings()[En.name]),i||t}ComputeTODAY(...e){let t;if(e&&""!==e[0])t=this.parent.formulaErrorStrings[Ln.invalid_arguments];else{const e=new Date(Date.now());t=e.getFullYear()+"/"+this.parent.calculateDate((e.getMonth()+1).toString())+"/"+this.parent.calculateDate(e.getDate().toString())}return t}ComputeSUMPRODUCT(...e){let t,i=0,n=0,s=null;const r=e;for(let a=0;a<r.length;++a){const e=r[a];if(e.startsWith(this.parent.tic)||!this.parent.isCellReference(e)){const i=this.parent.getValueFromArg(e);return t=i.indexOf('"'),this.parent.getErrorStrings().indexOf(i)>-1?i:t>-1?0:this.parent.formulaErrorStrings[Ln.invalid_arguments]}{let t=e.indexOf(":");const i=this.parent.rowIndex(e.substr(0,t)),r=this.parent.rowIndex(e.substr(t+1));if(!(-1!==i||-1===r)==(-1===i||-1!==r))return this.parent.getErrorStrings()[En.name];const a=this.parent.colIndex(e.substr(0,t)),o=this.parent.colIndex(e.substr(t+1));if(null===s)for(n=(r-i+1)*(o-a+1),s=[],t=0;t<n;++t)s[t]=1;t=0;for(let n=i;n<=r;++n)for(let i=a;i<=o;++i){const r=this.getSheetReference(e)+this.parent.convertAlpha(i)+n,a=this.parent.getValueFromArg(r);if(isNaN(parseFloat(a)))s[t]=0;else{if(isNaN(s[t]))return this.parent.getErrorStrings()[En.name];s[t]=s[t]*parseFloat(a)}t++}}}for(let a=0;a<n;++a)i+=s[a];return i}ComputeROUNDUP(...e){let t,i,n,s,a;const o=e.length;if(!Object(r.Z)(e)&&o>2&&(t=this.parent.formulaErrorStrings[Ln.invalid_arguments]),1===o&&""!==e[0])a=e[0].indexOf('"'),n=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0],n=n.indexOf('"')>-1?n.replace('"',""):n,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n,n=this.parent.getValueFromArg(n),i=this.parent.parseFloat(n),i>0?i+=.4999999999:i<0&&(i-=.4999999999),i=this.parent.parseFloat(i.toFixed(0)),t=i.toString();else if(2===o&&""!==e[0]&&""!==e[1]){a=e[0].indexOf('"')>-1?e[0].indexOf('"'):e[1].indexOf('"')>-1?e[1].indexOf('"'):-1,n=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0],n=n.indexOf('"')>-1?n.replace('"',""):n,s=e[1].indexOf('"')>-1?e[1].replace('"',""):e[1],s=s.indexOf('"')>-1?s.replace('"',""):s,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n,s="TRUE"===s.toUpperCase()?"1":"FALSE"===s?"0":s,n=this.parent.getValueFromArg(n),s=this.parent.getValueFromArg(s);const r=Math.ceil(this.parent.parseFloat(s));i=this.parent.parseFloat(n),r>0?(i>0?i+=.4999999999/Math.pow(10,r):i<0&&(i-=.4999999999/Math.pow(10,r)),i=this.parent.parseFloat(i.toFixed(r)),t=i.toFixed(r),isNaN(i)&&(t=r.toString().indexOf('"')>-1?this.parent.getErrorStrings()[En.value]:this.parent.getErrorStrings()[En.name])):(i>0?i=i/Math.pow(10,-r)+.49999:i<0&&(i=i/Math.pow(10,-r)-.49999),i=this.parent.parseFloat(i.toFixed(0))*Math.pow(10,-r),t=i.toString(),isNaN(i)&&(t=r.toString().indexOf('"')>-1?this.parent.getErrorStrings()[En.value]:t=this.parent.getErrorStrings()[En.name]))}else t=a>-1?this.parent.getErrorStrings()[En.value]:this.parent.formulaErrorStrings[Ln.invalid_arguments];return t}ComputeCOUNT(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;let i,n,s,a=0;for(let r=0;r<t.length;r++)if(i=t[r],i.indexOf(":")>-1&&this.parent.isCellReference(i)){n=this.parent.getCellCollection(i.split(this.parent.tic).join(""));for(let e=0;e<n.length;e++)s=this.parent.getValueFromArg(n[e]),isNaN(this.parent.parseFloat(s))||i.length>0&&""!==i&&" "!==i&&a++}else i=i.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(i)))||i.length>0&&""!==i&&" "!==i&&a++;return a}ComputeDATE(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;if(3!==t.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];for(let r=0;r<t.length;++r)t[r]=this.parent.getValueFromArg(t[r]);t[0]="TRUE"===t[0].split(this.parent.tic).join("")?"1":"FALSE"===t[0].split(this.parent.tic).join("")?"0":t[0],t[1]="TRUE"===t[1].split(this.parent.tic).join("")?"1":"FALSE"===t[1].split(this.parent.tic).join("")?"0":t[1],t[2]="TRUE"===t[2].split(this.parent.tic).join("")?"1":"FALSE"===t[2].split(this.parent.tic).join("")?"0":t[2];let i=this.parent.parseFloat(t[0].split(this.parent.tic).join("")),n=this.parent.parseFloat(t[1].split(this.parent.tic).join(""));const s=this.parent.parseFloat(t[2].split(this.parent.tic).join(""));let a=0;if(isNaN(i)||isNaN(n)||isNaN(s))return this.parent.getErrorStrings()[En.value].toString();if(i<0)return this.parent.getErrorStrings()[En.num].toString();for(;n>12;)n-=12,i++;if(a=this.parent.getSerialDateFromDate(i,n,s),0===a)return this.parent.getErrorStrings()[En.num].toString();const o=this.parent.fromOADate(a);return"Invalid Date"!==o.toString()?o.getFullYear()+"/"+this.parent.calculateDate((o.getMonth()+1).toString())+"/"+this.parent.calculateDate(o.getDate().toString()):a.toString()}ComputeFLOOR(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];const t=e,i=t.length,n=t[1].split(this.parent.tic).join(""),s=[];let a,o;if(2!==i)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(s.push(a=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")))),t[1]=n===this.parent.trueValue?"1":n===this.parent.falseValue?"0":t[1],s.push(o=this.parent.parseFloat(this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")))),a>0&&o<0)return this.parent.getErrorStrings()[En.num];if(a>0&&0===o)return this.parent.getErrorStrings()[En.divzero];for(let r=0;r<t.length;r++)if(t[r].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[En.value];return isNaN(a)?this.parent.getErrorStrings()[En.name]:Math.floor(a/o)*o}ComputeCEILING(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];const t=e,i=[],n=t.length,s=t[1].split(this.parent.tic).join("");let a,o;if(2!==n)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(i.push(a=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")))),t[1]=s===this.parent.trueValue?"1":s===this.parent.falseValue?"0":t[1],i.push(o=this.parent.parseFloat(this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")))),a>0&&o<0)return this.parent.getErrorStrings()[En.num];for(let r=0;r<t.length;r++)if(t[r].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[En.value];return isNaN(a)?this.parent.getErrorStrings()[En.name]:0===o?0:Math.ceil(a/o)*o}ComputeDAY(...e){const t=e;let i;if(Object(r.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];if(t.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const n=this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(n))?(i=this.parent.parseDate(n),"[object Date]"===Object.prototype.toString.call(i)&&(i=i.getDate()),i):this.parent.getErrorStrings()[En.name]}ComputeIF(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];if(this.parent.getErrorStrings().indexOf(e[0])>0)return e[0];const t=e;let i,n,s;if(4===t.length&&"nestedFormulaTrue"===t[3]&&(i=!0,t.pop()),t.length>3||1===t.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(t.length<=3){if(n=this.parent.getValueFromArg(t[0]),this.parent.getErrorStrings().indexOf(n)>-1)return n;if(n===this.parent.trueValue||this.parent.parseFloat(n)>0||this.parent.parseFloat(n)<0)s=this.parent.getValueFromArg(t[1]);else{if(n!==this.parent.falseValue&&0!==this.parent.parseFloat(n))return this.parent.formulaErrorStrings[Ln.requires_3_args];if(Object(r.Z)(t[2]))return this.parent.falseValue;s=this.parent.getValueFromArg(t[2])}}return!i&&s.indexOf(this.parent.tic)>-1?s.split(this.parent.tic).join(""):s}ComputeIFERROR(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];const t=e;let i;return 2!==t.length?this.parent.formulaErrorStrings[Ln.wrong_number_arguments]:(i=this.parent.getValueFromArg(t[0]),i===this.parent.trueValue||i===this.parent.falseValue?i:(i[0]===this.parent.arithMarker&&(i=i.replace(this.parent.arithMarker," ")),i=this.parent.getValueFromArg(i).toUpperCase().split(this.parent.tic).join(""),"#"===i[0]||i.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(i)>-1?this.parent.getValueFromArg(t[1]).split(this.parent.tic).join(""):i))}ComputePRODUCT(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];let t,i,n,s=1,a=!0;if(!Object(r.Z)(e)){const r=e;for(let e=0;e<r.length;e++){const o=r[e];if(o.indexOf(":")>-1&&this.parent.isCellReference(o)){const e=this.parent.getCellCollection(o);for(let i=0;i<e.length;i++){if(t=this.parent.getValueFromArg(e[i].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(t)>-1)return t;t="TRUE"===t.split(this.parent.tic).join("")?"1":"FALSE"===t.split(this.parent.tic).join("")?"0":t,n=this.parent.parseFloat(t),isNaN(n)||t.length>0&&(s*=n,a=!1)}}else{if(i=this.parent.getValueFromArg(r[e].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,n=this.parent.parseFloat(i),isNaN(n)||i.length>0&&(s*=n,a=!1),this.parent.getErrorStrings().indexOf(i)>-1)return i}}}return a?"0":s.toString()}ComputeDAYS(...e){let t;if(Object(r.Z)(e)&&1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];if(2!==e.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=e;i[0].split(this.parent.tic).join("")===this.parent.trueValue&&(i[0]="1"),i[0].split(this.parent.tic).join("")===this.parent.falseValue&&(i[0]="0");let n=this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")),s=this.parent.getValueFromArg(i[1].split(this.parent.tic).join(""));if(s=""===s||null==s?new Date(Date.parse("1899-12-31")).toDateString():s,n=""===n||null==n?new Date(Date.parse("1899-12-31")).toDateString():n,"#"===n[0])return n;if("#"===s[0])return s;const a=this.parent.intToDate(n),o=this.parent.intToDate(s);return"#"===a.toString()[0]?a.toString():"#"===o.toString()[0]?o.toString():"[object Date]"!==Object.prototype.toString.call(a)||"[object Date]"!==Object.prototype.toString.call(o)?this.parent.getErrorStrings()[En.value]:(t=Math.ceil(a.getTime()-o.getTime())/864e5,Math.round(t))}ComputeUNIQUE(...e){const t=e;let i;if(Object(r.Z)(e)||""===e[0]||t.length>3)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const n=t[1]?t[1].toUpperCase():"FALSE",s=t[2]?t[2].toUpperCase():"FALSE",a=[];if(t[0].indexOf(":")>-1){if(Object(r.Z)(t[0].match(/[0-9]/))){const e=t[0].split(":");t[0]=e[0]+"1:"+e[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if(Object(r.Z)(t[0].toUpperCase().match(/[A-Z]/))){const e=t[0].split(":");t[0]="A"+e[0]+":"+Hn(this.parent.spreadSheetUsedRange[1]+1)+e[1]}const e=t[0].split(":");if(this.parent.isCellReference(e[0])&&this.parent.isCellReference(e[1])){const e=this.parent.dependencyCollection;for(let i=0;i<e.length;i++)e[i].split(":")[0]===t[0].split(":")[0]&&this.clearDependency(e[i]);-1===this.parent.dependencyCollection.indexOf(t[0])?this.parent.dependencyCollection.push(t[0]):this.clearDependency(t[0]);const r=t[0].indexOf(":");let o,l=this.parent.rowIndex(this.parent.substring(t[0],0,r)),h=this.parent.colIndex(this.parent.substring(t[0],0,r)),c=this.parent.rowIndex(this.parent.substring(t[0],r+1,r+t[0].length-r-1)),d=this.parent.colIndex(this.parent.substring(t[0],r+1,r+t[0].length-r-1));l>c&&(o=c,c=l,l=o),h>d&&(o=d,d=h,h=o);let p="";0===t[0].indexOf("!")&&(p=t[0],p=p.replace("!",""),p=p.indexOf("!"),p=t[0].substring(0,p+2)),t[0]=p+Hn(h)+l+":"+Hn(d)+c;const g=this.parent.getCellCollection(t[0]),u=d-h,m=[];for(let t=0;t<g.length;t++)m.push(g[t]);if("FALSE"===n)if(0===u)for(let t=0;t<m.length;t++){let e=this.parent.getValueFromArg(m[t]);e=""===e?"0":e,a.push(e)}else{let e="",t=u;for(let i=0;i<m.length;i++){if(i===m.length-1){let t=this.parent.getValueFromArg(m[i]);t=""===t?"0":t,e=e+t+"+",a.push(e.substring(0,e.length-1))}if(i<=t){let t=this.parent.getValueFromArg(m[i]);t=""===t?"0":t,e=e+t+"+"}else{a.push(e.substring(0,e.length-1)),t=u+i;let n=this.parent.getValueFromArg(m[i]);n=""===n?"0":n,e=n+"+"}}}else{let e="";const t=u+1,i=c-l;for(let n=0;n<t;n++){for(let s=0;s<=i;s++){let i=this.parent.getValueFromArg(m[s*t+n]);i=""===i?"0":i,e=e+i+"+"}a.push(e.substring(0,e.length-1)),e=""}}let f=[];const b=[];for(let t=0;t<a.length;t++)-1===f.indexOf(a[t])?f.push(a[t]):b.push(a[t]);if("TRUE"===s){const e=[];for(let t=0;t<f.length;t++)-1===b.indexOf(f[t])&&e.push(f[t]);f=e}const y=this.parent.actCell;let x=this.parent.rowIndex(y),C=this.parent.colIndex(y);if(0===this.parent.dependencyLevel)if("FALSE"===n){for(let e=x,t=f.length+x;e<t;e++)for(let i=C,n=f[0].split("+").length+C;i<n;i++)e===t-1&&i===n-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Hn(i)+e)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Hn(i)+e);for(let e=x,t=f.length+x;e<t;e++)for(let i=C,n=f[0].split("+").length+C;i<n;i++){const t=this.parent.getValueFromArg(Hn(i)+e,!0);if(""!==t&&1!==t.indexOf("UNIQUE"))return this.parent.formulaErrorStrings[Ln.spill]}}else{for(let e=C,t=f.length+C;e<t;e++)for(let i=x,n=f[0].split("+").length+x;i<n;i++)e===t-1&&i===n-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Hn(e)+i)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Hn(e)+i);for(let e=C,t=f.length+C;e<t;e++)for(let i=x,n=f[0].split("+").length+x;i<n;i++){const t=this.parent.getValueFromArg(Hn(e)+i,!0);if(""!==t&&1!==t.indexOf("UNIQUE"))return this.parent.formulaErrorStrings[Ln.spill]}}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(Hn(C)+x,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[Ln.spill];if("FALSE"===n){for(let e=0;e<f.length;e++){const t=f[e].split("+");e>0&&(x++,C=this.parent.colIndex(y));for(let e=0;e<t.length;e++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,t[e],x,C),t[e+1]&&C++}i=f[0].split("+")[0]}else{for(let e=0;e<f.length;e++){const t=f[e].split("+");for(let e=0;e<t.length;e++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,t[e],x,C),t[e+1]?x++:(C++,x=this.parent.rowIndex(y))}i=f[0].split("+")[0]}}}else this.parent.isCellReference(t[0])&&(-1===this.parent.dependencyCollection.indexOf(t[0])?this.parent.dependencyCollection.push(t[0]):this.clearDependency(t[0]),i=this.parent.getValueFromArg(t[0]));return i}clearDependency(e){const t=this.parent.actCell,i=this.parent.rowIndex(t),n=this.parent.colIndex(t),s=e.indexOf(":"),r=this.parent.rowIndex(this.parent.substring(e,0,s)),a=this.parent.colIndex(this.parent.substring(e,0,s)),o=this.parent.rowIndex(this.parent.substring(e,s+1,s+e.length-s-1))-r+i,l=this.parent.colIndex(this.parent.substring(e,s+1,s+e.length-s-1))-a+n,h=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"";for(let c=i;c<=o;c++)for(let e=n;e<=l;e++)if(this.parent.dependencyLevel>0||h.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+Hn(n)+i,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,null,c,e)}}ComputeCHOOSE(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];if(e.length<2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;if(t[0].indexOf(":")>-1&&this.parent.isCellReference(t[0])){const e=this.parent.getCellCollection(t[0]);if(1!==e.length)return this.parent.getErrorStrings()[En.value];t[0]=e[0]}const i=this.parent.getValueFromArg(t[0]);if(this.parent.getErrorStrings().indexOf(i)>-1)return i;let n,s=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")));if(s<1)return this.parent.getErrorStrings()[En.value];if(s=Math.floor(s),Object(r.Z)(t[s]))return this.parent.getErrorStrings()[En.value];if(n=t[s],""===n&&(n="0"),n.indexOf(":")>-1&&this.parent.isCellReference(n)){const e=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""));if(1!==e.length)return this.parent.getErrorStrings()[En.value];t[0]=e[0]}return this.parent.getValueFromArg(n).split(this.parent.tic).join("")}ComputeSUMIF(...e){const t=e;if(t[0].indexOf(":")<0&&!this.parent.isCellReference(t[0])||t[2]&&t[2].indexOf(":")<0&&!this.parent.isCellReference(t[2]))return this.parent.formulaErrorStrings[Ln.improper_formula];if(t.length>3||t.length<2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]}ComputeABS(...e){const t=e;let i,n="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(""===t[0].toString().split(this.parent.tic).join("").trim()||t[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[En.value];if(this.parent.isCellReference(t[0])){if(n=this.parent.getValueFromArg(t[0]),""===n)return this.parent.getErrorStrings()[En.name];if(i=this.parent.parseFloat(n),isNaN(i))return this.parent.getErrorStrings()[En.value]}else if(i=this.parent.parseFloat(t[0]),isNaN(i))return this.parent.getErrorStrings()[En.name];return Math.abs(i)}ComputeAVERAGE(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];const t=e;for(let i=0;i<t.length;i++)if(t[i].indexOf(":")>-1&&t[i].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[En.value];return this.parent.calculateAvg(t)}ComputeAVERAGEIF(...e){const t=e;if(t[0].indexOf(":")<0&&!this.parent.isCellReference(t[0]))return this.parent.formulaErrorStrings[Ln.improper_formula];const i=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])}ComputeCONCATENATE(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.invalid_arguments];const t=e;let i="",n="";for(let s=0;s<t.length;s++){if(t[s].indexOf(":")>-1&&this.parent.isCellReference(t[s])){if(!this.isConcat)return this.parent.getErrorStrings()[En.value];{const e=this.parent.getCellCollection(t[s]);for(let t=0;t<e.length;t++)n=this.parent.getValueFromArg(e[t]),i+=n}}else{if(1===t.length&&t[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[En.name];n=this.parent.getValueFromArg(t[s]),i+=n}if(this.parent.getErrorStrings().indexOf(n)>-1)return n}return i.split(this.parent.tic).join("")}ComputeCONCAT(...e){return this.isConcat=!0,this.ComputeCONCATENATE(...e)}ComputeMAX(...e){return this.parent.computeMinMax(e,"max")}ComputeMIN(...e){return this.parent.computeMinMax(e,"min")}ComputeRAND(...e){return 1===e.length&&""===e[0]&&(e.length=0),e.length>0?this.parent.formulaErrorStrings[Ln.wrong_number_arguments]:Math.random().toString()}ComputeAND(...e){return this.parent.computeAndOr(e,"and")}ComputeOR(...e){return this.parent.computeAndOr(e,"or")}ComputeFIND(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;if(t.length>3)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=this.parent.removeTics(this.parent.getValueFromArg(t[0])),n=this.parent.removeTics(this.parent.getValueFromArg(t[1]));if(this.parent.getErrorStrings().indexOf(i)>-1||this.parent.getErrorStrings().indexOf(n)>-1)return this.parent.getErrorStrings()[En.name];let s=1;if(3===t.length){if(s=this.parent.removeTics(this.parent.getValueFromArg(t[2])),this.parent.getErrorStrings().indexOf(s)>-1)return s;s=this.parent.parseFloat(s),isNaN(s)&&(s=1)}if(s<=0||s>n.length)return this.parent.getErrorStrings()[En.value];const a=n.indexOf(i,s-1);return a<0?this.parent.getErrorStrings()[En.value]:(Number(a)+Number(1)).toString()}ComputeINDEX(...e){const t=e,i=t.length;if(Object(r.Z)(e)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(i>3)return this.parent.getErrorStrings()[En.ref];let n="";const s=[];if(i>2)for(let r=0;r<i;r++){if(this.parent.isCellReference(t[r])&&t[r].indexOf(":")<0)return this.parent.getErrorStrings()[En.ref];this.parent.isCellReference(t[r])&&(s[r]=t[r])}if(n=t[0],t[1]=""===t[1]?"1":t[1],t[1]=this.parent.getValueFromArg(t[1]),this.parent.getErrorStrings().indexOf(t[1])>-1)return t[1];if(!Object(r.Z)(t[2])){if(t[2]=""===t[2]?"1":t[2],t[2]=this.parent.getValueFromArg(t[2]),this.parent.getErrorStrings().indexOf(t[2])>-1)return t[2];if("0"===t[2])return this.parent.getErrorStrings()[En.value]}let a=parseFloat(t[1]);a=isNaN(a)?-1:a;let o=parseFloat(t[2]?t[2]:"1");if(o=isNaN(o)?-1:o,-1===a||-1===o)return this.parent.getErrorStrings()[En.value];const l=t[0].indexOf(":"),h=this.parent.rowIndex(n.substring(0,l)),c=this.parent.rowIndex(n.substring(l+1)),d=this.parent.colIndex(n.substring(0,l)),p=this.parent.colIndex(n.substring(l+1));if(a>c-h+1||o>p-d+1)return this.parent.getErrorStrings()[En.ref];a=h+a-1,o=d+o-1;const g=this.getSheetReference(n)+this.parent.convertAlpha(o)+a,u=this.parent.getValueFromArg(g);return""===u?0:u}getSheetReference(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""}ComputeIFS(...e){const t=e;if(Object(r.Z)(e)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];let i="",n="";for(let s=0;s<t.length;s++){if(i=this.parent.getValueFromArg(t[s]),i!==this.parent.trueValue&&i!==this.parent.falseValue)return this.parent.getErrorStrings()[En.value];if(i===this.parent.trueValue)return t[s+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(n=this.parent.isCellReference(t[s+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(t[s+1]):t[s+1].indexOf(this.parent.tic)>-1?t[s+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[En.name],s+=1,n);i===this.parent.falseValue&&(s+=1)}return this.parent.getErrorStrings()[En.na]}ComputeCOUNTA(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;let i,n,s=0;for(let r=0;r<t.length;r++)if(t[r].indexOf(":")>-1&&this.parent.isCellReference(t[r])){i=this.parent.getCellCollection(t[r].split(this.parent.tic).join(""));for(let e=0;e<i.length;e++)n=this.parent.getValueFromArg(i[e]),n.length>0&&s++}else this.parent.getValueFromArg(t[r].split(this.parent.tic).join("")).length>0&&s++;return s}ComputeAVERAGEA(...e){if(Object(r.Z)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;let i,n,s,a=0,o=0;for(let r=0;r<t.length;r++){if(t[r].indexOf(":")>-1&&this.parent.isCellReference(t[r])){i=this.parent.getCellCollection(t[r].split(this.parent.tic).join(""));for(let e=0;e<i.length;e++)if(n=this.parent.getValueFromArg(i[e]),n.toUpperCase()===this.parent.trueValue)n="1";else if(n.toUpperCase()===this.parent.falseValue||""===n)n="0";else{if(this.parent.getErrorStrings().indexOf(n)>-1)return n;n.length>0&&(s=parseFloat(n),n=isNaN(s)?0:s,a+=n,o+=1)}o=i.length}else{if(t[r]===this.parent.trueValue&&(t[r]="1"),t[r]!==this.parent.falseValue&&""!==t[r]||(t[r]="0"),n=this.parent.getValueFromArg(t[r].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;n.length>0&&(s=parseFloat(n),n=isNaN(s)?0:s,a+=n,o+=1)}if(0===o)return this.parent.getErrorStrings()[En.divzero]}return a/o}ComputeSORT(...e){const t=e;let i;if(Object(r.Z)(e)||""===e[0]||t.length>4)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];t[1]=t[1]?t[1]:"1",t[2]=t[2]?t[2]:"1";const n="1"===t[2]?"Ascending":"Descending";let s;t[3]=t[3]?t[3].toUpperCase():"FALSE",t[0]=t[0].split("$").join("");const o=[];if(t[0].indexOf(":")>-1){const e=t[0].split(":");if(this.parent.isCellReference(e[0])&&this.parent.isCellReference(e[1])){const e=t[0].indexOf(":");let r,l=this.parent.rowIndex(this.parent.substring(t[0],0,e)),h=this.parent.colIndex(this.parent.substring(t[0],0,e)),c=this.parent.rowIndex(this.parent.substring(t[0],e+1,e+t[0].length-e-1)),d=this.parent.colIndex(this.parent.substring(t[0],e+1,e+t[0].length-e-1));if(l>c&&(r=c,c=l,l=r),h>d&&(r=d,d=h,h=r),t[2]=this.parent.getValueFromArg(t[2]),"1"!==t[2]&&"-1"!==t[2])return this.parent.getErrorStrings()[En.value];if(!isNaN(this.parseDouble(t[1]))&&this.parseDouble(t[1])<1)return this.parent.getErrorStrings()[En.value];if(t[3].toUpperCase()!==this.parent.trueValue&&t[3].toUpperCase()!==this.parent.falseValue)return this.parent.getErrorStrings()[En.value];let p="";0===t[0].indexOf("!")&&(p=t[0],p=p.replace("!",""),p=p.indexOf("!"),p=t[0].substring(0,p+2)),t[0]=p+Hn(h)+l+":"+Hn(d)+c,s=this.parent.getCellCollection(t[0]);for(let t=0;t<s.length;t++)o.push(this.parent.getValueFromArg(s[t]));const g=[],u=d-h+1;if("TRUE"===t[3])for(let i=0;i<u;i++)o[i+(this.parseDouble(t[1])-1)*u]&&g.push(isNaN(this.parseDouble(o[i+(this.parseDouble(t[1])-1)*u]))?o[i+(this.parseDouble(t[1])-1)*u]:this.parseDouble(o[i+(this.parseDouble(t[1])-1)*u]));if("FALSE"===t[3])for(let i=0;i<o.length;i++)o[i*u+this.parseDouble(t[1])-1]&&g.push(isNaN(this.parseDouble(o[i*u+this.parseDouble(t[1])-1]))?o[i*u+this.parseDouble(t[1])-1]:this.parseDouble(o[i*u+this.parseDouble(t[1])-1]));const m=a.c.sort(g,null,a.c.fnSort(n)),f=[];for(let t=0;t<m.length;t++)for(let e=0;e<g.length;e++)JSON.stringify(m[t])===JSON.stringify(g[e])&&-1===f.indexOf(e)&&f.push(e);if("TRUE"===t[3]){for(let e=l,t=0;e<=c;e++,t++)for(let i=0,n=0;i<f.length;i++,n++){const s=this.parent.getValueFromArg(p+Hn(f[i]+h)+e),r=this.parent.actCell,a=this.parent.rowIndex(r),o=this.parent.colIndex(r);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,s,a+t,o+n)}i=this.parent.getValueFromArg(p+Hn(f[0]+h)+l)}if("FALSE"===t[3]){for(let e=0,t=0;e<f.length;e++,t++)for(let i=h,n=0;i<=d;i++,n++){const s=this.parent.getValueFromArg(p+Hn(i)+(f[e]+l)),r=this.parent.actCell,a=this.parent.rowIndex(r),o=this.parent.colIndex(r);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,s,a+t,o+n)}i=this.parent.getValueFromArg(p+Hn(h)+(f[0]+l))}}}return i}ComputeCOUNTIF(...e){const t=e;if(Object(r.Z)(e)||""===e[0]||2!==t.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];let i,n,s=0;const a=[];let o="equal",l=t[1].split(this.parent.tic).join("");if(l.startsWith("<=")?(o="lessEq",l=l.substring(2)):l.startsWith(">=")?(o="greaterEq",l=l.substring(2)):l.startsWith("<>")?(o="notEq",l=l.substring(2)):l.startsWith("<")?(o="less",l=l.substring(1)):l.startsWith(">")?(o="greater",l=l.substring(1)):l.startsWith("=")&&(o="equal",l=l.substring(1)),t[0].indexOf(":")>-1&&this.parent.isCellReference(t[0])){i=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""));for(let e=0;e<i.length;e++)n=this.parent.getValueFromArg(i[e]),(l.indexOf("*")>-1||l.indexOf("?")>-1)&&(n=this.parent.findWildCardValue(l,n)),a.push(n),a.push(l),this.parent.processLogical(a,o)===this.parent.trueValue&&s++}return s}ComputeSUMIFS(...e){return this.parent.computeIfsFormulas(e,this.parent.falseValue)}ComputeTEXT(...e){let t;const i=e.length;for(let u=0;u<i;u++)t=Object(r.Z)(t)?e[u]:t+","+e[u];const n=t.indexOf(","),s=t.slice(0,n),a=t.slice(t.indexOf('"')+1,t.length),o=a.indexOf('"');if(n>-1&&o!==a.length-1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];let l=s,h=a.slice(0,a.length-1),c=new Date(1900,0,1,0,0,0);const d=l+","+h,p=new r.n;if(this.parent.getErrorStrings().indexOf(d)>-1)return d;if(l=this.parent.getValueFromArg(l),h=h.split(this.parent.tic).join(""),""===h)return"";""===l&&(h.length>0&&(h.toUpperCase().indexOf("M")>-1||h.toUpperCase().indexOf("D")>-1||h.toUpperCase().indexOf("Y")>-1||h.toUpperCase().indexOf("S")>-1||h.toUpperCase().indexOf("T")>-1)||h.toUpperCase().indexOf("H")>-1)&&(l=c.toString());let g=this.parseDouble(l);if(isNaN(g)&&null!==this.parent.isDate(new Date(l))&&(g=this.parent.toOADate(new Date(l))),c=Date.parse(l.split(this.parent.tic).join("")),!isNaN(g)||!isNaN(c)){if("["===h[0])return this.parent.tic+l+this.parent.tic;if(h.length>0&&(h.toUpperCase().indexOf("M")>-1||h.toUpperCase().indexOf("D")>-1||h.toUpperCase().indexOf("Y")>-1||h.toUpperCase().indexOf("S")>-1||h.toUpperCase().indexOf("T")>-1)||h.toUpperCase().indexOf("H")>-1){h=h.split("Y").join("y").split("D").join("d").split("H").join("h"),h=h.split("S").join("s").split("m").join("M").split("AM/PM").join("tt");const e=h.split("");let t=!1,i=!1,n=0,s=0,r=0;for(n=0;n<e.length;){const a=e[n];"s"===a&&"M"===e[s]&&(e[s]="m","M"===e[s-1]&&(e[s-1]="m")),this.parent.isChar(a)?(s=n,"M"===a&&r++):r>1&&r++,"M"===a&&t&&(e[n]="m",i=!0),"h"===a?t=!0:this.parent.isChar(a)&&"M"!==a&&"h"!==a&&!i&&(t=!1,i=!1),n++}h=String(e),h=h.split(",").join("").split("\n").join(" ");let a=this.parent.fromOADate(g);0===g&&(a=c);const o=function(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM-yyyy":case"MMM yyyy":e="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;default:e=""}return e}(h);if(""===o)return this.parent.getErrorStrings()[En.name];l=p.getDateFormat({skeleton:o,type:"date"})(new Date(a.toString()))}else l=p.formatNumber(g,{format:h})}return l}ComputeCOUNTIFS(...e){return this.parent.computeIfsFormulas(e,this.parent.trueValue)}ComputeAVERAGEIFS(...e){return this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue)}ComputeMATCH(...e){const t=e;if(Object(r.Z)(t)||1===t.length&&""===t[0]||t.length<2||t.length>3)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];let i;const n=[];let s=t[0].split(this.parent.tic).join("");if(this.parent.isCellReference(s)&&(s=this.parent.getValueFromArg(s)),!s.toString().length)return this.parent.getErrorStrings()[En.na];t[2]=Object(r.Z)(t[2])?"1":t[2].split(this.parent.tic).join(""),t[2].split(this.parent.tic).join("")===this.parent.trueValue&&(t[2]="1"),t[2].split(this.parent.tic).join("")===this.parent.falseValue&&(t[2]="0");const a=parseFloat(t[2]);if(-1!==a&&0!==a&&1!==a)return this.parent.getErrorStrings()[En.na];let o=0,l="";if(t[1].indexOf(":")>-1||this.parent.isCellReference(t[1])){i=this.parent.getCellCollection(t[1].split(this.parent.tic).join(""));for(let e=0;e<i.length;e++)n[e]=this.parent.getValueFromArg(i[e]).split(this.parent.tic).join("");for(let e=0;e<n.length;e++)if(n[e].toString().length)if(1===a){if(s===n[e])return e+1;s>n[e]&&(l?n[e]>l&&(o=e+1,l=n[e]):(o=e+1,l=n[e]))}else if(0===a){if((s.indexOf("*")>-1||s.indexOf("?")>-1)&&(n[e]=this.parent.findWildCardValue(s,n[e])),s===n[e])return e+1;if(this.parent.parseFloat(s)===this.parent.parseFloat(n[e]))return e+1}else if(-1===a){if(s===n[e])return e+1;s<n[e]&&(l?n[e]<l&&(o=e+1,l=n[e]):(o=e+1,l=n[e]))}}return o||this.parent.getErrorStrings()[En.na]}ComputeSUBTOTAL(...e){const t=e;let i="";if(t.length<2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const n=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""))),s=t.slice(1,t.length);switch(n){case 1:case 101:i=this.ComputeAVERAGE(...s);break;case 2:case 102:i=this.ComputeCOUNT(...s);break;case 3:case 103:i=this.ComputeCOUNTA(...s);break;case 4:case 104:i=this.ComputeMAX(...s);break;case 5:case 105:i=this.ComputeMIN(...s);break;case 6:case 106:i=this.ComputePRODUCT(...s);break;case 7:case 107:i=this.ComputeDAY(...s);break;case 8:case 108:i=this.ComputeCONCAT(...s);break;case 9:case 109:i=this.ComputeSUM(...s);break;case 10:case 110:i=this.ComputeAVERAGEA(...s);break;case 11:case 111:i=this.ComputeABS(...s);break;default:i=this.parent.getErrorStrings()[En.value]}return i}ComputeRADIANS(...e){const t=e;let i;if(""===t[0]||t.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(t[0].indexOf(":")>-1||""===t[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[En.value];const n=t[0].split(this.parent.tic).join("");t[0]=isNaN(this.parent.parseFloat(n))?t[0]:n;const s=this.parent.getValueFromArg(t[0]),r=this.parent.parseFloat(s);return isNaN(r)?s.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[En.value]:this.parent.getErrorStrings()[En.name]:(i=Math.PI*r/180,i)}ComputeRANDBETWEEN(...e){const t=e.length;let i,n,s;if(2!==t)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];for(let r=0;r<t;r++){if(""===e[r])return this.parent.getErrorStrings()[En.na];if(e[r].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(e[r].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[En.value];e[r]=e[r].split(this.parent.tic).join("")}if(s=parseFloat(this.parent.getValueFromArg(e[r])),this.parent.isCellReference(e[r])){if(s=""===this.parent.getValueFromArg(e[r])?0:s,0===r?i=s:n=s,0===i&&0===n)return"0";if(isNaN(s))return this.parent.getErrorStrings()[En.value]}else{if(isNaN(s))return this.parent.getErrorStrings()[En.name];0===r?i=s:n=s}}return n<i?this.parent.getErrorStrings()[En.num]:0===i?Math.floor(Math.random()*(n-(i-1)))+i:n-i==1?Math.round(Math.random()*(n-i)+i):Math.floor(Math.random()*(n-(i-1)))+i}ComputeSLOPE(...e){const t=e;if(2!==t.length||""===t[0])return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=this.parent.getCellCollection(t[1].split(this.parent.tic).join("")),n=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""));if(n.length!==i.length)return this.parent.getErrorStrings()[En.na];const s=this.getDataCollection(n),r=this.getDataCollection(i);if(r.indexOf("#NAME?")>-1||s.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[En.name];let a=0,o=0,l=0,h=0;for(let d=0,p=r.length;d<p;++d)"NaN"!==Number(r[d]).toString()&&"NaN"!==Number(s[d]).toString()&&(a+=Number(r[d])*Number(s[d]),l+=Number(r[d]),h+=Number(s[d]),o+=Number(r[d])*Number(r[d]));const c=((a-l*h/r.length)/(o-l*l/r.length)).toString();return"NaN"===c?this.parent.getErrorStrings()[En.divzero]:c}ComputeINTERCEPT(...e){const t=e;if(""===t[0]||2!==t.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=this.parent.getCellCollection(t[0].split(this.parent.tic).join("")),n=this.parent.getCellCollection(t[1].split(this.parent.tic).join(""));if(i.length!==n.length)return this.parent.getErrorStrings()[En.na];const s=this.getDataCollection(n),r=this.getDataCollection(i);if(s.indexOf("#NAME?")>-1||r.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[En.name];let a=0,o=0;for(let p=0,g=s.length;p<g;++p)a+=Number(s[p]),o+=Number(r[p]);a/=s.length,o/=s.length;let l,h=0,c=0;for(let p=0,g=s.length;p<g;++p)l=Number(s[p])-a,h+=l*(Number(r[p])-o),c+=l*l;const d=(o-h/c*a).toString();return"NaN"===d?this.parent.getErrorStrings()[En.divzero]:d}ComputeLN(...e){const t=e;let i,n,s="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(this.parent.isCellReference(t[0])){if(s=this.parent.getValueFromArg(t[0]),i=this.parent.parseFloat(s),i<=0||""===s)return this.parent.getErrorStrings()[En.num];if(isNaN(i))return this.parent.getErrorStrings()[En.value]}else{if(n=this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")),i=this.parent.parseFloat(n),i<=0||""===i.toString())return this.parent.getErrorStrings()[En.num];if(isNaN(i))return this.parent.getErrorStrings()[En.value]}return Math.log(i)}ComputeISNUMBER(...e){const t=e;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];const i=this.parent.isCellReference(t[0])?this.parent.getValueFromArg(t[0]):this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""));if(""===i.toString())return!1;const n=this.parent.parseFloat(i);return!isNaN(n)}ComputeROUND(...e){const t=e;let i,n,s,r,a,o=0,l=0;return 0===e.length||e.length>2?this.parent.formulaErrorStrings[Ln.wrong_number_arguments]:1===e.length?(i="TRUE"===t[0].split(this.parent.tic).join("")?"1":"FALSE"===t[0].split(this.parent.tic).join("")?"0":t[0],Math.round(this.parent.parseFloat(i)).toString()):(s=this.parent.getValueFromArg(t[0]),r=""===t[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")),s="TRUE"===s.split(this.parent.tic).join("")?"1":"FALSE"===s.split(this.parent.tic).join("")?"0":s,r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r,""!==s&&""!==r&&(o=this.parent.parseFloat(s),l=this.parent.parseFloat(r),!isNaN(l)&&!isNaN(o)&&l>0?n=o.toFixed(l):(a=Math.pow(10,-l),n=Math.round(o/a)*a)),n.toString())}ComputePOWER(...e){const t=e;let i,n,s;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];n=this.parent.getValueFromArg(t[0]),s=this.parent.getValueFromArg(t[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,s="TRUE"===s.split(this.parent.tic).join("")?"1":"FALSE"===s.split(this.parent.tic).join("")?"0":s;const r=this.parent.parseFloat(n),a=this.parent.parseFloat(s);return isNaN(r)||isNaN(a)?this.parent.getErrorStrings()[En.value]:0===r&&a<0?this.parent.getErrorStrings()[En.divzero]:0===r&&0===a?this.parent.getErrorStrings()[En.num]:(i=Math.pow(r,a),i.toString())}ComputeLOG(...e){const t=e;let i,n;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];if(i=this.parent.getValueFromArg(t[0]),n=2===e.length?this.parent.getValueFromArg(t[1]):"10",""===i||null===i||""===n||null===n)return this.parent.getErrorStrings()[En.num];i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;const s=this.parent.parseFloat(i),r=this.parent.parseFloat(n);return s<=0||r<=0?this.parent.getErrorStrings()[En.num]:1===r?this.parent.getErrorStrings()[En.divzero]:isNaN(s)||isNaN(r)?this.parent.getErrorStrings()[En.value]:(Math.log(s)/Math.LN10/(Math.log(r)/Math.LN10)).toString()}ComputeTRUNC(...e){const t=e;let i,n=0;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];2===e.length&&(n=this.parent.getValueFromArg(t[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,n=this.parent.parseFloat(n)),i=this.parent.getValueFromArg(t[0]),i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i;const s=this.parent.parseFloat(i.split(this.parent.tic).join(""));if(isNaN(s)||isNaN(n))return t[0]===this.parent.tic||this.parent.isCellReference(t[0])||t[1]===this.parent.tic||this.parent.isCellReference(t[1])?this.parent.getErrorStrings()[En.value]:this.parent.getErrorStrings()[En.name];const r=Math.pow(10,n);return((s<0?-1:1)*Math.floor(r*Math.abs(s))/r).toString()}ComputeEXP(...e){const t=e;let i;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];i=this.parent.getValueFromArg(t[0]),i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,""===i&&(i="0");const n=this.parent.parseFloat(i);return n>709?this.parent.getErrorStrings()[En.num]:isNaN(n)?t[0]===this.parent.tic||this.parent.isCellReference(t[0])?this.parent.getErrorStrings()[En.value]:this.parent.getErrorStrings()[En.name]:Math.exp(n).toString()}ComputeGEOMEAN(...e){const t=e;let i,n,s,r,a=1,o=0,l=0;if(0===e.length)return this.parent.formulaErrorStrings[Ln.wrong_number_arguments];for(n=0;n<t.length;n++)if(t[n].indexOf(":")>-1){if(t[0]===this.parent.tic)return this.parent.getErrorStrings()[En.value];for(r=this.parent.getCellCollection(t[n].split(this.parent.tic).join("")),s=0;s<r.length;s++){if(l=this.parent.getValueFromArg(r[s]),l="TRUE"===l.split(this.parent.tic).join("")?"1":"FALSE"===l.split(this.parent.tic).join("")?"0":l,i=this.parent.parseFloat(l),i<=0)return this.parent.getErrorStrings()[En.num];isNaN(i)||(o++,a*=i)}}else if(l=this.parent.getValueFromArg(t[n]),l.length>0){if(l="TRUE"===l.split(this.parent.tic).join("")?"1":"FALSE"===l.split(this.parent.tic).join("")?"0":l,!this.parent.isCellReference(t[n])&&isNaN(this.parent.parseFloat(l)))return this.parent.getErrorStrings()[En.name];if(i=this.parent.parseFloat(l),i<=0)return this.parent.getErrorStrings()[En.num];isNaN(i)||(o++,a*=i)}return o>0&&(a=Math.pow(a,1/o)),a.toString()}getDataCollection(e){const t=[];for(let i=0,n=e.length;i<n;i++)t.push(this.parent.getValueFromArg(e[i]));return t}parseDouble(e){const t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t}getModuleName(){return"basic-formulas"}}class jn{constructor(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}parse(e,t){if(this.parent.isTextEmpty(e))return e;this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===e[0]&&(e=e.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(e=this.checkForNamedRangeAndKeyValue(e),this.findNamedRange=!1),e=(e=(e=(e=e.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");const i=this.storeStrings(e);e=this.storedStringText;let n=0;if(Object(r.Z)(i)&&(e=e.split(" ").join("")),(e=(e=e.split("=>").join(">=")).split("=<").join("<="))[e.length-1]===this.parent.arithMarker&&this.indexOfAny(e,this.tokens)===e.length-2||(e=e.toUpperCase()),e.indexOf(this.sheetToken)>-1){const t=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){e[0]!==this.sheetToken.toString()&&(e=this.parent.setTokensForSheets(e));const t=this.parent.getSheetToken(e.split(this.parent.tic).join(this.emptyStr)),i=this.checkScopedRange(e.split('"').join(this.emptyStr).split(this.sheetToken).join(""));Object(r.Z)(t)&&""!==t&&this.parent.namedRanges.size>0&&""!==i&&(e=i)}}e=this.markLibraryFormulas(e);try{e=this.formulaAutoCorrection(e)}catch(s){const i={message:s.message,exception:s,isForceCalculable:s.formulaCorrection,computeForceCalculate:!1};if(!i.isForceCalculable)throw this.parent.formulaErrorStrings[Ln.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",i),this.isFailureTriggered=!0),!i.isForceCalculable||!i.computeForceCalculate)throw this.parent.formulaErrorStrings[Ln.invalid_expression];e=this.formulaAutoCorrection(e,i),this.parent.storedData.get(t).formulaText="="+e}if(!this.ignoreBracet)for(n=e.indexOf(")");n>-1;){const t=e.substring(0,n).lastIndexOf("(");if(-1===t)throw new Pn(this.parent.formulaErrorStrings[Ln.mismatched_parentheses]);if(t===n-1)throw new Pn(this.parent.formulaErrorStrings[Ln.empty_expression]);let i=this.emptyStr;i=this.ignoreBracet?this.parent.substring(e,t,n-t+1):this.parent.substring(e,t+1,n-t-1);try{e=e.substring(0,t)+this.parseSimple(i)+e.substring(n+1)}catch(s){const e=this.exceptionArgs(s);this.isFailureTriggered||(this.parent.trigger("onFailure",e),this.isFailureTriggered=!0);const t="string"==typeof e.exception?e.exception:e.message;return(this.parent.getErrorLine(s)?"":"#"+this.parent.getErrorLine(s)+": ")+t}n=e.indexOf(")")}if(!this.ignoreBracet&&e.indexOf("(")>-1)throw new Pn(this.parent.formulaErrorStrings[Ln.mismatched_parentheses]);return e=this.parseSimple(e),null!==i&&i.size>0&&(e=this.setStrings(e,i)),e}exceptionArgs(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}}formulaAutoCorrection(e,t){const i=["*","+","-","/","^","&"],n=[">","=","<"];let s=0,a="",o="",l="",h="",c="",d="",p="",g=0;if(this.parent.formulaErrorStrings.indexOf(e)>-1)return e;if(this.indexOfAny(e,this.specialSym)>-1)throw new Pn(this.parent.formulaErrorStrings[Ln.invalid_expression],!1);for(;s<e.length;)if(e=e.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(e[s])&&e.length>s+1&&this.indexOfAny(e[s+1],i)>-1&&e.length>s+2&&!Object(r.Z)(e[s+2])&&this.indexOfAny(e[s+2],i)>-1&&("-"!==e[s+2]||"*"!==e[s+1]&&"/"!==e[s+1])){if(Object(r.Z)(t))throw new Pn(this.parent.formulaErrorStrings[Ln.invalid_expression],!0);if(!t.computeForceCalculate)throw this.parent.formulaErrorStrings[Ln.improper_formula];this.parent.isDigit(e[s])?(g<1?(d=e[s],l=e[s+1],Object(r.Z)(l)&&(l=this.emptyStr),l="&"===l?"":l,g+=1,a=a+d+l):g<2&&(p=e[s],h=e[s-1],c=e[s+1],g=0,"-"===h?(c=Object(r.Z)(c)?this.emptyStr:c,c="&"===c?"":c,a=a+h+p+c):(c=Object(r.Z)(c)?this.emptyStr:c,a=a+p+c)),s+=2):(a="-"===e[s]?a+e[s]:a,s+=1)}else if((this.parent.isDigit(e[s])||e[s]===this.parent.rightBracket||this.parent.storedData.has(e[s].toUpperCase()))&&(Object(r.Z)(e[s+1])||this.indexOfAny(e[s+1],i))>-1)o=Object(r.Z)(e[s+1])?this.emptyStr:e[s+1],o="&"===o?"":o,a="-"===e[s-1]?a+e[s-1]+e[s]+o:a+e[s]+o,s+=2;else if(this.indexOfAny(e[s],n)>-1&&!Object(r.Z)(e[s-1])&&!Object(r.Z)(e[s+1]))a+=e[s],s+=1;else if("q"===e[s])for(;e[s]!==this.parent.leftBracket;)a+=e[s],s+=1;else e[s]===this.parent.leftBracket||e[s]===this.parent.rightBracket||"{"===e[s]||"}"===e[s]||"("===e[s]||")"===e[s]||this.parent.isUpperChar(e[s])||e[s].indexOf(":")>-1||e[s]===this.parent.getParseArgumentSeparator()||"%"===e[s]&&this.parent.isDigit(e[s-1])||e[s]===this.parent.tic||" "===e[s]||"."===e[s]||e[s]===this.sheetToken||"$"===e[s]?(a+=e[s],s+=1):(this.parent.isDigit(e[s])&&(a="-"===e[s-1]?a+e[s-1]+e[s]:a+e[s]),"-"!==e[s]&&"+"!==e[s]||(a+=e[s],a=a.split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==e[s]&&"*"!==e[s]||(a+=e[s]),s+=1);return a=a===this.emptyStr?e:a,this.indexOfAny(a[a.length-1],i)>-1&&(a=a.substring(0,a.length-1)),a=a.split("--").join("-").split("-+").join("-").split("+-").join("-"),a}checkScopedRange(e){let t=this.emptyStr,i="NaN",n=this.parent.getSheetID(this.parent.grid);const s=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){const t=e.indexOf(this.sheetToken,1),i=parseInt(e.substr(1,t-1),10);t>1&&!this.parent.isNaN(i)&&(e=e.substring(t+1),n=i)}const a="!"+n.toString()+"!";return null===s||null==s.sheetNameToToken||s.sheetNameToToken.forEach((n,o)=>{if(s.sheetNameToToken.get(o).toString()===a){let n=this.emptyStr;this.parent.namedRanges.forEach((a,o)=>{n=Object(r.Z)(this.parent.parentObject)?s.sheetNameToToken.get(o).toUpperCase():(this.parent.parentObject.getActiveSheet().name+this.sheetToken+e).toUpperCase(),this.parent.getNamedRanges().has(n)&&(t=this.parent.getNamedRanges().get(n).toUpperCase(),i=t)})}}),i}storeStrings(e){let t,i=0,n=0,s=0,r="",a=null;if(e.indexOf(this.parent.tic)>-1)for(i=e.indexOf(this.parent.tic);i>-1&&e.length>0;){if(null===a&&(a=this.stringsColl),n=i+1<e.length?e.indexOf(this.parent.tic,i+1):-1,-1===n)throw new Pn(this.parent.formulaErrorStrings[Ln.mismatched_tics]);t=this.parent.substring(e,i,n-i+1),r=this.parent.tic+this.spaceString+s.toString()+this.parent.tic,a=a.set(r,t),e=e.substring(0,i)+r+e.substring(n+1),i+=r.length,i<=e.length&&(i=e.indexOf(this.parent.tic,i)),s++}return this.storedStringText=e,a}setStrings(e,t){for(let i=0;i<t.size;i++)t.forEach((t,i)=>{e=e.split(i).join(t)});return e}parseSimple(e){let t=!0,i=e;if(i.length>0&&"+"===i[0]&&(i=i.substring(1)),"#DIV/0!"===i)return"#DIV/0!";if("#NAME?"===i)return"#NAME?";if(""===i)return i;if(this.parent.formulaErrorStrings.indexOf(i)>-1)return i;i=i.split(this.stringLessEq).join(this.charLessEq),i=i.split(this.stringGreaterEq).join(this.charGreaterEq),i=i.split(this.stringNoEqual).join(this.charNoEqual),i=i.split(this.stringAnd).join(this.charAnd),i=i.split(this.stringOr).join(this.charOr),i=i.split(this.fixedReference).join(this.emptyStr),t=!0;const n=[this.tokenMultiply,this.tokenDivide],s=[this.tokenAdd,this.tokenSubtract],r=[this.charMultiply,this.charDivide],a=[this.charAdd,this.charSubtract],o=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],h=[this.tokenAnd],c=[this.charAnd],d=[this.charOr],p=[this.tokenOr];return i=this.parseSimpleOperators(i,[this.tokenEp,this.tokenEm],[this.charEp,this.charEm]),i=this.parseSimpleOperators(i,p,d),i=this.parseSimpleOperators(i,n,r),i=this.parseSimpleOperators(i,s,a),i=this.parseSimpleOperators(i,o,l),i=this.parseSimpleOperators(i,h,c),i}parseSimpleOperators(e,t,i){if(this.parent.getErrorStrings().indexOf(e)>-1)return e;let n=e,s=0,r="";for(let o=0;o<i.length;o++)r+=i[o];n=n.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u"),n=n.split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString(),n.length>0&&"-"===n[0]?(n=n.substring(1).split("-").join(this.tokenOr),n="0-"+n,n=this.parseSimpleOperators(n,[this.tokenSubtract],[this.charSubtract]),n=n.split(this.tokenOr).join("-")):n.length>0&&"+"===n[0]?n=n.substring(1):n.length>0&&"+"===n[n.length-1]&&(n=n.substring(0,n.length-1));try{if(this.indexOfAny(n,i)>-1)for(s=this.indexOfAny(n,i);s>-1;){let e="",a="",o=0,l=0,h=0;if(n[s]===this.charNOTop)o=s;else if(h=s-1,n[h]===this.parent.arithMarker){const t=this.findLeftMarker(n.substring(0,h-1));if(t<0)throw new Pn(this.parent.formulaErrorStrings[Ln.cannot_parse]);e=this.parent.substring(n,t+1,h-t-1),o=t+1}else if(n[h]===this.parent.rightBracket){let t=0,i=h-1;for(;i>0&&("q"!==n[i]||0!==t);)"q"===n[i]?t--:n[i]===this.parent.rightBracket&&t++,i--;if(i<0)throw new Pn(this.parent.formulaErrorStrings[Ln.cannot_parse]);e=this.parent.substring(n,i,h-i+1),o=i}else if(n[h]===this.parent.tic[0]){const t=n.substring(0,h-1).lastIndexOf(this.parent.tic);if(t<0)throw new Pn(this.parent.formulaErrorStrings[Ln.cannot_parse]);e=this.parent.substring(n,t,h-t+1),o=t}else{let t=!1;for(;h>-1&&(this.parent.isDigit(n[h])||!t&&n[h]===this.parent.getParseDecimalSeparator());)n[h]===this.parent.getParseDecimalSeparator()&&(t=!0),h-=1;if(h>-1&&t&&n[h]===this.parent.getParseDecimalSeparator())throw new Pn(this.parent.formulaErrorStrings[Ln.number_contains_2_decimal_points]);if(h+=1,0===h||h>0&&!this.parent.isUpperChar(n[h-1]))e="n"+this.parent.substring(n,h,s-h),o=h;else{for(h-=1;h>-1&&(this.parent.isUpperChar(n[h])||this.parent.isDigit(n[h]));)h-=1;if(h>-1&&n[h]===this.sheetToken){for(h-=1;h>-1&&n[h]!==this.sheetToken;)h-=1;h>-1&&n[h]===this.sheetToken&&(h-=1)}if(h>-1&&":"===n[h]){for(h-=1;h>-1&&this.parent.isDigit(n[h]);)h-=1;for(;h>-1&&this.parent.isUpperChar(n[h]);)h-=1;if(h>-1&&n[h]===this.sheetToken){for(h--;h>-1&&n[h]!==this.sheetToken;)h--;h>-1&&n[h]===this.sheetToken&&h--}h+=1,e=this.parent.substring(n,h,s-h),e=this.parent.getCellFrom(e)}else h+=1,e=this.parent.substring(n,h,s-h);this.parent.updateDependentCell(e),o=h}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())||this.parent.storedData.has(e.toUpperCase()))&&(e="n"+this.checkForNamedRangeAndKeyValue(e))}if(s===n.length-1)throw new Pn(this.parent.formulaErrorStrings[Ln.expression_cannot_end_with_an_operator]);{h=s+1;let e="u"===n[h];if(e&&(h+=1),n[h]===this.parent.tic[0]){const e=n.substring(h+1).indexOf(this.parent.tic);if(e<0)throw this.parent.formulaErrorStrings[Ln.cannot_parse];a=this.parent.substring(n,h,e+2),l=e+h+2}else if(n[h]===this.parent.arithMarker){const e=this.findRightMarker(n.substring(h+1));if(e<0)throw new Pn(this.parent.formulaErrorStrings[Ln.cannot_parse]);a=this.parent.substring(n,h+1,e),l=e+h+2}else if("q"===n[h]){let t=0,i=h+1;for(;i<n.length&&(n[i]!==this.parent.rightBracket||0!==t);)n[i]===this.parent.rightBracket?t++:"q"===n[i]&&t--,i++;if(i===n.length)throw this.parent.formulaErrorStrings[Ln.cannot_parse];a=this.parent.substring(n,h,i-h+1),e&&(a="u"+a),l=i+1}else if(this.parent.isDigit(n[h])||n[h]===this.parent.getParseDecimalSeparator()){let e=n[h]===this.parent.getParseDecimalSeparator();for(h+=1;h<n.length&&(this.parent.isDigit(n[h])||!e&&n[h]===this.parent.getParseDecimalSeparator());)n[h]===this.parent.getParseDecimalSeparator()&&(e=!0),h+=1;if(h<n.length&&"%"===n[h]&&(h+=1),e&&h<n.length&&n[h]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[Ln.number_contains_2_decimal_points];a="n"+this.parent.substring(n,s+1,h-s-1),l=h}else if(this.parent.isUpperChar(n[h])||n[h]===this.sheetToken||"u"===n[h]){if(n[h]===this.sheetToken)for(h+=1;h<n.length&&n[h]!==this.sheetToken;)h+=1;h+=1;let t=0,i=!1;for(;h<n.length&&(this.parent.isUpperChar(n[h])||"_"===n[h]||"."===n[h]||"["===n[h]||"]"===n[h]||"#"===n[h]||" "===n[h]||"%"===n[h]||n[h]===this.parent.getParseDecimalSeparator()&&i);)h!==n.length-1&&"["===n[h]&&"["===n[h+1]&&(i=!0),h!==n.length-1&&"]"===n[h]&&"]"===n[h+1]&&(i=!1),h++,t++;let r=h===n.length||!this.parent.isDigit(n[h]);if(t>1){for(;h<n.length&&(this.parent.isUpperChar(n[h])||this.parent.isDigit(n[h])||" "===n[h]||"_"===n[h]);)h++;r=!0}for(;h<n.length&&this.parent.isDigit(n[h]);)h+=1;if(h<n.length&&":"===n[h]){if(h+=1,h<n.length&&n[h]===this.sheetToken){for(h++;h<n.length&&n[h]!==this.sheetToken;)h+=1;h<n.length&&n[h]===this.sheetToken&&h++}for(;h<n.length&&this.parent.isUpperChar(n[h]);)h+=1;for(;h<n.length&&this.parent.isDigit(n[h]);)h+=1;h-=1,a=this.parent.substring(n,s+1,h-s),a=this.parent.getCellFrom(a)}else h-=1,a=this.parent.substring(n,s+1,h-s),e="u"===n[h],e&&(a="u"+a);r&&a.startsWith(this.sheetToken)&&(r=!this.parent.isCellReference(a)),r||this.parent.updateDependentCell(a),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(a.toUpperCase())||this.parent.storedData.has(a.toUpperCase()))&&(a="n"+this.checkForNamedRangeAndKeyValue(a)),l=h+1}}const c=r.indexOf(n[s]);let d=this.parent.arithMarker+e+a+t[c]+this.parent.arithMarker;o>0&&(d=n.substring(0,o)+d),l<n.length&&(d+=n.substring(l)),d=d.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),n=d,s=this.indexOfAny(n,i)}else if(n.length>0&&(this.parent.isUpperChar(n[0])||n[0]===this.sheetToken)){let e=!0,t=!0,i=!1;const s=n.length;for(let r=0;r<s;++r)if(n[r]===this.sheetToken){if(r>0&&!i)throw this.parent.getErrorStrings()[En.ref];for(i=!0,r++;r<s&&this.parent.isDigit(n[r]);)r++;if(r===s||n[r]!==this.sheetToken){e=!1;break}}else{if(!t&&this.parent.isChar(n[r])){e=!1;break}if(!this.parent.isChar(n[r])&&!this.parent.isDigit(n[r])&&n[r]!==this.sheetToken){e=!1;break}t=this.parent.isUpperChar(n[r])}e&&this.parent.updateDependentCell(n)}return n}catch(a){return a}}indexOfAny(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return i;return-1}findLeftMarker(e){let t=-1;if(e.indexOf(this.parent.arithMarker)>-1){let i=0;for(let n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)i--;else if(e[n]===this.parent.leftBracket)i++;else if(e[n]===this.parent.arithMarker&&0===i){t=n;break}}return t}findRightMarker(e){let t=-1;if(e.indexOf(this.parent.arithMarker)>-1){let i=0;for(let n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)i--;else if(e[n]===this.parent.leftBracket)i++;else if(e[n]===this.parent.arithMarker&&0===i){t=n;break}}return t}parseFormula(e,t){if(e.length>0&&e[0]===this.parent.getFormulaCharacter()&&(e=e.substring(1)),e.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[En.ref];e.length>0&&"+"===e[0]&&(e=e.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,e=this.parse(e.trim(),t),this.isFormulaParsed=!0}catch(i){const t=this.exceptionArgs(i);this.isFailureTriggered||(this.parent.trigger("onFailure",t),this.isFailureTriggered=!0);const n="string"==typeof t.exception?t.exception:t.message;e=(Object(r.Z)(this.parent.getErrorLine(i))?"":"#"+this.parent.getErrorLine(i)+": ")+n,this.isError=!0}return e}markLibraryFormulas(e){let t=0,i=e.indexOf(")");if(-1===i)e=this.markNamedRanges(e);else for(;i>-1;){let s=0,a=i-1;for(;a>-1&&("("!==e[a]||0!==s);)")"===e[a]&&s++,a--;if(-1===a)throw new Pn(this.parent.formulaErrorStrings[Ln.mismatched_parentheses]);let o=a-1;for(;o>-1&&this.parent.isChar(e[o]);)o--;const l=a-o-1,h=this.parent.substring(e,o+1,l);if(l>0&&!Object(r.Z)(this.parent.getFunction(h))){this.ignoreBracet="AREAS"===this.parent.substring(e,o+1,l);let s=this.parent.substring(e,a,i-a+1);try{let e;s=s.split("(").join("").split(")").join(""),s="("+this.formulaAutoCorrection(s,e)+")"}catch(n){const e={message:n.message,exception:n,isForceCalculable:n.formulaCorrection,computeForceCalculate:!1};if(!e.isForceCalculable)throw this.parent.formulaErrorStrings[Ln.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",e),this.isFailureTriggered=!0,t+=1),e.computeForceCalculate=t>0||e.computeForceCalculate,!e.isForceCalculable)throw this.parent.formulaErrorStrings[Ln.improper_formula];if(!e.computeForceCalculate)throw this.parent.formulaErrorStrings[Ln.improper_formula];s=s.split("(").join("").split(")").join(""),s="("+this.formulaAutoCorrection(s,e)+")"}s=this.markNamedRanges(s),s=this.swapInnerParens(s),s=this.addParensToArgs(s),-1===s.lastIndexOf(this.parent.getParseArgumentSeparator())&&s.length>2&&"("===s[0]&&")"===s[s.length-1]&&"{"!==s[1]&&"("!==s[1]&&(s=s.substring(0,s.length-1)+"}"+s.substring(s.length-1),s=s[0]+"{"+s.substring(1)),e=e.substring(0,o+1)+"q"+this.parent.substring(e,o+1,l)+s.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+e.substring(i+1)}else{if(l>0)return this.parent.getErrorStrings()[En.name];{let t=this.emptyStr;a>0&&(t=e.substring(0,a)),t=t+"{"+this.parent.substring(e,a+1,i-a-1)+"}",i<e.length&&(t+=e.substring(i+1)),t=this.markNamedRanges(t),e=t}}i=e.indexOf(")")}return e.split("{").join("(").split("}").join(")")}swapInnerParens(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e}addParensToArgs(e){if(0===e.length)return this.emptyStr;const t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);let i=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===i)e.length>2&&"("===e[0]&&")"===e[e.length-1]&&("{"!==e[1]&&"("!==e[1]?e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1):(i=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[i+1]&&"}"===e[i-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,i+1)+"{"+e.substr(i+1))));else{let n=!0;for(;i>-1;){let s=this.indexOfAny(e.substring(i+1,e.length),t);s>=0?s=i+s+1:-1===s&&")"===e[e.length-1]&&(s=e.length-1),s>0&&"{"!==e[i+1]&&"}"!==e[s-1]&&(e=(e=e.substr(0,s)+"}"+e.substr(s)).substr(0,i+1)+"{"+e.substr(i+1)),i=e.substr(0,i).lastIndexOf(this.parent.getParseArgumentSeparator()),n&&-1===i&&"("===e[0]&&(i=0,n=!1)}}return e.split("{}").join(this.emptyStr)}lastIndexOfAny(e,t){for(let i=e.length-1;i>-1;i--)if(t.indexOf(e[i])>-1)return i;return-1}markNamedRanges(e){const t=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"];let i=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));let n=this.indexOfAny(e.substring(i),t);for(;n>-1&&n+i<e.length;){let s=this.emptyStr,a=null;if(this.parent.substring(e,i,n).indexOf("[")>-1?a=this.getTableRange(this.parent.substring(e,i,n)):(this.parent.storedData.has(this.parent.substring(e,i,n))||this.parent.namedRanges.has(this.parent.substring(e,i,n)))&&(a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,i,n))),Object(r.Z)(a)&&(s=this.checkScopedRange(this.parent.substring(e,i,n)),"NaN"!==s?(this.findNamedRange=!0,a=s):this.parent.substring(e,i,n).startsWith(this.sheetToken.toString()),!Object(r.Z)(a)&&this.findNamedRange&&a.indexOf(this.fixedReference)>-1&&(a=a.split(this.fixedReference).join(this.emptyStr))),Object(r.Z)(a)||(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a)),Object(r.Z)(a)||a===this.emptyStr)for(i+=n+1;i<e.length&&!this.parent.isUpperChar(e[i])&&e[i]!==this.sheetToken;)i++;else e=e.substring(0,i)+a+e.substring(i+n),i+=a.length+1;for(n=i,i<e.length-1&&"{"===e[i]&&(i+=1),n=this.indexOfAny(e.substring(i),t);0===n&&i<e.length-1;)i++,n=this.indexOfAny(e.substring(i),t);if((-1===n||e.substring(i).indexOf("[")>-1)&&i<e.length){if(a=e.substring(i).indexOf("[")>-1?this.getTableRange(e.substring(i)):this.parent.storedData.has(e.substring(i))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(i)):a:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(i)):a,Object(r.Z)(a)&&(s=this.checkScopedRange(e.substring(i)),"NaN"!==s&&(a=s)),!Object(r.Z)(a)&&a!==this.emptyStr&&(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a),null!=a)){const t=e.substring(i);e=")"===t[t.length-1]?e.substring(0,i)+a+")":e.substring(0,i)+a,i+=a.toString().length+1}n=i<e.length?this.indexOfAny(e.substring(i),t):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e}checkForNamedRangeAndKeyValue(e){let t=this.emptyStr;if(e.indexOf("[")>-1){const t=this.getTableRange(e);Object(r.Z)(t)||(this.findNamedRange=!0,e=t)}if(t=this.checkScopedRange(e),"NaN"!==t)this.findNamedRange=!0,e=t;else{if(e.indexOf(this.sheetToken)>-1){const t=this.parent.getSheetFamilyItem(this.parent.grid);let i=e.split('"').join(this.emptyStr);i=i.substr(0,i.indexOf(this.sheetToken)),t.sheetNameToToken.has(i.toUpperCase())&&parseInt(t.sheetNameToToken.get(i.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(Object(r.Z)(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e}getTableRange(e){let t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr),i=t;return t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(i=t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_")),t.toUpperCase()}findNextEndIndex(e,t){let i=0,n=t,s=!1;for(;!s&&t<e.length;)"["===e[n]?i++:"]"===e[n]&&(i--,0===i&&(s=!0)),t++;return t-n}}var Dn,Mn=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let Fn=(()=>{let e=Dn=class extends r.c{constructor(e){super(null,null),this.lFormulas=new Map,this.storedData=new Map,this.keyToRowsMap=new Map,this.rowsToKeyMap=new Map,this.rightBracket=String.fromCharCode(161),this.leftBracket=String.fromCharCode(162),this.sheetToken="!",this.emptyString="",this.leftBrace="{",this.rightBrace="}",this.cell=this.emptyString,this.cellPrefix="!0!A",this.treatEmptyStringAsZero=!1,this.tic='"',this.singleTic="'",this.trueValue="TRUE",this.falseValue="FALSE",this.parseDecimalSeparator=".",this.arithMarker=String.fromCharCode(180),this.arithMarker2=this.arithMarker+this.arithMarker,this.dependentCells=null,this.dependentFormulaCells=null,this.minValue=Number.MIN_SAFE_INTEGER,this.maxValue=Number.MAX_SAFE_INTEGER,this.categoryCollection=["All"],this.dependencyLevel=0,this.refreshedCells=new Map,this.computedValues=null,this.randomValues=new Map,this.isRandomVal=!1,this.randCollection=[],this.dependencyCollection=[],this.uniqueRange=[],this.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!"],this.errorStrings=null,this.parseArgumentSeparator=",",this.dateTime1900=new Date(1900,0,1,0,0,0),this.isParseDecimalSeparatorChanged=!1,this.isArgumentSeparatorChanged=!1,this.sheetFamilyID=0,this.defaultFamilyItem=null,this.sheetFamiliesList=null,this.modelToSheetID=null,this.tokenCount=0,this.sortedSheetNames=null,this.tempSheetPlaceHolder=String.fromCharCode(133),this.namedRanges=new Map,this.formulaInfoTable=null,this.oaDate=new Date(1899,11,30),this.millisecondsOfaDay=864e5,this.parseDateTimeSeparator="/";const t=new kn(this);this.includeBasicFormulas&&Dn.Inject(Tn),this.injectedModules&&this.injectedModules.length&&t.inject(this.requiredModules(),this.injectedModules),this.parentObject=Object(r.Z)(e)?this:e,this.grid=this.parentObject,this.parser=new jn(this)}get libraryFormulas(){return this.lFormulas}set libraryFormulas(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})}getParseArgumentSeparator(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator}setParseArgumentSeparator(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0}getParseDateTimeSeparator(){return this.parseDateTimeSeparator}setTreatEmptyStringAsZero(e){this.treatEmptyStringAsZero=e}getTreatEmptyStringAsZero(){return this.treatEmptyStringAsZero}setParseDateTimeSeparator(e){this.parseDateTimeSeparator=e}requiredModules(){return function(e){const t=[];return e.includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t}(this)}static Inject(...e){this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(let t=0;t<e.length;t++)-1===this.prototype.injectedModules.indexOf(e[t])&&this.prototype.injectedModules.push(e[t])}getInjectedModules(){return this.injectedModules}onPropertyChanged(e,t){}getModuleName(){return"calculate"}getFormulaCharacter(){return"="}isUpperChar(e){const t=e.charCodeAt(0);return t>64&&t<91}resetKeys(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()}updateDependentCell(e){const t=this.getSheetFamilyItem(this.grid);let i=this.cell;if(i!==this.emptyString){if(null!==t.sheetNameToParentObject){const n=t.parentObjectToToken.get(this.grid);-1===i.indexOf(this.sheetToken)&&(i=n+i),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){const t=this.getDependentCells().get(e);t.indexOf(i)<0&&t.push(i)}else this.getDependentCells().set(e,[i]);this.addToFormulaDependentCells(e)}}addToFormulaDependentCells(e){let t=this.cell;const i=this.getSheetFamilyItem(this.grid);null!=i.sheetNameToParentObject&&-1===t.indexOf(this.sheetToken)&&(t=i.parentObjectToToken.get(this.grid)+t),this.getDependentFormulaCells().has(t)?this.getDependentFormulaCells().get(t).has(e)||this.getDependentFormulaCells().get(t).set(e,e):(this.getDependentFormulaCells().set(t,new Map),this.getDependentFormulaCells().get(t).set(e,e))}getDependentCells(){if(this.isSheetMember()){const e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new Map),e.sheetDependentCells}return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells}getDependentFormulaCells(){if(this.isSheetMember()){const e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells}getLibraryFormulas(){return this.lFormulas}getFunction(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null}intToDate(e){let t=Number(e);return t=t>0&&t<1?1+t:0===t?1:t,t>60&&(t-=1),new Date(864e5*(t-1)+new Date("01/01/1900").getTime())}getFormulaInfoTable(){if(this.isSheetMember()){const e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable}getFormula(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""}getParseDecimalSeparator(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator}setParseDecimalSeparator(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0}getSheetToken(e){let t=0,i=this.emptyString;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;i=e.substring(0,t+1)}if(t<e.length)return i;throw this.formulaErrorStrings[Ln.bad_index]}getSheetID(e){const t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){let i=t.parentObjectToToken.get(e);if(i){i=i.split(this.sheetToken).join(this.emptyString);const e=this.parseFloat(i);if(!this.isNaN(e))return e}}return-1}parseFloat(e){return Number(e)}rowIndex(e){let t=0,i=!1;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)i=!0,t++;const n=parseInt(e.substring(t),10);if(t<e.length&&!this.isNaN(n))return n;if(i)return-1;throw this.formulaErrorStrings[Ln.bad_index]}colIndex(e){let t=0,i=0;if(t<(e=e.toUpperCase()).length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)i=26*i+e[t].charCodeAt(0)-64,t++;return 0===i?-1:i}getErrorStrings(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings}substring(e,t,i){return e.substring(t,i+t)}isChar(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}getSheetFamilyItem(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new Bn),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);const t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new Bn),this.sheetFamiliesList.get(t)}setKeyValue(e,t){e=e.toUpperCase();const i=t.toString().trim();this.storedData.get(e)&&0!==i.indexOf(this.leftBrace)||(this.storedData.set(e,new Nn),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));const n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==i){const t=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(t)&&this.clearFormulaDependentCells(t)}i.length>0&&i[0]===this.getFormulaCharacter()?n.setFormulaText(i):n.getFormulaValue()!==i&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(i))}clearFormulaDependentCells(e){const t=this.getDependentFormulaCells().get(e);null!=t&&(t.forEach((t,i)=>{const n=i,s=this.getDependentCells().get(n);this.arrayRemove(s,e),0===s.length&&this.getDependentCells().delete(n)}),this.getDependentFormulaCells().delete(e))}arrayRemove(e,t){const i=e.indexOf(t);return-1!==i&&e.splice(i,1),e}getKeyValue(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){const i=this.storedData.get(e);let n=i.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),n=n.substring(1);try{i.setParsedFormula(this.parser.parseFormula(n,e))}catch(t){const n={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",n),i.setFormulaValue(n.message),this.storedData.get(e).getFormulaValue()}try{i.setFormulaValue(this.computeFormula(i.getParsedFormula()))}catch(t){const e={message:t.message,exception:t,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",e);const i="string"==typeof e.exception?e.exception:e.message;return(Object(r.Z)(this.getErrorLine(t))?"":"#"+this.getErrorLine(t)+": ")+i}}return this.storedData.get(e).getFormulaValue()}return this.emptyString}getNamedRanges(){return this.namedRanges}addNamedRange(e,t){const i=e.split(this.sheetToken);if(i.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(i[0]))return!1;e=i[0]+this.sheetToken+i[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0}removeNamedRange(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)}convertAlpha(e){const t=[];let i=0;for(;e>0;){e--;const n="A".charCodeAt(0);t[i]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),i++}const n=[];for(let s=0;s<i;s++)n[i-s-1]=t[s];return n.join("")}getCellCollection(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}let t=this.emptyString;const i=e.indexOf(this.sheetToken);if(i>-1){let n=i+1;for(;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}}let n,s,r,a,o=e.indexOf(":");if(o>0&&this.isChar(e[o-1])){let t=o-2;for(;t>=0&&this.isDigit(e[t]);)t--}n=this.rowIndex(this.substring(e,0,o)),s=this.rowIndex(this.substring(e,o+1,o+e.length-o-1)),r=this.colIndex(this.substring(e,0,o)),a=this.colIndex(this.substring(e,o+1,o+e.length-o-1)),n>s&&(o=s,s=n,n=o),r>a&&(o=a,a=r,r=o);const l=[];let h,c=0;for(o=n;o<=s;o++)for(h=r;h<=a;h++)l[c]=t+this.emptyString+this.convertAlpha(h)+o.toString(),c++;return l}computeFormula(e){return this.calculateFormula(e,!1)}calculateFormula(e,t){let i,n,s,a,o=!1;if(this.parser.isError)return e;i=this.parser.isFormulaParsed?e:this.parser.parseFormula(e),this.parser.isFormulaParsed=!1;try{if(n=this.findLastIndexOfq(i),n>0&&(o=!0),i!==this.emptyString&&n>-1){let e=n+1;for(;e>-1;){if(i[e]!==this.rightBracket){e++;continue}const l=i.substring(n,e+1),h=l.split(this.leftBracket)[0].split("q").join(this.emptyString);let c;if(this.getLibraryFormulas().get(h.toUpperCase()).isCustom){c=l.substring(l.indexOf(this.leftBracket)+1,l.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());let e=0;const t=[];for(e=0;e<c.length;e++)t.push(this.getValueFromArg(c[e]));c=t}else{if(c=l.substring(l.indexOf(this.leftBracket)+1,l.indexOf(this.rightBracket)).replace(",n",",").split(this.getParseArgumentSeparator()),l.includes(this.getParseArgumentSeparator()+this.tic)){let e=null;for(let t=0;t<c.length;t++)c[t]&&c[t][0]===this.tic&&c[t][c[t].length-1]!==this.tic&&(e=t),null!==e&&e===t-1&&c[t][0]!=this.tic&&c[t][c[t].length-1]===this.tic&&(c[e]=c[e]+this.getParseArgumentSeparator()+c[t],c.splice(t,1),e=null)}o&&h&&"IF"===h&&c.push("nestedFormulaTrue")}if(s=Object(r.Z)(this.getFunction(h))?this.getErrorStrings()[En.name]:this.getFunction(h)(...c),!o)break;{a=this.processNestedFormula(i,l,s);const r=this.findLastIndexOfq(a);0===r&&(o=!1),-1===r&&(s=this.computeValue(a,t)),n=e=r,i=a}}}else this.formulaErrorStrings.indexOf(i)>-1?s=i:i!==this.emptyString&&-1===n&&(s=this.computeValue(i,t))}catch(l){const e={message:l.message,exception:l,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",e);const t="string"==typeof e.exception?e.exception:e.message;s=(Object(r.Z)(this.getErrorLine(l))?"":"#"+this.getErrorLine(l)+": ")+t}return s}computeSumIfAndAvgIf(e){if(Object(r.Z)(e)||e[0]===this.emptyString||0===e.length)return this.formulaErrorStrings[Ln.wrong_number_arguments];const t=e;for(let u=0;u<t.length;u++)if(this.isCellReference(t[u])&&Object(r.Z)(t[u].match(/[0-9]/))&&t[u].indexOf("!")<0){const e=t[u].split(":");t[u]=e[0]+"1:"+e[1]+this.spreadSheetUsedRange[0]}const i=t.length;if(2!==i&&3!==i&&0===i)return this.formulaErrorStrings[Ln.wrong_number_arguments];const n=t[0];let s=t[1].trim();if(s=s.split(this.tic).join(this.emptyString),s.length>255)return this.getErrorStrings()[En.value];const a=s.includes("*");let o=a?s.replace(/\*/g,"").trim():s;o=this.isCellReference(o)?this.getValueFromArg(o):s,a&&("*"===s[0]&&(o="*"+o),"*"===s[s.length-1]&&(o+="*")),s=o;let l=this.parser.tokenEqual;s.startsWith("<=")?(l=this.parser.tokenLessEq,s=s.substring(2)):s.startsWith(">=")?(l=this.parser.tokenGreaterEq,s=s.substring(2)):s.startsWith("<>")?(l=this.parser.tokenNotEqual,s=s.substring(2)):s.startsWith("<")?(l=this.parser.tokenLess,s=s.substring(1)):s.startsWith(">")?(l=this.parser.tokenGreater,s=s.substring(1)):s.startsWith("=")&&(l=this.parser.tokenEqual,s=s.substring(1));const h=this.parseFloat(s),c=t[0],d=this.getCellCollection(i>2?t[2]:n),p=this.getCellCollection(c),g=this.getComputeSumIfValue(p,d,s,h,l,a);return[g[0],g[1]]}findWildCardValue(e,t){let i="";if(e.indexOf("?")>-1){const n=e.indexOf("?"),s=e[n-1],r=e[n+1];if(t.indexOf(s)>-1&&t.indexOf(r)>-1){const n=t.indexOf(s);i=t[n]===s&&t[n+2]===r?e:t}else i=t}else if(e.indexOf("*")>-1){const n=e.indexOf("*");let s="",r="",a=this.falseValue,o=this.falseValue;for(let t=n-1;t>=0;t--)s+=e[t],o=this.trueValue;for(let t=n+1;t<e.length;t++)r+=e[t],a=this.trueValue;const l=""===s?-1:t.indexOf(s.split("").reverse().join("")),h=""===r?-1:t.indexOf(r);l>-1||h>-1?o===this.trueValue?i=s.split("").reverse().join("")===t.substr(0,s.length)?e:t:a===this.trueValue&&(i=r===t.substring(t.length-r.length,t.length)?e:t):i=t}return i}getComputeSumIfValue(e,t,i,n,s,r){let a=0,o=0;switch(s){case this.parser.tokenEqual:{const s=r?i.replace(/\*/g,""):i;for(let l=0;l<e.length;l++){const h=this.getValueFromArg(e[l].split(this.tic).join("")),c=this.parseFloat(h);if(h===i&&c===n){const e=this.getValueFromArg(t[l].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}else h===i?(a+=this.getValueFromRange(t,l),o+=1):r&&s&&h&&("*"===i[0]&&s.length<=h.length&&s===h.slice(0,s.length)&&(a+=this.getValueFromRange(t,l),o+=1),"*"===i[i.length-1]&&s.length<=h.length&&s===h.slice(h.length-s.length,h.length)&&(a+=this.getValueFromRange(t,l),o+=1))}}break;case this.parser.tokenLess:for(let i=0;i<e.length;i++){const s=this.getValueFromArg(e[i].split(this.tic).join(""));if(this.parseFloat(s)<n){const e=this.getValueFromArg(t[i].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}}break;case this.parser.tokenGreater:for(let i=0;i<e.length;i++){const s=this.getValueFromArg(e[i].split(this.tic).join(""));if(this.parseFloat(s)>n){const e=this.getValueFromArg(t[i].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}}break;case this.parser.tokenLessEq:for(let i=0;i<e.length;i++){const s=this.getValueFromArg(e[i].split(this.tic).join(""));if(this.parseFloat(s)<=n){const e=this.getValueFromArg(t[i].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}}break;case this.parser.tokenGreaterEq:for(let i=0;i<e.length;i++){const s=this.getValueFromArg(e[i].split(this.tic).join(""));if(this.parseFloat(s)>=n){const e=this.getValueFromArg(t[i].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}}break;case this.parser.tokenNotEqual:for(let s=0;s<e.length;s++){const r=this.getValueFromArg(e[s].split(this.tic).join("")),l=this.parseFloat(r);if(r!==i&&l!==n){const e=this.getValueFromArg(t[s].split(this.tic).join(""));a+=this.parseFloat(e),o+=1}}}return[a,o]}getValueFromRange(e,t){let i=e[t];return i=this.getValueFromArg(i),this.parseFloat(i.toString())}computeAndOr(e,t){let i,n,s="and"===t;if(0===e.length)return this.formulaErrorStrings[Ln.wrong_number_arguments];for(let a=0,o=e.length;a<o;a++)if(e[a].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[En.value];const r=e;for(let a=0;a<r.length;a++){if(r[a]===this.tic)return this.getErrorStrings()[En.value];if(r[a].indexOf(":")>-1&&this.isCellReference(r[a])){const e=this.getCellCollection(r[a]);for(let t=0;t<e.length;t++){if(this.getErrorStrings().indexOf(e[t])>-1)return e[t];if(e[t][0]===this.tic)return this.getErrorStrings()[En.name];if(i=this.getValueFromArg(e[t]),""===i&&(i=this.trueValue),this.getErrorStrings().indexOf(i)>-1)return i;n=this.parseFloat(i)}}else{if(i=this.getValueFromArg(r[a]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(i)>-1)return i;const e=Date.parse(i.split(this.tic).join(""));if(isNaN(e)){if(i!==this.trueValue&&i!==this.falseValue)return this.getErrorStrings()[En.value].toString()}else s=!0;n=this.parseFloat(i)}s="and"===t?s&&(i===this.trueValue||!isNaN(n)):s||i===this.trueValue||!isNaN(n)}return s?this.trueValue:this.falseValue}removeTics(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e}getCellFrom(e){let t="";const i=e.indexOf(":")>-1?e.split(":"):[e],n=i.length-1,s=this.rowIndex(i[0]);let r;if(s===this.rowIndex(i[n])){const e=this.colIndex(i[0]),r=this.colIndex(i[n]),a=this.colIndex(this.cell);a>=e&&a<=r&&(t=Hn(a).toString()+s.toString())}else if(this.colIndex(i[0])===this.colIndex(i[n])){r=this.colIndex(i[0]);const e=this.rowIndex(i[n]),a=this.rowIndex(this.cell);a>=s&&a<=e&&(t=Hn(r).toString()+a.toString())}return t}computeValue(e,t){try{const i=[];let n=0,s="";for(i.length=0;n<e.length;){let r="u"===e[n];if(e[n]!==this.arithMarker){if(this.isDigit(e[n])){let t=this.emptyString;for(;n<e.length&&(this.isDigit(e[n])||e[n]===this.parseDecimalSeparator);)t+=e[n],n+=1;if(i.push(t),!e[n])return i.toString()}if(e[n]===this.sheetToken){for(s=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)s+=e[n],n+=1;n<e.length&&(s+=e[n],n+=1)}else if(this.isUpperChar(e[n])){let r=this.emptyString,a="";for(;n<e.length&&this.isUpperChar(e[n]);)r+=e[n],n+=1;for(;n<e.length&&this.isDigit(e[n]);)r+=e[n],n+=1;if(n<e.length&&":"===e[n]){if(r+=e[n],n+=1,n<e.length&&e[n]===this.sheetToken)for(r+=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)r+=e[n],n+=1;for(;n<e.length&&this.isUpperChar(e[n]);)r+=e[n],n+=1;for(;n<e.length&&this.isDigit(e[n]);)r+=e[n],n+=1;r=s+this.getCellFrom(r)}else r=s+r;if(a=this.getParentObjectCellValue(r,t).toString(),s="","string"==typeof a&&this.getErrorStrings().indexOf(a)>-1)return a;i.push(a)}else if("q"===e[n]){const t=e.substring(n+1).indexOf(this.leftBracket),i=e.substring(n+t+1).indexOf(this.rightBracket);e=this.substring(e,n+t+2,i-1)}else if(e[n]===this.tic[0]){let t=e[n].toString();for(n+=1;n<e.length&&e[n]!==this.tic[0];)t+=e[n],n+=1;i.push(t.split(this.tic).join(this.emptyString)),n+=1}else if("%"===e[n]&&i.length>0){const e=this.parseFloat(i[0]);this.isNaN(e)||(i.pop(),i.push((e/100).toString())),n+=1}else if(0===e.substring(n).indexOf(this.trueValue))i.push(this.trueValue),n+=this.trueValue.length;else if(0===e.substring(n).indexOf(this.falseValue))i.push(this.falseValue),n+=this.falseValue.length;else if(e[n]===this.tic[0]||"|"===e[n]){let t=e[n].toString();for(n++;n<e.length&&e[n]!==this.tic[0];)t+=e[n],n+=1;i.push(t+this.tic),n+=1}else switch(e[n]){case"#":{let t=0;this.getErrorStrings().indexOf(e.substring(n))>-1?(t=-1===e.indexOf("!")||-1===e.substring(n).indexOf("!")?e.indexOf("#N/A")>-1?e.indexOf("#N/A")+4+n:e.indexOf("?")+1+n:e.indexOf("!")+1+n,i.push(this.substring(e,n,t-n))):(t=n+1,i.push(this.substring(e,n,t-n))),n=t}break;case"n":{n+=1;let t="";if(0===e.substring(n).indexOf("Infinity"))t="Infinity",n+=t.length;else{for(("u"===e[n]||r||"-"===e[n])&&(t="-",r?r=!1:n+=1);n<e.length&&this.isDigit(e[n])||e[n]===this.getParseDecimalSeparator();)t+=e[n],n+=1;if(n<e.length&&"%"===e[n])if(n+=1,""===t){if(i.length>0){const e=this.parseFloat(i[0]);this.isNaN(e)||(i.pop(),i.push((e/100).toString()))}}else t=(this.parseFloat(t)/100).toString()}i.push(t)}break;case this.parser.tokenAdd:this.getValArithmetic(i,"add"),n+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(i,"sub"),n+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(i,"mul"),n+=1;break;case this.parser.tokenDivide:this.getValArithmetic(i,"div"),n+=1;break;case this.parser.tokenLess:this.processLogical(i,"less"),n+=1;break;case this.parser.tokenGreater:this.processLogical(i,"greater"),n+=1;break;case this.parser.tokenGreaterEq:this.processLogical(i,"greaterEq"),n+=1;break;case this.parser.tokenLessEq:this.processLogical(i,"lessEq"),n+=1;break;case this.parser.tokenNotEqual:this.processLogical(i,"notEq"),n+=1;break;case this.parser.tokenOr:this.processLogical(i,"or"),n+=1;break;case this.parser.tokenAnd:this.processLogical(i,"and"),n+=1;break;case this.parser.tokenEqual:this.processLogical(i,"equal"),n+=1;break;default:return this.getErrorStrings()[En.value]}}else n+=1}if(0===i.length)return this.emptyString;{let t=this.emptyString,n=i.length;for(;n>0;){if(t=i.pop()+t,t===this.emptyString&&this.isCellReference(e)&&this.getTreatEmptyStringAsZero())return"0";n--}return t}}catch(i){if(this.getErrorStrings().indexOf(i)>-1||this.formulaErrorStrings.indexOf(i)>-1)throw i;throw new Pn(this.formulaErrorStrings[Ln.invalid_expression])}}getValArithmetic(e,t){let i=e.pop();i=i===this.emptyString?"0":i;let n=Number(i);if(isNaN(n))throw i===this.getErrorStrings()[En.divzero]?this.getErrorStrings()[En.divzero]:this.getErrorStrings()[En.value];let s=e.pop();if(s=s===this.emptyString?e.length?e.pop():"0":s,n=Number(s),isNaN(n))throw i===this.getErrorStrings()[En.divzero]?this.getErrorStrings()[En.divzero]:this.getErrorStrings()[En.value];"add"===t&&e.push((Number(s)+Number(i)).toString()),"sub"===t&&e.push((Number(s)-Number(i)).toString()),"mul"===t&&e.push((Number(s)*Number(i)).toString()),"div"===t&&(this.isNaN(this.parseFloat(i))||this.isNaN(this.parseFloat(s))?e.push(this.getErrorStrings()[En.value]):0===this.parseFloat(i)?e.push(this.getErrorStrings()[En.divzero]):e.push((Number(s)/Number(i)).toString()))}processLogical(e,t){let i,n,s,r,a;return"and"!==t&&"equal"!==t&&(i=e.pop(),n=e.pop(),s=i.indexOf(this.tic)>-1?i:this.parseFloat(i),r=n.indexOf(this.tic)>-1?n:this.parseFloat(n)),"less"===t&&(a=this.isNaN(s)||this.isNaN(r)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:r<s?this.trueValue:this.falseValue),"greater"===t&&(a=this.isNaN(s)||this.isNaN(r)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:r>s?this.trueValue:this.falseValue),"lessEq"===t&&(a=this.isNaN(s)||this.isNaN(r)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:r<=s?this.trueValue:this.falseValue),"greaterEq"===t&&(a=this.isNaN(s)||this.isNaN(r)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:r>=s?this.trueValue:this.falseValue),"notEq"===t&&(a=n!==i?this.trueValue:this.falseValue),"and"===t&&(i=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),a=this.emptyString+n+i+this.emptyString,a=a.split(this.tic).join("")),"equal"===t&&(i=e.pop().toString(),n=e.pop().toString(),""===n&&""!==i&&(n="0"),a=i===n?this.trueValue:this.falseValue),"or"===t&&(a=Math.pow(this.parseFloat(r),this.parseFloat(s)).toString()),e.push(a),a}computeStoreCells(e){const t=e.cellValue,i=e.cellRange,n=e.criteria,s=e.argArray;let r=e.isCriteria,a=e.storedCells;const o=e.isCountIfS,l=e.countVal,h=r===this.trueValue?a:t;let c=[];for(let d=0;d<h.length;d++){const e=[];let h,p=this.getValueFromArg(t[d]),g="";if(h=s[2].split(this.tic).join(this.emptyString),h=this.isCellReference(h)?this.getValueFromArg(h):h,r=o===this.trueValue?this.trueValue:r,r===this.trueValue){let e="",s=0,r=0;for(a[d]=o===this.trueValue&&0===l?t[d]:a[d],e=a[d];!this.isDigit(e[s]);)s+=1;if(this.isCellReference(i[l])&&i[l].indexOf(":")>-1){const e=i[l].indexOf(":");for(g=this.substring(i[l],e);!this.isDigit(g[r]);)r+=1}const c=this.substring(e,s),u=this.substring(g,r);g=a[d].split(c).join(u),p=this.getValueFromArg(g),h=o===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}let u="equal";h.startsWith("<=")?(u="lessEq",h=h.substring(2)):h.startsWith(">=")?(u="greaterEq",h=h.substring(2)):h.startsWith("<>")?(u="notEq",h=h.substring(2)):h.startsWith("<")?(u="less",h=h.substring(1)):h.startsWith(">")?(u="greater",h=h.substring(1)):h.startsWith("=")&&(u="equal",h=h.substring(1)),(h.indexOf("*")>-1||h.indexOf("?")>-1)&&(p=this.findWildCardValue(h,p)),e.push(p.toLowerCase()),e.push(h.toLowerCase()),this.processLogical(e,u)===this.trueValue&&c.push(r===this.falseValue?t[d]:g)}return a=c,c=[],a}computeIfsFormulas(e,t,i){if(Object(r.Z)(e)||""===e[0]||0===e.length)return this.formulaErrorStrings[Ln.wrong_number_arguments];const n=e,s=n.length;if(s<2||s>127)return this.formulaErrorStrings[Ln.wrong_number_arguments];let a=[];const o=[];let l=[],h=0,c=0;for(let r=0;r<n.length;r++)n[r].indexOf(":")>-1&&this.isCellReference(n[r])?a.push(n[r]):o.push(n[r]);a=a.toString().split(",,").join(","),a=a.split(this.getParseArgumentSeparator());const d=[];for(let r=0;r<a.length;r++)d.push(this.getCellCollection(a[r]).length);for(let r=0;r<d.length;r++)if(d[r]&&d[r+1]&&d[r]!==d[r+1])return this.getErrorStrings()[En.value];let p,g;if(t===this.falseValue&&(g=this.falseValue,p=this.getCellCollection(a[1]),l=this.computeStoreCells({cellValue:p,cellRange:a,criteria:o,argArray:n,isCriteria:g,storedCells:l,isCountIfS:t}),h=l.length,0===h))return i===this.trueValue?this.getErrorStrings()[En.divzero]:0;for(let r=t===this.trueValue?0:2;r<a.length;r++)if(g=this.trueValue,g=t===this.trueValue&&0===r?this.falseValue:this.trueValue,p=this.getCellCollection(a[r]),l=this.computeStoreCells({cellValue:p,cellRange:a,criteria:o,argArray:n,isCriteria:g,storedCells:l,isCountIfS:t,countVal:r}),h=l.length,0===h)return 0;let u=0;for(let r=0;r<l.length;r++){let e="",i="",n=0,s=0;for(e=l[r];!this.isDigit(e[n]);)n+=1;if(this.isCellReference(a[0])&&a[0].indexOf(":")>-1){const e=a[0].indexOf(":");for(i=this.substring(a[0],e);!this.isDigit(i[s]);)s+=1}const o=this.substring(e,n),h=this.substring(i,s);if(p=l[r].split(o).join(h),t===this.trueValue)c+=1;else{u++;const e=this.getValueFromArg(p);c+=parseFloat(""===e?"0":e)}}return i===this.trueValue&&(c/=u),c}processNestedFormula(e,t,i){return e.split(t).join("n"+i)}isNaN(e){return"NaN"===e.toString()||"string"==typeof e}fromOADate(e){const t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t}getSerialDateFromDate(e,t,i){let n=0;e<1900&&(e+=1900);let s=!1;for(;!s;){for(;t>12;)e++,t-=12;s=!0;let n=new Date(e,t,1,-1).getDate();for(;i>n;)n=new Date(e,t,1,-1).getDate(),t++,i-=n,s=!1;i<1&&(t--,n=new Date(e,t,1,-1).getDate(),i=n-i)}const r=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+i.toString());return this.isNaN(r)||(n=this.toOADate(new Date(r))),n}toOADate(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay}calculateDate(e){return this.parseFloat(e)<10?"0"+e:e}isTextEmpty(e){return null===e||""===e}isDigit(e){const t=e.charCodeAt(0);return t>47&&t<58}findLastIndexOfq(e){return e.lastIndexOf("q")}getValueFromArg(e,t){let i=e=e.trim(),n=this.dateTime1900,s=i;if(Object(r.Z)(i)||this.isTextEmpty(i))return i;if(e[0]===this.tic||e[0]===this.singleTic)return n=this.isDate(e.split(this.tic).join("")),this.isNaN(this.parseFloat(e.split(this.tic).join("")))&&!Object(r.Z)(n)&&!this.isNaN(n.getDate())&&this.dateTime1900<=n?this.toOADate(n).toString():e;if(e=e.split("u").join("-"),!this.isUpperChar(i[0])&&(this.isDigit(i[0])||i[0]===this.getParseDecimalSeparator()||"-"===i[0]||"n"===i[0]))return"n"===i[0]&&(i=i.substring(1),i.indexOf('"n')>-1&&(i=i.replace('"n','"'))),i;if(-1===this.parser.indexOfAny(i,["+","-","/","*",")",")","{"])&&this.isUpperChar(i[0])||i[0]===this.sheetToken){if(i!==this.trueValue&&i!==this.falseValue&&this.isCellReference(i)){const e=this.getSheetFamilyItem(this.grid);null!==e.sheetNameToParentObject&&e.sheetNameToParentObject.size>0&&-1===i.indexOf(this.sheetToken)&&(i=e.parentObjectToToken.get(this.grid)+i)}if(i===this.cell){const e=this.getDependentCells().get(i);if(null!=e&&e.indexOf(i)>-1&&this.arrayRemove(e,i),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!t)throw this.formulaErrorStrings[Ln.circular_reference]+i}return s=this.getParentObjectCellValue(i,!1,t),this.updateDependentCell(i),s.toString()}return this.getErrorStrings().indexOf(e)>-1?e:this.computeValue(s.toString(),!1)}isDate(e){if("object"==typeof e||null!==Date.parse(e)){const t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null}isValidCellReference(e){let t=0,i=0;const n=[89,71,69];let s=this.emptyString;if(this.namedRanges.has(e))return!1;for(let r=0;r<e.length;r++)this.isChar(e[r])&&t++;if(s=e.substring(0,t),s.length<4){for(;i<s.length;){if(Object(r.Z)(s[i])||!(s[i].charCodeAt(0)<n[i])){if(Object(r.Z)(s[i])&&i>0)break;return!1}i++}if(this.parseFloat(e.substring(t,e.length))<1048576)return!0}return!1}parseDate(e){if(!this.isNaN(e)){if(e instanceof Date)return new Date(e);const t=parseInt(e,10);return t<0?this.getErrorStrings()[En.num]:t<=60?new Date(this.dateTime1900.getTime()+864e5*(t-1)):new Date(this.dateTime1900.getTime()+864e5*(t-2))}return"string"!=typeof e||(e=new Date(e),this.isNaN(e))?this.getErrorStrings()[En.value]:e}isCellReference(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);const t=this.getSheetToken(e);let i=!1;""!==t&&(e=e.split(t).join(this.emptyString));let n=!1,s=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;const r=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator());for(let a=0;a<r.length;a++)if(this.isChar(r[a]))n=!0;else if(this.isDigit(r[a]))s=!0;else{if(":"!==r[a])return!1;n&&s&&(i=!0),n=!1,s=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(i&&n&&s)||!(!(n&&!s||!n&&s)||i):!(!n||!s||-1!==e.indexOf(this.tic))}setTokensForSheets(e){const t=this.getSheetFamilyItem(this.grid),i=this.getSortedSheetNames();if(null!=i)for(let n=0;n<i.length;n++){let s=t.sheetNameToToken.get(i[n]);s=s.split(this.sheetToken).join(this.tempSheetPlaceHolder);let r=this.singleTic+"SHEET"+i[n]+this.singleTic+this.sheetToken;-1===e.indexOf(r)&&(r="SHEET"+i[n]+this.sheetToken),e=e.split(r).join(s),r=i[n]+this.sheetToken,e=e.split(r).join(s)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){const t=(e=e.replace("!!","!")).split("");t[1]=(parseInt(t[1],10)+1).toString(),e=t.join("")}return e}getParentObjectCellValue(e,t,i){if(e===this.trueValue||e===this.falseValue)return e;const n=e.lastIndexOf(this.sheetToken);let s=0,r=0;const a=this.grid,o=this.getSheetFamilyItem(a);if(n>-1&&null!==o.tokenToParentObject)this.grid=o.tokenToParentObject.get(e.substring(0,n+1)),s=this.rowIndex(e),r=this.colIndex(e);else if(-1===n){let t=0;for(;t<e.length&&this.isChar(e[t]);)t++;if(t===e.length)return""===(e=e.toLowerCase())?this.getErrorStrings()[En.value]:this.getErrorStrings()[En.name];s=this.rowIndex(e),r=this.colIndex(e),o.isSheetMember&&null!=o.parentObjectToToken&&(e=o.parentObjectToToken.get(this.grid)+e)}const l=""===this.cell||null===this.cell?"":this.cell;if(this.cell=e,l===this.cell&&!i)throw this.formulaErrorStrings[Ln.circular_reference];const h=this.getParentCellValue(s,r,this.grid,l,a,t);return this.grid=a,this.cell=l,h}getParentCellValue(e,t,i,n,s,a){let o;const l=this.getSheetId(i);return void 0!==this.parentObject.getValueRowCol?(n&&(n=s===i?"":n+","+(s&&"string"==typeof s&&Number(s)>-1?s:this.getSheetID(s))),o=this.parentObject.getValueRowCol(l,e,t,n,a),Object(r.Z)(o)?this.emptyString:o.toString()):(o=this.getValueRowCol(l,e,t),""!==o&&void 0!==o||(o=""),o)}getSheetId(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1}getValueRowCol(e,t,i){const n=this.rowsToKeyMap.get(t).toString();let s=this.getKeyValue(n).toString();if(null!=s&&"%"===s[s.length-1]&&s.length>1){const e=this.parseFloat(s.substring(0,s.length-1));this.isNaN(e)&&(s=(Number(e)/100).toString())}return s}defineFunction(e,t){"string"==typeof t&&(t=Object(r.X)(t,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:t,isCustom:!0})}valueChanged(e,t,i,n,s){const a=e;this.spreadSheetUsedRange=n,this.grid=e;let o=!0,l=!0;const h=this.getSheetFamilyItem(a);let c=Hn(t.getColIndex())+t.getRowIndex().toString();this.actCell=c,null!==h.sheetNameToParentObject&&h.sheetNameToParentObject.size>0&&(c=h.parentObjectToToken.get(a)+c);const d=t.getValue().toUpperCase();if(d.indexOf("=RAND()")>-1||d.indexOf("RAND()")>-1||d.indexOf("=RANDBETWEEN(")>-1||d.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(c)){let e=this.randCollection.toString();this.randomValues.has(c)?this.randomValues.has(c)&&(d.indexOf("=RAND()")>-1||d.indexOf("RAND()")>-1||d.indexOf("=RANDBETWEEN(")>-1||d.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(c,t.getValue()):t.getValue().toUpperCase()!==this.randomValues.get(c.toUpperCase())&&(this.randomValues.delete(c),e=e.split(c+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+c).join("").split(c).join(""),this.randCollection=e.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(c,t.getValue()),this.randCollection.push(c),this.isRandomVal=!0)}if(t.getValue()&&t.getValue()[0]===this.getFormulaCharacter()){let e;if(this.cell=c,Object(r.Z)(l)||(l=i),this.getFormulaInfoTable().has(c)){if(e=this.getFormulaInfoTable().get(c),t.getValue()!==e.getFormulaText()||null==e.getParsedFormula()){e.setFormulaText(t.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{e.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(p){e.setFormulaValue(p),l=!1}}if(l){this.parser.isFormulaParsed=!0;const t=this.calculateFormula(e.getParsedFormula(),s);o=t!==e.getFormulaValue(),e.setFormulaValue(t)}}else{e=new Nn,e.setFormulaText(t.getValue()),this.getDependentFormulaCells().has(c)||this.getDependentFormulaCells().set(c,new Map);try{e.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(p){e.setFormulaValue(p),l=!1}l&&e.setFormulaValue(this.calculateFormula(e.getParsedFormula(),s)),this.getFormulaInfoTable().has(c),this.getFormulaInfoTable().set(c,e)}l&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(a)+1,e.getFormulaValue(),t.getRowIndex(),t.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(a),e.getFormulaValue(),t.getRowIndex(),t.getColIndex()))}else this.getFormulaInfoTable().has(c)&&(this.getFormulaInfoTable().delete(c),this.getDependentFormulaCells().has(c)&&this.clearFormulaDependentCells(c));l&&o&&this.getDependentCells().has(c)&&this.getDependentCells().get(c).toString()!==c&&(this.getComputedValue().clear(),this.refresh(c))}getComputedValue(){return null===this.computedValues&&(this.computedValues=new Map),this.computedValues}setValueRowCol(e,t,i,n){}getSortedSheetNames(){const e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){const t=[];e.sheetNameToToken.forEach((e,i)=>{t.push(i),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames}getErrorLine(e){let t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null}createSheetFamilyID(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++}computeMinMax(e,t){let i,n,s=0;if(Object(r.Z)(e)||0===e.length)return this.formulaErrorStrings[Ln.wrong_number_arguments];for(let r=0,o=e.length;r<o;r++)if(e[r].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[En.value];i="max"===t?this.minValue:this.maxValue;const a=e;if(a.length>255)return this.getErrorStrings()[En.value];for(let r=0;r<a.length;r++)if(a[r].indexOf(":")>-1&&this.isCellReference(a[r])){const e=this.getCellCollection(a[r]);for(let r=0;r<e.length;r++){if(n=this.getValueFromArg(e[r]),this.getErrorStrings().indexOf(n)>-1)return n;const a=this.parseFloat(n);""===n||this.isNaN(this.parseFloat(a))?(s+=1,s===e.length&&(i=0)):i="max"===t?Math.max(i,a):Math.min(i,a)}}else{const e=this.getValueFromArg(a[r]);if(this.getErrorStrings().indexOf(e)>-1)return e;const o=this.parseFloat(e);if(""===e||this.isNaN(this.parseFloat(o))){s+=1,s===n.length&&(i=0);continue}i="max"===t?Math.max(i,o):Math.min(i,o)}return i.toString()}calculateAvg(e){let t=0;const i=e;let n=[],s=0,a=0;for(let o=0;o<i.length;o++)if(i[o].indexOf(":")>-1&&this.isCellReference(i[o])){a=0,n=this.getCellCollection(i[o]),s=0;for(let e=0;e<n.length;e++){const t=this.getValueFromArg(n[e]);Object(r.Z)(t)||isNaN(this.parseFloat(t))||(s+=this.parseFloat(t),a+=1)}if(0===a)return this.getErrorStrings()[En.divzero];s/=a,t=s+t}else{if(i[o].indexOf(this.tic)>-1&&isNaN(parseFloat(i[o].split(this.tic).join(""))))return this.getErrorStrings()[En.value];0===i[o].length&&(i[o]="1");const e=this.getValueFromArg(i[o].split(this.tic).join(""));if(Object(r.Z)(e)||isNaN(this.parseFloat(e)))return this.getErrorStrings()[En.name];t+=this.parseFloat(e)}return(t/(i.length-0)).toString()}registerGridAsSheet(e,t,i){Object(r.Z)(this.modelToSheetID)&&(this.modelToSheetID=new Map),Object(r.Z)(this.modelToSheetID.get(t))&&this.modelToSheetID.set(t,i);const n=this.getSheetFamilyItem(t);n.isSheetMember=!0;const s=e.toUpperCase();if(0===n.parentObjectToToken.size&&(n.parentObjectToToken=new Map),0===n.sheetNameToParentObject.size&&(n.sheetNameToParentObject=new Map),0===n.sheetNameToToken.size&&(n.sheetNameToToken=new Map),0===n.tokenToParentObject.size&&(n.tokenToParentObject=new Map),Object(r.cb)(n.sheetNameToParentObject.get(s))){const e=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,n.tokenToParentObject.set(e,t),n.parentObjectToToken.set(t,e),n.sheetNameToToken.set(s,e),n.sheetNameToParentObject.set(s,t)}else{const e=n.sheetNameToToken.get(s);n.tokenToParentObject.set(e,t),n.parentObjectToToken.set(t,e)}return e}unregisterGridAsSheet(e,t,i){let n=[t];i&&(n=[],Object(r.Z)(this.modelToSheetID)||this.modelToSheetID.forEach((e,t)=>{n.push(t)})),n.forEach(t=>{const n=this.getSheetFamilyItem(t),s=(i?t:e).toUpperCase();if(null!=n.sheetNameToParentObject&&n.sheetNameToParentObject.has(s)){n.sheetNameToParentObject.delete(s);const e=n.sheetNameToToken.get(s);n.sheetNameToToken.delete(s),n.tokenToParentObject.delete(e),n.parentObjectToToken.delete(t),i&&(n.sheetDependentCells=new Map)}})}computeExpression(e){const t=this.parser.parseFormula(e);return this.computeFormula(t)}isSheetMember(){const e=this.getSheetFamilyItem(this.grid);return!Object(r.Z)(e)&&e.isSheetMember}dispose(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()}refreshRandValues(e){let t,i,n,s,r="",a=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),a=a.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===a?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=a.split(this.parseArgumentSeparator));for(let o=0;o<this.randomValues.size;o++)t=this.rowIndex(this.randCollection[o]),i=this.colIndex(this.randCollection[o]),r=(parseFloat(this.getSheetToken(this.randCollection[o]).split(this.sheetToken).join(""))+1).toString(),s=this.getSheetFamilyItem(r),this.grid=s.sheetNameToParentObject.get(r),n=this.randomValues.get(this.randCollection[o]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,i):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,i)}refresh(e){if(0===this.dependencyLevel&&this.refreshedCells.clear(),this.getDependentCells().has(e)&&null!==this.getDependentCells().get(e)){const i=this.getSheetFamilyItem(this.grid);this.dependencyLevel=this.dependencyLevel+1;try{const n=this.getDependentCells().get(e);let s;for(s=0;s<n.length;s++){const e=n[s],r=this.getSheetToken(e);this.actCell=e.split(r)[1],r.length&&(this.grid=i.tokenToParentObject.get(r));try{const t=this.rowIndex(e),i=this.colIndex(e),n=this.getFormulaInfoTable().get(e);let s;n&&(this.cell=e,this.getComputedValue().has(e)?s=this.getComputedValue().get(e):(this.parser.isFormulaParsed=!0,s=this.calculateFormula(n.getParsedFormula(),!0),this.computedValues.set(e,s)),n.setFormulaValue(s)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n.getFormulaValue(),t,i):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n.getFormulaValue(),t,i),this.refreshedCells.has(e)||(this.refreshedCells.set(e,[]),this.refresh(e))}catch(t){continue}}}finally{this.grid=i.tokenToParentObject.get(this.getSheetToken(e)),this.dependencyLevel--,0===this.dependencyLevel&&this.refreshedCells.clear()}}}};return Mn([Object(r.t)(!0)],e.prototype,"includeBasicFormulas",void 0),Mn([Object(r.k)()],e.prototype,"onFailure",void 0),e=Dn=Mn([r.r],e),e})();class Pn{constructor(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t}}class Nn{constructor(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}getFormulaText(){return this.formulaText}setFormulaText(e){this.formulaText=e}getFormulaValue(){return this.formulaValue}setFormulaValue(e){this.formulaValue=e}getParsedFormula(){return this.parsedFormula}setParsedFormula(e){this.parsedFormula=e}}class Bn{constructor(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentCells=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}}function Hn(e){const t=[];let i=0;for(;e>0&&i<9;){e--;const n="A".charCodeAt(0);t[i]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),i++}const n=[];for(let s=0;s<i;s++)n[i-s-1]=t[s];return n.join("")}class _n{constructor(e,t,i){return this.row=e,this.col=t,this.value=i,this.getRowIndex=()=>e,this.setRowIndex=t=>{e=t},this.getColIndex=()=>t,this.setColIndex=e=>{t=e},this.getValue=()=>i,this}}class zn{constructor(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}init(){this.addEventListener(),this.initCalculate(),this.registerSheet()}destroy(){this.removeEventListener(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null}addEventListener(){this.parent.on(an,this.performFormulaOperation,this),this.parent.on("aggregateComputation",this.aggregateComputation,this),this.parent.on("getUniqueRange",this.getUniqueRange,this),this.parent.on("removeUniquecol",this.removeUniquecol,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off(an,this.performFormulaOperation),this.parent.off("aggregateComputation",this.aggregateComputation),this.parent.off("getUniqueRange",this.getUniqueRange),this.parent.off("removeUniquecol",this.removeUniquecol))}getModuleName(){return"workbookFormula"}initCalculate(){this.calculateInstance=new Fn(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()}performFormulaOperation(e){const t=e.action,i=this.calculateInstance.getLibraryFormulas(),n=Array.from(i.values());let s,r;switch(t){case"getLibraryFormulas":e.formulaCollection=Array.from(i.keys());break;case"getFormulaCategory":s=["All"];for(let e=1;e<Array.from(i.values()).length;e++)s.indexOf(n[e].category)<0&&s.push(n[e].category);e.categoryCollection=s;break;case"dropDownSelectFormulas":for(let t=0;t<Array.from(i.values()).length;t++)e.selectCategory===n[t].category&&(e.formulaCollection[t]=Array.from(i.keys())[t]);break;case"getFormulaDescription":for(let t=0;t<Array.from(i.values()).length;t++)e.selectedList===Array.from(i.keys())[t]&&(e.description=n[t].description);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"refreshCalculate":e.isFormula&&(e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex,e.sheetIndex)),this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex,e.isRefreshing),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.sheetId);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.index});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":r=this.sheetInfo.length;for(let t=0;t<r;t++)if(this.sheetInfo[t].index===e.index){e.sheetName=this.sheetInfo[t].sheet,this.sheetInfo.splice(t,1);break}this.calculateInstance.unregisterGridAsSheet((e.index-1).toString(),e.index),this.calculateInstance.tokenCount=this.calculateInstance.tokenCount-1,this.sheetDeletion(e.sheetName,e.index,e.index);break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=Hn(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"refreshInsDelFormula":this.refreshInsDelFormula(e.insertArgs);break;case"refreshNamedRange":this.refreshNamedRange(e.insertArgs)}}referenceError(){return this.calculateInstance.getErrorStrings()[En.ref]}getSheetInfo(){return this.sheetInfo}addCustomFunction(e,t){this.calculateInstance.defineFunction(t,e)}updateSheetInfo(){this.sheetInfo=[],this.parent.sheets.forEach((e,t)=>{this.sheetInfo.push({visibleName:e.name,sheet:"Sheet"+e.id,index:t})})}getUniqueRange(e){e.range=this.calculateInstance.uniqueRange}removeUniquecol(){const e=this.parent.getActiveSheet().activeCell;for(let t=0;t<this.calculateInstance.uniqueRange.length;t++)if(this.calculateInstance.uniqueRange[t].split(":")[0]===e){const e=Ni(this.calculateInstance.uniqueRange[t]);this.calculateInstance.uniqueRange.splice(t,1);for(let t=e[0];t<=e[2];t++)for(let i=e[1];i<=e[3];i++)Cs(t,i,this.parent.getActiveSheet()).formula="",this.parent.updateCell({value:"",formula:""},zi([t,i]))}}sheetDeletion(e,t,i){const n=this.calculateInstance.getDependentCells(),s=[];let a,o,l=null,h="";n.forEach((e,t)=>{s.push(t)}),this.removeSheetTokenIndex(h,i);for(let c=0;c<s.length;c++){const i=this.calculateInstance.getDependentCells().get(s[c]);for(let n=0;n<i.length;n++)l=this.calculateInstance.getFormulaInfoTable().get(i[n]),t=parseInt(i[n].split("!")[1],10)+1,!Object(r.Z)(l)&&t>-1&&(h=l.formulaText,h.toUpperCase().indexOf(e.toUpperCase())>-1&&(h=h.toUpperCase().split(e.toUpperCase()+this.calculateInstance.sheetToken).join(this.referenceError()),a=this.calculateInstance.rowIndex(i[n]),o=this.calculateInstance.colIndex(i[n]),this.updateDataContainer([a-1,o-1],{value:h,sheetId:t,visible:!1}),this.calculateInstance.refresh(l.getParsedFormula()))),e.split("Sheet")[1]===s[c].split("!")[1]&&(this.calculateInstance.getFormulaInfoTable().delete(s[c]),this.calculateInstance.clearFormulaDependentCells(s[c]))}}removeSheetTokenIndex(e,t){const i=this.calculateInstance.getSheetFamilyItem(this.calculateInstance.grid);return i.sheetNameToToken.delete(t.toString()),i.sheetNameToParentObject.delete(t.toString()),i.parentObjectToToken.delete(t.toString()),i.tokenToParentObject.delete("!"+(t-1).toString()+"!"),e}renameUpdation(e,t){const i=this.calculateInstance.getDependentCells(),n=[];let s,r="";const a=[];let o,l,h,c=!1;i.forEach((e,t)=>{n.push(t)});for(let p=0;p<this.sheetInfo.length;p++)if(this.sheetInfo[p].index===t){this.sheetInfo[p].visibleName=e;break}const d=this.sheetInfo;for(let p=0;p<n.length;p++){const e=this.calculateInstance.getDependentCells().get(n[p]);for(let t=0;t<e.length;t++){s=this.calculateInstance.getFormulaInfoTable().get(e[t]),r=s.formulaText;for(let e=0;e<d.length;e++)if(d[e].visibleName!==d[e].sheet){const t=d[e].sheet.toUpperCase();r.toUpperCase().indexOf(t)>-1&&(r=r.toUpperCase().split(t).join(e+"/"),a.push(e),c=!0)}if(c){for(let e=0;e<a.length;e++)r=r.split(a[e].toString()+"/").join(d[a[e]].visibleName);o=this.calculateInstance.rowIndex(e[t]),l=this.calculateInstance.colIndex(e[t]),h=Ds(0,"Sheet"+(parseInt(e[t].split("!")[1],10)+1),this.sheetInfo),this.updateDataContainer([o-1,l-1],{value:r,sheetId:h,visible:!0})}}}}updateDataContainer(e,t){const i=e[0],n=e[1];let s,a,o;const l=this.parent.sheets.length;for(let r=0;r<l;r++)if(this.parent.sheets[r].id===t.sheetId){s=this.parent.sheets[r].rows;break}Object(r.Z)(t)||(i in s?(a=s[i],n in a.cells?(o=a.cells[n],o.formula=t.value,o.value=t.visible?o.value:this.referenceError()):a.cells[n]=o={}):(a=s[i]={},a[n]=o={}))}parseSheetRef(e){let t;const i=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g");let n=0;const s=this.parent.sheets.length,r=[];let a,o,l,h,c;r.length=0;const d=this.getSheetInfo(),p='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(n=0;n<s;n++)if(d[n].sheet!==d[n].visibleName&&(t=new RegExp(d[n].visibleName.replace(i,"\\$&")+p,"gi"),l=n,e.match(t))){for(let r=n+1;r<s;r++)a=new RegExp(d[r].visibleName.replace(i,"\\$&")+p,"gi"),o=e.search(a),h=e.search(t),o>-1&&(o<h||o===h&&d[r].visibleName.length>d[n].visibleName.length)&&(c=new RegExp("Sheet","gi"),0!==d[r].visibleName.search(c)&&(t=a,l=r));e=e.replace(t,l+"/"),r.push(l)}for(n=0;n<r.length;)t=new RegExp(r[n]+"/"+p,"gi"),e=e.replace(t,d[r[n]].sheet),n++;return e}registerSheet(e=0,t=this.parent.sheets.length){let i;for(;e<t;)i=Fs(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(i,i,this.calcID),e++}unRegisterSheet(e=0,t=this.parent.sheets.length,i){let n;if(this.calculateInstance.tokenCount=0,i)this.calculateInstance.unregisterGridAsSheet(n,n,i);else for(;e<t;)n=Fs(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(n,n),e++}refreshCalculate(e,t,i,n,s,a){const o=Object(r.Z)(s)?this.parent.getActiveSheet():Fs(this.parent,s);let l=o.id+"";if(n){i=this.parseSheetRef(i);const n=new _n(e+1,t+1,i);this.calculateInstance.valueChanged(l,n,!0,[o.usedRange.rowIndex,o.usedRange.colIndex],a);const s=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){let e,t,i="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===s.length)for(let n=0;n<this.calculateInstance.randomValues.size;n++){e=this.calculateInstance.rowIndex(s[n]),t=this.calculateInstance.colIndex(s[n]),i=this.calculateInstance.randomValues.get(s[n]),l=(parseFloat(this.calculateInstance.getSheetToken(s[n]).split(this.calculateInstance.sheetToken).join(""))+1).toString();const r=new _n(e,t,i);this.calculateInstance.valueChanged(l,r,!0)}}}else{const i=this.calculateInstance.getSheetFamilyItem(l);let n=Vi(t+1)+(e+1);i.isSheetMember&&!Object(r.Z)(i.parentObjectToToken)&&(n=i.parentObjectToToken.get(l)+n),this.calculateInstance.getFormulaInfoTable().has(n)&&(this.calculateInstance.getFormulaInfoTable().delete(n),this.calculateInstance.getDependentCells().has(n)&&this.calculateInstance.clearFormulaDependentCells(n)),this.calculateInstance.getComputedValue().clear(),this.calculateInstance.refresh(n),this.calculateInstance.refreshRandValues(n)}this.calculateInstance.cell="";const h=Cs(e,t,this.parent.getActiveSheet());if(h&&i&&0===i.toString().toUpperCase().indexOf("=SUM(")){const e=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","invalid arguments"],t=i.toString().toUpperCase().replace("=SUM","").replace("(","").replace(")","").split(":")[0];if(cs(t)){const i=Ni(t),n=Cs(i[0],i[1],this.parent.getActiveSheet());n&&n.value&&n.format&&e.indexOf(h.value)<0&&e.indexOf(n.value)<0&&(h.format=n.format)}}}autoCorrectFormula(e,t,i,n){if(!Object(r.Z)(e)){let s;2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")"),0===e.indexOf("=")&&(e=e.slice(1),s=!0);const a=e.match(/</g),o=e.match(/>/g),l=e.match(/=/g);if(a){let t="";for(let e=0;e<a.length;e++)t+=a[e];e=e.replace(t,"<")}if(o){let t="";for(let e=0;e<o.length;e++)t+=o[e];e=e.replace(t,">")}if(l){let t="";for(let e=0;e<l.length;e++)t+=l[e];e=e.split(t).join("=")}e=s?"="+e:e,(a||o||l)&&(Cs(t,i,Object(r.Z)(n)?this.parent.getActiveSheet():Fs(this.parent,n)).formula=e)}return e}initiateDefinedNames(){const e=this.parent.definedNames;let t=0;for(;t<e.length;){const i=e[t],n=this.parseSheetRef(i.refersTo);let s=qi(n),r=!1;const a=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if(s=s.split("$").join(""),s=s.split("=").join(""),s.indexOf(":")>-1){const e=s.split(":");cs(e[0])&&cs(e[1])&&(r=!0)}else s.indexOf(":")<0&&cs(s)&&(r=!0);a&&(r=!1),r?this.addDefinedName(i,!0):(this.removeDefinedName(i.name,i.scope),t--),t++}}addDefinedName(e,t,i){(void 0===i||i<-1)&&(i=this.parent.definedNames.length);let n,s=!0,r=e.name;if(e.refersTo.indexOf("!")<0){let t=Hs(this.parent);t=-1!==t.indexOf(" ")?"'"+t+"'":t,e.refersTo=t+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}const a=e.refersTo,o=this.parseSheetRef(e.refersTo);return e.scope?(n=Ls(this.parent,e.scope),n>-1&&(r=Hs(this.parent,n)+"!"+r)):e.scope="",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?s=!1:(this.calculateInstance.addNamedRange(r,"="===o[0]?o.substr(1):o),"="!==o[0]&&(e.refersTo="="+a),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.splice(i,0,e)),s}removeDefinedName(e,t){let i=!1;const n=this.getIndexFromNameColl(e,t);if(n>-1){let s=e;if(t){const i=Ls(this.parent,t);i&&(s=Hs(this.parent,i)+"!"+e)}this.calculateInstance.removeNamedRange(s),this.parent.definedNames.splice(n,1),i=!0}return i}checkIsNameExist(e,t){return this.parent.definedNames.some(i=>i.name===e&&(t?i.scope===t:""===i.scope))}getIndexFromNameColl(e,t=""){let i=-1;return this.parent.definedNames.filter((n,s)=>{n.name===e&&n.scope===t&&(i=s)}),i}toFixed(e){const t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e}aggregateComputation(e){const t=this.parent.getActiveSheet();let i=function(e){return e.selectedRange.split(" ")[0]}(t);const n=Ni(i.split(":")[1]);let s,r;const a=["SUM","AVERAGE","MIN","MAX"],o=[];n[0]+1===t.rowCount&&n[1]+1===t.colCount&&(i=`A1:${_i(t.usedRange.rowIndex,t.usedRange.colIndex)}`);const l=Ni(t.activeCell),h=t.rows[l[0]]&&t.rows[l[0]].cells?t.rows[l[0]].cells[l[1]]:{},c=h?h.format:"";let d;const p=this.calculateInstance.getCellCollection(i);for(s=0;s<p.length;s++)if(d=this.calculateInstance.getValueFromArg(p[s]),tn(d)){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(i),e.Count&&!e.countOnly){for(s=0;s<4;s++){r=this.toFixed(this.calculateInstance.getFunction(a[s])(i));const e={formattedText:r,value:r,format:c,onLoad:!0};c&&(this.parent.notify("getFormattedCell",e),r=e.formattedText),o.push(r)}e.Sum=o[0],e.Avg=o[1],e.Min=o[2],e.Max=o[3]}}clearFormula(e){this.parent.activeSheetIndex===e.sheetIdx&&(e.rowIdx="Row"===e.type?"insert"===e.status?e.rowIdx>=e.startIdx?e.rowIdx-e.count:e.rowIdx:e.rowIdx+e.count:e.rowIdx,e.colIdx="Column"===e.type?"insert"===e.status?e.colIdx>=e.startIdx?e.colIdx-e.count:e.colIdx:e.colIdx+e.count:e.colIdx);const t="!"+e.sheetIdx+"!"+Hn(-1===e.colIdx?e.colIdx+2:e.colIdx+1)+(-1===e.rowIdx?e.rowIdx+2:e.rowIdx+1);this.calculateInstance.getFormulaInfoTable().delete(t),this.calculateInstance.clearFormulaDependentCells(t)}refreshFormula(e,t,i,n,s,r){let a,o,l,h=e,c=[];const d=this.parent.getActiveSheet(),p=[];let g,u,m,f,b=[];if(hs(h)){if("delete"===i)for(g=1;g<=t;g++)p.push(s+g);for(b=this.parseFormula(h),g=0;g<b.length;g++)if(u=b[g].trim(),this.calculateInstance.isCellReference(u)){if(f=g&&b[g-1].trim(),f&&"!"===f[f.length-1]){if(f=f.replace(/['!]/g,""),f!==d.name)continue}else if(0===parseInt(f,10)&&void 0===f[f.length-1]&&d.id-1!==r)continue;c=Ni(u),a="Column"===n?"insert"===i?c[3]+t:c[3]-t:"insert"===i?c[2]+t:c[2]-t,o="Column"===n?"insert"===i?c[1]+t:c[1]-t:"insert"===i?c[0]+t:c[0]-t,o="Column"===n?s>c[1]?c[1]:o:s>c[0]?c[0]:o,a="Column"===n?s>c[3]?c[3]:a:s>c[2]?c[2]:a,l=o>-1?"Column"===n?zi([c[0],o,c[2],a]).split(":")[0]:zi([o,c[1],a,c[3]]).split(":")[0]:"#REF!","delete"===i&&(m=parseInt(u.replace("Row"===n?/[A-Z]/g:/[0-9]/g,""),10),p.indexOf(m)>-1&&(l="#REF!")),b[g]=l}h="="+b.join("")}return h}refreshDelete(e){const t=this.calculateInstance.getSheetFamilyItem(e.sheet.id.toString());let i,n,s,a,o,l,h,c,d,p,g,u=[];for(let m=0;m<=e.sheet.usedRange.rowIndex;m++)for(let n=0;n<=e.sheet.usedRange.colIndex;n++)i=Vi(n+1)+(m+1),t.isSheetMember&&!Object(r.Z)(t.parentObjectToToken)&&(i=t.parentObjectToToken.get(e.sheet.id.toString())+i),this.calculateInstance.getDependentCells().has(i)&&[].slice.call(this.calculateInstance.getDependentCells().get(i)).forEach(e=>{this.calculateInstance.getFormulaInfoTable().has(e)&&this.calculateInstance.getFormulaInfoTable().delete(e),this.calculateInstance.clearFormulaDependentCells(e),-1===u.indexOf(e)&&u.push(e)});u.forEach(i=>{if(n=i.substring(0,i.lastIndexOf(this.calculateInstance.sheetToken)+1),t.tokenToParentObject.has(n)?(a=Ts(this.parent,Number(t.tokenToParentObject.get(n))),void 0===a&&(a=this.parent.activeSheetIndex)):a=this.parent.activeSheetIndex,s=Fs(this.parent,a),o=Ni(i.substring(i.lastIndexOf(this.calculateInstance.sheetToken)+1)),"Row"===e.modelType){if(o[0]>=e.startIndex&&o[2]<=e.endIndex)return}else if(o[1]>=e.startIndex&&o[3]<=e.endIndex)return;if(h=Cs(o[0],o[1],s),h.formula&&hs(h.formula)){c=this.parseFormula(h.formula,!0);for(let t=0;t<c.length;t++)d=c[t].trim(),this.calculateInstance.isCellReference(d)&&(l=Ni(d),"Row"===e.modelType?(p=l[0]-e.startIndex,p>0&&(l[0]>e.endIndex?(p=e.endIndex-e.startIndex+1,p>0&&(l[0]-=p)):l[0]-=p),e.startIndex<=l[2]&&(l[2]-=e.endIndex<=l[2]?e.endIndex-e.startIndex+1:l[2]-e.startIndex+1),c[t]=l[2]<l[0]?this.calculateInstance.getErrorStrings()[En.ref]:this.getAddress(l)):(p=l[1]-e.startIndex,p>0&&(l[1]>e.endIndex?(p=e.endIndex-e.startIndex+1,p>0&&(l[1]-=p)):l[1]-=p),e.startIndex<=l[3]&&(l[3]-=e.endIndex<=l[3]?e.endIndex-e.startIndex+1:l[3]-e.startIndex+1),c[t]=l[3]<l[1]?this.calculateInstance.getErrorStrings()[En.ref]:this.getAddress(l)));g="="+c.join(""),h.formula!==g&&(h.formula=g,h.value=null)}})}getAddress(e){return e[0]===e[2]&&e[1]===e[3]?_i(e[0],e[1]):zi(e)}refreshInsDelFormula(e){let t,i;const n=this.parent.sheets.length;Object(r.Z)(e.activeSheetIndex)&&(e.activeSheetIndex=this.parent.activeSheetIndex);const s=this.parent.sheets[e.activeSheetIndex].name;let a,o,l,h;if("delete"!==e.name)for(l=0;l<n;l++){t=e.model.length,i=this.parent.sheets[l],a=[0,0,i.usedRange.rowIndex,i.usedRange.colIndex];for(let n=a[2];n>=a[0];n--)if(!("Row"===e.modelType&&n>=e.startIndex&&n<=e.endIndex))for(let r=a[1];r<=a[3];r++)if(!("Column"===e.modelType&&n>=e.startIndex&&n<=e.endIndex)&&(o=Cs(n,r,i),o&&o.formula&&hs(o.formula))){if(e.activeSheetIndex!==l&&!o.formula.includes(s))continue;this.clearFormula({rowIdx:n,colIdx:r,sheetIdx:l,count:t,status:e.name,type:e.modelType,startIdx:e.startIndex}),h=this.refreshFormula(o.formula,t,e.name,e.modelType,e.startIndex,l),-1===h.indexOf("UNIQUE")&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[n,r,n,r],value:h,sheetIndex:l})}}else this.refreshDelete(e)}parseFormula(e,t){let i,n,s=0;const r=[];let a=[];a=this.markSpecialChar(e.replace("=",""),t),a=a.split(t?/\(|\)|=|\^|>|<|,|\+|-|\*|\/|%|&/g:/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g);const o=a.length;for(;s<o;)i=a[s],i?(1===i.length?r.push(this.isUniqueChar(i)?this.getUniqueCharVal(i):i):(n=i[0],i.indexOf("!")>0?(this.isUniqueChar(n)&&(r.push(this.getUniqueCharVal(n)),i=i.substr(1)),n=i.indexOf("!")+1,r.push(i.substr(0,n)),r.push(i.substr(n))):this.isUniqueChar(n)?(r.push(this.getUniqueCharVal(n)),r.push(i.substr(1))):r.push(i)),s++):s++;return r}getUniqueCharVal(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""}isUniqueChar(e){const t=e.charCodeAt(e);return t>=129&&t<=142}markSpecialChar(e,t){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),(e=(e=(e=(e=(e=(e=(e=t?e.replace(/,/g,","+this.uniqueCSeparator):e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)}refreshNamedRange(e){if(e.definedNames&&e.definedNames.length)return void e.definedNames.forEach(e=>{this.parent.removeDefinedName(e.name,e.scope),this.parent.addDefinedName(e)});const t=this.parent.definedNames.length;if(!t)return;const i=Object.assign({},this.parent.definedNames);let n,s,r,a,o;for(let l=0;l<t;l++)if(a=i[l],r=a.refersTo.split("!"),s=r[0].split("=")[1],s===e.sheet.name)if(n=Ni(r[1]),o=!1,"insert"===e.name)"Row"===e.modelType?(e.index<=n[0]&&(n[0]+=e.model.length,o=!0),e.index<=n[2]&&(n[2]+=e.model.length,o=!0)):"Column"===e.modelType&&(e.index<=n[1]&&(n[1]+=e.model.length,o=!0),e.index<=n[3]&&(n[3]+=e.model.length,o=!0)),this.updateDefinedNames(a,s,n,o);else if("Row"===e.modelType){const t=n[0]-e.startIndex;t>0&&(n[0]-=t,o=!0),e.startIndex<=n[2]&&(n[2]-=e.endIndex<=n[2]?e.deletedModel.length:n[2]-e.startIndex+1,o=!0),this.updateDefinedNames(a,s,n,o,[n[0],n[2]],e)}else if("Column"===e.modelType){const t=n[1]-e.startIndex;t>0&&(n[1]-=t,o=!0),e.startIndex<=n[3]&&(n[3]-=e.endIndex<=n[3]?e.deletedModel.length:n[3]-e.startIndex+1,o=!0),this.updateDefinedNames(a,s,n,o,[n[1],n[3]],e)}}updateDefinedNames(e,t,i,n,s,r){if(!n)return;const a=this.parent.definedNames.indexOf(e);if(this.parent.removeDefinedName(e.name,e.scope),s){let t={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(t=new rs(this.parent,"definedNames",t,!0),r.definedNames?r.definedNames.push(t):r.definedNames=[t],s[1]<s[0])return}e.refersTo=t+"!"+zi(i),this.parent.notify(an,{action:"addDefinedName",definedName:e,isAdded:!1,index:a})}}class Vn{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("initiateSort",this.initiateSortHandler,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("initiateSort",this.initiateSortHandler)}initiateSortHandler(e){const t=e.args,i=new a.d,n=this.parent.getActiveSheet();let s=Wi(Ui(t.range));const o=t.sortOptions||{sortDescriptors:{},containsHeader:!0};let l=!1;if(e.promise=i.promise,s[0]>n.usedRange.rowIndex||s[1]>n.usedRange.colIndex)return void i.reject(this.parent.serviceLocator.getService(ys).getConstant("SortOutOfRangeError"));let h=o.containsHeader;s[0]===s[2]&&(s=bs(s[0],s[1],n),l=!0,Object(r.Z)(o.containsHeader)&&(h=typeof Cs(s[0],s[1],n,null,!0).value!=typeof Cs(s[0]+1,s[1],n,null,!0).value||!this.isSameStyle(Cs(s[0],s[1],n,null,!0).style,Cs(s[0]+1,s[1],n,null,!0).style))),!Object(r.Z)(t.sortOptions)&&!Object(r.Z)(t.sortOptions.containsHeader)||l||Object(r.Z)(Cs(s[0],s[1],n))||Object(r.Z)(Cs(s[0]+1,s[1],n))||(h=typeof Cs(s[0],s[1],n).value!=typeof Cs(s[0]+1,s[1],n).value);let c,d,p=s[0]=h?s[0]+1:s[0];const g=Vi(Bi(n.activeCell)[1]+1);let u=o.sortDescriptors;const m=zi(s);Is(this.parent,`${n.name}!${m}`,!0).then(e=>{const r=new a.b(e),l=new a.h;if(Array.isArray(u)){u&&0!==u.length||(u=[{field:g}]);for(let e=u.length,t=e-1;t>-1;t--){if(u[e-1].field||(u[e-1].field=g),!u[t].field)continue;const i=u[t].sortComparer||this.sortComparer.bind(this,u[t],o.caseSensitive);l.sortBy(u[t].field,i)}}else{u||(u={field:g}),u.field||(u.field=g);const e=u.sortComparer||this.sortComparer.bind(this,u,o.caseSensitive);l.sortBy(u.field,e)}r.executeQuery(l).then(r=>{let a,o={};Array.prototype.forEach.call(r.result,(t,i)=>{if(t)for(c=s[1],d=s[3],p=parseInt(e[i].__rowIndex,10)-1;c<=d;c++)a=Vi(c+1),o=t[a],o&&o.formula&&(o.formula=fs([p,c],[parseInt(t.__rowIndex,10)-1,c],n,o)),vs(p,c,n,o)}),i.resolve({range:`${n.name}!${m}`,sortOptions:t.sortOptions})})})}isSameStyle(e={},t={}){let i=!0;const n=Object.keys(e);for(let s=0;s<n.length;s++){if(e[n[s]]!==t[n[s]]&&this.parent.cellStyle[n[s]]!==e[n[s]]){i=!1;break}i=!0}return i}sortComparer(e,t,i,n){const s=e.order||"",o=a.c.fnSort(s),l={sensitivity:t?"case":"base"};if(i&&n&&("string"==typeof i.value||"string"==typeof n.value)){tn(i.value)&&(i.value=nn(i.value)),tn(n.value)&&(n.value=nn(n.value));const e=new Intl.Collator(this.parent.locale,l);return s&&"ascending"!==s.toLowerCase()?-1*e.compare(i.value,n.value):e.compare(i.value,n.value)}return null!==i&&!Object(r.Z)(i.value)||null!==n&&!Object(r.Z)(n.value)?null===i||Object(r.Z)(i.value)?1:null===n||Object(r.Z)(n.value)?-1:o(i?i.value:i,n?n.value:n):-1}getModuleName(){return"workbookSort"}}class Un{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.filterRange=null,this.parent=null}addEventListener(){this.parent.on("initiateFilter",this.initiateFilterHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("initiateFilter",this.initiateFilterHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler))}initiateFilterHandler(e){const t=e.args,i=new a.d,n=this.parent.getActiveSheet(),s=t.filterOptions||{};if(e.promise=i.promise,this.filterRange=t.range,s.datasource)this.setFilter(s.datasource,s.predicates),i.resolve({range:t.range,filterOptions:s});else{const e=Wi(Ui(t.range));if(e[0]>n.usedRange.rowIndex||e[1]>n.usedRange.colIndex)return void i.reject("Select a cell or range inside the used range and try again.");e[0]===e[2]&&e[2]-e[0]==0&&(e[0]=0,e[1]=0,e[3]=n.usedRange.colIndex),e[2]=n.usedRange.rowIndex,e[0]=e[0]+1;const r=zi(e);Is(this.parent,`${n.name}!${r}`,!0,!0,null,null,null,null,!1).then(e=>{const t=new a.b(e);this.setFilter(t,s.predicates),i.resolve({range:r,filterOptions:s})})}}setFilter(e,t){if(e&&t){const i=e.dataSource.json,n=new a.h;t.length&&n.where(a.g.and(t));const s=e.executeLocal(n),o="__rowIndex";i.forEach(e=>{if(!e)return;const t=parseInt(e[o],10);this.parent.hideRow(t-1,void 0,s.indexOf(e)<0),Object(r.Z)(this.parent.filteredRows)&&(this.parent.filteredRows={},this.parent.filteredRows.rowIdxColl=[],this.parent.filteredRows.sheetIdxColl=[]);const i=this.parent.filteredRows.rowIdxColl,n=this.parent.filteredRows.sheetIdxColl;if(s.indexOf(e)<0){if(i&&n)for(let e=0,s=n.length;e<s;e++)this.parent.activeSheetIndex===n[e]&&i[e]===t-1&&(i.splice(e,1),n.splice(e,1));i.push(t-1),n.push(this.parent.activeSheetIndex)}else if(i&&n)for(let s=0,r=n.length;s<r;s++)this.parent.activeSheetIndex===n[s]&&i[s]===t-1&&(i.splice(s,1),n.splice(s,1))});const l=this.parent.getActiveSheet();(l.frozenColumns||l.frozenRows)&&this.parent.notify("dataRefresh",null)}}clearAllFilterHandler(){if(this.filterRange){const e=Bi(this.filterRange),t=this.parent.getActiveSheet();this.parent.hideRow(e[0],t.usedRange.rowIndex,!1)}}getModuleName(){return"workbookFilter"}}class qn{constructor(e){this.parent=e,this.addEventListener()}setImage(e){const t=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?Ls(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,n=Ni(t),s=i?this.parent.sheets[i]:this.parent.getActiveSheet(),r=Cs(n[0],n[1],s);let a;const o=e.options;if(r&&r.image){a=r.image;for(let e=0;e<o.length;e++)a.push(o[e])}vs(n[0],n[1],s,{image:r&&r.image?a:o},!0)}addEventListener(){this.parent.on("setImage",this.setImage,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("setImage",this.setImage)}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"workbookImage"}}class Wn{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on("setChart",this.setChartHandler,this),this.parent.on("refreshChart",this.refreshChartData,this),this.parent.on("deleteChartColl",this.deleteChartColl,this),this.parent.on("refreshChartSize",this.refreshChartSize,this),this.parent.on("focusChartBorder",this.focusChartBorder,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("setChart",this.setChartHandler),this.parent.off("refreshChart",this.refreshChartData),this.parent.off("deleteChartColl",this.deleteChartColl),this.parent.off("refreshChartSize",this.refreshChartSize),this.parent.off("focusChartBorder",this.focusChartBorder))}setChartHandler(e){let t=0;e.isInitCell=!Object(r.Z)(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!Object(r.Z)(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!Object(r.Z)(e.isPaste)&&e.isPaste;const i=e.chart;if(i.length>0)for(;t<i.length;){if(!1===e.isCut&&document.getElementById(e.chart[t].id)&&(i[t]={range:i[t].range,id:"e_spreadsheet_chart_"+this.parent.chartCount,isSeriesInRows:i[t].isSeriesInRows,theme:i[t].theme,type:i[t].type},i[t].id="e_spreadsheet_chart_"+this.parent.chartCount,e.isIdAvailabe=!1),document.getElementById(e.chart[t].id))return;let n=!!Object(r.Z)(e.isIdAvailabe)||e.isIdAvailabe;if(i[t].theme=i[t].theme||"Material",i[t].type=i[t].type||"Line",i[t].isSeriesInRows=i[t].isSeriesInRows||!1,i[t].range=i[t].range||this.parent.getActiveSheet().selectedRange,i[t].range.indexOf("!")<0&&(i[t].range=this.parent.getActiveSheet().name+"!"+i[t].range),Object(r.Z)(i[t].id)&&(i[t].id="e_spreadsheet_chart_"+this.parent.chartCount,n=!1),i[t].height=i[t].height||290,i[t].width=i[t].width||480,this.parent.notify("initiateChart",{option:i[t],chartCount:this.parent.chartCount,isInitCell:e.isInitCell,isUndoRedo:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(i[t]),n||this.parent.chartCount++,!e.isInitCell||e.isPaste){const n=i[t].range&&i[t].range.indexOf("!")>0?Ls(this.parent,i[t].range.split("!")[0]):this.parent.activeSheetIndex,s=Ni(e.isPaste?e.range:i[t].range),r=n?this.parent.sheets[n]:this.parent.getActiveSheet(),a=Cs(s[0],s[1],r);a&&a.chart?a.chart.push(i[t]):vs(s[0],s[1],r,{chart:[i[t]]},!0)}t++}}refreshChartData(e){let t,i=1;const n=this.parent.sheets.length+1;for(;i<n;){const n=this.parent.chartColl;if(t=n?n.length:0,t)for(;t--;){const i=this.parent.chartColl[t],n=Object(r.Z)(e.showHide)?ps(Ni(i.range),e.rIdx,e.cIdx):this.inRowColumnRange(Ni(i.range),e.rIdx,e.showHide),s=i.range.indexOf("!")>-1?Ls(this.parent,js(i.range)):this.parent.activeSheetIndex;n&&s===this.parent.activeSheetIndex&&this.parent.notify("updateChart",{chart:i})}i++}}inRowColumnRange(e,t,i){return"rows"===i?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]}refreshChartSize(e){let t,i=1;const n=this.parent.sheets.length+1;for(;i<n;){const n=this.parent.chartColl;if(t=n?n.length:0,t)for(;t--;){const i=this.parent.chartColl[t];if(!Object(r.Z)(e.overlayEle.querySelector("#"+i.id))){const t=this.parent.element.querySelector("."+i.id),n=Object(r.N)(t,"chart");n&&(n.height=e.height,n.width=e.width)}}i++}}focusChartBorder(e){for(let t=0;t<this.parent.chartColl.length;t++){const i=document.getElementById(e.id),n=document.getElementById(this.parent.chartColl[t].id);i&&n&&Object(r.D)(n,"."+i.classList[1])===i&&this.parent.notify("initiateChart",{option:this.parent.chartColl[t],chartCount:this.parent.chartCount,isRefresh:!0})}}deleteChartColl(e){for(let t=0;t<this.parent.chartColl.length;t++){const i=document.getElementById(this.parent.chartColl[t].id),n=document.getElementById(e.id);n&&i&&Object(r.D)(i,"."+n.classList[1])===n&&this.parent.chartColl.splice(t,1)}}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"workbookChart"}}class Zn{constructor(e){this.parent=e,this.addEventListener()}format(e){let t,i=e.range;i&&"string"==typeof i&&i.indexOf("!")>-1?(i=i.split("!")[1],t=this.parent.sheets[Ls(this.parent,e.range.split("!")[0])]):t=this.parent.getActiveSheet(),void 0===i&&(i=t.selectedRange);const n="object"!=typeof i&&e.onActionUpdate,s={range:i,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(s.borderType=e.borderType);const r={};if(Object.assign(r,s.style,null,!0),n&&(this.parent.trigger("beforeCellFormat",s),this.parent.notify("actionBegin",{eventArgs:s,action:"format"}),s.cancel))return void(e.cancel=!0);const a="object"==typeof s.range?s.range:Wi(Ni(s.range));if(e.borderType&&(this.setTypedBorder(t,e.style.border,a,e.borderType,e.onActionUpdate),delete e.style.border),void 0!==s.style.borderTop){for(let i=a[1];i<=a[3];i++)this.checkAdjustantBorder(t,"borderBottom",a[0]-1,i),this.checkFullBorder(t,"borderBottom",a[0]-1,i),this.checkFullBorder(t,"borderTop",a[0],i),this.setCellBorder(t,{borderTop:s.style.borderTop},a[0],i,e.onActionUpdate,i===a[3]);delete s.style.borderTop}if(void 0!==s.style.borderBottom){for(let i=a[1];i<=a[3];i++)this.checkAdjustantBorder(t,"borderTop",a[2]+1,i),this.checkFullBorder(t,"borderTop",a[2]+1,i),this.checkFullBorder(t,"borderBottom",a[2],i),this.setCellBorder(t,{borderBottom:s.style.borderBottom},a[2],i,e.onActionUpdate,i===a[3]),this.setBottomBorderPriority(t,a[2],i);delete s.style.borderBottom}if(void 0!==s.style.borderLeft){for(let i=a[0];i<=a[2];i++)this.checkAdjustantBorder(t,"borderRight",i,a[1]-1),this.checkFullBorder(t,"borderRight",i,a[1]-1),this.checkFullBorder(t,"borderLeft",i,a[1]),this.setCellBorder(t,{borderLeft:s.style.borderLeft},i,a[1],e.onActionUpdate);delete s.style.borderLeft}if(void 0!==s.style.borderRight){for(let i=a[0];i<=a[2];i++)this.checkAdjustantBorder(t,"borderLeft",i,a[3]-1),this.checkFullBorder(t,"borderLeft",i,a[3]-1),this.checkFullBorder(t,"borderRight",i,a[3]),this.setCellBorder(t,{borderRight:s.style.borderRight},i,a[3],e.onActionUpdate);delete s.style.borderRight}let o,l;if(Object.keys(e.style).length)for(let h=a[0];h<=a[2];h++)for(let i=a[1];i<=a[3];i++)void 0===l&&(void 0!==s.style.border?(o=s.style.border,s.style.border=void 0,l=!0):l=!1),l&&this.setFullBorder(t,o,a,h,i,e.onActionUpdate),this.setCellStyle(t,h,i,s.style),this.parent.getActiveSheet().id===t.id&&this.parent.notify(rn,{style:s.style,rowIdx:h,colIdx:i,lastCell:i===a[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate});l&&(s.style.border=o),this.parent.setUsedRange(a[2],a[3]),e.refreshRibbon&&this.parent.notify("activeCellChanged",null),n&&(s.style=r,s.range=`${t.name}!${i}`,this.parent.notify("actionComplete",{eventArgs:s,action:"format"}))}setBottomBorderPriority(e,t,i){if(Ys(e,t+1)){const n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,i]).borderTop&&(e.rows[t].cells[i].style.bottomPriority=!0)}}setFullBorder(e,t,i,n,s,r){const a={};n===i[0]&&(this.checkAdjustantBorder(e,"borderBottom",n-1,s),this.checkFullBorder(e,"borderBottom",n-1,s)),s===i[1]&&(this.checkAdjustantBorder(e,"borderRight",n,s-1),this.checkFullBorder(e,"borderRight",n,s-1)),s===i[3]?(this.checkAdjustantBorder(e,"borderLeft",n,s+1),this.checkFullBorder(e,"borderLeft",n,s+1)):this.checkAdjustantBorder(e,"border",n,s+1),a.borderRight=t,a.borderTop=t,a.borderLeft=t,a.borderBottom=t,this.setCellBorder(e,a,n,s,r,s===i[3]),n===i[2]?(this.checkAdjustantBorder(e,"borderTop",n+1,s),this.checkFullBorder(e,"borderTop",n+1,s),this.setBottomBorderPriority(e,n,s)):this.checkAdjustantBorder(e,"border",n+1,s)}checkAdjustantBorder(e,t,i,n){const s={};""!==this.parent.getCellStyleValue([t],[i,n])[t]&&(s[t]=void 0,this.setCellStyle(e,i,n,s))}checkFullBorder(e,t,i,n){const s=this.parent.getCellStyleValue(["border"],[i,n]).border;if(""!==s){const r={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(e=>{e!==t&&(r[e]=s)}),this.setCellStyle(e,i,n,r)}}textDecorationActionUpdate(e){const t=this.parent.getActiveSheet(),i={range:t.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",i),this.parent.notify("actionBegin",{eventArgs:i,action:"format"}),i.cancel)return void(e.cancel=!0);const n=Wi(Ni(t.selectedRange)),s=e.style.textDecoration;let r=s;const a=Ni(t.activeCell);let o,l=this.parent.getCellStyleValue(["textDecoration"],a).textDecoration,h=!1;"underline"===l?r="underline"===s?"none":"underline line-through":"line-through"===l?r="line-through"===s?"none":"underline line-through":"underline line-through"===l&&(r="underline"===s?"line-through":"underline",h=!0),"none"===r&&(h=!0),this.format({style:{textDecoration:r},range:a,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(let c=n[0];c<=n[2];c++)for(let t=n[1];t<=n[3];t++)if(c!==a[0]||t!==a[1]){if(o={},l=this.parent.getCellStyleValue(["textDecoration"],[c,t]).textDecoration,"none"===l){if(h)continue;o.textDecoration=s}else if("underline"===l||"line-through"===l)if(h){if(s!==l)continue;o.textDecoration="none"}else o.textDecoration=s!==l?"underline line-through":s;else if("underline line-through"===l){if(!h)continue;o.textDecoration="underline"===s?"line-through":"underline"}this.format({style:o,range:[c,t,c,t],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}i.range=t.name+"!"+i.range,this.parent.notify("actionComplete",{eventArgs:i,action:"format"})}setTypedBorder(e,t,i,n,s){let r;if("Outer"===n){for(let r=i[1];r<=i[3];r++)this.checkAdjustantBorder(e,"borderBottom",i[0]-1,r),this.checkFullBorder(e,"borderBottom",i[0]-1,r),this.setCellBorder(e,{borderTop:t},i[0],r,s,r===i[3]),this.checkAdjustantBorder(e,"borderTop",i[2]+1,r),this.checkFullBorder(e,"borderTop",i[2]+1,r),this.setCellBorder(e,{borderBottom:t},i[2],r,s,r===i[3],n),this.setBottomBorderPriority(e,i[2],r);for(let r=i[0];r<=i[2];r++)this.checkAdjustantBorder(e,"borderRight",r,i[1]-1),this.checkFullBorder(e,"borderRight",r,i[1]-1),this.setCellBorder(e,{borderLeft:t},r,i[1],s),this.checkAdjustantBorder(e,"borderLeft",r,i[3]+1),this.checkFullBorder(e,"borderLeft",r,i[3]+1),this.setCellBorder(e,{borderRight:t},r,i[3],s,null,n)}else if("Inner"===n)for(let a=i[0];a<=i[2];a++)for(let n=i[1];n<=i[3];n++){const o={};r=this.parent.getCellStyleValue(["border"],[a,n]).border,""!==r&&(o.border=void 0,n!==i[3]&&n!==i[1]&&a!==i[0]&&a!==i[2]||(a===i[0]&&(o.borderTop=r),a===i[2]&&(o.borderBottom=r),n===i[3]&&(o.borderRight=r),n===i[1]&&(o.borderLeft=r))),n!==i[3]&&(o.borderRight=t),a!==i[0]&&(o.borderTop=t),a!==i[2]&&(o.borderBottom=t),n!==i[1]&&(o.borderLeft=t),this.setCellBorder(e,o,a,n,s,n===i[3])}else if("Vertical"===n)for(let a=i[0];a<=i[2];a++)for(let n=i[1];n<=i[3];n++){const r={borderRight:t,borderLeft:t};n===i[1]&&(this.checkAdjustantBorder(e,"borderRight",a,n-1),this.checkFullBorder(e,"borderRight",a,n-1)),n===i[3]&&(this.checkAdjustantBorder(e,"borderLeft",a,n+1),this.checkFullBorder(e,"borderLeft",a,n+1)),this.setCellBorder(e,r,a,n,s)}else for(let a=i[0];a<=i[2];a++)for(let n=i[1];n<=i[3];n++){const r={borderTop:t,borderBottom:t};a===i[0]&&(this.checkAdjustantBorder(e,"borderBottom",a-1,n),this.checkFullBorder(e,"borderBottom",a-1,n)),this.setCellBorder(e,r,a,n,s,n===i[3]),a===i[2]&&(this.checkAdjustantBorder(e,"borderTop",a+1,n),this.checkFullBorder(e,"borderTop",a+1,n),this.setBottomBorderPriority(e,a,n))}}setCellBorder(e,t,i,n,s,r,a){if(this.setCellStyle(e,i,n,t),this.parent.getActiveSheet().id===e.id){if("Outer"===a&&(t.borderBottom||t.borderRight)){const e={range:[i,n,i,n]};this.parent.notify(hn,e),i=e.range[0],n=e.range[1]}this.parent.notify(rn,{style:t,rowIdx:i,colIdx:n,onActionUpdate:s,first:"",lastCell:r,isHeightCheckNeeded:!0,manualUpdate:!0})}}setCellStyle(e,t,i,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[i]||(e.rows[t].cells[i]={}),e.rows[t].cells[i].style||(e.rows[t].cells[i].style={}),Object.assign(e.rows[t].cells[i].style,n,null,!0)}skipHiddenRows(e,t){return Ys(e,++t)&&(t=this.skipHiddenRows(e,t)),t}addEventListener(){this.parent.on(sn,this.format,this),this.parent.on("textDecorationUpdate",this.textDecorationActionUpdate,this),this.parent.on("clear",this.clearCellObj,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off(sn,this.format),this.parent.off("textDecorationUpdate",this.textDecorationActionUpdate),this.parent.off("clear",this.clearCellObj))}clearCellObj(e){const t=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?Ls(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,n=Fs(this.parent,i),s=Ui(t);let r=s[0];const a=s[2];let o,l;for(;r<=a;r++)for(o=s[1],l=s[3];o<=l;o++){const t=Cs(r,o,n);if(t)switch(e.type){case"Clear Formats":delete t.format,delete t.rowSpan,delete t.style,delete t.wrap,delete t.colSpan;break;case"Clear Contents":t.hyperlink&&this.parent.notify("deleteHyperlink",{sheet:n,rowIdx:r,colIdx:o,preventRefresh:!0}),delete t.value,delete t.formula;break;case"Clear Hyperlinks":delete t.hyperlink;break;case"Clear All":vs(r,o,n,{},!1)}}}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"workbookcellformat"}}class Gn{constructor(e){this.parent=e,this.localeObj=Object(r.T)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("workbookEditOperation",this.performEditOperation,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("workbookEditOperation",this.performEditOperation)}getModuleName(){return"workbookEdit"}performEditOperation(e){switch(e.action){case"updateCellValue":this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly)}}checkDecimalPoint(e){if(Number(e)){const t=e.toString().indexOf(this.decimalSep)+1,i=e.toString().substr(t).length<=6;e=i?t<7?e:parseFloat(e).toFixed(0):t>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-t+2)}return e}updateCellValue(e,t,i,n=!1){let s;void 0===i&&(i=this.parent.activeSheetIndex),s="string"==typeof e?Ni(e):e;const a=Fs(this.parent,i);let o=Cs(s[0],s[1],a,!0);if(o||(o=a.rows[s[0]].cells[s[1]]={}),n)t&&t.toString().indexOf(this.decimalSep)>-1&&(t=this.checkDecimalPoint(t)),o.value=t;else{let e=hs(t);e="#SPILL!"===t||e;let n=!1;o.formula&&o.formula.indexOf("UNIQUE")>-1&&""===t&&(n=!0),e||n||(o.formula="",o.value=nn(t));const a={action:"refreshCalculate",value:t,rowIndex:s[0],colIndex:s[1],sheetIndex:i,isFormula:e};if("Text"!==pn(o.format)){const e={value:t,rowIndex:s[0],colIndex:s[1],sheetIndex:i,updatedVal:""};this.parent.notify("checkDateFormat",e),!Object(r.Z)(e.updatedVal)&&e.updatedVal.length>0&&(o.value=e.updatedVal)}if("#SPILL!"===t)o.value=t;else{const i={cellIdx:s,isUnique:!1};this.parent.notify("checkUniqueRange",i),n||""===t||i.isUnique&&!(t.indexOf("UNIQUE")>-1)?t=o.value:this.parent.notify(an,a),e&&(o.formula=a.value,t=o.value)}}this.parent.setUsedRange(s[0],s[1],a),this.parent.allowChart&&this.parent.notify("refreshChart",{cell:o,rIdx:s[0],cIdx:s[1],sheetIdx:i}),this.parent.allowConditionalFormat&&this.parent.notify("checkConditionalFormat",{rowIdx:s[0],colIdx:s[1],cell:o,isAction:!0})}}class Yn{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("setLinkModel",this.setLinkHandler,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("setLinkModel",this.setLinkHandler)}setLinkHandler(e){let t,i,n,s=e.hyperlink,a=e.cell,o=this.parent.getActiveSheet();if(a&&-1!==a.indexOf("!")){t=a.split("!");const e=this.parent.sheets;for(let n=0;n<e.length;n++)e[n].name===t[0]&&(i=n);o=this.parent.sheets[i],a=t[1]}a=a||this.parent.getActiveSheet().activeCell;const l=Ni(a),h=l[0],c=l[1];o&&(Object(r.Z)(o.rows[h])&&(o.rows[h]={}),Object(r.Z)(o.rows[h].cells)&&(o.rows[h].cells=[]),Object(r.Z)(o.rows[h].cells[c])&&(o.rows[h].cells[c]={}),o.rows[h].cells[c].style?(o.rows[h].cells[c].style.textDecoration="underline",o.rows[h].cells[c].style.color="#00e"):o.rows[h].cells[c].style={textDecoration:"underline",color:"#00e"},"string"==typeof s?(0!==s.indexOf("http://")&&0!==s.indexOf("https://")&&0!==s.indexOf("ftp://")&&(s=0===s.toLowerCase().indexOf("www.")?"http://"+s:s,n=s),o.rows[h].cells[c].hyperlink=s):(n=s.address,0!==n.indexOf("http://")&&0!==n.indexOf("https://")&&0!==n.indexOf("ftp://")&&(n=0===n.toLowerCase().indexOf("www.")?"http://"+n:n),o.rows[h].cells[c].hyperlink={address:n}))}getModuleName(){return"workbookHyperlink"}}class Xn{constructor(e){this.parent=e,this.addEventListener()}insertModel(e){if("Column"===e.modelType){if("number"==typeof e.start)for(let t=0;t<=this.parent.getActiveSheet().usedRange.rowIndex+1;t++){const i={cellIdx:[t,e.start],isUnique:!1};if(this.parent.notify("checkUniqueRange",i),i.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(let o=0;o<=this.parent.getActiveSheet().usedRange.colIndex+1;o++){const t={cellIdx:[e.start,o],isUnique:!1};if(this.parent.notify("checkUniqueRange",t),t.isUnique)return}if(!e.model)return;let t,i,n,s,r=[];if("number"==typeof e.start){t=e.start,e.end=e.end||t,t>e.end&&(t=e.end,e.end=e.start);for(let i=t;i<=e.end;i++)r.push({})}else e.start?(t=e.start[0].index||0,r=e.start,n=!0):(t=0,r.push({}));if("Row"===e.modelType){if(e.model=e.model,e.model.rows||(e.model.rows=[]),n&&e.model.usedRange.rowIndex>-1&&t>e.model.usedRange.rowIndex)for(let n=e.model.usedRange.rowIndex;n<t-1;n++)r.splice(0,0,{});t<this.parent.frozenRowCount(e.model)&&(this.parent.setSheetPropertyOnMute(e.model,"frozenRows",e.model.frozenRows+r.length),s=!0),e.model.rows.splice(t,0,...r),this.parent.setUsedRange(t>e.model.usedRange.rowIndex?t+(r.length-1):e.model.usedRange.rowIndex+r.length,e.model.usedRange.colIndex,e.model);const i=t+r.length;for(let t=0;t<=e.model.usedRange.colIndex;t++)e.model.rows[i]&&e.model.rows[i].cells&&e.model.rows[i].cells[t]&&void 0!==e.model.rows[i].cells[t].rowSpan&&e.model.rows[i].cells[t].rowSpan<0&&void 0===e.model.rows[i].cells[t].colSpan&&this.parent.notify("insertMerge",{range:[i,t,i,t],insertCount:r.length,insertModel:"Row"})}else if("Column"===e.modelType){e.model=e.model,e.model.columns||(e.model.columns=[]),e.model.columns.splice(t,0,...r),t<this.parent.frozenColCount(e.model)&&(this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",e.model.frozenColumns+r.length),s=!0),this.parent.setUsedRange(e.model.usedRange.rowIndex,t>e.model.usedRange.colIndex?t+(r.length-1):e.model.usedRange.colIndex+r.length,e.model),e.model.rows||(e.model.rows=[]);const n=[];e.columnCellsModel||(e.columnCellsModel=[]);for(let e=0;e<r.length;e++)n.push(null);i=[];for(let s=0;s<=e.model.usedRange.rowIndex;s++){e.model.rows[s]?e.model.rows[s].cells||(e.model.rows[s].cells=[]):e.model.rows[s]={cells:[]},t&&!e.model.rows[s].cells[t-1]&&(e.model.rows[s].cells[t-1]={}),e.model.rows[s].cells.splice(t,0,...e.columnCellsModel[s]&&e.columnCellsModel[s].cells?e.columnCellsModel[s].cells:n);const a=t+r.length;e.model.rows[s].cells[a]&&void 0!==e.model.rows[s].cells[a].colSpan&&e.model.rows[s].cells[a].colSpan<0&&void 0===e.model.rows[s].cells[a].rowSpan&&i.push({range:[s,a,s,a],insertCount:n.length,insertModel:"Column"})}i.forEach(e=>{this.parent.notify("insertMerge",e)})}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;const i=r;for(let e=0;e<i.length;e++)if(i[e].name)for(let t=0;t<this.parent.sheets.length;t++)if(i[e].name===this.parent.sheets[t].name){i.splice(e,1),e--;break}if(!i.length)return;let s;delete r[0].index,this.parent.createSheet(t,r),e.activeSheetIndex?this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),r.forEach(e=>{n&&this.updateRangeModel(e.ranges),s=e.id,this.parent.notify(an,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+s,index:s})})}const a={action:"refreshInsDelFormula",insertArgs:{model:r,startIndex:t,endIndex:t+r.length-1,modelType:e.modelType,name:"insert",activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,sheet:e.model}};"Sheet"!==e.modelType&&(this.parent.notify(an,{action:"refreshNamedRange",insertArgs:{model:r,index:t,modelType:e.modelType,isAction:e.isAction,definedNames:e.definedNames,activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,name:"insert",sheet:e.model}}),this.parent.notify(an,a),this.parent.notify("refreshClipboard",{start:t,end:t+r.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),e.model!==this.parent.getActiveSheet())||this.parent.notify("insert",{model:r,index:t,modelType:e.modelType,isAction:e.isAction,sheet:e.model,activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,insertType:e.insertType,freezePane:s})}updateRangeModel(e){e.forEach(e=>{e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")})}setInsertInfo(e,t,i,n,s="Row"){const r=i=t+(i-1);e.ranges.forEach(e=>{e.info&&t<e.info[n]&&(e.info[`insert${s}Range`]?e.info[`insert${s}Range`].push([t,r]):e.info[`insert${s}Range`]=[[t,r]],e.info[n]+=r-t+1)})}addEventListener(){this.parent.on("insertModel",this.insertModel,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||this.parent.off("insertModel",this.insertModel)}getModuleName(){return"workbookinsert"}}class $n{constructor(e){this.parent=e,this.addEventListener()}deleteModel(e){if("Sheet"===e.modelType&&1===this.parent.sheets.length)return;if("Column"===e.modelType){if("number"==typeof e.start)for(let t=0;t<=this.parent.getActiveSheet().usedRange.rowIndex+1;t++){const i={cellIdx:[t,e.start],isUnique:!1};if(this.parent.notify("checkUniqueRange",i),i.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(let c=0;c<=this.parent.getActiveSheet().usedRange.colIndex+1;c++){const t={cellIdx:[e.start,c],isUnique:!1};if(this.parent.notify("checkUniqueRange",t),t.isUnique)return}const t=`${e.modelType.toLowerCase()}s`;if(e.start=e.start,e.start>e.end){const t=e.start;e.start=e.end,e.end=t}let i;const n=[],s=e.end-e.start+1;let r,a;const o={action:"refreshInsDelFormula",insertArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,name:"delete",activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,sheet:e.model}};if("Row"===e.modelType){if(this.parent.notify(an,o),e.model=e.model,e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex),e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0);let t=this.parent.frozenRowCount(e.model);e.start<t&&(t=e.end<t?e.end-e.start+1:t-e.start,t=e.model.frozenRows-t,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",t),a=!0);const i=e.end+1;let l,h;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(let a=0;a<=e.model.usedRange.colIndex;a++){if(e.model.rows[e.start].cells[a]&&void 0!==e.model.rows[e.start].cells[a].rowSpan&&e.model.rows[e.start].cells[a].rowSpan<0&&void 0===e.model.rows[e.start].cells[a].colSpan&&(h={range:[e.start,a,e.start,a]},this.parent.notify(hn,h),h.range=h.range,h.range[2]<=e.end&&(r=Cs(h.range[0],a,e.model),r&&r.rowSpan>1&&(r.rowSpan-(h.range[2]-e.start+1)>1?vs(h.range[0],a,e.model,{colSpan:r.rowSpan-(h.range[2]-e.start+1)},!0):delete e.model.rows[h.range[0]].cells[a].rowSpan),h=null)),e.model.rows[i]&&e.model.rows[i].cells&&e.model.rows[i].cells[a]&&void 0!==e.model.rows[i].cells[a].rowSpan&&e.model.rows[i].cells[a].rowSpan<0&&void 0===e.model.rows[i].cells[a].colSpan&&(h||(h={range:[i,a,i,a]},this.parent.notify(hn,h)),l=new Object,h.range=h.range,Object.assign(l,Cs(h.range[0],h.range[1],e.model)),l&&l.rowSpan&&(l.rowSpan>1||l.colSpan>1))){const t=[];t[1]=a,t[3]=l.colSpan>1?a+(l.colSpan-1):a,h.range=h.range,h.range[0]<e.start?(t[0]=t[2]=h.range[0],l.rowSpan-s>1&&(t[2]+=l.rowSpan-s-1)):(t[0]=t[2]=e.start,l.rowSpan-(e.end-h.range[0]+1)>1&&(t[2]+=l.rowSpan-(e.end-h.range[0]+1)-1)),n.push({range:t,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}h=null}}else if("Column"===e.modelType){if(this.parent.notify(an,o),e.model=e.model,e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex),e.model.usedRange.colIndex-=s,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0);let t=this.parent.frozenColCount(e.model);e.start<t&&(t=e.end<t?e.end-e.start+1:t-e.start,t=e.model.frozenColumns-t,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",t),a=!0),i=[];const r=e.end+1;let l,h;for(let a=0;a<=e.model.usedRange.rowIndex;a++)if(i.push({}),e.model.rows[a]&&e.model.rows[a].cells){if(e.model.rows[a].cells[e.start]&&void 0!==e.model.rows[a].cells[e.start].colSpan&&e.model.rows[a].cells[e.start].colSpan<0&&void 0===e.model.rows[a].cells[e.start].rowSpan&&(h={range:[a,e.start,a,e.start]},this.parent.notify(hn,h),h.range=h.range,h.range[3]<=e.end)){const t=Cs(a,h.range[1],e.model);t&&t.colSpan>1&&(t.colSpan-(h.range[3]-e.start+1)>1?vs(a,h.range[1],e.model,{colSpan:t.colSpan-(h.range[3]-e.start+1)},!0):delete e.model.rows[a].cells[h.range[1]].colSpan),h=null}if(e.model.rows[a].cells[r]&&void 0!==e.model.rows[a].cells[r].colSpan&&e.model.rows[a].cells[r].colSpan<0&&void 0===e.model.rows[a].cells[r].rowSpan&&(h||(h={range:[a,r,a,r]},this.parent.notify(hn,h)),l=new Object,h.range=h.range,Object.assign(l,Cs(h.range[0],h.range[1],e.model)),l&&l.colSpan&&(l.colSpan>1||l.rowSpan>1))){const t=[];t[0]=a,t[2]=l.rowSpan>1?a+(l.rowSpan-1):a,h.range=h.range,h.range[1]<e.start?(t[1]=t[3]=h.range[1],l.colSpan-s>1&&(t[3]+=l.colSpan-s-1)):(t[1]=t[3]=e.start,l.colSpan-(e.end-h.range[1]+1)>1&&(t[3]+=l.colSpan-(e.end-h.range[1]+1)-1)),n.push({range:t,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}i[a].cells=e.model.rows[a].cells.splice(e.start,s),h=null}}else if(e.end-e.start==this.parent.sheets.length-1)return;const l=[];for(let c=e.start;c<=e.end;c++)"Sheet"===e.modelType&&this.parent.notify(an,{action:"deleteSheetTab",sheetName:"",index:c+1}),e.model[t][e.start]||e.start<e.model[t].length?(l.push(e.model[t][e.start]||{}),e.model[t].splice(e.start,1)):l.push({}),c===e.start&&(l[0].index=e.start);n.forEach(e=>{this.parent.notify(ln,e)});const h={action:"refreshNamedRange",insertArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,isAction:e.isAction,deletedModel:l,deletedCellsModel:i,activeSheetIndex:this.parent.activeSheetIndex,name:"delete",sheet:e.model}};this.parent.notify("beforeDelete",e),"Sheet"!==e.modelType&&(this.parent.notify(an,h),this.parent.notify("refreshClipboard",e),e.model!==this.parent.getActiveSheet())||this.parent.notify("delete",{startIndex:e.start,endIndex:e.end,modelType:e.modelType,definedNames:h.insertArgs.definedNames,isAction:e.isAction,deletedModel:l,deletedCellsModel:i,activeSheetIndex:this.parent.activeSheetIndex,freezePane:a,sheet:e.model})}setDeleteInfo(e,t,i,n="Row"){const s=t-e+1,r=[];this.parent.getActiveSheet().ranges.forEach(a=>{a.info&&e<a.info[i]&&(a.info[`delete${n}Range`]?a.info[`delete${n}Range`].push([e,t]):a.info[`delete${n}Range`]=[[e,t]],a.info[i]-=s,a.info[`insert${n}Range`]&&(a.info[`insert${n}Range`]=r))})}addEventListener(){this.parent.on("deleteModel",this.deleteModel,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||this.parent.off("deleteModel",this.deleteModel)}getModuleName(){return"workbookdelete"}}class Kn{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("setValidation",this.addValidationHandler,this),this.parent.on("removeValidation",this.removeValidationHandler,this),this.parent.on("addHighlight",this.addHighlightHandler,this),this.parent.on("removeHighlight",this.removeHighlightHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("setValidation",this.addValidationHandler),this.parent.off("removeValidation",this.removeValidationHandler),this.parent.off("addHighlight",this.addHighlightHandler),this.parent.off("removeHighlight",this.removeHighlightHandler))}addValidationHandler(e){this.ValidationHandler(e.rules,e.range,!1)}removeValidationHandler(e){this.ValidationHandler(e.rules,e.range,!0)}ValidationHandler(e,t,i){let n,s=t,a="";t.indexOf("!")>-1&&(s=t.split("!")[1],a=t.split("!")[0]);const o=Fs(this.parent,this.parent.getAddressInfo(a+"A1:A1").sheetIndex);let l=!1;const h=o.rowCount,c=s.split(":");s.match(/\D/g)&&!s.match(/[0-9]/g)?(c[0]+=1,c[1]+=h,s=c[0]+":"+c[1],l=!0):!s.match(/\D/g)&&s.match(/[0-9]/g)&&(c[0]="A"+c[0],c[1]=_i(0,o.colCount-1).replace(/[0-9]/g,"")+c[1],s=c[0]+":"+c[1]),Object(r.Z)(a)||(t=a+s);const d=Ni(t=t||o.selectedRange);if(l)for(let p=d[1];p<=d[3];p++){const t=Js(o,p);i&&t&&t.validation?delete o.columns[p].validation:(Object(r.Z)(t)&&(o.columns[p]=Js(o,p)),o.columns[p].validation={operator:e.operator,type:e.type,value1:"List"===e.type&&e.value1.length>256?e.value1.substring(0,255):e.value1,value2:e.value2,inCellDropDown:e.inCellDropDown,ignoreBlank:e.ignoreBlank})}else for(let r=d[0];r<=d[2];r++){o.rows[r]||Gs(o,r,{});for(let t=d[1];t<=d[3];t++)if(o.rows[r].cells&&o.rows[r].cells[t]||vs(r,t,o,{}),n=o.rows[r].cells[t],i){if(n.validation){delete n.validation;const e=this.parent.getCellStyleValue(["backgroundColor","color"],[r,t]);this.parent.notify(rn,{style:e,rowIdx:r,colIdx:t})}}else n.validation={type:e.type,operator:e.operator,value1:"List"===e.type&&e.value1.length>256?e.value1.substring(0,255):e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown}}}addHighlightHandler(e){this.InvalidDataHandler(e.range,!1,e.td,e.isclearFormat)}removeHighlightHandler(e){this.InvalidDataHandler(e.range,!0)}getRange(e){const t=Ni(e),i=this.parent.getActiveSheet(),n=i.colCount;return t[2]===i.rowCount-1&&0===t[0]?e=e.replace(/[0-9]/g,""):t[3]===n-1&&0===t[2]&&(e=e.replace(/\D/g,"")),e}InvalidDataHandler(e,t,i,n){let s,r;const a=this.parent.getActiveSheet(),o=(e=e||a.selectedRange)?Ni(e):[];let l=!1;(e=this.getRange(e)).match(/\D/g)&&!e.match(/[0-9]/g)&&(l=!0);let h=e?o[0]:0;const c=e?o[2]:a.rows.length;for(;h<=c;h++)if(a.rows[h]){let c=e?o[1]:0;const d=e?o[3]:a.rows[h].cells.length;for(;c<=d;c++){let e;if(a.rows[h].cells[c]){const o=Js(a,c);if(s=a.rows[h].cells[c],s&&s.validation){if(e=s.validation,n&&!e.isHighlighted)return;t?e.isHighlighted&&(s.validation.isHighlighted=!1):s.validation.isHighlighted=!0}else if(o&&o.validation){if(e=o.validation,n&&!e.isHighlighted)return;t&&l?e.isHighlighted&&(o.validation.isHighlighted=!1):l&&(o.validation.isHighlighted=!0)}r=s.value?s.value:"";const d=[h,c],p=this.parent.activeSheetIndex;if(e&&this.parent.allowDataValidation){this.parent.notify("isValidation",{value:r,range:d,sheetIdx:p,isCell:!1});const e=this.parent.allowDataValidation;this.parent.allowDataValidation=!0,e||this.parent.notify("validationHighlight",{isRemoveHighlightedData:t,rowIdx:h,colIdx:c,td:i})}}}}}getModuleName(){return"workbookDataValidation"}}class Jn{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("findNext",this.findNext,this),this.parent.on("findPrevious",this.findPrevious,this),this.parent.on("replace",this.replace,this),this.parent.on("replaceAll",this.replaceAll,this),this.parent.on("count",this.totalCount,this),this.parent.on("findAllValues",this.findAllValues,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("findNext",this.findNext),this.parent.off("findPrevious",this.findPrevious),this.parent.off("replace",this.replace),this.parent.off("replaceAll",this.replaceAll),this.parent.off("count",this.totalCount),this.parent.off("findAllValues",this.findAllValues))}findNext(e){const t=this.parent.sheets,i=t[this.parent.activeSheetIndex],n=Bi(i.activeCell),s=i.usedRange,r=s.colIndex,a=e.value.toString();let o,l,h=0;const c=s.rowIndex;let d,p;o=n[1],l=n[0];const g=o,u=l;if(i.rows[l]&&i.rows[l].cells&&i.rows[l].cells[o]&&(d=i.rows[l].cells[o].format,d?p=this.parent.getDisplayText(i.rows[l].cells[o]).toString():i.rows[l].cells[o].value&&(p=i.rows[l].cells[o].value.toString())),p){const t=p.toLowerCase(),i=p.indexOf(e.value)>-1,n=t.indexOf(e.value.toString().toLowerCase())>-1;(a===p||a===t||i||n)&&("By Column"===e.searchBy?l++:o++,h++)}(n[0]>i.usedRange.rowIndex||n[1]>i.usedRange.colIndex)&&(n[0]>i.usedRange.rowIndex&&n[1]<=i.usedRange.colIndex?(l=0,o=n[1]):n[0]<=i.usedRange.rowIndex&&n[1]>i.usedRange.colIndex?(l=n[0],o=0):(l=0,o=0));const m={rowIndex:l,colIndex:o,usedRange:s,endRow:c,endColumn:r,startRow:u,mode:e.mode,loopCount:0,count:h,args:e,val:void 0,stringValue:a,sheetIndex:this.parent.activeSheetIndex,startColumn:g,sheets:t};"By Row"===e.searchBy&&this.findNxtRow(m),"By Column"===e.searchBy&&this.findNxtCol(m)}findNxtRow(e){let t,i=e.sheets[e.sheetIndex];const n=this.parent.sheets.length;t=i.usedRange;let s=Bi(i.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++);e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){const r=this.parent.activeSheetIndex;if(e.sheetIndex++,n===e.sheetIndex&&(e.sheetIndex=0),r===e.sheetIndex&&0===e.count)return void this.parent.notify(on,null);i=e.sheets[e.sheetIndex],t=i.usedRange,s=Bi(i.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=t.colIndex,e.endRow=t.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===s[0]&&0===s[1]){if(0===e.count)return void this.parent.notify(on,null)}else(0!==s[0]&&0!==s[1]||0!==s[0]||0!==s[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=t.colIndex,e.endRow=s[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&t.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),i.rows[e.rowIndex]){const t=i.rows[e.rowIndex];for(;e.colIndex<=e.endColumn;e.colIndex++)if(t&&t.cells&&t.cells[e.colIndex]&&this.nextCommon(e))return;if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&s[0]===e.rowIndex)return void this.parent.notify(on,null)}}0!==e.count||this.parent.notify(on,null)}findNxtCol(e){let t,i=e.sheets[e.sheetIndex],n=Bi(i.activeCell);const s=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++);e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,s===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(on,null);i=e.sheets[e.sheetIndex],e.usedRange=i.usedRange,n=Bi(i.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===n[0]&&0===n[1]||n[1]>i.usedRange.rowIndex||n[0]>i.usedRange.colIndex){if(0===e.count)return void this.parent.notify(on,null)}else(0!==n[1]||0!==n[0]||0!==n[1]&&0!==n[0])&&(e.startRow=0,e.startColumn=0,e.endRow=n[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++)if(i.rows[e.rowIndex]&&i.rows[e.rowIndex].cells&&i.rows[e.rowIndex].cells[e.colIndex]&&this.nextCommon(e))return;if(e.loopCount>0&&n[1]===e.colIndex)return void this.parent.notify(on,null)}}0!==e.count||this.parent.notify(on,null)}nextCommon(e){const t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){const i=t.rows[e.rowIndex].cells[e.colIndex];if(i&&i.value){const i=t.rows[e.rowIndex].cells[e.colIndex];if(i){let n;if(n=i.format?this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]):t.rows[e.rowIndex].cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(n===e.stringValue){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){const i=n.indexOf(e.args.value)>-1;if(n===e.stringValue||i){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=n.toString().toLowerCase(),e.val===e.stringValue){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=n.toString().toLowerCase();const i=e.val.indexOf(e.args.value.toString().toLowerCase())>-1,s=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||n===e.stringValue||i||n===e.stringValue||s){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}}}}return!1}findPrevious(e){const t=this.parent.sheets,i=e.sheetIndex,n=t[i];let s,r;const a=Bi(n.activeCell);let o=0;const l=n.usedRange.rowIndex,h=n.usedRange.colIndex,c=e.value.toString();let d=a[1],p=a[0];const g=d,u=p;if(n.rows[p]&&n.rows[p].cells[d]&&(r=n.rows[p].cells[d].format,r?s=this.parent.getDisplayText(n.rows[p].cells[d]).toString():n.rows[p].cells[d].value&&(s=n.rows[p].cells[d].value.toString())),s){const t=s.toLowerCase(),i=s.indexOf(e.value)>-1,n=t.indexOf(e.value.toString().toLowerCase())>-1;(c===s||c===t||i||n)&&("By Row"===e.searchBy&&d--,"By Column"===e.searchBy&&p--,o++)}(a[0]>n.usedRange.rowIndex||a[1]>n.usedRange.colIndex)&&(a[0]>n.usedRange.rowIndex&&a[1]<=n.usedRange.colIndex?(p=n.usedRange.rowIndex,d=a[1]):a[0]<=n.usedRange.rowIndex&&a[1]>n.usedRange.colIndex?(p=a[0],d=n.usedRange.colIndex):(p=n.usedRange.rowIndex,d=n.usedRange.colIndex));const m={rowIndex:p,colIndex:d,endRow:l,endColumn:h,startRow:u,loopCount:0,count:o,args:e,val:void 0,stringValue:c,sheets:t,sheetIndex:i,startColumn:g};"By Row"===e.searchBy&&this.findPreRow(m),"By Column"===e.searchBy&&this.findPreCol(m)}findPreRow(e){let t,i=e.sheets[e.sheetIndex];const n=this.parent.sheets.length;let s=!1,r=Bi(i.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--);e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){const s=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),s===e.sheetIndex&&0===e.count)return void this.parent.notify(on,null);i=e.sheets[e.sheetIndex],t=i.usedRange,r=Bi(i.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}s=this.commonCondition(e,r)}if(!s){"Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=i.usedRange.rowIndex,e.colIndex=i.usedRange.colIndex);const t=i.rows[e.rowIndex];if(t){for(-1===e.colIndex&&(e.colIndex=i.usedRange.colIndex);e.colIndex>=0;e.colIndex--)if(t&&t.cells&&t.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&r[0]===e.rowIndex)return void this.parent.notify(on,null)}}}s||0!==e.count||this.parent.notify(on,null)}findPreCol(e){let t,i=e.sheets[e.sheetIndex];const n=this.parent.sheets.length;let s=!1,r=Bi(i.activeCell);for(;e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){const s=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),s===e.sheetIndex&&0===e.count)return void this.parent.notify(on,null);i=e.sheets[e.sheetIndex],t=i.usedRange,r=Bi(i.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}s=this.commonCondition(e,r)}if(!s){e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=i.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=i.usedRange.colIndex,e.rowIndex--);const t=i.rows[e.rowIndex];for(t&&i.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=i.usedRange.rowIndex);e.rowIndex>=0;e.rowIndex--){if(t&&t.cells&&t.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&r[1]===e.colIndex)return void this.parent.notify(on,null)}}}s||0!==e.count||this.parent.notify(on,null)}commonCondition(e,t){const i=e.sheets[e.sheetIndex];let n;return t[0]!==e.endRow&&t[1]!==e.endColumn||t[0]!==e.endRow||t[1]!==e.endColumn?(e.startColumn=i.usedRange.colIndex,e.startRow=i.usedRange.rowIndex,e.endColumn=0,e.endRow=t[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,n=!1):(t[0]===i.usedRange.rowIndex&&t[1]===i.usedRange.colIndex||t[0]>i.usedRange.rowIndex||t[1]>i.usedRange.colIndex)&&0!==t[0]&&0!==t[1]&&(this.parent.notify(on,null),n=!0),n}prevCommon(e){const t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){const i=t.rows[e.rowIndex].cells[e.colIndex];if(i&&i.value){const i=t.rows[e.rowIndex].cells[e.colIndex];if(i){let n;if(n=i.format?this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]):t.rows[e.rowIndex].cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(n===e.stringValue){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){const i=n.indexOf(e.args.value)>-1;if(n===e.stringValue||i){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=n.toString().toLowerCase(),e.val===e.stringValue){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=n.toString().toLowerCase();const i=e.val.indexOf(e.args.value.toString().toLowerCase())>-1,s=e.val.indexOf(e.args.value)>-1;if(n===e.stringValue||n===e.stringValue||i||e.val===e.stringValue||s){const i=t.name+"!"+_i(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:i}),e.count++,!0}}}}}return!1}replace(e){if(this.parent.getActiveSheet().isProtected)return void this.parent.notify("editAlert",null);const t=this.parent.getActiveSheet(),i=Bi(t.activeCell),n=t.rows[i[0]].cells[i[1]].value.toString(),s=n.indexOf(e.value)>-1,r=n.toLowerCase().indexOf(e.value.toString().toLowerCase())>-1,a=n.toString().toLowerCase();n===e.value||s||a===e.value||r||(e.findOpt="next",this.findNext(e)),this.parent.getActiveSheet();const o=Bi(t.activeCell),l=t.activeCell,h=t.rows[o[0]].cells[o[1]],c=t.rows[o[0]].cells[o[1]].format;let d;const p=t.name+"!"+_i(o[0],o[1]);d=c?this.parent.getDisplayText(t.rows[o[0]].cells[o[1]]).toString():t.rows[o[0]].cells[o[1]].value.toString(),this.parent.notify("findUndoRedo",{undoRedoOpt:"before",address:p,compareVal:d});const g=d.toLowerCase(),u=d.indexOf(e.value)>-1,m=g.indexOf(e.value)>-1;if(e.value===d||e.value===g)t.rows[o[0]].cells[o[1]].value=e.replaceValue,this.parent.updateCell(h,l),this.parent.notify("findUndoRedo",{address:p,compareVal:e.replaceValue,undoRedoOpt:"after"});else if(u){const i=d.replace(e.value,e.replaceValue);t.rows[o[0]].cells[o[1]].value=i,this.parent.updateCell(h,l),this.parent.notify("findUndoRedo",{address:p,compareVal:e.replaceValue,undoRedoOpt:"after"})}else if(m){const i=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),n=d.replace(i,e.replaceValue);t.rows[o[0]].cells[o[1]].value=n,this.parent.updateCell(h,l),this.parent.notify("findUndoRedo",{address:p,compareVal:e.replaceValue,undoRedoOpt:"after"})}}replaceAll(e){let t=0,i=this.parent.sheets[t],n=i.usedRange.rowIndex,s=0,r=0,a=i.usedRange.colIndex,o=0;const l=[];let h;for(;r<=n;r++)if(o>a&&r===n&&"Workbook"===e.mode&&(t++,i=this.parent.sheets[t],i&&(o=0,r=0,a=i.usedRange.colIndex,n=i.usedRange.rowIndex)),i&&i.rows[r]){const t=i.rows[r];for(o===a+1&&(o=0);o<=a;o++){const n=i.rows[r].cells[o];if(t&&t.cells&&t.cells[o]&&t.cells[o].value){const t=i.rows[r].cells[o];if(t){let a;if(a=t.format?this.parent.getDisplayText(i.rows[r].cells[o]).toString():i.rows[r].cells[o].value.toString(),e.isCSen&&e.isEMatch)a===e.value&&(i.rows[r].cells[o].value=e.replaceValue,h=i.name+"!"+_i(r,o),this.parent.updateCell(n,h),l.push(h),s++);else if(e.isCSen&&!e.isEMatch){const t=a.indexOf(e.value)>-1;if(a===e.value||t){const t=a.replace(e.value,e.replaceValue);i.rows[r].cells[o].value=t,h=i.name+"!"+_i(r,o),this.parent.updateCell(n,h),l.push(h),s++}}else if(!e.isCSen&&e.isEMatch)a.toString().toLowerCase()===e.value&&(i.rows[r].cells[o].value=e.replaceValue,h=i.name+"!"+_i(r,o),this.parent.updateCell(n,h),l.push(h),s++);else if(!e.isCSen&&!e.isEMatch){const t=a.toString().toLowerCase(),c=t.indexOf(e.value.toString().toLowerCase())>-1,d=t.indexOf(e.value)>-1;if(a===e.value||c||t===e.value||a===e.value||d){const t=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),c=a.replace(t,e.replaceValue);i.rows[r].cells[o].value=c,h=i.name+"!"+_i(r,o),this.parent.updateCell(n,h),l.push(h),s++}}}}}}let c={undoRedoOpt:"beforeReplaceAll",Collection:l,replaceValue:e.value};this.parent.notify("findUndoRedo",c),c={undoRedoOpt:"afterReplaceAll",Collection:l,replaceValue:e.replaceValue},this.parent.notify("findUndoRedo",c),this.parent.notify("replaceAllDialog",{count:s,replaceValue:e.replaceValue})}totalCount(e){const t=this.parent.sheets[e.sheetIndex],i=t.usedRange.rowIndex;let n=0,s=0;const r=t.usedRange.colIndex;let a=0;for(;s<=i;s++)if(t.rows[s]){const i=t.rows[s];for(a===r+1&&(a=0);a<=r;a++)if(i&&i.cells&&i.cells[a]&&i.cells[a].value){const i=t.rows[s].cells[a];if(i){let r;if(r=i.format?this.parent.getDisplayText(t.rows[s].cells[a]).toString():i.value.toString(),e.isCSen&&e.isEMatch)r===e.value&&n++;else if(e.isCSen&&!e.isEMatch){const t=r.indexOf(e.value)>-1;(r===e.value||t)&&n++}else if(!e.isCSen&&e.isEMatch)r.toString().toLowerCase()===e.value&&n++;else if(!e.isCSen&&!e.isEMatch){const t=r.toString().toLowerCase(),i=t.indexOf(e.value.toString().toLowerCase())>-1,s=t.indexOf(e.value)>-1;(t===e.value||r===e.value||i||r===e.value||s)&&n++}}}}const o=n;if(n=o-(this.requiredCount(e)-1),n>o&&(n=o),0!==n){const i=Bi(t.activeCell),s=t.rows[i[0]]?this.parent.getDisplayText(t.rows[i[0]].cells[i[1]]).toString().toLowerCase():null;s&&-1===s.indexOf(e.value.toString().toLowerCase())&&(n-=1)}e.findCount=n+" of "+o}requiredCount(e){const t=this.parent.sheets[this.parent.activeSheetIndex],i=Bi(t.activeCell),n=t.usedRange.rowIndex;let s=0,r=i[0];const a=t.usedRange.colIndex;let o=i[1];for(;r<=n;r++)if(t.rows[r]){const i=t.rows[r];for(o===a+1&&(o=0);o<=a;o++)if(i&&i.cells&&i.cells[o]&&i.cells[o].value&&t.rows[r].cells[o]){let i;if(i=t.rows[r].cells[o].format?this.parent.getDisplayText(t.rows[r].cells[o]).toString():t.rows[r].cells[o].value.toString(),e.isCSen&&!e.isEMatch){const t=i.indexOf(e.value)>-1;(i===e.value||t)&&s++}else if(e.isCSen&&e.isEMatch)i===e.value&&s++;else if(!e.isCSen&&e.isEMatch)i.toString().toLowerCase()===e.value&&s++;else if(!e.isCSen&&!e.isEMatch){const t=i.toString().toLowerCase(),n=e.value.toString().toLowerCase(),r=t.indexOf(n)>-1,a=t.indexOf(e.value)>-1;(i===e.value||t===n||r||t===e.value||a)&&s++}}}return s}findAllValues(e){let t,i=e.sheetIndex,n=this.parent.sheets[i],s=n.usedRange.rowIndex,a=0,o=n.usedRange.colIndex,l=0;const h=this.parent.sheets.length,c=e.sheetIndex;for(;a<=s+1;a++){if(1!==c&&e.sheetIndex===h&&(i=1),a>s&&l>o&&"Workbook"===e.mode){if(i++,c===i)return;i>h-1&&(i=0),n=this.parent.sheets[i],n&&(a=0,l=0,o=n.usedRange.colIndex,s=n.usedRange.rowIndex)}if(!Object(r.Z)(n)&&n.rows[a]){const i=n.rows[a];for(l===o+2&&(l=0);l<=o+1;l++)if(i&&i.cells&&i.cells[l]){const i=n.rows[a].cells[l];if(i){let s;if(s=i.format?this.parent.getDisplayText(n.rows[a].cells[l]).toString():i.value.toString(),e.isCSen&&e.isEMatch)s===e.value&&(t=n.name+"!"+_i(a,l),e.findCollection.push(t));else if(e.isCSen&&!e.isEMatch){const i=s.indexOf(e.value)>-1;(s===e.value||i)&&(t=n.name+"!"+_i(a,l),e.findCollection.push(t))}else if(!e.isCSen&&e.isEMatch)s.toString().toLowerCase()===e.value&&(t=n.name+"!"+_i(a,l),e.findCollection.push(t));else if(!e.isCSen&&!e.isEMatch){const i=s.toString().toLowerCase(),r=i.indexOf(e.value.toLowerCase())>-1;(i===e.value||s===e.value||r||s===e.value)&&(t=n.name+"!"+_i(a,l),e.findCollection.push(t))}}}}}}getModuleName(){return"workbookfindAndReplace"}}class Qn{constructor(e){this.parent=e,this.addEventListener()}protectsheetHandler(e){const t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"protectSettings",{selectCells:e.selectCells,formatCells:e.formatCells,formatColumns:e.formatColumns,formatRows:e.formatRows,insertLink:e.insertLink}),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"}),t.columns.forEach(e=>{e&&Object(r.cb)(e.isLocked)&&(e.isLocked=!0)})}unprotectsheetHandler(e){let t=this.parent.getActiveSheet();e.sheet&&(t=this.parent.sheets[e.sheet]),t.protectSettings.formatCells=t.protectSettings.formatColumns=!1,t.protectSettings.formatRows=t.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(t,"isProtected",!1),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"})}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("protectsheetHandler",this.protectsheetHandler,this),this.parent.on("unprotectsheetHandler",this.unprotectsheetHandler,this),this.parent.on("setLockCells",this.lockCells,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("protectsheetHandler",this.protectsheetHandler),this.parent.off("setLockCells",this.lockCells),this.parent.off("protectsheetHandler",this.unprotectsheetHandler))}lockCells(e){const t=this.parent.getActiveSheet();let i;i=e?e.range:t.selectedRange;const n="object"==typeof i?i:Wi(Ni(i));if(0===n[0]&&n[2]===t.rowCount-1)for(let s=n[1];s<=n[3];s++)Qs(t,s,{isLocked:e.isLocked});for(let s=n[0];s<=n[2];s++)for(let i=n[1];i<=n[3];i++)this.parent.getActiveSheet().id===t.id&&this.parent.notify("applyLockCells",{rowIdx:s,colIdx:i,isLocked:e.isLocked})}getModuleName(){return"workbookProtectSheet"}}class es{constructor(e){this.parent=e,this.addEventListener()}merge(e){e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=Ni(e.range)),e.range=Wi(e.range),e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify("activeCellChanged",null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"});const t=e.sheet||this.parent.getActiveSheet();this.parent.sheets.indexOf(t)===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{address:t.selectedRange,skipChecking:!0})}mergeAll(e){let t,i,n,s=0;e.range=e.range;const a=e.sheet||this.parent.getActiveSheet();let o;for(let l=e.range[0];l<=e.range[2];l++){i=0,e.isAction&&e.model.push({cells:[]});for(let h=e.range[1];h<=e.range[3];h++){if(t=Cs(l,h,a),t&&(t.value||t.formula)&&!n&&(n=t.formula||t.value),e.isAction&&e.merge&&(e.model[l-e.range[0]].cells[h-e.range[1]]={},Object(r.L)(e.model[l-e.range[0]].cells[h-e.range[1]],t,null,!0)),a.rows[l]&&a.rows[l].cells&&a.rows[l].cells[h]&&(delete a.rows[l].cells[h].rowSpan,delete a.rows[l].cells[h].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[l-e.range[0]]&&e.model[l-e.range[0]].cells[h-e.range[1]]&&e.model[l-e.range[0]].cells[h-e.range[1]]!=={}&&vs(l,h,a,e.model[l-e.range[0]].cells[h-e.range[1]])),e.merge){if(t=new Object,l===e.range[0]&&h===e.range[1]){e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(t.rowSpan=e.range[2]-e.range[0]+1),vs(e.range[0],e.range[1],a,t,!0);continue}l!==e.range[0]&&(t.rowSpan=-s),h!==e.range[1]&&(i++,t.colSpan=-i),a.rows[l]&&a.rows[l].cells&&a.rows[l].cells[h]&&(delete a.rows[l].cells[h].value,delete a.rows[l].cells[h].formula),o=Cs(l,h,a)||{},vs(l,h,a,Object.assign(t,o))}e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:l,colIdx:h})}s++}e.merge&&(t=this.getCellValue(e.range[0],e.range[1],n,a),vs(e.range[0],e.range[1],a,t,!0),e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[1]}))}mergeHorizontally(e){let t,i;e.range=e.range;const n=e.sheet||this.parent.getActiveSheet();let s,r,a;for(let o=e.range[0];o<=e.range[2];o++){t=0,e.isAction&&e.model.push({cells:[]});for(let l=e.range[1];l<=e.range[3];l++){if(a=Cs(o,l,n),i=new Object,e.isAction&&(e.model[o-e.range[0]].cells[l-e.range[1]]={},Object.assign(e.model[o-e.range[0]].cells[l-e.range[1]],a)),l===e.range[1]){if(o===e.range[0])continue;r=o-1,n.rows[r]&&n.rows[r].cells&&n.rows[r].cells[l]&&delete n.rows[r].cells[l].rowSpan,i=this.getCellValue(r,l,s,n),e.range[3]-e.range[1]>0&&(i.colSpan=e.range[3]-e.range[1]+1),s=null,vs(r,l,n,i,!0)}else a&&(a.value||a.formula)&&!s&&(s=a.formula||a.value),r=o,n.rows[r]&&n.rows[r].cells&&n.rows[r].cells[l]&&(delete n.rows[r].cells[l].rowSpan,delete n.rows[r].cells[l].value,delete n.rows[r].cells[l].formula),t++,i.colSpan=-t,vs(r,l,n,i,!0);this.parent.notify("applyMerge",{rowIdx:r,colIdx:l})}}n.rows[e.range[2]]&&n.rows[e.range[2]].cells&&n.rows[e.range[2]].cells[e.range[1]]&&delete n.rows[e.range[2]].cells[e.range[1]].rowSpan,i=this.getCellValue(e.range[2],e.range[1],s,n),e.range[3]-e.range[1]>0&&(i.colSpan=e.range[3]-e.range[1]+1),vs(e.range[2],e.range[1],n,i,!0),this.parent.notify("applyMerge",{rowIdx:e.range[2],colIdx:e.range[1]})}getCellValue(e,t,i,n){const s=new Object,r=Cs(e,t,n);return!i||r&&(r.value||r.formula)||(hs(i)?s.formula=i:s.value=i),s}mergeVertically(e){let t=0;e.range=e.range;const i=e.sheet||this.parent.getActiveSheet();let n,s,r,a;for(let o=e.range[1];o<=e.range[3];o++)for(let l=e.range[0];l<=e.range[2];l++){if(a=Cs(l,o,i),e.isAction&&(void 0===e.model[l-e.range[0]]&&(e.model[l-e.range[0]]={cells:[]}),e.model[l-e.range[0]].cells[o-e.range[1]]={},Object.assign(e.model[l-e.range[0]].cells[o-e.range[1]],a)),l===e.range[0]){if(t=0,o===e.range[1])continue;r=o-1,i.rows[l]&&i.rows[l].cells&&i.rows[l].cells[r]&&delete i.rows[l].cells[r].colSpan,n=this.getCellValue(l,r,s,i),e.range[2]-e.range[0]>0&&(n.rowSpan=e.range[2]-e.range[0]+1),s=null,vs(l,r,i,n,!0)}else n=new Object,a&&(a.value||a.formula)&&!s&&(s=a.formula||a.value),t++,r=o,i.rows[l]&&i.rows[l].cells&&i.rows[l].cells[r]&&(delete i.rows[l].cells[r].colSpan,delete i.rows[l].cells[r].value,delete i.rows[l].cells[r].formula),n.rowSpan=-t,vs(l,r,i,n,!0);this.parent.notify("applyMerge",{rowIdx:l,colIdx:r})}i.rows[e.range[0]]&&i.rows[e.range[0]].cells&&i.rows[e.range[0]].cells[e.range[3]]&&delete i.rows[e.range[0]].cells[e.range[3]].colSpan,n=this.getCellValue(e.range[0],e.range[1],s,i),e.range[2]-e.range[0]>0&&(n.rowSpan=e.range[2]-e.range[0]+1),vs(e.range[0],e.range[3],i,n,!0),this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[3]})}activeCellRange(e){e.range=e.range;const t=this.parent.getActiveSheet();let i=Cs(e.range[0],e.range[1],t);i&&(!Object(r.Z)(i.rowSpan)&&i.rowSpan<0&&(e.range[0]+=i.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!Object(r.Z)(i.colSpan)&&i.colSpan<0&&(e.range[1]+=i.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),i=Cs(e.range[0],e.range[1],t),i&&(i.rowSpan>1&&(e.range[0]+(i.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(i.rowSpan-1)),i.colSpan>1&&(e.range[1]+(i.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(i.colSpan-1))))}mergedRange(e){"string"==typeof e.range&&(e.range=Ni(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)}forward(e){e.range=e.range;const t=e.sheet||this.parent.getActiveSheet();let i,n,s,a,o=Cs(e.range[0],e.range[1],t),l=i=e.range[0],h=n=e.range[1];if(o&&(!Object(r.Z)(o.rowSpan)&&o.rowSpan<0&&(l=i=e.range[0]+o.rowSpan),!Object(r.Z)(o.colSpan)&&o.colSpan<0&&(h=n=e.range[1]+o.colSpan),o=Cs(l,h,t),o&&(o.rowSpan>1&&(i+=o.rowSpan-1,l+(o.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=l+(o.rowSpan-1))),o.colSpan>1&&(n+=o.colSpan-1,h+(o.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=h+(o.colSpan-1))))),e.range[0]=l,e.range[1]=h,e.range[0]===l&&e.range[1]===h&&e.range[2]===i&&e.range[3]===n&&(e.isActiveCell=!0),!e.skipChecking){for(let i=e.range[1];i<=e.range[3];i++)o=Cs(e.range[2],i,t),o&&(l=e.range[2],h=i,!Object(r.Z)(o.colSpan)&&o.colSpan<0&&(h+=o.colSpan,h<e.range[1]&&(e.range[1]=h)),!Object(r.Z)(o.rowSpan)&&o.rowSpan<0&&(l+=o.rowSpan,l<e.range[0]&&(e.range[0]=l)),o=Cs(l,h,t),o&&(o.colSpan>1&&h+(o.colSpan-1)>e.range[3]&&(e.range[3]=h,e.range[3]=h+(o.colSpan-1)),o.rowSpan>1&&l+(o.rowSpan-1)>e.range[2]&&(e.range[2]=l,e.range[2]=l+(o.rowSpan-1))));for(let i=e.range[1];i<=e.range[3];i++)o=Cs(e.range[0],i,t),o&&(a=i,s=e.range[0],!Object(r.Z)(o.colSpan)&&o.colSpan<0&&(a+=o.colSpan,a<e.range[1]&&(e.range[1]=a)),!Object(r.Z)(o.rowSpan)&&o.rowSpan<0&&(s+=o.rowSpan,s<e.range[0]&&(e.range[0]=s)));for(let i=e.range[0];i<=e.range[2];i++)o=Cs(i,e.range[3],t),o&&(l=i,h=e.range[3],!Object(r.Z)(o.rowSpan)&&o.rowSpan<0&&(l+=o.rowSpan,l<e.range[0]&&(e.range[0]=l)),!Object(r.Z)(o.colSpan)&&o.colSpan<0&&(h+=o.colSpan,h<e.range[1]&&(e.range[1]=h)),o=Cs(l,h,t),o&&(o.rowSpan>1&&l+(o.rowSpan-1)>e.range[2]&&(e.range[2]=l,e.range[2]=l+(o.rowSpan-1)),o.colSpan>1&&h+(o.colSpan-1)>e.range[3]&&(e.range[3]=h,e.range[3]=h+(o.colSpan-1))))}}forwardReverse(e){const t=this.parent.getActiveSheet();e.range=e.range;let i,n,s,a,o=e.range[1],l=Cs(e.range[0],e.range[1],t),h=e.range[0];if(l&&(!Object(r.Z)(l.colSpan)&&l.colSpan<0&&(o+=l.colSpan,e.range[3]>=o&&(e.range[3]=o)),!Object(r.Z)(l.rowSpan)&&l.rowSpan<0&&(h+=l.rowSpan,h<e.range[0]&&(e.range[0]=h)),l=Cs(h,o,t),l&&(l.rowSpan>1&&h+(l.rowSpan-1)>=e.range[2]&&(e.range[2]=h+(l.rowSpan-1)),l.colSpan>1&&o+(l.colSpan-1)>=e.range[1]&&(e.range[1]=o+(l.colSpan-1)))),e.range[0]=h,!e.skipChecking){for(let s=e.range[3];s<=e.range[1];s++)l=Cs(e.range[2],s,t),l&&(n=s,i=e.range[2],!Object(r.Z)(l.rowSpan)&&l.rowSpan<0&&(i+=l.rowSpan,i<e.range[0]&&(e.range[0]=i)),!Object(r.Z)(l.colSpan)&&l.colSpan<0&&(n+=l.colSpan,n<e.range[3]&&(e.range[3]=n)),l=Cs(i,n,t),l&&(l.rowSpan>1&&i+(l.rowSpan-1)>e.range[2]&&(e.range[2]=i+(l.rowSpan-1)),l.colSpan>1&&n+(l.colSpan-1)>e.range[1]&&(e.range[1]=n+(l.colSpan-1))));for(let i=e.range[3];i<=e.range[1];i++)l=Cs(e.range[0],i,t),l&&(n=i,s=e.range[0],!Object(r.Z)(l.rowSpan)&&l.rowSpan<0&&(s+=l.rowSpan,s<e.range[0]&&(e.range[0]=s)),!Object(r.Z)(l.colSpan)&&l.colSpan<0&&(n+=l.colSpan),l=Cs(s,n,t),l&&(l.rowSpan>1&&s+(l.rowSpan-1)>e.range[2]&&(e.range[2]=s+(l.rowSpan-1)),l.colSpan>1&&n+(l.colSpan-1)>e.range[1]&&(e.range[1]=n,e.range[1]=n+(l.colSpan-1))));for(let i=e.range[0];i<=e.range[2];i++)l=Cs(i,e.range[3],t),l&&(s=i,a=e.range[3],!Object(r.Z)(l.rowSpan)&&l.rowSpan<0&&(s+=l.rowSpan,s<e.range[0]&&(e.range[0]=s)),!Object(r.Z)(l.colSpan)&&l.colSpan<0&&(a+=l.colSpan,a<e.range[3]&&(e.range[3]=a)),l=Cs(s,a,t),l&&(l.rowSpan>1&&s+(l.rowSpan-1)>e.range[2]&&(e.range[2]=s,e.range[2]=s+(l.rowSpan-1)),l.colSpan>1&&a+(l.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(l.colSpan-1))))}}reverse(e){e.range=e.range;let t=e.range[1];const i=e.sheet||this.parent.getActiveSheet();let n=Cs(e.range[0],e.range[1],i),s=e.range[0];n&&(!Object(r.Z)(n.colSpan)&&n.colSpan<0&&(t+=n.colSpan),!Object(r.Z)(n.rowSpan)&&n.rowSpan<0&&(s+=n.rowSpan),e.range[2]>=s&&(e.range[2]=s,e.isActiveCell=!0),e.range[3]>=t?(e.range[3]=t,e.range[2]===s&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),n=Cs(s,t,i),n&&(n.rowSpan>1&&s+(n.rowSpan-1)>=e.range[0]&&(e.range[0]=s,e.range[0]=s+(n.rowSpan-1)),n.colSpan>1&&t+(n.colSpan-1)>=e.range[1]&&(e.range[1]=t,e.range[1]=t+(n.colSpan-1))));let a,o,l=e.range[3];if(!e.skipChecking){for(let t=e.range[3];t<=e.range[1];t++)n=Cs(e.range[2],t,i),n&&(l=t,s=e.range[2],!Object(r.Z)(n.rowSpan)&&n.rowSpan<0&&(s+=n.rowSpan,s<e.range[2]&&(e.range[2]=s)),!Object(r.Z)(n.colSpan)&&n.colSpan<0&&(l+=n.colSpan,l<e.range[3]&&(e.range[3]=l)),n=Cs(s,l,i),n&&(n.rowSpan>1&&s+(n.rowSpan-1)>e.range[0]&&(e.range[0]=s,e.range[0]=s+(n.rowSpan-1)),n.colSpan>1&&l+(n.colSpan-1)>e.range[1]&&(e.range[1]=l,e.range[1]=l+(n.colSpan-1))));l=e.range[3];for(let t=e.range[3];t<=e.range[1];t++)n=Cs(e.range[0],t,i),n&&(l=t,s=e.range[0],!Object(r.Z)(n.colSpan)&&n.colSpan<0&&(l+=n.colSpan),!Object(r.Z)(n.rowSpan)&&n.rowSpan<0&&(s+=n.rowSpan),n=Cs(s,l,i),n&&(n.colSpan>1&&l+(n.colSpan-1)>e.range[1]&&(e.range[1]=l,e.range[1]=l+(n.colSpan-1)),n.rowSpan>1&&s+(n.rowSpan-1)>e.range[0]&&(e.range[0]=s,e.range[0]=s+(n.rowSpan-1))));for(let t=e.range[2];t<=e.range[0];t++)n=Cs(t,e.range[3],i),n&&(o=t,a=e.range[3],!Object(r.Z)(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan,o<e.range[2]&&(e.range[2]=o)),!Object(r.Z)(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan,a<e.range[3]&&(e.range[3]=a)),n=Cs(o,a,i),n&&(n.rowSpan>1&&o+(n.rowSpan-1)>e.range[0]&&(e.range[0]=o,e.range[0]=o+(n.rowSpan-1)),n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(n.colSpan-1))))}}reverseForward(e){e.range=e.range;const t=e.sheet||this.parent.getActiveSheet();let i=e.range[0],n=e.range[1],s=Cs(e.range[0],e.range[1],t);if(s&&(!Object(r.Z)(s.rowSpan)&&s.rowSpan<0&&(i+=s.rowSpan,e.range[2]>=i&&(e.range[2]=i)),!Object(r.Z)(s.colSpan)&&s.colSpan<0&&(n+=s.colSpan),s=Cs(i,n,t),s&&(s.rowSpan>1&&i+(s.rowSpan-1)>=e.range[0]&&(e.range[0]=i,e.range[0]=i+(s.rowSpan-1)),s.colSpan>1&&n+(s.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=n+(s.colSpan-1)))),e.skipChecking)return;let a,o,l,h,c=e.range[3];for(let d=e.range[1];d<=e.range[3];d++)s=Cs(e.range[2],d,t),s&&(a=e.range[2],c=d,!Object(r.Z)(s.rowSpan)&&s.rowSpan<0&&(a+=s.rowSpan,a<e.range[2]&&(e.range[2]=a)),!Object(r.Z)(s.colSpan)&&s.colSpan<0&&(c+=s.colSpan,c<e.range[1]&&(e.range[1]=c)),s=Cs(a,c,t),s&&(s.colSpan>1&&c+(s.colSpan-1)>e.range[3]&&(e.range[3]=c+(s.colSpan-1)),s.rowSpan>1&&s.rowSpan-1+a>e.range[0]&&(e.range[0]=s.rowSpan-1+a)));for(let d=e.range[1];d<=e.range[3];d++)s=Cs(e.range[0],d,t),s&&(l=d,o=e.range[0],!Object(r.Z)(s.colSpan)&&s.colSpan<0&&(l+=s.colSpan,l<e.range[1]&&(e.range[1]=l)),!Object(r.Z)(s.rowSpan)&&s.rowSpan<0&&(o+=s.rowSpan),s=Cs(o,l,t),s&&s.rowSpan>1&&o+(s.rowSpan-1)>e.range[0]&&(e.range[0]=o+(s.rowSpan-1)));for(let d=e.range[2];d<=e.range[0];d++)s=Cs(d,e.range[3],t),s&&(a=d,h=e.range[3],!Object(r.Z)(s.rowSpan)&&s.rowSpan<0&&(a+=s.rowSpan,a<e.range[2]&&(e.range[2]=a)),!Object(r.Z)(s.colSpan)&&s.colSpan<0&&(h+=s.colSpan,h<e.range[1]&&(e.range[1]=h)),s=Cs(a,h,t),s&&(s.rowSpan>1&&s.rowSpan-1+a>e.range[0]&&(e.range[0]=s.rowSpan-1+a),s.colSpan>1&&s.colSpan-1+h>e.range[3]&&(e.range[3]=h,e.range[3]=s.colSpan-1+h)))}insertHandler(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)}pasteHandler(e){const t=this.parent.getActiveSheet();let i,n,s;const r=Bi(t.activeCell);for(let a=e.range[0],o=0;a<=e.range[2];a++,o++)for(let l=e.range[1],h=0;l<=e.range[3];l++,h++){if(i=Cs(a,l,e.prevSheet)||{},i.rowSpan>1&&(s=Cs(r[0]+(i.rowSpan-1),r[1],t)||{},n=Cs(r[0]+1,r[1],t)||{},void 0!==s.colSpan&&s.colSpan<0||void 0!==n.colSpan&&n.colSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0});if(i.colSpan>1&&(s=Cs(r[0],r[1]+(i.colSpan-1),t)||{},n=Cs(r[0],r[1]+1,t)||{},void 0!==s.rowSpan&&s.rowSpan<0||void 0!==n.rowSpan&&n.rowSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0})}}addEventListener(){this.parent.on(ln,this.merge,this),this.parent.on("mergedRange",this.mergedRange,this),this.parent.on(hn,this.activeCellRange,this),this.parent.on("insertMerge",this.insertHandler,this),this.parent.on("pasteMerge",this.pasteHandler,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||(this.parent.off(ln,this.merge),this.parent.off("mergedRange",this.mergedRange),this.parent.off(hn,this.activeCellRange),this.parent.off("insertMerge",this.insertHandler),this.parent.off("pasteMerge",this.pasteHandler))}getModuleName(){return"workbookmerge"}}class ts{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("setCFRule",this.setCFrulHandler,this),this.parent.on("clearCFRule",this.clearRules,this),this.parent.on("cFUndo",this.cFUndoHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("setCFRule",this.setCFrulHandler),this.parent.off("clearCFRule",this.clearRules),this.parent.off("cFUndo",this.cFUndoHandler))}setCFrulHandler(e){const t=e.conditionalFormat;let i=t.range;const n=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(i).sheetIndex,s=Fs(this.parent,n);i=i||s.selectedRange;const r=Wi(Ni(i));if(t.range=zi(r),s.conditionalFormats||this.parent.setSheetPropertyOnMute(s,"conditionalFormats",[]),s.conditionalFormats[s.conditionalFormats.length]=t,e.isUndoRedo&&n!==this.parent.activeSheetIndex)this.parent.notify("gotoHandler",{address:s.name+"!"+t.range});else for(let a=r[0];a<=r[2];a++){s.rows[a]||Gs(s,a,{});for(let i=r[1];i<=r[3];i++)s.rows[a].cells&&s.rows[a].cells[i]||vs(a,i,s,{}),n===this.parent.activeSheetIndex&&this.parent.notify("cFInitialCheck",{rowIdx:a,colIdx:i,cell:s.rows[a].cells[i],conditionalFormat:t,isAction:e.isAction})}}clearRules(e){const t=!!Object(r.Z)(e.isPublic),i=[],n=[];let s,a,o,l,h,c,d,p,g=!0;const u=e.range,m=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(u).sheetIndex,f=Fs(this.parent,m),b=f.conditionalFormats,y=Ni(u);if(m===this.parent.activeSheetIndex)for(let r=y[0];r<=y[2];r++)for(let e=y[1];e<=y[3];e++)this.parent.notify("clearCF",{rIdx:r,cIdx:e});if(b){for(let r=b.length-1;r>=0;r--){let u=!1,x="";const C=b[r],v=C.range.split(",");if(m===this.parent.activeSheetIndex&&(e.isClearCF||!e.isUndoRedo))for(let e=0;e<v.length;e++){let t=!1;const i=Ni(v[e]);d=i[0],p=i[0],h=i[1],c=i[1],i[0]>=y[0]&&i[2]<=y[2]&&i[1]>=y[1]&&i[3]<=y[3]&&(t=!0);for(let e=i[0];e<=i[2];e++){let n=0;for(let t=i[1];t<=i[3];t++)for(let s=y[0];s<=y[2];s++)for(let r=y[1];r<=y[3];r++)if(s===e&&r===t){const e=this.parent.getCellStyleValue(["backgroundColor","color"],[s,r]);this.parent.notify(rn,{style:e,rowIdx:s,colIdx:r,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0}),n+=1,u=!0,s===i[0]?r===i[3]?h===i[1]?c===r?c=r:h=r-1:h!==i[1]&&c+1===r?(c=i[1],h-=1):h!==i[1]&&c===i[1]&&(h=y[1]-1):r===i[1]?c===i[1]&&(c=r+1):h===i[1]&&c===i[1]?(h=r,c=r):c=h===i[1]&&c!==i[1]?r+1:r:r===i[1]?c===i[1]&&i[1]!==i[3]&&(c=r+1):r===i[3]?h===i[1]?c===r?c=r:h=r-1:h!==i[1]&&c===i[1]?h=y[1]-1:h!==i[1]&&c+1===r?(c=i[1],h=y[1]-1):p=s:h===i[1]&&c===i[1]?(h=r,c=r):c!==i[1]&&h!==i[1]?c=r:h!==i[1]&&c===i[1]?h=r:c=r+1}n>0&&!t?(g&&(s=d,a=p,o=h,l=c),h===i[1]&&c!==i[1]?c===i[3]?(d!==e&&(x=x+" "+zi([d,o,a,i[3]])),h===i[1]&&c===i[3]&&(e===i[2]?i[1]===y[3]&&(x=x+" "+zi([e,c,e,i[3]])):(y[2]===i[0]&&c!==i[3]&&(x=x+" "+zi([e,c,e,i[3]])),d=e+1,p=e+1,c=i[1]))):l!==c?(x=x+" "+zi([d,l,e-1,i[3]]),c===i[3]&&h===i[1]?(d=e+1,p=e+1,c=i[1]):(d=e,p=e),c===i[3]&&h!==i[1]&&(h=i[1])):o!==h?(x=x+" "+zi([d,i[1],e-1,o]),d=e+1,p=e+1,h=i[1],c=i[1]):e===i[2]?x=x+" "+zi([d,c,e,i[3]]):(p<e||h===i[1]&&c===i[3])&&(p=e):c===i[1]&&h!==i[1]?(l!==c&&(x=x+" "+zi([d,l,e-1,i[3]]),d=e,p=e),o!==h&&(x=x+" "+zi([d,o,e-1,i[3]]),d=e,p=e),e===i[2]?x=x+" "+zi([d,c,e,h]):p=e):c!==i[1]&&h!==i[1]?e===i[2]&&i[2]===y[0]?i[0]===i[2]?(x=x+" "+zi([d,i[1],p,h-1]),x=x+" "+zi([d,c+1,p,i[3]])):(x=x+" "+zi([d,i[1],p,i[3]]),x=x+" "+zi([i[2],i[1],i[2],h-1]),x=x+" "+zi([i[2],c+1,i[2],i[3]])):e===i[2]?(x=x+" "+zi([d,i[1],e,h-1]),x=x+" "+zi([d,c+1,e,i[3]])):(o===i[1]&&l===i[1]&&(x=x+" "+zi([d,o,p,i[3]]),d=e),p=e):h===i[1]&&c===i[1]&&(y[2]!==i[0]?(i[2]>=y[2]&&e>y[2]&&(x=x+" "+zi([d,h,p,i[3]])),i[1]===i[3]&&e<=i[2]&&s!==i[2]&&e!==s&&(x=x+" "+zi([d,h,p,i[3]])),i[1]===i[3]&&(d=e+1,p=e+1)):((e===i[2]||e===i[0]&&i[1]!==i[3])&&(x=x+" "+zi([d,h,p,c])),d=e+1,p=e+1),e===i[2]&&i[0]!==i[2]&&i[1]!==i[3]&&(x=x+" "+zi([e,h,e,c]))),g||(s=d,a=p<=i[2]?p:i[2],o=h,l=c<=i[3]?c:i[3]),g=!1):t||(g&&(s=d,a=p,o=h,l=c),h===i[1]&&c===i[1]&&(e===i[2]&&(x=x+" "+zi([d,h,e,i[3]])),p=e),c!==i[1]&&h!==i[1]&&(x=x+" "+zi([d,i[1],e-1,h-1]),x=x+" "+zi([d,c+1,e-1,i[3]]),d=e,p=e,h=i[1],c=i[1]),c!==i[1]&&h===i[1]&&(x=x+" "+zi([d,c,e-1,i[3]]),d=e,p=e,h=i[1],c=i[1]),h!==i[1]&&c===i[1]&&(x=x+" "+zi([d,c,e-1,h]),d=e,p=e,h=i[1],c=i[1]),g||(s=d,a=p<=i[2]?p:i[2],o=h,l=c<=i[3]?c:i[3]),g=!1)}}if(""===x?(n.push(f.conditionalFormats[r].range),f.conditionalFormats.splice(r,1)):(n.push(f.conditionalFormats[r].range),f.conditionalFormats[r].range=x.trim().replace(" ",",")),u&&!t&&(C.range=x.trim().replace(" ",","),i.push(C)),e.isUndoRedo){this.parent.activeSheetIndex!==e.sheetIdx&&this.parent.notify("gotoHandler",{address:f.name+"!"+e.range});break}}t||this.parent.notify(Cn,{eventArgs:{cFormats:i,oldRange:n,selectedRange:u,sheetIdx:m},action:"clearCF"}),e.isclearFormat||this.parent.notify("addHighlight",{range:u,isclearFormat:!0})}}cFUndoHandler(e){if(e.sheetIdx===this.parent.activeSheetIndex){const t=e.conditionalFormat,i=t.range.split(","),n=Fs(this.parent,e.sheetIdx);for(let e=0;e<i.length;e++){const s=Ni(i[e]);for(let e=s[0];e<=s[2];e++)for(let i=s[1];i<=s[3];i++)this.parent.notify("cFInitialCheck",{rowIdx:e,colIdx:i,cell:n.rows[e].cells[i],conditionalFormat:t,isAction:!0})}}}getModuleName(){return"workbookConditionalFormatting"}}function is(e,t=[]){return t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowDataValidation&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),t}var ns=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ss=(()=>{class e extends r.e{}return ns([Object(r.t)("Calibri")],e.prototype,"fontFamily",void 0),ns([Object(r.t)("bottom")],e.prototype,"verticalAlign",void 0),ns([Object(r.t)("left")],e.prototype,"textAlign",void 0),ns([Object(r.t)("0pt")],e.prototype,"textIndent",void 0),ns([Object(r.t)("#000000")],e.prototype,"color",void 0),ns([Object(r.t)("#ffffff")],e.prototype,"backgroundColor",void 0),ns([Object(r.t)("normal")],e.prototype,"fontWeight",void 0),ns([Object(r.t)("normal")],e.prototype,"fontStyle",void 0),ns([Object(r.t)("11pt")],e.prototype,"fontSize",void 0),ns([Object(r.t)("none")],e.prototype,"textDecoration",void 0),ns([Object(r.t)("")],e.prototype,"border",void 0),ns([Object(r.t)("")],e.prototype,"borderTop",void 0),ns([Object(r.t)("")],e.prototype,"borderBottom",void 0),ns([Object(r.t)("")],e.prototype,"borderLeft",void 0),ns([Object(r.t)("")],e.prototype,"borderRight",void 0),e})(),rs=(()=>{class e extends r.e{}return ns([Object(r.t)("")],e.prototype,"name",void 0),ns([Object(r.t)("")],e.prototype,"scope",void 0),ns([Object(r.t)("")],e.prototype,"comment",void 0),ns([Object(r.t)("")],e.prototype,"refersTo",void 0),e})(),as=(()=>{class e extends r.e{}return ns([Object(r.t)(!1)],e.prototype,"selectCells",void 0),ns([Object(r.t)(!1)],e.prototype,"formatCells",void 0),ns([Object(r.t)(!1)],e.prototype,"formatRows",void 0),ns([Object(r.t)(!1)],e.prototype,"formatColumns",void 0),ns([Object(r.t)(!1)],e.prototype,"insertLink",void 0),e})(),os=(()=>{class e extends r.e{}return ns([Object(r.t)("General")],e.prototype,"format",void 0),ns([Object(r.g)({},ss)],e.prototype,"style",void 0),ns([Object(r.t)(!0)],e.prototype,"isLocked",void 0),e})(),ls=(()=>{class e extends r.e{}return ns([Object(r.t)("GreaterThan")],e.prototype,"type",void 0),ns([Object(r.g)({},os)],e.prototype,"format",void 0),ns([Object(r.t)("RedFT")],e.prototype,"cFColor",void 0),ns([Object(r.t)("")],e.prototype,"value",void 0),ns([Object(r.t)("")],e.prototype,"range",void 0),e})();function hs(e,t){return e&&"="===e[0]&&(e.length>1||t)}function cs(e){let t=e;if(t=t.split("$").join(""),t.indexOf(":")>-1){const e=t.split(":");if(ms(e[0])&&ms(e[1]))return!0}else if(t.indexOf(":")<0&&ms(t))return!0;return!1}function ds(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function ps(e,t,i){return e&&t>=e[0]&&t<=e[2]&&i>=e[1]&&i<=e[3]}function gs(e,t,i){let n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(i){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function us(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function ms(e){const t=e;let i=0,n=0;const s=[89,71,69];let r="";const a=t.length;for(let l=0;l<a;l++)ds(t[l])&&i++;r=t.substring(0,i);const o=r.length;if(o!==a&&o<4&&1!==a&&isNaN(parseInt(t,10))){for(;n<o;){if(!(r[n]&&r[n].charCodeAt(0)<s[n])){if(!r[n]&&n>0)break;return!1}n++}const e=parseFloat(t.substring(i,a));if(e>0&&e<1048577)return!0}return!1}function fs(e,t,i,n){let s,r;if(t&&(r=n||Cs(t[0],t[1],i,!1,!0),s=r.formula?r.formula.toUpperCase():""),s){0===s.indexOf("=")&&(s=s.slice(1)),s=s.split("(").join(",").split(")").join(",");const i=["+","-","*","/",">=","<=","<>",">","<","=","%"];let n,a=s;for(let e=0;e<i.length;e++)n=a.split(i[e]),a=n.join(",");n=a.split(",");const o=[];let l,h,c;for(let s=0;s<n.length;s++)if(cs(n[s])){const i=Ni(n[s]),r=[e[0]-(t[0]-i[0]),e[1]-(t[1]-i[1]),e[0]-(t[0]-i[2]),e[1]-(t[1]-i[3])];r[0]<0||r[1]<0||r[2]<0||r[3]<0?l="#REF!":(l=_i(r[0],r[1]),n[s].includes(":")&&(l+=":"+_i(r[2],r[3])),l=cs(l)?l:"#REF!"),h={},h[n[s]]=l,n[s].includes(":")?o.splice(0,0,h):o.push(h)}s=r.formula;for(let e=0;e<o.length;e++)c=Object.keys(o[e])[0],s=s.replace(new RegExp(c,"gi"),o[e][c].toUpperCase());return s}return null}function bs(e,t,i){let n,s,r,a,o,l,h=e,c=e,d=t,p=t;for(let g=1;!a&&Cs(e+g,t,i,null,!0).value?c=e+g:a=!0,!r&&Cs(e-g,t,i,null,!0).value?h=e-g:r=!0,!r||!a;g++);for(let g=1;;g++){n=d,s=p;for(let e=h;e<=c;e++)if(!o&&Cs(e,d-1,i,null,!0).value&&(d=n-1),!l&&Cs(e,p+1,i,null,!0).value&&(p=s+1),e===c&&(d===n&&(o=!0),p===s&&(l=!0)),l&&o)return[h,d,c,p]}}const ys="spreadsheetLocale",xs={SortOutOfRangeError:"Select a cell or range inside the used range and try again."};function Cs(e,t,i,n,s){const r=Zs(i,e);if(!r||!r.cells){if(!n)return s?{}:null;r?i.rows[e].cells=[]:i.rows[e]={cells:[]}}return i.rows[e].cells[t]||(s?{}:null)}function vs(e,t,i,n,s){i.rows[e]?i.rows[e].cells||(i.rows[e].cells=[]):i.rows[e]={cells:[]},s&&i.rows[e].cells[t]?Object(r.L)(i.rows[e].cells[t],n,null,!0):i.rows[e].cells[t]=n}function Ss(e,t){const i={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},n={};return Object.keys(t?i:e).forEach(t=>{e[t]!==i[t]&&(n[t]=e[t])}),n}function ws(e,t=!0,i){const n=i.getAddressInfo(e),s=n.indices,r=Fs(i,n.sheetIndex);for(let a=s[0];a<=s[2];a++)for(let e=s[1];e<=s[3];e++)vs(a,e,r,{wrap:t},!0);i.setProperties({sheets:i.sheets},!0),n.sheetIndex===i.activeSheetIndex&&i.notify("wrapText",{range:s,wrap:t,sheet:r})}function Is(e,t,i,n,s,r,a,o,l=!0){return new Promise((h,c)=>{h((()=>{let h,c,d=new Map;const p=t.indexOf("!")>-1?Ls(e,js(t)):e.activeSheetIndex,g=Fs(e,p),u=Ui(t);let m=u[0],f=0;const b={sheet:g,indexes:u,formulaCellRef:a,sheetIndex:o,promise:new Promise((e,t)=>{e(void 0)})};return e.notify("updateSheetFromDataSource",b),b.promise.then(()=>{const t=e.frozenRowCount(g),a=e.frozenColCount(g);for(;m<=u[2];){const o={};for(c=Zs(g,m),h=u[1];h<=u[3];){if(i){if(l&&Ys(g,m)&&!r){m++;continue}d instanceof Map&&(d=[]);const t=Vi(h+1),i="__rowIndex";if(n)o[t]=c?Os(e,m,h,p,g):"";else{const e=c?Cs(m,h,g):null;(e&&(e.formula||e.value)||Object.keys(o).length)&&(o[t]=e)}u[3]<h+1&&Object.keys(o).length&&(o[i]=(m+1).toString()),d[f.toString()]=o}else{const i={cell:Cs(m,h,g),address:_i(m,h),rowIndex:m,colIndex:h};e.trigger("queryCellInfo",i);const r={};if(Object.assign(r,c?Cs(m,h,g):null),r.colSpan>1&&r.rowSpan>1){let e;for(let t=m,i=m+r.rowSpan;t<i;t++)for(let n=h,s=h+r.colSpan;n<s;n++)t===m&&n===h||(e=new Object,t!==m&&(e.rowSpan=m-t),n!==h&&(e.colSpan=h-n),g.rows[t]&&g.rows[t].cells&&g.rows[t].cells[n]&&(delete g.rows[t].cells[n].value,delete g.rows[t].cells[n].formula),vs(t,n,g,e,!0))}else if(r.colSpan>1)for(let e=h+1,t=h+r.colSpan;e<t;e++)vs(m,e,g,{colSpan:h-e},!0),g.rows[m]&&g.rows[m].cells&&g.rows[m].cells[e]&&(delete g.rows[m].cells[e].value,delete g.rows[m].cells[e].formula);else if(r.rowSpan>1)for(let e=m+1,t=m+r.rowSpan;e<t;e++)vs(e,h,g,{rowSpan:m-e},!0),g.rows[e]&&g.rows[e].cells&&g.rows[e].cells[h]&&(delete g.rows[e].cells[h].value,delete g.rows[e].cells[h].formula);if(!n&&Ys(g,m)){m++;continue}if(!n&&ir(g,h)){h++;continue}if(!n&&s&&s.length){if(m>=t&&m<s[0]){m++;continue}if(h>=a&&h<s[1]){h++;continue}}if(r.style){const e={};Object.assign(e,r.style),r.style=e}d.set(i.address,r)}h++}m++,f++,i&&!Object.keys(o).length&&(f--,d.pop())}return d})})())})}function Os(e,t,i,n,s){const r=Cs(t,i,s);if(r){if(r.format){const s={value:e.getDisplayText(r),rowIndex:t,colIndex:i,sheetIndex:n,dateObj:"",isDate:!1,isTime:!1};return e.notify("checkDateFormat",s),s.isDate?s.dateObj:r.value}return r.value}return""}function Rs(e,t,i){let n,s,a=0,o=e.length;for(let l=0;l<o;l++){if(Object(r.Z)(e[l])||Object(r.cb)(e[l].index)||(s=a=e[l].index-l,delete e[l].index),a>0){for(n=0;a--;)t?(i.createSheet(l+n),n++):e.splice(l,0,null);l+=s,o+=s}if(t){e[l].id<1&&(e[l].id=Ns(i.sheets),e[l].properties&&(e[l].properties.id=e[l].id)),e[l].name||i.setSheetPropertyOnMute(e[l],"name","Sheet"+Ps(i));let t=0;e[l].rows.forEach(e=>{t=Math.max(t,e&&e.cells&&e.cells.length-1||0)}),i.setSheetPropertyOnMute(e[l],"usedRange",{rowIndex:e[l].rows.length?e[l].rows.length-1:0,colIndex:t})}}}var As=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ks=(()=>{class e extends r.e{setProperties(e,t){if(this.parentObj.isComplexArraySetter&&this.controlParent&&this.controlParent.isAngular)if(Object.keys(e).length){void 0===this.parentObj.currRangeIdx?this.parentObj.currRangeIdx=0:this.parentObj.currRangeIdx+=1;const e=this.parentObj.ranges[this.parentObj.currRangeIdx];e&&e.info&&(this.info=e.info),setTimeout(()=>{void 0!==this.parentObj.currRangeIdx&&delete this.parentObj.currRangeIdx})}else if(this.controlParent.tagObjects[0].instance&&this.controlParent.tagObjects[0].instance.hasChanges&&!this.controlParent.tagObjects[0].instance.isInitChanges){const e=this.controlParent.sheets.indexOf(this.parentObj);if(void 0===this.parentObj.changedRangeIdx){let t;const i=this.controlParent.tagObjects[0].instance.list[e].tagObjects;for(let e=0;e<i.length;e++)if("ranges"===i[e].name){i[e].instance.list.forEach((e,i)=>{e.hasChanges&&(t=i)});break}this.parentObj.changedRangeIdx=t}}super.setProperties(e,t)}}return As([Object(r.t)(null)],e.prototype,"dataSource",void 0),As([Object(r.t)("A1")],e.prototype,"startCell",void 0),As([Object(r.t)(null)],e.prototype,"query",void 0),As([Object(r.t)(!0)],e.prototype,"showFieldAsHeader",void 0),As([Object(r.t)("")],e.prototype,"template",void 0),As([Object(r.t)("A1")],e.prototype,"address",void 0),e})(),Es=(()=>{class e extends r.e{}return As([Object(r.t)(null)],e.prototype,"rows",void 0),As([Object(r.t)([])],e.prototype,"columns",void 0),As([Object(r.g)({},as)],e.prototype,"protectSettings",void 0),As([Object(r.f)([],ks)],e.prototype,"ranges",void 0),As([Object(r.f)([],ls)],e.prototype,"conditionalFormats",void 0),As([Object(r.t)(0)],e.prototype,"index",void 0),As([Object(r.t)("")],e.prototype,"name",void 0),As([Object(r.t)(100)],e.prototype,"rowCount",void 0),As([Object(r.t)(100)],e.prototype,"colCount",void 0),As([Object(r.t)("A1:A1")],e.prototype,"selectedRange",void 0),As([Object(r.t)("A1")],e.prototype,"activeCell",void 0),As([Object(r.t)({})],e.prototype,"usedRange",void 0),As([Object(r.t)("A1")],e.prototype,"topLeftCell",void 0),As([Object(r.t)(!0)],e.prototype,"showHeaders",void 0),As([Object(r.t)(!0)],e.prototype,"showGridLines",void 0),As([Object(r.t)(!1)],e.prototype,"isProtected",void 0),As([Object(r.t)("Visible")],e.prototype,"state",void 0),As([Object(r.t)(0)],e.prototype,"frozenRows",void 0),As([Object(r.t)(0)],e.prototype,"frozenColumns",void 0),As([Object(r.t)("A1")],e.prototype,"paneTopLeftCell",void 0),e})();function Ls(e,t){let i;for(let n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){i=n;break}return i}function Ts(e,t){let i;for(let n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){i=n;break}return i}function js(e){return e.split("!")[0].replace(/\'/gi,"")}function Ds(e,t,i){const n=i.length;for(let s=0;s<n;s++)if(i[s].sheet.toUpperCase()===t.toUpperCase())return i[s].index;return-1}function Ms(e,t,i={},n){e.setSheetPropertyOnMute(i,"selectedRange",n?i.selectedRange+" "+t:t)}function Fs(e,t){return e.sheets[t]}function Ps(e){const t=[];e.sheets.forEach(e=>{t.push(e.name.toLowerCase())});for(let i=0;i<t.length;i++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function Ns(e){let t=0;return e.forEach(e=>{t=Math.max(e.id,t)}),t+1}function Bs(e,t){const i=t||e.sheets;i.forEach(t=>{if(t.id=t.id||0,t.name=t.name||"",t.rowCount=Object(r.cb)(t.rowCount)?100:t.rowCount,t.colCount=Object(r.cb)(t.colCount)?100:t.colCount,t.topLeftCell=t.topLeftCell||"A1",t.activeCell=t.activeCell||"A1",t.selectedRange=t.selectedRange||"A1:A1",t.usedRange=t.usedRange||{rowIndex:0,colIndex:0},e.setSheetPropertyOnMute(t,"ranges",t.ranges?t.ranges:[]),e.setSheetPropertyOnMute(t,"rows",t.rows&&Object(r.L)([],t.rows,null,!0)||[]),e.setSheetPropertyOnMute(t,"columns",t.columns||[]),t.showHeaders=!!Object(r.cb)(t.showHeaders)||t.showHeaders,t.showGridLines=!!Object(r.cb)(t.showGridLines)||t.showGridLines,t.state=t.state||"Visible",t.maxHgts=[],t.protectSettings=t.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},t.isProtected=t.isProtected||!1,!t.paneTopLeftCell||"A1"===t.paneTopLeftCell){t.frozenRows=t.frozenRows?t.frozenRows:0,t.frozenColumns=t.frozenColumns?t.frozenColumns:0;const i=Bi(t.topLeftCell);e.setSheetPropertyOnMute(t,"paneTopLeftCell",_i(t.frozenRows?i[0]+t.frozenRows:i[0],t.frozenColumns?i[1]+t.frozenColumns:i[1]))}var i;Rs(t.columns),(i=t.rows).forEach(e=>{e&&e.cells&&Rs(e.cells)}),Rs(i)}),Rs(i,!0,e)}function Hs(e,t=e.activeSheetIndex){return Fs(e,t).name}function _s(e,t,i,n){const s=!!i;i=i||[e.activeSheetIndex];const r={action:"moveSheet",position:t=function(e,t,i){for(let n=t;i?n>=0:n<e.length;i?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:i,cancel:!1};n&&e.trigger("actionBegin",r),r.cancel||(i.forEach((i,n)=>{e.sheets.splice(t+n,0,e.sheets.splice(i+(t>i?-1*n:0),1)[0])}),e.setProperties({activeSheetIndex:t>i[0]?t-(i.length-1):t},!0),e.notify("moveOrDuplicateSheet",{refresh:s}),n&&(delete r.cancel,e.trigger("actionComplete",r)))}function zs(e,t,i){const n={action:"duplicateSheet",sheetIndex:t=Object(r.cb)(t)?e.activeSheetIndex:t,cancel:!1};if(i&&e.trigger("actionBegin",n),!n.cancel){const s=Fs(e,t),a=Object(r.L)({},s.properties?s.properties:s,!0);a.id=Ns(e.sheets);let o=a.name;/^\(\d+\)$/.test("("+o.split(" (")[1])&&(o=o.split(" (")[0]);const l=[];e.sheets.forEach(e=>{l.push(e.name)});for(let e=2;;e++)if(-1===l.indexOf(o+" ("+e+")")){a.name=o+" ("+e+")";break}e.createSheet(t+1,[a]),e.notify(an,{action:"addSheet",sheetName:"Sheet"+a.id,visibleName:a.name}),e.setProperties({activeSheetIndex:t+1},!0),e.notify("moveOrDuplicateSheet",{refresh:!0,isDuplicate:!0}),i&&(delete n.cancel,e.trigger("actionComplete",n))}}class Vs{constructor(){this.services={}}getService(e){if(Object(r.Z)(this.services[e]))throw`The service ${e} is not registered`;return this.services[e]}register(e,t){Object(r.Z)(this.services[e])&&(this.services[e]=t)}}var Us,qs=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let Ws=(()=>{let e=Us=class extends r.h{constructor(e){super(e),this.isEdit=!1,this.sheetNameCount=1,this.isOpen=!1,this.chartColl=[],this.chartCount=1,Us.Inject(gn,On,In,cn,Zn,Gn,zn,Vn,Yn,Un,Xn,Jn,Kn,Qn,es,ts,qn,Wn),this.commonCellStyle={},e&&e.cellStyle&&(this.commonCellStyle=e.cellStyle),"workbook"===this.getModuleName()&&(this.serviceLocator=new Vs,this.initWorkbookServices(),this.dataBind(),this.initEmptySheet())}preRender(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=Ss(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()}initWorkbookServices(){this.serviceLocator.register(ys,new r.q(this.getModuleName(),xs,this.locale))}render(){}requiredModules(){return is(this)}getPersistData(){return this.addOnPersist([])}cellFormat(e,t){const i=this.getActiveSheet();this.notify(sn,{style:e,range:t=t||i.selectedRange,refreshRibbon:t.indexOf(i.activeCell)>-1})}lockCells(e,t){const i=this.getActiveSheet();this.notify("setLockCells",{range:e=e||i.selectedRange,isLocked:t})}getCellStyleValue(e,t){const i=Cs(t[0],t[1],this.getActiveSheet()),n={};return e.forEach(e=>{n[e]=this.cellStyle[e],i&&i.style&&i.style[e]&&(n[e]=i.style[e])}),n}numberFormat(e,t){this.notify("applyNumber",{format:e,range:t})}createSheet(e=this.sheets.length,t=[{}]){this.sheets.splice(e,0,...t),Bs(this,t),this.notify("sheetCreated",{sheetIndex:e||0,sheets:t}),this.notify(an,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})}removeSheet(e){this.sheets.splice(e,1)}destroy(){this.notify("workbookDestroyed",null),super.destroy()}onPropertyChanged(e,t){for(const i of Object.keys(e))switch(i){case"cellStyle":Object(r.gb)(this.commonCellStyle,e.cellStyle);break;case"sheets":e.sheets===this.sheets?(this.notify(an,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify("sheetsDestroyed",{}),Bs(this),this.notify("sheetCreated",null),this.notify(an,{action:"registerSheet"})):Bs(this)}}appendTo(e){super.appendTo(e)}hideRow(e,t=e,i=!0){const n=this.getActiveSheet();if(!i||!n.frozenRows&&!n.frozenColumns)for(let s=e;s<=t;s++)Gs(n,s,{hidden:i})}hideColumn(e,t=e,i=!0){const n=this.getActiveSheet();if(!n.frozenRows&&!n.frozenColumns)for(let s=e;s<=t;s++)Qs(n,s,{hidden:i})}setBorder(e,t,i){this.notify(sn,{style:e,borderType:i,range:t||this.getActiveSheet().selectedRange})}insertRow(e,t,i){this.notify("insertModel",{model:this.getSheetModel(i),start:e,end:t,modelType:"Row"})}insertColumn(e,t,i){this.notify("insertModel",{model:this.getSheetModel(i),start:e,end:t,modelType:"Column"})}insertSheet(e,t){this.notify("insertModel",{model:this,start:e,end:t,modelType:"Sheet"})}delete(e,t,i,n){let s;if(e=e||0,i&&"Sheet"!==i){if(s=this.getSheetModel(n),!s)return}else s=this;this.notify("deleteModel",{model:s,start:e,end:Object(r.Z)(t)?e:t,modelType:i||"Sheet"})}moveSheet(e,t){_s(this,e,t)}duplicateSheet(e){zs(this,e)}getSheetModel(e){if(Object(r.Z)(e))return this.getActiveSheet();{const t="string"==typeof e?Ls(this,e):e;return Object(r.Z)(t)||t>=this.sheets.length?null:this.sheets[t]}}merge(e,t){let i,n;e?(i=this.getAddressInfo(e).sheetIndex,n=Fs(this,i)):(n=this.getActiveSheet(),e=n.selectedRange),this.notify(ln,{merge:!0,range:e,type:t||"All",sheet:n,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==i})}computeExpression(e){const t={action:"computeExpression",formula:e};return this.notify(an,t),t.calcValue}initEmptySheet(){this.sheets.length?Bs(this):this.createSheet()}getActiveSheet(){return this.sheets[this.activeSheetIndex]}skipHiddenSheets(e,t,i=0){return this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++i)),i===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e}setUsedRange(e,t,i=this.getActiveSheet()){e>i.usedRange.rowIndex&&(i.usedRange.rowIndex=e,i===this.getActiveSheet()&&this.notify("updateUsedRange",{index:e,update:"row"})),t>i.usedRange.colIndex&&(i.usedRange.colIndex=t,i===this.getActiveSheet()&&this.notify("updateUsedRange",{index:t,update:"col"}))}getData(e){return Is(this,e)}getModuleName(){return"workbook"}getValueRowCol(e,t,i,n,s){const a={action:"getSheetInfo",sheetInfo:[]};if(this.notify(an,a),-1===Ds(0,"Sheet"+e,a.sheetInfo)){const e={action:"getReferenceError",refError:""};return this.notify(an,e),e.refError}let o=Ts(this,e);const l=Fs(this,o),h=Cs(t-1,i-1,l);if(n&&n.includes("!")&&!h&&l.ranges&&l.ranges.length){let e;if(this.formulaRefCell&&this.formulaRefCell===n)return h&&h.value;if(l.ranges.forEach(t=>{t.info&&t.info.loadedRange&&t.info.loadedRange.length||(e=!0)}),e){if(this.formulaRefCell=n,o=Ts(this,Number(n.substring(n.lastIndexOf(",")+1,n.length))),Object(r.Z)(o))return h&&h.value;n=n.substring(n.lastIndexOf("!")+1,n.lastIndexOf(",")),Is(this,`${l.name}!A1:${_i(t-1,i-1)}`,null,null,null,null,n,o)}}else h&&h.formula&&(s||Object(r.Z)(h.value))&&-1===h.formula.indexOf("UNIQUE")&&this.notify("calculateFormula",{cell:h,rowIdx:t-1,colIdx:i-1,sheetIndex:o});return h&&h.value}setValueRowCol(e,t,i,n){this.notify("workbookEditOperation",{action:"updateCellValue",address:[i-1,n-1],value:t,sheetIndex:Ts(this,e),isValueOnly:!0})}open(e){this.notify("workbookOpen",e)}openFromJson(e){this.isOpen=!0;const t="object"==typeof e.file?JSON.stringify(e.file):e.file;this.notify("workbookOpen",{jsonObject:t})}save(e={}){if(this.allowSave){const t=Object.assign({},{url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1});this.trigger("beforeSave",t),this.notify(vn,{eventArgs:t,action:"beforeSave"}),t.cancel||this.notify("beginSave",{saveSettings:t,isFullPost:t.isFullPost,needBlobData:t.needBlobData,customParams:t.customParams})}}saveAsJson(){return new Promise(e=>{this.on("onSave",t=>{t.cancel=!0,this.off("onSave"),e({jsonObject:{Workbook:t.jsonObject}}),this.notify("saveCompleted",t)}),this.save()})}addHyperlink(e,t){this.notify("setLinkModel",{hyperlink:e,cell:t})}findHandler(e){"next"===e.findOpt?this.notify("findNext",e):"prev"===e.findOpt&&this.notify("findPrevious",e)}replaceHandler(e){this.notify("replace"===e.replaceBy?"replace":"replaceAll",e)}protectSheet(e,t){this.notify("protectsheetHandler",t)}unprotectSheet(e){this.notify("unprotectsheetHandler",{sheet:e})}sort(e,t){if(!this.allowSorting)return Promise.reject();const i={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise((e,t)=>{e(void 0)})};return this.notify("initiateSort",i),i.promise}addDataValidation(e,t){const i={range:t=t||this.getActiveSheet().selectedRange,type:e.type,operator:e.operator,value1:e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown,cancel:!1};this.notify(vn,{eventArgs:i,action:"validation"}),i.cancel||(t=i.range,e.type=i.type,e.operator=i.operator,e.value1=i.value1,e.value2=i.value2,e.ignoreBlank=i.ignoreBlank,e.inCellDropDown=i.inCellDropDown,this.notify("setValidation",{rules:e,range:t}),delete i.cancel,this.notify(Cn,{eventArgs:i,action:"validation"}))}removeDataValidation(e){this.notify("removeValidation",{range:e})}addInvalidHighlight(e){this.notify("addHighlight",{range:e})}removeInvalidHighlight(e){this.notify("removeHighlight",{range:e})}conditionalFormat(e){e.range=e.range||this.getActiveSheet().selectedRange,this.notify("setCFRule",{conditionalFormat:e})}clearConditionalFormat(e){e=e||this.getActiveSheet().selectedRange,this.notify("clearCFRule",{range:e})}updateCell(e,t){let i;const n=Ui(t);t.includes("!")?(i=Ls(this,t.split("!")[0]),void 0===i&&(i=this.activeSheetIndex)):i=this.activeSheetIndex,vs(n[0],n[1],this.sheets[i],e,!0),(e.value||""===e.value)&&this.notify("workbookEditOperation",{action:"updateCellValue",address:n,value:e.value,sheetIndex:i}),this.notify("updateView",{indexes:n,sheetIndex:i})}getRowData(e,t){Object(r.Z)(e)&&(e=0),Object(r.Z)(t)&&(t=this.activeSheetIndex);const i={sheetIdx:t,startIndex:e,modelType:"Row",isDataRequest:!0};return this.notify("dataChanged",i),i.data}wrap(e,t=!0){ws(e,t,this)}addDefinedName(e){const t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(an,t),t.isAdded}removeDefinedName(e,t=""){const i={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(an,i),i.isRemoved}clearRange(e,t,i=!0){!function(e,t,i,n){const s=Fs(e,i),a=Ui(t);let o=a[0];const l=a[2];let h,c,d;for(;o<=l;o++)for(h=a[1],c=a[3];h<=c;h++){const t={cellIdx:[o,h],isUnique:!1,uniqueRange:""};e.notify("checkUniqueRange",t);let i=!1;if(""!==t.uniqueRange){const e=Ui(t.uniqueRange);i="#SPILL!"===Cs(e[0],e[1],s).value}if(!t.isUnique||i){const t=Cs(o,h,s);d=t&&t.value,e.notify("cFDelete",{rowIdx:o,colIdx:h}),!Object(r.Z)(t)&&n&&(delete t.value,Object(r.Z)(t.formula)||delete t.formula,Object(r.Z)(t.hyperlink)||delete t.hyperlink),Object(r.Z)(d)||""===d||e.notify(an,{action:"refreshCalculate",rowIndex:o,colIndex:h})}}}(this,e||this.getActiveSheet().selectedRange,Object(r.Z)(t)?this.activeSheetIndex:t,i)}insertImage(e,t){this.notify("setImage",{options:e,range:t||this.getActiveSheet().selectedRange})}insertChart(e){this.notify("setChart",{chart:e})}deleteChart(e){this.notify("deleteChart",{id:e})}filter(e,t){if(!this.allowFiltering)return Promise.reject();const i={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise((e,t)=>{e(void 0)})};return this.notify("initiateFilter",i),i.promise}clearFilter(){this.notify("clearAllFilter",null)}addCustomFunction(e,t){t=t||("string"==typeof e?e:e.name.replace("bound ","")),this.notify(an,{action:"addCustomFunction",functionHandler:e,functionName:t})}clear(e){this.notify("clear",e)}getDisplayText(e){if(!e)return"";if(e.format&&!Object(r.Z)(e.value)){const t={formattedText:e.value,value:e.value,format:e.format,onLoad:!0};return this.notify("getFormattedCell",t),t.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value||"number"==typeof e.value?e.value.toString():""}freezePanes(e=1,t=1,i){const n=this.getSheetModel(i);n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.name===this.getActiveSheet().name&&this.notify("dataRefresh",null))}Unfreeze(e){this.freezePanes(0,0,e)}updateTopLeftCell(e,t,i,n){n||(n=this.getActiveSheet());const s=Bi(n.topLeftCell);n.frozenRows||n.frozenColumns?(Object(r.Z)(e)&&(e=n.frozenRows?0:s[0]),Object(r.Z)(t)&&(t=n.frozenColumns?0:s[1]),e+=this.frozenRowCount(n),t+=this.frozenColCount(n),i&&("row"===i?e=Bi(n.paneTopLeftCell)[0]:t=Bi(n.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",_i(e,t)),n.frozenRows&&(e=s[0]),n.frozenColumns&&(t=s[1])):(Object(r.Z)(e)&&(e=s[0]),Object(r.Z)(t)&&(t=s[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",_i(e,t))),this.setSheetPropertyOnMute(n,"topLeftCell",_i(e,t))}getAddressInfo(e){return function(e,t){let i;return i=t.indexOf("!")>-1?Ls(e,js(t)):e.activeSheetIndex,{sheetIndex:i,indices:Ui(t)}}(this,e)}setSheetPropertyOnMute(e,t,i){this.isProtectedOnChange=!0,e[t]=i,this.isProtectedOnChange=!1}frozenRowCount(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:Bi(e.topLeftCell)[0]+e.frozenRows:0}frozenColCount(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:Bi(e.topLeftCell)[1]+e.frozenColumns:0}};return qs([Object(r.f)([],Es)],e.prototype,"sheets",void 0),qs([Object(r.t)(0)],e.prototype,"activeSheetIndex",void 0),qs([Object(r.t)("100%")],e.prototype,"height",void 0),qs([Object(r.t)(!0)],e.prototype,"allowFindAndReplace",void 0),qs([Object(r.t)()],e.prototype,"filterCollection",void 0),qs([Object(r.t)()],e.prototype,"sortCollection",void 0),qs([Object(r.t)("100%")],e.prototype,"width",void 0),qs([Object(r.t)(!0)],e.prototype,"showRibbon",void 0),qs([Object(r.t)(!0)],e.prototype,"showFormulaBar",void 0),qs([Object(r.t)(!0)],e.prototype,"showSheetTabs",void 0),qs([Object(r.t)(!0)],e.prototype,"allowEditing",void 0),qs([Object(r.t)(!0)],e.prototype,"allowOpen",void 0),qs([Object(r.t)(!0)],e.prototype,"allowSave",void 0),qs([Object(r.t)(!0)],e.prototype,"allowSorting",void 0),qs([Object(r.t)(!0)],e.prototype,"allowFiltering",void 0),qs([Object(r.t)(!0)],e.prototype,"allowNumberFormatting",void 0),qs([Object(r.t)(!0)],e.prototype,"allowCellFormatting",void 0),qs([Object(r.t)(!0)],e.prototype,"allowHyperlink",void 0),qs([Object(r.t)(!0)],e.prototype,"allowInsert",void 0),qs([Object(r.t)(!0)],e.prototype,"allowDelete",void 0),qs([Object(r.t)(!0)],e.prototype,"allowMerge",void 0),qs([Object(r.t)(!0)],e.prototype,"allowDataValidation",void 0),qs([Object(r.t)(!0)],e.prototype,"allowImage",void 0),qs([Object(r.t)(!0)],e.prototype,"allowChart",void 0),qs([Object(r.t)(!0)],e.prototype,"allowConditionalFormat",void 0),qs([Object(r.g)({},ss)],e.prototype,"cellStyle",void 0),qs([Object(r.t)("")],e.prototype,"openUrl",void 0),qs([Object(r.t)("")],e.prototype,"saveUrl",void 0),qs([Object(r.t)("")],e.prototype,"password",void 0),qs([Object(r.t)(!1)],e.prototype,"isProtected",void 0),qs([Object(r.f)([],rs)],e.prototype,"definedNames",void 0),qs([Object(r.k)()],e.prototype,"beforeOpen",void 0),qs([Object(r.k)()],e.prototype,"openFailure",void 0),qs([Object(r.k)()],e.prototype,"beforeSave",void 0),qs([Object(r.k)()],e.prototype,"saveComplete",void 0),qs([Object(r.k)()],e.prototype,"beforeCellFormat",void 0),qs([Object(r.k)()],e.prototype,"queryCellInfo",void 0),e=Us=qs([r.r],e),e})();function Zs(e,t){return e.rows[t]}function Gs(e,t,i){e.rows[t]||(e.rows[t]={}),Object.keys(i).forEach(n=>{e.rows[t][n]=i[n]})}function Ys(e,t){return e.rows[t]&&e.rows[t].hidden}function Xs(e,t,i){let n;if(e&&e.rows&&e.rows[t]){if(e.rows[t].hidden)return 0;n=void 0===e.rows[t].height?20:e.rows[t].height}else n=20;if(i&&window.devicePixelRatio%1>0){const e=n*window.devicePixelRatio%1;return n+(e?(e>.5?1-e:-1*e)/window.devicePixelRatio:0)}return n}function $s(e,t,i){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=i)}function Ks(e,t,i=t,n){let s,r=0;t>i&&(s=t,t=i,i=s);for(let a=t;a<=i;a++)r+=Xs(e,a,n);return r}function Js(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function Qs(e,t,i){const n=Js(e,t);Object.keys(i).forEach(e=>{n[e]=i[e]})}function er(e,t,i,n){let s;if(e&&e.columns&&e.columns[t]){if(!i&&e.columns[t].hidden)return 0;s=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else s=64;if(n&&window.devicePixelRatio%1>0){const e=s*window.devicePixelRatio%1;return s+(e?(e>.5?1-e:-1*e)/window.devicePixelRatio:0)}return s}function tr(e,t,i=t,n){let s=0;if(t>i){const e=t;t=i,i=e}for(let r=t;r<=i;r++)s+=er(e,r,null,n);return s}function ir(e,t){return e.columns[t]&&e.columns[t].hidden}function nr(e){requestAnimationFrame(()=>{e()})}function sr(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function rr(e){let t=30;return e.toString().length>3&&(t=10*e.toString().length),t}let ar=null;function or(){if(null!==ar)return ar;const e=document.createElement("div");let t=0;return e.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth|0,document.body.removeChild(e),ar=t}const lr=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"];function hr(e,t=lr){return cr(e,"previous",t)+cr(e,"next",t)}function cr(e,t,i){let n=e[t+"ElementSibling"],s=0;for(;n;)i.some(e=>n.classList.contains(e))&&(s+=n.offsetHeight),n=n[t+"ElementSibling"];return s}function dr(e,t,i){if(e.scrollSettings.enableVirtualization){const n=e.viewport.topIndex,s=e.viewport.leftIndex,r=n+e.viewport.rowCount+2*e.getThreshold("row"),a=s+e.viewport.colCount+2*e.getThreshold("col"),o=e.getActiveSheet();let l;if(o.frozenRows||o.frozenColumns)return e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]);if(l=n<=t[0]&&r>=t[2]&&s<=t[1]&&a>=t[3],l)return!0;if(i){if(t[0]<n&&t[2]<n||t[0]>r&&t[2]>r)return!1;if(t[0]<n&&t[2]>n&&(t[0]=n,l=!0),t[2]>r&&(t[2]=r,l=!0),t[1]<s&&t[3]<s||t[1]>a&&t[3]>a)return!1;t[1]<s&&t[3]>s&&(t[1]=s,l=!0),t[3]>a&&(t[3]=a,l=!0)}return l}return!0}function pr(e,t,i,n,s,r,a){let o;let l=0,h=0;for(o=0;o<t[0];o++)i&&i-1<t[0]&&o<i||(l+=Xs(e,o,!0));for(o=0;o<t[1];o++)n&&n-1<t[1]&&o<n||(h+=er(e,o,null,!0));return i&&t[0]<i&&(e.showHeaders&&(l+=30),s&&(l-=s)),n&&t[1]<n&&(e.showHeaders&&(h+=a||30),r&&(h-=r)),{top:l,left:h}}function gr(e,t,i,n="e-selection"){const s=e.getActiveSheet();if(s.frozenRows||s.frozenColumns){let a;const o=e.frozenRowCount(s),l=e.frozenColCount(s);if("e-active-cell"===n){if(i[0]<o||i[1]<l){t.style.display="none",a=i[0]<o&&i[1]<l?e.getSelectAllContent():i[0]<o?e.getColumnHeaderContent():e.getRowHeaderContent();let r=a.querySelector("."+n);r||(r=t.cloneNode(!0),a.appendChild(r)),mr(t=r,i,s,e.enableRtl,o,l,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth)}else mr(t,i,s,e.enableRtl,o,l);t.style.display&&(t.style.display=""),ur(e.getSelectAllContent(),a,!0),ur(e.getColumnHeaderContent(),a,!0),ur(e.getRowHeaderContent(),a,!0)}else{const h=Wi(i);if(h[0]<o||h[1]<l){t.classList.add("e-hide");const c=[];let d;h[0]<o&&h[1]<l?h[2]<o&&h[3]<l?(c.push(i),ur(e.getColumnHeaderContent(),a,!1),ur(e.getRowHeaderContent(),a,!1)):h[2]>o-1?h[3]<l?(ur(e.getColumnHeaderContent(),a,!1),c.push([h[0],h[1],o-1,h[3]]),c.push([o,h[1],h[2],h[3]])):(c.push([h[0],h[1],o-1,l-1]),c.push([o,h[1],h[2],l-1]),c.push([h[0],l,o-1,h[3]]),c.push([o,l,h[2],h[3]])):h[2]<o?(c.push([h[0],h[1],h[2],l-1]),c.push([h[0],l,h[2],h[3]]),ur(e.getRowHeaderContent(),a,!1)):(c.push([o,h[1],h[2],l-1]),c.push([h[0],h[1],o-1,l-1]),c.push([o,l,h[2],h[3]]),c.push([h[0],l,o-1,h[3]])):h[0]<o?h[2]<o?c.push(i):(c.push([h[0],h[1],o-1,h[3]]),c.push([o,h[1],h[2],h[3]]),ur(e.getSelectAllContent(),a,!1),ur(e.getRowHeaderContent(),a,!1)):h[3]<l?c.push(i):(c.push([h[0],h[1],h[2],l-1]),c.push([h[0],l,h[2],h[3]]),ur(e.getSelectAllContent(),a,!1),ur(e.getColumnHeaderContent(),a,!1)),c.forEach(i=>{let h;a=i[2]<o&&i[3]<l?e.getSelectAllContent():i[2]<o?e.getColumnHeaderContent():i[3]<l?e.getRowHeaderContent():e.getMainContent(),"e-copy-indicator"===n||"e-range-indicator"===n?(h=t.cloneNode(!0),a.appendChild(h),o&&(i[2]+1===o&&c.forEach(e=>{e!==i&&(d=h.getElementsByClassName("e-bottom")[0],d&&e[0]===o&&Object(r.J)(d))}),i[0]===o&&a.parentElement.classList.contains("e-main-panel")&&c.forEach(e=>{e!==i&&(d=h.getElementsByClassName("e-top")[0],d&&e[2]+1===o&&Object(r.J)(d))})),l&&(i[3]+1===l&&c.forEach(e=>{e!==i&&(d=h.getElementsByClassName("e-right")[0],d&&e[1]===l&&Object(r.J)(d))}),i[1]===l&&(a.classList.contains("e-sheet-content")||a.classList.contains("e-column-header"))&&c.forEach(e=>{e!==i&&(d=h.getElementsByClassName("e-left")[0],d&&e[3]+1===l&&Object(r.J)(d))}))):(h=a.querySelector("."+n),h||(h=t.cloneNode(!0),a.appendChild(h))),mr(h,i,s,e.enableRtl,o,l,!1,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth),h.classList.contains("e-hide")&&h.classList.remove("e-hide")})}else ur(e.getSelectAllContent(),null,!1),ur(e.getColumnHeaderContent(),null,!1),ur(e.getRowHeaderContent(),null,!1),mr(t,i,s,e.enableRtl,o,l),"e-range-indicator"!==n&&e.getMainContent().querySelector("."+n)||e.getMainContent().appendChild(t)}}else mr(t,i,s,e.enableRtl,0,0),t&&!e.getMainContent().querySelector("."+n)&&e.getMainContent().appendChild(t)}function ur(e,t,i){let n;i?e!==t&&(n=e.querySelector(".e-active-cell"),n&&Object(r.J)(n)):(n=e.querySelector(".e-selection"),n&&Object(r.J)(n))}function mr(e,t,i,n,s,a,o,l,h,c){const d=Wi(t),p=pr(i,d,s,a,l,h,c),g=[Vr(i,0,!0),Vr(i,0,!0,"columns")],u=Ks(i,t[0],t[2],!0),m=tr(i,t[1],t[3],!0),f={top:(d[0]===g[0]?p.top:p.top-Rr(1))+"px",height:u&&u+(d[0]===g[0]?0:Rr(1))+"px",width:m&&m+(d[1]===g[1]?0:Rr(1))+(o&&a&&d[1]<a&&d[3]>=a?1:0)+"px"};var b;f[n?"right":"left"]=(d[1]===g[1]?p.left:p.left-1)+"px",e&&(b=[{element:e,attrs:f}],requestAnimationFrame(()=>{b.forEach(e=>{Object(r.rb)(e.element,e.attrs)})}))}function fr(){return r.d.isPointer?"pointerdown":"mousedown touchstart"}function br(){return r.d.isPointer?"pointermove":"mousemove touchmove"}function yr(){return r.d.isPointer?"pointerup":"mouseup touchend"}function xr(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function Cr(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function vr(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function Sr(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function wr(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function Ir(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function Or(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function Rr(e,t){if(window.devicePixelRatio%1>0){const i=e*window.devicePixelRatio%1;return e+(i?(i>.5||t?1-i:-1*i)/window.devicePixelRatio:0)}return e}const Ar={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"};function kr(e,t){Object.keys(t).forEach(i=>{e&&e.setAttribute(Ar[i],t[i])})}function Er(e,t,i,n,s){let r,a,o,l,h,c,d,p,g;const u=s.getActiveSheet(),m=s.frozenRowCount(u),f=s.frozenColCount(u);if(n){const i=e<f?s.getSelectAllContent():s.getColumnHeaderContent();r=i.getElementsByTagName("th")[t],a=i.getElementsByTagName("col")[t],o=(e<f?s.getRowHeaderContent():s.getMainContent()).getElementsByTagName("col")[t]}else{let n;if(r=a=m||f?s.getRow(e,null,f-1):s.getRow(e,s.getRowHeaderTable()),a.style.height=parseInt(i,10)>0?Rr(parseInt(i,10))+"px":"2px",o=s.getRow(e,null,f),o.style.height=parseInt(i,10)>0?Rr(parseInt(i,10))+"px":"0px",u.showHeaders){const e=s.getRowHeaderContent().getElementsByClassName("e-row"),i=[];i[0]=e[t].getElementsByTagName("td")[0].cloneNode(!0),n=Tr(s.getRowHeaderTable(),i,!1,s)+1}const l=s.getMainContent().getElementsByClassName("e-row"),h=[];for(let e=0;e<l[t].getElementsByTagName("td").length;e++)h[e]=l[t].getElementsByTagName("td")[e].cloneNode(!0);const c=Tr(s.getContentTable(),h,!1,s)+1,d=n>=c?n:c;parseInt(o.style.height,10)<d||r&&r.classList.contains("e-reach-fntsize")&&parseInt(o.style.height,10)===d?(u.showHeaders&&(r.classList.add("e-reach-fntsize"),a.style.lineHeight=parseInt(i,10)>=4?parseInt(i,10)-4+"px":parseInt(i,10)>0?parseInt(i,10)-1+"px":"0px"),o.style.lineHeight=parseInt(i,10)>0?parseInt(i,10)-1+"px":"0px"):(a&&a.style.removeProperty("line-height"),o.style.removeProperty("line-height"),r&&r.classList.contains("e-reach-fntsize")&&r.classList.remove("e-reach-fntsize"))}if(c=o.previousElementSibling,g=o.nextElementSibling,c&&(u.showHeaders&&(l=r.previousElementSibling,h=a.previousElementSibling),c=o.previousElementSibling),g&&(u.showHeaders&&(d=r.nextElementSibling,p=a.nextElementSibling),g=o.nextElementSibling),parseInt(i,10)<=0&&!o.classList.contains("e-zero")&&!o.classList.contains("e-zero-start")){if(c&&g)if(n?(u.showHeaders&&(a.style.width="2px"),o.style.width="0px"):(u.showHeaders&&(a.style.height="2px"),o.style.height="0px"),c.classList.contains("e-zero-start")?(u.showHeaders&&r.classList.add("e-zero-start"),o.classList.add("e-zero-start")):(u.showHeaders&&r.classList.add("e-zero"),o.classList.add("e-zero")),!d||d.classList.contains("e-zero")||d.classList.contains("e-zero-last")||(u.showHeaders&&r.classList.add("e-zero-last"),o.classList.add("e-zero-last")),c.classList.contains("e-zero-last")&&(u.showHeaders&&l.classList.remove("e-zero-last"),c.classList.remove("e-zero-last")),u.showHeaders&&l.classList.contains("e-zero")?(r.classList.contains("e-zero-end"),Lr(h,-2,n)):u.showHeaders&&Lr(h,-1,n),u.showHeaders&&l.classList.contains("e-zero-start")&&Lr(a,-1,n),u.showHeaders&&d.classList.contains("e-zero"))if(r.classList.contains("e-zero-start"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(p.style.height,10)&&!n||0!==parseInt(p.style.width,10)&&n){n?(a.style.width=parseInt(a.style.width,10)-1+"px",p.style.width=parseInt(p.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",p.style.height=parseInt(p.style.height,10)-1+"px"),d.classList.remove("e-zero"),d.classList.add("e-zero-start");break}{let e;d.classList.remove("e-zero"),d.classList.add("e-zero-start"),n?(e=parseInt(d.getAttribute("aria-colindex"),10)-1,d=s.getColHeaderTable().getElementsByTagName("th")[e+1],p=s.getColHeaderTable().getElementsByTagName("col")[e+1]):(e=parseInt(d.getAttribute("aria-rowindex"),10)-1,d=s.getRowHeaderTable().getElementsByTagName("tr")[e+1],p=s.getRowHeaderTable().getElementsByTagName("tr")[e+1])}}else Lr(a,-2,n);else u.showHeaders&&(d.classList.contains("e-zero-end")?n?a.style.width="0px":a.style.height="0px":Lr(p,-1,n));else if(c)n?(u.showHeaders&&(a.style.width="1px"),o.style.width="0px"):(u.showHeaders&&(a.style.height="1px"),o.style.height="0px"),u.showHeaders&&r.classList.add("e-zero-end"),o.classList.add("e-zero-end"),u.showHeaders&&r.classList.add("e-zero-last"),o.classList.add("e-zero-last"),u.showHeaders&&l.classList.contains("e-zero")?Lr(h,-2,n):Lr(h,-1,n);else if(d)if(r.classList.add("e-zero-start"),o.classList.add("e-zero-start"),d.classList.contains("e-zero")||(r.classList.add("e-zero-last"),o.classList.add("e-zero-last")),n?(a.style.width="1px",o.style.width="0px"):(a.style.height="1px",o.style.height="0px"),u.showHeaders&&d.classList.contains("e-zero"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(p.style.width,10)&&n||0!==parseInt(p.style.height,10)&&!n){n?(p.style.width=parseInt(p.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(p.style.height=parseInt(p.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)-1+"px"),d.classList.add("e-zero-start"),d.classList.remove("e-zero");break}{let e;d.classList.add("e-zero-start"),d.classList.remove("e-zero"),n?(e=parseInt(d.getAttribute("aria-colindex"),10)-1,p=s.getColHeaderTable().getElementsByTagName("col")[e+1],d=s.getColHeaderTable().getElementsByTagName("th")[e+1]):(e=parseInt(d.getAttribute("aria-rowindex"),10)-1,p=s.getRowHeaderTable().getElementsByTagName("tr")[e+1],d=s.getRowHeaderTable().getElementsByTagName("tr")[e+1])}}else u.showHeaders&&Lr(p,-1,n)}else if(parseInt(i,10)>0){const e=Rr(parseInt(i,10))+"px";n?(a.style.width=e,o.style.width=e):(a.style.height=e,o.style.height=e),u.showHeaders&&l&&d?(l.classList.contains("e-zero")?r.classList.contains("e-zero")?n?(h.style.width=parseInt(h.style.width,10)+2+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+2+"px",a.style.height=parseInt(a.style.height,10)-1+"px"):Lr(a,-1,n):r.classList.contains("e-zero")?Lr(h,1,n):r.classList.contains("e-zero-start")&&(n?(h.style.width=parseInt(h.style.width,10)+1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+1+"px",a.style.height=parseInt(a.style.height,10)-1+"px")),d.classList.contains("e-zero")?Lr(a,-1,n):(r.classList.contains("e-zero")||r.classList.contains("e-zero-start"))&&Lr(p,1,n),r.classList.contains("e-zero")&&r.classList.remove("e-zero"),r.classList.contains("e-zero-start")&&r.classList.remove("e-zero-start"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),r.classList.contains("e-zero-last")&&r.classList.remove("e-zero-last"),o.classList.contains("e-zero-last")&&o.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),c.classList.add("e-zero-last"))):u.showHeaders&&l?(l.classList.contains("e-zero")?r.classList.contains("e-zero")?n?(a.style.width=parseInt(a.style.width,10)-1+"px",h.style.width=parseInt(h.style.width,10)+2+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",h.style.height=parseInt(h.style.height,10)+2+"px"):Lr(a,-1,n):r.classList.contains("e-zero")?Lr(h,1,n):Lr(a,-1,n),r.classList.contains("e-zero")&&r.classList.remove("e-zero"),r.classList.contains("e-zero-end")&&r.classList.remove("e-zero-end"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-end")&&o.classList.remove("e-zero-end")):u.showHeaders&&d&&(d.classList.contains("e-zero")?Lr(a,-1,n):r.classList.contains("e-zero-start")&&(Lr(p,1,n),r.classList.remove("e-zero-start")),r.classList.contains("e-zero")&&r.classList.remove("e-zero"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),r.classList.contains("e-zero-start")&&r.classList.remove("e-zero-start"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"))}}function Lr(e,t,i){i?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function Tr(e,t,i,n,s,r){const a=n.createElement("div",{className:n.element.className,styles:"display: block"}),o=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),l=n.createElement("tr");let h,c;i?t.forEach(e=>{const t=l.cloneNode();t.appendChild(e),o.appendChild(t)}):(t.forEach(e=>{l.appendChild(e.cloneNode(!0))}),o.appendChild(l)),a.appendChild(o),document.body.appendChild(a);const d=o.getBoundingClientRect().width,p=o.getBoundingClientRect().height;return r?(h=i&&parseInt(s,10)>d?d:parseInt(s,10),c=!i&&parseInt(s,10)>p?p:parseInt(s,10)):(c=p,h=d),document.body.removeChild(a),i?Math.ceil(h):Math.ceil(c)}function jr(e,t,i,n){const s=e.eventArgs;let a,o,l,h,c,d,p,g,u;switch(e.action){case"sorting":l={range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},h=new Promise((e,t)=>{e(void 0)}),c={args:l,promise:h},t.notify("initiateSort",c),c.promise.then(e=>{t.serviceLocator.getService("cell").refreshRange(Ui(e.range))});break;case"cellSave":d=e.eventArgs,p=s.formula?i?{value:d.formula}:{formula:d.formula}:{value:d.value},t.updateCell(p,d.address);break;case"cellDelete":t.clearRange(e.eventArgs.address,null,!0),t.serviceLocator.getService("cell").refreshRange(Ni(e.eventArgs.address));break;case"format":if("CellFormat"===s.requestType)if(s.style&&s.style.border&&!Object(r.Z)(s.borderType)){const e={};Object.assign(e,s.style,null,!0),s.style.border=void 0,t.cellFormat(s.style,s.range),s.style.border=e.border,t.setBorder(s.style,s.range,s.borderType),s.style=e}else t.cellFormat(s.style,s.range);else t.numberFormat(s.format,s.range);break;case"clipboard":if(s.copiedInfo.isCut&&!i)return;g=s.copiedInfo.isCut?t.cut(s.copiedRange):t.copy(s.copiedRange),g.then(()=>{t.paste(s.pastedRange,s.type)});break;case"gridLines":t.setSheetPropertyOnMute(t.sheets[s.sheetIdx],"showGridLines",s.isShow);break;case"headers":t.setSheetPropertyOnMute(t.sheets[s.sheetIdx],"showHeaders",s.isShow);break;case"resize":case"resizeToFit":s.isCol?void 0===s.hide?t.setColWidth(s.width,s.index,s.sheetIdx):t.hideColumn(s.index,s.index,s.hide):void 0===s.hide?t.setRowHeight(s.height,s.index,s.sheetIdx+1):t.hideRow(s.index,s.index,s.hide);break;case"renameSheet":t.setSheetPropertyOnMute(t.sheets[s.index-1],"name",s.value);break;case"removeSheet":t.notify("removeSheetTab",{index:s.index,isAction:!0,count:s.sheetCount,clicked:!0});break;case"wrap":ws(e.eventArgs.address,e.eventArgs.wrap,t);break;case"hideShow":s.isCol?t.hideColumn(s.startIndex,s.endIndex,s.hide):t.hideRow(s.startIndex,s.endIndex,s.hide);break;case"replace":t.updateCell({value:s.compareVal},s.address);break;case"filter":t.notify("initiateFilterUI",!1===i?{predicates:s.previousPredicates,range:s.range,sIdx:s.index,isCut:!0,isUndoRedo:!0}:{predicates:s.predicates,range:s.range,sIdx:s.index,isCut:!0,isUndoRedo:!0});break;case"insert":!1===i?t.delete(e.eventArgs.index,e.eventArgs.index+(e.eventArgs.model.length-1),e.eventArgs.modelType,e.eventArgs.sheet.name):t.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?t:e.eventArgs.sheet,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,isAction:!1,checkCount:e.eventArgs.sheetCount,activeSheetIndex:e.eventArgs.activeSheetIndex});break;case"delete":!1===i?t.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?t:e.eventArgs.sheet,start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,isAction:!1,columnCellsModel:e.eventArgs.deletedCellsModel,definedNames:e.eventArgs.definedNames}):t.delete(e.eventArgs.startIndex,e.eventArgs.endIndex,e.eventArgs.modelType,e.eventArgs.sheet.name);break;case"validation":i?t.notify("setValidation",{rules:{type:s.type,operator:s.operator,value1:s.value1,value2:s.value2,ignoreBlank:s.ignoreBlank,inCellDropDown:s.inCellDropDown},range:s.range}):t.notify("removeValidation",{range:s.range});break;case"merge":e.eventArgs.isAction=!1,u=[];for(let e=0,t=s.model.length;e<t;e++){u.push({cells:[]});for(let t=0,i=s.model[e].cells.length;t<i;t++)u[e].cells[t]={},Object.assign(u[e].cells[t],s.model[e].cells[t])}t.notify(ln,e.eventArgs),s.model=u;break;case"clear":t.notify("clearViewer",{options:e.eventArgs,isPublic:!0});break;case"conditionalFormat":if(i)t.notify("setCFRule",{conditionalFormat:{type:s.type,cFColor:s.cFColor,value:s.value,range:s.range},sheetIdx:s.sheetIdx,isUndoRedo:!0});else{t.notify("clearCFRule",{range:s.range,sheetIdx:s.sheetIdx,isUndoRedo:!0});for(let e=0;e<n.length;e++)"conditionalFormat"===n[e].action&&t.notify("cFUndo",{conditionalFormat:{type:n[e].eventArgs.type,cFColor:n[e].eventArgs.cFColor,value:n[e].eventArgs.value,range:n[e].eventArgs.range},sheetIdx:n[e].eventArgs.sheetIdx})}break;case"clearCF":i?t.notify("clearCFRule",{range:s.selectedRange,sheetIdx:s.sheetIdx,isClearCF:!0,isUndoRedo:!0}):t.notify("clearCells",{conditionalFormats:s.cFormats,oldRange:s.oldRange,selectedRange:s.selectedRange});break;case"insertImage":i?t.notify("createImageElement",{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0}):t.notify("deleteImage",{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range});break;case"imageRefresh":o=document.getElementById(e.eventArgs.id),i?(e.eventArgs.isUndoRedo=!0,t.notify("refreshImgCellObj",e.eventArgs)):t.notify("refreshImgCellObj",{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}),o.style.height=i?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",o.style.width=i?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",o.style.top=i?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",o.style.left=i?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px";break;case"insertChart":i?t.notify("setChart",{chart:[{type:s.type,theme:s.theme,isSeriesInRows:s.isSeriesInRows,range:s.range,id:s.id,height:s.height,width:s.width}],isInitCell:s.isInitCell,isUndoRedo:!1,range:s.posRange}):t.notify("deleteChart",{id:s.id,isUndoRedo:!0});break;case"deleteChart":i?t.notify("deleteChart",{id:s.id}):t.notify("setChart",{chart:[{type:s.type,theme:s.theme,isSeriesInRows:s.isSeriesInRows,range:s.range,id:s.id,height:s.height,width:s.width,top:s.top,left:s.left}],isInitCell:s.isInitCell,isUndoRedo:!1,range:s.posRange});break;case"chartRefresh":a=document.getElementById(e.eventArgs.id),a&&(a.style.height=i?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",a.style.width=i?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",a.style.top=i?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",a.style.left=i?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px"),i?(e.eventArgs.isUndoRedo=!0,t.notify("refreshChartSize",{height:a.style.height,width:a.style.width,overlayEle:a})):t.notify("refreshChartSize",{height:a.style.height,width:a.style.width,overlayEle:a})}}function Dr(e,t,i,n){const s=e.sheets[n].ranges;let r;for(let a=0,o=s.length;a<o;a++)if(s[a].template&&(r=Ni(s[a].address.length?s[a].address:s[a].startCell),r[0]<=t&&r[1]<=i&&r[2]>=t&&r[3]>=i))return!0;return!1}function Mr(e,t,i,n,s,r,a=!0){const o=Xs(t,n,!0),l=e.frozenColCount(t),h=Rr(i);(s=s||(t.frozenRows?e.getRow(n,null,l):e.getRow(n)))&&(s.style.height=`${h}px`),(r=r||(t.frozenColumns?e.getRow(n,null,l-1):e.getRow(n,e.getRowHeaderTable())))&&(r.style.height=`${h}px`),$s(t,n,i),e.setProperties({sheets:e.sheets},!0),a&&e.notify("rowHeightChanged",{rowIdx:n,threshold:h-o})}function Fr(e,t,i=1){const n=t&&t.fontSize||e.cellStyle.fontSize,s=(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*function(e){let t=1.24;return e&&("Arial Black"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}(t)*i;return Math.ceil(s%1>.9?s+1:s)}function Pr(e,t,i){t||(t=i);const n=document.createElement("canvas").getContext("2d");return n.font=(t.fontStyle||i.fontStyle)+" "+(t.fontWeight||i.fontWeight)+" "+(t.fontSize||i.fontSize)+" "+(t.fontFamily||i.fontFamily),Rr(n.measureText(e).width,!0)}function Nr(e,t,i,n){let s,r=0;const a=e.toString().split(" "),o=Pr(" ",i,n);let l,h=0;return a.forEach(e=>{let c=0,d=0;s=Pr(e,i,n),a[a.length-1]!==e&&(s+=o),l=(r+s)/t,l>=1?(r&&h++,s/t>=1?(e.split("").forEach(e=>{d=Pr(e,i,n),c+=d,c>t&&(h++,c=d)}),r=c+o):r=s):r+=s}),r&&(h+=Math.ceil((r-o)/t)),h}function Br(e,t,i,n=i){return tr(e,i,n,!0)-Rr(4+function(e,t,i){let n=0;const s=Cs(e,t,i,null,!0),r=Cs(e,t+1,i,null,!0);return s.style&&(s.style.border?n=(0===t?2:1)*parseFloat(s.style.border.split("px")[0]):(0===t&&s.style.borderLeft&&(n=parseFloat(s.style.borderLeft.split("px")[0])),s.style.borderRight&&(n+=parseFloat(s.style.borderRight.split("px")[0])))),s.style&&(s.style.border||s.style.borderRight)||!r.style||!r.style.borderLeft||(n+=parseFloat(r.style.borderLeft.split("px")[0])),n}(t,i,e))}function Hr(e,t,i,n,s,r){return Fr(e,s,r)+(function(e,t,i){let n=0;const s=Cs(e,t,i,null,!0),r=Cs(e+1,t,i,null,!0);return s.style&&(s.style.border?n=(0===e?2:1)*parseFloat(s.style.border.split("px")[0]):(0===e&&s.style.borderTop&&(n=parseFloat(s.style.borderTop.split("px")[0])),s.style.borderBottom&&(n+=parseFloat(s.style.borderBottom.split("px")[0])))),s.style&&(s.style.border||s.style.borderBottom)||!r.style||!r.style.borderTop||(n+=parseFloat(r.style.borderTop.split("px")[0])),n}(t,i,n)||1)}function _r(e,t,i,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][i]=n}function zr(e,t){let i=0;const n=e.maxHgts[t];return n&&Object.keys(n).forEach(e=>{n[e]>i&&(i=n[e])}),i}function Vr(e,t,i,n="rows"){return t<0&&(t=-1),e[n][t]&&e[n][t].hidden&&(i?t++:t--,t=Vr(e,t,i,n)),t}function Ur(e){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(r.d.isIE){const t=window.scrollX,i=window.scrollY;e.focus(),window.scrollTo(t,i)}else e.focus({preventScroll:!0})}function qr(e,t){const i=e.getActiveSheet();let n;const s=Object(r.Z)(t)?Wi(Ni(i.selectedRange)):t;for(let r=s[0];r<=s[2];r++)for(let e=s[1];e<=s[3];e++)if(us(Cs(r,e,i),Js(i,e))){n=!0;break}return n}class Wr{constructor(e){this.parent=e,this.init(),this.addEventListener()}init(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))}addEventListener(){const e=this.getClipboardEle();this.parent.on("cut",this.cut,this),this.parent.on("copy",this.copy,this),this.parent.on(yn,this.paste,this),this.parent.on("clearCopy",this.clearCopiedInfo,this),this.parent.on("tabSwitch",this.tabSwitchHandler,this),this.parent.on(bn,this.cMenuBeforeOpenHandler,this),this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("contentLoaded",this.initCopyIndicator,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),this.parent.on("refreshClipboard",this.refreshOnInsertDelete,this),r.l.add(e,"cut",this.cut,this),r.l.add(e,"copy",this.copy,this),r.l.add(e,"paste",this.paste,this)}removeEventListener(){const e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off("cut",this.cut),this.parent.off("copy",this.copy),this.parent.off(yn,this.paste),this.parent.off("clearCopy",this.clearCopiedInfo),this.parent.off("tabSwitch",this.tabSwitchHandler),this.parent.off(bn,this.cMenuBeforeOpenHandler),this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("contentLoaded",this.initCopyIndicator),this.parent.off("rowHeightChanged",this.rowHeightChanged),this.parent.off("refreshClipboard",this.refreshOnInsertDelete)),r.l.remove(e,"cut",this.cut),r.l.remove(e,"copy",this.copy),r.l.remove(e,"paste",this.paste)}ribbonClickHandler(e){const t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({isAction:!0});break;case t+"_copy":this.copy({isAction:!0})}Ur(this.parent.element)}tabSwitchHandler(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()}cMenuBeforeOpenHandler(e){const t=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Da);let n=[],s=[],r=[],a=[];const o=Bi(t.activeCell),l=Cs(o[0],o[1],t),h=t.isProtected&&us(l,Js(t,o[1]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target||(this.parent.enableContextMenuItems([i.getConstant("Paste"),i.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!h)),this.parent.enableContextMenuItems([i.getConstant("Cut")],!h)),"Content"===e.target&&h&&this.parent.enableContextMenuItems([i.getConstant("Cut"),i.getConstant("Filter"),i.getConstant("Sort")],!1),"Content"===e.target&&h&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([i.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&t.isProtected&&(r=[i.getConstant("DeleteColumn"),i.getConstant("DeleteColumns"),i.getConstant("InsertColumn"),i.getConstant("InsertColumns")],a=[i.getConstant("HideColumn"),i.getConstant("HideColumns"),i.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(r,!1),this.parent.enableContextMenuItems(a,!!t.protectSettings.formatColumns)),"RowHeader"===e.target&&t.isProtected&&(n=[i.getConstant("DeleteRow"),i.getConstant("DeleteRows"),i.getConstant("InsertRow"),i.getConstant("InsertRows")],s=[i.getConstant("HideRow"),i.getConstant("HideRows"),i.getConstant("UnHideRows")],this.parent.enableContextMenuItems(n,!1),this.parent.enableContextMenuItems(s,!!t.protectSettings.formatRows))}rowHeightChanged(e){if(this.copiedInfo&&this.copiedInfo.range[0]>e.rowIdx){const t=this.parent.element.getElementsByClassName("e-copy-indicator")[0];t&&(t.style.top=`${parseInt(t.style.top,10)+e.threshold}px`)}}cut(e){this.setCopiedInfo(e,!0)}copy(e){this.setCopiedInfo(e,!1)}paste(e){if(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dialog").length>0)return;let t;e.isAction=!0;let i=e&&e.clipboardData||window.clipboardData;const n=this.getCopiedIdx();let s;const a=Object.assign({isExternal:i},this.copiedInfo);if(i||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){const o=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,l=Fs(this.parent,o);let h=Wi(e&&e.range||Ni(l.selectedRange));const c=i&&this.getExternalCells(e);if(!e.isInternal&&c&&c.internal&&(i=!1,!this.copiedInfo))return;if(i&&!c.length)return;let d=0;if(c)for(let e=0;e<c.length;e++)d=c[e].cells.length>d?c[e].cells.length:d;let p=h[0],g=i?[0,0,c.length-1,d-1]:Wi(this.copiedShapeInfo?Ni(l.selectedRange):this.copiedInfo.range),u=(h[2]-h[0]+1)%(g[2]-g[0]+1)==0&&(h[3]-h[1]+1)%(g[3]-g[1]+1)==0;t=u?h:[h[0],h[1]].concat([h[0]+g[2]-g[0],h[1]+g[3]-g[1]||h[1]]);const m={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:zi(g),pastedRange:zi(t),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.parent.notify(vn,{eventArgs:m,action:"clipboard"}),m.cancel)return;let f,b,y;const x=[],C=Fs(this.parent,i?o:n),v=Gi(g)&&this.isRangeMerged(h,l);h=Ni(m.pastedRange),p=h[0],g=i?[0,0,c.length-1,d-1]:Wi(this.copiedShapeInfo?Ni(l.selectedRange):this.copiedInfo.range),u=(h[2]-h[0]+1)%(g[2]-g[0]+1)==0&&(h[3]-h[1]+1)%(g[3]-g[1]+1)==0&&!v;let S={range:g,prevSheet:C,cancel:!1};if(t=u?h:[h[0],h[1]].concat([h[0]+g[2]-g[0],h[1]+g[3]-g[1]||h[1]]),this.parent.getActiveSheet().isProtected&&qr(this.parent,t))return void this.parent.notify("editAlert",null);if(this.copiedShapeInfo&&!this.copiedInfo){const t=this.copiedShapeInfo.pictureElem;t.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify("setChart",{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||l.selectedRange,isIdAvailabe:!1})):this.parent.notify("createImageElement",{options:{src:t.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?t.id:""},range:zi([p,h[1],p,h[1]]),isPublic:!1,isUndoRedo:!0});const i=Cs(p,h[1],l);if(i&&!Object(r.Z)(i.image)){const e=i.image?i.image.length-1:0,t={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:Hs(this.parent)+"!"+zi([p,h[1],p,h[1]]),pastedPictureElement:document.getElementById(i.image[e].id)};this.parent.notify(Cn,{eventArgs:t,action:"clipboard"})}}else{if(this.parent.notify("pasteMerge",S),S.cancel)return;const d=m.type?m.type:e.type,w=[],I=this.isInRange(g,h,n),O=0===h[1]&&h[3]===l.colCount-1;for(let t=g[0],s=0;t<=g[2];t++,s++){I&&(w[h[0]+s]={cells:[]});for(let m=g[1],R=0;m<=g[3];m++,R++){if(I&&(w[h[0]+s].cells[h[1]+R]=Cs(h[0]+s,h[1]+R,C)),f=i?c[t].cells[m]:Object(r.L)({},I&&w[t]&&w[t].cells[m]?w[t].cells[m]:Cs(t,m,C),null,!0),f&&e&&e.type||d){switch(d){case"Formats":f={format:f.format,style:f.style};break;case"Values":f={value:f.value},f.value&&f.value.toString().indexOf("\n")>-1&&this.parent.getCell(h[0],h[1]).classList.add("e-alt-unwrap")}b=["Formats","Values"].indexOf(e.type)>-1}if(!this.parent.scrollSettings.isFinite&&(g[2]-g[0]>1048575-h[0]||g[3]-g[1]>16383-h[1])||this.parent.scrollSettings.isFinite&&(g[2]-g[0]>l.rowCount-1-h[0]||g[3]-g[1]>l.colCount-1-h[1]))return void this.showDialog();const A=this.getConditionalFormats(t,m,C);if(u)for(let e=h[0];e<=h[2];e+=g[2]-g[0]+1){let n=!1;if(!a.isCut&&this.parent.filteredRows&&this.parent.filteredRows.rowIdxColl&&this.parent.filteredRows.sheetIdxColl)for(let t=0,i=this.parent.filteredRows.sheetIdxColl.length;t<i;t++)if(this.parent.filteredRows.sheetIdxColl[t]===o&&this.parent.filteredRows.rowIdxColl[t]===e+s){n=!0;break}if(!n)for(let a=h[1];a<=h[3];a+=g[3]-g[1]+1){if(y=Cs(e+s,a+R,l)||{},!i&&(void 0!==y.colSpan||void 0!==y.rowSpan)){if(O)continue;S={range:[e+s,a+R,e+s,a+R]};const t={range:S.range,merge:!1,isAction:!1,type:"All"};x.push(t),this.parent.activeSheetIndex===l.index&&this.parent.notify(ln,t)}const n=a+R;if(f=Object(r.L)({},f||{},null,!0),!b){const i=fs([e+s,n],[t,m],C);Object(r.Z)(i)||(f.formula=i)}this.setConditionalFormats(A,e+s,n,l),this.parent.getActiveSheet().isProtected&&f&&(Object(r.Z)(f.isLocked)||!0===f.isLocked)&&(f.isLocked=y.isLocked),this.setCell(e+s,n,l,f,b,!1,!!A.length||a===h[3],i);const o=this.parent.activeSheetIndex,c=this.parent.getCell(e+s,n),d=_i(e+s,n),p={address:this.parent.sheets[o].name+"!"+d,requestType:"paste",value:Cs(e+s,n,l)?Cs(e+s,n,l).value:"",oldValue:y.value,element:c,displayText:this.parent.getDisplayText(f)};this.parent.trigger("cellSave",p)}}else!i&&Dr(this.parent,t,m,n)||(v?this.setCell(p,h[1]+R,l,{value:f.value},!0,!1,m===g[3]):this.setCell(p,h[1]+R,l,f,b,!1,m===g[3]));if(!i&&this.copiedInfo.isCut&&(!ps(h,t,m)||n!==this.parent.activeSheetIndex)){let e=Cs(t,m,C);e&&(e.isLocked||Object(r.Z)(e.isLocked)?e=null:!1===e.isLocked&&(e=this.parent.getActiveSheet().isProtected?{isLocked:!1}:null)),this.setCell(t,m,C,e,!1,!0,m===g[3])}}p++}if(this.parent.notify("refreshRibbonIcons",null),this.parent.setUsedRange(t[2],t[3]),o===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{address:zi(t)}),!i&&this.copiedInfo.isCut&&(s=this.copiedInfo.isCut,n===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(g),this.clearCopiedInfo()),(i||I)&&this.copiedInfo&&this.clearCopiedInfo(),(i||e&&e.isAction)&&Ur(this.parent.element),e.isAction){const e=a&&a.sId?Ts(this.parent,a.sId):this.parent.activeSheetIndex,i={requestType:"paste",copiedInfo:a,mergeCollection:x,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:this.parent.sheets[e].name+"!"+zi(a&&a.range?a.range:Ni(this.parent.sheets[e].selectedRange)),pastedRange:Hs(this.parent)+"!"+zi(t),type:d||"All"};this.parent.notify(Cn,{eventArgs:i,action:"clipboard"})}if(s){this.updateFilter(a,t),_r(C,g[0],g[1],this.parent.getCell(g[0],g[1]).offsetHeight);const e=zr(C,g[0]);Mr(this.parent,C,e,g[0])}const R=Fs(this.parent,n);if(!i&&g[0]===g[2]&&g[3]-g[1]==R.colCount-1){const e=R.rows[g[0]].height;for(let t=h[0];t<=h[2];t++)Mr(this.parent,this.parent.getActiveSheet(),e,t);s&&Mr(this.parent,R,20,g[0])}}}else this.getClipboardEle().select()}getConditionalFormats(e,t,i){let n=[];if(i.conditionalFormats)for(let s=0;s<i.conditionalFormats.length;s++)ps(Ni(i.conditionalFormats[s].range),e,t)&&n.push(Object(r.L)({},i.conditionalFormats[s]));return n}setConditionalFormats(e,t,i,n){for(let s=0;s<e.length;s++)n.conditionalFormats.push(Object(r.L)({},e[s].properties||e[s],{range:zi([t,i])}))}isRangeMerged(e,t){const i=Cs(e[0],e[1],t);if(i&&(i.colSpan>1||i.rowSpan>1)){const t={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(hn,t),t.range[0]===e[0]&&t.range[1]===e[1]&&t.range[2]===e[2]&&t.range[3]===e[3]}return!1}updateFilter(e,t){let i,n;this.parent.notify("getFilteredCollection",null);for(let o=0;o<this.parent.sheets.length;o++)if(this.parent.filterCollection&&this.parent.filterCollection[o]&&this.parent.filterCollection[o].sheetIndex===Ts(this.parent,e.sId)){let t=e.range;const s=Ni(this.parent.filterCollection[o].filterRange);t=Wi(t),s[0]===t[0]&&s[2]===t[2]&&s[1]===t[1]&&s[3]===t[3]&&(i=!0,n=[Math.abs(t[0]-s[0]),Math.abs(t[1]-s[1]),Math.abs(t[2]-s[2]),Math.abs(t[3]-s[3])])}let s=this.parent.getCell(e.range[0],e.range[1]);s=s?s.querySelector(".e-filter-icon")?s:this.parent.getCell(e.range[2],e.range[3]):s;const r=s?s.querySelector(".e-sortasc-filter"):s,a=s?s.querySelector(".e-sortdesc-filter"):s;if(i)for(let o=0;o<this.parent.filterCollection.length;o++){const i=this.parent.filterCollection[o],s=e&&e.sId?Ts(this.parent,e.sId):this.parent.activeSheetIndex;if(i.sheetIndex===s&&this.parent.notify("initiateFilterUI",{predicates:null,range:i.filterRange,sIdx:s,isCut:!0}),i.sheetIndex===s&&s===this.parent.activeSheetIndex&&(n=[t[0]+n[0],t[1]+n[1],Math.abs(t[2]-n[2]),Math.abs(t[3]-n[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:zi(n),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){const e=this.parent.getCell(t[0],t[1]);r&&e&&e.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),a&&e&&e.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}}isInRange(e,t,i){const n=this.parent.activeSheetIndex;return ps(e,t[0],t[1])&&i===n||ps(e,t[2],t[3])&&i===n}setCell(e,t,i,n,s,r,a,o){const l=i?Ts(this.parent,i.id):null;if(vs(e,t,i,n,s),n&&n.formula&&this.parent.notify(an,{action:"refreshCalculate",value:r?"":n.formula,rowIndex:e,colIndex:t,sheetIndex:this.parent.activeSheetIndex,isFormula:!0}),n&&!n.formula&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e,t,e,t],value:n.value,sheetIndex:l}),i.name===this.parent.getActiveSheet().name&&this.parent.serviceLocator.getService("cell").refresh(e,t,a),n&&n.style&&o){let s=Hr(this.parent,e,t,i,n.style||this.parent.cellStyle,n.wrap?Nr(this.parent.getDisplayText(n),Br(i,e,t),n.style,this.parent.cellStyle):1);s=Math.round(s),s<20&&(s=20),_r(i,e,t,s);const r=Ks(i,e),a=zr(i,e);a>r&&Mr(this.parent,i,a,e)}}getCopiedIdx(){if(this.copiedInfo){for(let e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1}setCopiedInfo(e,t){if(this.parent.isEdit)return;const i=new a.d;e.promise=i.promise;const n=this.parent.getActiveSheet();let s;if(e&&e.range){const t={range:e.range};this.parent.notify("mergedRange",t),s=t.range}else s=Ni(n.selectedRange);const o={sheet:n,indexes:[0,0,n.rowCount-1,n.colCount-1],promise:new Promise((e,t)=>{e(void 0)})},l=document.getElementsByClassName("e-ss-overlay-active"),h=l.length;!n.isLocalData||e&&e.clipboardData||0!==s[0]||s[2]!==n.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",o)),o.promise.then(()=>{if(h>0){const i={clientY:l[0].offsetTop,isImage:!0};this.parent.notify("getRowIdxFromClientY",i);const s={clientX:l[0].offsetLeft,isImage:!0};this.parent.notify("getColIdxFromClientX",s),this.copiedShapeInfo={sId:e&&e.sId?e.sId:n.id,sheetIdx:n.index,isCut:t,pictureElem:l[0],copiedRange:zi([i.clientY,s.clientX,i.clientY,s.clientX]),height:l[0].offsetHeight,width:l[0].offsetWidth,chartInfo:this.getChartElemInfo(l[0])},this.hidePaste(!0),t&&(l[0].classList.contains("e-datavisualization-chart")?this.parent.deleteChart(this.copiedShapeInfo.chartInfo.id):this.parent.notify("deleteImage",{id:this.copiedShapeInfo.pictureElem.id,sheetIdx:this.copiedShapeInfo.sId,range:this.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(this.copiedInfo&&this.clearCopiedInfo(),this.copiedInfo={range:s,sId:e&&e.sId?e.sId:n.id,isCut:t},this.hidePaste(!0),this.initCopyIndicator(),r.d.isIE||this.getClipboardEle().select(),e&&e.isAction&&document.execCommand(t?"cut":"copy"),this.parent.hideSpinner());r.d.isIE&&this.setExternalCells(e),i.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e),Ur(this.parent.element))}getChartElemInfo(e){const t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart")){const i=e.getElementsByClassName("e-control")[0].id;for(let e=0;e<t.length;e++)if(t[e].id===i)return t[e]}return null}clearCopiedInfo(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())}removeIndicator(e){if(e){const t=e.querySelector(".e-copy-indicator");t&&Object(r.J)(t)}}initCopyIndicator(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){const e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),gr(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}}showDialog(){this.parent.serviceLocator.getService(Ma).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Da).getConstant("PasteAlert"),beforeOpen:e=>{const t={dialogName:"PasteDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}hidePaste(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify("enableToolbarItems",[{items:[this.parent.element.id+"_paste"],enable:e||!1}])}setExternalCells(e){let t,i="";const n=this.copiedInfo.range,s=this.parent.getActiveSheet();let a='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>';for(let o=n[0];o<=n[2];o++){a+="<tr>";for(let e=n[1];e<=n[3];e++){if(t=Cs(o,e,s),a+='<td style="white-space:'+(t&&t.wrap?"normal":"nowrap")+';vertical-align:bottom;"',t&&t.format&&"General"!==t.format&&(a+=t.format.includes('"')?" number-format='"+t.format+"'":' number-format="'+t.format+'"'),t&&t.style&&Object.keys(t.style).forEach(e=>{const i=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":i?e.replace(i[0],"-"+i[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?t.style[e].slice(0,7):t.style[e])+";"}),t&&!Object(r.Z)(t.value)){const e={formattedText:t.value,value:t.value,format:t.format,onLoad:!0};t.format&&"General"!==t.format&&(a+=t.value.toString().includes('"')?" cell-value='"+t.value+"'":' cell-value="'+t.value+'"',this.parent.notify("getFormattedCell",e)),a+=">",a+=e.formattedText,i+=e.formattedText,a+="</td>"}else a+="></td>";i+=e===n[3]?"":"\t"}a+="</tr>",i+=o===n[2]?"":"\n"}a+="</tbody></table></body></html>",r.d.isIE?window.clipboardData.setData("text",i):(e.clipboardData.setData("text/html",a),e.clipboardData.setData("text/plain",i),e.preventDefault())}getExternalCells(e){let t,i,n,s=[],a=[];const o=this.parent.createElement("span");if(r.d.isIE?i=window.clipboardData.getData("text"):(t=e.clipboardData.getData("text/html"),i=e.clipboardData.getData("text/plain"),o.innerHTML=t),o.querySelector("table"))if(o.querySelector(".e-spreadsheet")&&this.copiedInfo)s={internal:!0};else{let e,t=0;[].slice.call(o.querySelectorAll("tr")).forEach(i=>{s[t]||(s[t]={cells:[]}),a=s[t].cells,e=0,[].slice.call(i.querySelectorAll("td")).forEach(i=>{if(a[e]&&(e=this.getNewIndex(a,e)),a[e]={},n=this.getStyle(i,o),i.textContent=i.textContent.replace(/(\r\n|\n|\r)/gm,""),i.textContent=i.textContent.replace(/\s+/g," "),n.whiteSpace&&(a[e].wrap=!0,delete n.whiteSpace),Object.keys(n).length&&(n.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(e=>{n[e]=n.border}),delete n.border),a[e].style=n),i.textContent&&(a[e].value=nn(i.textContent.trim())),i.getAttribute("number-format")&&(a[e].format=i.getAttribute("number-format"),a[e].value&&i.getAttribute("cell-value")&&(a[e].value=nn(i.getAttribute("cell-value").trim()))),i.getAttribute("colspan")&&parseInt(i.getAttribute("colspan"),10)>1&&(a[e].colSpan=parseInt(i.getAttribute("colspan"),10)),i.getAttribute("rowspan")&&parseInt(i.getAttribute("rowspan"),10)>1&&(a[e].rowSpan=parseInt(i.getAttribute("rowspan"),10)),a[e].colSpan>1&&a[e].rowSpan>1){let i;for(let n=t,o=t+a[e].rowSpan;n<o;n++)for(let l=e,h=e+a[e].colSpan;l<h;l++)n===t&&l===e||(i=a[e].style?{style:Object(r.L)({},a[e].style)}:{},n!==t&&(i.rowSpan=t-n),l!==e&&(i.colSpan=e-l),s[n]||(s[n]={cells:[]}),s[n].cells[l]=i)}else if(a[e].colSpan>1)for(let t=e+1,s=e+a[e].colSpan;t<s;t++)a[t]={colSpan:e-t,style:Object(r.L)({},n)};else if(a[e].rowSpan>1)for(let o=t+1,l=t+a[e].rowSpan;o<l;o++)s[o]||(s[o]={cells:[]}),s[o].cells[e]={rowSpan:t-o,style:Object(r.L)({},n)};e++}),t++})}else if(i){let e,r;t&&(e=[].slice.call(o.children)),i.split("\n").forEach((i,l)=>{n=null,t&&(r=e.filter(e=>e.textContent&&e.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===i.trim())[0],r&&(n=this.getStyle(r,o),e.splice(e.indexOf(r),1))),i.trim().split("\t").forEach((e,t)=>{(e||n)&&(a[t]={},n&&(n.whiteSpace?(a[t].wrap=!0,delete n.whiteSpace,Object.keys(n).length&&(a[t].style=n)):a[t].style=n),e&&(hs(e)?a[t].formula=e:a[t].value=nn(e.trim())))}),s.push({cells:a}),a=[]})}return setTimeout(()=>{this.getClipboardEle().innerHTML=""},0),s}getNewIndex(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t}getStyle(e,t){const i=[],n={},s=Object.keys(this.parent.commonCellStyle);if(t.querySelector("style")&&e.classList.length&&t.querySelector("style").innerHTML.indexOf(e.classList[0])>-1){const n=t.querySelector("style").innerHTML.split(e.classList[0]);i.push(n[n.length-1].split("{")[1].split("}")[0])}const r=[].slice.call(e.querySelectorAll("*"));if(r.unshift(e),r.forEach(e=>{e.getAttribute("style")&&i.push(e.getAttribute("style")),"B"===e.tagName&&i.push("font-weight:bold")}),s.length&&t.querySelector("style")){let e=t.querySelector("style").innerHTML.includes("td")?t.querySelector("style").innerHTML.split("td")[1]:t.querySelector("style").innerHTML;e=e.includes("{")?e.split("{")[1].split("}")[0]:e.split("}")[0];for(let t=0;t<s.length;t++){let i=s[t];const r=i.match(/[A-Z]/);r&&(i=i.replace(r[0],"-"+r[0].toLowerCase())),e.indexOf(i)>-1&&(n[s[t]]=e.split(i+":")[1].split(";")[0])}}return i.forEach(e=>{e.split(";").forEach(e=>{let t=e.split(":")[0].trim();if(["font-family","vertical-align","text-align","text-indent","color","background","font-weight","font-style","font-size","text-decoration","border-bottom","border-top","border-right","border-left","border","white-space"].indexOf(t)>-1){t="background"===t?"backgroundColor":t;const i=t.match(/-[a-z]/),s=e.split(":")[1];n[i?t.replace(i[0],i[0].charAt(1).toUpperCase()):t]="font-weight"===t&&-1===["bold","normal"].indexOf(s)?s>"599"?"bold":"normal":s}})}),e.innerHTML.indexOf("<s>")>-1&&(n.textDecoration="line-through"),this.defaultCellStyle(n)}defaultCellStyle(e){let t=e.fontSize?e.fontSize.trim():null;return e.textDecoration&&["underline","line-through","underline line-through","none"].indexOf(e.textDecoration.trim())<0&&(e.textDecoration="none"),e.textAlign&&["left","center","right"].indexOf(e.textAlign.trim())<0&&(e.textAlign="left"),e.verticalAlign&&["bottom","middle","top"].indexOf(e.verticalAlign.trim())<0&&(e.verticalAlign="bottom"),t&&(t=t.indexOf("px")>-1?.75*parseFloat(t)+"pt":t,e.fontSize=Math.round(parseFloat(t))+"pt"),e}refreshOnInsertDelete(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;const t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){const i=e.end-e.start+1;t[1]+=i,t[3]+=i}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){const i=e.end-e.start+1;t[0]+=i,t[2]+=i}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}}performAction(){this.copiedInfo.isCut?this.parent.cut(zi(this.copiedInfo.range)):this.parent.copy(zi(this.copiedInfo.range))}getClipboardEle(){return this.parent.element.getElementsByClassName("e-clipboard")[0]}getModuleName(){return"clipboard"}destroy(){this.removeEventListener();const e=this.getClipboardEle();Object(r.J)(e),this.parent=null}}class Zr{constructor(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&"],this.formulaBarCurStartPos=null,this.curEndPos=null,this.curStartPos=null,this.selectionStart=null,this.selectionEnd=null,this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null,this.editorElem=null}addEventListener(){r.l.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on(mn,this.keyUpHandler,this),this.parent.on(fn,this.keyDownHandler,this),this.parent.on(un,this.performEditOperation,this),this.parent.on("initiateCur",this.initiateCurPosition,this),this.parent.on("editValue",this.updateFormulaBarValue,this),this.parent.on("addressHandle",this.addressHandler,this),this.parent.on("initiateEdit",this.initiateRefSelection,this),this.parent.on("forRefSelRender",this.refSelectionRender,this),this.parent.on("checkUniqueRange",this.checkUniqueRange,this),this.parent.on("reApplyFormula",this.reApplyFormula,this)}removeEventListener(){r.l.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off(mn,this.keyUpHandler),this.parent.off(fn,this.keyDownHandler),this.parent.off(un,this.performEditOperation),this.parent.off("initiateCur",this.initiateCurPosition),this.parent.off("editValue",this.updateFormulaBarValue),this.parent.off("addressHandle",this.addressHandler),this.parent.off("initiateEdit",this.initiateRefSelection),this.parent.off("forRefSelRender",this.refSelectionRender),this.parent.off("checkUniqueRange",this.checkUniqueRange),this.parent.off("reApplyFormula",this.reApplyFormula))}getModuleName(){return"edit"}performEditOperation(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){const t={isEdit:!1};this.parent.notify("isFormulaBarEdit",t),t.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}}keyUpHandler(e){if(this.isEdit){const t=this.getEditElement(this.parent.getActiveSheet());if(e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&this.refreshEditor(t.textContent,this.isCellEdit),hs(this.editCellData.value,!0)&&(!e||16!==e.keyCode)&&(this.updateFormulaReference(t),this.endFormulaRef)){const e=this.getCurPosition();e.end&&this.validCharacters.indexOf(this.editCellData.value[e.end-1])>-1&&(this.endFormulaRef=!1)}}}updateFormulaReference(e){const t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex})}keyDownHandler(e){const t=e.target,i=e.keyCode,n=this.parent.getActiveSheet(),s=Bi(n.activeCell),a=Cs(s[0],s[1],n)||{};if(!Object(r.D)(e.target,".e-findtool-dlg")&&!Object(r.D)(e.target,".e-validationerror-dlg")&&!Object(r.D)(e.target,".e-hyperlink-dlg"))if(n.isProtected&&!Object(r.D)(e.target,".e-sheet-rename")&&us(a,Js(n,s[1]))){if((i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET||i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER||i===this.keyCodes.DELETE||i===this.keyCodes.BACKSPACE||i===this.keyCodes.SPACE||i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD||i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND||i>=219&&i<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&i===this.keyCodes.F2)&&67!==i&&89!==i&&90!==i){if(n.protectSettings.insertLink&&75===i)return;this.parent.element.querySelector(".e-editAlert-dlg")||e.ctrlKey||70===e.keyCode||t.parentElement.classList.contains("e-unprotectpwd-content")||t.parentElement.classList.contains("e-password-content")||this.parent.notify("editAlert",null)}}else if(this.isEdit){const t=this.getEditElement(n),o=hs(this.editCellData.value,!0);if((this.isCellEdit||o&&this.editCellData.value!==t.textContent&&16!==e.keyCode)&&(s[1]<this.parent.frozenColCount(n)&&(!n.frozenRows||s[0]>=this.parent.frozenRowCount(n))&&t&&"auto"!==t.style.height&&Pr(t.textContent,a.style,this.parent.cellStyle)>parseInt(t.style.maxWidth,10)&&(t.style.height="auto"),Pr(t.textContent,a.style,this.parent.cellStyle)>parseInt(t.style.maxWidth,10)-5&&(t.style.height="auto"),s[0]<this.parent.frozenRowCount(n)&&t&&!t.style.overflow&&Pr(t.textContent,a.style,this.parent.cellStyle)>parseInt(t.style.maxWidth,10)&&(t.style.overflow="auto"),this.refreshEditor(t.textContent,this.isCellEdit)),!e.altKey)switch(i){case this.keyCodes.ENTER:if(r.d.isWindows&&e.preventDefault(),this.isAltEnter){const e=t.textContent;e&&e.indexOf("\n")>-1&&(ws(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(t.textContent,this.isCellEdit),this.isAltEnter=!1)}if(o){const t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.sheetIndex===n.id-1||this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e)}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(!this.isEdit&&(t.classList.contains("e-spreadsheet")||Object(r.D)(t,".e-sheet-panel"))){const t=i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET,s=i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER,a=i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD;let o=i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND;o||(o=i>=this.keyCodes.SYMBOLSETTWOSTART&&i<=this.keyCodes.SYMBOLSETTWOEND);const l=i===this.keyCodes.FIREFOXEQUALPLUS||i===this.keyCodes.FIREFOXMINUS,h=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&i===this.keyCodes.F2,c=i===this.keyCodes.BACKSPACE;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&i===this.keyCodes.SPACE||t||s||a||o||"mozilla"===r.d.info.name&&l)||h||c){h&&(this.isNewValueEdit=!1);const e=document.getElementsByClassName("e-ss-overlay-active");e.length>0?i===this.keyCodes.DELETE&&this.parent.notify("deleteImage",{id:e[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.startEdit(null,null,!0,!0)}i===this.keyCodes.DELETE&&(n.isProtected&&qr(this.parent)?this.parent.notify("editAlert",null):(this.editingHandler("delete"),this.parent.notify("activeCellChanged",null)))}}renderEditor(){if(!this.editorElem||!Object(r.ob)("#"+this.parent.element.id+"_edit",this.parent.element)){const e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit"});e.contentEditable="true",e.spellcheck=!1,this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove(),this.parent.element.querySelector(".e-sheet-content").appendChild(e),this.editorElem=e}this.parent.notify("formulaOperation",{action:"renderAutoComplete"})}refreshEditor(e,t,i,n,s=!0){n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e;const r=this.getEditElement(this.parent.getActiveSheet());i&&(r.textContent=e),t&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:e}),s&&this.editCellData.value===r.textContent&&this.triggerEvent("cellEditing")&&this.cancelEdit()}startEdit(e,t,i=!0,n){this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");const s=this.parent.getActiveSheet(),r=Bi(s.activeCell),a=Cs(r[0],r[1],s,!1,!0);if(Dr(this.parent,r[0],r[1],this.parent.activeSheetIndex)){const e=this.parent.getCell(r[0],r[1]);let t=!1;const i=e.innerHTML;if(e&&i.indexOf("<")>-1&&i.indexOf(">")>-1&&i.indexOf("input")>-1&&(t=!0),t)return}this.updateEditCellDetail(e,t),this.initiateEditor(i),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify("clearCopy",null),this.parent.notify("enableToolbarItems",[{enable:!1}]),a.formula&&!n&&this.parent.notify("initiateFormulaReference",{range:a.formula,formulaSheetIdx:this.editCellData.sheetIndex})}setCursorPosition(){const e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){const i=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),i.removeAllRanges(),i.addRange(n)}e.focus()}hasFormulaSuggSelected(){const e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0}editingHandler(e){const t=document.getElementsByClassName("e-ss-overlay-active"),i=t.length;let n;switch(e){case"delete":if(i>0)t[0].classList.contains("e-datavisualization-chart")?this.parent.notify("deleteChart",{id:t[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify("deleteImage",{id:t[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{const e=this.parent.getActiveSheet();let t=e.selectedRange,i=Ui(t);i=i[0]>i[2]?Wi(i):i,t=zi(i),this.parent.notify(vn,{action:"cellDelete",eventArgs:{address:e.name+"!"+t}}),this.parent.clearRange(t,null,!0),this.parent.serviceLocator.getService("cell").refreshRange(i),this.parent.notify("selectionComplete",{}),this.parent.notify(Cn,{action:"cellDelete",eventArgs:{address:e.name+"!"+t}});const s={cellIdx:i,isUnique:!1};if(this.checkUniqueRange(s),s.isUnique){const e=Ni(this.uniqueColl),t=Cs(e[0],e[1],this.parent.getActiveSheet());t&&(n=t.value.indexOf("#SPILL!")>-1)}if(s.isUnique&&this.uniqueColl.split(":")[0]===t.split(":")[0])this.updateUniqueRange(""),this.parent.notify("removeUniquecol",null),this.uniqueColl="";else if(s.isUnique){const t=Ni(this.uniqueColl);if("#SPILL!"===Cs(t[0],t[1],e).value){let i=!1;for(let n=t[0];n<=t[2];n++)for(let s=t[1];s<=t[3];s++){const a=Cs(n,s,e);n===t[0]&&s===t[1]?i=!1:Object(r.Z)(a.value)||""===a.value||(i=!0)}i||this.reApplyFormula()}}this.parent.notify(Cn,s.isUnique?{action:"cellDelete",eventArgs:{address:e.name+"!"+t,isSpill:n}}:{action:"cellDelete",eventArgs:{address:e.name+"!"+t}})}}}getCurPosition(){const e={},t=window.getSelection();if(this.editorElem.textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){const t=e.start;e.start=e.end,e.end=t}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")&&this.editorElem.textContent===this.editCellData.value){const i=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];e.start=i.selectionStart,e.end=i.selectionEnd}return e}mouseDownHandler(e){if(!Object(r.D)(e.target,".e-findtool-dlg")&&this.isEdit){const t=this.getCurPosition();t.start&&(this.curStartPos=this.selectionStart=t.start),t.end&&(this.curEndPos=this.selectionEnd=t.end);const i=e.target,n=this.parent.getActiveSheet(),s=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=i.classList.contains("e-spreadsheet-edit");let a=hs(this.editCellData.value,!0);const o=this.getEditElement(n);if(i.classList.contains("e-cell")||i.classList.contains("e-header-cell")||i.classList.contains("e-selectall")||Object(r.D)(i,".e-toolbar-item.e-active")||Object(r.D)(i,".e-table")){if(this.isAltEnter){const e=o.textContent;e&&e.indexOf("\n")>-1&&(this.isAltEnter=!1,ws(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(o.textContent,this.isCellEdit))}if(!a||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{const t=this.selectionEnd,i=Bi(n.activeCell),r=Cs(i[0],i[1],n);if(this.selectionStart!==this.selectionEnd&&this.editCellData.value===o.textContent&&-1!==this.validCharacters.indexOf(o.textContent.substring(this.selectionStart-1,this.selectionStart))&&cs(o.textContent.substring(this.selectionStart,this.selectionEnd))&&o.textContent.indexOf(":")!==this.selectionEnd&&(this.editCellData.value=o.textContent.substring(0,this.selectionStart)+o.textContent.substring(this.selectionEnd,o.textContent.length)),this.editCellData.value===o.textContent&&o.textContent.indexOf("(")!==o.textContent.length-1&&-1!==o.textContent.indexOf("(")&&this.selectionStart===this.selectionEnd)if(this.editCellData.sheetIndex!==n.id-1){const t=this.parent.element.querySelector(".e-formula-bar");if(","!==o.textContent.substring(t.selectionEnd-1,t.selectionEnd)&&!e.shiftKey)return s&&s.parentElement.removeChild(s),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(o.textContent.substring(t-1,t)))return s&&s.parentElement.removeChild(s),void this.endEdit(!1,e);if(!r)return;if(a=!!r.formula&&(hs(Cs(i[0],i[1],n).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")),a&&this.parent.isEdit){const t=this.selectionEnd;this.editCellData.value.length===t?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||tn(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(s&&s.parentElement.removeChild(s),this.endEdit(!1,e)):this.editCellData.value===o.textContent&&(-1===this.validCharacters.indexOf((this.editCellData.value+n.selectedRange).substring(t-1,t))||-1===this.validCharacters.indexOf(o.textContent.substring(t-1,t))||")"!==o.textContent.substring(t,t+1)&&-1===this.validCharacters.indexOf(o.textContent.substring(t,t+1)))&&(s&&s.parentElement.removeChild(s),this.endEdit(!1,e))}}}else if(a&&this.editCellData.value===o.textContent&&o.textContent.indexOf("(")!==o.textContent.length-1&&!this.isCellEdit&&-1===this.validCharacters.indexOf(this.editCellData.value.substring(this.selectionStart-1,this.selectionStart))&&this.editCellData.sheetIndex===n.id-1){const t=window.getSelection().focusOffset;if(-1===this.validCharacters.indexOf(o.textContent.substring(t-1,t)))return s&&s.parentElement.removeChild(s),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}}}dblClickHandler(e){const t=e.target,i=this.parent.getActiveSheet(),n=Bi(i.activeCell),s=Cs(n[0],n[1],i)||{};if(!Object(r.D)(t,".e-datavisualization-chart"))if(i.isProtected&&us(s,Js(i,n[1])))(t.classList.contains("e-active-cell")||t.classList.contains("e-cell"))&&this.parent.notify("editAlert",null);else if(t.className.indexOf("e-ss-overlay")<0&&(t.classList.contains("e-active-cell")||t.classList.contains("e-cell")||Object(r.D)(t,".e-sheet-content")||t.classList.contains("e-table")))if(this.isEdit)if(hs(this.editCellData.value)){const e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===e&&this.endEdit()}else t.className.indexOf("e-spreadsheet-edit")<0&&this.endEdit();else this.isNewValueEdit=!1,this.startEdit()}updateEditCellDetail(e,t){let i,n;if(i=Object(r.Z)(this.editCellData.sheetIndex)?e&&e.split("!").length>1?Ls(this.parent,js(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?hs(this.editCellData.value,!0)&&(n=Fs(this.parent,i),this.isNewValueEdit=!1):(n=Fs(this.parent,i),e=e?qi(e):n.activeCell),e){const s=Ni(e),r=s[0],a=s[1],o=this.parent.getCell(r,a),l=pr(n,s,this.parent.frozenRowCount(n),this.parent.frozenColCount(n),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:Hs(this.parent,i)+"!"+e,rowIndex:r,colIndex:a,sheetIndex:i,element:o,value:t||"",position:l}}}initiateEditor(e){this.parent.getData(this.editCellData.fullAddr).then(t=>{t.forEach(t=>{const i={cell:t,value:t?t.value:""};this.parent.notify("getFormattedBarText",i);let n=t?i.value:"";t&&t.formula&&(n=t.formula),this.editCellData.oldValue=n,this.editCellData.value?n=this.editCellData.value:this.editCellData.value=n,this.isNewValueEdit?n="":this.isNewValueEdit=!0,Object(r.cb)(n)||this.refreshEditor(n,!1,!0,!1,!1),e&&this.setCursorPosition(),this.triggerEvent("cellEdit")&&this.cancelEdit(!0,!1)})})}positionEditor(e){let t,i=this.editCellData.element;const n={isEdit:!1};if(this.parent.notify("isFormulaBarEdit",n),n.isEdit&&Object(r.Z)(i)&&(t=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),i=t,this.editCellData.element=t),i){i.classList.add("e-ss-edited");const t=this.parent.getActiveSheet(),n=Cs(this.editCellData.rowIndex,this.editCellData.colIndex,t,!1,!0),s=this.editCellData.position.left+1,r=this.editCellData.position.top+1,a={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(hn,a);const o=Ks(t,a.range[0],a.range[2])-3,l=tr(t,a.range[1],a.range[3])-3,h=this.parent.element.getElementsByClassName("e-main-panel")[0];let c;const d=this.parent.frozenColCount(t);let p,g;const u=this.parent.frozenRowCount(t);let m;this.editCellData.colIndex<d?(c=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-i.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<u?"2"===this.parent.getRowHeaderContent().style.zIndex&&(p="3"):Pr(n.value,n.style,this.parent.cellStyle)>c&&(m=!0)):c=h.offsetWidth-s-28-this.parent.sheetModule.getRowHeaderWidth(t),this.editCellData.rowIndex<u&&(g=!0);let f="display:block;top:"+r+"px;"+(this.parent.enableRtl?"right:":"left:")+s+"px;min-width:"+l+"px;max-width:"+(n&&n.wrap?l:c)+"px;height:"+(!g&&(n&&n.wrap||i&&e||m)?"auto;":o+"px;")+(n&&n.wrap?"width:"+l+"px;":"")+"min-height:"+o+"px;"+(p?"z-index: "+p+";":"")+(g&&(n&&!n.wrap||i&&e)&&(Pr(n.value,n.style,this.parent.cellStyle)>c||i&&e)?"overflow: auto;":"");f+=i.style.cssText;const b=this.getEditElement(t,!0);b.setAttribute("style",f),Pr(b.textContent,n.style,this.parent.cellStyle)>c&&(b.style.height="auto"),this.parent.element.querySelector(".e-active-cell").style.height=o+4+"px",i.classList.contains("e-right-align")?b.classList.add("e-right-align"):i.classList.contains("e-center-align")&&b.classList.add("e-center-align")}}updateEditedValue(e=!0){const t=this.editCellData.oldValue,i=this.editCellData.value,n=t?t.toString().toUpperCase():"";let s=!0;const a=this.editCellData.addr,o=Ni(this.parent.getActiveSheet().activeCell),l=this.parent.getActiveSheet(),h=Cs(o[0],o[1],l),c=Js(l,o[1]);t&&t.toString().indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify("removeUniquecol",null);const d={cellIdx:o,isUnique:!1};this.checkUniqueRange(d);const p=d.isUnique;if(p&&""!==t&&""===this.editCellData.value){const e=Ni(this.uniqueColl);if(-1===Cs(e[0],e[1],l).value.indexOf("#SPILL!"))return s}if(this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&(h&&h.validation||c&&c.validation)){const e=this.getEditElement(l).innerText,t=!0,i=this.parent.activeSheetIndex;let n;n="string"==typeof a?Ni(a):a,this.parent.notify("isValidation",{value:e,range:n,sheetIdx:i,isCell:t}),s=this.parent.allowDataValidation,this.editCellData.value=s?e:this.editCellData.value,this.parent.allowDataValidation=!0}if((t!==this.editCellData.value||n.indexOf("=RAND()")>-1||n.indexOf("RAND()")>-1||n.indexOf("=RANDBETWEEN(")>-1||n.indexOf("RANDBETWEEN(")>-1)&&s){const n=this.parent.getActiveSheet(),s=Ni(n.activeCell);this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value});const a=Cs(s[0],s[1],n,!0),o=this.getRefreshNodeArgs(a,s[0],s[1]);if(this.editCellData.value=o.value,a&&a.formula&&(this.editCellData.formula=a.formula),a&&a.wrap&&this.parent.notify("wrapText",{range:s,wrap:!0,sheet:n}),e&&this.parent.refreshNode(this.editCellData.element,o),p){const e=Ni(this.uniqueColl);if(Cs(e[0],e[1],n).value.indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==t&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&t!==this.editCellData.formula){let t=!1;for(let i=e[0];i<=e[2];i++)for(let s=e[1];s<=e[3];s++){const a=Cs(i,s,n);i===e[0]&&s===e[1]?t=!1:Object(r.Z)(a.value)||""===a.value||(t=!0)}t||this.reApplyFormula()}else this.updateUniqueRange(i)}}return s}checkUniqueRange(e){const t={range:[]};this.parent.notify("getUniqueRange",t);const i=t.range;for(let n=0;n<i.length;n++){const t=Ni(i[n]);for(let s=t[0];s<=t[2];s++)for(let r=t[1];r<=t[3];r++)if(e.cellIdx[0]===s&&e.cellIdx[1]===r){e.isUnique=!0,this.uniqueCell=!0,this.uniqueColl=i[n],e.uniqueRange=i[n];break}}}updateUniqueRange(e){const t=Ni(this.uniqueColl);let i=!1;"#SPILL!"!==Cs(t[0],t[1],this.parent.getActiveSheet()).value&&(i=!0);for(let n=t[0];n<=t[2];n++)for(let s=t[1];s<=t[3];s++)i&&(n===t[0]&&s===t[1]?this.parent.updateCell({value:"#SPILL!"},zi([n,s])):zi([n,s]).split(":")[0]===this.editCellData.addr?this.parent.updateCell({value:e},zi([n,s])):this.parent.updateCell({value:""},zi([n,s])))}reApplyFormula(){const e=Ni(this.uniqueColl),t=Cs(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCell({value:""},zi([e[0],e[1]]));const i=this.parent.sheets;let n=t.formula;for(let s=0;s<i.length;s++)n.indexOf(i[s].name)>-1&&(n=n.replace(i[s].name,"!"+s));this.parent.computeExpression(n),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")}refreshDependentCellValue(e,t,i){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===i||this.uniqueCell)){const n=this.parent.getCell(e,t);if(n){const s=Fs(this.parent,i),r=Cs(e,t,s),a=Ni(s.activeCell);a[0]===e&&a[1]===t&&(this.uniqueActCell=r.value);const o=this.getRefreshNodeArgs(r,e,t);this.parent.refreshNode(n,o)}}}getRefreshNodeArgs(e,t,i){const n={value:(e=e||{}).value,format:e&&e.format?e.format:"",onLoad:!0,rowIdx:t,colIdx:i,formattedText:"",isRightAlign:!1,type:"General",cell:e};return this.parent.notify("getFormattedCell",n),n.formattedText=this.parent.allowNumberFormatting?n.formattedText:n.value,{isRightAlign:n.isRightAlign,result:n.formattedText,type:n.type,value:n.value,curSymbol:n.curSymbol}}endEdit(e=!1,t){const i=Bi(this.parent.getActiveSheet().activeCell),n=this.parent.getCell(i[0],i[1]);let s="";this.editCellData.element&&this.editCellData.element.children[0]&&"e-cf-databar"===this.editCellData.element.children[0].className&&(s=n.children[0].querySelector(".e-databar-value").style.fontSize),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1),this.triggerEvent("beforeCellSave")?t.preventDefault():(this.updateEditedValue()?(this.triggerEvent("cellSave",t),this.resetEditState(),this.focusElement()):t&&t.preventDefault(),""!==s&&(n.children[0].querySelector(".e-databar-value").style.fontSize=s),this.parent.showSheetTabs&&!this.parent.isProtected&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"))}cancelEdit(e=!0,t=!0,i){this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave",i),this.resetEditState(),this.focusElement()}focusElement(){Ur(this.parent.element),this.parent.notify("enableToolbarItems",[{enable:!0}])}triggerEvent(e,t){const i=Cs(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet()),n={element:this.editCellData.element,value:i?i.value:this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(i)};if(n.address){const e={cellIdx:Ni(n.address),isUnique:!1};this.checkUniqueRange(e),e.isUnique&&(n.isSpill=this.isSpill)}return n.value!==n.oldValue&&("cellSave"===e&&(this.editCellData.formula&&(n.formula=this.editCellData.formula),n.originalEvent=t,this.parent.notify(Cn,{eventArgs:n,action:"cellSave"})),"cellSave"!==e&&(n.cancel=!1)),this.parent.trigger(e,n),n.cancel}altEnter(){this.positionEditor(!0);const e=window.getSelection(),t=e.anchorNode;let i,n=document.createRange();i=3===t.nodeType?e.anchorOffset:t.textContent.length,0===i&&t.textContent.length>0&&(i=t.textContent.length);const s=t.textContent,r=s.slice(0,i),a=s.slice(i)||" ";t.textContent=r+"\n"+a,n=document.createRange(),3===t.nodeType?(n.setStart(t,i+1),n.setEnd(t,i+1)):1===t.nodeType&&(n.setStart(t.firstChild,i+1),n.setEnd(t.firstChild,i+1)),e.removeAllRanges(),e.addRange(n)}resetEditState(e=!0){if(e){const e=this.getEditElement(this.parent.getActiveSheet());hs(e.textContent)&&this.parent.notify("clearCellRef",null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",e===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):Object(r.J)(e))}this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify("formulaOperation",{action:"endEdit"})}refSelectionRender(){const e=this.getEditElement(this.parent.getActiveSheet());e&&hs(e.textContent)&&this.parent.notify("initiateFormulaReference",{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})}initiateRefSelection(){const e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),t=this.parent.element.querySelector(".e-formula-bar").value;this.parent.getActiveSheet().name===e&&hs(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).innerHTML=t,this.initiateCurPosition()):this.initiateCurPosition()}addressHandler(e){const t=window.getSelection();if(this.selectionStart=t.anchorOffset,this.selectionEnd=t.focusOffset,this.selectionStart>this.selectionEnd){const e=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=e}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){const e=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];this.selectionStart=e.selectionStart,this.selectionEnd=e.selectionEnd}const i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,i);let n=e.range;const s=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),r=this.editCellData.sheetIndex,a=this.getEditElement(this.parent.getActiveSheet());if(this.parent.getActiveSheet().name!==s&&(n="'"+this.parent.getActiveSheet().name+"'!"+n),e.isSelect)this.parent.notify("initiateFormulaReference",{range:i.editedValue+n,formulaSheetIdx:r});else{const e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));if(this.parent.getActiveSheet().name===e){const e=i.editedValue;this.selectionStart!==this.selectionEnd?(this.formulaBarCurStartPos=this.selectionStart,this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+n.length,a.textContent=e.substring(0,this.selectionStart)+n+e.substring(this.selectionStart)):e.indexOf(")")===e.length-1&&this.selectionEnd===e.length?(a.textContent=e.substring(0,e.length-1)+n+e.substring(e.length-1),this.curEndPos=a.textContent.length-1):e.indexOf(")")!==e.length-1?(a.textContent=e+n,this.curEndPos=a.textContent.length):a.textContent!==e?(a.textContent=e.substring(0,this.curStartPos)+n+e.substring(this.curStartPos),this.curEndPos=this.curStartPos+n.length):this.selectionStart!==this.selectionEnd||-1===this.validCharacters.indexOf(e.substring(this.selectionStart-1,this.selectionEnd))||-1===this.validCharacters.indexOf(e.substring(this.selectionStart,this.selectionEnd+1))&&")"!==e.substring(this.selectionStart,this.selectionEnd+1)||(a.textContent=e.substring(0,this.selectionStart)+n+e.substring(this.selectionEnd),this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+n.length,this.formulaBarCurStartPos=this.curStartPos)}}}updateFormulaBarValue(){const e=window.getSelection(),t=this.editCellData.value;let i=this.parent.getActiveSheet().selectedRange;i=Gi(Ui(i))?i.split(":")[0]:i;const n=this.parent.element.querySelector(".e-formula-bar");if(t&&hs(t,!0)){const s=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==s&&(i="'"+this.parent.getActiveSheet().name+"'!"+i),Object(r.Z)(this.formulaBarCurStartPos)?t.indexOf(")")===t.length-1&&e.focusOffset===t.length?n.value=t.substring(0,t.length-1)+i+t.substring(t.length-1):t.indexOf(")")!==t.length-1?n.value=t+i:n.value!==t&&(n.value=t.substring(0,this.curStartPos)+i+t.substring(this.curStartPos)):n.value=t.substring(0,this.formulaBarCurStartPos)+i+t.substring(this.formulaBarCurStartPos),this.curEndPos=this.curStartPos+i.length}}setFormulaBarCurPosition(e,t,i){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,i))}initiateCurPosition(e={isCellEdit:!1}){const t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){const e=this.getCurPosition();return void(this.endFormulaRef||e.start!==e.end||(this.updateFormulaReference(t),e.end&&-1===this.validCharacters.indexOf(this.editCellData.value[e.end-1])&&(this.endFormulaRef=!0)))}const i=t.innerText,n=window.getSelection();if(n&&n.focusNode&&n.focusNode.classList&&n.focusNode.classList.contains("e-formula-bar-panel")){const e=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(e,this.curEndPos,this.curEndPos)}else{if(i){const e=document.createRange();i.indexOf(")"),e.setStart(t.childNodes[0],this.curEndPos),e.setEnd(t.childNodes[0],this.curEndPos),n.removeAllRanges(),n.addRange(e)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){const e=this.parent.element.querySelector(".e-formula-bar");if(e.value){const t=e.value.length;e.value.indexOf(")")===t-1?this.setFormulaBarCurPosition(e,t-1,t-1):this.setFormulaBarCurPosition(e,t,t)}}}}getEditElement(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){const i=this.parent.frozenRowCount(e),n=this.parent.frozenColCount(e),s=Bi(e.activeCell);let r;if(s[0]<i&&s[1]<n)r=this.parent.getSelectAllContent();else if(s[0]<i)r=this.parent.getColumnHeaderContent();else{if(!(s[1]<n))return this.editorElem;r=this.parent.getRowHeaderContent()}let a=r.getElementsByClassName("e-spreadsheet-edit")[0];return!a&&t&&(a=r.appendChild(this.editorElem.cloneNode())),a}return this.editorElem}}class Gr{constructor(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}addEventListener(){this.parent.on("contentLoaded",this.init,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on("virtualContentLoaded",this.virtualContentLoadedHandler,this),this.parent.on("cellNavigate",this.cellNavigateHandler,this),this.parent.on("selectRange",this.selectRange,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),this.parent.on("colWidthChanged",this.colWidthChanged,this),this.parent.on("protectSelection",this.protectHandler,this),this.parent.on("initiateFormulaReference",this.initiateFormulaSelection,this),this.parent.on("clearCellRef",this.clearBorder,this),this.parent.on("getRowIdxFromClientY",this.getRowIdxFromClientY,this),this.parent.on("getColIdxFromClientX",this.getColIdxFromClientX,this),this.parent.on("focusBorder",this.chartBorderHandler,this),this.parent.on("selectionStatus",this.isTouchSelectionStarted,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.init),this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off("virtualContentLoaded",this.virtualContentLoadedHandler),this.parent.off("cellNavigate",this.cellNavigateHandler),this.parent.off("selectRange",this.selectRange),this.parent.off("rowHeightChanged",this.rowHeightChanged),this.parent.off("colWidthChanged",this.colWidthChanged),this.parent.off("protectSelection",this.protectHandler),this.parent.off("initiateFormulaReference",this.initiateFormulaSelection),this.parent.off("clearCellRef",this.clearBorder),this.parent.off("getRowIdxFromClientY",this.getRowIdxFromClientY),this.parent.off("getColIdxFromClientX",this.getColIdxFromClientX),this.parent.off("focusBorder",this.chartBorderHandler),this.parent.off("selectionStatus",this.isTouchSelectionStarted))}isTouchSelectionStarted(e){e.touchSelectionStarted=this.touchSelectionStarted}rowHeightChanged(e){nr(()=>{let t=this.getActiveCell();const i=this.parent.getActiveSheet();if(t){const n=Bi(i.activeCell);if(i.frozenRows||i.frozenColumns){const e={range:[n[0],n[1],n[0],n[1]]};this.parent.notify(hn,e),gr(this.parent,t,e.range,"e-active-cell")}else n[0]===e.rowIdx?t.style.height=`${parseFloat(t.style.height)+e.threshold}px`:n[0]>e.rowIdx&&(t.style.top=`${parseFloat(t.style.top)+e.threshold}px`)}if(t=this.getSelectionElement(),t){const n=Ni(i.selectedRange),s=Wi(n),r={range:s,isActiveCell:!1,skipChecking:!0};if(this.parent.notify("mergedRange",r),r.isActiveCell||s[0]===s[2]&&s[1]===s[3])return;if(i.frozenRows||i.frozenColumns)return void gr(this.parent,t,n);const a=s[0],o=s[2];a<=e.rowIdx&&o>=e.rowIdx&&t?t.style.height=`${parseFloat(t.style.height)+e.threshold}px`:a>e.rowIdx&&t&&(t.style.top=`${parseFloat(t.style.top)+e.threshold}px`)}})}colWidthChanged(e){nr(()=>{const t=this.parent.getActiveSheet();let i=this.getActiveCell();if(i){const n=Bi(this.parent.getActiveSheet().activeCell);if(t.frozenRows||t.frozenColumns){const e={range:[n[0],n[1],n[0],n[1]]};this.parent.notify(hn,e),gr(this.parent,i,e.range,"e-active-cell")}else n[1]===e.colIdx?i.style.width=`${parseFloat(i.style.width)+e.threshold}px`:n[1]>e.colIdx&&(i.style.left=`${parseFloat(i.style.left)+e.threshold}px`)}i=this.getSelectionElement();const n=Ni(this.parent.getActiveSheet().selectedRange),s=Wi(n),r={range:s,isActiveCell:!1,skipChecking:!0};if(this.parent.notify("mergedRange",r),r.isActiveCell||s[0]===s[2]&&s[1]===s[3])return;if(t.frozenRows||t.frozenColumns)return void gr(this.parent,i,n);const a=s[1];a<=e.colIdx&&s[3]>=e.colIdx&&i?i.style.width=`${parseFloat(i.style.width)+e.threshold}px`:a>e.colIdx&&i&&(i.style.left=`${parseFloat(i.style.left)+e.threshold}px`)})}selectRange(e){e.address="Single"===this.parent.selectionSettings.mode?zi(Bi(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking)}init(){this.createSelectionElement();const e=this.parent.getActiveSheet(),t=Wi(Ni(e.selectedRange)),i=Bi(e.activeCell);this.selectMultiRange(e.selectedRange,!0,t[0]<=i[0]&&t[2]>=i[0]&&t[1]<=i[1]&&t[3]>=i[1])}selectMultiRange(e,t,i,n){let s=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(s=Ls(this.parent,js(e)),e=e.split("!")[1]),this.parent.activeSheetIndex===s?e.split(" ").forEach((e,s)=>{this.selectRangeByIdx(Ni(e),{type:"mousedown",ctrlKey:0!==s},null,i,t,n)}):Ms(this.parent,e,this.parent.sheets[s])}createSelectionElement(){const e=this.parent.getMainContent();let t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)}mouseDownHandler(e){if(Object(r.D)(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))return;const t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,t);const i=hs(t.editedValue,!0);if(!this.parent.isEdit||i){const t=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else t&&t.classList.remove("e-ss-overlay-active");if(Object(r.D)(e.target,".e-datavisualization-chart"))return;if(this.parent.getActiveSheet().isProtected&&!this.parent.getActiveSheet().protectSettings.selectCells)return;if(!Object(r.D)(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){const t=this.parent.getActiveSheet(),i=this.parent.selectionSettings.mode,n=this.getRowIdxFromClientY({clientY:Or(e),target:e.target}),s=this.getColIdxFromClientX({clientX:Ir(e),target:e.target}),a=Bi(t.activeCell);let o,l;if(t.showHeaders){const i=e.target;if(t.frozenColumns||t.frozenRows){let e=this.parent.getSelectAllContent().querySelector("thead");l=e?(this.parent.getColumnHeaderContent().contains(i)||e.contains(i))&&i.classList.contains("e-header-cell"):this.parent.getColumnHeaderContent().contains(i)&&i.classList.contains("e-header-cell"),e=this.parent.getSelectAllContent().querySelector("tbody"),o=e?(this.parent.getRowHeaderContent().contains(i)||e.contains(i))&&i.classList.contains("e-header-cell"):this.parent.getRowHeaderContent().contains(i)&&i.classList.contains("e-header-cell")}else o=this.parent.getRowHeaderContent().contains(e.target),l=this.parent.getColumnHeaderContent().contains(e.target)}if(3===e.which&&this.isSelected(n,s))return;if("Multiple"===i&&(!vr(e)&&(!xr(e)||xr(e)&&a[0]===n&&a[1]===s)||l||o)?(document.addEventListener(br().split(" ")[0],this.mouseMoveEvt),r.d.isPointer||document.addEventListener(br().split(" ")[1],this.mouseMoveEvt,{passive:!1}),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,vr(e)||r.l.add(document,yr(),this.mouseUpHandler,this),xr(e)&&!l&&!o)return void(this.touchEvt=e);const h=Ni(t.topLeftCell);o?(this.isRowSelected=!0,e.shiftKey&&"Single"!==i||(this.startCell=[n,0]),this.selectRangeByIdx([this.startCell[0],t.frozenColumns?h[1]:0,n,t.colCount-1],e)):l?(this.isColSelected=!0,e.shiftKey&&"Single"!==i||(this.startCell=[0,s]),this.selectRangeByIdx([t.frozenRows?h[0]:0,this.startCell[1],t.rowCount-1,s],e)):Object(r.D)(e.target,".e-select-all-cell")?(this.startCell=[t.frozenRows?h[0]:0,t.frozenColumns?h[1]:0],this.selectRangeByIdx([].concat(this.startCell,[t.rowCount-1,t.colCount-1]),e)):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==i||(this.startCell=[n,s]),this.selectRangeByIdx([].concat(this.startCell?this.startCell:Bi(t.activeCell),[n,s]),e)),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(i&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){let e=this.parent.getActiveSheet().selectedRange;e=Gi(Ui(e))?e.split(":")[0]:e,this.parent.notify("addressHandle",{range:e,isSelect:!1})}}mouseMoveHandler(e){const t=this.parent.getActiveSheet();Cr(e)&&e.preventDefault();const i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,i);const n=hs(i.editedValue,!0),s=this.parent.getMainContent().parentElement,a=this.parent.element.getElementsByClassName("e-scroller")[0],o=s.getBoundingClientRect(),l=this.parent.frozenColCount(t),h=o.left+this.parent.sheetModule.getRowHeaderWidth(t),c=o.top,d=o.right,p=o.bottom,g=Ir(e),u=Or(e);let m=this.isRowSelected?t.colCount-1:this.getColIdxFromClientX({clientX:Math.min(g,d),target:e.target}),f=this.isColSelected?t.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(u,p),target:e.target}),b=Ni(t.selectedRange);const y={range:[f,m,f,m]};if(this.parent.notify(hn,y),y.range[2]===b[2]&&y.range[3]===b[3])return;const x=this.parent.frozenRowCount(t),C=u>p&&f<t.rowCount,v=u<c&&f>=0&&!this.isColSelected&&!!s.scrollTop,S=g>d&&m<t.colCount,w=g<h&&m>=0&&!this.isRowSelected&&!!a.scrollLeft;let I,O;if(this.clearInterval(),n||this.isColSelected||this.isRowSelected||(b=Bi(t.activeCell)),C||v||S||w)(v||w)&&(I=f,O=m),this.scrollInterval=setInterval(()=>{if((C||v)&&!this.isColSelected){if(f=this.getRowIdxFromClientY({clientY:C?p:c}),f>=t.rowCount)return void this.clearInterval();s.scrollTop+=(C?1:-1)*Xs(t,f)}if((S||w)&&!this.isRowSelected){if(m=this.getColIdxFromClientX({clientX:S?d:h}),m>=t.colCount)return void this.clearInterval();a.scrollLeft+=(S?1:-1)*er(t,m)}if(v&&!s.scrollTop||w&&!a.scrollLeft)return this.selectRangeByIdx([].concat(b[0],b[1],[I,O]),e),void this.clearInterval();this.selectRangeByIdx([].concat(b[0],b[1],[f,m]),e)},100);else{const t=[].concat(b[0],b[1],[f,m]);x&&t[0]<x&&t[2]>=x&&s.scrollTop&&(s.scrollTop=0,t[2]=x),l&&t[1]<l&&t[3]>=l&&a.scrollLeft&&(a.scrollLeft=0,t[3]=l),this.selectRangeByIdx(t,e)}if(n&&this.parent.isEdit&&!Object(r.D)(e.target,"#"+this.parent.element.id+"_edit")){const e=this.parent.getActiveSheet().selectedRange;this.parent.notify("addressHandle",{range:e,isSelect:!1})}}mouseUpHandler(e){const t=this.getRowIdxFromClientY({clientY:Or(e),target:e.target}),i=this.getColIdxFromClientX({clientX:Ir(e),target:e.target});this.clearInterval(),!vr(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:Or(this.touchEvt),target:e.target})!==t||this.getColIdxFromClientX({clientX:Ir(this.touchEvt),target:e.target})!==i||this.mouseDownHandler(e),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),document.removeEventListener(br().split(" ")[0],this.mouseMoveEvt),r.d.isPointer||document.removeEventListener(br().split(" ")[1],this.mouseMoveEvt),r.l.remove(document,yr(),this.mouseUpHandler),this.parent.notify("mouseUpAfterSelection",e);const n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,n),(hs(n.editedValue)||n.editedValue&&0===n.editedValue.toString().indexOf("="))&&this.parent.isEdit&&this.parent.notify("initiateCur",{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})}isSelected(e,t){const i=Wi(Ni(this.parent.getActiveSheet().selectedRange));return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}virtualContentLoadedHandler(e){const t=this.parent.getActiveSheet();let i,n,s=Ni(t.selectedRange);t.selectedRange.split(" ").forEach((r,a)=>{s=Ni(r),n=0===s[1]&&s[3]===e.prevRowColCnt.colCount-1,i=0===s[0]&&s[2]===e.prevRowColCnt.rowCount-1,i&&n?this.selectRangeByIdx([0,0,t.rowCount-1,t.colCount-1],null,!0,null,null,null,a):i?this.selectRangeByIdx([0,s[1],t.rowCount-1,s[3]],null,!0,null,null,null,a):n?this.selectRangeByIdx([s[0],0,s[2],t.colCount-1],null,!0,null,null,null,a):(s=Ni(r),this.highlightHdr(s,0!==a,s[0]>=this.parent.viewport.topIndex||s[2]>=this.parent.viewport.topIndex,s[1]>=this.parent.viewport.leftIndex||s[3]>=this.parent.viewport.leftIndex))})}clearInterval(){clearInterval(this.scrollInterval),this.scrollInterval=null}getScrollLeft(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0}cellNavigateHandler(e){const t=this.parent.getActiveSheet();t.isProtected&&!t.protectSettings.selectCells||this.selectRangeByIdx(e.range.concat(e.range))}getColIdxFromClientX(e){let t=0;const i=this.parent.getActiveSheet();let n=0;if(e.isImage)n=e.clientX;else{const t=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();n=this.parent.enableRtl?t.right-this.parent.sheetModule.getRowHeaderWidth(i,!0)-1-e.clientX:e.clientX-(t.left+this.parent.sheetModule.getRowHeaderWidth(i,!0)+1),n+=this.parent.viewport.beforeFreezeWidth,e.target&&(Object(r.D)(e.target,".e-row-header")||Object(r.D)(e.target,".e-selectall-container"))&&!this.isScrollableArea(e.clientX,e.target,!0)||(n+=this.getScrollLeft())}for(let s=0;;s++)if(t+=er(i,s,null,!0),n<t||this.parent.scrollSettings.isFinite&&s===i.colCount-1)return e.isImage||(e.size=n),e.clientX=s,s}isScrollableArea(e,t,i){return!!t.classList.contains("e-table")&&(i?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)}getRowIdxFromClientY(e){let t=0;const i=this.parent.getActiveSheet();let n=0;if(e.isImage)n=e.clientY;else{const t=document.getElementById(this.parent.element.id+"_sheet");n=e.clientY+this.parent.viewport.beforeFreezeHeight-(t.getBoundingClientRect().top+(i.showHeaders?31:0)),e.target&&Object(r.D)(e.target,".e-header-panel")&&!this.isScrollableArea(e.clientY,e.target)||(n+=this.parent.getMainContent().parentElement.scrollTop)}for(let s=0;;s++)if(t+=Xs(i,s,!0),n<t||this.parent.scrollSettings.isFinite&&s===i.rowCount-1)return e.isImage||(e.size=n),e.clientY=s,s}initFormulaReferenceIndicator(e){if(this.parent.isEdit){const t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),gr(this.parent,t,e,"e-formularef-indicator")}}selectRangeByIdx(e,t,i,n,s,a,o){if(t&&t.target&&Object(r.D)(t.target,"#"+this.parent.element.id+"_edit"))return;const l={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(un,l);const h=hs(l.editedValue,!0)&&!l.endFormulaRef,c=t&&t.ctrlKey&&function(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}(t),d=this.getSelectionElement(t,o),p=this.parent.getActiveSheet(),g=this.parent.element.querySelector(".e-formularef-indicator"),u={range:[].slice.call(e),isActiveCell:!1,skipChecking:a};let m;const f=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");this.isColSelected||this.isRowSelected||this.parent.notify("mergedRange",u),e!==u.range&&(m=!0);const b={range:zi(e=u.range),cancel:!1};if(this.parent.trigger("beforeSelect",b),b.cancel)return;if(h&&g&&g.parentElement.removeChild(g),!Gi(e)&&!u.isActiveCell||c)if(h&&this.parent.isEdit)t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:zi(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{d&&d.classList.remove("e-hide");const t=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);m&&t&&(t.left={idx:0,size:0}),gr(this.parent,d,e)}else d&&(d.classList.contains("e-multi-range")||d.classList.add("e-hide"),(p.frozenRows||p.frozenColumns)&&(ur(this.parent.getSelectAllContent(),null,!1),ur(this.parent.getColumnHeaderContent(),null,!1),ur(this.parent.getRowHeaderContent(),null,!1))),p.frozenColumns||p.frozenRows||!d||gr(this.parent,d,e),h&&t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:zi(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e));const y={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(un,y);let x=zi(e);if(t&&t.ctrlKey&&(Sr(t)||wr(t)))x=p.selectedRange.slice(0,p.selectedRange.lastIndexOf(" "))+" "+x;else if(o>-1){const e=p.selectedRange.split(" ");e[o]=x,x=e.join(" ")}h&&s||Ms(this.parent,x,p,c),this.UpdateRowColSelected(e),this.highlightHdr(e,t&&t.ctrlKey),i||t&&("mousemove"===t.type||Cr(t))||(h?y.sheetIndex===this.parent.getActiveSheet().id-1&&s?this.updateActiveCell((n=!0)?Ni(p.activeCell):e,s):this.parent.isEdit||this.updateActiveCell(n?Ni(p.activeCell):e,s):this.updateActiveCell(n?Ni(p.activeCell):e,s)),Object(r.Z)(t)&&(t={type:"mousedown"}),h&&s||this.parent.notify("selectionComplete",t),this.parent.notify("showAggregate",{}),this.parent.notify("refreshImgElem",{}),f&&this.parent.notify("removeDesignChart",{}),this.parent.notify("clearChartBorder",{})}UpdateRowColSelected(e){const t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1}updateActiveCell(e,t){const i=this.parent.getActiveSheet(),n=Ni(i.topLeftCell);let s,r,a;this.isColSelected?(s=n[0],r=e[1],this.isRowSelected&&(r=n[1])):(s=e[0],r=e[1],this.isRowSelected&&(r=n[1]));const o={range:[s,r,s,r]};if(this.parent.notify(hn,o),e!==o.range&&(a=!0),i.activeCell!==_i((e=o.range)[0],e[1])||t){if(this.parent.setSheetPropertyOnMute(i,"activeCell",_i(e[0],e[1])),i.isProtected){let t=this.parent.element.querySelector(".e-formula-bar");const n=us(Cs(e[0],e[1],i),Js(i,e[1]));n&&t&&!t.disabled?t.disabled=!0:!n&&t&&t.disabled&&(t.disabled=!1)}if(this.getActiveCell()){const t=this.getOffset(e[2],e[3]);a&&(t.left={idx:0,size:0}),gr(this.parent,this.getActiveCell(),e,"e-active-cell")}this.parent.notify("activeCellChanged",null)}else gr(this.parent,this.getActiveCell(),e,"e-active-cell")}getOffset(e,t){const i={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(i.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(i.top=this.parent.scrollModule.offset.top)),i}getSelectionElement(e,t){if(e&&e.ctrlKey){if(wr(e)||Sr(e))return this.parent.getMainContent().querySelector(".e-selection:last-child");{const e=this.parent.element.getElementsByClassName("e-selection")[0];e.classList.remove("e-hide");const t=e.cloneNode();return t.classList.add("e-multi-range"),this.parent.getMainContent().appendChild(t)}}return t>-1?this.parent.getMainContent().getElementsByClassName("e-selection")[t]:([].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(e=>{Object(r.kb)(e)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0])}getActiveCell(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]}getSheetElement(){return document.getElementById(this.parent.element.id+"_sheet")}highlightHdr(e,t,i=!0,n=!0){if(this.parent.getActiveSheet().showHeaders){const s=this.parent.getActiveSheet(),a=[],o=[];let l=Wi(e);l=this.getHdrIndexes(l);const h=this.parent.element.getElementsByClassName("e-select-all-cell")[0];if(t||(Object(r.lb)(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),Object(r.lb)(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight")),h&&Object(r.lb)([h],["e-prev-highlight-right","e-prev-highlight-bottom"]),i){const e=this.parent.frozenRowCount(s);let t,i;const n=this.parent.getSelectAllContent().querySelector("tbody");n&&(t=[].slice.call(n.querySelectorAll(".e-header-cell")));const r=[].slice.call(this.parent.getRowHeaderContent().querySelectorAll(".e-header-cell")),o=Bi(s.topLeftCell)[0];for(let s=l[0];s<l[2]+1;s++)i=s<e?t[s-o]:r[s-e],i&&a.push(i)}if(n){const e=this.parent.frozenColCount(s);let t,i;const n=this.parent.getSelectAllContent().querySelector("thead");n&&(t=[].slice.call(n.querySelectorAll(".e-header-cell")));const r=[].slice.call(this.parent.getColumnHeaderContent().querySelectorAll("th")),a=Bi(s.topLeftCell)[1];for(let s=l[1];s<l[3]+1;s++)i=s<e?t[s-a]:r[s-e],i&&o.push(i)}s.isProtected&&!s.protectSettings.selectCells?Object(r.lb)([].concat(a,o),"e-highlight"):Object(r.w)([].concat(a,o),"e-highlight"),a.length&&a[0].parentElement.previousElementSibling&&a[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),o.length&&o[0].previousElementSibling&&o[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(s.isProtected&&!s.protectSettings.selectCells?document.getElementById(`${this.parent.element.id}_select_all`).classList.remove("e-highlight"):document.getElementById(`${this.parent.element.id}_select_all`).classList.add("e-highlight")),h&&(0===l[0]&&h.classList.add("e-prev-highlight-bottom"),0===l[1]&&h.classList.add("e-prev-highlight-right"))}}protectHandler(){const e=Ni(this.parent.getActiveSheet().selectedRange),t=Wi(e),i=Bi(this.parent.getActiveSheet().activeCell);this.selectRangeByIdx(e,null,null,t[0]<=i[0]&&t[2]>=i[0]&&t[1]<=i[1]&&t[3]>=i[1])}getHdrIndexes(e){if(this.parent.scrollSettings.enableVirtualization){const t=[],i=this.parent.hiddenCount(this.parent.viewport.topIndex,e[0]),n=this.parent.hiddenCount(this.parent.viewport.leftIndex,e[1],"columns");return t[0]=this.isColSelected?e[0]:e[0]-this.parent.viewport.topIndex<0?0:e[0]-i-this.parent.viewport.topIndex,t[1]=this.isRowSelected?e[1]:e[1]-this.parent.viewport.leftIndex<0?0:e[1]-n-this.parent.viewport.leftIndex,t[2]=this.isColSelected?this.parent.viewport.rowCount+2*this.parent.getThreshold("row"):e[2]-this.parent.hiddenCount(e[0],e[2])-i-this.parent.viewport.topIndex,t[3]=this.isRowSelected?this.parent.viewport.colCount+2*this.parent.getThreshold("col"):e[3]-this.parent.hiddenCount(e[1],e[3],"columns")-n-this.parent.viewport.leftIndex,t}return e}initiateFormulaSelection(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)}processFormulaEditRange(e,t){let i,n=t,s=0;const r=this.parseFormula(e),a=r.length;let o=0;const l=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();const h=this.parent.getActiveSheet().id-1;for(;s<a&&(i=r[s],!(this.invalidOperators.indexOf(i)>-1));){if(cs(i.toUpperCase())){if(i=i.replace(/\$/g,""),s>0&&r[s-1].indexOf("!")===r[s-1].length-1){const e=r[s-1].split("!");n=Ls(this.parent,e[0].substring(1,e[0].length-1))}":"===r[s+1]&&(s++,r[s+1]&&cs(r[s+1].toUpperCase())&&(i=i+":"+r[s+1],s++)),h===n&&this.updateFormulaEditRange(i,o,l),n=t,o++}s++}}updateFormulaEditRange(e,t,i){const n=Ni(e);this.formulaRange[t]=e,this.dStartCell={rowIndex:n[0],colIndex:n[1]},this.dEndCell={rowIndex:n[2],colIndex:n[3]},this.focusBorder(this.dStartCell,this.dEndCell,i[t%6])}chartBorderHandler(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)}focusBorder(e,t,i,n){n=!Object(r.Z)(n)&&n;const s=Wi([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),a=this.parent.getActiveSheet();if(a.frozenRows||a.frozenColumns){const e=this.parent.createElement("div",{className:n?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),void gr(this.parent,e,s,"e-range-indicator")}const o=s[0],l=s[1],h=s[2],c=s[3];o&&this.getEleFromRange([o-1,l,o-1,c]).forEach(e=>{e&&(e.classList.add(i[1]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([o,c,h,c]).forEach(e=>{e&&(e.classList.add(i[0]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([h,l,h,c]).forEach(e=>{e&&(e.classList.add(i[1]),n||e.classList.add("e-formularef-selection"))}),l&&this.getEleFromRange([o,l-1,h,l-1]).forEach(e=>{e&&(e.classList.add(i[0]),n||e.classList.add("e-formularef-selection"))})}getEleFromRange(e){let t,i,n,s,r=e[0],a=e[1],o=e[2],l=e[3],h=[];const c=[];if(r>o&&(n=r,r=o,o=n),a>l&&(n=a,a=l,l=n),this.parent.scrollSettings.enableVirtualization)for(t=r;t<=o;t++)if(i=t,i>-1){const e=this.parent.getRow(i,null);e&&(s=e.getElementsByClassName("e-cell"),h=l===a?[s[l]]:this.getRowCells(s,a,l+1),this.merge(c,h))}return c}getRowCells(e,t,i){const n=[];for(;t<i;t++)e[t]&&n.push(e[t]);return n}merge(e,t){e&&t&&Array.prototype.push.apply(e,t)}clearBorder(){const e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)return void[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(e=>{Object(r.J)(e)});const t=this.parent.element.getElementsByClassName("e-formularef-selection");for(let i=0;i<t.length;i++){const e=t[i],n=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"];for(let t=0;t<n.length;t++)e.classList.remove(n[t])}}parseFormula(e){let t,i,n=0;const s=[],r=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),a=r.length;for(;n<a;)if(t=r[n],t){if(1===t.length)s.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t);else if(i=t[0],t.indexOf("!")>0){this.isUniqueChar(i)&&(s.push(this.getUniqueCharVal(i)),t=t.substr(1));const e=t.indexOf("!")+1;s.push(t.substr(0,e)),s.push(t.substr(e))}else this.isUniqueChar(i)?(s.push(this.getUniqueCharVal(i)),s.push(t.substr(1))):s.push(t);n++}else n++;return s}isUniqueChar(e){const t=e.charCodeAt(e.charAt[0]);return t>=129&&t<=142}getUniqueCharVal(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""}markSpecialChar(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)}getModuleName(){return"selection"}destroy(){this.removeEventListener(),this.parent=null}}class Yr{constructor(e){this.clientX=0,this.parent=e,this.addEventListener(),this.initProps()}onContentScroll(e){const t=this.parent.getMainContent().parentElement,i=e.scrollLeft,n=e.scrollTop||t.scrollTop,s=i&&this.parent.enableRtl?this.initScrollValue-i:i;let a,o;if(!Object(r.Z)(i)&&this.prevScroll.scrollLeft!==s){const t=s>this.prevScroll.scrollLeft;o=this.offset.left.size,this.offset.left=this.getColOffset(s,t,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=i,this.parent.getMainContent().scrollLeft=i,e.scrollLeft=i),a={cur:this.offset.left,prev:{idx:this.leftIndex,size:o},increase:t,preventScroll:e.preventScroll},this.updateTopLeftCell(t),this.parent.notify("horizontalScroll",a),this.parent.scrollSettings.enableVirtualization||!t||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=a.prev.idx,this.prevScroll.scrollLeft=s}if(this.prevScroll.scrollTop!==n){const t=n>this.prevScroll.scrollTop;o=this.offset.top.size,this.offset.top=this.getRowOffset(n,t),a={cur:this.offset.top,prev:{idx:this.topIndex,size:o},increase:t,preventScroll:e.preventScroll},this.updateTopLeftCell(t),this.parent.notify("verticalScroll",a),this.parent.scrollSettings.enableVirtualization||!t||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=a.prev.idx,this.prevScroll.scrollTop=n}const l={isEdit:!1};this.parent.notify("isFormulaBarEdit",l),l.isEdit&&this.parent.element.querySelector(".e-formula-bar").focus()}updateNonVirtualRows(){const e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},`${_i(e.rowCount,0)}:${_i(e.rowCount+t-1,e.colCount-1)}`),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)}updateNonVirtualCols(){const e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},`${_i(0,e.colCount)}:${_i(e.rowCount-1,e.colCount+t-1)}`),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)}updateTopLeftCell(e){const t=this.parent.getActiveSheet();let i=this.offset.top.idx,n=this.offset.left.idx;e||(i=Vr(t,i,!0),n=Vr(t,n,!0,"columns")),this.parent.updateTopLeftCell(i,n)}getRowOffset(e,t){let i=this.offset.top.size;const n=this.parent.getActiveSheet();let s=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0;const r=this.parent.frozenRowCount(n),a=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);s<a;)if(t){if(i+=Xs(n,s-1+r,!0),Math.abs(Math.round(i)-e)<=1)return{idx:s,size:i};if(Math.round(i)>e)return{idx:s-1,size:i-Xs(n,s-1+r,!0)};s++}else{if(0===i)return{idx:0,size:0};if(i-=Xs(n,s+r,!0),i<0&&(i=0),Math.abs(Math.round(i)-e)<=1)return{idx:s,size:i};if(Math.round(i)<e)return i+=Xs(n,s+r,!0),Math.round(i)>e?{idx:s,size:i-Xs(n,s+r,!0)<0?0:i-Xs(n,s+r,!0)}:{idx:s+1,size:i};s--}return{idx:this.offset.top.idx,size:this.offset.top.size}}getColOffset(e,t,i){let n=this.offset.left.size;const s=this.parent.getActiveSheet();let r=t?this.offset.left.idx+1:this.offset.left.idx-1;const a=this.parent.frozenColCount(s),o=this.parent.scrollSettings.isFinite?s.colCount:1/0;for(e=Math.round(e);r<o;)if(t){if(n+=er(s,r-1+a,i,!0),Math.round(n)===e)return{idx:r,size:n};if(Math.round(n)>e)return{idx:r-1,size:n-er(s,r-1+a,i,!0)};r++}else{if(0===n)return{idx:0,size:0};if(n-=er(s,r+a,i,!0),Math.round(n)===e)return{idx:r,size:n};if(Math.round(n)<e)return n+=er(s,r+a,i,!0),Math.round(n)>e?{idx:r,size:n-er(s,r+a,i,!0)}:{idx:r+1,size:n};r--}return{idx:this.offset.left.idx,size:this.offset.left.size}}contentLoaded(e){if(!this.parent.scrollSettings.enableVirtualization){const e=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:e}),this.parent.getScrollElement().appendChild(e)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)}updateNonVirualScrollWidth(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width)+"px"}onHeaderWheel(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX}onContentWheel(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)}scrollHandler(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})}updateScroll(e){Object(r.Z)(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left}setScrollEvent(e={set:!0}){e.set?(r.l.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),r.l.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),r.l.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),r.l.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),r.l.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),r.l.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)):(r.l.remove(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll),r.l.remove(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel),r.l.remove(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel),r.l.remove(this.parent.getMainContent(),"wheel",this.onContentWheel),r.l.remove(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel),r.l.remove(this.parent.getScrollElement(),"scroll",this.scrollHandler))}initProps(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}}setPadding(){this.parent.sheetModule.contentPanel.style.overflowY="scroll";const e=or();if(e>0){const t=this.parent.getColumnHeaderContent(),i=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};t.parentElement.style[i.margin]=e+"px",t.style[i.border]="1px"}}setClientX(e){if("mousedown"===e.type||"mouse"===e.pointerType)return;const t={touchSelectionStarted:!1};if(this.parent.notify("selectionStatus",t),t.touchSelectionStarted)return;this.clientX=this.getPointX(e);const i=document.getElementById(this.parent.element.id+"_sheet");r.l.add(i,r.d.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),r.l.add(i,r.d.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}getPointX(e){let t=0;return t=e.touches&&e.touches.length?e.touches[0].clientX:e.clientX,t}onTouchScroll(e){if("mouse"===e.pointerType)return;const t=this.getPointX(e),i=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(i>10||i<-10)&&n.scrollLeft+i>=0&&(e.preventDefault(),this.clientX=t,nr(()=>{n.scrollLeft+=i}))}pointerUpHandler(){const e=document.getElementById(this.parent.element.id+"_sheet");r.l.remove(e,r.d.isPointer?"pointermove":"touchmove",this.onTouchScroll),r.l.remove(e,r.d.isPointer?"pointerup":"touchend",this.pointerUpHandler)}addEventListener(){this.parent.on("contentLoaded",this.contentLoaded,this),this.parent.on("onContentScroll",this.onContentScroll,this),this.parent.on("updateScroll",this.updateScroll,this),this.parent.on("deInitProperties",this.initProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this),this.parent.on("setScrollEvent",this.setScrollEvent,this),this.parent.on("mouseDown",this.setClientX,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on("virtualContentLoaded",this.updateNonVirualScrollWidth,this),this.parent.on("colWidthChanged",this.updateNonVirualScrollWidth,this))}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.off("contentLoaded",this.contentLoaded),this.parent.off("onContentScroll",this.onContentScroll),this.parent.off("updateScroll",this.updateScroll),this.parent.off("deInitProperties",this.initProps),this.parent.off("spreadsheetDestroyed",this.destroy),this.parent.off("setScrollEvent",this.setScrollEvent),this.parent.off("mouseDown",this.setClientX),this.parent.scrollSettings.enableVirtualization||(this.parent.off("virtualContentLoaded",this.updateNonVirualScrollWidth),this.parent.off("colWidthChanged",this.updateNonVirualScrollWidth))}}class Xr{constructor(e){this.scroll=[],this.parent=e,this.addEventListener()}createVirtualElement(e){const t=this.parent.getActiveSheet();let i=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(i.querySelector(".e-table")),i.appendChild(this.content);const n=i.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"}));let s,a=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();let o=this.parent.viewport.bottomIndex;t.rowCount>o+1||t.usedRange.rowIndex>o?(!this.parent.scrollSettings.isFinite&&t.rowCount<=t.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(t,"rowCount",t.usedRange.rowIndex+1),this.setScrollCount(t.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"rowCount",o+1),this.scroll[this.parent.activeSheetIndex].rowCount=t.rowCount);let l=this.parent.frozenRowCount(t);const h=Bi(t.topLeftCell);e.top&&(a=e.top,t.frozenRows&&(a+=Ks(t,h[0],l-1,!0)),l=Bi(t.paneTopLeftCell)[0]),a+=Ks(t,l,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),o=this.parent.viewport.rightIndex;let c=0;const d=this.parent.frozenColCount(t);e.left?(c=e.left,d&&(c+=tr(t,h[1],d-1,!0)),l=Bi(t.paneTopLeftCell)[1]):l=d,t.colCount>o+1||t.usedRange.colIndex>o?(!this.parent.scrollSettings.isFinite&&t.colCount<=t.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(t,"colCount",t.usedRange.colIndex+1),c+=tr(t,l,o,!0),this.setScrollCount(t.colCount,"col"),s=c+tr(t,o+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"colCount",o+1),c+=tr(t,l,t.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=t.colCount,s=c),Object(r.Z)(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),Object(r.Z)(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(c=tr(t,this.parent.viewport.leftIndex+d,o,!0)),Object(r.Z)(this.translateX)&&(this.translateX=0),Object(r.Z)(this.translateY)&&(this.translateY=0),i=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.rowHeader);const p=i.appendChild(n.cloneNode());this.rowHeader.style.transform=`translate(0px, ${this.translateY}px)`,i=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.colHeader);const g=i.appendChild(n.cloneNode());this.colHeader.style.width=`${c}px`,p.style.height=`${a}px`,g.style.width=`${s}px`,this.colHeader.style.transform=`translate(${this.translateX}px, 0px)`,this.content.style.transform=`translate(${this.translateX}px, ${this.translateY}px)`,this.content.style.width=`${c}px`,n.style.height=`${a}px`,n.style.width=`${s}px`,this.parent.allowScrolling&&this.parent.getScrollElement().appendChild(g.cloneNode(!0))}initScroll(){let e=0;for(;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++}setScrollCount(e,t){const i=this.parent.activeSheetIndex;this.scroll[i][t+"Count"]||(this.scroll[i][t+"Count"]=e)}getRowAddress(e){const t=this.parent.getActiveSheet();return zi([e[0],t.frozenColumns?Bi(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])}getColAddress(e){const t=this.parent.getActiveSheet();return zi([t.frozenRows?Bi(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])}updateScrollCount(e,t,i=e){const n=this.parent.getActiveSheet();let s=e+this.parent.viewport[t+"Count"]+1+i;const r=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(s<r){if(n[t+"Count"]===r)return;s=r}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",s)}onVerticalScroll(e){const t=e.cur.idx,i=e.cur.size,n=e.prev.idx;let s=Math.abs(t-n);const r=this.parent.getThreshold("row");if(s>Math.round(r/2)){let a,o,l;const h=this.parent.getActiveSheet();if(t<=r&&!e.increase){if(this.translateY&&n>r){this.translateY=0;const t=this.parent.frozenColCount(h),i=this.parent.frozenRowCount(h);if(this.parent.viewport.topIndex=n-(r-i),!e.preventScroll){const n=t?Bi(h.topLeftCell)[1]:this.parent.viewport.leftIndex,l=t?[i,this.parent.viewport.leftIndex+t]:[];if(s<this.parent.viewport.rowCount+r){o=this.parent.viewport.topIndex-1,a=this.parent.skipHidden(i,o)[0],this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(a-i,!0);const t=this.hiddenCount(a,o),s=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-a+1-t),e.increase);this.parent.viewport.bottomIndex-=o-a+1-t+this.hiddenCount(s,this.parent.viewport.bottomIndex),this.parent.renderModule.refreshUI({colIndex:n,rowIndex:a,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:l},this.getRowAddress([a,this.parent.renderModule.skipHiddenIdx(o,!1)]))}else{const e=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:n,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:l,skipTranslate:!0}),t&&(this.parent.viewport.leftIndex=e),this.translate({refresh:"Row"})}Ur(this.parent.element)}}this.updateScrollCount(r,"row")}if(n<r&&(s=Math.abs(t-r)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===h.rowCount-1){let i=this.parent.viewport.topIndex+r;if(i+=this.hiddenCount(this.parent.viewport.topIndex,i),t>i)return void(e.prev.idx=t);s=i-t}if(t>r){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-r,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);const n=this.parent.frozenRowCount(h);if(e.preventScroll)this.setThresholdHeight(i,r,n);else{const c=this.parent.frozenColCount(h),d=c?Bi(h.topLeftCell)[1]:this.parent.viewport.leftIndex;let p=[];if(h.frozenColumns&&(p=[n,this.parent.viewport.leftIndex+c]),s<this.parent.viewport.rowCount+r)if(e.increase){if(a=this.parent.viewport.bottomIndex+1,o=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),o-=this.hiddenCount(l,this.parent.viewport.topIndex-1),o<=this.parent.viewport.bottomIndex)return this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.topIndex,e.increase),void this.setThresholdHeight(i,r,n);const t=this.parent.skipHidden(a,o),s=this.checkLastIdx(t[1],"row");a=t[0],o=s.index,this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.topIndex-s.diff,e.increase),this.setThresholdHeight(i,r+s.diff,n),this.parent.viewport.bottomIndex=o,this.parent.renderModule.refreshUI({colIndex:d,rowIndex:a,direction:"first",refresh:"RowPart",frozenIndexes:p},this.getRowAddress([a,o]))}else{a=this.parent.viewport.topIndex+n,o=a+s-1;const t=this.hiddenCount(a,o),l=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-a-t),e.increase);this.parent.viewport.bottomIndex-=s-t+this.hiddenCount(l,this.parent.viewport.bottomIndex),a=this.parent.skipHidden(a,o)[0],this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(a-n,!0),this.setThresholdHeight(i,r,n),this.parent.renderModule.refreshUI({colIndex:d,rowIndex:a,direction:"last",refresh:"RowPart",frozenIndexes:p},this.getRowAddress([a,o]))}else l=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:d,refresh:"Row",frozenIndexes:p,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=l),this.setThresholdHeight(i,r,n),this.translate({refresh:"Row"});this.updateScrollCount(t,"row",r),this.focusSheet()}}e.prev.idx=t}}hiddenCount(e,t,i="rows"){let n=0;const s=this.parent.getActiveSheet();for(let r=e;r<=t;r++)s[i][r]&&s[i][r].hidden&&n++;return n}checkLastIdx(e,t){let i=0;if(this.parent.scrollSettings.isFinite){const n=this.parent.getActiveSheet()[t+"Count"]-1;e>n&&(i=e-n,e=n)}return{index:e,diff:i}}onHorizontalScroll(e){const t=e.cur.idx,i=e.cur.size,n=e.prev.idx;let s=Math.abs(t-n);const r=this.parent.getThreshold("col");if(s>Math.round(r/2)){let a,o,l;const h=this.parent.getActiveSheet();if(t<=r&&!e.increase){if(this.translateX&&n>r){const t=this.parent.frozenColCount(h),i=this.parent.frozenRowCount(h);if(this.translateX=0,this.parent.viewport.leftIndex=n-(r-t),!e.preventScroll){const n=i?Bi(h.topLeftCell)[0]:this.parent.viewport.topIndex,l=i?[this.parent.viewport.topIndex+i,t]:[];if(s<this.parent.viewport.colCount+r){o=this.parent.viewport.leftIndex-1,a=this.parent.skipHidden(t,o,"columns")[0],this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(a-t,!0);const i=this.hiddenCount(a,o,"columns"),s=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.rightIndex-(o-a+1-i),e.increase,"columns");this.parent.viewport.rightIndex-=o-a+1-i+this.hiddenCount(s,this.parent.viewport.rightIndex,"columns"),this.parent.renderModule.refreshUI({rowIndex:n,colIndex:a,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:l},this.getColAddress([a,this.parent.renderModule.skipHiddenIdx(o,!1,"columns")]))}else{const e=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:n,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:l,skipTranslate:!0}),i&&(this.parent.viewport.topIndex=e),this.translate({refresh:"Column"})}Ur(this.parent.element)}}this.updateScrollCount(r,"col")}if(n<r&&(s=Math.abs(t-r)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===h.colCount-1){let i=this.parent.viewport.leftIndex+r;if(i+=this.hiddenCount(this.parent.viewport.leftIndex,i),t>i)return void(e.prev.idx=t);s=i-t}if(t>r){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-r,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);const n=this.parent.frozenColCount(h);if(e.preventScroll)this.setThresholdWidth(i,r,n);else{const c=this.parent.frozenRowCount(h),d=c?Bi(h.topLeftCell)[0]:this.parent.viewport.topIndex;let p=[];if(c&&(p=[c+this.parent.viewport.topIndex,n]),s<this.parent.viewport.colCount+r)if(e.increase){if(a=this.parent.viewport.rightIndex+1,o=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),o-=this.hiddenCount(l,this.parent.viewport.leftIndex-1,"columns"),o<=this.parent.viewport.rightIndex)return this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.leftIndex,e.increase,"columns"),void this.setThresholdWidth(i,r,n);const t=this.parent.skipHidden(a,o,"columns"),s=this.checkLastIdx(t[1],"col");a=t[0],o=s.index,this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.leftIndex-s.diff,e.increase,"columns"),this.setThresholdWidth(i,r,n),this.parent.viewport.rightIndex=o,this.parent.renderModule.refreshUI({rowIndex:d,colIndex:a,direction:"first",refresh:"ColumnPart",frozenIndexes:p},this.getColAddress([a,o]))}else{a=this.parent.viewport.leftIndex+n,o=a+s-1;const t=this.hiddenCount(a,o,"columns"),l=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.rightIndex-(o-a-t),e.increase,"columns");this.parent.viewport.rightIndex-=s-t+this.hiddenCount(l,this.parent.viewport.rightIndex,"columns"),a=this.parent.skipHidden(a,o,"columns")[0],this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(a-n,!0,"columns",h),this.setThresholdWidth(i,r,n),this.parent.renderModule.refreshUI({rowIndex:d,colIndex:a,direction:"last",refresh:"ColumnPart",frozenIndexes:p},this.getColAddress([a,o]))}else l=this.parent.viewport.topIndex,this.parent.renderModule.refreshUI({rowIndex:d,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:p,skipTranslate:!0}),c&&(this.parent.viewport.topIndex=l),this.setThresholdWidth(i,r,n),this.translate({refresh:"Column"});this.updateScrollCount(t,"col",r),this.focusSheet()}}e.prev.idx=t}}focusSheet(){document.activeElement.classList.contains("e-text-findNext-short")&&Object(r.D)(document.activeElement,"#"+this.parent.element.id)||Ur(this.parent.element)}setThresholdHeight(e,t,i){let n=0;const s=this.parent.getActiveSheet();for(let r=this.parent.viewport.topIndex+i,a=r+t;r<a;r++)n+=Xs(s,r,!0);this.translateY=e-n}setThresholdWidth(e,t,i){let n=0;const s=this.parent.getActiveSheet();for(let r=this.parent.viewport.leftIndex+i,a=r+t;r<a;r++)n+=er(s,r,null,!0);this.translateX=e-n}translate(e){if(e.skipTranslate)return;const t=this.parent.enableRtl?-this.translateX:this.translateX;"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform=`translate(${t}px, ${this.translateY}px)`,this.rowHeader.style.transform=`translate(0px, ${this.translateY}px)`),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform=`translate(${t}px, ${this.translateY}px)`,this.colHeader.style.transform=`translate(${t}px, 0px)`)}updateColumnWidth(e){if("Column"===e.refresh){this.content.style.width="";const t=this.parent.getActiveSheet(),i=tr(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=i+"px",this.content.style.width=i+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){const e=this.parent.element.querySelector(".e-scroller .e-virtualtrack"),t=parseInt(e.style.width,10),n=i+this.translateX+this.parent.viewport.beforeFreezeWidth;if(n>t)e.style.width=t+(n-t)+"px";else{const i=t-n,s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];t-i<parseInt(s.style.width,10)&&(e.style.width=s.style.width)}}}else if(!this.parent.scrollSettings.isFinite){const e=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0],t=parseInt(e.style.height,10),i=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(i>t)e.style.height=t+(i-t)+"px";else{const n=t-i,s=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];t-n<parseInt(s.style.height,10)&&(e.style.height=s.style.height)}}}updateUsedRange(e){if(!this.scroll.length)return;const t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){const i=this.getVTrackHeight("height");let n=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?n+=Ks(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n-=Ks(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),n<i)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,i,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index>this.scroll[this.parent.activeSheetIndex].colCount){let i=this.getVTrackHeight("width");i+=tr(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0),this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,i,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}getVTrackHeight(e){let t=this.content.nextElementSibling.style[e];if(t.includes("e+")){t=t.split("px")[0];const e=t.split("e+");return Number(e[0])*Math.pow(10,Number(e[1]))}return parseFloat(t)}updateVTrackHeight(e){e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height")}updateVTrackWidth(e){if(e.colIdx>=this.parent.viewport.leftIndex&&e.colIdx<=this.parent.viewport.rightIndex){const t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseFloat(t.style.width)+e.threshold+"px";const i=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";const n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";const s=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];s.style.width=parseFloat(s.style.width)+e.threshold+"px"}}updateVTrack(e,t,i){e.nextElementSibling.style[i]=`${t}px`,this.content.nextElementSibling.style[i]=`${t}px`}deInitProps(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null}updateScrollProps(e={sheetIndex:0,sheets:this.parent.sheets}){0===this.scroll.length?this.initScroll():e.sheets.forEach(()=>{this.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})})}sliceScrollProps(e){Object(r.Z)(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)}addEventListener(){this.parent.on("beforeContentLoaded",this.createVirtualElement,this),this.parent.on("beforeVirtualContentLoaded",this.translate,this),this.parent.on("virtualContentLoaded",this.updateColumnWidth,this),this.parent.on("updateTableWidth",this.updateColumnWidth,this),this.parent.on("verticalScroll",this.onVerticalScroll,this),this.parent.on("horizontalScroll",this.onHorizontalScroll,this),this.parent.on("updateUsedRange",this.updateUsedRange,this),this.parent.on("rowHeightChanged",this.updateVTrackHeight,this),this.parent.on("colWidthChanged",this.updateVTrackWidth,this),this.parent.on("deInitProperties",this.deInitProps,this),this.parent.on("sheetsDestroyed",this.sliceScrollProps,this),this.parent.on("sheetCreated",this.updateScrollProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}destroy(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null}removeEventListener(){this.parent.off("beforeContentLoaded",this.createVirtualElement),this.parent.off("beforeVirtualContentLoaded",this.translate),this.parent.off("virtualContentLoaded",this.updateColumnWidth),this.parent.off("updateTableWidth",this.updateColumnWidth),this.parent.off("verticalScroll",this.onVerticalScroll),this.parent.off("horizontalScroll",this.onHorizontalScroll),this.parent.off("updateUsedRange",this.updateUsedRange),this.parent.off("rowHeightChanged",this.updateVTrackHeight),this.parent.off("colWidthChanged",this.updateVTrackWidth),this.parent.off("sheetsDestroyed",this.sliceScrollProps),this.parent.off("sheetCreated",this.updateScrollProps),this.parent.off("spreadsheetDestroyed",this.destroy)}}class $r{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on(fn,this.keyDownHandler,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off(fn,this.keyDownHandler)}keyDownHandler(e){if(!this.parent.isEdit&&(document.activeElement.classList.contains("e-spreadsheet")||Object(r.D)(document.activeElement,".e-sheet"))&&!Object(r.D)(e.target,".e-name-box")){let t,i;const n=this.parent.enableRtl,s=this.parent.getActiveSheet(),r={e,isFilterCell:!1},a=Bi(this.parent.getActiveSheet().activeCell);if([9,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.shiftKey&&this.shiftSelection(e),e.shiftKey||!e.altKey||38!==e.keyCode&&40!==e.keyCode||this.parent.notify("filterCellKeyDown",r),!e.shiftKey&&(!n&&37===e.keyCode||n&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(a[1]>0)a[1]-=1,t=!0;else{const e=this.parent.getMainContent();0===a[1]&&e.scrollLeft&&!n&&(e.scrollLeft=0)}else if(e.shiftKey&&13===e.keyCode){if(!this.parent.element.querySelector(".e-find-toolbar"))if(a[0]>0)a[0]-=1,t=!0;else{const e=this.parent.getMainContent().parentElement;0===a[0]&&e.scrollTop&&(e.scrollTop=0)}}else if(r.isFilterCell||e.shiftKey||38!==e.keyCode){if(!e.shiftKey&&(!n&&39===e.keyCode||n&&37===e.keyCode)||9===e.keyCode){const e=Cs(a[0],a[1],s);e&&e.colSpan>1&&(a[1]+=e.colSpan-1),a[1]<s.colCount-1&&(a[1]+=1,t=!0)}else if(!r.isFilterCell&&!e.shiftKey&&40===e.keyCode||13===e.keyCode){const e=Cs(a[0],a[1],s);e&&e.rowSpan>1&&(a[0]+=e.rowSpan-1),a[0]<s.rowCount-1&&(a[0]+=1,t=!0)}}else if(a[0]>0)a[0]-=1,t=!0;else{const e=this.parent.getMainContent().parentElement;0===a[0]&&e.scrollTop&&(e.scrollTop=0)}if(t){for(;Ys(this.parent.getActiveSheet(),a[0]);)40===e.keyCode&&(a[0]=a[0]+1),38===e.keyCode&&(a[0]=a[0]-1);this.scrollNavigation(i||a,!!i),this.parent.setSheetPropertyOnMute(s,"activeCell",zi(a)),this.parent.notify("cellNavigate",{range:a})}}e.target.classList.contains("e-sheet-rename")&&(32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify("renameSheet",e))}shiftSelection(e){const t=this.parent.getActiveSheet(),i=Ni(t.selectedRange),n=Wi(i);let s=!0;if(38===e.keyCode){for(let e=n[1];e<=n[3];e++){const t=Cs(i[2],e,this.parent.getActiveSheet());if(!Object(r.Z)(t)&&t.rowSpan&&t.rowSpan<0){i[2]=i[2]-(Math.abs(t.rowSpan)+1),s=!1;break}}s&&(i[2]=i[2]-1),i[2]<0&&(i[2]=0)}if(40===e.keyCode){for(let e=n[1];e<=n[3];e++){const t=Cs(i[2],e,this.parent.getActiveSheet());if(!Object(r.Z)(t)&&t.rowSpan&&t.rowSpan>0){i[2]=i[2]+Math.abs(t.rowSpan),s=!1;break}}s&&(i[2]=i[2]+1)}if(39===e.keyCode){for(let e=n[0];e<=n[2];e++){const t=Cs(e,i[3],this.parent.getActiveSheet());if(!Object(r.Z)(t)&&t.colSpan&&t.colSpan>0){i[3]=i[3]+Math.abs(t.colSpan),s=!1;break}}s&&(i[3]=i[3]+1)}if(37===e.keyCode){for(let e=n[0];e<=n[2];e++){const t=Cs(e,i[3],this.parent.getActiveSheet());if(!Object(r.Z)(t)&&t.colSpan&&t.colSpan<0){i[3]=i[3]-(Math.abs(t.colSpan)+1),s=!1;break}}s&&(i[3]=i[3]-1),i[3]<0&&(i[3]=0)}if(e.shiftKey&&e.ctrlKey&&!this.parent.scrollSettings.enableVirtualization){const n=[t.usedRange.rowIndex,t.usedRange.colIndex];37===e.keyCode&&(i[3]=i[3]<=n[1]?0:n[1]),38===e.keyCode&&(i[2]=i[2]<=n[0]?0:n[0]),39===e.keyCode&&(i[3]=i[3]<=n[1]?n[1]:this.parent.getActiveSheet().colCount),40===e.keyCode&&(i[2]=i[2]<=n[0]?n[0]:this.parent.getActiveSheet().rowCount)}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){for(;Ys(this.parent.getActiveSheet(),i[2]);)40===e.keyCode&&(i[2]=i[2]+1),38===e.keyCode&&(i[2]=i[2]-1);this.parent.selectRange(zi(i)),this.scrollNavigation([i[2],i[3]],!1)}}scrollNavigation(e,t){if(!this.parent.allowScrolling)return;const i=this.parent.enableRtl?-1:1,n=this.parent.getMainContent().parentElement,s=this.parent.getScrollElement(),r=this.parent.getActiveSheet(),a=Wi(Ni(r.selectedRange)),o=Bi(r.topLeftCell),l=this.parent.frozenRowCount(r),h=this.parent.frozenColCount(r),c=Bi(r.paneTopLeftCell),d=e[0]<l?o[0]:c[0],p=e[1]<h?o[1]:c[1],g=this.parent.scrollModule.offset.left.size,u=this.parent.scrollModule.offset.top.size;if(l&&e[0]!==a[2]&&n.scrollTop){if(e[0]===l)return void(n.scrollTop=0);e[0]===l-1&&(n.scrollTop=0)}if(h&&e[1]!==a[3]&&s.scrollLeft){if(e[1]===h)return void(s.scrollLeft=0);e[1]===h-1&&(s.scrollLeft=0)}this.getBottomIdx(d)<=e[0]||t?n.scrollTop=u+Xs(r,c[0],!0):d>e[0]&&(n.scrollTop=u-Math.ceil(Xs(r,e[0],!0))),this.getRightIdx(p)<=e[1]||t?s.scrollLeft=g+er(r,c[1],null,!0)*i:p>e[1]&&(s.scrollLeft=g-er(r,e[1],null,!0)*i)}getBottomIdx(e){let t=0;const i=this.parent.getActiveSheet(),n=(i.frozenRows?this.parent.viewport.height-this.parent.sheetModule.getColHeaderHeight(i,!0):this.parent.viewport.height)-17||20;for(let s=e;;s++)if(t+=Xs(i,s,!0),t>=n)return s}getRightIdx(e){let t=0;const i=this.parent.getActiveSheet(),n=this.parent.getMainContent().parentElement.offsetWidth-this.parent.sheetModule.getRowHeaderWidth(i);for(let s=e;;s++)if(t+=er(i,s,null,!0),t>=n-17)return s}getModuleName(){return"keyboardNavigation"}destroy(){this.removeEventListener(),this.parent=null}}class Kr{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on(fn,this.keyDownHandler,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off(fn,this.keyDownHandler)}keyDownHandler(e){if(e.ctrlKey||e.metaKey){if(Object(r.D)(e.target,".e-find-dlg")||([79,83].indexOf(e.keyCode)>-1?e.preventDefault():65!==e.keyCode||this.parent.isEdit||e.preventDefault()),79===e.keyCode)Object(r.ob)("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.save();else if(67===e.keyCode)this.parent.notify("copy",{promise:Promise});else if(75===e.keyCode){const t=Bi(this.parent.getActiveSheet().activeCell),i=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]];let n;e.preventDefault(),Object(r.Z)(i)||(n=i.cells[t[1]]),Object(r.Z)(n)&&vs(t[0],t[1],this.parent.getActiveSheet(),n,!1),this.parent.notify(n&&n.hyperlink?"editHyperlink":"initiateHyperlink",null)}else 90===e.keyCode?this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!0})):89===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!1})));const t=this.parent.sheets[this.parent.getActiveSheet().id-1];let i;if(t){const e=Bi(t.activeCell),n=Cs(e[0],e[1],t);i=t.isProtected&&us(n,Js(t,e[1]))}if(70===e.keyCode&&(e.preventDefault(),this.parent.notify("ribbonFind",null)),!(i&&t.isProtected&&86!==e.keyCode||70===e.keyCode)){if(71===e.keyCode)e.preventDefault(),this.parent.notify(Sn,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(wn,null);else if(88===e.keyCode)this.parent.notify("cut",{promise:Promise});else if(86===e.keyCode)this.parent.notify(yn,{isAction:!0});else if(66===e.keyCode){e.preventDefault();let t=this.parent.getCellStyleValue(["fontWeight"],Bi(this.parent.getActiveSheet().activeCell)).fontWeight;t="bold"===t?"normal":"bold",this.parent.notify(sn,{style:{fontWeight:t},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){e.preventDefault();let t=this.parent.getCellStyleValue(["fontStyle"],Bi(this.parent.getActiveSheet().activeCell)).fontStyle;t="italic"===t?"normal":"italic",this.parent.notify(sn,{style:{fontStyle:t},onActionUpdate:!0,refreshRibbon:!0})}else 85===e.keyCode?(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"underline"},refreshRibbon:!0})):53===e.keyCode&&(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.applyFilter()))}}27===e.keyCode&&this.parent.notify("clearCopy",null)}getModuleName(){return"keyboardShortcut"}destroy(){this.removeEventListener(),this.parent=null}}class Jr{constructor(e){this.checkHeight=!1,this.parent=e,this.row=e.createElement("tr",{className:"e-row"}),this.parent.on("initialLoad",this.addEventListener,this)}applyCellFormat(e){const t=Object.keys(e.style),i=this.parent.getActiveSheet();if(e.lastCell&&zr(i,e.rowIdx)<=20&&!t.length)return;const n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(this.updateMergeBorder(e,i),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){const t={};Object.keys(e.style).forEach(i=>{t[i]=e.style[i]}),void 0!==t.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,i),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,i),delete t.border),void 0!==t.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,i),delete t.borderTop),void 0!==t.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,i),delete t.borderLeft),Object.keys(t).length&&(void 0!==t.borderBottom&&this.setThickBorderHeight(t.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,t))}else{void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style),n.firstElementChild&&n.firstElementChild.classList.contains("e-wrap-content")&&Object.assign(n.firstElementChild.style,e.style);const t=Cs(e.rowIdx,e.colIdx,i);t&&(t.rowSpan||t.colSpan)&&n.offsetHeight>0&&Fr(this.parent,t.style||this.parent.cellStyle)>n.offsetHeight&&Mr(this.parent,i,n.offsetHeight,e.rowIdx)}if(e.isHeightCheckNeeded&&(!i.rows[e.rowIdx]||!i.rows[e.rowIdx].customHeight))if(e.manualUpdate)this.checkHeight||(this.checkHeight=this.isHeightCheckNeeded(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate);else{const t=Cs(e.rowIdx,e.colIdx,i);if(t&&t.wrap||!this.isHeightCheckNeeded(e.style)||_r(i,e.rowIdx,e.colIdx,Hr(this.parent,e.rowIdx,e.colIdx,i,e.style)),e.lastCell){const t=zr(i,e.rowIdx);t>20&&t>Xs(i,e.rowIdx)&&Mr(this.parent,i,t,e.rowIdx,e.row,e.hRow,this.parent.scrollSettings.isFinite)}}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}updateRowHeight(e,t,i,n){if(this.checkHeight){let s,a=0;const o=this.parent.getActiveSheet(),l=Cs(e,t,o,null,!0),h=this.parent.getCell(e,t);if(l&&!l.rowSpan&&!l.colSpan){if(a=Hr(this.parent,e,t,o,l.style||this.parent.cellStyle,l.wrap?Nr(this.parent.getDisplayText(l),Br(o,e,t),l.style,this.parent.cellStyle):1),!Object(r.Z)(l.value)&&l.value.toString().indexOf("\n")>-1){let i;const n=l.value.split("\n");let s=0;const r=n.length;for(i=0;i<r;i++){let r=Nr(n[i],Br(o,e,t),l.style,this.parent.cellStyle);0===r&&(r=1),s+=r}a=Hr(this.parent,e,t,o,l.style||this.parent.cellStyle,s)}if(a<20&&(a=20),h&&h.children[0]&&"e-cf-databar"===h.children[0].className&&(h.children[0].style.height="100%",h.children[0].firstElementChild.nextElementSibling.style.height="100%"),_r(o,e,t,a),i){this.checkHeight=!1;const t=o.frozenRows?this.parent.getRow(e,null,o.frozenColumns):this.parent.getRow(e);if(!t)return;const i=Xs(o,e);s=zr(o,e),(n?s!==i:s>i)&&Mr(this.parent,o,s,e,t,null,!0)}}}}updateMergeBorder(e,t){const i=Cs(e.rowIdx,e.colIdx,t,null,!0),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(hn,n),i.rowSpan>1&&!e.style.borderBottom){const i=Cs(n.range[2],n.range[1],t,null,!0);i.style&&i.style.borderBottom&&(e.style.borderBottom=i.style.borderBottom)}if(i.colSpan>1&&!e.style.borderRight){const i=Cs(n.range[0],n.range[3],t,null,!0);i.style&&i.style.borderRight&&(e.style.borderRight=i.style.borderRight)}}isHeightCheckNeeded(e,t){const i=Object.keys(e);return(t?i.indexOf("fontSize")>-1:i.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||i.indexOf("fontFamily")>-1||i.indexOf("borderTop")>-1||i.indexOf("borderBottom")>-1}setLeftBorder(e,t,i,n,s,r,a,o){if(a&&a.includes("Column"))return;let l=this.parent.getCell(i,n-1,s);if(l){let s=Cs(i,n-1,o,!1,!0);if(s.rowSpan&&1!==s.rowSpan||s.colSpan&&1!==s.colSpan){const r={range:[i,n-1,i,n-1]};if(this.parent.notify(hn,r),s=Cs(r.range[0],r.range[1],o,!1,!0),s.style&&s.style.borderRight&&"none"!==s.style.borderRight)return;if(s=Cs(r.range[0],r.range[3],o,null,!0),s.style&&s.style.borderRight&&"none"!==s.style.borderRight)return;t.style.borderLeft=e}else r&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}setTopBorder(e,t,i,n,s,r,a,o,l,h,c){if(o&&o.includes("Row"))return;const d=this.parent.getCell(i-1,n,s);if(d){let o=Cs(i-1,n,c,!1,!0);if(o.rowSpan&&1!==o.rowSpan||o.colSpan&&1!==o.colSpan){const s={range:[i-1,n,i-1,n]};if(this.parent.notify(hn,s),o=Cs(s.range[0],s.range[1],c,!1,!0),o.style&&o.style.borderBottom&&"none"!==o.style.borderBottom)return;if(o=Cs(s.range[2],s.range[1],c,null,!0),o.style&&o.style.borderBottom&&"none"!==o.style.borderBottom)return;t.style.borderTop=e}else{if(Ys(c,i-1)){const e=[Number(d.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],e).bottomPriority)return}a&&""!==e&&c.topLeftCell.includes(`${i+1}`)&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,i-1,n,d,s,r,a,l,h),d.style.borderBottom="none"===e?d.style.borderBottom:e}}else t.style.borderTop=e}setThickBorderHeight(e,t,i,n,s,r,a,o,l){const h=e?this.getBorderSize(e):1,c=this.parent.getActiveSheet();if(h>2&&(!c.rows[t]||!c.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,i,o,a);else{const e=Xs(c,t),n=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,i]),1,3));n>e&&(Mr(this.parent,c,n,t,s,r,!1),this.parent.notify("rowHeightChanged",{rowIdx:t,threshold:n-20}))}!a||!o&&this.checkHeight||!(h<3)||c.rows[t]&&c.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,i,o,a))}getBorderSize(e){const t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)?parseInt(t,10):1}clearObj(e){const t=e.options,i=t.range?t.range.indexOf("!")>0?t.range.split("!")[1]:t.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=t.range&&t.range.indexOf("!")>0?Ls(this.parent,t.range.split("!")[0]):this.parent.activeSheetIndex,s=Ni(i),a=this.parent.sheets[n];let o=s[0];const l=s[2];let h,c,d={range:i,type:t.type,requestType:"clear",sheetIndex:n};if(e.isPublic||this.parent.notify(vn,{action:"beforeClear",eventArgs:d}),"Clear Formats"===t.type||"Clear All"===t.type)for(this.parent.notify("clearCFRule",{range:i,isPublic:!1,isclearFormat:!0});o<=l;o++)for(h=s[1],c=s[3];h<=c;h++){const e=Cs(o,h,a),i=this.parent.getCell(o,h);e&&(e.wrap&&this.parent.notify("wrapText",{range:[o,h,o,h],wrap:!1,sheet:a}),e.hyperlink&&(Object(r.lb)(i.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===t.type&&this.parent.removeHyperlink(zi([o,h,o,h]))))}"Clear Hyperlinks"!==t.type?(this.parent.notify("clear",{range:a.name+"!"+i,type:t.type}),this.parent.serviceLocator.getService("cell").refreshRange(Ni(i)),e.isPublic||(d={range:a.name+"!"+i,type:t.type,sheetIndex:n},this.parent.notify("actionComplete",{eventArgs:d,action:"clear"})),this.parent.notify("addHighlight",{range:i,isclearFormat:!0}),this.parent.notify("selectRange",{address:i})):this.parent.removeHyperlink(i)}addEventListener(){this.parent.on(rn,this.applyCellFormat,this),this.parent.on("clearViewer",this.clearObj,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("initialLoad",this.addEventListener),this.parent.off(rn,this.applyCellFormat),this.parent.off("clearViewer",this.clearObj))}destroy(){this.removeEventListener(),this.parent=null,this.row=null,this.checkHeight=null}getModuleName(){return"cellformat"}}class Qr{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on("contentLoaded",this.wireEvents,this),this.parent.on(xn,this.autoFit,this),this.parent.on("setAutoFit",this.setAutoFitHandler,this)}autoFit(e){const t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0];for(let i=e.startIndex;i<=e.endIndex;i++)this.trgtEle=e.isRow?this.parent.getRow(i,t):this.parent.getCell(null,i,t),this.setAutofit(i,!e.isRow)}wireEvents(){const e=this.parent.getRowHeaderContent(),t=this.parent.element.getElementsByClassName("e-header-panel")[0];r.l.add(t,"dblclick",this.dblClickHandler,this),r.l.add(e,"dblclick",this.dblClickHandler,this),r.l.add(t,"mousedown",this.mouseDownHandler,this),r.l.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,t)}wireResizeCursorEvent(e,t){r.l.add(e,"mousemove",this.setTarget,this),r.l.add(t,"mousemove",this.setTarget,this)}unWireResizeCursorEvent(){r.l.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget),r.l.remove(this.parent.element.getElementsByClassName("e-header-panel")[0],"mousemove",this.setTarget)}unwireEvents(){r.l.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),r.l.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),r.l.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),r.l.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()}removeEventListener(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.wireEvents),this.parent.off(xn,this.autoFit),this.parent.off("setAutoFit",this.setAutoFitHandler))}mouseMoveHandler(e){const t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],i=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];(t||i)&&(this.isMouseMoved=!0,t?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):i&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(i.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px"))}mouseDownHandler(e){if(!Object(r.D)(e.target,".e-header-cell"))return;if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){const t=this.trgtEle.offsetHeight,i=e.offsetY;(t>=10&&i<5||t-2<8&&i<Math.ceil((i-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);const t=this.trgtEle,i=t.classList.contains("e-colresize")?"e-colresize-handler":t.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(t,i),this.unWireResizeCursorEvent(),r.l.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),r.l.add(document,"mouseup",this.mouseUpHandler,this)}mouseUpHandler(e){const t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],i=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeOn(e),this.isMouseMoved=null;const n=t||i;n&&(document.getElementById(this.parent.element.id+"_sheet").removeChild(n),this.updateCursor()),r.l.remove(document,"mouseup",this.mouseUpHandler),r.l.remove(this.parent.element,"mousemove",this.mouseMoveHandler),this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),this.parent.element.getElementsByClassName("e-header-panel")[0])}dblClickHandler(e){if(Object(r.D)(e.target,".e-header-cell"))if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){const e=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,t=`${er(this.parent.getActiveSheet(),e)}px`;this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(e-1):this.setAutofit(e,!0,t)}else if(this.trgtEle.classList.contains("e-rowresize")){const e=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=`${Xs(this.parent.getActiveSheet(),e)}px`;this.setAutofit(e,!1,t)}}setTarget(e){if(!Object(r.D)(e.target,".e-header-cell"))return;const t=e.target,i=this.parent.getActiveSheet();if(i.isProtected&&(!i.protectSettings.formatColumns||!i.protectSettings.formatRows)){if(!i.protectSettings.formatRows&&!i.protectSettings.formatColumns)return;if(i.protectSettings.formatRows&&Object(r.D)(t,".e-colhdr-table"))return;if(i.protectSettings.formatColumns&&Object(r.D)(t,".e-rowhdr-table"))return}let n,s,a,o;if(Object(r.D)(t,".e-header-row")){a=e.offsetX,s=t.offsetWidth,o="e-colresize";const i=this.getColPrevSibling(t);i&&!i.classList.contains("e-select-all-cell")?n=i:Number(t.getAttribute("aria-colindex"))>1&&(n=t)}else if(Object(r.D)(t,".e-row")){a=e.offsetY,s=t.offsetHeight,o="e-rowresize";const i=this.getRowPrevSibling(t);i?n=i.firstElementChild:Number(t.parentElement.getAttribute("aria-rowindex"))>1&&(n=t)}if(s-2<8&&a!==Math.ceil((s-2)/2))a<Math.ceil((s-2)/2)?(t.classList.add(o),n.classList.add(o)):a>Math.ceil((s-2)/2)&&t.classList.add(o);else if(s-5<a&&a<=s&&s>=10)t.classList.add(o);else if(a<5&&n&&s>=10)t.classList.add(o),n.classList.add(o);else{const e=this.parent.element.getElementsByClassName(o);for(let t=0;t<e.length;t++)e[t].classList.remove(o)}}getColPrevSibling(e){const t=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(t&&Object(r.D)(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)}getRowPrevSibling(e){const t=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(t&&Object(r.D)(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)}updateTarget(e,t){if(Object(r.D)(t,".e-header-row")){if(t.offsetWidth<10&&e.offsetX<Math.ceil((t.offsetWidth-2)/2)||e.offsetX<5&&t.offsetWidth>=10&&t.classList.contains("e-colresize")){const e=this.parent.getActiveSheet(),i=Number(this.trgtEle.getAttribute("aria-colindex"))-2,n=this.getColPrevSibling(t);n&&!ir(e,i)?this.trgtEle=n:i>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(t.offsetHeight<10&&e.offsetY<Math.ceil((t.offsetHeight-2)/2)||e.offsetY<5&&t.offsetHeight>=10&&t.classList.contains("e-rowresize")){const i=this.parent.getActiveSheet(),n=Number(t.parentElement.getAttribute("aria-rowindex"))-2,s=this.getRowPrevSibling(t);if(s||Ys(i,n))if("dblclick"===e.type&&Ys(i,n)){const e=Wi(Ni(i.selectedRange));let t;t=n<=e[2]&&n>e[0]?{startIndex:e[0],endIndex:e[2],hide:!1,autoFit:!0}:{startIndex:n,endIndex:n,hide:!1,autoFit:!0},this.parent.notify("hideShow",t)}else Ys(i,n)||(this.trgtEle=s.getElementsByClassName("e-header-cell")[0])}}setAutoFitHandler(e){this.setAutofit(e.idx,e.isCol)}setAutofit(e,t,i){let n=0;const s=this.parent.getActiveSheet(),r=this.parent.getMainContent(),a=t?`${er(this.parent.getActiveSheet(),e)}px`:`${Xs(this.parent.getActiveSheet(),e)}px`,o=[],l=r.getElementsByClassName("e-content-table")[0];this.parent.getActiveSheet().showHeaders&&(t?this.parent.getColHeaderTable():this.parent.getRowHeaderTable()).getElementsByTagName("tr");let h=!1,c=0;if(t){const t=s.rows.length;for(let i=0;i<t;i++)if(s.rows[i]&&s.rows[i].cells&&s.rows[i].cells[e]){Cs(i,e,s).wrap&&(h=!0,c++);const t=this.parent.createElement("td",{className:"e-cell"});if(t.textContent=this.parent.getDisplayText(s.rows[i].cells[e]),s.rows[i].cells[e].style){const n=s.rows[i].cells[e].style;n.fontFamily&&(t.style.fontFamily=n.fontFamily),n.fontSize&&(t.style.fontSize=n.fontSize)}o[n]=t,n++}}else{const t=s.rows[e]&&s.rows[e].cells?s.rows[e].cells.length:0;for(let i=0;i<t;i++)if(s.rows[e]&&s.rows[e].cells[i]){Cs(e,i,s).wrap&&(h=!0,c++);const t=this.parent.createElement("td");if(t.textContent=this.parent.getDisplayText(s.rows[e].cells[i]),s.rows[e].cells[i].style){const n=s.rows[e].cells[i].style;n.fontFamily&&(t.style.fontFamily=n.fontFamily),n.fontSize&&(t.style.fontSize=n.fontSize)}o[n]=t,n++}}if(0===c){let n=Tr(l,o,t,this.parent,i,h);t&&(n=this.getFloatingElementWidth(n,e));let r=0===n?parseInt(a,10):n;const c=parseInt(a,10)>r?-(parseInt(a,10)-r):r-parseInt(a,10);if(t)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)Js(s,e).width=r>0?r:0,this.resizeStart(e,this.parent.getViewportIndex(e,!0),r+"px",t,!0,i),this.parent.notify("colWidthChanged",{threshold:c,colIdx:e});else{const t=er(s,e);let i;i=r>0?-(t-r):-t,this.parent.notify("colWidthChanged",{threshold:i,colIdx:e}),Js(s,e).width=r>0?r:0}else if(!t)if(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex)r=r>20?r:20,$s(s,e,r>0?r:0),Gs(s,e,{customHeight:!1}),this.resizeStart(e,this.parent.getViewportIndex(e),r+"px",t,!0,i),this.parent.notify("rowHeightChanged",{threshold:c,rowIdx:e});else{const t=Xs(s,e);let i;i=r>0?-(t-r):-t,this.parent.notify("rowHeightChanged",{threshold:i,rowIdx:e}),$s(s,e,r>0?r:0)}}}createResizeHandler(e,t){const i=this.parent.createElement("div",{className:t}),n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(i.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",i.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",i.style.top="0px"):e.classList.contains("e-rowresize")&&(i.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",i.style.left="0px",i.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(i),this.updateCursor()}setColWidth(e,t,i,n){const s=this.parent.getActiveSheet();let r=Rr(i)-n;if(r<0&&n<-r&&(r=-n),i>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,i),void this.parent.notify(Cn,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:`${n}px`,hide:!1},action:"resize"});this.resizeStart(e,t,`${i}px`,!0,!1,`${n}px`),Qs(s,e,{width:i,customWidth:!0}),this.parent.notify("colWidthChanged",{threshold:r,colIdx:e})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.parent.notify(Cn,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:`${n}px`,hide:!0},action:"resize"}))}showHiddenColumns(e,t){const i=this.parent.getActiveSheet(),n=Ni(i.selectedRange);let s,r,a;if(e>=n[1]&&e<=n[3]&&n[2]===i.rowCount-1&&Bi(i.activeCell)[0]===Bi(i.topLeftCell)[0]?(s=n[1],r=n[3],a=this.parent.getMainContent().querySelector("colgroup")):s=r=e,void 0!==t)for(let o=s;o<=r;o++)Qs(i,o,{width:t,customWidth:!0}),o>=this.parent.viewport.leftIndex&&o<=this.parent.viewport.rightIndex&&!ir(i,o)&&(a.children[this.parent.getViewportIndex(o,!0)].style.width=`${t}px`);this.trgtEle.classList.remove("e-unhide-column"),this.parent.hideColumn(s,r,!1),void 0===t&&this.autoFit({isRow:!1,startIndex:s,endIndex:r})}setRowHeight(e,t,i,n){const s=this.parent.getActiveSheet(),r=this.parent.frozenColCount(s),a=parseInt(this.parent.getRow(e,null,r).style.height,10),o=i;let l=Rr(parseInt(o,10))-a;l<0&&a<-l&&(l=-a),this.resizeStart(e,t,o,!1,!1,n),Gs(s,e,{height:parseInt(o,10)>0?parseInt(o,10):0,customHeight:!0}),this.parent.notify("rowHeightChanged",{threshold:l,rowIdx:e,isCustomHgt:!0})}resizeOn(e){let t,i;const n=this.parent.getActiveSheet(),s=Ni(n.activeCell),r=Cs(s[0],s[1],n);if(this.trgtEle.classList.contains("e-rowresize")){const a=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&Ys(n,a)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");const e={startIndex:a,endIndex:a,hide:!1,skipAppend:!0};this.parent.notify("hideShow",e);const t=this.parent.getRowHeaderTable().tBodies[0],i=this.parent.getContentTable().tBodies[0];e.hdrRow.style.display="none",e.row.style.display="none",t.insertBefore(e.hdrRow,t.children[e.insertIdx]),i.insertBefore(e.row,i.children[e.insertIdx]),this.trgtEle=e.hdrRow.firstElementChild,e.hdrRow.nextElementSibling.classList.remove("e-hide-end"),e.mergeCollection.forEach(e=>{this.parent.notify(ln,e)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&Ys(n,a)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}i=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(i);const o=this.parent.frozenColCount(n);let l=this.parent.getRow(i,null,o).style.height,h=e.clientY-this.event.clientY+parseInt(l,10);if(h<=0)return this.parent.hideRow(i),Gs(n,i,{height:0,customHeight:!0}),void this.parent.notify(Cn,{eventArgs:{index:i,height:"0px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:l},action:"resize"});if(this.setRowHeight(i,t,`${h}px`,l),r&&r.rowSpan){const e=this.parent.getCell(s[0],s[1]);this.parent.element.querySelector(".e-active-cell").style.height=e.offsetHeight+"px"}if("none"===this.trgtEle.parentElement.style.display){const e=this.parent.getActiveSheet(),n=Wi(Ni(e.selectedRange));if(i<=n[2]&&i>n[0]){let s;h=Xs(e,i);for(let t=n[0];t<=n[2];t++)t!==i&&(l=`${Xs(e,t)}px`,Gs(e,t,{customHeight:!0,height:h}),Ys(e,t)?s||(s=t):(this.parent.getRow(t).style.height=`${h}px`,e.showHeaders&&(this.parent.getRow(t,this.parent.getRowHeaderTable()).style.height=`${h}px`)),this.parent.notify(Cn,{eventArgs:{index:t,height:`${h}px`,isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:l},action:"resize"}));this.parent.hideRow(n[0],i-1,!1),t+=Math.abs(i-s)}else 0===t||Ys(e,i-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(e.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){let i;if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,this.trgtEle.classList.contains("e-unhide-column")?(t-=1,i=0):i=er(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),e.clientX-this.event.clientX+i,i),r&&r.colSpan){const e=this.parent.getCell(s[0],s[1]);this.parent.element.querySelector(".e-active-cell").style.width=e.offsetWidth+"px"}}}resizeStart(e,t,i,n,s,r){let a,o;Er(e,t,i,n,this.parent),n?(a={index:e,width:i,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldWidth:r},o=r!==i):(a={index:e,height:i,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldHeight:r},o=r!==i),o&&this.parent.notify(Cn,{eventArgs:a,action:s?"resizeToFit":"resize"})}updateCursor(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")}getFloatingElementWidth(e,t){let i=e;const n={filterRange:[],hasFilter:!1};return this.parent.notify("getFilterRange",n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(i=e+22),i}destroy(){this.unwireEvents(),this.removeEventListener(),this.parent=null}getModuleName(){return"resize"}}class ea{constructor(e){this.parent=e,this.addEventListener()}refreshClients(e){jr(e,this.parent)}addEventListener(){this.parent.on("collaborativeUpdate",this.refreshClients,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("collaborativeUpdate",this.refreshClients)}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"collaborativeEditing"}}class ta{constructor(e){this.parent=e,this.addEventListener()}hideShow(e){const t=this.parent.getActiveSheet();if(!t.frozenRows&&!t.frozenColumns){if(e.startIndex>e.endIndex){const t=e.startIndex;e.startIndex=e.endIndex,e.endIndex=t}e.actionUpdate&&this.parent.notify(vn,{eventArgs:e,action:"hideShow"}),e.isCol?this.hideCol(e):this.hideRow(e),e.actionUpdate&&this.parent.notify(Cn,{eventArgs:e,action:"hideShow"})}}hideRow(e){const t=this.parent.getActiveSheet();let i,n,s,a,o=0;if(e.hide){let l,h,c;for(let d=e.startIndex;d<=e.endIndex;d++)if(!Ys(t,d))if(void 0===n&&(t.showHeaders&&(h=this.parent.getRowHeaderTable()),l=this.parent.getContentTable(),n=this.parent.getViewportIndex(d),o=0),Gs(t,d,{hidden:!0}),this.refreshChart(d,"rows"),c=l&&l.rows[n],c){if(!a)for(let n=0;n<=t.usedRange.colIndex;n++)if(i=Cs(d,n,t)||{},(i.colSpan||i.rowSpan)&&(e.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){a=!0;break}if(a)continue;if(t.showHeaders&&Object(r.J)(h.rows[n]),Object(r.J)(c),o++,c=l.rows[n],c&&d===e.endIndex){let i;s=Vr(t,d+1,!0);const n=s!==Vr(t,0,!0)&&s===(this.parent.viewport.topIndex>=e.startIndex?e.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(let e=this.parent.viewport.leftIndex;e<=this.parent.viewport.rightIndex;e++){const t=this.parent.getCellStyleValue(["borderTop"],[s,e]).borderTop;""!==t&&(i=c.cells[e],this.parent.notify(rn,{onActionUpdate:!1,rowIdx:s,colIdx:e,style:{borderTop:t},row:c,pRow:c.previousElementSibling,first:n,cell:i}))}}}else d<=this.parent.viewport.bottomIndex?o++:o--;if(a&&(e.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return this.parent.selectRange(t.selectedRange),void this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});if(!o)return;if(this.parent.selectRange(t.selectedRange),this.parent.scrollSettings.enableVirtualization){let t=e.startIndex;const i=e.startIndex;this.parent.viewport.topIndex>=e.startIndex&&(this.parent.viewport.topIndex=e.endIndex+1),e.startIndex=this.parent.viewport.bottomIndex+1,e.endIndex=e.startIndex+o-1;const n=this.parent.skipHidden(e.startIndex,e.endIndex);e.startIndex=n[0],e.endIndex=n[1],this.parent.viewport.bottomIndex=e.endIndex,o>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?(t=t<1?i+1:t-1,this.parent.updateTopLeftCell(t,null),this.parent.renderModule.refreshSheet()):this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"",refresh:"RowPart"},`${_i(e.startIndex,this.parent.viewport.leftIndex)}:${_i(e.endIndex,this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"))}`)}t.showHeaders&&(0===n?h.rows[0]&&h.rows[0].classList.add("e-hide-end"):(h&&h.rows[n-1]&&h.rows[n-1].classList.add("e-hide-start"),h&&h.rows[n]&&h.rows[n].classList.add("e-hide-end")))}else{let a,l,h,c,d,p,g,u,m,f=e.startIndex-1;const b=[];for(let s=e.startIndex,o=e.endIndex;s<=o;s++)if(Ys(t,s))if(void 0===m)if(s>this.parent.viewport.bottomIndex){if(Gs(t,s,{hidden:!1}),void 0===u)return}else{void 0===u&&(u=s),Gs(t,s,{hidden:!1}),this.refreshChart(s,"rows"),void 0===n&&(a=document.createDocumentFragment(),l=document.createDocumentFragment(),d=this.parent.serviceLocator.getService("row"),t.showHeaders&&this.parent.getRowHeaderTable()&&(p=this.parent.getRowHeaderTable().tBodies[0]),g=this.parent.getContentTable()?this.parent.getContentTable().tBodies[0]:this.parent.getContentTable(),s<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex=s),n=0===s?0:this.parent.getViewportIndex(s)),f++,t.showHeaders&&(h=d.refresh(s,null,null,!0),a.appendChild(h),p&&p.childElementCount&&Object(r.J)(p.lastElementChild)),c=l.appendChild(d.refresh(s,c,h)),g&&g.childElementCount&&Object(r.J)(g.lastElementChild);for(let e=this.parent.viewport.leftIndex;e<=this.parent.viewport.rightIndex;e++)if(i=Cs(s,e,t)||{},void 0!==i.rowSpan){const t={range:[s,e,s,e],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(hn,t),b.length&&t.range[1]===b[b.length-1].range[1]||b.push(t)}}else o=s;else{if(e.startIndex===e.endIndex)return;void 0===n?f++:m=s}if(this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),o=this.parent.hiddenCount(this.parent.viewport.topIndex,e.startIndex)+this.parent.hiddenCount(e.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=o,e.insertIdx=n,e.row=l.querySelector(".e-row"),e.mergeCollection=b,t.showHeaders&&(e.hdrRow=a.querySelector(".e-row"),0!==n&&!Ys(t,f-1)&&p.children[n-1]&&p.children[n-1].classList.remove("e-hide-start"),0!==e.startIndex&&Ys(t,e.startIndex-1)&&e.hdrRow.classList.add("e-hide-end"),Ys(t,f+1)?a.lastElementChild.classList.add("e-hide-start"):p.children[n]&&p.children[n].classList.remove("e-hide-end")),c&&g&&g.children[n]){s=Vr(t,f+1,!0);for(let e=this.parent.viewport.leftIndex;e<=this.parent.viewport.rightIndex;e++){const i=this.parent.getCellStyleValue(["borderTop"],[s,e]).borderTop;if(""!==i){this.parent.notify(rn,{onActionUpdate:!1,rowIdx:s,colIdx:e,style:{borderTop:i},pRow:c,cell:g.children[n].children[e],first:""});const r=Vr(t,u-1,!1);r>-1?!g.children[n-1]||this.parent.getCellStyleValue(["borderBottom"],[r,e]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[u,e]).borderTop||(g.children[n-1].children[e].style.borderBottom=""):g.children[n].children[e].style.borderTop=""}}}if(e.skipAppend)return;Math.abs(f-u)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet():(t.showHeaders&&p&&p.insertBefore(a,p.children[n]),g&&g.insertBefore(l,g.children[n]),this.parent.selectRange(t.selectedRange),e.autoFit&&t.showHeaders&&this.parent.notify(xn,{startIndex:e.startIndex,endIndex:e.endIndex,isRow:!0}),b.forEach(e=>{this.parent.notify(ln,e)}),void 0!==m&&m!==e.endIndex&&(e.startIndex=m,this.hideRow(e)))}}hideCol(e){const t=this.parent.getActiveSheet(),i=[],n=[],s=Bi(t.topLeftCell);let r;for(let a=e.startIndex;a<=e.endIndex;a++)(e.hide?!ir(t,a):ir(t,a))&&(Qs(t,a,{hidden:e.hide}),this.refreshChart(a,"columns"),this.parent.scrollSettings.enableVirtualization&&(a<this.parent.viewport.leftIndex||a>this.parent.viewport.rightIndex)?a<this.parent.viewport.leftIndex&&n.push(a):(i.push(a),e.hide&&s[1]===a&&(r=!0)));if(n.length||i.length)if(e.hide){if(!i.length)return;if((i.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization)&&this.removeCell(t,i),this.parent.scrollSettings.enableVirtualization){if(i[0]===this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex=Vr(t,i[i.length-1]+1,!0,"columns")),r){let e=0;if(i.slice(0,i.indexOf(s[1])).forEach(i=>{e+=er(t,i,!0)}),e){this.parent.notify("setScrollEvent",{set:!1});const t=this.parent.getMainContent();t.scrollLeft-=e,this.parent.notify("onContentScroll",{scrollLeft:t.scrollLeft,preventScroll:!0,skipHidden:!0}),nr(()=>this.parent.notify("setScrollEvent",{set:!0}))}}if(this.parent.scrollSettings.isFinite){const e=Vr(t,t.colCount-1,!1,"columns"),n=this.parent.viewport.leftIndex,s=this.parent.viewport.rightIndex;if(s+i.length>=e){const r=Vr(t,n-(s+i.length-e),!1,"columns");return r>-1&&(this.parent.viewport.leftIndex=r,this.parent.viewport.leftIndex-=this.parent.hiddenCount(s,e)),this.parent.viewport.rightIndex=e,n!==this.parent.viewport.leftIndex||s!==this.parent.viewport.rightIndex?this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Vr(t,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}):this.parent.notify("updateTableWidth",{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(t.selectedRange)}}if(i.length<=this.parent.getThreshold("col")){const e=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+i.length,"columns");this.parent.viewport.rightIndex=e[1],this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:e[0],direction:"",refresh:"ColumnPart"},`${zi([this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])}`)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Vr(t,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})}this.parent.selectRange(t.selectedRange)}else{if(n.length){if(n.sort((e,t)=>e-t),this.parent.scrollSettings.enableVirtualization&&n[0]<this.parent.getThreshold("col")){const e=Bi(t.topLeftCell)[0]+1;this.parent.setSheetPropertyOnMute(t,"topLeftCell",`A${e}`),this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column"}),this.parent.selectRange(t.selectedRange)}else this.parent.goTo(_i(this.parent.viewport.topIndex,n[0]));return}i.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization?(this.appendCell(t,i),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:{rowCount:t.rowCount,colCount:t.colCount}})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Vr(t,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(t.selectedRange)}}removeCell(e,t){let i,n,s,a,o,l=0;const h=this.parent.getViewportIndex(t[0],!0)+1;let c;this.parent.scrollSettings.enableVirtualization?(i=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(i=0,n=e.rowCount-1);const d=this.parent.getContentTable();let p;const g=d.getElementsByTagName("colgroup")[0];if(e.showHeaders){const e=this.parent.getColHeaderTable();o=e.getElementsByTagName("colgroup")[0],s=e.rows[0]}const u=t.length-1;for(;i<=n;)Ys(e,i)?i++:(a=d.rows[l],t.forEach((n,d)=>{if(Object(r.J)(a.cells[h]),0===l&&(e.showHeaders&&(Object(r.J)(s.cells[h]),Object(r.J)(o.children[h])),Object(r.J)(g.children[h])),0===d&&(c=Cs(i,n,e)||{},void 0!==c.colSpan&&(void 0===c.rowSpan||c.colSpan>1)&&this.parent.notify("hiddenMerge",{rowIdx:i,colIdx:n,model:"col",start:t[0],end:t[u]})),d===u){p=Vr(e,n+1,!0,"columns");const s=this.parent.getCellStyleValue(["borderLeft"],[l,p]).borderLeft;""!==s&&this.parent.notify(rn,{onActionUpdate:!1,rowIdx:l,colIdx:p,style:{borderLeft:s},row:a,first:""}),c=Cs(i,n,e)||{},void 0!==c.colSpan&&(void 0===c.rowSpan||c.colSpan>1)&&this.parent.notify("hiddenMerge",{rowIdx:i,colIdx:n,model:"col",start:t[0],end:t[u],isEnd:!0})}}),i++,l++);h-1>-1&&e.showHeaders&&s.cells[h-1]&&s.cells[h-1].classList.add("e-hide-start"),e.showHeaders&&s.cells[h]&&s.cells[h].classList.add("e-hide-end")}appendCell(e,t){let i,n,s,a,o,l,h=0;this.parent.scrollSettings.enableVirtualization?(i=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(i=0,n=e.rowCount-1);const c=this.parent.getContentTable(),d=this.parent.getColHeaderTable(),p=c.getElementsByTagName("colgroup")[0];e.showHeaders&&(o=d.getElementsByTagName("colgroup")[0],s=d.rows[0]);const g=this.parent.serviceLocator.getService("cell");let u;t.sort((e,t)=>e-t);const m=[],f=[];let b,y;const x=t.length-1;for(;i<=n;)Ys(e,i)?i++:(a=c.rows[h],t.forEach((n,c)=>{if(0===h&&(f[c]=this.parent.getViewportIndex(n,!0),p.children[f[c]]?(p.insertBefore(this.parent.sheetModule.updateCol(e,n),p.children[f[c]]),e.showHeaders&&(y=s.cells[f[c]],0===c&&t[c]&&!ir(e,t[c]-1)&&y.previousElementSibling.classList.remove("e-hide-start"),s.insertBefore(g.renderColHeader(n),y),c===x&&y.classList.remove("e-hide-end"))):(p.appendChild(this.parent.sheetModule.updateCol(e,n)),e.showHeaders&&s.appendChild(g.renderColHeader(n))),Object(r.J)(p.lastChild),e.showHeaders&&(Object(r.J)(s.lastChild),c===x&&(Object(r.J)(o),d.insertBefore(p.cloneNode(!0),d.tHead[0])))),Object(r.J)(a.lastChild),y=a.cells[f[c]],b=g.render({rowIdx:i,colIdx:n,cell:Cs(i,n,e),address:_i(i,n),lastCell:n===x,isHeightCheckNeeded:!0,first:n!==Vr(e,0,!0,"columns")&&n===this.parent.viewport.leftIndex?"Column":"",checkNextBorder:c===x?"Column":""}),y?a.insertBefore(b,y):a.appendChild(b),0===c&&b.previousSibling&&""!==this.parent.getCellStyleValue(["borderLeft"],[h,Vr(e,t[t.length-1]+1,!0,"columns")]).borderLeft&&(l=Vr(e,t[0]-1,!1,"columns"),l>-1&&!this.parent.getCellStyleValue(["borderRight"],[h,l]).borderRight&&!this.parent.getCellStyleValue(["borderLeft"],[h,t[0]]).borderLeft&&(b.previousSibling.style.borderRight="")),u=Cs(h,n,e)||{},void 0!==u.colSpan&&(void 0===u.rowSpan||u.colSpan>1)){const e={range:[h,n,h,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(hn,e),m.length&&e.range[1]===m[m.length-1].range[1]||m.push(e)}}),i++,h++);m.forEach(e=>{this.parent.notify(ln,e)}),this.parent.viewport.rightIndex=Vr(e,this.parent.viewport.rightIndex-t.length,!1,"columns")}refreshChart(e,t){this.parent.notify("refreshChart",{rIdx:e,showHide:t})}addEventListener(){this.parent.on("hideShow",this.hideShow,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.off("hideShow",this.hideShow),this.parent.off("spreadsheetDestroyed",this.destroy)}}class ia{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("initiateHyperlink",this.initiateHyperlinkHandler,this),this.parent.on("editHyperlink",this.editHyperlinkHandler,this),this.parent.on("openHyperlink",this.openHyperlinkHandler,this),this.parent.on("click",this.hyperlinkClickHandler,this),this.parent.on("createHyperlinkElement",this.createHyperlinkElementHandler,this),this.parent.on(mn,this.keyUpHandler,this),this.parent.on("deleteHyperlink",this.removeHyperlink,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("initiateHyperlink",this.initiateHyperlinkHandler),this.parent.off("editHyperlink",this.editHyperlinkHandler),this.parent.off("openHyperlink",this.openHyperlinkHandler),this.parent.off("click",this.hyperlinkClickHandler),this.parent.off("createHyperlinkElement",this.createHyperlinkElementHandler),this.parent.off(mn,this.keyUpHandler),this.parent.off("deleteHyperlink",this.removeHyperlink))}getModuleName(){return"spreadsheetHyperlink"}keyUpHandler(e){const t=e.target;if(Object(r.D)(t,".e-document")){const e=document.querySelector(".e-hyp-text"),i=this.parent.element.querySelector(".e-hyperlink-alert-span"),n=(Object(r.D)(t,".e-hyperlink-dlg")||Object(r.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;e&&e.value&&(cs(e.value.toUpperCase())?i&&(i.remove(),n.removeAttribute("disabled")):(this.showDialog(),n.setAttribute("disabled","true")))}if(t.classList.contains("e-text")&&Object(r.D)(t,".e-cont")&&Object(r.D)(t,".e-webpage")&&Object(r.D)(t,".e-webpage").getElementsByClassName("e-cont")[1]===t.parentElement){const e=(Object(r.D)(t,".e-hyperlink-dlg")||Object(r.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?e.removeAttribute("disabled"):Object(r.D)(t,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||e.setAttribute("disabled","true")}}initiateHyperlinkHandler(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.getActiveSheet();if(!t.isProtected||t.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){const t=this.parent.serviceLocator.getService(Ma);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:e.getConstant("InsertLink"),beforeOpen:e=>{const i={dialogName:"InsertLinkDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.hyperlinkContent(),t.dialogInstance.dataBind(),Ur(this.parent.element)},open:()=>{setTimeout(()=>{Ur(t.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},buttons:[{buttonModel:{content:e.getConstant("Insert"),isPrimary:!0,disabled:!0},click:()=>{this.dlgClickHandler(),t.hide()}}]})}}else this.parent.notify("editAlert",null)}dlgClickHandler(){let e,t;const i=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(i)if(i.querySelector(".e-webpage"))e=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,t=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value,this.parent.insertHyperlink({address:t},this.parent.getActiveSheet().activeCell,e,!1);else{e=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,t=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;const n=i.getElementsByClassName("e-cont")[2];if(n.getElementsByClassName("e-list-item")[0].querySelector(".e-active"))t=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+t.toUpperCase(),this.parent.insertHyperlink({address:t},this.parent.getActiveSheet().activeCell,e,!1);else if(n.querySelector(".e-active")){const t=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent;for(let i=0;i<this.parent.definedNames.length;i++)this.parent.definedNames[i].name===t&&this.parent.insertHyperlink({address:this.parent.definedNames[i].name},this.parent.getActiveSheet().activeCell,e,!1)}}}showDialog(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)}editHyperlinkHandler(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.serviceLocator.getService(Ma);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:e.getConstant("EditLink"),beforeOpen:e=>{const i={dialogName:"EditLinkDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.hyperEditContent(),t.dialogInstance.dataBind(),Ur(this.parent.element)},open:()=>{setTimeout(()=>{t.dialogInstance.element.querySelector(".e-webpage")?Ur(t.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):Ur(t.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:e.getConstant("Update"),isPrimary:!0},click:()=>{this.dlgClickHandler(),t.hide()}}]})}openHyperlinkHandler(){const e=Bi(this.parent.getActiveSheet().activeCell);let t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)}hlOpenHandler(e){if(e.classList.contains("e-hyperlink")){let t,i=["",""],n=!0;e.style.color="#551A8B",Object(r.D)(e,".e-cell")&&(Object(r.D)(e,".e-cell").style.color="#551A8B");let s=this.parent.getActiveSheet();const a=parseInt(e.parentElement.getAttribute("aria-colindex"),10)-1,o=parseInt(e.parentElement.parentElement.getAttribute("aria-rowindex"),10)-1;let l,h=s.rows[o].cells[a].hyperlink;const c={hyperlink:h,cell:this.parent.getActiveSheet().activeCell,target:"_blank",cancel:!1};if(this.parent.trigger("beforeHyperlinkClick",c),c.cancel)return;h=c.hyperlink;const d={hyperlink:h,cell:this.parent.getActiveSheet().activeCell};"string"==typeof h&&(l=h),"object"==typeof h&&(l=h.address);const p=l;if(-1===l.indexOf("http://")&&-1===l.indexOf("https://")&&-1===l.indexOf("ftp://")){if(!Object(r.Z)(l)){if(this.parent.definedNames)for(let t=0;t<this.parent.definedNames.length;t++)if(this.parent.definedNames[t].name===l){l=this.parent.definedNames[t].refersTo,l=l.slice(1);break}let e,a;-1!==l.indexOf("!")?(i=l.split("!"),-1!==i[0].indexOf(" ")&&(i[0]=i[0].slice(1,i[0].length-1))):(i[0]=this.parent.getActiveSheet().name,i[1]=l);for(let t=0;t<this.parent.sheets.length;t++)this.parent.sheets[t].name===i[0]&&(e=t);if(s=this.parent.sheets[e],-1!==i[1].indexOf(":")){const e=i[1].indexOf(":");let r=i[1].substr(0,e),a=i[1].substr(e+1,i[1].length);r=r.replace("$",""),a=a.replace("$",""),a.match(/\D/g)&&!a.match(/[0-9]/g)&&r.match(/\D/g)&&!r.match(/[0-9]/g)?(r+="1",a+=s.rowCount,i[1]=r+":"+a):!a.match(/\D/g)&&a.match(/[0-9]/g)&&!r.match(/\D/g)&&r.match(/[0-9]/g)&&(t=[parseInt(r,10)-1,0,parseInt(a,10)-1,s.colCount-1],n=!1)}const o=this.parent.definedNames;if(!Object(r.Z)(o))for(let t=0;t<o.length;t++)if(o[t].name===p){a=!0;break}if(cs(i[1])||a){if(t=n?Ni(i[1]):t,this.parent.scrollSettings.enableVirtualization&&(t[0]=t[0]>=this.parent.viewport.topIndex?t[0]-this.parent.viewport.topIndex:t[0],t[1]=t[1]>=this.parent.viewport.leftIndex?t[1]-this.parent.viewport.leftIndex:t[1]),!Object(r.Z)(s)){let i=zi(t);if(s===this.parent.getActiveSheet())nr(()=>{this.parent.goTo(i)});else{if(i.indexOf(":")>=0){const e=i.split(":");i=e[0]===e[1]?e[0]:i}nr(()=>{this.parent.goTo(this.parent.sheets[e].name+"!"+i)})}}}else this.showInvalidHyperlinkDialog()}}else this.isValidUrl(l)?window.open(l,c.target):this.showInvalidHyperlinkDialog();this.parent.trigger("afterHyperlinkClick",d)}}isValidUrl(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}showInvalidHyperlinkDialog(){const e=this.parent.serviceLocator.getService(Ma),t=this.parent.serviceLocator.getService(Da);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:()=>{e.hide()}}]},!1)}hyperlinkClickHandler(e){const t=e.target;if(Object(r.D)(t,".e-link-dialog")&&Object(r.D)(t,".e-toolbar-item")){const e=Object(r.D)(t,".e-hyperlink-dlg")||Object(r.D)(t,".e-edithyperlink-dlg"),i=e.getElementsByClassName("e-footer-content")[0].firstChild,n=e.querySelector(".e-document"),s=e.querySelector(".e-webpage"),a=s?s.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,o=n?n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:a;if(Object(r.D)(t,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){const e=n.querySelectorAll(".e-cont")[2].querySelector(".e-active");n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=a,Object(r.D)(e,".e-list-item").classList.contains("e-level-2")&&i.hasAttribute("disabled")?i.removeAttribute("disabled"):Object(r.D)(e,".e-list-item").classList.contains("e-level-1")&&!i.hasAttribute("disabled")&&i.setAttribute("disabled","true")}else{const e=!s.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;s.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=o,e&&!i.hasAttribute("disabled")?i.setAttribute("disabled","true"):!e&&i.hasAttribute("disabled")&&i.removeAttribute("disabled")}}if(Object(r.D)(t,".e-list-item")&&t.classList.contains("e-fullrow")){const e=this.parent.element.getElementsByClassName("e-link-dialog")[0].getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0].getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0],i=(Object(r.D)(t,".e-hyperlink-dlg")||Object(r.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;Object(r.D)(t,".e-list-item").classList.contains("e-level-2")?("defName"===Object(r.D)(t,".e-list-item").getAttribute("data-uid")?e.classList.contains("e-disabled")||e.hasAttribute("readonly")||(e.setAttribute("readonly","true"),e.classList.add("e-disabled"),e.setAttribute("disabled","true")):"sheet"===Object(r.D)(t,".e-list-item").getAttribute("data-uid")&&e.classList.contains("e-disabled")&&e.hasAttribute("readonly")&&(e.removeAttribute("readonly"),e.classList.remove("e-disabled"),e.removeAttribute("disabled")),i.hasAttribute("disabled")&&i.removeAttribute("disabled")):Object(r.D)(t,".e-list-item").classList.contains("e-level-1")&&i.setAttribute("disabled","true")}else this.hlOpenHandler(t)}createHyperlinkElementHandler(e){const t=e.cell,i=e.td,n=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"});if(n.style.color="#00e",Object(r.Z)(t.hyperlink))i.querySelector("a")&&t.hyperlink&&"string"==typeof t.hyperlink&&i.querySelector("a").setAttribute("href",t.hyperlink);else{let e=t.hyperlink;"string"==typeof e?(-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&-1===e.indexOf("ftp://")&&-1!==e.indexOf("www.")&&(e="http://"+e),0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("ftp://")?(n.setAttribute("href",e),n.setAttribute("target","_blank")):(e.includes("=")||e.includes("!"))&&n.setAttribute("ref",e),n.innerText=""!==i.innerText?i.innerText:e,i.textContent="",i.innerText="",i.appendChild(n)):"object"==typeof e&&(0===e.address.indexOf("http://")||0===e.address.indexOf("https://")||0===e.address.indexOf("ftp://")?(n.setAttribute("href",e.address),n.setAttribute("target","_blank")):(e.address.includes("=")||e.address.includes("!"))&&n.setAttribute("ref",e.address),"Accounting"===pn(t.format)?n.innerHTML=i.innerHTML:n.innerText=""!==i.innerText?i.innerText:e.address,i.textContent="",i.innerText="",i.appendChild(n))}}hyperEditContent(){let e=!0;const t=this.hyperlinkContent(),i=Ni(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[i[0]].cells[i[1]];this.parent.scrollSettings.enableVirtualization&&(i[0]=i[0]-this.parent.viewport.topIndex,i[1]=i[1]-this.parent.viewport.leftIndex);let s,r=this.parent.getDisplayText(n);const a=n.hyperlink;"string"==typeof a?(s=a,r=r||s,-1===s.indexOf("http://")&&-1===s.indexOf("https://")&&-1===s.indexOf("ftp://")&&(e=!1)):"object"==typeof a&&(s=a.address,r=r||s,-1===s.indexOf("http://")&&-1===s.indexOf("https://")&&-1===s.indexOf("ftp://")&&(e=!1));let o=0,l=0;const h=this.parent.definedNames,c=this.parent.sheets;for(let p=0,g=h.length;p<g;p++)h[p].name===s&&o++;for(let p=0,g=c.length;p<g;p++)s.includes(c[p].name)&&l++;0===o&&0===l&&(e=!0);const d=t.querySelector(".e-content");if(e){const e=d.querySelector(".e-webpage");e.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",r),"string"==typeof a?e.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a):e.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a.address)}else{let e;const t=d.querySelector(".e-document");let i;if(t.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",r),this.parent.definedNames)for(let n=0;n<this.parent.definedNames.length;n++)if(this.parent.definedNames[n].name===s){e=!0;break}if(e){const e=t.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];e.setAttribute("readonly","true"),e.classList.add("e-disabled"),e.setAttribute("disabled","true");const i=t.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(let t=0;t<i.getElementsByTagName("li").length;t++)i.getElementsByTagName("li")[t].innerText===s&&i.getElementsByTagName("li")[t].classList.add("e-active")}else{s&&-1!==s.indexOf("!")&&(i=s.split("!"));const e=i[0];t.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",i[1]);const n=t.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0];for(let t=0;t<n.getElementsByTagName("li").length;t++)if(n.getElementsByTagName("li")[t].innerText===e){if(n.getElementsByTagName("li")[t].classList.contains("e-active"))break;n.getElementsByTagName("li")[t].classList.add("e-active")}else n.getElementsByTagName("li")[t].classList.contains("e-active")&&n.getElementsByTagName("li")[t].classList.remove("e-active")}}return t}hyperlinkContent(){const e=this.parent.serviceLocator.getService(Da);let t,i,n=0,s=0,a=!0,l=!0;const h=Ni(this.parent.getActiveSheet().activeCell),c=this.parent.getActiveSheet(),d=Cs(h[0],h[1],c);let p=!0;if(d){p=!!(d.value&&"string"==typeof d.value&&null!==d.value.match("[A-Za-z]+")||""===d.value||Object(r.Z)(d.value));const e=d.hyperlink;if("string"==typeof e){const t=e;-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&-1===t.indexOf("ftp://")&&(i=e,a=!1)}else if("object"==typeof e){const t=e.address;-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&-1===t.indexOf("ftp://")&&(i=e.address,a=!1)}if(i){let e=0,t=0;const n=this.parent.definedNames,s=this.parent.sheets;for(let r=0,a=s.length;r<a;r++)i.includes(s[r].name)&&t++;for(let r=0,a=n.length;r<a;r++)n[r].name===i&&e++;0===e&&0===t&&(a=!0)}if(s=a?0:1,this.parent.definedNames)for(let n=0;n<this.parent.definedNames.length;n++)if(this.parent.definedNames[n].name===i){t=!0,l=!1;break}}const g=this.parent.createElement("div",{className:"e-link-dialog"}),u=this.parent.createElement("div",{className:"e-webpage"}),m=this.parent.createElement("div",{className:"e-document"});new o.g({selectedItem:s,items:[{header:{text:e.getConstant("WebPage")},content:u},{header:{text:e.getConstant("ThisDocument")},content:m}]}).appendTo(g),a?g.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):g.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");const f=this.parent.createElement("div",{className:"e-cont"}),b=this.parent.createElement("div",{className:"e-cont"}),y=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("DisplayText")}),x=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Url")}),C=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});p||(C.classList.add("e-disabled"),C.setAttribute("readonly","true"),C.setAttribute("disabled","true")),d&&Object(r.Z)(d.hyperlink)&&C.setAttribute("value",this.parent.getDisplayText(d));const v=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});C.setAttribute("placeholder",e.getConstant("EnterTheTextToDisplay")),v.setAttribute("placeholder",e.getConstant("EnterTheUrl")),f.appendChild(C),f.insertBefore(y,C),b.appendChild(v),b.insertBefore(x,v),u.appendChild(b),u.insertBefore(f,b);const S=[],w=[],I=this.parent.sheets;for(;n<this.parent.sheets.length;n++){const e=this.parent.sheets[n].name;"Visible"===this.parent.sheets[n].state&&(I[n]===this.parent.getActiveSheet()?S.push({nodeId:"sheet",nodeText:-1!==e.indexOf(" ")?"'"+e+"'":e,selected:!0}):S.push({nodeId:"sheet",nodeText:-1!==e.indexOf(" ")?"'"+e+"'":e}))}for(n=0;n<this.parent.definedNames.length;n++)w.push({nodeId:"defName",nodeText:this.parent.definedNames[n].name});const O=[{nodeId:"01",nodeText:e.getConstant("CellReference"),expanded:l,nodeChild:S},{nodeId:"02",nodeText:e.getConstant("DefinedNames"),expanded:t,nodeChild:w}],R=new o.i({fields:{dataSource:O,id:"nodeId",text:"nodeText",child:"nodeChild"}}),A=this.parent.createElement("div",{className:"e-cont"}),k=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("CellReference")}),E=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});E.setAttribute("value","A1"),A.appendChild(E),A.insertBefore(k,E);const L=this.parent.createElement("div",{className:"e-cont"}),T=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("DisplayText")}),j=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});p||(j.classList.add("e-disabled"),j.setAttribute("readonly","true"),j.setAttribute("disabled","true")),d&&Object(r.Z)(d.hyperlink)&&j.setAttribute("value",this.parent.getDisplayText(d)),j.setAttribute("placeholder",e.getConstant("EnterTheTextToDisplay")),L.appendChild(j),L.insertBefore(T,j);const D=this.parent.createElement("div",{className:"e-cont"}),M=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Sheet")}),F=this.parent.createElement("div",{className:"e-refcont"});return D.appendChild(F),D.insertBefore(M,F),m.appendChild(A),m.insertBefore(L,A),R.appendTo(F),m.appendChild(D),g}removeHyperlink(e){const t=Cs(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&(t.value="string"==typeof t.hyperlink?t.value?t.value:t.hyperlink:t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify("refreshRibbonIcons",null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refreshRange([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx])))}}class na{constructor(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}setActionData(e){const t=this.parent.getActiveSheet();let i,n=[],s=[];const r=e.args,a=r.eventArgs;let o={};switch(r.action){case"format":i=Ni(r.eventArgs.range);break;case"clipboard":o=a.copiedInfo,i=Ni(qi(a.pastedRange)),o&&o.isCut&&(s=this.getCellDetails(o.range,Fs(this.parent,Ts(this.parent,o.sId))));break;case"beforeSort":i=Ni(r.eventArgs.range),i[0]===i[2]&&i[2]-i[0]==0&&(i[0]=0,i[1]=0,i[2]=t.usedRange.rowIndex,i[3]=t.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":i=Ni(a.address);break;case"beforeWrap":case"beforeReplace":i=this.parent.getAddressInfo(a.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":i=Ni(a.range)}n=this.getCellDetails(i,t),this.beforeActionData={cellDetails:n,cutCellDetails:s}}getBeforeActionData(e){e.beforeDetails=this.beforeActionData}performUndoRedo(e){let t=e.isUndo?this.undoCollection.pop():this.redoCollection.pop();if(this.isUndo=e.isUndo,t){switch(t.action){case"cellSave":case"format":case"sorting":case"wrap":case"cellDelete":t=this.performOperation(t);break;case"clipboard":t=this.undoForClipboard(t);break;case"resize":t=this.undoForResize(t);break;case"hideShow":t.eventArgs.hide=!t.eventArgs.hide,jr(t,this.parent);break;case"replace":t=this.performOperation(t);break;case"insert":case"filter":case"delete":case"validation":jr(t,this.parent,!e.isUndo);break;case"merge":t.eventArgs.merge=!t.eventArgs.merge,jr(t,this.parent);break;case"clear":t=this.performOperation(t);break;case"conditionalFormat":jr(t,this.parent,!e.isUndo,this.undoCollection);break;case"clearCF":case"insertImage":case"imageRefresh":jr(t,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":jr(t,this.parent,!e.isUndo)}e.isUndo?this.redoCollection.push(t):this.undoCollection.push(t),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons();const i=Object.assign({},t.eventArgs);i.requestType=e.isUndo?"undo":"redo",delete i.beforeActionData,e.isPublic||(this.parent.notify("triggerDataChange",Object(r.L)({isUndo:e.isUndo},t,null,!0)),this.parent.notify(Cn,{eventArgs:i,action:"undoRedo"})),this.parent.notify("refreshRibbonIcons",null)}}updateUndoRedoCollection(e){const t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);const i=e.args.action;if(-1===t.indexOf(i)&&!e.isPublic)return;const n=e.args.eventArgs;if("clipboard"===i||"sorting"===i||"format"===i||"cellSave"===i||"wrap"===i||"replace"===i||"validation"===i||"clear"===i||"conditionalFormat"===i||"clearCF"===i||"insertImage"===i||"imageRefresh"===i||"insertChart"===i||"chartRefresh"===i||"filter"===i||"cellDelete"===i){const e={beforeDetails:{cellDetails:[]}};this.parent.notify("getBeforeActionData",e),n.beforeActionData=e.beforeDetails}if("clipboard"===i&&n.copiedInfo.isExternal){const e=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(e.indices,Fs(this.parent,e.sheetIndex))}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}clearUndoRedoCollection(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()}updateUndoRedoIcons(){const e=this.parent.serviceLocator.getService(Da);this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])}undoForClipboard(e){const t=e.eventArgs,i=t.pastedRange.split("!"),n=Ni(i[1]),s=Ls(this.parent,i[0]),r=Fs(this.parent,s),a=t.copiedInfo,o=t.beforeActionData,l=this.checkRefreshNeeded(s);let h;if("imagePaste"===e.eventArgs.requestType){const e=t.copiedShapeInfo;this.isUndo?(h=e.pictureElem,e.isCut?(this.parent.notify("deleteImage",{id:h.id,sheetIdx:t.pasteSheetIndex+1}),this.parent.notify("createImageElement",{options:{src:h.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:e.height,width:e.width,imageId:h.id},range:e.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify("deleteImage",{id:t.pastedPictureElement.id,sheetIdx:t.pasteSheetIndex+1})):e.isCut?(h=e.pictureElem,this.parent.notify("deleteImage",{id:h.id,sheetIdx:e.sId}),this.parent.notify("createImageElement",{options:{src:h.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:e.height,width:e.width,imageId:h.id},range:e.pastedRange,isPublic:!1,isUndoRedo:!0})):(h=t.pastedPictureElement,this.parent.notify("createImageElement",{options:{src:h.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:h.offsetHeight,width:h.offsetWidth,imageId:h.id},range:e.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(this.isUndo){if(a.isCut){this.updateCellDetails(o.cutCellDetails,Fs(this.parent,Ts(this.parent,a.sId)),Wi(a.range),l),this.parent.notify("getFilteredCollection",null);for(let e=0;e<this.parent.sheets.length;e++){const i=Ts(this.parent,a.sId);if(this.parent.filterCollection&&this.parent.filterCollection[e]&&this.parent.filterCollection[e].sheetIndex===t.pasteSheetIndex){const s=this.parent.filterCollection[e],r=Ni(s.filterRange),o=Wi(n);if(r[0]>=o[0]&&r[2]<=o[2]){this.parent.notify("initiateFilterUI",{predicates:null,range:s.filterRange,sIdx:t.pasteSheetIndex,isCut:!0});let e=[Math.abs(o[0]-r[0]),Math.abs(o[1]-r[1]),Math.abs(o[2]-r[2]),Math.abs(o[3]-r[3])];const n=Wi(a.range);e=[n[0]+e[0],n[1]+e[1],Math.abs(n[2]-e[2]),Math.abs(n[3]-e[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:zi(e),sIdx:i,isCut:!0})}}}}o&&this.updateCellDetails(o.cellDetails,r,n,l),_r(r,n[0],n[1],20);const e=zr(r,n[0]);Mr(this.parent,r,e,n[0]),t.mergeCollection.forEach(e=>{e.merge=!e.merge,this.parent.notify(ln,e),e.merge=!e.merge})}else if(a.isExternal){const e=this.parent.getAddressInfo(t.pastedRange);this.updateCellDetails(a.cellDetails,Fs(this.parent,e.sheetIndex),e.indices,!0)}else jr(e,this.parent,a.isCut);l&&this.parent.notify("selectRange",{address:i[1]})}return e}undoForResize(e){const t=e.eventArgs;if(void 0===t.hide)if(t.isCol){const e=t.oldWidth;t.oldWidth=t.width,t.width=e}else{const e=t.oldHeight;t.oldHeight=t.height,t.height=e}else t.hide=!t.hide;jr(e,this.parent);const i=this.parent.getActiveSheet(),n=Ni(i.activeCell),s=Cs(n[0],n[1],i);if(s&&s.rowSpan){const e=this.parent.getCell(n[0],n[1]);this.parent.element.querySelector(".e-active-cell").style.height=e.offsetHeight+"px"}else if(s&&s.colSpan){const e=this.parent.getCell(n[0],n[1]);this.parent.element.querySelector(".e-active-cell").style.width=e.offsetWidth+"px"}return e}performOperation(e){const t=e.eventArgs,i="cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action?t.address.split("!"):t.range.split("!"),n=Ni(i[1]),s=n,a=Ls(this.parent,i[0]),o=Fs(this.parent,a),l=t.beforeActionData,h=this.checkRefreshNeeded(a),c={cellIdx:[n[0],n[1]],isUnique:!1,uniqueRange:""};if(this.parent.notify("checkUniqueRange",c),this.isUndo){if(c.isUnique&&t.formula&&t.formula.indexOf("UNIQUE")>-1){const e=Ni(c.uniqueRange);if("#SPILL!"!==Cs(e[0],e[1],this.parent.getActiveSheet()).value)for(let t=e[0];t<=e[2];t++)for(let i=e[1];i<=e[3];i++)t===e[0]&&i===e[1]&&(i+=1),this.parent.updateCell({value:""},zi([t,i]))}if(this.updateCellDetails(l.cellDetails,o,n,h,e),c.isUnique&&"cellDelete"===e.action&&t.isSpill){const e=Ni(c.uniqueRange),t=Cs(e[0],e[1],this.parent.getActiveSheet());for(let i=e[0];i<=e[2];i++)for(let t=e[1];t<=e[3];t++)for(let e=n[0];e<=n[2];e++)for(let s=n[1];s<=n[3];s++)i===e&&t===s||this.parent.updateCell({value:""},_i(i,t));t.value="#SPILL!",this.parent.updateCell(t,_i(e[0],e[1]))}if(!t.isSpill&&""!==c.uniqueRange){const e=Ni(c.uniqueRange);for(let t=e[0];t<=e[2];t++)for(let i=e[1];i<=e[3];i++)t===e[0]&&i===e[1]&&(i+=1),this.parent.updateCell({value:""},zi([t,i]));this.parent.notify("reApplyFormula",null)}}else{const i=e.eventArgs,n=Ni(o.activeCell);let a=this.parent.getCellStyleValue(["textDecoration"],n).textDecoration;if(i&&i.style&&i.style.textDecoration){const t=i.style.textDecoration;let r,o=t,l=!1;"underline"===a?o="underline"===t?"none":"underline line-through":"line-through"===a?o="line-through"===t?"none":"underline line-through":"underline line-through"===a&&(o="underline"===t?"line-through":"underline",l=!0),"none"===o&&(l=!0),i.style.textDecoration=o,e.eventArgs=i,this.parent.notify(sn,{style:{textDecoration:o},range:n,refreshRibbon:!0,onActionUpdate:!0});for(let e=s[0];e<=s[2];e++)for(let i=s[1];i<=s[3];i++)if(e!==n[0]||i!==n[1]){if(r={},a=this.parent.getCellStyleValue(["textDecoration"],[e,i]).textDecoration,"none"===a){if(l)continue;r.textDecoration=t}else if("underline"===a||"line-through"===a)if(l){if(t!==a)continue;r.textDecoration="none"}else r.textDecoration=t!==a?"underline line-through":t;else if("underline line-through"===a){if(!l)continue;r.textDecoration="underline"===t?"line-through":"underline"}this.parent.notify(sn,{style:{textDecoration:r.textDecoration},range:[e,i,e,i],refreshRibbon:!0,onActionUpdate:!0})}i.style.textDecoration=t,e.eventArgs=i}else{if(!Object(r.Z)(t.oldValue)&&t.oldValue!==t.value&&c.isUnique){const e=Ni(c.uniqueRange);if("#SPILL!"!==Cs(e[0],e[1],this.parent.getActiveSheet()).value)for(let t=e[0];t<=e[2];t++)for(let i=e[1];i<=e[3];i++)t===e[0]&&i===e[1]&&(this.parent.updateCell({value:"#SPILL!"},zi([e[0],e[1]])),i+=1),this.parent.updateCell({value:""},zi([t,i]))}if(jr(e,this.parent,!0),c.isUnique&&"cellDelete"===e.action&&t.isSpill){const e=Ni(c.uniqueRange);let t=!1;for(let i=e[0];i<=e[1];i++)for(let n=e[1];n<=e[3];n++)i===e[0]&&n===e[1]&&n++,Cs(i,n,o)&&!Object(r.Z)(Cs(i,n,o).value)&&""!==Cs(i,n,o).value&&(t=!0);if(!t){const t=Cs(e[0],e[1],this.parent.getActiveSheet());t.value="",this.parent.updateCell(t,_i(e[0],e[1])),this.parent.notify("reApplyFormula",null)}}}}return h&&this.parent.notify("selectRange",{address:i[1]}),e}getCellDetails(e,t){const i=[];let n;for(let s=(e=Wi(e))[0];s<=e[2];s++)for(let r=e[1];r<=e[3];r++)n=Cs(s,r,t),i.push({rowIndex:s,colIndex:r,format:n?n.format:null,isLocked:n?n.isLocked:null,style:n&&n.style?Object.assign({},n.style):null,value:n?n.value:"",formula:n?n.formula:"",wrap:n&&n.wrap,rowSpan:n&&n.rowSpan,colSpan:n&&n.colSpan,hyperlink:n&&n.hyperlink,image:n&&n.image&&n.chart});return i}updateCellDetails(e,t,i,n,s){const a=e.length;let o;for(let l=0;l<a;l++)vs(e[l].rowIndex,e[l].colIndex,t,{value:e[l].value,format:e[l].format,isLocked:e[l].isLocked,style:e[l].style&&Object.assign({},e[l].style),formula:e[l].formula,wrap:e[l].wrap,rowSpan:e[l].rowSpan,colSpan:e[l].colSpan,hyperlink:e[l].hyperlink}),this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex],value:e[l].formula?e[l].formula:e[l].value}),s&&"wrap"===s.action&&s.eventArgs.wrap&&this.parent.notify("wrapText",{range:[e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex],wrap:!1,sheet:t}),s&&e[l].hyperlink&&"clear"===s.action&&(s.eventArgs.range=t.name+"!"+zi([e[l].rowIndex,e[l].colIndex,e[l].rowIndex,e[l].colIndex]),o=this.parent.getCell(e[l].rowIndex,e[l].colIndex),"Clear All"===s.eventArgs.type||"Clear Hyperlinks"===s.eventArgs.type?this.parent.addHyperlink(e[l].hyperlink,s.eventArgs.range):"Clear Formats"===s.eventArgs.type&&Object(r.w)(o.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"));n&&this.parent.serviceLocator.getService("cell").refreshRange(i)}checkRefreshNeeded(e){let t=!0;return e!==this.parent.activeSheetIndex&&(this.parent.activeSheetIndex=e,this.parent.dataBind(),t=!1),t}addEventListener(){this.parent.on("performUndoRedo",this.performUndoRedo,this),this.parent.on("updateUndoRedoCollection",this.updateUndoRedoCollection,this),this.parent.on("setActionData",this.setActionData,this),this.parent.on("getBeforeActionData",this.getBeforeActionData,this),this.parent.on("clearUndoRedoCollection",this.clearUndoRedoCollection,this),this.parent.on("setUndoRedo",this.updateUndoRedoIcons,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("performUndoRedo",this.performUndoRedo),this.parent.off("updateUndoRedoCollection",this.updateUndoRedoCollection),this.parent.off("setActionData",this.setActionData),this.parent.off("getBeforeActionData",this.getBeforeActionData),this.parent.off("clearUndoRedoCollection",this.clearUndoRedoCollection),this.parent.off("setUndoRedo",this.updateUndoRedoIcons))}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"undoredo"}}class sa{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("wrapText",this.wrapTextHandler,this),this.parent.on("rowHeightChanged",this.rowHeightChangedHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("wrapText",this.wrapTextHandler),this.parent.off("rowHeightChanged",this.rowHeightChangedHandler))}wrapTextHandler(e){if(dr(this.parent,e.range,!0)){let t,i,n,s,a,o;for(let l=e.range[0];l<=e.range[2];l++){a=0,s=Zs(e.sheet,l).customHeight||e.isCustomHgt;for(let h=e.range[1];h<=e.range[3];h++){if(i=Cs(l,h,e.sheet,null,!0),i.rowSpan<0||i.colSpan<0)continue;const c=i.rowSpan>1||i.colSpan>1;if(t=e.initial?e.td:this.parent.getCell(l,h),t&&(e.wrap?t.classList.add(ja):t.classList.remove(ja),(s||c)&&(0===t.children.length||!t.querySelector(".e-wrap-content")))){let e=t.style.cssText;e&&(e=e.split(";").filter(e=>!e.includes("border")).join(";")),t.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:t.innerHTML,styles:e}).outerHTML}if(r.d.isIE&&t.classList.add("e-ie-wrap"),!s&&!c){n=Br(e.sheet,l,h,i.colSpan>1?h+i.colSpan-1:h);let s=this.parent.getDisplayText(i).toString();if(s.indexOf("\n")<0){const e=this.parent.element.querySelector(".e-spreadsheet-edit");e&&e.textContent.indexOf("\n")>-1&&(s=e.textContent)}if(s)if(e.wrap){let r;t&&t.classList.contains("e-alt-unwrap")&&t.classList.remove("e-alt-unwrap");let c,d=0;if(s.indexOf("\n")>-1){const e=s.split("\n"),t=e.length;for(c=0;c<t;c++)r=Nr(e[c],n,i.style,this.parent.cellStyle),0===r&&(r=1),d+=r;r=d}else r=Nr(s,n,i.style,this.parent.cellStyle);if(o=Hr(this.parent,l,h,e.sheet,i.style||this.parent.cellStyle,r),a=Math.max(a,o),i.rowSpan>1){const t=Ks(e.sheet,l,l+(i.rowSpan-1));if(t>=a)return;o=a=Xs(e.sheet,l)+(a-t)}_r(e.sheet,l,h,o)}else s.indexOf("\n")>-1&&t.classList.add("e-alt-unwrap"),o=Hr(this.parent,l,h,e.sheet,i.style||this.parent.cellStyle,1),_r(e.sheet,l,h,o),a=Math.max(zr(e.sheet,l),20);else e.wrap&&s||(_r(e.sheet,l,h,20),a=Math.max(zr(e.sheet,l),20));h===e.range[3]&&(e.wrap&&a>20&&zr(e.sheet,l)<=a||(!e.wrap||!s)&&zr(e.sheet,l)<Xs(e.sheet,l)&&Xs(e.sheet,l)>20)&&Mr(this.parent,e.sheet,a,l,e.row,e.hRow)}}}}}ribbonClickHandler(e){const t=Object(r.D)(e.originalEvent.target,".e-btn");if(t&&t.id===this.parent.element.id+"_wrap"){const e=t.classList.contains("e-active"),n=(i=this.parent.getActiveSheet()).name+"!"+i.selectedRange,s={address:n,wrap:e,cancel:!1};this.parent.notify(vn,{action:"beforeWrap",eventArgs:s}),s.cancel||(ws(this.parent.getActiveSheet().selectedRange,e,this.parent),this.parent.notify(Cn,{action:"wrap",eventArgs:{address:n,wrap:e}}))}var i}rowHeightChangedHandler(e){if(e.isCustomHgt){const t=this.parent.getActiveSheet(),i=this.parent.viewport.leftIndex,n=i+this.parent.viewport.colCount+2*this.parent.getThreshold("col");for(let s=i;s<n;s++){const i=Cs(e.rowIdx,s,t);if(i&&i.wrap){const t=this.parent.getCell(e.rowIdx,s);let i=t.style.cssText;0!==t.children.length&&t.querySelector(".e-wrap-content")||(t.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:t.innerHTML,styles:i}).outerHTML)}}}}getModuleName(){return"wrapText"}destroy(){this.removeEventListener(),this.parent=null}}class ra{constructor(e){this.parent=e,this.addEventListener()}insert(e){let t;switch(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(vn,{eventArgs:e,action:"insert"}),this.parent.notify("beforeInsert",e),e.modelType){case"Sheet":this.parent.notify("insertSheetTab",{startIdx:e.index,endIdx:e.index+(e.model.length-1),preventUpdate:!t}),this.parent.renderModule.refreshSheet(),Ur(this.parent.element);break;case"Row":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.bottomIndex){if(this.parent.scrollSettings.enableVirtualization){if(e.freezePane){this.parent.renderModule.refreshSheet();break}e.index<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===Vr(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:e.index,colIndex:0,refresh:"Row"});this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}break;case"Column":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.rightIndex){if(e.freezePane){this.parent.renderModule.refreshSheet();break}this.parent.scrollSettings.enableVirtualization?(e.index<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Vr(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:e.index,refresh:"Column"}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}}this.refreshImgElement(e.model.length,this.parent.activeSheetIndex,e.modelType,e.index),t&&this.parent.notify(Cn,{eventArgs:e,action:"insert"})}refreshImgElement(e,t,i,n){const s=this.parent.sheets[t];let r;const a=[0,0,s.usedRange.rowIndex,s.usedRange.colIndex];for(let o=0;o<=a[2];o++)for(let l=a[1];l<=a[3];l++)r=Cs(o,l,s),r&&r.image&&r.image.length>0&&("Row"===i&&o>=n||"Column"===i&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:i,count:e,status:"insert"})}addEventListener(){this.parent.on("insert",this.insert,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||this.parent.off("insert",this.insert)}getModuleName(){return"insert"}}class aa{constructor(e){this.parent=e,this.addEventListener()}delete(e){let t;if(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(vn,{eventArgs:e,action:"delete"}),"Sheet"===e.modelType){const t=e.activeSheetIndex>=e.startIndex&&e.activeSheetIndex<=e.endIndex;t&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(e.startIndex<this.parent.sheets.length?e.startIndex:e.startIndex?e.startIndex-1:0)},!0),this.parent.notify("refreshSheetTabs",null),t&&this.parent.renderModule.refreshSheet(),Ur(this.parent.element)}else"Row"===e.modelType?(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.bottomIndex)&&(e.freezePane?this.parent.renderModule.refreshSheet():this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===Vr(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:this.parent.viewport.leftIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:e.startIndex,colIndex:0}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange))):(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.rightIndex)&&(e.freezePane?this.parent.renderModule.refreshSheet():this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===Vr(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,refresh:"Column",colIndex:this.parent.viewport.leftIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:e.startIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)));this.refreshImgElement(e.deletedModel.length,this.parent.activeSheetIndex,e.modelType,e.startIndex),t&&this.parent.notify(Cn,{eventArgs:e,action:"delete"})}refreshImgElement(e,t,i,n){const s=this.parent.sheets[t];let r;const a=[0,0,s.usedRange.rowIndex,s.usedRange.colIndex];for(let o=0;o<=a[2];o++)for(let l=a[1];l<=a[3];l++)r=Cs(o,l,s),r&&r.image&&r.image.length>0&&("Row"===i&&o>=n||"Column"===i&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:i,count:e,status:"delete"})}addEventListener(){this.parent.on("delete",this.delete,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||this.parent.off("delete",this.delete)}getModuleName(){return"delete"}}class oa{constructor(e){this.data=[],this.parent=e,this.addEventListener()}destroy(){this.removeEventListener();const e=Object(r.ob)("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null}addEventListener(){r.l.add(this.parent.element,"dblclick",this.listOpen,this),r.l.add(document,"mousedown",this.mouseDownHandler,this),this.parent.on("initiatedatavalidation",this.initiateDataValidationHandler,this),this.parent.on("invalidData",this.invalidDataHandler,this),this.parent.on("isValidation",this.checkDataValidation,this),this.parent.on("activeCellChanged",this.listHandler,this),this.parent.on(mn,this.keyUpHandler,this),this.parent.on("removeDataValidation",this.removeValidationHandler,this),this.parent.on("validationHighlight",this.InvalidElementHandler,this)}removeEventListener(){r.l.remove(this.parent.element,"dblclick",this.listOpen),r.l.remove(document,"mousedown",this.mouseDownHandler),this.parent.isDestroyed||(this.parent.off("initiatedatavalidation",this.initiateDataValidationHandler),this.parent.off("invalidData",this.invalidDataHandler),this.parent.off("isValidation",this.checkDataValidation),this.parent.off("activeCellChanged",this.listHandler),this.parent.off(mn,this.keyUpHandler),this.parent.off("removeDataValidation",this.removeValidationHandler),this.parent.off("validationHighlight",this.InvalidElementHandler))}removeValidationHandler(e){const t=this.getRange(this.parent.getActiveSheet().selectedRange);this.parent.removeDataValidation(t)}mouseDownHandler(e){const t=e.target,i=Object(r.D)(t,".e-ddl");i&&i.getAttribute("id")===this.parent.element.id+"listValid_popup"&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:t.innerText})}keyUpHandler(e){const t=e.target,i=this.parent.element.querySelector(".e-datavalidation-dlg");if(Object(r.D)(t,".e-values")&&i&&13!==e.keyCode){const e=i.querySelector(".e-values"),t=e.querySelector(".e-dlg-error"),n=i.querySelector(".e-footer-content").querySelector(".e-primary");n.hasAttribute("disabled")&&n.removeAttribute("disabled"),t&&e.removeChild(t)}}listOpen(e){const t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.listObj.showPopup()}invalidDataHandler(e){e.isRemoveHighlight?this.parent.removeInvalidHighlight():this.parent.addInvalidHighlight()}listHandler(){if(this.parent.allowDataValidation){const e=this.parent.getActiveSheet(),t=Bi(e.activeCell),i=Cs(t[0],t[1],e),n=Js(e,t[1]),s=this.parent.getCell(t[0],t[1]);if(!s)return;let a;if(document.getElementsByClassName("e-validation-list")[0]&&(Object(r.kb)(document.getElementsByClassName("e-validation-list")[0]),this.data=[]),i&&i.validation?a=i.validation:n&&n.validation&&(a=n.validation),a&&"List"===a.type&&(a.ignoreBlank=!!Object(r.Z)(a.ignoreBlank)||a.ignoreBlank,a.inCellDropDown=!!Object(r.Z)(a.inCellDropDown)||a.inCellDropDown,a.inCellDropDown)){const t=this.parent.createElement("div",{className:"e-validation-list"}),n=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});t.appendChild(n),a.inCellDropDown||(t.style.display="none"),s.insertBefore(t,s.firstChild);const o=this.updateDataSource(i,a);this.listObj=new c.d({index:this.setDropDownListIndex(o,i,a),dataSource:o,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:()=>this.listValueChange(this.listObj.text),open:t=>{if(t.popup.offsetX=4-(s.offsetWidth-20),t.popup.offsetY=-13,t.popup.element.style.width=s.offsetWidth-1+"px",r.d.isDevice&&this.parent.scrollModule){const i=this.parent.scrollModule.offset,n=this.parent.viewport;t.popup.offsetY+=n.topIndex?i.top.size-Ks(e,n.topIndex+1,i.top.idx,!0):0,t.popup.offsetX+=n.leftIndex?i.left.size-tr(e,n.leftIndex+1,i.left.idx,!0):0,t.popup.refresh()}}}),this.listObj.appendTo("#"+this.parent.element.id+"listValid")}i&&i.validation&&(i.validation=a)}}setDropDownListIndex(e,t,i){if(t&&t.value)for(let n=0,s=e.length;n<s;n++)if(e[n].text===t.value.toString())return n;return null}updateDataSource(e,t){this.data=[];let i=0;const n=t.value1;if(-1!==n.indexOf("=")){const s=n.indexOf("!")>-1?Fs(this.parent,Ls(this.parent,n.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),r=n.indexOf("!")>-1?n.split("!")[1]:n.split("=")[1],a=this.parent.getActiveSheet();if(s.name!==a.name){let i;const n=Ni(a.selectedRange);s.ranges.forEach(e=>{e.info&&e.info.loadedRange&&e.info.loadedRange.length||(i=!0)}),i&&(this.parent.showSpinner(),Is(this.parent,`${s.name}!${r}`).then(()=>{if(this.parent.hideSpinner(),a.name===this.parent.getActiveSheet().name){const i=Ni(this.parent.getActiveSheet().selectedRange);i[0]===n[0]&&i[1]===n[1]&&(this.listObj.dataSource=this.updateDataSource(e,t),this.listObj.dataBind())}}))}let o;const l=r.split(":");if(l[0].match(/[a-z]+$/gi)&&l[1].match(/[a-z]+$/gi)||l[0].match(/^[0-9]/g)&&l[1].match(/^[0-9]/g)){const e=this.parent.getIndexes(r);o=e.isCol?[0,e.startIdx,s.usedRange.rowIndex,e.startIdx]:[e.startIdx,0,e.startIdx,s.usedRange.colIndex]}else o=Ni(r);for(let n=o[0];n<=o[2];n++){s.rows[n]||Gs(s,n,{});for(let r=o[1];r<=o[3];r++){s.rows[n].cells||vs(n,r,s,{}),i+=1;const a=this.parent.getDisplayText(e=s.rows[n].cells[r])||"";t.ignoreBlank&&""===a||this.data.push({text:a,id:"list-"+i})}}}else{const e=n.split(",");for(let t=0;t<e.length;t++)i+=1,this.data.push({text:e[t],id:"list-"+i})}return this.data}listValueChange(e){const t=this.parent.getActiveSheet(),i=Ui(t.activeCell),n=Object.assign({},Cs(i[0],i[1],t));t.isProtected&&us(n,Js(t,i[1]))?this.parent.notify("editAlert",null):(this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:t.activeCell,value:e}),this.parent.serviceLocator.getService("cell").refreshRange(i),this.parent.trigger("cellSave",{value:e,oldValue:n&&n.value,address:t.name+"!"+t.activeCell,displayText:this.parent.getDisplayText(Cs(i[0],i[1],t))}))}getRange(e){const t=this.parent.getActiveSheet(),i=Ni(e),n=t.colCount;return i[2]===t.rowCount-1&&0===i[0]?e=e.replace(/[0-9]/g,""):i[3]===n-1&&0===i[2]&&(e=e.replace(/\D/g,"")),e}initiateDataValidationHandler(){const e=this.parent.serviceLocator.getService(Da);let t,i,n,s,a=!0,o=!0,l=!0;const h=this.parent.getActiveSheet();let c,d=h.selectedRange;const p=Ni(d);d=this.getRange(d);for(let g=p[0];g<=p[2];g++)if(h.rows[g])for(let e=p[1];e<=p[3];e++)h.rows[g].cells&&h.rows[g].cells[e]&&(c=h.rows[g].cells[e],c.validation&&(l=!1,t=c.validation.type,i=c.validation.operator,n=c.validation.value1,s=c.validation.value2,a=Object(r.Z)(c.validation.ignoreBlank)?a:c.validation.ignoreBlank,o=Object(r.Z)(c.validation.inCellDropDown)?o:c.validation.inCellDropDown));if(!this.parent.element.querySelector(".e-datavalidation-dlg")){const r=this.parent.serviceLocator.getService(Ma);r.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:e.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:e=>{const h={dialogName:"ValidationDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",h),h.cancel&&(e.cancel=!0),r.dialogInstance.content=this.dataValidationContent(l,t,i,n,s,a,o,d),r.dialogInstance.dataBind(),Ur(this.parent.element)},buttons:[{buttonModel:{content:e.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:()=>{r.dialogInstance.content=this.dataValidationContent(!0,t,i,n,s,a,o,d),r.dialogInstance.dataBind(),Ur(this.parent.element)}},{buttonModel:{content:e.getConstant("APPLY"),isPrimary:!0},click:()=>{this.dlgClickHandler(r)}}]}),r.dialogInstance.refresh()}}dataValidationContent(e,t,i,n,s,r,a,o){const d=this.parent.serviceLocator.getService(Da),p=e?"0":n,g=e?"0":s,u=this.parent.createElement("div",{className:"e-validation-dlg"}),m=this.parent.createElement("div",{className:"e-cellrange"}),f=this.parent.createElement("div",{className:"e-allowdata"}),b=this.parent.createElement("div",{className:"e-values"}),y=this.parent.createElement("div",{className:"e-ignoreblank"});u.appendChild(m),u.appendChild(f),u.appendChild(b),u.appendChild(y);const x=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("CellRange")}),C=this.parent.createElement("input",{className:"e-input",attrs:{value:o}});m.appendChild(x),m.appendChild(C);const v=this.parent.createElement("div",{className:"e-allow"}),S=this.parent.createElement("div",{className:"e-data"});f.appendChild(v),f.appendChild(S);const w=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Allow")});this.typeData=[{text:d.getConstant("WholeNumber"),id:"type-1"},{text:d.getConstant("Decimal"),id:"type-2"},{text:d.getConstant("Date"),id:"type-3"},{text:d.getConstant("Time"),id:"type-4"},{text:d.getConstant("TextLength"),id:"type-5"},{text:d.getConstant("List"),id:"type-6"}],this.operatorData=[{text:d.getConstant("Between"),id:"operator-1"},{text:d.getConstant("NotBetween"),id:"operator-2"},{text:d.getConstant("EqualTo"),id:"operator-3"},{text:d.getConstant("NotEqualTo"),id:"operator-4"},{text:d.getConstant("Greaterthan"),id:"operator-5"},{text:d.getConstant("Lessthan"),id:"operator-6"},{text:d.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:d.getConstant("LessThanOrEqualTo"),id:"operator-8"}];const I=this.parent.createElement("input",{className:"e-select"});let O=0;if(!e)for(let l=0;l<this.typeData.length;l++)if(t===this.typeData[l].text.replace(" ","")){O=l;break}if(e||"List"!==t){let t=0;const n=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Data")}),s=this.parent.createElement("input",{className:"e-select"});if(!e)for(let e=0;e<this.operatorData.length;e++)if(i===this.FormattedValue(this.operatorData[e].text)){t=e;break}S.appendChild(n),S.appendChild(s),this.dataList=new c.d({dataSource:this.operatorData,index:t,popupHeight:"200px",change:()=>{this.userInput(R,this.dataList)}}),this.dataList.appendTo(s)}else{const e=this.parent.createElement("input",{className:"e-checkbox"});S.appendChild(e),new h.b({label:d.getConstant("InCellDropDown"),checked:a}).appendTo(e)}v.appendChild(w),v.appendChild(I);const R=new c.d({dataSource:this.typeData,index:O,popupHeight:"200px",change:()=>{this.userInput(R,this.dataList)}});if(R.appendTo(I),e||"List"!==R.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){const e=this.parent.createElement("div",{className:"e-minimum"}),t=this.parent.createElement("div",{className:"e-maximum"});b.appendChild(e),b.appendChild(t);const i=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Minimum")}),n=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Maximum")}),s=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:p}}),r=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:g}});e.appendChild(i),e.appendChild(s),t.appendChild(n),t.appendChild(r),new l.e({value:0}).appendTo("#minvalue"),new l.e({value:0}).appendTo("#maxvalue")}else if(e&&" List"!==t){const e=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Value")}),t=this.parent.createElement("input",{className:"e-input",attrs:{value:p}});b.appendChild(e),b.appendChild(t)}else{const e=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Sources")}),t=this.parent.createElement("input",{className:"e-input",attrs:{value:p}});b.appendChild(e),b.appendChild(t)}const A=r,k=this.parent.createElement("input",{className:"e-checkbox"});return y.appendChild(k),new h.b({label:d.getConstant("IgnoreBlank"),checked:A}).appendTo(k),u}userInput(e,t){const i=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=i.querySelector(".e-allowdata"),s=i.querySelector(".e-values"),r=this.parent.serviceLocator.getService(Da),a=n.querySelector(".e-data");for(;s.lastChild;)s.removeChild(s.lastChild);if("List"===e.value){for(;a.lastChild;)a.removeChild(a.lastChild);const e=this.parent.createElement("input",{className:"e-checkbox"});a.appendChild(e),new h.b({label:r.getConstant("InCellDropDown"),checked:!0}).appendTo(e)}else if(a.getElementsByClassName("e-checkbox-wrapper")[0]){for(;a.lastChild;)a.removeChild(a.lastChild);const e=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),i=this.parent.createElement("input",{className:"e-select"});a.appendChild(e),a.appendChild(i),t.appendTo(i)}if("List"===e.value||"Between"!==t.value&&"Not between"!==t.value){const t=r.getConstant("List"===e.value?"Sources":"Value"),i=this.parent.createElement("span",{className:"e-header",innerHTML:t}),n=this.parent.createElement("input","List"===e.value?{className:"e-input",attrs:{placeholder:"Enter value"}}:{className:"e-input",attrs:{value:"0"}});s.appendChild(i),s.appendChild(n)}else{const e=this.parent.createElement("div",{className:"e-minimum"}),t=this.parent.createElement("div",{className:"e-maximum"});s.appendChild(e),s.appendChild(t);const i=this.parent.createElement("span",{className:"e-header",innerHTML:r.getConstant("Minimum")}),n=this.parent.createElement("span",{className:"e-header",innerHTML:r.getConstant("Maximum")}),a=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),o=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new l.e({value:0}).appendTo("min"),new l.e({value:0}).appendTo("max"),e.appendChild(i),e.appendChild(a),t.appendChild(n),t.appendChild(o)}}dlgClickHandler(e){const t=this.parent.serviceLocator.getService(Da);let i,n=!0;const s=this.parent.element.querySelector(".e-datavalidation-dlg"),r=s.querySelector(".e-footer-content"),a=s.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],o=a.getElementsByClassName("e-allowdata")[0],l=o.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],h=o.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],c=a.getElementsByClassName("e-values")[0],d=c.getElementsByTagName("input")[0].value,p=c.getElementsByTagName("input")[1]?c.getElementsByTagName("input")[1].value:"",g="true"===a.querySelector(".e-ignoreblank").querySelector(".e-checkbox-wrapper").getAttribute("aria-checked"),u=o.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!o.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,m=a.querySelector(".e-cellrange").getElementsByTagName("input")[0].value;let f,b=l.value;h&&(f=h.value,f=this.FormattedValue(f)),b&&(b=b.replace(" ",""));let y=[];const x=[];if(""!==d&&x.push(d),""!==p&&x.push(p),"List"===b)if(-1!==d.indexOf("=")){if(-1!==d.indexOf(":")){const e=d.indexOf("!")>-1?d.split("!")[1]:d.split("=")[1],s=!(d.indexOf("!")>-1)||Ls(this.parent,d.split("=")[1].split("!")[0])>-1;y=e.split(":");const r=!!e.match(/[a-z]/gi)&&y[0].replace(/[0-9]/g,"")===y[1].replace(/[0-9]/g,""),a=!!e.match(/\d/g)&&y[0].replace(/\D/g,"")===y[1].replace(/\D/g,"");n=!(!s||!r&&!a),n||(i=t.getConstant("DialogError"))}}else d.length>256&&(n=!1,i=t.getConstant("ListLengthError"));if("List"!==b||n){const t=this.parent.getActiveSheet(),s=this.isDialogValidator(x,b,f);if(i=s.errorMsg,n=s.isValidate,n){const i=Bi(this.parent.getActiveSheet().activeCell);if(t&&t.rows[i[0]]&&t.rows[i[0]].cells[i[1]]&&t.rows[i[0]].cells[i[1]].validation&&"List"===t.rows[i[0]].cells[i[1]].validation.type){const e=this.parent.getMainContent().getElementsByTagName("tr")[i[0]].getElementsByClassName("e-cell")[i[1]];e&&e.getElementsByClassName("e-validation-list")[0]&&(e.removeChild(e.getElementsByClassName("e-validation-list")[0]),this.listObj.destroy())}this.parent.addDataValidation({type:b,operator:f,value1:d,value2:p,ignoreBlank:g,inCellDropDown:u},m),"List"===b&&n&&this.listHandler(),document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide())}}if(!n){const e=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:i});c.appendChild(e),r.querySelector(".e-primary").setAttribute("disabled","true")}}FormattedValue(e){switch(e){case"Between":e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo";break;default:e="Between"}return e}isDialogValidator(e,t,i){const n=this.parent.serviceLocator.getService(Da);let s,r=0,a=!1;if(a="List"===t?!(e.length>0):"Between"===i||"NotBetween"===i?2!==e.length:!(e.length>0),a)s={isValidate:!1,errorMsg:n.getConstant("EmptyError")};else{for(let i=0;i<e.length&&(s=this.formatValidation(e[i],t),s.isValidate);i++)r+=1;s.isValidate=r===e.length}return{isValidate:s.isValidate,errorMsg:s.errorMsg}}isValidationHandler(e){const t=this.parent.serviceLocator.getService(Da);let i,n;e.value=e.value?e.value:"";const s=e.value,a=this.parent.sheets[e.sheetIdx];let o;const l=Cs(e.range[0],e.range[1],a),h=Js(a,e.range[1]);if(l&&l.validation?o=l.validation:h&&h.validation&&(o=h.validation),o){let t=e.value,a=o.value1,l=o.value2;const h=o.operator||"Between",c=o.type||"WholeNumber",d=!!Object(r.Z)(o.ignoreBlank)||o.ignoreBlank,p=this.formatValidation(e.value,c);if(i=p.isValidate,n=p.errorMsg,i){if(i=!1,"Date"===c||"Time"===c){e.value=e.value.slice(e.value.indexOf(" ")+1,e.value.length);for(let i=0;i<=3;i++){e.value=0===i?e.value:1===i?o.value1:o.value2;const n={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify("checkDateFormat",n);const s=n.updatedVal;0==i&&""==s?t=e.value:0==i?t=s:1==i?a=s:l=s}}else"TextLength"===o.type&&(t=e.value.toString().length.toString());if("List"===c)if(-1!==a.indexOf("="))for(let t=0;t<this.data.length;t++)e.value.toString()===this.data[t].text&&(i=!0);else{const t=a.split(",");for(let n=0;n<t.length;n++)e.value.toString()===t[n]&&(i=!0)}else switch("Decimal"===c||"Time"===c?(t=parseFloat(t.toString()),a=parseFloat(a.toString()),l=l?parseFloat(l.toString()):null):(t=parseInt(t.toString(),10),a=parseInt(a.toString(),10),l=l?parseInt(l.toString(),10):null),h){case"EqualTo":i=t===a||!(!d||""!==s);break;case"NotEqualTo":i=t!==a||!(!d||""!==s);break;case"Between":i=t>=a&&t<=l||!(!d||""!==s);break;case"NotBetween":i=!(t>=a&&t<=l);break;case"GreaterThan":i=t>a||!(!d||""!==s);break;case"LessThan":i=t<a||!(!d||""!==s);break;case"GreaterThanOrEqualTo":i=t>=a||!(!d||""!==s);break;case"LessThanOrEqualTo":i=t<=a||!(!d||""!==s)}}}if(n=t.getConstant("ValidationError"),i){const t=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);this.parent.notify(rn,{style:t,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})}return{isValidate:i,errorMsg:n}}checkDataValidation(e){const t=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx});!t.isValidate&&e.isCell&&this.validationErrorHandler(t.errorMsg),this.parent.allowDataValidation=t.isValidate}formatValidation(e,t){const i=this.parent.element.getElementsByClassName("e-sheet-panel")[0];let n;const s=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),r=this.parent.createElement("input",{id:"e-validation",innerHTML:e});let a;switch(r.setAttribute("name","validation"),r.setAttribute("type","text"),r.setAttribute("value",e),s.appendChild(r),i.appendChild(s),t){case"Date":a={rules:{validation:{date:!0}},customPlacement:(e,t)=>{n=t.innerText}};break;case"Decimal":a={rules:{validation:{number:!0}},customPlacement:(e,t)=>{n=t.innerText}};break;case"WholeNumber":a={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:(e,t)=>{n=t.innerText}}}const o=new l.b("#formId",a).validate();return i.removeChild(i.getElementsByClassName("form-horizontal")[0]),{isValidate:o,errorMsg:n}}InvalidElementHandler(e){const t=e.rowIdx,i=e.colIdx,n=e.isRemoveHighlightedData;if(n){if(n){const n=this.parent.getCellStyleValue(["backgroundColor","color"],[t,i]);this.parent.notify(rn,{style:n,rowIdx:t,colIdx:i,cell:e.td})}}else this.parent.notify(rn,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:t,colIdx:i,cell:e.td})}validationErrorHandler(e){const t=document.getElementsByClassName("e-spreadsheet-edit")[0],i=this.parent.serviceLocator.getService(Da);if(!this.parent.element.querySelector(".e-validationerror-dlg")){const n=this.parent.serviceLocator.getService(Ma),s=!1,r={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:i=>{const s={dialogName:"ValidationErrorDialog",element:i.element,target:i.target,cancel:i.cancel,content:e};this.parent.trigger("dialogBeforeOpen",s),s.cancel&&(this.errorDlgHandler(n,"Cancel"),i.cancel=!0),t.focus(),n.dialogInstance.content=s.content,n.dialogInstance.dataBind()},buttons:[{buttonModel:{content:i.getConstant("Retry"),isPrimary:!0},click:()=>{this.errorDlgHandler(n,"Retry")}},{buttonModel:{content:i.getConstant("Cancel")},click:()=>{this.errorDlgHandler(n,"Cancel")}}]};n.show(r,s)}}errorDlgHandler(e,t){if("Retry"===t){const t=document.getElementsByClassName("e-spreadsheet-edit")[0];if(e.hide(),t.innerText){const e=document.createRange();e.setStart(t.childNodes[0],0),e.setEnd(t.childNodes[0],t.innerText.length);const i=window.getSelection();i.removeAllRanges(),i.addRange(e),this.listObj&&this.listObj.showPopup()}}else{const t=Bi(this.parent.getActiveSheet().activeCell),i=Cs(t[0],t[1],this.parent.getActiveSheet()),n=i?this.parent.getDisplayText(i):"";this.parent.notify(un,{action:"cancelEdit",value:n,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}}getModuleName(){return"dataValidation"}}class la{constructor(e){this.password="",this.parent=e,this.init()}init(){this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("applyProtect",this.protect,this),this.parent.on("protectSheet",this.protectSheetHandler,this),this.parent.on("editAlert",this.editProtectedAlert,this),this.parent.on("applyLockCells",this.lockCellsHandler,this),this.parent.on("protectWorkbook",this.protectWorkbook,this),this.parent.on(mn,this.KeyUpHandler,this),this.parent.on("unProtectWorkbook",this.unProtectWorkbook,this),this.parent.on("getPassWord",this.getPassWord,this),this.parent.on("importProtectWorkbook",this.importProtectWorkbook,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("applyProtect",this.protect),this.parent.off("protectSheet",this.protectSheetHandler),this.parent.off("editAlert",this.editProtectedAlert),this.parent.off("applyLockCells",this.lockCellsHandler),this.parent.off("protectWorkbook",this.protectWorkbook),this.parent.off(mn,this.KeyUpHandler),this.parent.off("unProtectWorkbook",this.unProtectWorkbook),this.parent.off("getPassWord",this.getPassWord),this.parent.off("importProtectWorkbook",this.importProtectWorkbook))}protect(e){this.parent.notify("clearCopy",null),e.isActive?(this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1),this.parent.notify("updateToggleItem",{props:"Protect"}),this.parent.notify("protectSheet",{isActive:e.isActive}),this.parent.notify("protectSelection",null)):this.createDialogue()}createDialogue(){const e=this.parent.serviceLocator.getService(Da),t=[{text:e.getConstant("SelectCells"),id:"1"},{text:e.getConstant("FormatCells"),id:"2"},{text:e.getConstant("FormatRows"),id:"3"},{text:e.getConstant("FormatColumns"),id:"4"},{text:e.getConstant("InsertLinks"),id:"5"}];this.optionList=new d.b({width:"250px",dataSource:t,showCheckBox:!0,select:this.dialogOpen.bind(this)});const i=this.parent.createElement("div",{className:"e-protect-content",innerHTML:e.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);const n=new h.b({checked:!0,label:e.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),s=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),a=this.parent.createElement("div",{className:"e-header-content",innerHTML:e.getConstant("ProtectSheet")}),o=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:a.outerHTML,content:o.outerHTML+i.outerHTML+s.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:e=>{const t={dialogName:"ProtectSheetDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)},open:()=>{this.okBtnFocus()},beforeClose:()=>{const e=document.getElementById(this.parent.element.id+"_protect_check");r.l.remove(e,"focus",this.okBtnFocus),r.l.remove(n.element,"click",this.checkBoxClickHandler),Ur(this.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:e.getConstant("Ok"),isPrimary:!0}}]}),n.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"}]),r.l.add(n.element,"click",this.checkBoxClickHandler,this)}okBtnFocus(){document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",()=>{this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()})}checkBoxClickHandler(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())}dialogOpen(){this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()}selectOption(){const e=this.parent.serviceLocator.getService(Da),t=this.optionList.getSelectedItems();this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!0);const i={selectCells:t.text.indexOf(e.getConstant("SelectCells"))>-1,formatCells:t.text.indexOf(e.getConstant("FormatCells"))>-1,formatRows:t.text.indexOf(e.getConstant("FormatRows"))>-1,formatColumns:t.text.indexOf(e.getConstant("FormatColumns"))>-1,insertLink:t.text.indexOf(e.getConstant("InsertLinks"))>-1};this.parent.protectSheet(null,i),this.parent.notify("protectSelection",null),this.parent.notify("clearUndoRedoCollection",null),this.dialog.hide()}protectSheetHandler(){const e=this.parent.getActiveSheet(),t=this.parent.element.id,i=[t+"_undo",t+"_redo",t+"_cut",t+"_copy",t+"_paste",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_merge_cells",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],n=[t+"_cut",t+"_copy",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],s=[t+"_insert_function"],r=[t+"_hyperlink",t+"_",t+"_chart"],a=[t+"_"],o=[t+"_find"],l=[t+"_datavalidation"],h=[t+"_chart"],c=document.getElementById(this.parent.element.id+"_sheet_panel");c&&(e.isProtected&&e.protectSettings.selectCells?c.classList.remove("e-protected"):c.classList.add("e-protected"),e.isProtected||c.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify("protectCellFormat",{disableHomeBtnId:i,enableHomeBtnId:n,enableFrmlaBtnId:s,enableInsertBtnId:r,findBtnId:o,dataValidationBtnId:l,imageBtnId:a,chartBtnId:h}),this.parent.notify("enableFormulaInput",null),e.isProtected&&this.parent.notify("updateToggleItem",{props:"Protect"})}editProtectedAlert(){const e=this.parent.serviceLocator.getService(Da);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:e.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:e=>{const t={dialogName:"EditAlertDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0,nr(()=>this.dialog.destroyDialog())),Ur(this.parent.element)},close:()=>Ur(this.parent.element)})}lockCellsHandler(e){const t=this.parent.getActiveSheet();vs(e.rowIdx,e.colIdx,t,{isLocked:!!e.isLocked&&e.isLocked},!0)}protectWorkbook(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.serviceLocator.getService(Ma);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:e.getConstant("ProtectWorkbook"),beforeOpen:e=>{const i={dialogName:"ProtectWorkbook",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.passwordProtectContent(),t.dialogInstance.dataBind(),this.parent.element.focus()},buttons:[{buttonModel:{content:e.getConstant("Ok"),isPrimary:!0},click:()=>{this.alertMessage(),this.dlgClickHandler(t)}}]})}passwordProtectContent(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("div",{className:"e-password-dialog"}),i=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),s=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Password")}),r=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ConfirmPassword")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",e.getConstant("EnterThePassword")),o.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),i.appendChild(a),i.insertBefore(s,a),n.appendChild(o),n.insertBefore(r,o),t.appendChild(n),t.insertBefore(i,n),t}KeyUpHandler(e){const t=e.target;if(t.classList.contains("e-text")&&Object(r.D)(t,".e-password-content")&&Object(r.D)(t,".e-password-dialog")&&Object(r.D)(t,".e-password-dialog").getElementsByClassName("e-password-content")[1]===t.parentElement){const e=Object(r.D)(t,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?e.removeAttribute("disabled"):e.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&Object(r.D)(t,".e-unprotectpwd-content")&&Object(r.D)(t,".e-unprotectpwd-dialog")&&Object(r.D)(t,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===t.parentElement){const e=Object(r.D)(t,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?e.removeAttribute("disabled"):e.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&Object(r.D)(t,".e-importprotectpwd-content")&&Object(r.D)(t,".e-importprotectpwd-dialog")&&Object(r.D)(t,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===t.parentElement){const e=Object(r.D)(t,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?e.removeAttribute("disabled"):e.setAttribute("disabled","true")}}alertMessage(){const e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),i=this.parent.element.querySelector(".e-importprotectpwd-alert-span");e&&e.remove(),t&&t.remove(),i&&i.remove()}dlgClickHandler(e){const t=this.parent.serviceLocator.getService(Da),i=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),s=this.parent.createElement("span",{className:"e-pwd-alert-span"});i.value===n.value?(this.parent.password=i.value,this.parent.isProtected=!0,e.hide(),this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify("updateToggleItem",{props:"Protectworkbook"})):""===i.value?s.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?s.textContent=t.getConstant("ConfirmPasswordAlertMsg"):i.value!==n.value&&(s.textContent=t.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(s)}unProtectWorkbook(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.serviceLocator.getService(Ma);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:e.getConstant("UnProtectWorkbook"),beforeOpen:e=>{const i={dialogName:"UnProtectWorkbook",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.unProtectPasswordContent(),t.dialogInstance.dataBind(),this.parent.element.focus()},buttons:[{buttonModel:{content:e.getConstant("Ok"),isPrimary:!0,disabled:!0},click:()=>{this.alertMessage(),this.unprotectdlgOkClick(t)}}]})}unProtectPasswordContent(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),i=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return i.appendChild(s),i.insertBefore(n,s),t.appendChild(i),t}unprotectdlgOkClick(e){const t=this.parent.serviceLocator.getService(Da),i=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===i.value)e.hide(),this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.notify("updateToggleItem",{props:"Protectworkbook"});else{const e=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span",innerHTML:t.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(e)}}getPassWord(e){e.passWord=this.password}importProtectWorkbook(e){const t=this.parent.serviceLocator.getService(Da),i=this.parent.serviceLocator.getService(Ma);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:t.getConstant("UnProtectWorkbook"),beforeOpen:t=>{const n={dialogName:"ImportProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};this.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=this.importProtectPasswordContent(e),i.dialogInstance.dataBind(),this.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:()=>{this.alertMessage(),this.importOkClick(e)}}]})}importProtectPasswordContent(e){const t=this.parent.serviceLocator.getService(Da),i=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),s=this.parent.createElement("span",{className:"e-header",innerHTML:'"'+e.file.name+'" '+t.getConstant("IsProtected")}),r=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(s),n.appendChild(r),i.appendChild(n),i}importOkClick(e){const t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value,this.parent.open({file:e.file,password:t.value})}getModuleName(){return"protectSheet"}}class ha{constructor(e){this.shortValue="",this.parent=e,this.addEventListener()}addEventListener(){this.parent.on(wn,this.renderFindDlg,this),this.parent.on(Sn,this.renderGotoDlg,this),this.parent.on("gotoHandler",this.gotoHandler,this),this.parent.on("findHandler",this.findHandler,this),this.parent.on("replaceHandler",this.replaceHandler,this),this.parent.on(on,this.showDialog,this),this.parent.on("replaceAllDialog",this.replaceAllDialog,this),this.parent.on("findUndoRedo",this.findUndoRedo,this),this.parent.on("findKeyUp",this.findKeyUp,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off(wn,this.renderFindDlg),this.parent.off(Sn,this.renderGotoDlg),this.parent.off("gotoHandler",this.gotoHandler),this.parent.off("findHandler",this.findHandler),this.parent.off("replaceHandler",this.replaceHandler),this.parent.off(on,this.showDialog),this.parent.off("replaceAllDialog",this.replaceAllDialog),this.parent.off("findUndoRedo",this.findUndoRedo),this.parent.off("findKeyUp",this.findKeyUp))}findUndoRedo(e){const t={address:e.address,compareVal:e.compareVal,cancel:!1};"before"===e.undoRedoOpt?this.parent.notify(vn,{action:"beforeReplace",eventArgs:t}):"after"===e.undoRedoOpt?t.cancel||this.parent.notify(Cn,{action:"replace",eventArgs:{address:e.address,compareVal:e.compareVal}}):"beforeReplaceAll"===e.undoRedoOpt?t.cancel||this.parent.notify(vn,{action:"beforeReplaceAll",eventArgs:{replaceValue:e.replaceValue,addressCollection:e.Collection}}):"afterReplaceAll"!==e.undoRedoOpt||t.cancel||this.parent.notify(Cn,{action:"replaceAll",eventArgs:{replaceValue:e.replaceValue,addressCollection:e.Collection}})}renderFindDlg(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.serviceLocator.getService(Ma);if(Object(r.Z)(this.parent.element.querySelector(".e-find-dlg"))){const i={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:e.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:e=>{const i={dialogName:"FindAndReplaceDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.findandreplaceContent(),t.dialogInstance.dataBind(),Ur(this.parent.element)},buttons:[{buttonModel:{content:e.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:e=>{this.dialogMessage(),this.findDlgClick(e&&13===e.keyCode?"next":"prev")}},{buttonModel:{content:e.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:()=>{this.dialogMessage(),this.findDlgClick("next")}},{buttonModel:{content:e.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:()=>{this.dialogMessage(),this.findDlgClick("replace")}},{buttonModel:{content:e.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:()=>{this.dialogMessage(),this.findDlgClick("replaceAll")}}],open:()=>{if(this.parent.element.querySelector(".e-text-findNext").value){const e=this.parent.element.querySelector(".e-btn-findPrevious");Object(r.N)(e,"btn").disabled=!1,Object(r.N)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}},close:()=>{t.hide()}};t.show(i,!1)}else t.hide()}dialogMessage(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()}renderGotoDlg(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.serviceLocator.getService(Ma);if(Object(r.Z)(this.parent.element.querySelector(".e-find-dlg"))){const i={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:e.getConstant("GotoHeader"),beforeOpen:e=>{const i={dialogName:"GoToDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.GotoContent(),t.dialogInstance.dataBind(),Ur(this.parent.element)},buttons:[{buttonModel:{content:e.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:()=>{this.gotoHandler()}}],close:()=>{t.hide()},open:()=>{this.textFocus()}};t.show(i,!1)}else t.hide()}textFocus(){this.parent.element.querySelector(".e-text-goto").addEventListener("focus",()=>{this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove()})}findDlgClick(e){"prev"===e||"next"===e?this.findHandler({findOption:e}):this.replaceHandler({findDlgArgs:e})}findHandler(e){let t=this.parent.element.querySelector(".e-text-findNext");t||(t=this.parent.element.querySelector(".e-text-findNext-short"),t||this.gotoAlert());const i=t.value;if(""!==t.value){const t=this.parent.activeSheetIndex,n=this.parent.element.querySelector(".e-findnreplace-checkcase");let s;s=!!n&&Object(r.N)(n,"checkbox").checked;const a=this.parent.element.querySelector(".e-findnreplace-checkmatch");let o;o=!!a&&Object(r.N)(a,"checkbox").checked;const l=this.parent.element.querySelector(".e-findnreplace-searchby");let h;h=l?Object(r.N)(l,"dropdownlist").value.toString():"By Row";const c=this.parent.element.querySelector(".e-findnreplace-searchwithin");let d;d=c?Object(r.N)(c,"dropdownlist").value.toString():"Sheet";const p={value:i,sheetIndex:t,findOpt:e.findOption,mode:d,isCSen:s,isEMatch:o,searchBy:h,isAction:!0};"next"===e.findOption||"prev"===e.findOption?this.parent.find(p):"count"===e.countArgs.countOpt&&(this.parent.notify("count",p),e.countArgs.findCount=p.findCount)}}replaceHandler(e){const t=this.parent.activeSheetIndex,i=this.parent.element.querySelector(".e-text-findNext"),n=this.parent.element.querySelector(".e-text-replaceInp"),s=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=Object(r.N)(s,"checkbox"),o=this.parent.element.querySelector(".e-findnreplace-checkmatch"),l=Object(r.N)(o,"checkbox"),h=this.parent.element.querySelector(".e-findnreplace-searchby"),c=Object(r.N)(h,"dropdownlist"),d=this.parent.element.querySelector(".e-findnreplace-searchwithin"),p=Object(r.N)(d,"dropdownlist"),g={value:i.value,mode:p.value.toString(),isCSen:a.checked,isEMatch:l.checked,searchBy:c.value.toString(),findOpt:"next",replaceValue:n.value,replaceBy:e.findDlgArgs?e.findDlgArgs:e.replaceMode,sheetIndex:t};this.parent.replace(g)}gotoHandler(e){if(e)this.parent.goTo(e.address);else{const e=this.parent.element.querySelector(".e-text-goto").value,t=e.split("");if(""===e||isNaN(parseInt(t[1],10)))return void this.gotoAlert();{const t=e.toString().toUpperCase();this.parent.goTo(t)}}}gotoAlert(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)}showDialog(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)}replaceAllDialog(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();const t=this.parent.serviceLocator.getService(Da),i=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+t.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(i)}findKeyUp(e){if(e.target.classList.contains("e-text-findNext")){const e=this.parent.element.querySelector(".e-text-findNext").value;if(Object(r.Z)(e)||""===e)Object(r.N)(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,Object(r.N)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{const e=this.parent.element.querySelector(".e-btn-findPrevious");Object(r.N)(e,"btn").disabled=!1,Object(r.N)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}const t=this.parent.element.querySelector(".e-text-findNext").value,i=this.parent.element.querySelector(".e-text-replaceInp").value;Object(r.Z)(t)||Object(r.Z)(i)||""===t||""===i?(Object(r.N)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,Object(r.N)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):!1===this.parent.getActiveSheet().isProtected&&(Object(r.N)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,Object(r.N)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)}findandreplaceContent(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);const e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),i=this.parent.createElement("div",{className:"e-findCheck"}),n=this.parent.serviceLocator.getService(Da);e.appendChild(t);const s=this.parent.createElement("div",{className:"e-cont"}),r=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("FindWhat")}),a=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});s.appendChild(a),s.insertBefore(r,a),t.appendChild(s);const o=new l.g({width:"70%"});o.createElement=this.parent.createElement,o.appendTo(a);const d=this.parent.createElement("div",{className:"e-cont"}),p=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("ReplaceWith")}),g=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});d.appendChild(g),d.insertBefore(p,g),t.appendChild(d);const u=new l.g({width:"70%"});u.createElement=this.parent.createElement,u.appendTo(g);const m=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],f=new c.d({dataSource:m,cssClass:"e-searchby",fields:{value:"Id",text:"Within"},width:"50%",index:0}),b=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:n.getConstant("SearchBy")}}),y=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchWithin")});t.appendChild(y),t.appendChild(b),f.createElement=this.parent.createElement,f.appendTo(b);const x=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],C=new c.d({dataSource:x,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),v=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:n.getConstant("SearchBy")}}),S=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchBy")});t.appendChild(S),t.appendChild(v),C.createElement=this.parent.createElement,C.appendTo(v);const w=new h.b({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),I=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});i.appendChild(I),w.createElement=this.parent.createElement,w.appendTo(I);const O=new h.b({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),R=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return i.appendChild(R),O.createElement=this.parent.createElement,O.appendTo(R),t.appendChild(i),e}GotoContent(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("div",{className:"e-link-dialog"}),i=this.parent.createElement("div",{className:"e-goto"});t.appendChild(i);const n=this.parent.createElement("div",{className:"e-cont"}),s=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),r=new l.g({placeholder:e.getConstant("EntercellAddress")}),a=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(a),n.insertBefore(s,a),i.appendChild(n),r.createElement=this.parent.createElement,r.appendTo(a),t}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"findAndReplace"}}class ca{constructor(e){this.parent=e,this.addEventListener()}merge(e){e.showDialog?this.parent.serviceLocator.getService(Ma).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Da).getConstant("PasteMergeAlert"),beforeOpen:e=>{const t={dialogName:"MergeDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)}hideHandler(e){const t=this.parent.getActiveSheet(),i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(hn,i),i.range=i.range;const n=Cs(i.range[0],i.range[1],t)||{},s="row"===e.model?i.range[0]:i.range[1],r=s+((n[`${e.model}Span`]||1)-1);if(!(!e.isEnd&&(e.start===s||ir(t,s))||e.isEnd&&e.start>s&&!ir(t,s))&&n[`${e.model}Span`]>1&&r>=e.start)if("row"===e.model?Ys(t,s):ir(t,s)){if(e.end<r&&(r-e.end>1||n.rowSpan>1)){const t=this.parent.getCell(e.rowIdx,e.end+1);if(t&&(r-e.end>1&&(t.colSpan=r-e.end),t.style.display=""),n.rowSpan>1){const i=n.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(n.rowSpan-1));i>1&&(t.rowSpan=i)}}}else this.merge({rowIdx:i.range[0],colIdx:i.range[1]})}checkPrevMerge(e){let t;const i=this.parent.getActiveSheet();let n,s;e.isRow?e.rowIdx-1>-1&&Ys(i,e.rowIdx-1)&&(t=Cs(e.rowIdx-1,e.colIdx,i)||{},void 0===t.rowSpan&&void 0===t.colSpan||!(void 0===t.colSpan||t.colSpan>1||e.colIdx-1>-1&&ir(i,e.colIdx-1))||(n={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(hn,n),n.range=n.range,Ys(i,n.range[0])&&n.range[2]>=e.rowIdx&&(t=Cs(n.range[0],n.range[1],i)||{},t.rowSpan>1&&(s=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(n.range[2]-e.rowIdx)),s>1&&(e.td.rowSpan=s,e.td.style.display=""),t.colSpan>1&&!(e.colIdx-1>-1&&ir(i,e.colIdx-1))&&(s=t.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"),s>1&&(e.td.colSpan=s,e.td.style.display="")))))):e.colIdx-1>-1&&ir(i,e.colIdx-1)&&(t=Cs(e.rowIdx,e.colIdx-1,i)||{},void 0===t.colSpan&&void 0===t.rowSpan||!(void 0===t.rowSpan||t.rowSpan>1||e.rowIdx-1>-1&&Ys(i,e.rowIdx-1))||(n={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(hn,n),n.range=n.range,ir(i,n.range[1])&&n.range[3]>=e.colIdx&&(t=Cs(n.range[0],n.range[1],i)||{},t.colSpan>1&&(s=n.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"),s>1&&(e.td.colSpan=s,e.td.style.display=""),t.rowSpan>1&&!(e.rowIdx-1>-1&&Ys(i,e.rowIdx-1))&&(s=t.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(t.rowSpan-1)),s>1&&(e.td.rowSpan=s,e.td.style.display=""))))))}checkMerge(e){const t=this.parent.getActiveSheet();let i=Cs(e.rowIdx,e.colIdx,t)||{};if(e.isRow){if(void 0===i.colSpan||ir(t,e.colIdx-1)){const n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(n.range=n.range,this.parent.notify(hn,n),ir(t,e.colIdx-1)&&!ir(t,n.range[1])||e.isFreezePane&&n.range[0]<this.parent.frozenRowCount(t))return void(e.insideFreezePane=n.range[0]<this.parent.frozenRowCount(t));i=Cs(n.range[0],n.range[1],t);const s=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,n.range[2]);s>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.rowSpan=s,e.td.style.display="")}}else if(void 0===i.rowSpan||Ys(t,e.rowIdx-1)){const n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(n.range=n.range,this.parent.notify(hn,n),Ys(t,e.rowIdx-1)&&!Ys(t,n.range[0])||e.isFreezePane&&n.range[1]<this.parent.frozenColCount(t))return void(e.insideFreezePane=n.range[1]<this.parent.frozenColCount(t));i=Cs(n.range[0],n.range[1],t);const s=n.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,n.range[3],"columns");s>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.colSpan=s,e.td.style.display="")}}addEventListener(){this.parent.on("applyMerge",this.merge,this),this.parent.on("hiddenMerge",this.hideHandler,this),this.parent.on("checkPrevMerge",this.checkPrevMerge,this),this.parent.on("checkMerge",this.checkMerge,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.isDestroyed||(this.parent.off("applyMerge",this.merge),this.parent.off("hiddenMerge",this.hideHandler),this.parent.off("checkPrevMerge",this.checkPrevMerge),this.parent.off("checkMerge",this.checkMerge))}getModuleName(){return"merge"}}class da{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener()}addEventListener(){this.parent.on("cFRender",this.cFInitialRender,this),this.parent.on("cFInitialCheck",this.cFInitialCheckHandler,this),this.parent.on("checkConditionalFormat",this.checkConditionalFormatHandler,this),this.parent.on("initiateConditionalFormat",this.initiateCFHandler,this),this.parent.on("setCF",this.setCFHandler,this),this.parent.on("cFDelete",this.cFDeleteHandler,this),this.parent.on("clearCF",this.clearCFHandler,this),this.parent.on("clearCells",this.addClearCFHandler,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("cFRender",this.cFInitialRender),this.parent.off("cFInitialCheck",this.cFInitialCheckHandler),this.parent.off("checkConditionalFormat",this.checkConditionalFormatHandler),this.parent.off("initiateConditionalFormat",this.initiateCFHandler),this.parent.off("setCF",this.setCFHandler),this.parent.off("cFDelete",this.cFDeleteHandler),this.parent.off("clearCF",this.clearCFHandler))}setCF(e){e.range=e.range||this.parent.getActiveSheet().selectedRange;const t={range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:this.parent.activeSheetIndex,cancel:!1};this.parent.notify(vn,{eventArgs:t,action:"conditionalFormat"}),t.cancel||(e.type=t.type,e.cFColor=t.cFColor,e.value=t.value,e.range=t.range,this.parent.notify("setCFRule",{conditionalFormat:e,isAction:!0}),delete t.cancel,this.parent.notify(Cn,{eventArgs:t,action:"conditionalFormat"}))}addClearCFHandler(e){const t=this.parent.getActiveSheet(),i=e.conditionalFormats,n=e.oldRange,s=e.selectedRange,r=t.conditionalFormats;for(let a=i.length-1;a>=0;a--){let e=!1;for(let o=0;o<r.length;o++)if(r[o].type===i[a].type&&r[o].range===i[a].range){e=!0,r[o].range=n[a],t.conditionalFormats[o].range=n[a];const i=Ni(s),l=n[a].split(",");for(let e=0;e<l.length;e++){const n=Ni(l[e]);for(let e=n[0];e<=n[2];e++)for(let s=n[1];s<=n[3];s++)for(let n=i[0];n<=i[2];n++)for(let a=i[1];a<=i[3];a++)if(n===e&&a===s){const i=this.parent.getCell(e,s),n=t.rows[e]&&t.rows[e].cells[s]?t.rows[e].cells[s]:null;n&&this.cFInitialCheckHandler({rowIdx:e,colIdx:s,cell:n,td:i,conditionalFormat:r[o]})}}}if(!e){const e=i[a];e.range=n[a],this.parent.notify("setCFRule",{conditionalFormat:e})}}}cFDeleteHandler(e){const t=this.parent.getCell(e.rowIdx,e.colIdx);t&&(t.querySelector(".e-cf-databar")&&t.removeChild(t.querySelector(".e-cf-databar")),t.querySelector(".e-iconsetspan")&&t.removeChild(t.querySelector(".e-iconsetspan")))}clearCFHandler(e){const t=this.parent.getActiveSheet(),i=this.parent.getCell(e.rIdx,e.cIdx),n=Cs(e.rIdx,e.cIdx,t);if(i){if(i.classList.remove("e-redft"),i.classList.remove("e-yellowft"),i.classList.remove("e-greenft"),i.classList.remove("e-redf"),i.classList.remove("e-redt"),i.classList.remove("e-iconset"),i.style){if(i.style.backgroundColor){i.style.backgroundColor="";const t=this.parent.getCellStyleValue(["backgroundColor"],[e.rIdx,e.cIdx]);this.parent.notify(rn,{style:t,rowIdx:e.rIdx,colIdx:e.cIdx})}if(i.style.color){i.style.color="";const t=this.parent.getCellStyleValue(["color"],[e.rIdx,e.cIdx]);this.parent.notify(rn,{style:t,rowIdx:e.rIdx,colIdx:e.cIdx})}}i.querySelector(".e-cf-databar")&&(i.removeChild(i.querySelector(".e-cf-databar")),i.textContent=this.parent.getDisplayText(n)),i.querySelector(".e-iconsetspan")&&(i.removeChild(i.querySelector(".e-iconsetspan")),i.textContent=this.parent.getDisplayText(n))}}setCFHandler(e){("cf_databars"===e.action||"cf_colorscales"===e.action||"cf_iconsets"===e.action)&&this.setCF({type:e.id})}initiateCFHandler(e){const t=this.parent.serviceLocator.getService(Da),i=this.parent.serviceLocator.getService(Ma);i.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:()=>{i.dialogInstance.content=this.cFDlgContent(e.action),i.dialogInstance.dataBind(),Ur(this.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:()=>{i.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0].disabled||(this.dlgClickHandler(e.action),i.hide())}}]}),i.dialogInstance.refresh()}dlgClickHandler(e){let t="",i="";const n=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),s=n.querySelector(".e-cfmain");if(s){const e=s.getElementsByTagName("input")[0];e&&e.parentElement.classList.contains("e-cfmain")&&(t=s.getElementsByTagName("input")[0].value),i=s.getElementsByTagName("input")[1]?n.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:"";const a=Object(r.S)(this.parent.locale,"");t=t.split(a).join("").split(",").join(""),i=i.split(a).join("").split(",").join("")}const a=this.getCFColor(n.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),o="Duplicate Values..."===e?n.querySelector(".e-cfmain").getElementsByTagName("input")[0].value:this.getType(e);this.setCF(""!==t&&""!==i?{type:o,cFColor:a,value:t+","+i}:""!==t?{type:o,cFColor:a,value:t}:{type:o,cFColor:a,value:i})}getType(e){const t=this.parent.serviceLocator.getService(Da);let i="";switch(e){case t.getConstant("GreaterThan")+"...":i="GreaterThan";break;case t.getConstant("LessThan")+"...":i="LessThan";break;case t.getConstant("Between")+"...":i="Between";break;case t.getConstant("CFEqualTo")+"...":i="EqualTo";break;case t.getConstant("TextThatContains")+"...":i="ContainsText";break;case t.getConstant("ADateOccuring")+"...":i="DateOccur";break;case t.getConstant("Top10Items")+"...":i="Top10Items";break;case t.getConstant("Bottom10Items")+"...":i="Bottom10Items";break;case t.getConstant("Top10")+" %...":i="Top10Percentage";break;case t.getConstant("Bottom10")+" %...":i="Bottom10Percentage";break;case t.getConstant("AboveAverage")+"...":i="AboveAverage";break;case t.getConstant("BelowAverage")+"...":i="BelowAverage"}return i}getCFColor(e){const t=this.parent.serviceLocator.getService(Da);let i="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):i="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):i="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):i="GreenFT";break;case t.getConstant("RedFill"):i="RedF";break;case t.getConstant("RedText"):i="RedT"}return i}cFDlgContent(e){const t=this.getDlgText(e),i=this.parent.serviceLocator.getService(Da),n=this.parent.createElement("div",{className:"e-cf-dlg"}),s=this.parent.createElement("div",{className:"e-cfmain"}),r=this.parent.createElement("div",{className:"e-cfsub"}),a=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:t}),o=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text"}}),h=this.parent.createElement("input",{className:"e-select"}),d=this.parent.createElement("span",{className:"e-header",innerHTML:i.getConstant("With")}),p=this.parent.createElement("input",{className:"e-select"});let g;if(n.appendChild(s),n.appendChild(r),s.appendChild(a),e!==i.getConstant("DuplicateValues")+"..."){if(e!==i.getConstant("AboveAverage")+"..."&&e!==i.getConstant("BelowAverage")+"..."){s.appendChild(o),g=!0;const t=e===i.getConstant("Top10")+" %..."||e===i.getConstant("Bottom10")+" %...";(e===i.getConstant("Top10Items")+"..."||e===i.getConstant("Bottom10Items")+"..."||t)&&(o.maxLength=t?3:4,new l.e({value:10,min:1,max:t?100:1e3,format:"###"}).appendTo(o))}}else{s.appendChild(h);const e=[{text:i.getConstant("Duplicate"),id:"duplicate"},{text:i.getConstant("Unique"),id:"unique"}];new c.d({dataSource:e,index:0,popupHeight:"200px"}).appendTo(h)}if(e===i.getConstant("Between")+"..."){const e=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:i.getConstant("And")}),t=this.parent.createElement("input",{className:"e-input e-between"});s.appendChild(e),s.appendChild(t),t.addEventListener("input",this.validateCfInput.bind(this))}g&&(this.validateCfInput({target:o}),o.addEventListener("input",this.validateCfInput.bind(this))),r.appendChild(d),r.appendChild(p);const u=[{text:i.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:i.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:i.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:i.getConstant("RedFill"),id:"redf"},{text:i.getConstant("RedText"),id:"redt"}];return new c.d({dataSource:u,index:0,popupHeight:"200px"}).appendTo(p),n}validateCfInput(e){const t=this.parent.serviceLocator.getService(Ma);let i=e.target.value;const n=t.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0];i&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(i=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!i.trim()}checkCellHandler(e,t,i){let n=!1;const s=i.range.trim().split(",");for(let r=0;r<s.length;r++){let i=s[r];i=i.indexOf(":")>-1?i:i+":"+i;const a=Ni(i);if(e>=a[0]&&e<=a[2]&&t>=a[1]&&t<=a[3]){n=!0;break}}return n}getDlgText(e){const t=this.parent.serviceLocator.getService(Da);let i="";switch(e){case t.getConstant("GreaterThan")+"...":i=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":i=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":i=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":i=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":i=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":i=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":i=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":i=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":i=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":i=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":i=t.getConstant("FormatCellsBelow")}return i}cFInitialRender(e){const t=this.parent.getActiveSheet().conditionalFormats;if(t)for(let i=0;i<t.length;i++){let n=!1;n=this.checkCellHandler(e.rowIdx,e.colIdx,t[i]),n&&this.cFInitialCheckHandler({rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,conditionalFormat:t[i]})}}triggetConditionalFormatEvent(e,t){t&&(e.conditionalFormat.value||"AboveAverage"===e.conditionalFormat.type||"BelowAverage"===e.conditionalFormat.type||"Duplicate"===e.conditionalFormat.type)&&this.parent.trigger("beforeConditionalFormat",e)}cFInitialCheckHandler(e){let t,i=!1;const n=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],s=e.cell.value||"",r=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(!r)return;const a=e.conditionalFormat;if(a.type=a.type||"GreaterThan",a.cFColor=a.cFColor||a.format?a.cFColor:"RedFT",i=this.cFRCheck(a,s,r,e.rowIdx,e.colIdx,!0),this.triggetConditionalFormatEvent({conditionalFormat:a,cell:e.cell,element:r,address:_i(e.rowIdx,e.colIdx),apply:i},e.isAction),i){for(let t=0;t<n.length;t++)if(r.classList.contains(n[t])){r.classList.remove(n[t]);break}a.format&&a.format.style&&(t=a.format.style);let e={};a.cFColor?(r.classList.add("e-"+a.cFColor.toLowerCase()),e=this.setFormat(e,a)):e=t,e.backgroundColor&&r.style.setProperty("background-color",e.backgroundColor),e.color&&r.style.setProperty("color",e.color),e.fontWeight&&r.style.setProperty("font-weight",e.fontWeight),e.fontStyle&&r.style.setProperty("font-style",e.fontStyle),e.textDecoration&&r.style.setProperty("text-decoration",e.textDecoration)}}checkConditionalFormatHandler(e){let t,i=!1,n=!1;const s=this.parent.getActiveSheet(),a=e.cell;let o=e.td||this.parent.getCell(e.rowIdx,e.colIdx);const l=s.conditionalFormats,h=a?Object(r.Z)(a.value)?"":a.value:"",c=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"];if(l&&!(l.length<1))for(let d=l.length-1;d>=0;d--){const a=l[d].range.trim().split(",");for(let i=0;i<a.length;i++){let s=a[i];if(s=s.indexOf(":")>-1?s:s+":"+s,t=Ni(s),e.rowIdx>=t[0]&&e.colIdx>=t[1]&&e.rowIdx<=t[2]&&e.colIdx<=t[3]){n=!0;break}}if(n){if("GreaterThanLessThanEqualToBetweenContainsTextDateOccur".includes(s.conditionalFormats[d].type)){const t=Cs(e.rowIdx,e.colIdx,s)&&Cs(e.rowIdx,e.colIdx,s).value?Cs(e.rowIdx,e.colIdx,s).value:"";i=(!Object(r.Z)(t)||""!==t)&&this.cFRCheck(s.conditionalFormats[d],t,o),this.setColor(o,e.rowIdx,e.colIdx,d,i,e.isAction)}else if("Top10ItemsBottom10ItemsTop10%Bottom10%AboveAverageBelowAverageDuplicateUnique".includes(s.conditionalFormats[d].type))for(let n=0;n<a.length;n++){let r=a[n];r=r.indexOf(":")>-1?r:r+":"+r,t=Ni(r);for(let n=t[0];n<=t[2];n++){s.rows[n]||Gs(s,n,{});for(let r=t[1];r<=t[3];r++){s.rows[n].cells&&s.rows[n].cells[r]||vs(n,r,s,{});const t=Cs(n,r,s)&&Cs(n,r,s).value?Cs(n,r,s).value:"";i=this.cFRCheck(s.conditionalFormats[d],t,o,n,r,!1),o=this.parent.getCell(n,r),this.setColor(o,n,r,d,i,e.isAction)}}}else if("BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleColorScaleGYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScaleThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(s.conditionalFormats[d].type)){for(let e=0;e<c.length;e++)o.classList.contains(c[e])&&o.classList.remove(c[e]);i=this.cFRCheck(s.conditionalFormats[d],h,o,e.rowIdx,e.colIdx,!1)}n=!1}if(i)break}}setColor(e,t,i,n,s,a){const o=this.parent.getActiveSheet(),l=o.conditionalFormats;this.triggetConditionalFormatEvent({conditionalFormat:l[n],cell:Cs(t,i,o),element:e,address:_i(t,i),apply:s},a);const h=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"];let c=!1;if(l[n].cFColor)e&&e.classList.contains("e-"+l[n].cFColor.toLowerCase())&&(c=!0);else if(l[n].format.style.backgroundColor&&e.style.backgroundColor){const t=this.hexToRgb(l[n].format.style.backgroundColor);"rgb("+t.r+", "+t.g+", "+t.b+")"===e.style.backgroundColor&&(c=!0)}if(s){if(c)for(let t=0;t<h.length;t++)if(e.classList.contains(h[t])){e.classList.remove(h[t]);break}let s={};l[n].cFColor?(e.classList.add("e-"+l[n].cFColor.toLowerCase()),s=this.setFormat(s,l[n])):s=l[n].format.style,this.parent.notify(rn,{style:s,rowIdx:t,colIdx:i,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0})}else{if(c){for(let t=0;t<h.length;t++)if(e.classList.contains(h[t])){e.classList.remove(h[t]);break}e.removeAttribute("style")}const n=Cs(t,i,this.parent.getActiveSheet(),null,!0),s=Object(r.L)({},this.parent.commonCellStyle,n.style);this.parent.notify(rn,{style:s,rowIdx:t,colIdx:i})}}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}cFRCheck(e,t,i,n,s,r){let a="",o="";const l=t.toString();if(e.value){const t=e.value.split(",").filter(e=>!!e.trim());if(t.length>1)if(t[0].split("(").length>1){let e="";for(let i=0;i<t.length;i++)e+=t[i]+",",e.split("(").length===e.split(")").length&&""===a&&(a=e.substring(0,e.length-1),e="");o=e.substring(0,e.length-1)}else{a=t[0];for(let e=1;e<t.length;e++)o+=e+1===t.length?t[e]:t[e]+","}else a=1===t.length?t[0]:e.value}let h=!1,c=e.type;"BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleDataBar".includes(c)&&(c="DataBar"),"GYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScale".includes(c)&&(c="ColorScale"),"ThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(c)&&(c="IconSet");let d={};switch(c){case"GreaterThan":h=this.isGreaterThanLessThan(e,l,a,!0);break;case"LessThan":h=this.isGreaterThanLessThan(e,l,a,!1);break;case"Between":h=this.isBetWeen(e,l,a,o);break;case"EqualTo":h=this.isEqualTo(e,l,a);break;case"ContainsText":h=this.isContainsText(l,a);break;case"DateOccur":d={value:a,rowIndex:0,colIndex:0,sheetIndex:0,updatedVal:""},this.parent.notify("checkDateFormat",d),l===d.updatedVal&&(h=!0);break;case"Unique":case"Duplicate":h=this.isDuplicateUnique(l,e);break;case"Top10Items":h=this.isTopBottomTenValue(l,a,e,!0);break;case"Bottom10Items":h=this.isTopBottomTenValue(l,a,e,!1);break;case"Top10Percentage":h=this.isTopBottomTenPercentage(l,a,e,!0);break;case"Bottom10Percentage":h=this.isTopBottomTenPercentage(l,a,e,!1);break;case"AboveAverage":h=this.isAboveBelowAverage(l,a,e,!0);break;case"BelowAverage":h=this.isAboveBelowAverage(l,a,e,!1);break;case"DataBar":case"ColorScale":case"IconSet":this.isDataBarColorScalesIconSets(c,l,e,i,n,s,r)}return h}isDataBarColorScalesIconSets(e,t,i,n,s,r,a){const o=this.parent.getActiveSheet();if(a)"DataBar"===e?this.applyDataBars(t,i,n,s,r):"ColorScale"===e?this.applyColorScale(t,i,n,s,r):this.applyIconSet(t,i,n,s,r);else{n=null;const t=i.range.split(",");for(let s=0;s<t.length;s++){const r=Ni(t[s]);for(let t=r[0];t<=r[2];t++)for(let s=r[1];s<=r[3];s++)if(Cs(t,s,o)){const r=Cs(t,s,o).value;n=this.parent.getCell(t,s),"DataBar"===e?this.applyDataBars(r,i,n,t,s):"ColorScale"===e?this.applyColorScale(r,i,n,t,s):this.applyIconSet(r,i,n,t,s)}}}}applyIconSet(e,t,i,n,s){const a=parseInt(e,10),o=this.getIconList(t.type).split(",");let l=[];const h=this.parent.getActiveSheet(),c=h.rows[n]&&h.rows[n].cells[s]?h.rows[n].cells[s]:null;if(!c)return;const d=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[s],p=t.range.split(",");for(let r=0;r<p.length;r++){const e=Ni(p[r]);l=this.getNumericArray(e,l)}l=l.sort((e,t)=>e-t);const g=l[0],u=l[l.length-1];let m;if(3===o.length){const e=g+.33*(u-g);m="e-"+(a>=g+.67*(u-g)?o[0].trim():a>=e?o[1].trim():o[2].trim())}else if(4===o.length){const e=g+.25*(u-g),t=g+.5*(u-g);m="e-"+(a>=g+.75*(u-g)?o[0].trim():a>=t?o[1].trim():a>=e?o[2].trim():o[3].trim())}else if(5===o.length){const e=g+.2*(u-g),t=g+.4*(u-g),i=g+.6*(u-g);m="e-"+(a>=g+.8*(u-g)?o[0].trim():a>=i?o[1].trim():a>=t?o[2].trim():a>=e?o[3].trim():o[4].trim())}if(!Object(r.Z)(c)){const e=this.parent.createElement("span",{className:"e-icon"});e.classList.add("e-iconsetspan"),e.classList.add(m),this.applyIconSetIcon({rowIndex:n,colIndex:s},e,d)}}applyIconSetIcon(e,t,i){const n=this.parent.getActiveSheet(),s=Cs(e.rowIndex,e.colIndex,n).value,r=i;r.classList.contains("e-iconset")&&r.querySelector(".e-iconsetspan")&&r.removeChild(r.querySelector(".e-iconsetspan")),tn(s)&&(r.insertBefore(t,r.childNodes[0]),r.classList.add("e-iconset"))}getIconList(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"}applyColorScale(e,t,i,n,s){const a=this.parent.getActiveSheet(),o=parseInt(e,10);let l,h=[];const c=this.getColor(t.type),d=a.rows[n]&&a.rows[n].cells[s]?a.rows[n].cells[s]:null;if(!d)return;const p=t.range.split(","),g=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[s];for(let r=0;r<p.length;r++){const e=Ni(p[r]);h=this.getNumericArray(e,h)}h=h.sort((e,t)=>e-t).reverse();for(let r=0;r<h.length;r++)if(h[r]===o){l=r;break}const u=0===l?c[0]:l===h.length-1?c[c.length-1]:3===h.length&&1===l?c[1]:this.getGradient(l,c[0],c[1],c[2],h.length);if(!Object(r.Z)(d)){let e={};Object(r.Z)(l)?(e=this.parent.getCellStyleValue(["backgroundColor"],[n,s]),g.style.backgroundColor=e.backgroundColor):(e={backgroundColor:u},g.style.backgroundColor=u)}}applyDataBars(e,t,i,n,s){const a=this.parent.getActiveSheet();let o={},l={},h="",c="",d=t.type;const p=a.rows[n].cells&&a.rows[n].cells[s]?a.rows[n].cells[s]:null;if(!p)return;let g=[];const u=this.parent.getMainContent().getElementsByClassName("e-row")[n],m=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[s],f=u&&u.style?parseInt(u.style.height,10):20;let b,y=[],x=[],C=0;const v=parseInt(e,10),S=t.range.split(",");for(let r=0;r<S.length;r++){const e=Ni(S[r]);g=this.getNumericArray(e,g)}for(let r=0;r<g.length;r++)for(let e=0;e<g.length;e++)g[e]>0?y.push(g[e]):x.push(g[e]);if(d="BlueDataBar"===d?"B":"GreenDataBar"===d?"G":"RedDataBar"===d?"R":"OrangeDataBar"===d?"O":"LightBlueDataBar"===d?"LB":"PurpleDataBar"===d?"P":"",h=this.getColor(d)[0],c=this.getColor("R")[0],y=y.sort((e,t)=>e-t).reverse(),x=x.sort((e,t)=>e-t),x.length&&y.length)b=y[0]+Math.abs(x[0]),C=Math.abs(x[0]/b*100);else{if(!x.length&&!y.length)return;b=x.length?x[0]:y[0]}if(m&&(Object(r.Z)(v)||""===e)&&m.getElementsByClassName("e-cf-databar")[0]&&m.removeChild(m.getElementsByClassName("e-cf-databar")[0]),tn(v)){const e=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),t=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),i=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),n=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"});let s;o=t.style,l=i.style,e.appendChild(n),e.insertBefore(i,n),e.insertBefore(t,i),m.querySelector(".e-iconsetspan")&&(s=m.querySelector(".e-iconsetspan")),m.textContent="",m.appendChild(e),s&&m.insertBefore(s,m.firstElementChild),n.innerHTML=this.parent.getDisplayText(p),e.style.height=f-1+"px",n.style.fontSize="11pt",x.length?y.length?v>-1?(o.width=C+"%",o.height=f-3+"px",o.backgroundColor="transparent",o.left="0px",l.width=Math.ceil(Math.abs(v/b*100))+"%",l.height=f-3+"px",l.backgroundColor=d=h,l.left=C+"%"):v<0&&(o.width=Math.ceil(Math.abs(v/b*100))+"%",o.height=f-3+"px",o.backgroundColor=c,o.width===C+"%"?o.left="0px":o.right=100-C+"%"):(l.width=Math.ceil(Math.abs(v/b*100))+"%",l.height=f-3+"px",l.backgroundColor=d=c,l.left="0px"):(l.width=Math.ceil(Math.abs(v/b*100))+"%",l.height=f-3+"px",l.backgroundColor=d=h,l.left="0px")}}getNumericArray(e,t){const i=this.parent.getActiveSheet();for(let n=e[0];n<=e[2];n++)for(let s=e[1];s<=e[3];s++){const e=Cs(n,s,i)&&Cs(n,s,i).value?Cs(n,s,i).value:"";if(Object(r.Z)(e)||tn(e)||en(e)){const i=parseInt(e,10);Object(r.Z)(e)||""===e||t.push(i)}}return t}getColor(e){if("LB"===e)return["#008aef"];const t=e.split(""),i=[];for(let n=0;n<t.length;n++)switch(t[n]){case"G":i.push("#63be7b");break;case"Y":i.push("#ffeb84");break;case"R":i.push("#f8696b");break;case"W":i.push("#ffffff");break;case"B":i.push("#5a8ac6");break;case"O":i.push("#ffb628");break;case"LB":i.push("#008aef");break;case"P":i.push("#d6007b")}return i}getGradient(e,t,i,n,s){if(Object(r.Z)(n))return this.getLinear(t,i,e/s);{const r=s/2;return e>=r?this.getLinear(i,n,Math.abs((e-r)/r)):this.getLinear(t,i,e/r)}}getLinear(e,t,i){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],i)+this.byteLinear(e[3]+e[4],t[3]+t[4],i)+this.byteLinear(e[5]+e[6],t[5]+t[6],i)}byteLinear(e,t,i){const n=parseInt(e,16)*(1-i)+parseInt(t,16)*i|0;return Math.abs(n).toString(16)}isGreaterThanLessThan(e,t,i,n){const s=new RegExp(/[^.-a-zA-Z 0-9]+/g);let r=!1;if(tn(t))if(tn(i))r=n?parseFloat(t)>parseFloat(i.replace(s,"")):parseFloat(t)<parseFloat(i.replace(s,""));else{const s={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),s.isDate||s.isTime?(r=n?t>s.updatedVal:t<s.updatedVal,e.value=s.updatedVal.toString()):r=n?t.toLowerCase()>i.toLowerCase():t.toLowerCase()<i.toLowerCase()}else""!==t||0===Number(i)||n||(r=!0);return r}isBetWeen(e,t,i,n){const s=new RegExp(/[^.-a-zA-Z 0-9]+/g);let r=!1;if(i=i.replace(s,""),n=n.replace(s,""),tn(t))if(tn(i))r=parseFloat(t)>=parseFloat(i)&&parseFloat(t)<=parseFloat(n);else if(i&&n){const s={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1},a={value:n,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),this.parent.notify("checkDateFormat",a),(s.isDate||s.isTime)&&(a.isDate||a.isTime)?(r=t>=s.updatedVal&&t<=a.updatedVal,e.value=s.updatedVal.toString()+","+a.updatedVal.toString()):r=t.toLowerCase()>=i.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return r}isEqualTo(e,t,i){const n=new RegExp(/[^.-a-zA-Z 0-9]+/g);let s=!1;if(tn(t))if(tn(i))s=parseFloat(t)===parseFloat(i.replace(n,""));else{const n={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",n),n.isTime||n.isDate?(s=t===n.updatedVal,e.value=n.updatedVal.toString()):s=t.toLowerCase()===i.toLowerCase()}return s}isContainsText(e,t){const i=new RegExp(/[^.-a-zA-Z 0-9]+/g);let n=!1;return Object(r.Z)(e)||!e.length?n=!1:tn(t.replace(i,""))?(t=t.replace(i,""),en(e)&&(e=Qi(e).toString()),n=e.indexOf(t)>-1):en(t)?(en(e)&&(e=Qi(e).toString()),n=e.indexOf(Qi(t).toString())>-1):n=e.toLowerCase().indexOf(t.toLowerCase())>-1,n}isTopBottomTenValue(e,t,i,n){const s=this.parent.getActiveSheet(),r=new RegExp(/[^.-a-zA-Z 0-9]+/g);let a=parseInt(e,10),o=parseInt(t,10),l=!1;if(tn(t)){tn(e)?(a=parseFloat(e),o=parseFloat(t.replace(r,""))):en(e)&&(a=Qi(e),o=parseFloat(t));let h,c=[];const d=i.range.split(",");for(let e=0;e<d.length;e++){const t=Ni(d[e]);for(let e=t[0];e<=t[2];e++)for(let i=t[1];i<=t[3];i++)h=Cs(e,i,s)&&Cs(e,i,s).value?Cs(e,i,s).value:"",h&&tn(h)&&(h=parseFloat(h),c.push(h))}c=n?c.sort((e,t)=>e-t).reverse():c.sort((e,t)=>e-t),c=c.slice(0,o),l=c.indexOf(a)>-1}return l}isTopBottomTenPercentage(e,t,i,n){const s=this.parent.getActiveSheet(),r=new RegExp(/[^.-a-zA-Z 0-9]+/g);let a=parseInt(e,10),o=parseInt(t,10),l=!1;if(tn(t)){tn(e)?(a=parseFloat(e),o=parseFloat(t.replace(r,""))):en(e)&&(a=Qi(e),o=parseFloat(t));let h,c,d=[],p=0;const g=i.range.split(",");for(let e=0;e<g.length;e++){const t=Ni(g[e]);for(let e=t[0];e<=t[2];e++)for(let i=t[1];i<=t[3];i++)h=Cs(e,i,s)&&Cs(e,i,s).value?Cs(e,i,s).value:"",h&&tn(h)&&(h=parseFloat(h),d.push(h)),p++}c=o/(100/p),c=Math.ceil(c),d=n?d.sort((e,t)=>e-t).reverse():d.sort((e,t)=>e-t),d=d.slice(0,c||1),l=d.indexOf(a)>-1}return l}isAboveBelowAverage(e,t,i,n){const s=this.parent.getActiveSheet(),r=parseFloat(e),a=i.range.split(",");let o=!1;const l=[];let h,c=0;for(let d=0;d<a.length;d++){const e=Ni(a[d]);for(let t=e[0];t<=e[2];t++)for(let i=e[1];i<=e[3];i++)h=Cs(t,i,s)&&Cs(t,i,s).value?Cs(t,i,s).value:"",h&&tn(h)&&(h=parseFloat(h),l.push(h))}for(let d=0;d<l.length;d++)c+=l[d];return c/=l.length,o=n?r>c:r<c,o}isDuplicateUnique(e,t){const i=t.type;let n=0;const s=this.parent.getActiveSheet(),a=e,o=t.range.split(",");let l;if(Object(r.Z)(a)||""===a)return!1;for(let r=0;r<o.length;r++){const e=Ni(o[r]);for(let t=e[0];t<=e[2];t++)for(let r=e[1];r<=e[3];r++)if(l=Cs(t,r,s)&&Cs(t,r,s).value?Cs(t,r,s).value.toString():"",l&&""!==l&&(n=a.toLowerCase()===l.toLowerCase()?n+1:n,2===n))return"Duplicate"===i}return"Duplicate"!==i}setFormat(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e}getModuleName(){return"conditionalFormatting"}}var pa=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let ga=(()=>{class e extends r.e{}return pa([Object(r.t)("")],e.prototype,"text",void 0),pa([Object(r.t)("")],e.prototype,"iconCss",void 0),pa([Object(r.t)("left")],e.prototype,"iconPosition",void 0),e})(),ua=(()=>{class e extends r.e{}return pa([Object(r.g)({},ga)],e.prototype,"header",void 0),pa([Object(r.f)([],o.c)],e.prototype,"content",void 0),pa([Object(r.t)("")],e.prototype,"cssClass",void 0),pa([Object(r.t)(!1)],e.prototype,"disabled",void 0),e})(),ma=(()=>{let e=class extends r.h{constructor(e,t){super(e)}preRender(){}render(){this.element.id||(this.element.id=Object(r.W)("ribbon")),this.renderRibbon()}destroy(){const e=this.element.querySelector(".e-drop-icon");if(e&&e.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){const e=document.getElementById(`${this.element.id}_menu`);e&&Object(r.N)(e,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,super.destroy()}getTabItems(){const e=[];return this.menuItems.length&&e.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(t=>{e.push({header:t.header,content:this.toolbarObj.element})}),e}initMenu(e){const t=this.createElement("ul",{id:`${this.element.id}_menu`});this.element.appendChild(t);const i=new o.d({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:t=>{t.parentItem.text===e[0].text&&(i.showItemOnClick=!1),this.trigger("beforeOpen",t)},select:e=>{this.trigger("fileMenuItemSelect",e)},beforeClose:t=>{"mouseover"!==t.event.type||Object(r.D)(t.event.target,".e-menu-popup")?(this.trigger("beforeClose",t),t.parentItem&&t.parentItem.text!==e[0].text||requestAnimationFrame(()=>i.setProperties({showItemOnClick:!0},!0))):t.cancel=!0},beforeItemRender:e=>{this.trigger("beforeFileMenuItemRender",e)}});return i.createElement=this.createElement,i.appendTo(t),t.parentElement}renderRibbon(){const e=this.createElement("div"),t=this.createElement("div");this.toolbarObj=new o.h({items:this.items[this.selectedTab].content,clicked:e=>this.trigger("clicked",e)}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(t),this.tabObj=new o.g({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:e=>{if(this.menuItems.length&&0===e.selectingIndex)e.cancel=!0;else{if(e.selectingIndex===this.getIndex(this.selectedTab))return;let t;this.updateToolbar(this.getIndex(e.selectingIndex,!0)),this.toolbarObj.dataBind(),this.element.classList.contains("e-collapsed")&&r.l.remove(e.selectedItem,"click",this.ribbonExpandCollapse),this.menuItems.length?(t=Object.assign({},e),t.selectingIndex-=1,t.selectedIndex-=1):t=e,this.trigger("selecting",t)}},selected:e=>{e.selectedIndex!==this.getIndex(this.selectedTab)&&(this.setProperties({selectedTab:this.getIndex(e.selectedIndex,!0)},!0),this.element.classList.contains("e-collapsed")&&(this.element.classList.remove("e-collapsed"),this.trigger("expandCollapse",{element:this.toolbarObj.element,expanded:!0})))},created:()=>{this.toolbarObj.refreshOverflow()}}),this.element.appendChild(e),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(e);const i=this.createElement("span",{className:"e-drop-icon e-icons"});i.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(i)}ribbonExpandCollapse(e){const t={element:this.toolbarObj.element,expanded:!0};let i;this.element.classList.contains("e-collapsed")?(i=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),i.classList.add("e-active"),r.l.remove(i,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",t)):(i=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),t.expanded=!1,i.classList.remove("e-active"),r.l.add(i,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",t))}getIndex(e,t){return this.menuItems.length?t?e-1:e+1:e}updateToolbar(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()}enableMenuItems(e,t=!0,i){this.menuItems.length&&Object(r.N)(document.getElementById(`${this.element.id}_menu`),"menu").enableItems(e,t,i)}hideMenuItems(e,t=!0,i){if(!this.menuItems.length)return;const n=Object(r.N)(document.getElementById(`${this.element.id}_menu`),"menu");t?n.hideItems(e,i):n.showItems(e,i)}addMenuItems(e,t,i=!0,n){if(!this.menuItems.length)return;const s=Object(r.N)(document.getElementById(`${this.element.id}_menu`),"menu");i?s.insertAfter(e.reverse(),t,n):s.insertBefore(e,t,n)}hideTabs(e,t=!0){let i,n,s,r;if(t||(r=this.isAllHidden()),e.forEach(e=>{i=this.getTabIndex(e,-1),i>-1&&(t?this.items[i].cssClass.includes(" e-hide")||(this.items[i].cssClass=`${this.items[i].cssClass} e-hide`,this.tabObj.items[this.getIndex(i)].cssClass=this.items[i].cssClass,void 0===n&&i===this.selectedTab&&(n=!0),s=!0):this.items[i].cssClass.includes(" e-hide")&&(this.items[i].cssClass=this.items[i].cssClass.replace(" e-hide",""),this.tabObj.items[this.getIndex(i)].cssClass=this.items[i].cssClass,void 0===n&&i===this.selectedTab&&(n=!0),s=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(r=this.isAllHidden(),r&&(n=!1)),!t&&r&&(n=!n),s&&r&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),n)for(let a=0;a<this.items.length;a++)if(!this.items[a].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(a),this.tabObj.dataBind();break}}isAllHidden(){let e=!0;for(let t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e}enableTabs(e,t=!0){e.forEach(e=>{let i=this.getTabIndex(e,-1);i>-1&&(this.items[i].disabled=!t,i=this.getIndex(i),this.tabObj.enableTab(i,t))}),this.setProperties({items:this.items},!0)}addTabs(e,t){let i=this.getTabIndex(t);e.forEach(e=>{e=new ua(this.items[0],"items",e,!0),this.items.splice(i,0,e),this.tabObj.addTab([{header:e.header,content:this.toolbarObj.element}],this.getIndex(i)),i++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)}getTabIndex(e,t=this.items.length){if(e)for(let i=0;i<this.items.length;i++)if(this.items[i].header.text===e){t=i;break}return t}addToolbarItems(e,t,i){const n=this.getTabIndex(e);Object(r.Z)(i)&&(i=this.items[n].content.length),t.forEach(e=>{e=new o.c(this.items[n].content[0],"content",e,!0),this.items[n].content.splice(i,0,e),i++}),this.setProperties({items:this.items},!0),n===this.selectedTab&&t.length&&this.updateToolbar(n)}enableItems(e,t,i){if(void 0===i&&(i=!0),t){const n=this.getTabIndex(e,-1);if(n<0)return;for(let e=0;e<t.length;e++){if("string"==typeof t[e])for(let i=0;i<this.items[n].content.length;i++)if(this.items[n].content[i].id===t[e]){t[e]=i;break}if("string"==typeof t[e])return;this.items[n].content[t[e]].disabled=!i,n!==this.selectedTab&&this.setProperties({items:this.items},!0)}n===this.selectedTab&&this.updateToolbar(n)}else this.toolbarObj.disable(!i)}hideToolbarItems(e,t,i=!0){let n;for(let s=0;s<this.items.length;s++)if(this.items[s].header.text===e){n=s,t.forEach(e=>{this.items[n].content[e]&&(i?this.items[n].content[e].cssClass.includes(" e-hide")||(this.items[n].content[e].cssClass=this.items[n].content[e].cssClass+" e-hide"):this.items[n].content[e].cssClass.includes(" e-hide")&&(this.items[n].content[e].cssClass=this.items[n].content[e].cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==n&&n===this.selectedTab&&this.updateToolbar(n)}getModuleName(){return"ribbon"}getPersistData(){return this.addOnPersist([])}onPropertyChanged(e,t){for(const i of Object.keys(e))switch(i){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}}};return pa([Object(r.t)("")],e.prototype,"cssClass",void 0),pa([Object(r.t)(!0)],e.prototype,"menuType",void 0),pa([Object(r.f)([],o.e)],e.prototype,"menuItems",void 0),pa([Object(r.t)(0)],e.prototype,"selectedTab",void 0),pa([Object(r.f)([],ua)],e.prototype,"items",void 0),pa([Object(r.k)()],e.prototype,"selecting",void 0),pa([Object(r.k)()],e.prototype,"fileMenuItemSelect",void 0),pa([Object(r.k)()],e.prototype,"beforeFileMenuItemRender",void 0),pa([Object(r.k)()],e.prototype,"beforeOpen",void 0),pa([Object(r.k)()],e.prototype,"beforeClose",void 0),pa([Object(r.k)()],e.prototype,"selectFormat",void 0),pa([Object(r.k)()],e.prototype,"clicked",void 0),pa([Object(r.k)()],e.prototype,"created",void 0),pa([Object(r.k)()],e.prototype,"expandCollapse",void 0),e=pa([r.r],e),e})();class fa{constructor(e){this.parent=e,this.addEventListener()}render(){const e=this.parent.element.id;let t=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new l.a({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Pa,enableOpacity:!1,beforeClose:()=>this.beforeCloseHandler(this.fontColorPicker),open:this.openHandler.bind(this),beforeModeSwitch:e=>this.beforeModeSwitch(this.fontColorPicker,e),change:e=>{const t={style:{color:this.fontColorPicker.getValue(e.currentValue.rgba)},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel?this.fontColorPicker.setProperties({value:this.fontColorPicker.getValue(e.previousValue.rgba,"HEXA")},!0):this.updateSelectedColor(t.style.color,this.fontColorPicker.element),Ur(this.parent.element)},created:()=>this.wireFocusEvent(this.fontColorPicker.element,"#000000")}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(t),this.fontColorPicker.appendTo(t),t.parentElement.id=`${e}_font_color_picker`,Object(r.w)([t.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),t=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new l.a({value:"#ffff00ff",mode:"Palette",presetColors:Na,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:()=>this.beforeCloseHandler(this.filColorPicker),beforeModeSwitch:e=>this.beforeModeSwitch(this.filColorPicker,e),change:e=>{const t={style:{backgroundColor:this.filColorPicker.getValue(e.currentValue.rgba)},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel?this.filColorPicker.setProperties({value:this.filColorPicker.getValue(e.previousValue.rgba,"HEXA")},!0):this.updateSelectedColor(t.style.backgroundColor,this.filColorPicker.element),Ur(this.parent.element)},created:()=>this.wireFocusEvent(this.filColorPicker.element,"#ffff00")}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(t),this.filColorPicker.appendTo(t),t.parentElement.id=`${e}_fill_color_picker`,Object(r.w)([t.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])}updateSelectedColor(e,t){t.nextElementSibling.querySelector(".e-selected-color").style.borderBottomColor=e}wireFocusEvent(e,t){this.updateSelectedColor(t,e),(e=e.parentElement.querySelector(".e-split-colorpicker")).addEventListener("focus",()=>{Ur(this.parent.element)})}openHandler(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(Da).getConstant("MoreColors")}beforeCloseHandler(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0)}beforeModeSwitch(e,t){const i=this.parent.serviceLocator.getService(Da);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=i.getConstant("Apply"),t.element.querySelector(".e-cancel").title=i.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=i.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=i.getConstant("MoreColors"))}destroy(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)}addEventListener(){this.parent.on("beforeRibbonCreate",this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}removeEventListener(){this.parent.off("beforeRibbonCreate",this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on("spreadsheetDestroyed",this.destroy,this)}}class ba{constructor(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.preTabIdx=1,this.chartThemeIndex=5,this.parent=e,this.addEventListener(),new fa(e)}getModuleName(){return"ribbon"}initRibbon(e){this.parent.showRibbon||!this.ribbon?(this.parent.notify("beforeRibbonCreate",{}),this.parent.isMobileView()?this.createMobileView():this.createRibbon(e)):this.destroy()}getRibbonMenuItems(){const e=this.parent.serviceLocator.getService(Da),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:`${t}_File`,items:[{text:e.getConstant("New"),id:`${t}_New`,iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:`${t}_Open`,iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:`${t}_Save_As`,items:[{text:e.getConstant("ExcelXlsx"),id:`${t}_Xlsx`,iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:`${t}_Xls`,iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:`${t}_Csv`,iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:`${t}_Pdf`,iconCss:"e-pdf e-icons"}]}]}]}getRibbonItems(){const e=this.parent.element.id,t=this.parent.serviceLocator.getService(Da),i=[{header:{text:t.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:`${t.getConstant("Undo")} (Ctrl+Z)`,id:e+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:`${t.getConstant("Redo")} (Ctrl+Y)`,id:e+"_redo",disabled:!0},{type:"Separator",id:e+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:`${t.getConstant("Cut")} (Ctrl+X)`,id:e+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:`${t.getConstant("Copy")} (Ctrl+C)`,id:e+"_copy"},{tooltipText:`${t.getConstant("Paste")} (Ctrl+V)`,template:this.getPasteBtn(e),id:e+"_paste",disabled:!0},{type:"Separator",id:e+"_separator_2"},{template:this.getNumFormatDDB(e),tooltipText:t.getConstant("NumberFormat"),id:e+"_number_format"},{type:"Separator",id:e+"_separator_3"},{template:this.getFontNameDDB(e),tooltipText:t.getConstant("Font"),id:e+"_font_name"},{type:"Separator",id:e+"_separator_4"},{template:this.getFontSizeDDB(e),tooltipText:t.getConstant("FontSize"),id:e+"_font_size"},{type:"Separator",id:e+"_separator_5"},{template:this.getBtn(e,"bold"),tooltipText:`${t.getConstant("Bold")} (Ctrl+B)`,id:e+"_bold"},{template:this.getBtn(e,"italic"),tooltipText:`${t.getConstant("Italic")} (Ctrl+I)`,id:e+"_italic"},{template:this.getBtn(e,"line-through"),tooltipText:`${t.getConstant("Strikethrough")} (Ctrl+5)`,id:e+"_line-through"},{template:this.getBtn(e,"underline"),tooltipText:`${t.getConstant("Underline")} (Ctrl+U)`,id:e+"_underline"},{template:document.getElementById(`${e}_font_color_picker`),tooltipText:t.getConstant("TextColor"),id:e+"_font_color_picker"},{type:"Separator",id:e+"_separator_6"},{template:document.getElementById(`${e}_fill_color_picker`),tooltipText:t.getConstant("FillColor"),id:e+"_fill_color_picker"},{template:this.getBordersDBB(e),tooltipText:t.getConstant("Borders"),id:e+"_borders"},{template:this.getMergeSplitBtn(e),tooltipText:t.getConstant("MergeCells"),id:e+"_merge_cells",disabled:!0},{type:"Separator",id:e+"_separator_7"},{template:this.getTextAlignDDB(e),tooltipText:t.getConstant("HorizontalAlignment"),id:e+"_text_align"},{template:this.getVerticalAlignDDB(e),tooltipText:t.getConstant("VerticalAlignment"),id:e+"_vertical_align"},{template:this.getBtn(e,"wrap",!1),tooltipText:`${t.getConstant("WrapText")}`,id:e+"_wrap"}]},{header:{text:t.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:t.getConstant("Link"),id:e+"_hyperlink",tooltipText:t.getConstant("Link"),click:()=>{this.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:t.getConstant("Image"),id:e+"_",tooltipText:t.getConstant("Image"),click:()=>{Object(r.ob)("#"+e+"_imageUpload",this.parent.element).click()}}]},{header:{text:t.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:t.getConstant("InsertFunction"),text:t.getConstant("InsertFunction"),id:e+"_insert_function"}]},{header:{text:t.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:t.getConstant("ProtectSheet"),id:e+"_protect",tooltipText:t.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:t.getConstant("ProtectWorkbook"),id:e+"_protectworkbook",tooltipText:t.getConstant("ProtectWorkbook")},{type:"Separator",id:e+"_separator_8"},{template:this.datavalidationDDB(e),tooltipText:t.getConstant("DataValidation"),id:e+"_datavalidation"}]},{header:{text:t.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:e+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:e+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:e+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:e+"_separator_13"},{prefixIcon:"e-freeze-pane",text:t.getConstant("FreezePanes"),id:e+"_freezepanes",tooltipText:t.getConstant("FreezePanes")},{prefixIcon:"e-freeze-row",text:t.getConstant("FreezeRows"),id:e+"_freezerows",tooltipText:t.getConstant("FreezeRows")},{prefixIcon:"e-freeze-column",text:t.getConstant("FreezeColumns"),id:e+"_freezecolumns",tooltipText:t.getConstant("FreezeColumns")}]}];return this.parent.allowConditionalFormat&&i.find(e=>e.header&&e.header.text===t.getConstant("Home")).content.push({type:"Separator",id:e+"_separator_10"},{template:this.getCFDBB(e),tooltipText:t.getConstant("ConditionalFormatting"),id:e+"_conditionalformatting"}),this.parent.allowChart&&i.find(e=>e.header&&e.header.text===t.getConstant("Insert")).content.push({type:"Separator",id:e+"_separator_11"},{template:this.getChartDDB(e,!0),text:t.getConstant("Chart"),tooltipText:t.getConstant("Chart"),id:e+"_chart"}),this.parent.allowCellFormatting&&i.find(e=>e.header&&e.header.text===t.getConstant("Home")).content.push({type:"Separator",id:e+"_separator_12"},{template:this.getClearDDB(e),tooltipText:t.getConstant("Clear"),id:e+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&i.find(e=>e.header&&e.header.text===t.getConstant("Home")).content.push({template:this.getSortFilterDDB(e),tooltipText:t.getConstant("SortAndFilter"),id:e+"_sorting"}),this.parent.allowFindAndReplace&&i.find(e=>e.header&&e.header.text===t.getConstant("Home")).content.push({template:this.getFindDDb(e),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:t.getConstant("FindReplaceTooltip"),id:e+"_find"}),i}getPasteBtn(e){const t=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste"})),i=this.parent.serviceLocator.getService(Da);return this.pasteSplitBtn=new p.c({iconCss:"e-icons e-paste-icon",items:[{text:i.getConstant("All"),id:"All"},{text:i.getConstant("Values"),id:"Values"},{text:i.getConstant("Formats"),id:"Formats"}],select:e=>{this.parent.notify(yn,{type:e.item.id,isAction:!0,isInternal:!0})},click:()=>{this.parent.notify(yn,{isAction:!0,isInternal:!0})},close:()=>{Ur(this.parent.element)}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(t),t.parentElement}getHyperlinkDlg(){const e=Ni(this.parent.getActiveSheet().activeCell),t=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[e[0]];let i;Object(r.Z)(t)||(i=t.cells[e[1]]),Object(r.Z)(i)&&vs(e[0],e[1],this.parent.getActiveSheet(),i,!1),this.parent.notify(i&&i.hyperlink?"editHyperlink":"initiateHyperlink",null)}passwordProtectDlg(){this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify("protectWorkbook",null)}getLocaleText(e,t){let i;const n=this.parent.serviceLocator.getService(Da);return this.parent.getActiveSheet()["show"+e]?(t&&document.getElementById(this.parent.element.id+"_sheet").classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant("Hide"+e)):(t&&document.getElementById(this.parent.element.id+"_sheet").classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant("Show"+e)),i}getLocaleProtectText(e,t){let i;const n=this.parent.serviceLocator.getService(Da);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant("Protect"+e)),i}getLocaleProtectWorkbook(e,t){let i;const n=this.parent.serviceLocator.getService(Da);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant(e)),i}insertDesignChart(){const e=this.parent.serviceLocator.getService(Da);let t=this.ribbon.items.length-1;if(this.preTabIdx=this.ribbon.selectedTab,this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text!==e.getConstant("ChartDesign")){const i=this.parent.element.id,n=[{header:{text:e.getConstant("ChartDesign")},content:[{template:this.getAddChartEleDBB(i),tooltipText:e.getConstant("AddChartElement"),id:i+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:e.getConstant("SwitchRowColumn"),tooltipText:e.getConstant("SwitchRowColumn"),id:i+"switch_row_column_chart",click:()=>{this.parent.notify("chartDesignTab",{switchRowColumn:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(i),tooltipText:e.getConstant("ChartTheme"),id:i+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(i,!1),tooltipText:e.getConstant("ChartType"),id:i+"_chart_type"}]}];this.parent.addRibbonTabs(n),t=this.ribbon.items.length,this.ribbon.tabObj.select(t)}}removeDesignChart(){const e=this.parent.serviceLocator.getService(Da),t=this.ribbon.items.length-1;this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)}createRibbon(e){const t=this.parent.createElement("div",{id:`${this.parent.element.id}_ribbon`});if(this.ribbon=new ma({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e&&e.uiUpdate){const e=this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel");this.parent.element.insertBefore(t,e)}else this.parent.element.appendChild(t);this.ribbon.appendTo(t)}tabSelecting(e){e.selectingIndex!==this.ribbon.selectedTab&&(this.refreshRibbonContent(e.selectingIndex),this.parent.notify("tabSwitch",{activeTab:e.selectingIndex}))}beforeRenderHandler(e){const t=this.parent.serviceLocator.getService(Da);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")}getChartThemeDDB(e){const t=this.parent.createElement("button",{id:e+"_chart_theme"});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Material"})),this.chartThemeDDB=new p.b({items:this.getChartThemeDdbItems(),content:"",select:e=>this.chartThemeDDBSelect(e),close:()=>this.parent.element.focus(),cssClass:"e-flat e-charttheme-ddb",beforeOpen:e=>this.tBarDdbBeforeOpen(e.element,e.items)}),this.chartThemeDDB.createElement=this.parent.createElement,this.chartThemeDDB.appendTo(t),t}getNumFormatDDB(e){const t=this.parent.createElement("button",{id:e+"_number_format"});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new p.b({items:this.getNumFormatDdbItems(e),content:"",select:e=>this.numDDBSelect(e),open:e=>this.numDDBOpen(e),beforeItemRender:e=>this.previewNumFormat(e),close:()=>Ur(this.parent.element),cssClass:"e-flat e-numformat-ddb",beforeOpen:e=>this.tBarDdbBeforeOpen(e.element,e.items)}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(t),t}getFontSizeDDB(e){return this.fontSizeDdb=new p.b({cssClass:"e-font-size-ddb",content:"11",items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:e=>{this.tBarDdbBeforeOpen(e.element,e.items),this.refreshSelected(this.fontSizeDdb,e.element,"content","text")},select:e=>{const t={style:{fontSize:`${e.item.text}pt`},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel||(this.fontSizeDdb.content=t.style.fontSize.split("pt")[0],this.fontSizeDdb.dataBind())},close:()=>Ur(this.parent.element)}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size"})),this.fontSizeDdb.element}getChartDDB(e,t){const i=this.parent.serviceLocator.getService(Da);this.chartMenu=new o.d({cssClass:t?"e-chart-menu":"e-chart-type-menu",items:[{iconCss:"e-icons e-column",text:i.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:i.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:i.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:i.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:i.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:i.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:e=>{e.parentItem.text===i.getConstant("Column")?(e.element.firstChild.appendChild(n),e.element.parentElement.classList.add("e-column-chart")):e.parentItem.text===i.getConstant("Bar")?(e.element.firstChild.appendChild(f),e.element.parentElement.classList.add("e-bar-chart")):e.parentItem.text===i.getConstant("Area")?(e.element.firstChild.appendChild(R),e.element.parentElement.classList.add("e-area-chart")):e.parentItem.text===i.getConstant("Line")?(e.element.firstChild.appendChild(j),e.element.parentElement.classList.add("e-line-chart")):e.parentItem.text===i.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(B),e.element.parentElement.classList.add("e-pie-doughnut-chart")):e.parentItem.text===i.getConstant("Radar")?(e.element.firstChild.appendChild(U),e.element.parentElement.classList.add("e-radar-chart")):e.parentItem.text===i.getConstant("Scatter")&&(e.element.firstChild.appendChild(Y),e.element.parentElement.classList.add("e-scatter-chart"))},select:this.chartSelected.bind(this)}),this.chartMenu.createElement=this.parent.createElement;const n=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),s=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:i.getConstant("Column")}),a=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),l=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});n.appendChild(s),n.appendChild(a);const h=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),c=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),d=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),g=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),u=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),m=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});h.title=i.getConstant("ClusteredColumn"),c.title=i.getConstant("StackedColumn"),d.title=i.getConstant("StackedColumn100"),m.title=i.getConstant("OrangeDataBar"),u.title=i.getConstant("LightblueDataBar"),g.title=i.getConstant("PurpleDataBar"),a.appendChild(h),a.appendChild(c),a.appendChild(d),l.appendChild(g),l.appendChild(u),l.appendChild(m);const f=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),b=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:i.getConstant("Bar")}),y=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),x=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});f.appendChild(b),f.appendChild(y);const C=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),v=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),S=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),w=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),I=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),O=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});C.title=i.getConstant("ClusteredBar"),v.title=i.getConstant("StackedBar"),S.title=i.getConstant("StackedBar100"),O.title=i.getConstant("OrangeDataBar"),I.title=i.getConstant("LightblueDataBar"),w.title=i.getConstant("PurpleDataBar"),y.appendChild(C),y.appendChild(v),y.appendChild(S),x.appendChild(w),x.appendChild(I),x.appendChild(O);const R=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),A=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:i.getConstant("Area")}),k=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});R.appendChild(A),R.appendChild(k);const E=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),L=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),T=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});E.title=i.getConstant("Area"),L.title=i.getConstant("StackedArea"),T.title=i.getConstant("StackedArea100"),k.appendChild(E),k.appendChild(L),k.appendChild(T);const j=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),D=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:i.getConstant("Line")}),M=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});j.appendChild(D),j.appendChild(M);const F=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),P=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),N=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});F.title=i.getConstant("Line"),P.title=i.getConstant("StackedLine"),N.title=i.getConstant("StackedLine100"),M.appendChild(F),M.appendChild(P),M.appendChild(N);const B=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),H=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:i.getConstant("Pie")}),_=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});B.appendChild(H),B.appendChild(_);const z=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),V=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});z.title=i.getConstant("Pie"),V.title=i.getConstant("Doughnut"),_.appendChild(z),_.appendChild(V);const U=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),q=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),W=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});U.appendChild(q),U.appendChild(W);const Z=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),G=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});Z.title=i.getConstant("BlueDataBar"),G.title=i.getConstant("GreenDataBar"),W.appendChild(Z),W.appendChild(G);const Y=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),X=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:i.getConstant("Scatter")}),$=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});Y.appendChild(X),Y.appendChild($);const K=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});K.title=i.getConstant("Scatter"),$.appendChild(K);const J=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+(t?"_chart_menu":"_chart_type_menu"),styles:"display: none;"}));this.chartMenu.appendTo(J),J.classList.add("e-ul");const Q=t?"e-chart-ddb":"e-chart-type-ddb",ee=t?e+"_chart-btn":e+"_chart-type-btn";let te;return this.chartDdb=new p.b({iconCss:"e-icons "+(t?"e-chart-icon":"e-chart-type-icon"),cssClass:Q,target:this.chartMenu.element.parentElement,created:()=>{this.chartMenu.element.style.display=""},beforeClose:e=>{e.event&&Object(r.D)(e.event.target,"."+Q)&&Object(r.D)(e.event.target,"."+Q).id!==ee&&(e.cancel=!0)},close:()=>Ur(this.parent.element)}),this.chartDdb.createElement=this.parent.createElement,t?(te=this.parent.createElement("button",{id:ee}),te.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:i.getConstant("Chart")}))):(te=this.parent.createElement("button",{id:ee}),te.appendChild(this.parent.createElement("span",{id:e+"_chart_type",innerHTML:i.getConstant("ChartType")}))),this.chartDdb.appendTo(te),this.chartDdb.element}getAddChartEleDBB(e){const t=this.parent.serviceLocator.getService(Da);this.addChartMenu=new o.d({cssClass:"e-addchart-menu",title:t.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:t.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:t.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:t.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:t.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:t.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",text:t.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:t.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:t.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:t.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:t.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:t.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:t.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:t.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:t.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:t.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:t.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:t.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:t.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:t.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:t.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:t.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:t.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this)});const i=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_add_chart_menu",styles:"display: none;"}));this.addChartMenu.appendTo(i),i.classList.add("e-ul"),this.addChartDdb=new p.b({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:this.addChartMenu.element.parentElement,created:()=>{this.addChartMenu.element.style.display=""},beforeClose:t=>{t.event&&Object(r.D)(t.event.target,".e-addchart-ddb")&&Object(r.D)(t.event.target,".e-addchart-ddb").id!==e+"_addchart"&&(t.cancel=!0)},close:()=>this.parent.element.focus()}),this.addChartDdb.createElement=this.parent.createElement;const n=this.parent.createElement("button",{id:e+"_addchart"});return n.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:t.getConstant("AddChartElement")})),this.addChartDdb.appendTo(n),this.addChartDdb.element}getCFDBB(e){const t=this.parent.serviceLocator.getService(Da);this.cFMenu=new o.d({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:t.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan",text:t.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan",text:t.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between",text:t.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto",text:t.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textthatcontains",text:t.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring",text:t.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues",text:t.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:t.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items",text:t.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10",text:t.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items",text:t.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10",text:t.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage",text:t.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage",text:t.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:t.getConstant("DataBars"),items:[{id:"cf_databars"}]},{iconCss:"e-icons e-colorscales",text:t.getConstant("ColorScales"),items:[{id:"cf_colorscales"}]},{iconCss:"e-icons e-iconsets",text:t.getConstant("IconSets"),items:[{id:"cf_iconsets"}]},{iconCss:"e-icons e-clearrules",text:t.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:t.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:t.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:e=>{e.parentItem.text===t.getConstant("DataBars")?(e.element.firstChild.appendChild(i),e.element.parentElement.classList.add("e-databars")):e.parentItem.text===t.getConstant("ColorScales")?(e.element.firstChild.appendChild(g),e.element.parentElement.classList.add("e-colorscales")):e.parentItem.text===t.getConstant("IconSets")&&(e.element.firstChild.appendChild(E),e.element.parentElement.classList.add("e-iconsets"))},select:this.cFSelected.bind(this)});const i=this.parent.createElement("div",{id:"db",className:"e-db"}),n=this.parent.createElement("div",{id:"db1",className:"e-db1"}),s=this.parent.createElement("div",{id:"db2",className:"e-db2"});i.appendChild(n),i.appendChild(s);const r=this.parent.createElement("span",{id:"BlueDataBar",className:"e-bdatabar e-databar-icon"}),a=this.parent.createElement("span",{id:"GreenDataBar",className:"e-gdatabar e-databar-icon"}),l=this.parent.createElement("span",{id:"RedDataBar",className:"e-rdatabar e-databar-icon"}),h=this.parent.createElement("span",{id:"OrangeDataBar",className:"e-odatabar e-databar-icon"}),c=this.parent.createElement("span",{id:"LightBlueDataBar",className:"e-lbdatabar e-databar-icon"}),d=this.parent.createElement("span",{id:"PurpleDataBar",className:"e-pdatabar e-databar-icon"});r.title=t.getConstant("BlueDataBar"),a.title=t.getConstant("GreenDataBar"),l.title=t.getConstant("RedDataBar"),h.title=t.getConstant("OrangeDataBar"),c.title=t.getConstant("LightblueDataBar"),d.title=t.getConstant("PurpleDataBar"),n.appendChild(r),n.appendChild(a),n.appendChild(l),s.appendChild(h),s.appendChild(c),s.appendChild(d),this.cFMenu.createElement=this.parent.createElement;const g=this.parent.createElement("div",{id:"db",className:"e-cs"}),u=this.parent.createElement("div",{id:"cs1",className:"e-cs1"}),m=this.parent.createElement("div",{id:"cs2",className:"e-cs2"}),f=this.parent.createElement("div",{id:"cs3",className:"e-cs3"});g.appendChild(u),g.appendChild(m),g.appendChild(f);const b=this.parent.createElement("span",{id:"GYRColorScale",className:"e-gyr e-colorscale-icon"}),y=this.parent.createElement("span",{id:"RYGColorScale",className:"e-ryg e-colorscale-icon"}),x=this.parent.createElement("span",{id:"GWRColorScale",className:"e-gwr e-colorscale-icon"}),C=this.parent.createElement("span",{id:"RWGColorScale",className:"e-rwg e-colorscale-icon"}),v=this.parent.createElement("span",{id:"BWRColorScale",className:"e-bwr e-colorscale-icon"}),S=this.parent.createElement("span",{id:"RWBColorScale",className:"e-rwb e-colorscale-icon"}),w=this.parent.createElement("span",{id:"WRColorScale",className:"e-wr e-colorscale-icon"}),I=this.parent.createElement("span",{id:"RWColorScale",className:"e-rw e-colorscale-icon"}),O=this.parent.createElement("span",{id:"GWColorScale",className:"e-gw e-colorscale-icon"}),R=this.parent.createElement("span",{id:"WGColorScale",className:"e-wg e-colorscale-icon"}),A=this.parent.createElement("span",{id:"GYColorScale",className:"e-gy e-colorscale-icon"}),k=this.parent.createElement("span",{id:"YGColorScale",className:"e-yg e-colorscale-icon"});b.title=t.getConstant("GYRColorScale"),y.title=t.getConstant("RYGColorScale"),x.title=t.getConstant("GWRColorScale"),C.title=t.getConstant("RWGColorScale"),v.title=t.getConstant("BWRColorScale"),S.title=t.getConstant("RWBColorScale"),w.title=t.getConstant("WRColorScale"),I.title=t.getConstant("RWColorScale"),O.title=t.getConstant("GWColorScale"),R.title=t.getConstant("WGColorScale"),A.title=t.getConstant("GYColorScale"),k.title=t.getConstant("YGColorScale"),u.appendChild(b),u.appendChild(y),u.appendChild(x),u.appendChild(C),m.appendChild(v),m.appendChild(S),m.appendChild(w),m.appendChild(I),f.appendChild(O),f.appendChild(R),f.appendChild(A),f.appendChild(k);const E=this.parent.createElement("div",{id:"is",className:"e-is"}),L=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),T=this.parent.createElement("div",{id:"is2",className:"e-is2"}),j=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),D=this.parent.createElement("div",{id:"is4",className:"e-is4"}),M=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),F=this.parent.createElement("div",{id:"is6",className:"e-is6"}),P=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),N=this.parent.createElement("div",{id:"is8",className:"e-is8"});L.title=t.getConstant("GYColorScale"),T.title=t.getConstant("YGColorScale"),j.title=t.getConstant("GYColorScale"),D.title=t.getConstant("YGColorScale"),M.title=t.getConstant("GYColorScale"),F.title=t.getConstant("YGColorScale"),P.title=t.getConstant("GYColorScale"),N.title=t.getConstant("YGColorScale"),E.appendChild(L),E.appendChild(T),E.appendChild(j),E.appendChild(D),E.appendChild(M),E.appendChild(F),E.appendChild(P),E.appendChild(N);const B=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),H=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),_=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),z=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),V=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),U=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),q=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});B.title=t.getConstant("ThreeArrowsColor"),H.title=t.getConstant("ThreeArrowsGray"),_.title=t.getConstant("ThreeTriangles"),z.title=t.getConstant("FourArrowsColor"),V.title=t.getConstant("FourArrowsGray"),U.title=t.getConstant("FiveArrowsColor"),q.title=t.getConstant("FiveArrowsGray"),T.appendChild(B),T.appendChild(H),T.appendChild(_),T.appendChild(z),T.appendChild(V),T.appendChild(U),T.appendChild(q);const W=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),Z=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),G=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),Y=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),X=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});W.title=t.getConstant("ThreeTrafficLights1"),Z.title=t.getConstant("ThreeTrafficLights2"),G.title=t.getConstant("ThreeSigns"),Y.title=t.getConstant("FourTrafficLights"),X.title=t.getConstant("RedToBlack"),D.appendChild(W),D.appendChild(Z),D.appendChild(G),D.appendChild(Y),D.appendChild(X);const $=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),K=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),J=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});$.title=t.getConstant("ThreeSymbols1"),K.title=t.getConstant("ThreeSymbols2"),J.title=t.getConstant("ThreeFlags"),F.appendChild($),F.appendChild(K),F.appendChild(J);const Q=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),ee=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),te=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),ie=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),ne=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});Q.title=t.getConstant("ThreeStars"),ee.title=t.getConstant("FourRatings"),te.title=t.getConstant("FiveQuarters"),ie.title=t.getConstant("FiveRatings"),ne.title=t.getConstant("FiveBoxes"),N.appendChild(Q),N.appendChild(ee),N.appendChild(te),N.appendChild(ie),N.appendChild(ne),B.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),B.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),B.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),H.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),H.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),H.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),z.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),z.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),z.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),z.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),U.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),U.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),U.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),U.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),U.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),W.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),W.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),W.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),X.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),$.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),J.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),J.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),J.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),ee.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),ee.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),ee.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),ee.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),te.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),te.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),te.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),te.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),te.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan"));const se=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_cf_menu",styles:"display: none;"}));return this.cFMenu.appendTo(se),se.classList.add("e-ul"),this.cFDdb=new p.b({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:this.cFMenu.element.parentElement,created:()=>{this.cFMenu.element.style.display=""},close:()=>Ur(this.parent.element)}),this.cFDdb.createElement=this.parent.createElement,this.cFDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting"})),this.cFDdb.element}createElement(e,t){return this.parent.createElement(e,{className:t})}getBordersDBB(e){let t;const i=this.parent.serviceLocator.getService(Da);this.bordersMenu=new o.d({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:i.getConstant("TopBorders")},{iconCss:"e-icons e-left-borders",text:i.getConstant("LeftBorders")},{iconCss:"e-icons e-right-borders",text:i.getConstant("RightBorders")},{iconCss:"e-icons e-bottom-borders",text:i.getConstant("BottomBorders")},{iconCss:"e-icons e-all-borders",text:i.getConstant("AllBorders")},{iconCss:"e-icons e-horizontal-borders",text:i.getConstant("HorizontalBorders")},{iconCss:"e-icons e-vertical-borders",text:i.getConstant("VerticalBorders")},{iconCss:"e-icons e-outside-borders",text:i.getConstant("OutsideBorders")},{iconCss:"e-icons e-inside-borders",text:i.getConstant("InsideBorders")},{iconCss:"e-icons e-no-borders",text:i.getConstant("NoBorders")},{separator:!0},{text:i.getConstant("BorderColor"),items:[{id:`${e}_border_colors`}]},{text:i.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:`${e}_1px`},{id:`${e}_2px`},{id:`${e}_3px`},{id:`${e}_dashed`},{id:`${e}_dotted`},{id:`${e}_double`}]}],orientation:"Vertical",beforeOpen:e=>{"Border Color"===e.parentItem.text?(this.colorPicker.refresh(),t=this.colorPicker.element.parentElement,e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color")):e.element.classList.add("e-border-style")},beforeClose:e=>{"Border Color"===e.parentItem.text&&(!Object(r.D)(e.event.target,".e-border-colorpicker")||Object(r.D)(e.event.target,".e-apply")||Object(r.D)(e.event.target,".e-cancel")?(this.colorPicker=Object(r.N)(this.cPickerEle,"colorpicker"),"Picker"===this.colorPicker.mode&&(this.colorPicker.mode="Palette",this.colorPicker.dataBind()),t.style.display="",this.parent.element.appendChild(t)):e.cancel=!0)},onOpen:e=>{"Border Color"===e.parentItem.text&&(e.element.parentElement.style.overflow="visible")},select:this.borderSelected.bind(this)}),this.bordersMenu.createElement=this.parent.createElement;const n=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_borders_menu",styles:"display: none;"}));return this.bordersMenu.appendTo(n),n.classList.add("e-ul"),this.cPickerEle=this.parent.createElement("input",{id:`${e}_cell_border_color`,attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new l.a({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:e=>{const t=this.border.split(" ");t[2]=e.currentValue.hex,this.border=t.join(" ")},created:()=>{t=this.colorPicker.element.parentElement}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle),this.bordersDdb=new p.b({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:this.bordersMenu.element.parentElement,created:()=>{this.bordersMenu.element.style.display=""},beforeOpen:e=>this.tBarDdbBeforeOpen(e.element.firstElementChild,this.bordersMenu.items,1),beforeClose:e=>{e.event&&Object(r.D)(e.event.target,".e-borders-menu")&&(e.cancel=!0)},close:()=>Ur(this.parent.element)}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders"})),this.bordersDdb.element}chartSelected(e){const t=!Object(r.Z)(Object(r.D)(e.element,".e-chart-menu")),i=e.element.id;"column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)&&this.parent.notify("insertChart",{action:i,id:e.event.target.id,isChart:t})}addChartEleSelected(e){this.parent.notify("chartDesignTab",{addChartEle:e.element.id})}cFSelected(e){const t=e.element.id;if("cf_greaterthancf_lessthancf_betweencf_eqaultocf_textthatcontainscf_adateoccuringcf_duplicatevaluescf_top10itemscf_top10cf_bottom10itemscf_bottom10cf_aboveaveragecf_belowaverage".includes(t))this.parent.notify("initiateConditionalFormat",{action:e.item.text});else if("cf_databarscf_colorscales".includes(t))this.parent.notify("setCF",{action:t,id:e.event.target.id});else if("cf_iconsets"===e.element.id){const i=e.event.target;this.parent.notify("setCF",{action:t,id:""===i.id?i.parentElement.id:i.id})}if("cf_cr_cells"===t)this.parent.notify("clearCFRule",{range:this.parent.getActiveSheet().selectedRange,isPublic:!1});else if("cf_cr_sheet"===t){const e=this.parent.getActiveSheet(),t=zi([0,0,e.rowCount-1,e.colCount-1]);this.parent.conditionalFormat=null,this.parent.notify("clearCFRule",{range:t,isPublic:!1})}}borderSelected(e){if(!e.item.items.length&&e.item.id!==`${this.parent.element.id}_border_colors`){if(!e.item.text){const t=this.parent.element.id,i=this.border.split(" "),n="solid"===i[1]?`${t}_${i[0]}`:`${t}_${i[1]}`;if(n===e.item.id)return;return e.item.id===`${t}_1px`||e.item.id===`${t}_2px`||e.item.id===`${t}_3px`?(i[0]=e.item.id.split(`${t}_`)[1],i[1]="solid"):(i[1]=e.item.id.split(`${t}_`)[1],i[0]="double"===i[1]?"3px":"1px"),this.border=i.join(" "),this.bordersMenu.items[12].items.forEach(t=>{t.id===n&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")}),void this.bordersMenu.setProperties({items:this.bordersMenu.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.text){case"Top Borders":this.parent.notify(sn,{style:{borderTop:this.border},onActionUpdate:!0});break;case"Left Borders":this.parent.notify(sn,{style:{borderLeft:this.border},onActionUpdate:!0});break;case"Right Borders":this.parent.notify(sn,{style:{borderRight:this.border},onActionUpdate:!0});break;case"Bottom Borders":this.parent.notify(sn,{style:{borderBottom:this.border},onActionUpdate:!0});break;case"All Borders":this.parent.notify(sn,{style:{border:this.border},onActionUpdate:!0});break;case"Horizontal Borders":this.parent.notify(sn,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case"Vertical Borders":this.parent.notify(sn,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case"Outside Borders":this.parent.notify(sn,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case"Inside Borders":this.parent.notify(sn,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case"No Borders":this.parent.notify(sn,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}}getFontNameDDB(e){const t=this.parent.createElement("button",{id:e+"_font_name"});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new p.b({cssClass:"e-font-family",items:this.getFontFamilyItems(),select:e=>{const t={style:{fontFamily:e.item.text},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel||this.refreshFontNameSelection(t.style.fontFamily)},close:()=>Ur(this.parent.element),beforeOpen:e=>this.tBarDdbBeforeOpen(e.element,e.items)}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(t),t}getBtn(e,t,i=!0){const n=new h.a({iconCss:`e-icons e-${t}-icon`,isToggle:!0});return n.createElement=this.parent.createElement,n.appendTo(this.parent.createElement("button",{id:`${e}_${t}`})),i&&n.element.addEventListener("click",this.toggleBtnClicked.bind(this)),n.element}datavalidationDDB(e){const t=this.parent.serviceLocator.getService(Da);let i;return this.datavalidationDdb=new p.b({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",items:[{text:t.getConstant("DataValidation")},{text:t.getConstant("HighlightInvalidData")},{text:t.getConstant("ClearHighlight")},{text:t.getConstant("ClearValidation")}],beforeOpen:e=>{this.refreshSelected(this.datavalidationDdb,e.element,"iconCss")},select:e=>{switch(e.item.text){case t.getConstant("DataValidation"):this.parent.notify("initiatedatavalidation",null);break;case t.getConstant("HighlightInvalidData"):this.parent.notify("invalidData",{isRemoveHighlight:!1});break;case t.getConstant("ClearHighlight"):this.parent.notify("invalidData",{isRemoveHighlight:!0});break;case t.getConstant("ClearValidation"):this.parent.notify("removeDataValidation",null);break;default:i=e.item.text===t.getConstant("SortAscending")?"Ascending":"Descending",this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:i}}})}},close:()=>Ur(this.parent.element)}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation"})),this.datavalidationDdb.element}getTextAlignDDB(e){return this.textAlignDdb=new p.b({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:e=>{this.refreshSelected(this.textAlignDdb,e.element,"iconCss")},select:e=>{const t={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel||(this.textAlignDdb.iconCss=`e-icons e-${t.style.textAlign}-icon`,this.textAlignDdb.dataBind())},close:()=>Ur(this.parent.element)}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align"})),this.textAlignDdb.element}getVerticalAlignDDB(e){return this.verticalAlignDdb=new p.b({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:e=>{this.refreshSelected(this.verticalAlignDdb,e.element,"iconCss")},select:e=>{const t={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};this.parent.notify(sn,t),t.cancel||(this.verticalAlignDdb.iconCss=`e-icons e-${t.style.verticalAlign}-icon`,this.verticalAlignDdb.dataBind())},close:()=>Ur(this.parent.element)}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align"})),this.verticalAlignDdb.element}getMergeSplitBtn(e){this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge"}));const t=this.parent.serviceLocator.getService(Da);return this.mergeSplitBtn=new p.c({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",items:[{text:t.getConstant("MergeAll"),id:`${e}_merge_all`},{text:t.getConstant("MergeHorizontally"),id:`${e}_merge_horizontally`},{text:t.getConstant("MergeVertically"),id:`${e}_merge_vertically`},{separator:!0,id:`${e}_merge_separator`},{text:t.getConstant("Unmerge"),id:`${e}_unmerge`}],select:this.mergeSelectHandler.bind(this),close:()=>Ur(this.parent.element),click:e=>{e.element.classList.contains("e-active")?(this.toggleActiveState(!1),this.unMerge()):(this.toggleActiveState(!0),this.merge(`${this.parent.element.id}_merge_all`))},created:()=>{this.mergeSplitBtn.element.title=t.getConstant("MergeCells"),this.mergeSplitBtn.element.nextElementSibling.title=t.getConstant("SelectMergeType")}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement}mergeSelectHandler(e){e.item.id===`${this.parent.element.id}_unmerge`?this.unMerge():this.merge(e.item.id)}unMerge(){this.parent.showSpinner(),this.parent.notify(ln,{merge:!1,range:this.parent.getActiveSheet().selectedRange,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()}merge(e){const t=this.parent.getActiveSheet(),i=Ni(t.selectedRange);let n,s;for(let a=i[0];a<=i[2];a++)for(let r=i[1];r<=i[3];r++)a===i[0]&&r===i[1]&&e.includes("merge_all")||a===i[0]&&e.includes("merge_vertically")||r===i[1]&&e.includes("_merge_horizontally")||(n=Cs(a,r,t)||{},(n.value||n.formula)&&(s=!0));if(!s)return void this.performMerge(e);const r=this.parent.serviceLocator.getService(Ma);r.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Da).getConstant("MergeCellsAlert"),beforeOpen:e=>{const t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Da).getConstant("Ok"),isPrimary:!0},click:()=>{r.hide(),this.performMerge(e)}}]})}performMerge(e){const t=this.parent.element.id;switch(this.parent.showSpinner(),e){case`${t}_merge_all`:this.parent.notify(ln,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case`${t}_merge_horizontally`:this.parent.notify(ln,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case`${t}_merge_vertically`:this.parent.notify(ln,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()}getSortFilterDDB(e){const t=this.parent.serviceLocator.getService(Da);let i;return this.sortingDdb=new p.b({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:t.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:t.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:t.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:t.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:t.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:t.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],beforeItemRender:t=>{const i={isFiltered:!1,isClearAll:!0};if(this.parent.notify("getFilteredColumn",i),t.item.id===e+"_clearfilter"||t.item.id===e+"_reapplyfilter")i.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled");else if(t.item.id===e+"_applyfilter"){const e=this.parent.getActiveSheet();(e.frozenColumns||e.frozenRows)&&t.element.classList.add("e-disabled")}},beforeOpen:e=>{this.refreshSelected(this.sortingDdb,e.element,"iconCss")},select:e=>{switch(e.item.text){case t.getConstant("Filter"):this.parent.applyFilter();break;case t.getConstant("ClearAllFilter"):this.parent.clearFilter();break;case t.getConstant("ReapplyFilter"):this.parent.notify("reapplyFilter",null);break;case t.getConstant("CustomSort")+"...":this.parent.notify("initiateCustomSort",null);break;default:i=e.item.text===t.getConstant("SortAscending")?"Ascending":"Descending",this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:i}}})}},close:()=>Ur(this.parent.element)}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting"})),this.sortingDdb.element}getFindDDb(e){const t=this.parent.createElement("button",{id:e+"_findbtn"});return this.findDdb=new h.a({cssClass:"e-spreadsheet-find-ddb e-caret-hide",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(t),t.onclick=()=>{this.findToolDlg()},this.findDdb.element}findToolDlg(){let e;if(Object(r.Z)(this.parent.element.querySelector(".e-findtool-dlg"))){let t;const i=this.parent.createElement("div",{className:"e-input-group"}),n=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text",value:this.findValue}}),s=this.parent.serviceLocator.getService(Da);n.setAttribute("placeholder",s.getConstant("FindValue"));const a=this.parent.createElement("span",{className:"e-input-group-icon"});n.onkeyup=()=>{e={countOpt:"count",findCount:""},this.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount;const i=document.querySelector(".e-text-findNext-short").value,n=document.querySelector(".e-findRib-next"),s=document.querySelector(".e-findRib-prev");Object(r.Z)(i)||""===i||"0 of 0"===e.findCount?(t.enableItems(n,!1),t.enableItems(s,!1),a.textContent="0 of 0"):Object(r.Z)(i)&&"0 of 0"===e.findCount||(t.enableItems(n,!0),t.enableItems(s,!0))},n.onkeydown=t=>{e={countOpt:"count",findCount:""},this.parent.notify("findHandler",{countArgs:e}),this.findOnKeyDown(t,e.findCount)},i.appendChild(n),i.appendChild(a),t=new o.h({clicked:t=>{"e-findRib-next"===t.item.cssClass?(this.parent.notify("findHandler",{findOption:"next"}),e={countOpt:"count",findCount:""},this.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount):"e-findRib-prev"===t.item.cssClass?(this.parent.notify("findHandler",{findOption:"prev"}),e={countOpt:"count",findCount:""},this.parent.notify("findHandler",{countArgs:e}),a.textContent=e.findCount):"e-findRib-more"===t.item.cssClass&&(this.parent.notify(wn,null),this.findDialog.hide())},width:"auto",height:"auto",items:[{type:"Input",template:i},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}],cssClass:"e-find-toolObj"});const l=this.parent.createElement("div",{className:"e-find-toolbar"}),h=this.parent.createElement("div",{className:"e-dlg-div"});this.findDialog=new g.a({isModal:!1,showCloseIcon:!1,cssClass:"e-findtool-dlg",content:l,visible:!1,allowDragging:!0,target:this.parent.element.querySelector(".e-sheet"),beforeOpen:()=>{r.l.add(document,"click",this.closeDialog,this)},open:()=>{this.textFocus(t.element)},beforeClose:()=>{this.findValue=this.parent.element.querySelector(".e-text-findNext-short").value,t.destroy();const e=document.querySelector(".e-find-toolbar");e&&r.l.remove(e,"focus",this.textFocus),r.l.remove(document,"click",this.closeDialog),Ur(this.parent.element)},created:()=>{t.createElement=this.parent.createElement,t.appendTo(l),this.findDialog.width=getComputedStyle(document.querySelector(".e-findtool-dlg")).width;const e=this.parent.element.querySelector(".e-main-panel").getBoundingClientRect(),i=this.findDialog.width.toString();this.findDialog.position={X:e.width-parseInt(i,10)-(this.parent.allowScrolling?or():0),Y:this.parent.getActiveSheet().showHeaders?31:0},this.findDialog.dataBind(),this.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(h)}else Object(r.Z)(this.parent.element.querySelector(".e-findtool-dlg"))||(this.findDialog.hide(),Object(r.J)(this.parent.element.querySelector(".e-findtool-dlg")),this.findDialog=null,Ur(this.parent.element))}findOnKeyDown(e,t){document.querySelector(".e-text-findNext-short").value&&"0 of 0"!==t&&(e.shiftKey?13===e.keyCode&&this.parent.notify("findHandler",{findOption:"prev"}):13===e.keyCode&&this.parent.notify("findHandler",{findOption:"next"}))}closeDialog(e){if((Object(r.D)(e.target,".e-findRib-close")||!Object(r.D)(e.target,".e-spreadsheet"))&&!Object(r.Z)(this.findDialog)){this.findDialog.hide();const e=this.parent.element.querySelector(".e-findtool-dlg");e&&Object(r.J)(e),this.findDialog=null}}textFocus(e){document.querySelector(".e-find-toolbar").addEventListener("focus",()=>{const e=document.querySelector(".e-text-findNext-short");e.focus(),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)})}getClearDDB(e){const t=this.parent.serviceLocator.getService(Da);return this.clearDdb=new p.b({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:t.getConstant("ClearAll")},{text:t.getConstant("ClearFormats")},{text:t.getConstant("ClearContents")},{text:t.getConstant("ClearHyperlinks")}],select:e=>{this.parent.notify("clearViewer",{options:{type:e.item.text}})},close:()=>Ur(this.parent.element)}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear"})),this.clearDdb.element}ribbonCreated(){this.ribbon.element.querySelector(".e-drop-icon").title=this.parent.serviceLocator.getService(Da).getConstant("CollapseToolbar")}alignItemRender(e){let t=e.item.iconCss.split(" e-")[1].split("-icon")[0];t=t[0].toUpperCase()+t.slice(1,t.length),e.element.title=this.parent.serviceLocator.getService(Da).getConstant("Align"+t)}toggleBtnClicked(e){const t=Object(r.D)(e.target,".e-btn"),i=this.parent.element.id;let n,s,a,o,l,h=sn;switch(t.id){case`${i}_bold`:s={fontWeight:"normal"},a={fontWeight:"bold"},l="fontWeight";break;case`${i}_italic`:s={fontStyle:"normal"},a={fontStyle:"italic"},l="fontStyle";break;case`${i}_line-through`:h="textDecorationUpdate",s={textDecoration:"line-through"},a=s,l="textDecoration";break;case`${i}_underline`:h="textDecorationUpdate",s={textDecoration:"underline"},a=s,l="textDecoration"}t.classList.contains("e-active")?(n=a[l],o={style:a,onActionUpdate:!0},this.parent.notify(h,o),o.cancel&&t.classList.remove("e-active")):(n=s[l],o={style:s,onActionUpdate:!0},this.parent.notify(h,o),o.cancel&&t.classList.add("e-active")),o.cancel||n===o.style[l]||this.refreshToggleBtn(Bi(this.parent.getActiveSheet().activeCell)),Ur(this.parent.element)}getCellStyleValue(e,t){const i=Cs(t[0],t[1],this.parent.getActiveSheet());let n=this.parent.cellStyle[e];return i&&i.style&&i.style[e]&&(n=i.style[e]),n}refreshSelected(e,t,i,n=i){for(let s=0;s<e.items.length;s++)if(e.items[s][n]===e[i]){t.children[s].classList.add("e-selected");break}}expandCollapseHandler(e){const t=this.ribbon.element.querySelector(".e-drop-icon"),i=this.parent.serviceLocator.getService(Da);t.title=i.getConstant(e.expanded?"CollapseToolbar":"ExpandToolbar"),this.parent.setPanelSize()}getChartThemeDdbItems(){const e=this.parent.serviceLocator.getService(Da);return[{id:"Material",text:e.getConstant("Material")},{id:"Fabric",text:e.getConstant("Fabric")},{id:"Bootstrap",text:e.getConstant("Bootstrap")},{id:"HighContrastLight",text:e.getConstant("HighContrastLight")},{id:"MaterialDark",text:e.getConstant("MaterialDark")},{id:"FabricDark",text:e.getConstant("FabricDark")},{id:"HighContrast",text:e.getConstant("HighContrast")},{id:"BootstrapDark",text:e.getConstant("BootstrapDark")},{id:"Bootstrap4",text:e.getConstant("Bootstrap4")}]}getNumFormatDdbItems(e){const t=this.parent.serviceLocator.getService(Da);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")}]}getFontFamilyItems(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]}numDDBSelect(e){const t={format:dn(e.item.id.split(this.parent.element.id+"_")[1]),range:this.parent.getActiveSheet().selectedRange,cancel:!1,requestType:"NumberFormat"},i={range:this.parent.getActiveSheet().name+"!"+t.range,format:t.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",t),this.parent.notify(vn,{eventArgs:t,action:"format"}),t.cancel||(this.parent.notify("applyNumber",t),this.parent.notify("selectionComplete",{type:"mousedown"}),this.refreshNumFormatSelection(e.item.text),this.parent.notify(Cn,{eventArgs:i,action:"format"}))}chartThemeDDBSelect(e){this.parent.notify("selectionComplete",{type:"mousedown"}),this.refreshChartThemeSelection(e.item.id),this.parent.notify("chartDesignTab",{chartTheme:e.item.id})}tBarDdbBeforeOpen(e,t,i=0){const n=this.parent.viewport.height;let s=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-i)+2*parseInt(getComputedStyle(e).paddingTop,10);if(i){const t=getComputedStyle(e.querySelector(".e-separator"));s+=i*(parseInt(t.borderBottomWidth,10)+2*parseInt(t.marginTop,10))}s>n?(e.style.height=`${n}px`,e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY="")}numDDBOpen(e){this.numPopupWidth=0;const t=e.element.querySelectorAll("span.e-numformat-preview-text");for(let n=0,s=t.length;n<s;n++)this.numPopupWidth<t[n].offsetWidth&&(this.numPopupWidth=t[n].offsetWidth);const i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=`${i}px`}previewNumFormat(e){const t=Bi(this.parent.getActiveSheet().activeCell),i=Cs(t[0],t[1],this.parent.getActiveSheet()),n={type:e.item.text,formattedText:"",value:i&&i.value?i.value:"",format:dn(e.item.id.split(this.parent.element.id+"_")[1]),sheetIndex:this.parent.activeSheetIndex,onLoad:!0},s=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="",this.parent.notify("getFormattedCell",n);const r=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:n.formattedText.toString()});s.appendChild(r),e.element.appendChild(s)}refreshRibbonContent(e){if(!this.ribbon)return;Object(r.Z)(e)&&(e=this.ribbon.selectedTab);const t=this.parent.serviceLocator.getService(Da),i=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case t.getConstant("Home"):this.refreshHomeTabContent(Bi(i.activeCell));break;case t.getConstant("Insert"):case t.getConstant("Formulas"):break;case t.getConstant("Data"):this.refreshDataTabContent(e);break;case t.getConstant("View"):this.refreshViewTabContent(e)}}refreshHomeTabContent(e){Object(r.Z)(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=Object(r.N)(document.getElementById(this.parent.element.id+"_number_format"),p.b));const t=this.parent.getActiveSheet(),i=Bi(this.parent.getActiveSheet().activeCell),n=this.parent.serviceLocator.getService(Da),s=Cs(i[0],i[1],this.parent.getActiveSheet())||{};let a=pn(s.format?s.format:"General");if(this.numFormatDDB&&(t.isProtected&&!t.protectSettings.formatCells?(a="General",this.refreshNumFormatSelection(a)):this.refreshNumFormatSelection(n.getConstant(a))),this.fontNameDdb&&this.refreshFontNameSelection(t.isProtected&&!t.protectSettings.formatCells?"Calibri":this.getCellStyleValue("fontFamily",e)),this.fontSizeDdb){let i=this.getCellStyleValue("fontSize",e);t.isProtected&&!t.protectSettings.formatCells?this.fontSizeDdb.content="11":(i=i.includes("pt")?i.split("pt")[0]:"11",i!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=i,this.fontSizeDdb.dataBind()))}if(this.textAlignDdb){let i=this.getCellStyleValue("textAlign",e);if(t.isProtected&&!t.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0===s.value||"left"!==i||"Accounting"!==a&&!tn(s.value)||(i="right");const e=`e-icons e-${i.toLowerCase()}-icon`;e!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=e,this.textAlignDdb.dataBind())}}if(this.verticalAlignDdb){const i=`e-icons e-${this.getCellStyleValue("verticalAlign",e).toLowerCase()}-icon`;t.isProtected&&!t.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":i!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=i,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!t.isProtected&&(s.rowSpan>1||s.colSpan>1))this.enableToolbarItems([{tab:n.getConstant("Home"),items:[`${this.parent.element.id}_merge_cells`],enable:!0}]),this.toggleActiveState(!0);else{const e=Ni(t.selectedRange);this.enableToolbarItems([{tab:n.getConstant("Home"),items:[`${this.parent.element.id}_merge_cells`],enable:e[0]!==e[2]||e[1]!==e[3]}]),this.toggleActiveState(!1)}}toggleActiveState(e){const t=this.parent.serviceLocator.getService(Da);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))}refreshToggleBtn(e){const t=this.parent.getActiveSheet();let i;const n=this.parent.element.id;let s,r;const a=Cs(e[0],e[1],t),o=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach((l,h)=>{i=document.getElementById(`${n}_${l}`),i&&(t.isProtected&&!t.protectSettings.formatCells?i.classList.remove("e-active"):"wrap"===l?r=a&&a.wrap:(s=this.getCellStyleValue(o[h],e).toLowerCase(),r=s.indexOf(l)>-1),r?i.classList.add("e-active"):i.classList.contains("e-active")&&i.classList.remove("e-active"))})}refreshFontNameSelection(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(let t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss="")}refreshNumFormatSelection(e){for(let t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0)}refreshChartThemeSelection(e){if(e!==this.chartThemeDDB.items[this.chartThemeIndex].text){this.chartThemeDDB.element.firstElementChild.textContent=this.getChartThemeText(e);for(let t=0;t<this.chartThemeDDB.items.length;t++)if(this.chartThemeDDB.items[t].id===e){this.chartThemeDDB.items[t].iconCss="e-icons e-selected-icon",this.chartThemeDDB.items[this.chartThemeIndex].iconCss="",this.chartThemeDDB.setProperties({items:this.chartThemeDDB.items},!0),this.chartThemeIndex=t;break}}}getChartThemeText(e){const t=this.parent.serviceLocator.getService(Da);let i="";switch(e){case"Material":i=t.getConstant("Material");break;case"Fabric":i=t.getConstant("Fabric");break;case"Bootstrap":i=t.getConstant("Bootstrap");break;case"HighContrastLight":i=t.getConstant("HighContrastLight");break;case"MaterialDark":i=t.getConstant("MaterialDark");break;case"FabricDark":i=t.getConstant("FabricDark");break;case"HighContrast":i=t.getConstant("HighContrast");break;case"BootstrapDark":i=t.getConstant("BootstrapDark");break;case"Bootstrap4":i=t.getConstant("Bootstrap4")}return i}fileMenuItemSelect(e){const t=Object(r.L)({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",t);const i=this.parent.element.id;let n;if(!t.cancel)switch(e.item.id){case`${i}_Open`:Object(r.ob)("#"+i+"_fileUpload",this.parent.element).click();break;case`${i}_Xlsx`:case`${i}_Xls`:case`${i}_Csv`:case`${i}_Pdf`:this.parent.save({saveType:e.item.id.split(`${i}_`)[1]});break;case`${i}_New`:n=this.parent.serviceLocator.getService(Ma),n.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(Da).getConstant("DestroyAlert"),beforeOpen:e=>{const t={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(Da).getConstant("Ok"),isPrimary:!0},click:()=>{this.parent.sheets.length=0,this.parent.createSheet(),n.hide(),this.parent.activeSheetIndex=this.parent.sheets.length-1,this.parent.notify("refreshSheetTabs",{}),this.parent.notify("sheetsDestroyed",{}),this.parent.renderModule.refreshSheet()}}]})}}toolbarClicked(e){if("spreadsheet_find"!==e.item.id){const t=this.parent.element.id,i=this.parent.getActiveSheet();let n,s,r,a,o;switch(e.item.id){case t+"_headers":if(n={isShow:!i.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Cn,{eventArgs:n,action:"headers"}),n.cancel)return;this.parent.setSheetPropertyOnMute(i,"showHeaders",!i.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab}),Ur(this.parent.element);break;case t+"_gridlines":if(s={isShow:!i.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Cn,{eventArgs:s,action:"gridLines"}),s.cancel)return;this.parent.setSheetPropertyOnMute(i,"showGridLines",!i.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab}),Ur(this.parent.element);break;case t+"_protect":this.parent.setSheetPropertyOnMute(i,"isProtected",!i.isProtected),r=!i.isProtected,this.parent.notify("applyProtect",{isActive:r,id:t+"_protect"});break;case t+"_undo":this.parent.notify("performUndoRedo",{isUndo:!0});break;case t+"_redo":this.parent.notify("performUndoRedo",{isUndo:!1});break;case t+"_freezepanes":a=Bi(i.topLeftCell),o=i.frozenRows||i.frozenColumns?a:Bi(i.activeCell),this.parent.notify("freeze",{row:o[0]-a[0],column:o[1]-a[1],isAction:!0});break;case t+"_freezerows":this.parent.notify("freeze",{row:i.frozenRows?0:Bi(i.activeCell)[0]-Bi(i.topLeftCell)[0],column:i.frozenColumns,isAction:!0});break;case t+"_freezecolumns":this.parent.notify("freeze",{row:i.frozenRows,column:i.frozenColumns?0:Bi(i.activeCell)[1]-Bi(i.topLeftCell)[1],isAction:!0});break;case t+"_protectworkbook":this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify("protectWorkbook",null)}this.parent.notify("ribboClick",e)}}toggleRibbonItems(e){let t="";const i=this.parent.serviceLocator.getService(Da).getConstant("View"),n=this.parent.serviceLocator.getService(Da).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if(Object(r.Z)(e.activeTab))for(let r=0,a=this.ribbon.items.length;r<a;r++)if(this.ribbon.items[r].header.text===i){e.activeTab=r;break}const t=this.getLocaleText(e.props,"GridLines"===e.props),n=`${this.parent.element.id}_${e.props.toLowerCase()}`,s=this.ribbon.items[e.activeTab].content.length;for(let i;i<s;i++)"Separator"!==this.ribbon.items[e.activeTab].content[i].type&&this.ribbon.items[e.activeTab].content[i].id===n&&(this.ribbon.items[e.activeTab].content[i].text=t,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(e.props.toLowerCase(),t)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if(Object(r.Z)(e.activeTab))for(let t=0,r=this.ribbon.items.length;t<r;t++)if(this.ribbon.items[t].header.text===n){e.activeTab=t;break}const i=`${this.parent.element.id}_${e.props.toLowerCase()}`;if(i===this.parent.element.id+"_protect"){const e=this.ribbon.items[this.ribbon.selectedTab].content.length;let i;for(i=0;i<e&&this.ribbon.items[this.ribbon.selectedTab].content[i].id!==this.parent.element.id+"_protect";i++);t=this.getLocaleProtectText("Sheet",!0)}else if(i===this.parent.element.id+"_protectworkbook"){const e=this.ribbon.items[this.ribbon.selectedTab].content.length;let i;for(i=0;i<e&&this.ribbon.items[this.ribbon.selectedTab].content[i].id!==this.parent.element.id+"_protectworkbook";i++);this.parent.isProtected||this.parent.password.length>0?t=this.getLocaleProtectWorkbook("UnProtectWorkbook"):this.parent.isProtected||(t=this.getLocaleProtectWorkbook("ProtectWorkbook"))}const s=this.ribbon.items[e.activeTab].content.length;for(let n;n<s;n++)"Separator"!==this.ribbon.items[e.activeTab].content[n].type&&this.ribbon.items[e.activeTab].content[n].id===i&&(this.ribbon.items[e.activeTab].content[n].text=t,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&this.updateToggleText(e.props.toLowerCase(),t)}}enableFileMenuItems(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)}hideRibbonTabs(e){this.ribbon.hideTabs(e.tabs,e.hide)}addRibbonTabs(e){this.ribbon.addTabs(e.items,e.insertBefore),Object(r.ob)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(Object(r.pb)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])}updateToggleText(e,t){nr(()=>{const i=Object(r.ob)(`#${this.parent.element.id}_${e} .e-tbar-btn-text`,this.ribbon.element);i&&(i.textContent=t)}),"headers"===e&&this.findDialog&&(this.findDialog.position.Y=this.parent.getActiveSheet().showHeaders?31:0,this.findDialog.dataBind())}refreshViewTabContent(e){const t=this.parent.element.id,i=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(Da);for(let s=0;s<this.ribbon.items[e].content.length;s++)"Separator"!==this.ribbon.items[e].content[s].type&&(this.ribbon.items[e].content[s].id===`${t}_headers`&&this.updateViewTabContent(e,"Headers",s),this.ribbon.items[e].content[s].id===`${t}_gridlines`&&this.updateViewTabContent(e,"GridLines",s),this.ribbon.items[e].content[s].id===`${t}_freezepanes`&&(i.frozenRows||i.frozenColumns?this.ribbon.items[e].content[s].text===n.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",s,e)):this.ribbon.items[e].content[s].text===n.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",s,e))),this.ribbon.items[e].content[s].id===`${t}_freezerows`&&(i.frozenRows?this.ribbon.items[e].content[s].text===n.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",s,e)):this.ribbon.items[e].content[s].text===n.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",s,e))),this.ribbon.items[e].content[s].id===`${t}_freezecolumns`&&(i.frozenColumns?this.ribbon.items[e].content[s].text===n.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",s,e)):this.ribbon.items[e].content[s].text===n.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",s,e))))}updateViewTabContent(e,t,i){const n=this.parent.getActiveSheet(),s=this.parent.serviceLocator.getService(Da);n["show"+t]?this.ribbon.items[e].content[i].text===s.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,i,e)):this.ribbon.items[e].content[i].text===s.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,i,e))}updateRibbonItemText(e,t,i,n){const s=this.parent.serviceLocator.getService(Da).getConstant(e+t);return this.ribbon.items[n].content[i].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0),s}refreshDataTabContent(e){const t=this.parent.element.id;let i;for(let n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===`${t}_protect`){if(this.updateDataTabContent(e,"Sheet",n),i)break;i=!0}this.ribbon.items[e].content[n].id===`${t}_protectworkbook`&&this.updateDataTabContent(e,"Workbook",n)}}updateDataTabContent(e,t,i){const n=this.parent.getActiveSheet(),s=this.parent.serviceLocator.getService(Da);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[i].text===s.getConstant("Protect"+t)&&(this.ribbon.items[e].content[i].cssClass="e-active",this.updateProtectBtn("Unprotect",t,i,e)):this.updateProtectBtn("Protect",t,i,e);else if("Workbook"===t){const n=this.parent.serviceLocator.getService(Da);this.parent.isProtected?this.ribbon.items[e].content[i].text===n.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("UnProtect",t,i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnProtect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,i,e))}}updateProtectBtn(e,t,i,n){const s=this.parent.serviceLocator.getService(Da).getConstant(e+t);this.ribbon.items[n].content[i].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",s)}updateProtectWorkbookBtn(e,t,i,n){const s=this.parent.serviceLocator.getService(Da).getConstant(e);this.ribbon.items[n].content[i].text=s,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",s)}addToolbarItems(e){this.ribbon.addToolbarItems(e.tab,e.items,e.index)}enableToolbarItems(e){e.forEach(e=>{this.ribbon.enableItems(e.tab||this.ribbon.items[this.ribbon.selectedTab].header.text,e.items,e.enable)})}createMobileView(){const e=this.parent.element.id,t=this.parent.createElement("div",{className:"e-header-toolbar"}),i=this.parent.createElement("ul");t.appendChild(i);const n=new o.h({items:[{prefixIcon:"e-tick-icon",align:"Left",id:e+"focused_tick",cssClass:"e-focused-tick"},{template:i,align:"Right",id:e+"file_menu"}],clicked:t=>{switch(t.item.id){case e+"focused_tick":this.parent.element.classList.remove("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize()}},created:()=>{const e=new o.d({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:this.getRibbonMenuItems(),select:this.fileMenuItemSelect.bind(this),beforeOpen:e=>{e.element.parentElement.classList.remove("e-rtl"),this.fileMenuBeforeOpen(e)},beforeClose:this.fileMenuBeforeClose.bind(this)});e.createElement=this.parent.createElement,e.appendTo(i)}});n.createElement=this.parent.createElement,n.appendTo(t),this.parent.element.insertBefore(t,this.parent.element.firstElementChild),this.renderMobileToolbar()}renderMobileToolbar(){const e=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),t=this.parent.createElement("div"),i=this.parent.createElement("button");e.appendChild(t),e.appendChild(i),e.style.display="block",this.parent.element.appendChild(e);const n=new p.b({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],select:e=>{e.item.text!==n.content&&(s.element.style.display="none",n.content=e.item.text,n.dataBind(),s.items=this.ribbon.items[n.items.indexOf(e.item)+1].content,s.width=`calc(100% - ${i.getBoundingClientRect().width}px)`,s.element.style.display="",s.dataBind(),s.items[0].text=e.item.text,s.dataBind())},open:e=>{const t=e.element.parentElement,i=t.getBoundingClientRect(),s=Object(g.d)(n.element,"right","bottom");t.style.left=s.left-i.width+"px",t.style.top=s.top-i.height+"px";for(let r=0;r<n.items.length;r++)if(n.content===n.items[r].text){e.element.children[r].classList.add("e-selected");break}},close:()=>Ur(this.parent.element)});n.createElement=this.parent.createElement,n.appendTo(i);const s=new o.h({width:`calc(100% - ${i.getBoundingClientRect().width}px)`,items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});s.createElement=this.parent.createElement,s.appendTo(t),e.style.display=""}fileMenuBeforeOpen(e){const t=this.parent.serviceLocator.getService(Da);let i;const n=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===t.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach((e,t)=>{i=this.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",i.appendChild(this.parent.createElement("span",{className:"e-extension",innerHTML:n[t]})),e.appendChild(i)}),this.parent.trigger("fileMenuBeforeOpen",e)}enableRibbonTabs(e){this.ribbon.enableTabs(e.tabs,e.enable)}fileMenuBeforeClose(e){this.parent.trigger("fileMenuBeforeClose",e)}hideFileMenuItems(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)}addFileMenuItems(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)}hideToolbarItems(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)}protectSheetHandler(e){const t=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(Da);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.enableToolbarItems([{tab:i.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]),this.parent.notify("setUndoRedo",null)):this.enableToolbarItems([{tab:i.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),this.enableToolbarItems(t.isProtected&&t.protectSettings.insertLink||!t.isProtected?[{tab:i.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]:[{tab:i.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),this.enableToolbarItems(t.isProtected&&t.protectSettings.selectCells||!t.isProtected?[{tab:i.getConstant("Home"),items:e.findBtnId,enable:!0}]:[{tab:i.getConstant("Home"),items:e.findBtnId,enable:!1}]);const n=this.ribbon.items[this.ribbon.selectedTab].content.length;let s;for(s=0;s<n&&this.ribbon.items[this.ribbon.selectedTab].content[s].id!==this.parent.element.id+"_protectworkbook";s++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===i.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[s].text=i.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[s].text=i.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:i.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===i.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[s].text=i.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[s].text=i.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:i.getConstant("Data"),items:e.dataValidationBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.imageBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.chartBtnId,enable:!0}]))}updateMergeItem(e){if("mousemove"===e.type||"pointermove"===e.type||e.shiftKey&&"mousedown"===e.type){const e=Ni(this.parent.getActiveSheet().selectedRange);e[1]===e[3]&&e[0]===e[2]||this.parent.getActiveSheet().isProtected||(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(Da).getConstant("Home"),items:[`${this.parent.element.id}_merge_cells`],enable:!0}]),this.toggleActiveState(!1))}}addEventListener(){this.parent.on("ribbon",this.initRibbon,this),this.parent.on("enableToolbarItems",this.enableToolbarItems,this),this.parent.on("activeCellChanged",this.refreshRibbonContent,this),this.parent.on("updateToggleItem",this.toggleRibbonItems,this),this.parent.on("enableFileMenuItems",this.enableFileMenuItems,this),this.parent.on("hideRibbonTabs",this.hideRibbonTabs,this),this.parent.on("addRibbonTabs",this.addRibbonTabs,this),this.parent.on("addToolbarItems",this.addToolbarItems,this),this.parent.on("hideFileMenuItems",this.hideFileMenuItems,this),this.parent.on("addFileMenuItems",this.addFileMenuItems,this),this.parent.on("hideToolbarItems",this.hideToolbarItems,this),this.parent.on("enableRibbonTabs",this.enableRibbonTabs,this),this.parent.on("protectCellFormat",this.protectSheetHandler,this),this.parent.on("selectionComplete",this.updateMergeItem,this),this.parent.on("refreshRibbonIcons",this.refreshRibbonContent,this),this.parent.on("insertDesignChart",this.insertDesignChart,this),this.parent.on("removeDesignChart",this.removeDesignChart,this),this.parent.on("ribbonFind",this.findToolDlg,this)}destroy(){const e=this.parent.element,t=this.ribbon.element,i=this.cPickerEle,n=e.id;["bold","italic","line-through","underline"].forEach(t=>{!function(e,t){if(e){const i=Object(r.N)(e,t);i&&i.destroy()}}(Object(r.ob)(`#${n}_${t}`,e),h.a)}),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.bordersMenu.destroy(),this.bordersMenu=null,this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.chartDdb.destroy(),this.chartDdb=null,this.chartMenu.destroy(),this.chartMenu=null,this.cFDdb.destroy(),this.cFDdb=null,this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),t&&Object(r.J)(t),this.ribbon=null,i&&Object(r.J)(i),this.cPickerEle=null,this.findDialog&&this.findDialog.destroy(),this.removeEventListener()}removeEventListener(){this.parent.isDestroyed||(this.parent.off("ribbon",this.initRibbon),this.parent.off("enableToolbarItems",this.enableToolbarItems),this.parent.off("activeCellChanged",this.refreshRibbonContent),this.parent.off("updateToggleItem",this.toggleRibbonItems),this.parent.off("enableFileMenuItems",this.enableFileMenuItems),this.parent.off("hideRibbonTabs",this.hideRibbonTabs),this.parent.off("addRibbonTabs",this.addRibbonTabs),this.parent.off("addToolbarItems",this.addToolbarItems),this.parent.off("hideFileMenuItems",this.hideFileMenuItems),this.parent.off("addFileMenuItems",this.addFileMenuItems),this.parent.off("hideToolbarItems",this.hideToolbarItems),this.parent.off("enableRibbonTabs",this.enableRibbonTabs),this.parent.off("protectCellFormat",this.protectSheetHandler),this.parent.off("selectionComplete",this.updateMergeItem),this.parent.off("refreshRibbonIcons",this.refreshRibbonContent),this.parent.off("insertDesignChart",this.insertDesignChart),this.parent.off("removeDesignChart",this.removeDesignChart),this.parent.on("ribbonFind",this.findToolDlg,this))}}class ya{constructor(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}getModuleName(){return"formulaBar"}createFormulaBar(e){if(!this.parent.showFormulaBar&&this.insertFnRipple)return void this.destroy();const t=this.parent.serviceLocator.getService(Da),i=this.parent.element.id,n=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){const e=this.parent.createElement("input",{id:i+"_name_box",attrs:{type:"text"}});n.appendChild(e),this.comboBoxInstance=new c.c({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:()=>{}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(e),this.comboBoxInstance.element.parentElement.title=t.getConstant("NameBox")}n.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:t.getConstant("InsertFunction")}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=Object(r.nb)(n,{selector:".e-insert-function"}),n.appendChild(this.parent.createElement("div",{className:"e-separator"}));const s=n.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:i+"_formula_input",attrs:{title:t.getConstant("FormulaBar"),spellcheck:"false"}}));s.rows=1,this.parent.isMobileView()?(s.placeholder=t.getConstant("MobileFormulaBarPlaceHolder"),r.l.add(s,"focus",this.textAreaFocusIn,this),r.l.add(s,"blur",this.textAreaFocusOut,this)):n.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:t.getConstant("ExpandFormulaBar")}})),e&&e.uiUpdate?this.parent.element.insertBefore(n,document.getElementById(i+"_sheet_panel")):this.parent.element.appendChild(n)}textAreaFocusIn(){const e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit"});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)}textAreaFocusOut(){const e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),Object(r.J)(e.querySelector(".e-formula-submit"))}keyDownHandler(e){const t=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if((hs(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&16===e.keyCode)return;t.classList.contains("e-formula-bar")&&this.parent.notify(un,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}keyUpHandler(e){if(this.parent.isEdit){const t=e.target;if(t.classList.contains("e-formula-bar")){const i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,i),i.editedValue!==t.value&&16!==e.keyCode&&this.parent.notify(un,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}}nameBoxBeforeOpen(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()}nameBoxBlur(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())}nameBoxSelect(e){if(e.isInteracted){const t=e.itemData.refersTo.substr(1),i=Ls(this.parent,js(t));if(void 0===i)return;let n=qi(t);const s=Fs(this.parent,i);if(-1!==n.indexOf(":")){const e=n.indexOf(":");let t=n.substr(0,e),i=n.substr(e+1,n.length);t=t.replace("$",""),i=i.replace("$",""),i.match(/\D/g)&&!i.match(/[0-9]/g)&&t.match(/\D/g)&&!t.match(/[0-9]/g)?(t+="1",i+=s.rowCount,n=t+":"+i):!i.match(/\D/g)&&i.match(/[0-9]/g)&&!t.match(/\D/g)&&t.match(/[0-9]/g)&&(t=_i(parseInt(t,10)-1,0),i=_i(parseInt(i,10)-1,s.colCount-1),n=t+":"+i)}i===this.parent.activeSheetIndex?(this.parent.selectRange(n),Ur(this.parent.element)):(Ms(this.parent,n,s),this.parent.activeSheetIndex=i)}}formulaBarUpdateHandler(e){const t=this.parent.getActiveSheet().selectedRange.split(":");let i;const n={action:"getElement",element:null};this.parent.notify(un,n);const s=this.parent.element.querySelector(".e-formula-bar"),a=new r.n;if("mousemove"===e.type||"pointermove"===e.type){const r=Ni(t[0]),a=Ni(t[1]);i=`${Math.abs(r[0]-a[0])+1}R x ${Math.abs(r[1]-a[1])+1}C`,this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify("editValue",null):n.element&&(s.value=n.element.textContent))}else i=t[0],this.parent.getData(`${Hs(this.parent)}!${i}`).then(t=>{let o,l="";t.forEach(t=>{const h=t&&t.format?pn(t.format):"General";t&&(Object(r.Z)(t.value)||(o=Ji(Number(t.value)),"Invalid Date"===o.toString()||"ShortDate"!==h&&"LongDate"!==h?"Invalid Date"!==o.toString()&&"Time"===h?(Number(t.value)>=1&&(l=a.formatDate(o,{type:"dateTime",skeleton:"yMd"})+" "),l+=a.formatDate(o,{type:"dateTime",skeleton:"hms"})):l=t.value:l=a.formatDate(o,{type:"date",skeleton:"yMd"})),t.formula&&(l=t.formula));const c={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,c);const d=c.editedValue&&0===c.editedValue.toString().indexOf("=")||hs(c.editedValue),p=document.getElementById(this.parent.element.id+"_formula_input"),g=Ni(i),u=this.parent.getCell(g[0],g[1]);p.value=!t||t.formula||!u||t.validation&&"List"===t.validation.type||"Time"===h&&l?l:u.textContent,Object(r.Z)(l)||d||this.parent.notify(un,{action:"refreshEditor",value:p.value,refreshEditorElem:!0}),this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify("editValue",null):n.element&&(s.value=n.element.textContent))})});this.updateComboBoxValue(i)}UpdateValueAfterMouseUp(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])}updateComboBoxValue(e){const t=this.parent.getActiveSheet(),i={action:"getNameFromRange",range:Hs(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify("formulaOperation",i),i.definedName&&(e=i.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}}disabletextarea(){this.getFormulaBar().disabled=!!this.parent.getActiveSheet().isProtected}formulaBarScrollEdit(){const e=Ni(this.parent.getActiveSheet().selectedRange),t=Bi(this.parent.getActiveSheet().topLeftCell);e[0]<t[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(un,{action:"startEdit",refreshCurPos:!1})}formulaBarClickHandler(e){const t=e.target,i=this.parent.getActiveSheet(),n=i.isProtected,s=Bi(i.activeCell),a=us(Cs(s[0],s[1],i),Js(i,s[1]));if(t.classList.contains("e-drop-icon")&&Object(r.D)(t,".e-formula-bar-panel"))this.toggleFormulaBar(t);else if(t.classList.contains("e-formula-bar"))this.parent.isEdit||n&&(!n||a)?n&&a&&this.parent.notify("editAlert",null):this.formulaBarScrollEdit();else if(t.parentElement&&t.parentElement.classList.contains("e-name-box"))if(t.classList.contains("e-ddl-icon")){const e={action:"getNames",names:[]};this.parent.notify("formulaOperation",e),this.comboBoxInstance.dataSource=e.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!Object(r.Z)(t.offsetParent)&&(t.offsetParent.classList.contains("e-insert-function")||t.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===t.offsetParent.id||this.parent.element.id+"_insert_function"===t.id||t.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===t.parentElement.id)){if(n)return void this.parent.notify("editAlert",null);let e=!this.parent.isEdit;const t={action:"getCurrentEditValue",editedValue:""};if(!e){const i={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify("formulaOperation",i),e=i.isFormulaEdit,this.parent.notify(un,t)}if(e||""===t.editedValue){""===t.editedValue&&this.parent.notify(un,{action:"refreshEditor",value:"="});const e=this.parent.serviceLocator.getService(Da),i=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),n=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:e.getConstant("PickACategory")}),s=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),a=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),o=this.parent.createElement("div",{className:"e-description-content",innerHTML:e.getConstant("Description")}),l=this.parent.createElement("div",{className:"e-header-content",innerHTML:e.getConstant("InsertFunction")}),h={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(an,h),this.categoryCollection=h.categoryCollection,this.categoryList=new c.d({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});const p={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(an,p),this.formulaCollection=p.formulaCollection,this.formulaList=new d.b({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:l.outerHTML,content:n.outerHTML+s.outerHTML+a.outerHTML+o.outerHTML+i.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:e=>{const t={dialogName:"InsertFunctionDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:e.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),r.l.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this)}}}toggleFormulaBar(e){const t=e.parentElement,i=this.parent.serviceLocator.getService(Da);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=i.getConstant("ExpandFormulaBar")):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=i.getConstant("CollapseFormulaBar")),this.parent.setPanelSize()}dialogOpen(){this.focusOkButton()}dialogClose(){const e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,e),"="===e.editedValue.toString().trim()&&this.parent.notify(un,{action:"refreshEditor",value:""})}dialogBeforeClose(){r.l.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);const e=document.getElementById("_dialog-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")}selectFormula(e,t){const i=t.formulaList.getSelectedItems().text,n=Fs(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(un,{action:"refreshEditor",value:i+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(un,{action:"startEdit",value:"="+i+"(",address:n.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+i+"("})),e.hide()}listSelected(){this.updateFormulaDescription()}updateFormulaList(){this.activeListFormula(),this.updateFormulaDescription()}dropDownSelect(e){this.formulaCollection=[];const t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(an,t),this.formulaCollection=t.formulaCollection;else{const t={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(an,t),this.formulaCollection=t.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()}focusOkButton(){document.getElementById("_dialog-content").nextElementSibling.firstElementChild.focus()}activeListFormula(){const e=document.getElementById(this.parent.element.id+"_formula_list");this.formulaList.selectItem(e.children[0].children[0].firstElementChild)}updateFormulaDescription(){let e=this.formulaList.getSelectedItems().text;this.parent.notify(an,{action:"getFormulaDescription",description:"",selectedList:e}),this.focusOkButton(),e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,document.getElementById(this.parent.element.id+"_description_content").innerHTML=this.parent.serviceLocator.getService(Da).getConstant(e)}formulaClickHandler(e){const t=e.target,i=Fs(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(un,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(un,{action:"startEdit",value:"="+t.innerText+"(",address:i.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())}addEventListener(){this.parent.on("formulaBar",this.createFormulaBar,this),this.parent.on("click",this.formulaBarClickHandler,this),this.parent.on(fn,this.keyDownHandler,this),this.parent.on(mn,this.keyUpHandler,this),this.parent.on("selectionComplete",this.formulaBarUpdateHandler,this),this.parent.on("mouseUpAfterSelection",this.UpdateValueAfterMouseUp,this),this.parent.on("formulaBarOperation",this.editOperationHandler,this),this.parent.on("enableFormulaInput",this.disabletextarea,this),this.parent.on("isFormulaBarEdit",this.isFormulaBarEdit,this)}destroy(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;const e=this.parent.element.querySelector(".e-formula-bar-panel");e&&Object(r.J)(e)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("formulaBar",this.createFormulaBar),this.parent.off("click",this.formulaBarClickHandler),this.parent.off(fn,this.keyDownHandler),this.parent.off(mn,this.keyUpHandler),this.parent.off("selectionComplete",this.formulaBarUpdateHandler),this.parent.off("mouseUpAfterSelection",this.UpdateValueAfterMouseUp),this.parent.off("formulaBarOperation",this.editOperationHandler),this.parent.off("enableFormulaInput",this.disabletextarea),this.parent.off("isFormulaBarEdit",this.isFormulaBarEdit))}editOperationHandler(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=Object(r.cb)(e.value)?"":e.value;break;case"getElement":e.element=this.getFormulaBar()}}isFormulaBarEdit(e){e.isEdit=!(!this.parent.isEdit||!this.isGoto)}getFormulaBar(){return Object(r.ob)("#"+this.parent.element.id+"_formula_input",this.parent.element)}}class xa{constructor(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},this.parent=e,this.addEventListener()}getModuleName(){return"formula"}destroy(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null}addEventListener(){this.parent.on("formulaOperation",this.performFormulaOperation,this),this.parent.on(mn,this.keyUpHandler,this),this.parent.on(fn,this.keyDownHandler,this),this.parent.on("click",this.formulaClick,this),this.parent.on("refreshFormulaDatasource",this.refreshFormulaDatasource,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("formulaOperation",this.performFormulaOperation),this.parent.off(mn,this.keyUpHandler),this.parent.off(fn,this.keyDownHandler),this.parent.off("click",this.formulaClick),this.parent.off("refreshFormulaDatasource",this.refreshFormulaDatasource))}performFormulaOperation(e){const t=e.action,i=this.parent.serviceLocator.getService(Da);let n;switch(t){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=Hs(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":n=this.parent.serviceLocator.getService(Ma),n.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:i.getConstant("CircularReference"),beforeOpen:e=>{const t={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}}),e.argValue="0"}}renderAutoComplete(){if(!Object(r.ob)("#"+this.parent.element.id+"_ac",this.parent.element)){const e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);const t={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(an,t);const i={dataSource:t.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new c.a(i,e),this.autocompleteInstance.createElement=this.parent.createElement}}onSuggestionOpen(e){this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise((e,t)=>{setTimeout(()=>{e()},100)}).then(()=>{this.triggerKeyDownEvent(this.keyCodes.DOWN)})}onSuggestionClose(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1}onSelect(e){let t="="+e.itemData.value+"(";if(this.isSubFormula){const i=this.getEditingValue();let n=i.lastIndexOf(this.getArgumentSeparator());n>-1?t=i.slice(0,n+1):(n=i.lastIndexOf("("),n>-1&&(t=i.slice(0,n+1))),t+=e.itemData.value+"("}if(this.parent.notify(un,{action:"refreshEditor",value:t,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();const e=Object(r.ob)("#"+this.parent.element.id+"_ac_popup");e&&Object(r.J)(e),this.isPopupOpened=!1}}onSuggestionComplete(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())}refreshFormulaDatasource(){const e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(an,e),this.autocompleteInstance.dataSource=e.formulaCollection}keyUpHandler(e){if(this.parent.isEdit){let t=this.getEditingValue();this.isFormula=hs(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==this.keyCodes.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()}keyDownHandler(e){const t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case this.keyCodes.UP:case this.keyCodes.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case this.keyCodes.TAB:e.preventDefault(),this.triggerKeyDownEvent(this.keyCodes.ENTER)}}else{const i=e.target;if(i.id===this.parent.element.id+"_name_box")switch(t){case this.keyCodes.ENTER:this.addDefinedName({name:i.value}),Ur(this.parent.element);break;case this.keyCodes.ESC:Ur(this.parent.element)}}}formulaClick(e){this.parent.isEdit&&(this.isFormulaBar=e.target.classList.contains("e-formula-bar"))}refreshFormulaSuggestion(e,t){if(t.length>0){const i=this.autocompleteInstance.element,n=this.isPopupOpened;this.isNavigationKey(e.keyCode)||(i.value=t,i.dispatchEvent(new Event("input")),i.dispatchEvent(new Event("keyup")),n&&this.triggerKeyDownEvent(this.keyCodes.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())}endEdit(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();const e=Object(r.ob)("#"+this.parent.element.id+"_ac_popup");e&&Object(r.J)(e),this.isPopupOpened=!1}}hidePopUp(){this.autocompleteInstance.hidePopup()}getSuggestionKeyFromFormula(e){let t="";if(e=e.substr(1)){const i=e.lastIndexOf("("),n=(e=e.substr(i+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=i>-1):(t=n[n.length-1],this.isSubFormula=!0);const s=t.match(/\w/);(!s||s&&0!==s.index)&&(t="")}return t}getRelateToElem(){const e={action:"getElement"};return this.parent.notify(this.isFormulaBar?"formulaBarOperation":un,e),e.element}getEditingValue(){const e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(un,e),e.editedValue}isNavigationKey(e){return e===this.keyCodes.UP||e===this.keyCodes.DOWN||e===this.keyCodes.LEFT||e===this.keyCodes.RIGHT}triggerKeyDownEvent(e){const t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));const i=new Event("keydown");i.keyCode=e,i.which=e,i.altKey=!1,i.shiftKey=!1,i.ctrlKey=!1,t.dispatchEvent(i)}getArgumentSeparator(){if(this.argumentSeparator)return this.argumentSeparator;{const e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(an,e),this.argumentSeparator=e.argumentSeparator,e.argumentSeparator}}getNames(e){return this.parent.definedNames.filter(t=>"Workbook"===t.scope||""===t.scope||t.scope===e)}getNameFromRange(e){const t=e.slice(0,e.indexOf(":")),i=e.slice(e.indexOf("!")+1).split(":"),n=i.length>1&&i[0]===i[1],s=this.parent.definedNames.filter(i=>!(!n||i.refersTo!=="="+t)||i.refersTo==="="+e);return s&&s[0]}addDefinedName(e){const t=e.name;let i=!1;if(t&&cs(t.toUpperCase()))return this.parent.goTo(t),i;if(!e.refersTo){const t=Fs(this.parent,this.parent.activeSheetIndex);let i=Hs(this.parent);i=-1!==i.indexOf(" ")?"'"+i+"'":i;let n=t.selectedRange;if(!Object(r.Z)(n)){const e=n.indexOf(":");let i=n.substr(0,e),s=n.substr(e+1,n.length);parseInt(s.replace(/\D/g,""),10)===t.rowCount&&1===parseInt(i.replace(/\D/g,""),10)?(s=s.replace(/[0-9]/g,""),i=i.replace(/[0-9]/g,""),n="$"+i+":$"+s):Bi(s)[1]===t.colCount-1&&0===Bi(i)[1]?(s=s.replace(/\D/g,""),i=i.replace(/\D/g,""),n="$"+i+":$"+s):n=i===s?i:n}e.refersTo=i+"!"+n,e.scope="Workbook"}if(t.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(t)){const t={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(an,t),i=t.isAdded,t.isAdded||this.parent.serviceLocator.getService(Ma).show({content:this.parent.serviceLocator.getService(Da).getConstant("DefineNameExists"),width:"300",beforeOpen:e=>{const t={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(Ma).show({content:this.parent.serviceLocator.getService(Da).getConstant("DefineNameInValid"),width:"300",beforeOpen:e=>{const t={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}});return i}}class Ca{constructor(e){this.aggregateContent="",this.isSelectCancel=!1,this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}getModuleName(){return"sheetTabs"}createSheetTabs(){if(!this.parent.showSheetTabs&&this.tabInstance)return void this.destroy();const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),i=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:e.getConstant("AddSheet")}});i.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),i.addEventListener("click",this.addSheetTab.bind(this)),i.disabled=!this.parent.allowInsert,t.appendChild(i),this.addBtnRipple=Object(r.nb)(t,{selector:".e-add-sheet-tab"});const n=this.parent.createElement("button",{attrs:{title:e.getConstant("ListAllSheets")}});t.appendChild(n),this.parent.element.appendChild(t);const s=this.getSheetTabItems();this.dropDownInstance=new p.b({iconCss:"e-icons",items:s.ddbItems,beforeItemRender:e=>{const t=this.parent.sheets[this.dropDownInstance.items.indexOf(e.item)];"Hidden"===t.state?e.element.classList.add("e-hide"):"VeryHidden"===t.state&&(e.element.style.display="none")},select:e=>this.updateSheetTab({idx:this.dropDownInstance.items.indexOf(e.item)}),beforeOpen:e=>this.beforeOpenHandler(this.dropDownInstance,e.element),open:e=>this.openHandler(this.dropDownInstance,e.element,"left"),cssClass:"e-sheets-list e-flat e-caret-hide",close:()=>Ur(this.parent.element)}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(n);const a=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new o.g({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:s.tabItems,scrollStep:250,selecting:e=>{const t={currentSheetIndex:e.selectingIndex,previousSheetIndex:e.selectedIndex,cancel:!1};this.isSelectCancel||this.parent.notify(vn,{eventArgs:t,action:"gotoSheet"}),this.isSelectCancel=t.cancel},selected:e=>{if(e.selectedIndex!==e.previousIndex){if(this.parent.notify("removeDesignChart",{}),this.parent.isEdit){const e=window.getSelection(),t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(un,t);let i=!!t.editedValue&&hs(t.editedValue,!0);!i&&e&&e.focusNode&&e.focusNode.classList&&e.focusNode.classList.contains("e-formula-bar-panel")&&(i=hs(this.parent.element.querySelector(".e-formula-bar").value,!0)),i||this.parent.endEdit()}if(this.isSelectCancel)this.tabInstance.selectedItem=e.previousIndex,this.tabInstance.dataBind(),Ur(this.parent.element);else{this.parent.activeSheetIndex=e.selectedIndex,this.parent.dataBind(),this.updateDropDownItems(e.selectedIndex,e.previousIndex),Ur(this.parent.element),this.parent.notify(Cn,{eventArgs:{previousSheetIndex:e.previousIndex,currentSheetIndex:e.selectedIndex},action:"gotoSheet"});const t={action:"registerGridInCalc",sheetID:(e.selectedIndex+1).toString()};this.parent.notify(an,t)}}},created:()=>{const e=this.tabInstance.element.querySelector(".e-toolbar-items");e.classList.add("e-sheet-tabs-items"),r.l.add(e,"dblclick",this.renameSheetTab,this)}}),t.appendChild(a),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(a),r.l.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);const l=s.tabItems.length;for(let r=0;r<l;r++){const e=Hs(this.parent,r);this.parent.notify(an,{action:"addSheet",sheetName:"Sheet"+(r+1),index:r+1,visibleName:e})}this.parent.notify(an,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)}updateDropDownItems(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)}beforeOpenHandler(e,t){const i=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>i&&(t.style.height=`${i}px`,t.style.overflowY="auto"),t.parentElement.style.visibility="hidden"}openHandler(e,t,i){const n=t.parentElement;let s;if(-1===Object(g.k)(n).indexOf("bottom")){s="auto"===t.style.overflowY?this.parent.viewport.height:n.getBoundingClientRect().height;const r=Object(g.d)(e.element,i,"top");"right"===i&&(r.left-=n.getBoundingClientRect().width),n.style.left=`${r.left}px`,n.style.top=r.top-s+"px"}n.style.visibility=""}getSheetTabItems(){const e=[],t=[];let i;return this.parent.sheets.forEach((n,s)=>{i=Hs(this.parent,s),e.push({header:{text:i},visible:"Visible"===n.state}),t.push({text:i,iconCss:s===this.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:e,ddbItems:t}}refreshSheetTab(){const e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()}addSheetTab(){this.parent.notify(un,{action:"getCurrentEditValue",editedValue:""}),this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),Ur(this.parent.element)}insertSheetTab(e){this.parent.notify("removeDesignChart",{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(let t=e.startIdx;t<=e.endIdx;t++){const e=this.parent.sheets[t].name;this.dropDownInstance.items.splice(t,0,{text:e}),this.tabInstance.addTab([{header:{text:e},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx})}updateSheetTab(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.parent.setSheetPropertyOnMute(this.parent.sheets[e.idx],"state","Visible"),this.tabInstance.hideTab(e.idx,!1)}this.tabInstance.selectedItem=e.idx,this.tabInstance.dataBind(),this.parent.notify("protectSheet",null)}switchSheetTab(e){const t=Object(r.D)(e.event.target,".e-toolbar-item");if(!t)return;const i=t.querySelector(".e-tab-text").textContent;for(let n=0,s=this.tabInstance.items.length;n<s;n++)if(this.tabInstance.items[n].header.text===i){this.parent.activeSheetIndex!==n&&this.updateSheetTab({idx:n});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===`${this.parent.element.id}_cmenu_insert_sheet`&&(1===this.skipHiddenSheets()&&(e.element.children[1].classList.add("e-disabled"),e.element.children[4].classList.add("e-disabled")),this.parent.allowInsert||e.element.children[0].classList.add("e-disabled"),this.parent.allowDelete||e.element.children[1].classList.add("e-disabled")),(this.parent.password.length>0||this.parent.isProtected)&&(e.element.children[0].classList.add("e-disabled"),e.element.children[1].classList.add("e-disabled"),e.element.children[2].classList.add("e-disabled"),e.element.children[3].classList.add("e-disabled"))}skipHiddenSheets(){let e=this.parent.sheets.length;return this.parent.sheets.forEach(t=>{"Visible"!==t.state&&--e}),e}renameSheetTab(){let e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){e=e.querySelector(".e-text-wrap");const t=e.querySelector(".e-tab-text").textContent,i={eventArgs:{name:t,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",i),i.cancel)return;const n=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:`width: ${e.getBoundingClientRect().width}px`,attrs:{type:"text",name:"Rename",required:"",value:t,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(n),r.l.add(document,"mousedown touchstart",this.renameInputFocusOut,this),r.l.add(n,"input",this.updateWidth,this),n.focus(),n.setSelectionRange(0,t.length),r.l.remove(Object(r.D)(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}}updateWidth(e){const t=e.target;let i=t.value.length;const n=t.value.split(" ");if(n.length){const e=n.length-1;i-=e,i+=.5*e}t.style.width=`${i}ch`}renameInputFocusOut(e){let t=e.target;if(("mousedown"===e.type||"touchstart"===e.type)&&(t.classList.contains("e-sheet-rename")||Object(r.D)(t,".e-dlg-container")))return;if(t=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(t),void Ur(this.parent.element);const i=t.value,n=this.parent.serviceLocator.getService(Da);if(i){const s=this.tabInstance.selectedItem;if(i.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(t,n.getConstant("SheetRenameInvalidAlert"));else{if(this.tabInstance.items[s].header.text!==i)for(let e=0,s=this.parent.sheets.length;e<s;e++)if(e!==this.parent.activeSheetIndex&&this.parent.sheets[e].name.toLowerCase()===i.toLowerCase())return void this.showRenameDialog(t,n.getConstant("SheetRenameAlreadyExistsAlert"));const a=this.removeRenameInput(t);this.tabInstance.items[s].header.text!==i&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[s],"name",i),this.updateSheetName({value:i,idx:s,items:a})),("keydown"===e.type||Object(r.D)(e.target,".e-spreadsheet"))&&Ur(this.parent.element)}}else this.showRenameDialog(t,n.getConstant("SheetRenameEmptyAlert"));const s=this.parent.getActiveSheet().id;this.parent.notify(an,{action:"renameUpdation",value:i,sheetId:s}),this.parent.notify(Cn,{eventArgs:{index:s,value:i},action:"renameSheet"})}updateSheetName(e){this.tabInstance.items[e.idx].header.text=e.value,this.dropDownInstance.items[e.idx].text=e.value,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.value.indexOf("  ")>-1?(this.tabInstance.setProperties({items:this.tabInstance.items},!0),e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=e.value):(e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=e.value,this.tabInstance.dataBind())}hideSheet(){this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"state","Hidden"),this.tabInstance.hideTab(this.parent.activeSheetIndex)}removeRenameInput(e){const t=e.parentElement.querySelector(".e-tab-text"),i=Object(r.D)(e,".e-toolbar-items");return r.l.add(i,"dblclick",this.renameSheetTab,this),r.l.remove(document,"mousedown touchstart",this.renameInputFocusOut),r.l.remove(e,"input",this.updateWidth),Object(r.kb)(e),t.style.display="",i}showRenameDialog(e,t){this.parent.serviceLocator.getService(Ma).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:t=>{const i={dialogName:"SheetRenameDialog",element:t.element,target:t.target,cancel:t.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0),e.focus()},close:()=>e.setSelectionRange(0,e.value.length)})}focusRenameInput(){const e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()}removeSheetTab(e){if(e.count&&e.count===this.parent.sheets.length)return;const t=this.parent.serviceLocator.getService(Da);if(this.skipHiddenSheets()>1){const i=e.sheetName?Fs(this.parent,Ls(this.parent,e.sheetName)):this.parent.getActiveSheet(),n=e.index||Ls(this.parent,i.name),s={index:n,sheetCount:this.parent.sheets.length,sheetName:i.name};if(i.rows&&i.rows.length&&(1!==i.rows.length||i.rows[0].cells&&i.rows[0].cells.length)){const i=this.parent.serviceLocator.getService(Ma);e.clicked?this.forceDelete(n):i.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:t.getConstant("DeleteSheetAlert"),beforeOpen:e=>{const t={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:()=>{i.hide(),this.forceDelete(n),this.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(s.sheetCount=this.parent.sheets.length,this.parent.notify(Cn,{eventArgs:s,action:"removeSheet"}))}}]})}else this.parent.notify(an,{action:"deleteSheetTab",sheetName:"",index:n+1}),this.destroySheet(n),this.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(s.sheetCount=this.parent.sheets.length,this.parent.notify(Cn,{eventArgs:s,action:"removeSheet"}))}else this.parent.serviceLocator.getService(Ma).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:e=>{const t={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),Ur(this.parent.element)}})}forceDelete(e){const t={action:"deleteSheetTab",sheetName:"",index:e+1};this.parent.notify("removeDesignChart",{}),this.parent.notify(an,t),this.destroySheet(e)}destroySheet(e){const t=e||this.parent.activeSheetIndex;this.parent.removeSheet(t),this.parent.notify("sheetsDestroyed",{sheetIndex:t}),this.dropDownInstance.items.splice(t,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(t);const i=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=i,this.parent.setProperties({activeSheetIndex:i},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=i,this.tabInstance.dataBind(),this.updateDropDownItems(i),this.parent.notify("protectSheet",null),Ur(this.parent.element)}showAggregate(){if(Gi(Ni(this.parent.getActiveSheet().selectedRange)))return;const e={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify("aggregateComputation",e),e.Count>1){this.aggregateContent=e.countOnly?"Count":this.selaggregateCnt,e.countOnly&&(this.aggregateContent="Count",delete e.Sum,delete e.Avg,delete e.Min,delete e.Max);const t=e.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete e.countOnly;const i=this.aggregateContent,n=`${i}: ${e[i]}`;if(this.aggregateDropDown)this.updateAggregateContent(n,e);else{const i=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate"});document.getElementById(`${this.parent.element.id}_sheet_tab_panel`).appendChild(i),this.aggregateDropDown=new p.b({content:n,items:this.getAggregateItems(e),select:t=>{this.parent.notify("aggregateComputation",e),this.updateAggregateContent(t.item.text,{Count:e.Count,Sum:e.Sum,Avg:e.Avg,Min:e.Min,Max:e.Max},!0)},beforeOpen:e=>this.beforeOpenHandler(this.aggregateDropDown,e.element),open:e=>this.openHandler(this.aggregateDropDown,e.element,"right"),close:()=>Ur(this.parent.element),cssClass:t}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(i)}}else this.removeAggregate()}getAggregateItems(e){const t=[];let i,n;return Object.keys(e).forEach(s=>{"aggregateComputation"!==e[s]&&(i=`${s}: ${e[s]}`,n=s===this.aggregateContent?"e-selected-icon e-icons":"",t.push({text:i,iconCss:n}))}),t}updateAggregateContent(e,t,i){this.aggregateContent=e.split(": ")[0],i&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)}removeAggregate(){Object(r.Z)(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),Object(r.kb)(this.aggregateDropDown.element),this.aggregateDropDown=null)}addEventListener(){this.parent.on("sheetTabs",this.createSheetTabs,this),this.parent.on("refreshSheetTabs",this.refreshSheetTab,this),this.parent.on("insertSheetTab",this.insertSheetTab,this),this.parent.on("removeSheetTab",this.removeSheetTab,this),this.parent.on("renameSheetTab",this.renameSheetTab,this),this.parent.on(bn,this.switchSheetTab,this),this.parent.on("activeSheetChanged",this.updateSheetTab,this),this.parent.on("renameSheet",this.renameInputFocusOut,this),this.parent.on("activeCellChanged",this.removeAggregate,this),this.parent.on("verticalScroll",this.focusRenameInput,this),this.parent.on("horizontalScroll",this.focusRenameInput,this),this.parent.on("sheetNameUpdate",this.updateSheetName,this),this.parent.on("hideSheet",this.hideSheet,this),this.parent.on("showAggregate",this.showAggregate,this)}destroy(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,r.l.remove(document,"mousedown touchstart",this.renameInputFocusOut);const e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&Object(r.kb)(e),this.parent=null}removeEventListener(){this.parent.isDestroyed||(this.parent.off("sheetTabs",this.createSheetTabs),this.parent.off("refreshSheetTabs",this.refreshSheetTab),this.parent.off("insertSheetTab",this.insertSheetTab),this.parent.off("removeSheetTab",this.removeSheetTab),this.parent.off("renameSheetTab",this.renameSheetTab),this.parent.off(bn,this.switchSheetTab),this.parent.off("activeSheetChanged",this.updateSheetTab),this.parent.off("renameSheet",this.renameInputFocusOut),this.parent.off("activeCellChanged",this.removeAggregate),this.parent.off("verticalScroll",this.focusRenameInput),this.parent.off("horizontalScroll",this.focusRenameInput),this.parent.off("sheetNameUpdate",this.updateSheetName),this.parent.off("hideSheet",this.hideSheet),this.parent.off("showAggregate",this.showAggregate))}}class va{constructor(e){this.parent=e,this.addEventListener(),this.renderFileUpload()}addEventListener(){this.parent.on("openSuccess",this.openSuccess,this),this.parent.on("openFailure",this.openFailed,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("openSuccess",this.openSuccess),this.parent.off("openFailure",this.openFailed))}renderFileUpload(){const e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm",name:"fileUpload"}}));const t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"}fileSelect(e){const t=e.target.files[0];t&&t.length<1||(this.parent.open({file:t}),document.getElementById(this.parent.element.id+"_fileUpload").value="")}openSuccess(e){const t=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword"];if(t.indexOf(e.data)>-1)if(t[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify("importProtectWorkbook",e.eventArgs);else{if(t[3]!==e.data)return this.parent.serviceLocator.getService(Ma).hide(),this.parent.serviceLocator.getService(Ma).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",beforeOpen:e=>{const t={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}}),void this.parent.hideSpinner();{const e=this.parent.serviceLocator.getService(Da),t=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span",innerHTML:e.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(t)}}else this.parent.serviceLocator.getService(Ma).hide(),this.parent.showSpinner();this.parent.element&&(this.parent.trigger("openComplete",{response:e}),this.parent.notify(Cn,{response:e,action:"import"}),this.parent.renderModule.refreshSheet(!0),this.parent.notify("refreshSheetTabs",this),this.parent.hideSpinner())}openFailed(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"open"}}class Sa{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("beginSave",this.initiateSave,this),this.parent.on("saveCompleted",this.saveCompleted,this),this.parent.on("saveError",this.showErrorDialog,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("beginSave",this.initiateSave),this.parent.off("saveCompleted",this.saveCompleted),this.parent.off("saveError",this.showErrorDialog))}getModuleName(){return"save"}initiateSave(){this.parent.showSpinner()}saveCompleted(){this.parent.hideSpinner()}showErrorDialog(e){this.parent.serviceLocator.getService(Ma).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:()=>Ur(this.parent.element)})}}class wa{constructor(e){this.parent=e,this.init()}init(){this.initContextMenu(),this.addEventListener()}initContextMenu(){const e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new o.b({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this)},e)}beforeCloseHandler(e){this.parent.trigger("contextMenuBeforeClose",e)}selectHandler(e){const t=Object(r.L)({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",t);const i=this.parent.element.id+"_cmenu";let n,s,a;if(!t.cancel){let t;switch(e.item.id){case i+"_cut":this.parent.notify("cut",{isAction:!0,promise:Promise});break;case i+"_copy":this.parent.notify("copy",{isAction:!0,promise:Promise});break;case i+"_paste":this.parent.notify(yn,{isAction:!0,isInternal:!0});break;case i+"_pastevalues":this.parent.notify(yn,{type:"Values",isAction:!0,isInternal:!0});break;case i+"_pasteformats":this.parent.notify(yn,{type:"Formats",isAction:!0,isInternal:!0});break;case i+"_rename":this.parent.notify("renameSheetTab",{});break;case i+"_delete_sheet":this.parent.notify("removeSheetTab",{});break;case i+"_insert_sheet":this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0});break;case i+"_hide_sheet":this.parent.notify("hideSheet",null);break;case i+"_duplicate":zs(this.parent,void 0,!0);break;case i+"_move_right":_s(this.parent,this.parent.activeSheetIndex+1,null,!0);break;case i+"_move_left":_s(this.parent,this.parent.activeSheetIndex-1,null,!0);break;case i+"_ascending":this.parent.notify("applySort",null);break;case i+"_descending":this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case i+"_customsort":this.parent.notify("initiateCustomSort",null);break;case i+"_filtercellvalue":this.parent.notify("filterByCellValue",null);break;case i+"_clearfilter":n=Vi(Bi(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify("clearFilter",{field:n});break;case i+"_reapplyfilter":this.parent.notify("reapplyFilter",null);break;case i+"_hide_row":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:t[0],endIndex:t[2],hide:!0,isCol:!1,actionUpdate:!0}),Ur(this.parent.element);break;case i+"_unhide_row":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:t[0],endIndex:t[2],hide:!1,isCol:!1,actionUpdate:!0}),Ur(this.parent.element);break;case i+"_hide_column":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:t[1],endIndex:t[3],hide:!0,isCol:!0,actionUpdate:!0}),Ur(this.parent.element);break;case i+"_unhide_column":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:t[1],endIndex:t[3],hide:!1,isCol:!0,actionUpdate:!0}),Ur(this.parent.element);break;case i+"_insert_row_above":case i+"_delete_row":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify(`${e.item.id.substr(i.length+1,6)}Model`,{model:this.parent.getActiveSheet(),start:t[0],end:t[2],modelType:"Row",isAction:!0,insertType:"above"}),Ur(this.parent.element);break;case i+"_insert_row_below":t=Wi(Ni(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:t[2]+1,end:t[2]+1+(t[2]-t[0]),modelType:"Row",isAction:!0,insertType:"below"}),Ur(this.parent.element);break;case i+"_insert_column_before":case i+"_delete_column":t=Ni(this.parent.getActiveSheet().selectedRange),this.parent.notify(`${e.item.id.substr(i.length+1,6)}Model`,{model:this.parent.getActiveSheet(),start:t[1],end:t[3],modelType:"Column",isAction:!0}),Ur(this.parent.element);break;case i+"_insert_column_after":t=Wi(Ni(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:t[3]+1,end:t[3]+1+(t[3]-t[1]),modelType:"Column",isAction:!0}),Ur(this.parent.element);break;case i+"_hyperlink":this.parent.notify("initiateHyperlink",null);break;case i+"_editHyperlink":this.parent.notify("editHyperlink",null);break;case i+"_openHyperlink":this.parent.notify("openHyperlink",null);break;case i+"_removeHyperlink":this.parent.removeHyperlink(this.parent.getActiveSheet().selectedRange);break;case i+"_protect":s=this.parent.getActiveSheet(),this.parent.setSheetPropertyOnMute(s,"isProtected",!s.isProtected),a=!s.isProtected,this.parent.notify("applyProtect",{isActive:a})}}}getInsertModel(e,t){const i=[];for(let n=e;n<=t;n++)i.push(n===e?{index:n}:{});return i}beforeOpenHandler(e){const t=e.event.target;let i,n=this.getTarget(t);if(e.element.classList.contains("e-contextmenu")){const s=this.parent.getActiveSheet();if(e.event.target&&(t.classList.contains("e-rowresize")||t.classList.contains("e-colresize"))){const r=Ni(s.selectedRange);if(!(t.classList.contains("e-rowresize")?0===r[1]&&r[3]===s.colCount-1:0===r[0]&&r[2]===s.rowCount-1))return void(e.cancel=!0);i=(t.classList.contains("e-rowresize")?this.parent.hiddenCount(r[0],r[2])!==Math.abs(r[2]-r[0])+1:this.parent.hiddenCount(r[1],r[3],"columns")!==Math.abs(r[3]-r[1])+1)?this.getDataSource(n):this.getDataSource(n,t)}else{if("Content"===n){const e=Ni(s.selectedRange),t=0===e[1]&&e[3]===s.colCount-1,i=0===e[0]&&e[2]===s.rowCount-1;n=t&&i?"SelectAll":t?"RowHeader":i?"ColumnHeader":"Content"}i=this.getDataSource(n)}this.contextMenuInstance.items=i,this.contextMenuInstance.dataBind()}else i=e.items;if("ColumnHeader"===n||"RowHeader"===n){if(e.element&&e.element.childElementCount>0){const t=e.element.querySelector("ColumnHeader"===n?"#"+this.parent.element.id+"_cmenu_insert_column":"#"+this.parent.element.id+"_cmenu_insert_row"),i=e.element.querySelector("ColumnHeader"===n?"#"+this.parent.element.id+"_cmenu_delete_column":"#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&t.classList.contains("e-disabled")?t.classList.remove("e-disabled"):this.parent.allowInsert||t.classList.contains("e-disabled")||t.classList.add("e-disabled"),this.parent.allowDelete&&i.classList.contains("e-disabled")?i.classList.remove("e-disabled"):this.parent.allowDelete||i.classList.contains("e-disabled")||i.classList.add("e-disabled")}}else if("Footer"===n){const i=Ls(this.parent,t.textContent);0===i&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),i===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(bn,Object(r.L)(e,{target:n,items:i}))}getTarget(e){return Object(r.D)(e,".e-sheet-content")?"Content":Object(r.D)(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":Object(r.D)(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":Object(r.D)(e,".e-sheet-tabs-items")?"Footer":Object(r.D)(e,".e-selectall-container")?e.classList.contains("e-header-cell")?Object(r.D)(e,".e-header-row")?"ColumnHeader":"RowHeader":Object(r.D)(e,".e-select-all-cell")?"SelectAll":"Content":""}getDataSource(e,t){const i=this.parent.serviceLocator.getService(Da),n=[],s=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,i,s),n.push({separator:!0}),this.setFilterItems(n,s),this.setSortItems(n,s),n.push({separator:!0}),this.setHyperLink(n,s);else if("RowHeader"===e){this.setClipboardData(n,i,s);const e=this.parent.getActiveSheet(),r=Ni(e.selectedRange);this.setInsertDeleteItems(n,i,"Row",s,[r[0],r[2]],["Above","Below"]),e.frozenRows||e.frozenColumns||t&&t.parentElement&&t.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(n,i,"Row",s,[r[0],r[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,i,s);const e=this.parent.getActiveSheet(),r=Ni(e.selectedRange);this.setInsertDeleteItems(n,i,"Column",s,[r[1],r[3]],["Before","After"]),e.frozenRows||e.frozenColumns||t&&t.classList.value.includes("e-hide")||this.setHideShowItems(n,i,"Column",s,[r[1],r[3]])}else"SelectAll"===e?(this.setClipboardData(n,i,s),this.setFilterItems(n,s),this.setSortItems(n,s)):"Footer"===e&&(n.push({text:i.getConstant("Insert"),id:s+"_insert_sheet"}),n.push({text:i.getConstant("Delete"),iconCss:"e-icons e-delete",id:s+"_delete_sheet"}),n.push({text:i.getConstant("DuplicateSheet"),id:s+"_duplicate"}),n.push({text:i.getConstant("Rename"),id:s+"_rename"}),n.push({text:i.getConstant("Hide"),id:s+"_hide_sheet"}),this.setProtectSheetItems(n,s),n.push({text:i.getConstant("MoveRight"),id:s+"_move_right"}),n.push({text:i.getConstant("MoveLeft"),id:s+"_move_left"}));return n}setProtectSheetItems(e,t){const i=this.parent.serviceLocator.getService(Da);this.parent.getActiveSheet().isProtected?e.push({text:i.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:i.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})}setFilterItems(e,t){if(this.parent.allowFiltering){const i=this.parent.serviceLocator.getService(Da),n={clearFilterText:null,isFiltered:!1};this.parent.notify("getFilteredColumn",n),e.push({text:i.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:i.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:i.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}}setSortItems(e,t){const i=this.parent.serviceLocator.getService(Da);this.parent.allowSorting&&e.push({text:i.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:i.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:i.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:i.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})}setHyperLink(e,t){const i=this.parent.getActiveSheet();if(this.parent.allowHyperlink){const n=this.parent.serviceLocator.getService(Da);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||i.isProtected&&!i.protectSettings.insertLink?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:t+"_hyperlink"}):e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:t+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:t+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:t+"_removeHyperlink"})}}setClipboardData(e,t,i){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:i+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:i+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:i+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:i+"_pastespecial",items:[{text:t.getConstant("Values"),id:i+"_pastevalues"},{text:t.getConstant("Formats"),id:i+"_pasteformats"}]}))}setInsertDeleteItems(e,t,i,n,s,r){e.push({separator:!0}),["Insert","Delete"].forEach(a=>{e.push(s[0]===s[1]?{text:t.getConstant(`${a}${i}`),id:n+`_${a.toLowerCase()}_${i.toLowerCase()}`}:{text:t.getConstant(`${a}${i}s`),id:n+`_${a.toLowerCase()}_${i.toLowerCase()}`}),"Insert"===a&&(e[e.length-1].items=[],r.forEach(i=>{e[e.length-1].items.push({text:t.getConstant(i),id:`${e[e.length-1].id}_${i.toLowerCase()}`})}))})}setHideShowItems(e,t,i,n,s){if(s[0]===s[1])e.push({text:t.getConstant(`Hide${i}`),id:n+`_hide_${i.toLowerCase()}`});else{const r=s[0];s[0]=s[0]>s[1]?s[1]:s[0],s[1]=s[1]>r?s[1]:r,e.push({text:t.getConstant(`Hide${i}s`),id:n+`_hide_${i.toLowerCase()}`})}this.parent.hiddenCount(s[0],s[1],`${i.toLowerCase()}s`)&&e.push({text:t.getConstant(`UnHide${i}s`),id:n+`_unhide_${i.toLowerCase()}`})}addEventListener(){this.parent.on("addContextMenuItems",this.addItemsHandler,this),this.parent.on("removeContextMenuItems",this.removeItemsHandler,this),this.parent.on("enableContextMenuItems",this.enableItemsHandler,this)}addItemsHandler(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)}removeItemsHandler(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)}enableItemsHandler(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("addContextMenuItems",this.addItemsHandler),this.parent.off("removeContextMenuItems",this.removeItemsHandler),this.parent.off("enableContextMenuItems",this.enableItemsHandler))}getModuleName(){return"contextMenu"}destroy(){this.removeEventListener(),this.contextMenuInstance.destroy();const e=document.getElementById(this.parent.element.id+"_contextmenu");e&&Object(r.J)(e),this.parent=null}}class Ia{constructor(e){this.parent=e,this.addEventListener()}refreshCellElement(e){const t=this.parent.getCell(e.rowIndex,e.colIndex);Object(r.Z)(t)||this.parent.refreshNode(t,e)}addEventListener(){this.parent.on("refreshCellElem",this.refreshCellElement,this)}removeEventListener(){this.parent.isDestroyed||this.parent.off("refreshCellElem",this.refreshCellElement)}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"numberFormat"}}class Oa{constructor(e){this.parent=e,this.addEventListener()}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("applySort",this.applySortHandler,this),this.parent.on("sortComplete",this.sortCompleteHandler,this),this.parent.on("initiateCustomSort",this.initiateCustomSortHandler,this),this.parent.on("sortImport",this.sortImport,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("applySort",this.applySortHandler),this.parent.off("sortComplete",this.sortCompleteHandler),this.parent.off("initiateCustomSort",this.initiateCustomSortHandler),this.parent.off("sortImport",this.sortImport))}getModuleName(){return"sort"}isValidSortRange(){const e=this.parent.getActiveSheet(),t=Wi(Ui(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)}sortImport(e){const t=this.parent.sortCollection;let i;const n=this.parent.getActiveSheet().usedRange.rowIndex-1,s=e?e.sheetIdx:this.parent.activeSheetIndex;for(let r=0;r<t.length;r++)if(t[r].sheetIndex===s)for(let e=0;e<n;e++)if(i=this.parent.getCell(e,t[r].columnIndex),i&&i.querySelector(".e-filter-icon"))return void("Ascending"===t[r].order||"OnTop"===t[r].order?i.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||i.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):i.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||i.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))}sortRangeAlertHandler(e){this.parent.serviceLocator.getService(Ma).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:e=>{const t={dialogName:"SortRangeDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()}initiateCustomSortHandler(){const e=this.parent.serviceLocator.getService(Da);if(!this.isValidSortRange())return void this.sortRangeAlertHandler({error:e.getConstant("SortOutOfRangeError")});const t=this.parent.serviceLocator.getService(Ma);t.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:e.getConstant("CustomSort"),beforeOpen:e=>{const i={dialogName:"CustomSortDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),t.dialogInstance.content=this.customSortContent(),t.dialogInstance.dataBind(),Ur(this.parent.element)},buttons:[{buttonModel:{content:e.getConstant("Ok"),isPrimary:!0},click:()=>{const e=t.dialogInstance.content,i=e.getElementsByClassName("e-list-sort e-listview e-lib")[0],n=Object(r.N)(i,"listview").dataSource;this.clearError();const s=e.getElementsByClassName("e-sort-error")[0];if(s.style.display="block",!this.validateError(n,e,s)){t.hide();const i=e.getElementsByClassName("e-sort-checkheader")[0],s=Object(r.N)(i,"checkbox"),a=Object(r.N)(e.getElementsByClassName("e-sort-checkcase")[0],"checkbox");this.applySortHandler({sortOptions:{sortDescriptors:n,containsHeader:s.checked,caseSensitive:a.checked}})}}}]})}validateError(e,t,i){const n=this.parent.serviceLocator.getService(Da);if(e.some(e=>""===e.field.toString()))return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),e=>{const t=!Object(r.N)(e,"dropdownlist").value;return t&&e.parentElement.classList.add("e-error"),t}),i.innerText=n.getConstant("SortEmptyFieldError"),!0;const s=new Set;let a="";const o=e.some(e=>(a=e.field.toString(),s.size===s.add(e.field).size));let l="";if(o){let e=0;return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),t=>{const i=Object(r.N)(t,"dropdownlist");return i.value===a&&(t.parentElement.classList.add("e-error"),l=i.text,e++),2===e}),i.innerHTML="<strong>"+l+"</strong>"+n.getConstant("SortDuplicateFieldError"),!0}return!1}customSortContent(){const e=this.parent.createElement("div",{className:"e-sort-dialog"}),t=this.getFields(),i=Object(r.W)("customSort"),n=this.getCustomListview(i);this.setHeaderTab(e,n,t);const s=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(s);const a=this.parent.createElement("div",{className:"e-list-sort",styles:""});s.appendChild(a),n.createElement=this.parent.createElement,n.appendTo(a),this.renderListItem(i,n,!0,t);const o=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(o),e}getFields(){const e=this.parent.getActiveSheet(),t=Wi(Ui(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;const i={filterRange:[],hasFilter:!1};this.parent.notify("getFilterRange",i),i.hasFilter&&i.filterRange&&(t[0]=i.filterRange[0])}const i=[];let n;for(;t[1]<=t[3];t[1]++){const s=Cs(t[0],t[1],e);if(s&&s.value){const e={formattedText:s.value,value:s.value,format:s.format,onLoad:!0};s.format&&this.parent.notify("getFormattedCell",e),n=e.formattedText}else n="Column "+Vi(t[1]+1);i.push({text:n,value:"Column "+Vi(t[1]+1)})}return i}setHeaderTab(e,t,i){const n=this.parent.serviceLocator.getService(Da),s=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(s);const a=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:n.getConstant("AddColumn")}),o=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");o.insertBefore(a,o.firstElementChild),a.addEventListener("click",()=>{if(t){const e=Object(r.W)("customSort");t.addItem([{id:e,text:n.getConstant("ThenBy"),field:"",order:"ascending"}]),this.renderListItem(e,t,l.checked,i,!0)}});const l=new h.b({label:n.getConstant("ContainsHeader"),checked:!0,change:t=>{const n=t.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),e=>{const t=Object(r.N)(e,"dropdownlist");t.dataSource=null,t.dataSource=i,t.fields=n,t.dataBind()})},cssClass:"e-sort-headercheckbox"}),c=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});s.appendChild(c),l.createElement=this.parent.createElement,l.appendTo(c);const d=new h.b({label:n.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),p=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});s.appendChild(p),d.createElement=this.parent.createElement,d.appendTo(p)}getCustomListview(e){const t=[{id:e,text:this.parent.serviceLocator.getService(Da).getConstant("SortBy"),field:"",order:"ascending"}];return Object(r.K)(!1),new d.b({dataSource:t,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})}deleteHandler(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",()=>{e&&t.removeItem(e)})}renderListItem(e,t,i,n,s){const r=this.parent.serviceLocator.getService(Da),a=t.element.querySelector("li[data-uid="+e+"]"),o=i?{text:"text",value:"value"}:{text:"value"},l=a.getElementsByClassName("e-sort-field")[0],d=new c.d({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:o,placeholder:r.getConstant("SelectAColumn"),change:i=>{i.value&&(Array.prototype.some.call(t.dataSource,t=>(t.id===e&&(t.field=i.value.toString().replace("Column ","")),t.id===e)),this.clearError())}});d.createElement=this.parent.createElement,d.appendTo(l),s||(d.index=0);const p=a.getElementsByClassName("e-sort-order")[0],g="ascending"===p.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),u=new h.d({label:r.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:g,cssClass:"e-sort-radiobutton",change:i=>{this.setRadioBtnValue(t,e,i.value)}}),m=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});p.appendChild(m),u.createElement=this.parent.createElement,u.appendTo(m);const f=new h.d({label:r.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!g,cssClass:"e-sort-radiobutton",change:i=>{this.setRadioBtnValue(t,e,i.value)}}),b=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});p.appendChild(b),f.createElement=this.parent.createElement,f.appendTo(b),this.deleteHandler(a,t)}setRadioBtnValue(e,t,i){i&&Array.prototype.some.call(e.dataSource,e=>(e.id===t&&(e.order=i),e.id===t))}clearError(){const e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),e=>{e.classList.remove("e-error")}))}applySortHandler(e){const t=this.parent.getActiveSheet(),i={range:e&&e.range||t.selectedRange,sortOptions:e&&e.sortOptions||{sortDescriptors:{}},cancel:!1};if(this.parent.trigger("beforeSort",i),i.cancel)return;this.parent.notify(vn,{eventArgs:i,action:"beforeSort"}),this.parent.showSpinner();const n=Wi(Ui(i.range)),s={filterRange:[],hasFilter:!1};n[0]===n[2]&&n[2]-n[0]==0&&(this.parent.notify("getFilterRange",s),s.hasFilter&&ps(s.filterRange,n[0],n[1])&&(n[0]=s.filterRange[0],n[1]=0,n[2]=t.usedRange.rowIndex,n[3]=t.usedRange.colIndex,i.sortOptions.containsHeader=!0)),this.parent.sort(i.sortOptions,zi(n)).then(e=>(this.parent.trigger("sortComplete",e),this.parent.notify(Cn,{eventArgs:e,action:"sorting"}),Promise.resolve(e))).catch(e=>(this.sortRangeAlertHandler({error:e}),Promise.reject(e)))}sortCompleteHandler(e){const t=Ui(e.range);for(let i=t[0];i<=t[2];i++)for(let e=t[1];e<=t[3];e++)this.parent.notify(an,{action:"refreshCalculate",rowIndex:i,colIndex:e});this.parent.serviceLocator.getService("cell").refreshRange(t,!0),this.parent.hideSpinner()}}class Ra{constructor(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.addEventListener()}destroy(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.parent=null}addEventListener(){this.parent.on("filterRangeAlert",this.filterRangeAlertHandler,this),this.parent.on("initiateFilterUI",this.initiateFilterUIHandler,this),this.parent.on("mouseDown",this.filterMouseDownHandler,this),this.parent.on("renderFilterCell",this.renderFilterCellHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this),this.parent.on(u.P,this.beforeFilterMenuOpenHandler,this),this.parent.on(u.U,this.closeDialog,this),this.parent.on("reapplyFilter",this.reapplyFilterHandler,this),this.parent.on("filterByCellValue",this.filterByCellValueHandler,this),this.parent.on("clearFilter",this.clearFilterHandler,this),this.parent.on("getFilteredColumn",this.getFilteredColumnHandler,this),this.parent.on(bn,this.cMenuBeforeOpenHandler,this),this.parent.on(u.T,this.filterCboxValueHandler,this),this.parent.on("getFilterRange",this.getFilterRangeHandler,this),this.parent.on("filterCellKeyDown",this.filterCellKeyDownHandler,this),this.parent.on("getFilteredCollection",this.getFilteredCollection,this),this.parent.on("contentLoaded",this.updateFilter,this),this.parent.on("updateFilter",this.updateFilter,this),this.parent.on("beforeInsert",this.beforeInsertHandler,this),this.parent.on("beforeDelete",this.beforeDeleteHandler,this),this.parent.on("sheetsDestroyed",this.deleteSheetHandler,this),this.parent.on("clear",this.clearHanlder,this),this.parent.on(u.W,this.filterDialogCreatedHandler,this),this.parent.on(u.V,this.removeFilterClass,this)}removeEventListener(){this.parent.isDestroyed||(this.parent.off("filterRangeAlert",this.filterRangeAlertHandler),this.parent.off("initiateFilterUI",this.initiateFilterUIHandler),this.parent.off("mouseDown",this.filterMouseDownHandler),this.parent.off("renderFilterCell",this.renderFilterCellHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler),this.parent.off(u.P,this.beforeFilterMenuOpenHandler),this.parent.off(u.U,this.closeDialog),this.parent.off("reapplyFilter",this.reapplyFilterHandler),this.parent.off("filterByCellValue",this.filterByCellValueHandler),this.parent.off("clearFilter",this.clearFilterHandler),this.parent.off("getFilteredColumn",this.getFilteredColumnHandler),this.parent.off(bn,this.cMenuBeforeOpenHandler),this.parent.on(u.T,this.filterCboxValueHandler),this.parent.off("getFilterRange",this.getFilterRangeHandler),this.parent.off("filterCellKeyDown",this.filterCellKeyDownHandler),this.parent.off("getFilteredCollection",this.getFilteredCollection),this.parent.off("contentLoaded",this.updateFilter),this.parent.off("updateFilter",this.updateFilter),this.parent.off("beforeInsert",this.beforeInsertHandler),this.parent.off("beforeDelete",this.beforeDeleteHandler),this.parent.off("sheetsDestroyed",this.deleteSheetHandler),this.parent.off("clear",this.clearHanlder),this.parent.off(u.W,this.filterDialogCreatedHandler),this.parent.off(u.V,this.removeFilterClass))}getModuleName(){return"filter"}isInValidFilterRange(e,t){const i=Wi(Ui(t||e.selectedRange));return i[0]>e.usedRange.rowIndex||i[1]>e.usedRange.colIndex}filterRangeAlertHandler(e){this.parent.serviceLocator.getService(Ma).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:e=>{const t={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};this.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()}beforeFilterMenuOpenHandler(e){const t=this.parent.serviceLocator.getService(Da);e.element.classList.add("e-spreadsheet-contextmenu");const i=e.element.querySelector("ul");this.addMenuItem(i,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(i,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(i)}addMenuItem(e,t,i,n){const s=this.parent.createElement("li",{className:i+" e-menu-item"});s.innerHTML=t,s.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),s.firstChild),e.insertBefore(s,e.firstChild)}initiateFilterUIHandler(e){const t=e?e.predicates:null;let i=e.sIdx;if(i||0===i||(i=this.parent.activeSheetIndex),this.filterRange.size>0&&this.filterRange.has(i)&&(this.removeFilter(i,e.isCut),!t))return;const n=Fs(this.parent,i);if(this.isInValidFilterRange(n,e.range)){const e=this.parent.serviceLocator.getService(Da);return void this.filterRangeAlertHandler({error:e.getConstant("FilterOutOfRangeError")})}let s=n.selectedRange,r=Ni(s);r[0]===r[2]&&r[1]===r[3]&&(r=bs(r[0],r[1],n),s=zi(r));const o={range:e.range?e.range:s,filterOptions:{predicates:e.predicates},cancel:!1};if(e.isCut||this.parent.notify(vn,{action:"filter",eventArgs:o}),this.processRange(n,i,e.range?e.range:s),t){const s=this.filterRange.get(i).slice();s[0]=s[0]+1,s[2]=n.usedRange.rowIndex,Is(this.parent,`${n.name}!${zi(s)}`,!0,!0).then(i=>{this.filterSuccessHandler(new a.b(i),{action:"filtering",filterCollection:t,field:t[0]?t[0].field:null,sIdx:e.sIdx,isUndoRedo:e.isUndoRedo}),this.refreshFilterRange(null,!1,e.sIdx)})}e.isCut||this.parent.notify(Cn,{action:"filter",eventArgs:o})}processRange(e,t,i){const n=Wi(Ui(i||e.selectedRange));n[0]===n[2]&&n[1]===n[3]&&(n[0]=0,n[1]=0,n[2]=e.usedRange.rowIndex,n[3]=e.usedRange.colIndex),this.filterRange.set(t,n),this.filterCollection.set(t,[]),this.refreshFilterRange(n,!1,t)}removeFilter(e,t){const i=this.filterRange.get(e).slice(),n=zi(i),s={range:n,cancel:!1};if(this.parent.notify(vn,{action:"filter",eventArgs:s}),!s.cancel){if(this.filterCollection.get(e).length&&this.parent.clearFilter(),this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(i,!0,e),this.parent.filterCollection){let t,i=0;for(let s=0,r=this.parent.filterCollection.length;s<r;s++)t=this.parent.filterCollection[i],t.sheetIndex===e&&t.filterRange===n?this.parent.filterCollection.splice(i,1):i++}t||this.parent.notify(Cn,{action:"filter",eventArgs:s})}}filterByCellValueHandler(){const e=this.parent.activeSheetIndex,t=this.parent.getActiveSheet();if(this.isInValidFilterRange(t)){const e=this.parent.serviceLocator.getService(Da);return void this.filterRangeAlertHandler({error:e.getConstant("FilterOutOfRangeError")})}const i=Bi(t.activeCell);this.isFilterRange(e,i[0],i[1])||this.processRange(t,e);const n=this.filterRange.get(e).slice();n[0]=n[0]+1,n[2]=t.usedRange.rowIndex;const s=Vi(i[1]+1),r=this.getColumnType(t,i[1]+1,n),o=[{field:s,operator:"date"===r||"datetime"===r||"boolean"===r?"equal":"contains",value:Cs(i[0],i[1],t).value,matchCase:!1,type:r}];Is(this.parent,`${t.name}!${zi(n)}`,!0,!0).then(e=>{this.filterSuccessHandler(new a.b(e),{action:"filtering",filterCollection:o,field:s})})}renderFilterCellHandler(e){let t=e.sIdx;if(t||0===t||(t=this.parent.activeSheetIndex),this.filterRange.has(t)&&this.isFilterCell(t,e.rowIndex,e.colIndex)){if(!e.td)return;if(Vi(e.colIndex+1),e.td.querySelector(".e-filter-btn")){const i=e.td.querySelector(".e-filter-iconbtn");Object(r.N)(i,"btn").iconCss="e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,t)}else{const i=this.parent.createElement("div",{className:"e-filter-btn"}),n=new h.a({iconCss:"e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,t),cssClass:"e-filter-iconbtn"});e.td.insertBefore(i,e.td.firstChild),n.createElement=this.parent.createElement,n.appendTo(i)}}this.parent.sortCollection&&this.parent.notify("sortImport",{sheetIdx:t})}getFilterSortClassName(e,t){const i=Vi(e+1);let n="";const s=this.filterCollection.get(t),r=this.parent.sortCollection;for(let a=0;a<s.length;a++)if(s[a].field===i){n=" e-filtered";break}if(r)for(let a=0;a<r.length;a++)if(r[a].sheetIndex===t&&r[a].columnIndex===e){n+="Ascending"===r[a].order?" e-sortasc-filter":" e-sortdesc-filter";break}return n}refreshFilterRange(e,t,i){let n=i;n||0===n||(n=this.parent.activeSheetIndex);const s=e||this.filterRange.get(n).slice();for(let r=s[1];r<=s[3];r++){const e=this.parent.getCell(s[0],r);if(t){if(e&&e.hasChildNodes()){const t=e.querySelector(".e-filter-btn");t&&e.removeChild(t)}}else this.renderFilterCellHandler({td:e,rowIndex:s[0],colIndex:r,sIdx:n})}this.parent.sortCollection&&this.parent.notify("sortImport",null)}isFilterCell(e,t,i){const n=this.filterRange.get(e);return n&&n[0]===t&&n[1]<=i&&n[3]>=i}isFilterRange(e,t,i){const n=this.filterRange.get(e);return n&&n[0]<=t&&n[2]>=t&&n[1]<=i&&n[3]>=i}getFilteredColumnHandler(e){const t=this.parent.activeSheetIndex,i=this.parent.serviceLocator.getService(Da);if(e.clearFilterText=i.getConstant("ClearFilter"),this.filterRange.has(t)){const n=this.filterCollection.get(t);if(e.isClearAll)return void(e.isFiltered=n&&n.length>0);const s=this.filterRange.get(t).slice(),r=this.parent.getActiveSheet(),a=Bi(r.activeCell);if(this.isFilterRange(t,a[0],a[1])){e.field=Vi(a[1]+1);const t=Cs(s[0],a[1],r),o=this.parent.getDisplayText(t);e.clearFilterText=i.getConstant("ClearFilterFrom")+'"'+(o?o.toString():"Column "+e.field)+'"',n.some(t=>(e.isFiltered=t.field===e.field,e.isFiltered))}}}cMenuBeforeOpenHandler(e){const t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){const e={isFiltered:!1};this.getFilteredColumnHandler(e),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!e.isFiltered,!0)}}closeDialog(){const e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){const t=Object(r.N)(e,"dialog");r.l.remove(e,fr(),this.filterMouseDownHandler),t&&t.hide(),this.removeFilterClass()}}removeFilterClass(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")}isPopupOpened(){const e=document.querySelector(".e-filter-popup");return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display}filterCellKeyDownHandler(e){const t=this.parent.activeSheetIndex,i=this.parent.getActiveSheet(),n=Bi(i.activeCell);if(this.isFilterCell(t,n[0],n[1])){e.isFilterCell=!0;const t=pr(i,n),s=this.parent.getCell(n[0],n[1]);this.isPopupOpened()&&this.closeDialog(),this.openDialog(s,t.left,s?s.getBoundingClientRect().bottom:t.top)}else e.isFilterCell=!1}filterMouseDownHandler(e){if(r.d.isDevice&&"mousedown"===e.type)return;const t=e.target;if(t.classList.contains("e-filter-icon")){if(this.isPopupOpened())return void this.closeDialog();this.openDialog(t,e.x,t.getBoundingClientRect().bottom)}else this.isPopupOpened()&&(t.classList.contains("e-searchinput")||t.classList.contains("e-searchclear")||!t.offsetParent||t.offsetParent.classList.contains("e-filter-popup")?this.selectSortItemHandler(t):this.closeDialog())}openDialog(e,t,i){const n=Object(u.bb)(e,"e-cell"),s=parseInt(n.getAttribute("aria-colindex"),10),o=Vi(s);this.parent.showSpinner();const l=this.parent.activeSheetIndex,h=this.filterRange.get(l).slice(),c=this.parent.getActiveSheet(),d=Cs(h[0],s-1,c),p=this.parent.getDisplayText(d);h[0]=h[0]+1,h[2]=c.usedRange.rowIndex,Is(this.parent,`${c.name}!${zi(h)}`,!0,!0,null,!0).then(n=>{let d;n.some((e,t)=>(e&&(d=new a.b(n.slice(t))),!!e));const g=this.parent.element.getBoundingClientRect();t-=g.left,i-=g.top,this.parent.element.style.position="relative",this.parent.element.classList.add("e-filter-open");const m={type:this.getColumnType(c,s,h),field:o,displayName:p||"Column "+o,dataSource:d,height:this.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:this.filterCollection.get(l),column:{field:o,filter:{}},handler:this.filterSuccessHandler.bind(this,new a.b(n)),target:e,position:{X:t,Y:i},localeObj:this.parent.serviceLocator.getService(Da)};new u.m(this.parent,this.getLocalizedCustomOperators()).openDialog(m);const f=document.querySelector(".e-filter-popup"),b=this.parent.element.getBoundingClientRect(),y=e.getBoundingClientRect();if(f){const e=y.right-f.offsetWidth;f.style.left=e<1?(e+f.offsetWidth-b.left).toString()+"px":(e-b.left).toString()+"px"}if(f&&f.id.includes(this.parent.element.id)){r.l.add(f,fr(),this.filterMouseDownHandler,this),f.style.top="0px",f.style.visibility="hidden",f.classList.contains("e-hide")&&f.classList.remove("e-hide");let e=f.getBoundingClientRect().height;e<400&&(e=400);let t=g.height-i;f.style.top=(e>t?i-Math.abs(e-t):i)+"px",f.style.visibility=""}this.parent.hideSpinner()})}filterDialogCreatedHandler(){const e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")}filterCboxValueHandler(e){if(e.column&&e.data){const t=e.column.field,i="dataObj",n="__rowIndex";if(e.value){const s=Bi(t+e.data[i][n]),r=Cs(s[0],s[1],this.parent.getActiveSheet());r&&r.format&&(e.value=this.parent.getDisplayText(r))}}}selectSortItemHandler(e){const t=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if(!t)return;const i=this.parent.getActiveSheet(),n=this.parent.activeSheetIndex,s=this.filterRange.get(n).slice();s[0]=s[0]+1,s[2]=i.usedRange.rowIndex,this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}},range:zi(s)});const r=Ui(i.activeCell);this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(let a=0;a<this.parent.sortCollection.length;a++)this.parent.sortCollection[a]&&this.parent.sortCollection[a].sheetIndex===n&&this.parent.sortCollection.splice(a,1);this.parent.sortCollection.push({sortRange:zi(s),columnIndex:r[1],order:t,sheetIndex:n}),this.refreshFilterRange(),this.closeDialog()}filterSuccessHandler(e,t){let i=t.sIdx;i||0===i||(i=this.parent.activeSheetIndex);const n=[].slice.call(this.filterCollection.get(i));let s=this.filterCollection.get(i);const r=new a.b(s),o=new a.h,l=r.executeLocal(o.where("field","equal",t.field));for(let a=0;a<l.length;a++){let e=-1;for(let t=0;t<s.length;t++)if(s[t].field===l[a].field){e=t;break}-1!==e&&s.splice(e,1)}if("filtering"===t.action&&(s=s.concat(t.filterCollection),s.length))for(let a=0;a<s.length;a++)t.field=s[a].field;this.filterCollection.set(i,s);const h={datasource:e,predicates:this.getPredicates(i)};this.filterRange.get(i)[2]=Fs(this.parent,i).usedRange.rowIndex,this.applyFilter(h,zi(this.filterRange.get(i)),i,n,t.isUndoRedo)}applyFilter(e,t,i,n,s){const r={range:t,predicates:[].slice.call(this.filterCollection.get(i)),previousPredicates:n,cancel:!1};this.parent.notify(vn,{action:"filter",eventArgs:r}),r.cancel||(this.parent.showSpinner(),this.parent.filter(e,t).then(e=>(this.refreshFilterRange(),this.parent.notify("getFilteredCollection",null),this.parent.hideSpinner(),delete r.cancel,s||this.parent.notify(Cn,{action:"filter",eventArgs:r}),Promise.resolve(e))).catch(e=>(this.filterRangeAlertHandler({error:e}),Promise.reject(e))))}getPredicates(e){const t=[],i=u.d.getPredicate(this.filterCollection.get(e));for(const n of Object.keys(i))t.push(i[n]);return t}getColumnType(e,t,i){let n=0,s=0,r=0;for(let a=i[0];a<=e.usedRange.rowIndex;a++){const i=Cs(a,t-1,e);if(i)if(i.format)switch(pn(i.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":n++;break;case"shortdate":case"longdate":r++;break;case"time":n++;break;default:s++}else"string"==typeof i.value?s++:n++;else s++}return n>s&&n>r&&n>0?"number":s>n&&s>r&&s>0?"string":r>n&&r>s&&r>0?"date":"datetime"}clearAllFilterHandler(){if(this.filterRange.has(this.parent.activeSheetIndex)){this.filterCollection.set(this.parent.activeSheetIndex,[]);const e=this.parent.filterCollection;for(let t=0;t<e.length;t++)if(e[t].sheetIndex===this.parent.activeSheetIndex){e.splice(t,1);break}this.refreshFilterRange()}}clearFilterHandler(e){this.filterSuccessHandler(null,{action:"clear-filter",filterCollection:[],field:e.field})}reapplyFilterHandler(){const e=this.parent.activeSheetIndex;this.filterRange.has(e)&&this.applyFilter({predicates:this.getPredicates(e)},zi(this.filterRange.get(e)),e)}getFilterRangeHandler(e){const t=e.sheetIdx;this.filterRange&&this.filterRange.has(t)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(t)):(e.hasFilter=!1,e.filterRange=null)}getLocalizedCustomOperators(){const e=this.parent.serviceLocator.getService(Da),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}}getFilteredCollection(){const e=this.parent.sheets.length,t=[];let i;for(let n=0;n<e;n++){let e,s;const a={sheetIdx:n,filterRange:e,hasFilter:s};if(this.getFilterRangeHandler(a),a.hasFilter){const e=[],n=[],s=[],o=[],l=[],h=this.filterCollection.get(a.sheetIdx);for(let t=0;t<h.length;t++)if(h[t].field&&h[t].operator){const i=Bi(h[t].field+"1")[1];e.push(i),n.push(h[t].operator),s.push(Object(r.Z)(h[t].value)?"":h[t].value),o.push(h[t].type),l.push(h[t].predicate)}const c=zi(a.filterRange);i={sheetIndex:a.sheetIdx,filterRange:c,hasFilter:a.hasFilter,column:e,criteria:n,value:s,dataType:o,predicates:l},t.push(i)}}i&&(this.parent.filterCollection=t)}updateFilter(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(let e=0;e<this.parent.filterCollection.length;e++){let t=this.parent.filterCollection[e],i=t.sheetIndex;0===e&&(i=0);let n=[];if(t.column)for(let e=0;e<t.column.length;e++){let i={field:_i(0,t.column[e]).charAt(0),operator:this.getFilterOperator(t.criteria[e]),value:t.value[e].toString().split("*").join(""),predicate:t.predicates&&t.predicates[e]};n.push(i)}for(let e=0;e<n.length-1;e++)n[e].field===n[e+1].field&&(n[e].predicate||(n[e].predicate="or"),n[e+1].predicate||(n[e+1].predicate="or"));this.parent.notify("initiateFilterUI",{predicates:n!==[]?n:null,range:t.filterRange,sIdx:i})}this.parent.sortCollection&&this.parent.notify("sortImport",null)}}getFilterOperator(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal"}return e}beforeInsertHandler(e){if("Column"===e.modelType){const t=Object(r.cb)(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){let i=this.filterRange.get(t);(this.isFilterCell(t,i[0],e.index)||e.index<i[1])&&(i[3]+=e.model.length,e.index<=i[1]&&(i[1]+=e.model.length),this.filterCollection.get(t).forEach(t=>{const i=Hi(t.field);e.index<=i&&(t.field=Vi(i+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(i=>{i.sheetIndex===t&&e.index<=i.columnIndex&&(i.columnIndex+=e.model.length)}),this.getFilteredCollection())}}else if("Sheet"===e.modelType){let t=!1;for(const i of Array.from(this.filterRange.keys()).sort().reverse())e.index<=i&&(t=!0,this.filterRange.set(i+e.model.length,this.filterRange.get(i)),this.filterRange.delete(i),this.filterCollection.set(i+e.model.length,this.filterCollection.get(i)),this.filterCollection.delete(i));this.parent.sortCollection&&this.parent.sortCollection.forEach(t=>{e.index<=t.sheetIndex&&(t.sheetIndex+=e.model.length)}),t&&this.getFilteredCollection()}}beforeDeleteHandler(e){if("Column"===e.modelType){const t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){let i=!0,n=this.filterRange.get(t);if(e.start>=n[1]&&e.end<=n[3]?n[3]-=e.end-e.start+1:e.start<n[1]&&e.end<n[1]?(n[1]-=e.end-e.start+1,n[3]-=e.end-e.start+1):e.start<n[1]&&e.end>n[1]&&e.end<n[3]?(n[1]=e.start,n[3]-=e.end-e.start+1):i=!1,i){const i=this.filterCollection.get(t);let n;for(let t=i.length-1;t>=0;t--){const s=Hi(i[t].field);e.end<s?i[t].field=Vi(s-(e.end-e.start+1)+1):e.start<=s&&e.end>=s&&(n=!0)}let s=this.parent.sortCollection;if(s)for(let r=0;r<s.length;r++)if(s[r].sheetIndex===t){if(e.end<s[r].columnIndex){s[r].columnIndex=s[r].columnIndex-(e.end-e.start+1);break}if(e.start<=s[r].columnIndex&&e.end>=s[r].columnIndex){s.splice(r,1);break}}n&&this.parent.clearFilter(),this.getFilteredCollection()}}}}deleteSheetHandler(e){if(!Object(r.cb)(e.sheetIndex)){let t;for(const n of Array.from(this.filterRange.keys()).sort().reverse())t=!0,e.sheetIndex===n?(this.filterRange.delete(n),this.filterCollection.delete(n)):e.sheetIndex<n?(this.filterRange.set(n-1,this.filterRange.get(n)),this.filterRange.delete(n),this.filterCollection.set(n-1,this.filterCollection.get(n)),this.filterCollection.delete(n)):t=!1;let i=this.parent.sortCollection;if(i)for(let n=i.length-1;n>=0;n--)e.sheetIndex===i[n].sheetIndex?i.splice(n,1):e.sheetIndex<i[n].sheetIndex&&(i[n].sheetIndex-=1);t&&this.getFilteredCollection()}}clearHanlder(e){const t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){const e=this.filterRange.get(t.sheetIndex).slice();ps(t.indices,e[0],e[1])&&ps(t.indices,e[0],e[3])&&this.removeFilter(t.sheetIndex)}}}class Aa{constructor(e){this.pictureCount=1,this.parent=e,this.addEventListener(),this.renderImageUpload()}addEventListener(){this.parent.on("insertImage",this.insertImage,this),this.parent.on("refreshImgElem",this.refreshImgElem,this),this.parent.on("refreshImgCellObj",this.refreshImgCellObj,this),this.parent.on("createImageElement",this.createImageElement,this),this.parent.on("deleteImage",this.deleteImage,this),this.parent.on("refreshImagePosition",this.refreshInsDelImagePosition,this)}renderImageUpload(){const e=this.parent.element.id+"_imageUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}}));const t=document.getElementById(e);t.onchange=this.imageSelect.bind(this),t.style.display="none"}imageSelect(e){const t=e.target.files[0];if(t&&t.length<1)return;const i={file:t};0===i.file.type.indexOf("image")?this.insertImage(i):this.parent.serviceLocator.getService(Ma).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),document.getElementById(this.parent.element.id+"_imageUpload").value=""}removeEventListener(){this.parent.isDestroyed||(this.parent.off("insertImage",this.insertImage),this.parent.off("refreshImgCellObj",this.refreshImgCellObj),this.parent.off("createImageElement",this.createImageElement),this.parent.off("deleteImage",this.deleteImage),this.parent.off("refreshImagePosition",this.refreshInsDelImagePosition))}insertImage(e,t){this.binaryStringVal(e).then(e=>this.createImageElement({options:{src:e},range:t,isPublic:!0}))}binaryStringVal(e){return new Promise((t,i)=>{let n=new FileReader;n.readAsDataURL(e.file),n.onload=()=>t(n.result),n.onerror=e=>i(e)})}createImageElement(e){const t=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?Ls(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,n=this.parent.serviceLocator.getService(Fa),s=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,r=Ni(t),a=i?this.parent.sheets[i]:this.parent.getActiveSheet();if(document.getElementById(s))return;let o={requestType:"beforeInsertImage",range:a.name+"!"+t,imageData:e.options.src,sheetIndex:i};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:o,action:"beforeInsertImage"}),o.cancel)return;const l=n.insertOverlayElement(s,t,i);l.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(l.style.height=e.options.height+"px",l.style.width=e.options.width+"px",l.style.top=e.options.top+"px",l.style.left=e.options.left+"px"),(a.frozenRows||a.frozenColumns)&&n.adjustFreezePaneSize(e.options,l,t),e.options.imageId||this.pictureCount++;const h={src:e.options.src,id:s,height:parseFloat(l.style.height.replace("px","")),width:parseFloat(l.style.width.replace("px","")),top:a.frozenRows||a.frozenColumns?r[0]?Ks(a,0,r[0]-1):0:parseFloat(l.style.top.replace("px","")),left:a.frozenRows||a.frozenColumns?r[1]?tr(a,0,r[1]-1):0:parseFloat(l.style.left.replace("px",""))};this.parent.setUsedRange(r[0],r[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify("setImage",{options:[h],range:a.name+"!"+t});const c=Cs(r[0],r[1],a);c.image[c.image.length-1].id||(c.image[c.image.length-1].id=h.id),o={requestType:"insertImage",range:a.name+"!"+t,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:s,sheetIndex:i},!e.isUndoRedo&&e.isPublic&&this.parent.notify("actionComplete",{eventArgs:o,action:"insertImage"})}refreshImgElem(){const e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&Object(r.lb)([e],"e-ss-overlay-active")}refreshInsDelImagePosition(e){const t=e.count;let i;const n=Cs(e.rowIdx,e.colIdx,this.parent.sheets[e.sheetIdx]),s=n.image.length;let r,a;for(let o=0;o<s;o++)i=document.getElementById(n.image[o].id),r="Row"===e.type?"insert"===e.status?n.image[o].top+20*t:n.image[o].top-20*t:n.image[o].top,a="Column"===e.type?"insert"===e.status?n.image[o].left+64*t:n.image[o].left-64*t:n.image[o].left,n.image[o].top=r,n.image[o].left=a,i.style.top=r+"px",i.style.left=a+"px"}refreshImgCellObj(e){const t=this.parent.getActiveSheet(),i=Cs(e.prevRowIdx,e.prevColIdx,t),n=Cs(e.currentRowIdx,e.currentColIdx,t),s=i?i.image:[];let r,a;const o=s&&s.length?s.length:0;if(i&&i.image&&s.length>0){for(let t=0;t<o;t++)s[t]&&s[t].id===e.id&&(r=s[t],r.height=e.currentHeight,r.width=e.currentWidth,r.top=e.currentTop,r.left=e.currentLeft,s.splice(t,1));n&&n.image&&(a=n.image,r&&a.push(r)),vs(e.currentRowIdx,e.currentColIdx,t,a?{image:a}:{image:[r]},!0),"imageRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex},action:"imageRefresh"})}}deleteImage(e){let t=this.parent.getActiveSheet();const i=document.getElementById(e.id);let n,s;if(i){let r,a;if(t.frozenRows||t.frozenColumns){const e=i.getBoundingClientRect();r={clientY:e.top},a={clientX:e.left},e.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(r.target=this.parent.getColumnHeaderContent()),e.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(a.target=this.parent.getRowHeaderTable())}else r={clientY:i.offsetTop,isImage:!0},a={clientX:i.offsetLeft,isImage:!0};this.parent.notify("getRowIdxFromClientY",r),this.parent.notify("getColIdxFromClientX",a),document.getElementById(e.id).remove(),n=r.clientY,s=a.clientX,t=this.parent.sheets[this.parent.activeSheetIndex]}else{const i=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,r=e.range&&e.range.indexOf("!")>0?Ls(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,a=Ni(i);n=a[0],s=a[1],t=this.parent.sheets[r]}const r=Cs(n,s,t).image,a=r.length;for(let o=0;o<a;o++)r[o].id===e.id&&r.splice(o,1);vs(n,s,t,{image:r},!0)}destroy(){this.removeEventListener(),this.parent=null}getModuleName(){return"spreadsheetImage"}}fi.Inject(class extends xi{render(e){let t;const i=this.getSideBySideInfo(e),n=Math.max(e.yAxis.visibleRange.min,0);let s;for(const r of e.points)r.symbolLocations=[],r.regions=[],r.visible&&Te(e.points[r.index-1],r,e.points[r.index+1],e)&&(t=this.getRectangle(r.xValue+i.start,r.yValue,r.xValue+i.end,n,e),s=this.triggerEvent(e,r,"Indicator"===e.category?r.color:e.interior,{width:e.border.width,color:e.border.color}),s.cancel||(this.updateSymbolLocation(r,t,e),this.drawRectangle(e,r,t,s)));this.renderMarker(e)}doAnimation(e){this.animate(e)}getModuleName(){return"ColumnSeries"}destroy(){}},class extends yi{render(e,t,i,n){let s,r,a="",o=null,l="M";const h=e.chart&&"PolarRadar"===e.chart.chartAreaType,c=e.emptyPointSettings&&"Drop"===e.emptyPointSettings.mode,d=h?_e:ht,p="TrendLine"===e.category?e.points:this.enableComplexProperty(e);for(const u of p)u.regions=[],u.symbolLocations=[],u.visible&&Te(p[u.index-1],u,p[u.index+1],e)?(a+=this.getLineDirection(o,u,e,n,d,l),l=o?"L":l,o=u,this.storePointLocation(u,e,n,d)):(o=c?o:null,l=c?l:"M");if(h&&e.isClosed){const o=this.getFirstLastVisiblePoint(p);r=d(o.last.xValue,o.last.yValue,t,i,n,e),s=d(o.first.xValue,o.first.yValue,t,i,n,e),a=a.concat(l+" "+r.x+" "+r.y+" L "+s.x+" "+s.y)}const g=new A("Indicator"===e.category?e.chart.element.id+"_Indicator_"+e.index+"_"+e.name:"TrendLine"===e.category?e.chart.element.id+"_Series_"+e.sourceIndex+"_TrendLine_"+e.index:e.chart.element.id+"_Series_"+(void 0===e.index?e.category:e.index),"none",e.width,e.interior,e.opacity,e.dashArray,a);this.appendLinePath(g,e,""),this.renderMarker(e)}doAnimation(e){this.doProgressiveAnimation(e,e.animation)}getModuleName(){return"LineSeries"}destroy(){}},class extends xi{render(e){const t=Math.max(e.yAxis.visibleRange.min,0),i=this.getSideBySideInfo(e);let n,s;for(const r of e.points)r.symbolLocations=[],r.regions=[],r.visible&&Te(e.points[r.index-1],r,e.points[r.index+1],e)&&(n=this.getRectangle(r.xValue+i.start,r.yValue,r.xValue+i.end,t,e),s=this.triggerEvent(e,r,e.interior,{width:e.border.width,color:e.border.color}),s.cancel||(this.updateSymbolLocation(r,n,e),this.drawRectangle(e,r,n,s)));this.renderMarker(e)}doAnimation(e){this.animate(e)}destroy(){}getModuleName(){return"BarSeries"}},class extends Ci{render(e,t,i,n){let s=null,r="";const a=e.chart&&"PolarRadar"===e.chart.chartAreaType;let o,l=Math.max(e.yAxis.visibleRange.min,0);a&&(l=this.getFirstLastVisiblePoint(e.points).first.yValue);const h=e.emptyPointSettings&&"Drop"===e.emptyPointSettings.mode,c=e.border?e.border.width:0,d=e.border?e.border.color:"transparent",p="PolarRadar"===e.chart.chartAreaType?_e:ht,g=this.enableComplexProperty(e);let u;for(let m=0;m<g.length;m++)u=g[m],o=u.xValue,u.symbolLocations=[],u.regions=[],u.visible&&Te(g[m-1],u,g[m+1],e)&&(r+=this.getAreaPathDirection(o,l,e,n,p,s,"M"),s=s||new Pt(o,l),r+=this.getAreaPathDirection(o,u.yValue,e,n,p,null,"L"),g[m+1]&&!g[m+1].visible&&(!a||a&&this.withinYRange(g[m+1],i))&&!h&&(r+=this.getAreaEmptyDirection({x:o,y:l},s,e,n,p),s=null),this.storePointLocation(u,e,n,p));if(a&&""!==r){let s="";const a=this.chart;s+=this.getAreaPathDirection(0,l,e,n,p,null,"L"),(t.isInversed||i.isInversed)&&(r+="Polar"===e.type?a.polarSeriesModule.getPolarIsInversedPath(t,s):a.radarSeriesModule.getRadarIsInversedPath(t,s)),r=r.concat(r+" Z")}this.appendLinePath(new A(e.chart.element.id+"_Series_"+e.index,e.interior,c,d,e.opacity,e.dashArray,e.points.length>1&&""!==r?r+this.getAreaPathDirection(e.points[e.points.length-1].xValue,"PolarRadar"===e.chart.chartAreaType?e.points[e.points.length-1].yValue:l,e,n,p,null,"L"):""),e,""),this.renderMarker(e)}destroy(){}getModuleName(){return"AreaSeries"}doAnimation(e){this.doLinearAnimation(e,e.animation)}},class extends xi{render(e){e.isRectSeries=!0;const t=this.getSideBySideInfo(e);let i,n;const s=e.stackedValues,r=Ie(e);for(const a of r)a.symbolLocations=[],a.regions=[],a.visible&&Te(r[a.index-1],a,r[a.index+1],e)&&(i=this.getRectangle(a.xValue+t.start,s.endValues[a.index],a.xValue+t.end,s.startValues[a.index],e),n=this.triggerEvent(e,a,e.interior,{width:e.border.width,color:e.border.color}),n.cancel||(this.drawRectangle(e,a,i,n),this.updateSymbolLocation(a,i,e)));this.renderMarker(e)}doAnimation(e){this.animate(e)}destroy(){}getModuleName(){return"StackingColumnSeries"}},class extends yi{render(e,t,i,n){const s="PolarRadar"===e.chart.chartAreaType?_e:ht;let r="";const a=this.enableComplexProperty(e),o=a.length,l=e.stackedValues;let h,c;for(let p=0;p<o;p++)a[p].regions=[],a[p].symbolLocations=[],a[p].visible&&Te(a[p-1],a[p],a[p+1],e)?(h=s(a[p].xValue,l.endValues[p],t,i,n,e),r=r.concat((p?"L":"M")+" "+h.x+" "+h.y+" "),a[p].symbolLocations.push(s(a[p].xValue,l.endValues[p],t,i,n,e)),a[p].regions.push(new C(a[p].symbolLocations[0].x-e.marker.width,a[p].symbolLocations[0].y-e.marker.height,2*e.marker.width,2*e.marker.height))):"Drop"!==e.emptyPointSettings.mode&&a[p+1]&&a[p+1].visible&&(h=s(a[p+1].xValue,l.endValues[p+1],t,i,n,e),r=r.concat("M "+h.x+" "+h.y+" "));"PolarRadar"===e.chart.chartAreaType&&a.length>1&&(h={y:l.endValues[0],x:e.points[0].xValue},c=s(h.x,h.y,t,i,n,e),r+="L "+c.x+" "+c.y+" ");const d=new A(e.chart.element.id+"_Series_"+e.index,"none",e.width,e.interior,e.opacity,e.dashArray,r);this.appendLinePath(d,e,""),this.renderMarker(e)}doAnimation(e){this.doLinearAnimation(e,e.animation)}destroy(){}getModuleName(){return"StackingLineSeries"}},class extends xi{render(e){let t,i,n=this.getSideBySideInfo(e),s=e.stackedValues;for(let r of e.points)r.symbolLocations=[],r.regions=[],r.visible&&Te(e.points[r.index-1],r,e.points[r.index+1],e)&&(t=this.getRectangle(r.xValue+n.start,s.endValues[r.index],r.xValue+n.end,s.startValues[r.index],e),i=this.triggerEvent(e,r,e.interior,{width:e.border.width,color:e.border.color}),i.cancel||(this.drawRectangle(e,r,t,i),this.updateSymbolLocation(r,t,e)));this.renderMarker(e)}destroy(){}getModuleName(){return"StackingBarSeries"}doAnimation(e){this.animate(e)}},class{render(e,t,i,n){e.isRectSeries=!1;const s=e.marker,r=this.enableComplexProperty(e);let a;const o="PolarRadar"===e.chart.chartAreaType?_e:ht;let l;const h=e.chart.redraw;for(const c of r)l=h&&c.symbolLocations?c.symbolLocations[0]:null,c.symbolLocations=[],c.regions=[],c.visible&&Te(r[c.index-1],c,r[c.index+1],e)&&(a={cancel:!1,name:"pointRender",series:e,point:c,fill:e.setPointColor(c,e.interior),border:e.setBorderColor(c,{width:e.border.width,color:e.border.color}),height:s.height,width:s.width,shape:s.shape},e.chart.trigger("pointRender",a),a.cancel?c.marker={visible:!0}:(c.symbolLocations.push(o(c.xValue,c.yValue,t,i,n,e)),c.color=a.fill,this.refresh(e,c,a,l)))}enableComplexProperty(e){const t=[],i=[],n=e.yAxis.visibleRange,s=e.xAxis.visibleRange,a=e.clipRect,o=e.points,l=Math.abs(n.delta/a.height),h=Math.abs(s.delta/a.width);let c,d=o[0]&&o[0].y>l?0:l,p=o[0]&&o[0].x>h?0:h,g=0,u=0;for(const r of o)r.symbolLocations=[],g=r.yValue?r.yValue:n.min,u=r.xValue?r.xValue:s.min,(Math.abs(d-g)>=l||Math.abs(p-u)>=h)&&(i.push(r),d=g,p=u);for(let m=0;m<i.length;m++)c=i[m],Object(r.Z)(c.x)||""===c.x||t.push(c);return t}refresh(e,t,i,n){const s=e.chart;let r,a;const o=e.marker,l=i.point.marker.imageUrl||o.imageUrl,h=new A(s.element.id+"_Series_"+e.index+"_Point_"+t.index,i.fill,i.border.width,i.border.color,e.opacity,null);s.redraw&&nt(h.id)&&(r="Circle"===i.shape?"c":"",a=nt(h.id).getAttribute("d")),ct(!1,e.seriesElement,it(t.symbolLocations[0],i.shape,new x(i.width,i.height),l,h,(t.x.toString(),t.yValue.toString()),e.chart.svgRenderer,e.clipRect),s.redraw,!0,r+"x",r+"y",n,a),t.regions.push(new C(t.symbolLocations[0].x-o.width,t.symbolLocations[0].y-o.height,2*o.width,2*o.height)),t.marker={border:i.border,fill:i.fill,height:i.height,visible:!0,width:i.width,shape:i.shape,imageUrl:l}}doAnimation(e){const t=e.animation.duration,i=e.animation.delay,n=e.seriesElement.childNodes;let s=1;for(const r of e.points)r.symbolLocations.length&&n[s]&&(Ye(n[s],i,t,e,r.index,r.symbolLocations[0],!1),s++)}getModuleName(){return"ScatterSeries"}destroy(){}}),fi.Inject(class extends yi{render(e,t,i,n){const s="PolarRadar"===e.chart.chartAreaType,r=s?_e:ht;let a="";const o=this.enableComplexProperty(e),l=o.length,h=e.stackedValues,c=s?Math.max(e.yAxis.visibleRange.min,h.endValues[0]):Math.max(e.yAxis.visibleRange.min,h.startValues[0]);let d,p,g=0;l>0&&(d=r(o[0].xValue,c,t,i,n,e),a=a.concat("M "+d.x+" "+d.y+" "));const u=e.chart&&"PolarRadar"===e.chart.chartAreaType;for(let f=0;f<l;f++)if(o[f].symbolLocations=[],o[f].regions=[],o[f].visible&&Te(o[f-1],o[f],o[f+1],e))d=r(o[f].xValue,h.endValues[f],t,i,n,e),a=a.concat("L "+d.x+" "+d.y+" "),o[f].symbolLocations.push(r(o[f].xValue,h.endValues[f],t,i,n,e)),o[f].regions.push(new C(o[f].symbolLocations[0].x-e.marker.width,o[f].symbolLocations[0].y-e.marker.height,2*e.marker.width,2*e.marker.height));else if(!u&&"Drop"!==e.emptyPointSettings.mode){for(let s=f-1;s>=g;s--)p=r(o[s].xValue,h.startValues[s],t,i,n,e),a=a.concat("L "+p.x+" "+p.y+" ");o[f+1]&&o[f+1].visible&&(!u||u&&this.withinYRange(o[f+1],i))&&(d=r(o[f+1].xValue,h.startValues[f+1],t,i,n,e),a=a.concat("M "+d.x+" "+d.y+" ")),g=f+1}if("PolarRadar"===e.chart.chartAreaType&&o.length>1){const s=this.getFirstLastVisiblePoint(e.points),o=this.chart;d={x:s.first.xValue,y:h.endValues[s.first.index]},p=r(d.x,d.y,t,i,n,e),a+="L "+p.x+" "+p.y+" ",1===this.chart.visible&&(t.isInversed||i.isInversed)&&(this.chart.enableAnimation=!1,a="Polar"===e.type?o.polarSeriesModule.getPolarIsInversedPath(t,a):o.radarSeriesModule.getRadarIsInversedPath(t,a))}if(!u||u&&e.index!==this.getFirstSeriesIndex(e.chart.visibleSeries))for(let f=l-1;f>=g;f--){if(u&&!o[f].visible)continue;const c=this.getPreviousSeries(e);"Drop"===c.emptyPointSettings.mode&&c.points[f].isEmpty||(p=r(o[f].xValue,h.startValues[f],t,i,n,e),h.startValues[f]===h.endValues[f]&&(p.y=Math.floor(p.y)),a=a.concat((f===l-1&&s?"M":"L")+" "+p.x+" "+p.y+" "))}const m=new A(e.chart.element.id+"_Series_"+e.index,e.interior,e.border.width,e.border.color,e.opacity,e.dashArray,a);this.appendLinePath(m,e,""),this.renderMarker(e)}doAnimation(e){this.doLinearAnimation(e,e.animation)}destroy(){}getModuleName(){return"StackingAreaSeries"}getPreviousSeries(e){const t=e.chart.visibleSeries;for(let i=0,n=t.length;i<n;i++)if(e.index===t[i].index&&0!==i)return t[i-1];return t[0]}getFirstSeriesIndex(e){for(const t of e)if(t.visible)return t.index;return 0}},class extends bi{constructor(e){super(e)}calculateRangeAndInterval(e,t){this.calculateRange(t),this.getActualRange(t,e),this.applyRangePadding(t,e),this.calculateVisibleLabels(t)}getActualRange(e,t){this.initializeDoubleRange(e),e.actualRange={},e.actualRange.interval=e.interval?Math.ceil(e.interval):Math.max(1,Math.floor(e.doubleRange.delta/et(t,e))),e.actualRange.min=e.doubleRange.start,e.actualRange.max=e.doubleRange.end,e.actualRange.delta=e.doubleRange.delta}applyRangePadding(e,t){const i="BetweenTicks"===e.labelPlacement&&"PolarRadar"!==this.chart.chartAreaType?.5:0;i>0?(e.actualRange.min-=i,e.actualRange.max+=i):e.actualRange.max+=e.actualRange.max?0:.5,e.doubleRange=new ee(e.actualRange.min,e.actualRange.max),e.actualRange.delta=e.doubleRange.delta,this.calculateVisibleRange(t,e)}calculateVisibleLabels(e){e.visibleLabels=[];let t,i,n=Math.ceil(e.visibleRange.min);for((e.zoomFactor<1||e.zoomPosition>0)&&(n=e.visibleRange.min-e.visibleRange.min%e.visibleRange.interval),e.startLabel=e.labels[Math.round(e.visibleRange.min)],e.endLabel=e.labels[Math.floor(e.visibleRange.max)];n<=e.visibleRange.max;n+=e.visibleRange.interval)t=Object(r.L)({},Object(r.X)("properties",e.labelStyle),null,!0),Ee(n,e.visibleRange)&&e.labels.length>0&&(i=Math.round(n),Ke(this.chart,i,e.labels[i]?e.labels[i].toString():i.toString(),t,e));e.getMaxLabelWidth&&e.getMaxLabelWidth(this.chart)}getModuleName(){return"Category"}destroy(){}},class extends oi{constructor(e){super(e),this.library=this,this.addEventListener()}addEventListener(){this.chart.isDestroyed||(this.chart.on(r.d.touchMoveEvent,this.mouseMove,this),this.chart.on("click",this.click,this),this.chart.on(r.d.touchEndEvent,this.mouseEnd,this))}removeEventListener(){this.chart.isDestroyed||(this.chart.off(r.d.touchMoveEvent,this.mouseMove),this.chart.off("click",this.click),this.chart.off(r.d.touchEndEvent,this.mouseEnd))}mouseMove(e){this.chart.legendSettings.visible&&!this.chart.isTouch&&(this.move(e),this.chart.highlightModule&&"None"!==this.chart.highlightMode&&this.click(e))}mouseEnd(e){this.chart.legendSettings.visible&&this.chart.isTouch&&this.move(e)}getLegendOptions(e,t){let i,n;this.legendCollections=[];const s=[];e.length>1&&(this.legend.mode="Series");for(const r of e)if("Series"===this.legend.mode)"Indicator"!==r.category&&(i="PolarRadar"===t.chartAreaType?r.drawType:r.type,n=r.pointColorMapping&&r.points.length>0&&r.points[0].interior?r.points[0].interior:r.interior,this.legendCollections.push(new li(r.name,n,r.legendShape,"TrendLine"===r.category?this.chart.series[r.sourceIndex].trendlines[r.index].visible:r.visible,i,r.legendImageUrl,r.marker.shape,r.marker.visible)));else if("Point"===this.legend.mode)for(const e of r.points)i="PolarRadar"===t.chartAreaType?r.drawType:r.type,n=e.interior?e.interior:r.interior,0===this.legendCollections.filter(t=>t.text===e.x.toString()).length&&this.legendCollections.push(new li(e.x.toString(),n,r.legendShape,"TrendLine"===r.category?this.chart.series[r.sourceIndex].trendlines[r.index].visible:e.visible,i,"",r.marker.shape,r.marker.visible));else if("Range"===this.legend.mode)for(const e of r.points){i="PolarRadar"===t.chartAreaType?r.drawType:r.type,n=e.interior?e.interior:r.interior;let a="Others";if(s.indexOf(n)<0&&(s.push(n),t.rangeColorSettings.length>=1&&1===t.rangeColorSettings[0].colors.length)){for(const e of t.rangeColorSettings)e.colors[0]===n&&(a=e.label);this.legendCollections.push(new li(a,n,r.legendShape,"TrendLine"===r.category?this.chart.series[r.sourceIndex].trendlines[r.index].visible:e.visible,i,"",r.marker.shape,r.marker.visible))}}else if(0===this.legendCollections.length&&t.rangeColorSettings.length>0){const e=t.rangeColorSettings[0].start.toString(),n=t.rangeColorSettings[t.rangeColorSettings.length-1].end.toString();this.legendCollections.push(new li(e,r.interior,"Rectangle",!0,i,"",r.marker.shape,r.marker.visible)),this.legendCollections.push(new li(n,r.interior,"Rectangle",!0,i,"",r.marker.shape,r.marker.visible))}}getLegendBounds(e,t,i){this.calculateLegendTitle(i,t),this.isTitle=!!i.title;const n=i.padding,s=i.titlePosition;let r=0,a=0;const o=this.arrowWidth,l=this.isVertical&&!i.enablePages?this.arrowHeight:0;let h=this.isTitle&&"Top"===s?this.legendTitleSize.height+this.fivePixel:0;h=this.isTitle&&this.isVertical&&"Top"!==s?this.legendTitleSize.height+this.fivePixel:h,this.isVertical?a=i.width?0:e.width/100*5:r=i.height?0:e.height/100*5,t.height+=r,t.width+=a;const c=i.shapeWidth,d=i.shapePadding;let p,g=0,u=0,m=0,f=0,y=0,x=0;this.maxItemHeight=Math.max(b("MeasureText",i.textStyle).height,i.shapeHeight);let C=!1;for(const v of this.legendCollections)ie.test(v.text)&&(v.text=Lt(v.text,ie)),ne.test(v.text)&&(v.text=Lt(v.text,ne)),p={fill:v.fill,text:v.text,shape:v.shape,markerShape:v.markerShape,name:"legendRender",cancel:!1},this.chart.trigger("legendRender",p),v.render=!p.cancel,v.text=p.text,v.fill=p.fill,v.shape=p.shape,v.markerShape=p.markerShape,v.textSize=b(v.text,i.textStyle),v.render&&(C=!0,m=c+d+v.textSize.width+n,u+=m,i.enablePages||this.isVertical||(x=this.isTitle&&"Top"!==s?this.legendTitleSize.width+this.fivePixel:0,x+=o),(t.width<n+u+x||this.isVertical)&&(g=Math.max(g,u+n+x-(this.isVertical?0:m)),0===y&&m!==u&&(y=1),u=this.isVertical?0:m,y++,f=y*(this.maxItemHeight+n)+n+h+l));f=Math.max(f,this.maxItemHeight+n+n+h),this.isPaging=t.height<f,this.isPaging&&!i.enablePages&&(f=this.isVertical?f:this.maxItemHeight+n+n+("Top"===s?h:0)),this.totalPages=y,this.isPaging||this.isVertical||(u+=this.isTitle&&"Top"!==s?this.fivePixel+this.legendTitleSize.width+this.fivePixel:0),C?this.setBounds(Math.max(u+n,g),f,i,t):this.setBounds(0,0,i,t)}getRenderPoint(e,t,i,n,s,r,a){const o=this.legend.padding,l=n.location.x+i+n.textSize.width;l+(e.textSize.width+i)>s.x+s.width+this.legend.shapeWidth/2||this.isVertical?(e.location.x=t.x,e.location.y=r===a?n.location.y:n.location.y+this.maxItemHeight+o):(e.location.x=r===a?n.location.x:l,e.location.y=n.location.y),e.text=vt(+(this.legendBounds.x+this.legendBounds.width-(e.location.x+i-this.legend.shapeWidth/2)).toFixed(4),e.text,this.legend.textStyle)}LegendClick(e,t){const i=this.chart,n=i.visibleSeries["Series"===i.legendSettings.mode?e:0],s=this.legendCollections[e];if("Series"===i.legendSettings.mode){const r={legendText:s.text,legendShape:s.shape,chart:i.isBlazor?{}:i,series:n,points:n.points,name:"legendClick",cancel:!1};this.chart.trigger("legendClick",r),n.legendShape=r.legendShape,null!==n.fill&&(i.visibleSeries[e].interior=n.fill),i.legendSettings.toggleVisibility?("TrendLine"===n.category?i.series[n.sourceIndex].trendlines[n.index].visible=!i.series[n.sourceIndex].trendlines[n.index].visible:(n.chart.isProtectedOnChange=!0,this.changeSeriesVisiblity(n,n.visible)),s.visible="TrendLine"===n.category?i.series[n.sourceIndex].trendlines[n.index].visible:n.visible,this.refreshLegendToggle(i,n)):i.selectionModule?i.selectionModule.legendSelection(i,e,t):i.highlightModule&&i.highlightModule.legendSelection(i,e,t),n.chart.isProtectedOnChange=!1}else if("Point"===i.legendSettings.mode){const t=n.points[e];this.chart.trigger("legendClick",{legendText:s.text,legendShape:s.shape,chart:i.isBlazor?{}:i,series:n,points:[t],name:"legendClick",cancel:!1}),i.legendSettings.toggleVisibility&&(t.visible=!t.visible,this.legendCollections[e].visible=t.visible,this.refreshLegendToggle(i,n))}else if("Range"===i.legendSettings.mode){const t=[],r=this.legendCollections[e];for(const e of n.points)r.fill===(e.interior||n.interior)&&t.push(e);if(this.chart.trigger("legendClick",{legendText:s.text,legendShape:s.shape,chart:i.isBlazor?{}:i,series:n,points:t,name:"legendClick",cancel:!1}),i.legendSettings.toggleVisibility){r.visible=!r.visible;for(const e of t)e.visible=!e.visible;this.refreshLegendToggle(i,n)}}}refreshLegendToggle(e,t){let i=[];if(e.selectionModule&&(i=Object(r.L)([],e.selectionModule.selectedDataIndexes,null,!0)),e.svgObject.childNodes.length>0&&!e.enableAnimation&&!e.enableCanvas){for(;e.svgObject.lastChild;)e.svgObject.removeChild(e.svgObject.lastChild);Object(r.kb)(e.svgObject)}e.animateSeries=!1,e.redraw=e.enableAnimation,e.rotatedDataLabelCollections=[],Oe(I(e.element.id+"_Secondary_Element").querySelectorAll(".ejSVGTooltip")[0]),Tt(e),this.redrawSeriesElements(t,e),e.removeSvg(),e.refreshAxis(),t.refreshAxisLabel(),this.refreshSeries(e.visibleSeries),e.markerRender.removeHighlightedMarker(),e.refreshBound(),e.trigger("loaded",{chart:e}),i.length>0&&(e.selectionModule.selectedDataIndexes=i,e.selectionModule.redrawSelection(e,e.selectionMode)),e.highlightModule&&"None"!==e.highlightMode&&e.highlightModule.redrawSelection(e,e.highlightMode),e.redraw=!1}changeSeriesVisiblity(e,t){e.visible=!t,this.isSecondaryAxis(e.xAxis)&&(e.xAxis.internalVisibility=e.xAxis.series.some(e=>e.visible)),this.isSecondaryAxis(e.yAxis)&&(e.yAxis.internalVisibility=e.yAxis.series.some(e=>e.visible))}isSecondaryAxis(e){return this.chart.axes.indexOf(e)>-1}redrawSeriesElements(e,t){if(!t.redraw)return null;Oe(t.element.id+"_Series_"+(void 0===e.index?e.category:e.index)+"_DataLabelCollections")}refreshSeries(e){for(const t of e)t.position=void 0}click(e){if(!this.chart.legendSettings.visible)return;const t=this.chart.mouseX,i=this.chart.mouseY;let n=[];const s=e.target.id,r=[this.legendID+"_text_",this.legendID+"_shape_marker_",this.legendID+"_shape_"];let a;for(const o of r)if(s.indexOf(o)>-1){a=parseInt(s.split(o)[1],10),this.LegendClick(a,e);break}s.indexOf(this.legendID+"_pageup")>-1?this.changePage(e,!0):s.indexOf(this.legendID+"_pagedown")>-1&&this.changePage(e,!1),this.chart.enableCanvas&&this.pagingRegions.length&&this.checkWithinBounds(t,i),n=this.legendRegions.filter(e=>Ve(t,i+(this.isPaging?(this.currentPageNumber-1)*this.translatePage(null,1,2):0),e.rect)),n.length&&this.chart.enableCanvas&&this.LegendClick(n[0].index,e)}checkWithinBounds(e,t){const i=this.chart.renderer,n=this.legendBounds,s=this.chart.legendSettings.border.width,r=new C(n.x,n.y,n.width,n.height);return r.x=r.x-s/2,r.y=r.y-s/2,r.width=r.width+s,r.height=r.height+s,Ve(e,t,this.pagingRegions[0])?(--this.currentPageNumber>0?(this.legendRegions=[],i.clearRect(r),i.canvasClip(new Dt("legendClipPath","transparent",{width:0,color:""},null,r)),this.renderLegend(this.chart,this.legend,n),i.canvasRestore()):++this.currentPageNumber,null):Ve(e,t,this.pagingRegions[1])?(++this.currentPageNumber>0&&this.currentPageNumber<=this.totalNoOfPages?(this.legendRegions=[],i.clearRect(r),i.canvasClip(new Dt("legendClipPath","transpaent",{width:0,color:""},null,r)),this.renderLegend(this.chart,this.legend,n),i.canvasRestore()):--this.currentPageNumber,null):void 0}getModuleName(){return"Legend"}destroy(){this.removeEventListener()}},g.c,class{constructor(e){this.errorHeight=0,this.chart=e}initPrivateVariables(e,t){let i="",n="";const s=e.chart.renderer,r=void 0===e.index?e.category:e.index;"Cartesian"===e.chart.chartAreaType&&(i="translate("+e.clipRect.x+","+e.clipRect.y+")",n="url(#"+this.chart.element.id+"_ChartSeriesClipRect_"+r+")"),t.dataLabel.visible&&(e.shapeElement=s.createGroup({id:this.chart.element.id+"ShapeGroup"+r,transform:i,"clip-path":"url(#"+this.chart.element.id+"_ChartSeriesClipRect_"+r+")"}),e.textElement=s.createGroup({id:this.chart.element.id+"TextGroup"+r,transform:i,"clip-path":n})),this.markerHeight="Scatter"===e.type||t.visible?t.height/2:0,this.commonId=this.chart.element.id+"_Series_"+r+"_Point_",this.calculateErrorHeight(e,e.marker.dataLabel.position),this.chartBackground="transparent"===this.chart.chartArea.background?this.chart.background||this.chart.themeStyle.background:this.chart.chartArea.background}calculateErrorHeight(e,t){if(!e.errorBar.visible)return null;if(e.errorBar.visible&&"PolarRadar"!==this.chart.chartAreaType){const i=e.errorBar.direction,n=this.chart.errorBarModule.positiveHeight,s=this.chart.errorBarModule.negativeHeight;this.isRectSeries(e)?("Top"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Minus"===i?s:0),"Outer"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Plus"===i?n:0)):("Top"!==t&&"Outer"!==t&&"Auto"!==t||(this.errorHeight="Both"!==i&&"Plus"!==i||e.chart.isTransposed?0:n),"Bottom"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Minus"===i?s:0))}else this.errorHeight=0}isRectSeries(e){return e.isRectSeries||"RangeArea"===e.type||"SplineRangeArea"===e.type}render(e,t,i){let n;this.initPrivateVariables(e,e.marker);let s,a,o,l,h,c,d,p={x:0,y:0};this.inverted=t.requireInvertedAxis,this.yAxisInversed=e.yAxis.isInversed;const g=t.redraw;let u=!1,m=[];const f=t.element.id+"_Series_"+(void 0===e.index?e.category:e.index)+"_DataLabelCollections",y=Object(r.G)("div",{id:f}),x=Ie(e);let v,S,I;for(let O=0;O<x.length;O++){if(v=x[O],!i.showZero&&(0!==v.y||0===v.y&&"Zero"===e.emptyPointSettings.mode))return null;this.margin=i.margin;let f,R,A,k,E,L=[],T=!0;const j=e.clipRect;let D;u=!1,c=d=i.angle,l={width:i.border.width,color:i.border.color};const M=Object(r.L)({},Object(r.X)("properties",i.font),null,!0);if(v.symbolLocations.length&&v.symbolLocations[0]||"BoxAndWhisker"===e.type&&v.regions.length){L=dt(v,e,t),f=L.length;for(let r=0;r<f;r++)if(o={cancel:!1,name:"textRender",series:e,point:v,text:L[r],border:l,color:i.fill,template:i.template,font:M,location:p,textSize:b(L[r],i.font)},t.trigger("textRender",o),!o.cancel)if(this.fontBackground=o.color,this.isDataLabelShape(o),this.markerHeight="Bubble"===e.type?v.regions[0].height/2:this.markerHeight,null!==o.template)this.createDataLabelTemplate(y,e,i,v,o,r,g);else{if(h=b(o.text,i.font),n=this.calculateTextPosition(v,e,h,i,r),"PolarRadar"===t.chartAreaType)for(const e of t.chartAxisLayoutPanel.visibleAxisLabelRect)if(ut(new C(n.x,n.y,n.width,n.height),e)){T=!1;break}const l=new C(n.x+j.x,n.y+j.y,n.width,n.height);if(i.enableRotation){const e=this.getRectanglePoints(n);if(S=n.x+n.width/2,I=n.y+n.height/2,m=Pe(e,S,I,c),u=this.isDataLabelOverlapWithChartBound(m,t,j),!u){this.chart.rotatedDataLabelCollections.push(m);const e=this.chart.rotatedDataLabelCollections.length-1;for(let t=e;t>=0;t--)if(this.chart.rotatedDataLabelCollections[e]&&this.chart.rotatedDataLabelCollections[t-1]&&Ne(this.chart.rotatedDataLabelCollections[e],this.chart.rotatedDataLabelCollections[t-1])){u=!0,this.chart.rotatedDataLabelCollections[e]=null;break}}}else u=gt(n,t.dataLabelCollections,j);u&&"None"!==i.labelIntersectAction||!T||(t.dataLabelCollections.push(l),this.isShape&&(D=t.renderer.drawRectangle(new Dt(this.commonId+v.index+"_TextShape_"+r,o.color,o.border,i.opacity,n,i.rx,i.ry),new Int32Array([j.x,j.y])),e.shapeElement&&e.shapeElement.appendChild(D)),s=yt(xt(this.fontBackground)),a=Math.round((299*s.r+587*s.g+114*s.b)/1e3),R=n.x+this.margin.left+h.width/2+p.x,A=n.y+this.margin.top+3*h.height/4+p.y,p={x:0,y:0},0!==c&&i.enableRotation?(k=S,E=I,d=c>360?c-360:c<-360?c+360:c):(d=0,k=n.x,E=n.y),It(t.renderer,new w(this.commonId+v.index+"_Text_"+r,R,A,"middle",o.text,"rotate("+d+","+k+","+E+")","auto",d),o.font,o.font.color||(a>=128||"Hilo"===e.type?"black":"white"),e.textElement,!1,g,!0,!1,e.chart.duration,e.clipRect,0,null,t.enableCanvas))}}}y.childElementCount&&(t.enableCanvas?nt(t.element.id+"_Secondary_Element").appendChild(y):ct(t.enableCanvas,nt(t.element.id+"_Secondary_Element"),y,t.redraw,!1,"x","y",null,"",!1,!1,null,t.duration))}getRectanglePoints(e){return[new Pt(e.x,e.y),new Pt(e.x+e.width,e.y),new Pt(e.x+e.width,e.y+e.height),new Pt(e.x,e.y+e.height)]}isDataLabelOverlapWithChartBound(e,t,i){for(let n=0;n<e.length;n++)if(!Ve(e[n].x+i.x,e[n].y+i.y,t.initialClipRect))return!0;return!1}createDataLabelTemplate(e,t,i,n,s,a,o){this.margin={left:0,right:0,bottom:0,top:0};const l=t.clipRect,h=at(Object(r.G)("div",{id:this.chart.element.id+"_Series_"+(void 0===t.index?t.category:t.index)+"_DataLabel_"+n.index+(a?"_"+a:""),styles:"position: absolute;background-color:"+s.color+";"+ot(i.font)+";border:"+s.border.width+"px solid "+s.border.color+";"}),n.index,s.template,this.chart,n,t,this.chart.element.id+"_DataLabel",a);this.calculateTemplateLabelSize(e,h,n,t,i,a,l,o)}calculateTemplateLabelSize(e,t,i,n,s,r,a,o,l){const h=lt(t,o,l),c=this.calculateTextPosition(i,n,{width:h.width,height:h.height},s,r);let d=!1;l&&(d=0===h.width||0===h.height),t.style.left=("PolarRadar"===this.chart.chartAreaType?0:n.clipRect.x)+c.x-0+"px",t.style.top=("PolarRadar"===this.chart.chartAreaType?0:n.clipRect.y)+c.y+0+"px";const p=yt(xt(this.fontBackground)),g=n.chart.requireInvertedAxis?n.xAxis:n.yAxis,u=n.chart.requireInvertedAxis?n.yAxis:n.xAxis;t.style.color=s.font.color||(Math.round((299*p.r+587*p.g+114*p.b)/1e3)>=128?"black":"white"),t.childElementCount&&!d&&(!gt(c,this.chart.dataLabelCollections,a)||"None"===s.labelIntersectAction)&&("XY"!==n.seriesType||void 0===i.yValue||Ee(i.yValue,n.yAxis.visibleRange)||n.type.indexOf("Stacking")>-1||n.type.indexOf("100")>-1&&Ee(n.stackedValues.endValues[i.index],n.yAxis.visibleRange))&&Ee(i.xValue,n.xAxis.visibleRange)&&parseFloat(t.style.top)>=g.rect.y&&parseFloat(t.style.left)>=u.rect.x&&parseFloat(t.style.top)<=g.rect.y+g.rect.height&&parseFloat(t.style.left)<=u.rect.x+u.rect.width&&(this.chart.dataLabelCollections.push(new C(c.x+a.x,c.y+a.y,c.width,c.height)),ct(this.chart.enableCanvas,e,t,o,!0,"left","top"),n.animation.enable&&this.chart.animateSeries&&!this.chart.enableCanvas?this.doDataLabelAnimation(n,t):this.chart.enableCanvas&&e.appendChild(t))}calculateTextPosition(e,t,i,n,s){let r,a=s>1&&"Candle"===t.type?e.regions[1]:e.regions[0];s>1&&"HiloOpenClose"===t.type&&(a=2===s?e.regions[1]:e.regions[2]),r=this.getLabelLocation(e,t,i,s);const o=t.clipRect;if(this.chart.requireInvertedAxis&&this.isRectSeries(t)&&"BoxAndWhisker"!==t.type){this.locationY=r.y;const o=i.width+this.borderWidth+this.margin.left+this.margin.right-5;r.x="Auto"===n.position?r.x:this.calculateAlignment(o,r.x,n.alignment,e.yValue<0),r.x=this.calculateRectPosition(r.x,a,e.yValue<0!==this.yAxisInversed,n.position,t,i,s,e)}else{this.locationX=r.x;const o=i.height+2*this.borderWidth+this.markerHeight+this.margin.bottom+this.margin.top+5;r.y="Auto"===n.position?r.y:this.calculateAlignment(o,r.y,n.alignment,!!this.isRectSeries(t)&&e.yValue<0),r.y=this.isRectSeries(t)&&"BoxAndWhisker"!==t.type?this.calculateRectPosition(r.y,a,e.yValue<0!==this.yAxisInversed,n.position,t,i,s,e):this.calculatePathPosition(r.y,n.position,t,e,i,s),this.isRectSeries(t)&&"PolarRadar"===this.chart.chartAreaType&&(r=this.calculatePolarRectPosition(r,n.position,t,e,i,s,n.alignment,o))}const l=mt(r,i,this.margin);return!0===n.enableRotation&&0!==n.angle||l.y>o.y+o.height||l.x>o.x+o.width||l.x+l.width<0||l.y+l.height<0||(l.x=l.x<0?5:l.x,l.y=l.y<0&&"None"!==n.labelIntersectAction?5:l.y,l.x-=l.x+l.width>o.x+o.width?l.x+l.width-(o.x+o.width)+5:0,l.y-=l.y+l.height>o.y+o.height?l.y+l.height-(o.y+o.height)+5:0,this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground),l}calculatePolarRectPosition(e,t,i,n,s,r,a,o){let l;const h=this.chart.availableSize.width,c="Center"===a?0:"Far"===a?1:-1,d=n.regionData.startAngle-.5*Math.PI+(n.regionData.endAngle-n.regionData.startAngle)/2;return l=0===r?n.regionData.radius<n.regionData.innerRadius?n.regionData.innerRadius:n.regionData.radius:n.regionData.radius>n.regionData.innerRadius?n.regionData.innerRadius:n.regionData.radius,this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground,i.drawType.indexOf("Stacking")>-1?t="Outer"===t?"Top":t:i.drawType.indexOf("Range")>-1&&(t="Outer"===t||"Top"===t?t:"Auto"),"Outer"===t?l=0===r?l+10+this.markerHeight:l-10-this.markerHeight:"Middle"===t?(l=l/2+5,"StackingColumn"===i.drawType&&(l=n.regionData.innerRadius+(n.regionData.radius-n.regionData.innerRadius)/2+5-s.height/2)):"Top"===t?l=0===r?l-10-this.markerHeight:l+10+this.markerHeight:"Bottom"===t?(l=10,l+="StackingColumn"===i.drawType?n.regionData.innerRadius+this.markerHeight:0):l=0===r?l>=i.chart.radius?l-5:"StackingColumn"===i.drawType?l-10:l+10:l>=i.chart.radius?l+5:l-10,l+=o*c,e.x=i.clipRect.width/2+i.clipRect.x+l*Math.cos(d),"StackingColumn"===i.drawType?e.x=e.x<h/2?e.x+s.width/2:e.x>h/2?e.x-s.width/2:e.x:"Column"===i.drawType&&(e.x=e.x<h/2?e.x-s.width/2:e.x>h/2?e.x+s.width/2:e.x),e.y=i.clipRect.height/2+i.clipRect.y+l*Math.sin(d),e}getLabelLocation(e,t,i,n){let s=new Pt(0,0),r="Candle"===t.type&&n>1?e.regions[1]:e.regions[0];"HiloOpenClose"===t.type&&(r=2===n?e.regions[1]:e.regions[2]);const a=t.xAxis,o=t.yAxis,l=t.chart.requireInvertedAxis;if("BoxAndWhisker"===t.type){switch(this.markerHeight=0,n){case 0:s=ht(e.xValue,e.median,a,o,l);break;case 1:s=ht(e.xValue,e.maximum,a,o,l);break;case 2:s=ht(e.xValue,e.minimum,a,o,l);break;case 3:s=ht(e.xValue,e.upperQuartile,a,o,l);break;case 4:s=ht(e.xValue,e.lowerQuartile,a,o,l);break;default:s=ht(e.xValue,e.outliers[n-5],a,o,l),this.markerHeight=t.marker.height/2}l?s.y=e.regions[0].y+e.regions[0].height/2:s.x=e.regions[0].x+e.regions[0].width/2}else s=0===n||1===n?new Pt(e.symbolLocations[0].x,e.symbolLocations[0].y):2!==n&&3!==n||"Candle"!==t.type?l?{x:r.x+r.width/2,y:r.y}:{x:r.x+r.width,y:r.y+r.height/2}:new Pt(e.symbolLocations[1].x,e.symbolLocations[1].y);return n>1&&"HiloOpenClose"===t.type&&(t.chart.requireInvertedAxis?s.y=r.y+r.height/2+2*(2===n?1:-1):s.x=r.x+r.width/2+2*(2===n?1:-1)),s}calculateRectPosition(e,t,i,n,s,r,a,o){if("PolarRadar"===s.chart.chartAreaType)return null;const l=this.margin;let h=this.borderWidth+(this.inverted?r.width:r.height)/2+5;switch("StackingColumn100"===s.type||"StackingBar100"===s.type?n="Outer"===n?"Top":n:s.type.indexOf("Range")>-1?n="Outer"===n||"Top"===n?n:"Auto":"Waterfall"===s.type&&(n="Auto"===n?"Middle":n),n){case"Bottom":e=this.inverted?i?e+t.width-h-l.left:e-t.width+h+l.right:i?e-t.height+h+l.top:e+t.height-h-l.bottom;break;case"Middle":e=e=this.inverted?i?e+t.width/2:e-t.width/2:i?e-t.height/2:e+t.height/2;break;case"Auto":e=this.calculateRectActualPosition(e,t,i,s,r,a,o);break;default:h+=this.errorHeight,e=this.calculateTopAndOuterPosition(e,t,n,s,a,h,i)}this.fontBackground=(this.inverted?e<t.x||e>t.x+t.width:e<t.y||e>t.y+t.height)?"transparent"===this.fontBackground?this.chartBackground:this.fontBackground:"transparent"===this.fontBackground?o.color||s.interior:this.fontBackground;const c=s.chart.series.length;if("Outer"===n&&s.type.indexOf("Stacking")>-1&&c-1>s.index){let e,t;for(let i=s.index+1;i<c;i++)if(e=s.chart.series[i],t=e.points[o.index],e.type.indexOf("Stacking")>-1&&-1===e.type.indexOf("100")){this.fontBackground=t&&(t.yValue<0&&o.yValue<0||t.yValue>0&&o.yValue>0)?t?t.color:e.interior:this.fontBackground;break}}return e}calculatePathPosition(e,t,i,n,s,r){switch(i.type.indexOf("Area")>-1&&"RangeArea"!==i.type&&"SplineRangeArea"!==i.type&&this.yAxisInversed&&"Auto"!==i.marker.dataLabel.position&&(t="Top"===t?"Bottom":"Bottom"===t?"Top":t),this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground,t){case"Top":case"Outer":e=e-this.markerHeight-this.borderWidth-s.height/2-this.margin.bottom-5-this.errorHeight;break;case"Bottom":e=e+this.markerHeight+this.borderWidth+s.height/2+this.margin.top+5+this.errorHeight;break;case"Auto":e=this.calculatePathActualPosition(e,this.markerHeight,i,n,s,r)}return e}isDataLabelShape(e){this.isShape="transparent"!==e.color||e.border.width>0,this.borderWidth=e.border.width,this.isShape||(this.margin={left:0,right:0,bottom:0,top:0})}calculateRectActualPosition(e,t,i,n,s,r,a){let o,l,h=!0,c=0;const d=this.chart.dataLabelCollections,p=-1!==n.type.indexOf("Range")||"Hilo"===n.type?2:4;for(;h&&c<p;){let p=this.getPosition(c);n.type.indexOf("Stacking")>-1&&"Outer"===p&&(p="Top",c++),o=this.calculateRectPosition(e,t,i,p,n,s,r,a),this.inverted?(l=mt(new Pt(o,this.locationY),s,this.margin),h=l.x<0||gt(l,d,n.clipRect)||l.x+l.width>n.clipRect.width):(l=mt(new Pt(this.locationX,o),s,this.margin),h=l.y<0||gt(l,d,n.clipRect)||l.y>n.clipRect.height),c++}return o}calculateAlignment(e,t,i,n){switch(i){case"Far":t=this.inverted?n?t-e:t+e:n?t+e:t-e;break;case"Near":t=this.inverted?n?t+e:t-e:n?t-e:t+e;break;case"Center":t=t}return t}calculateTopAndOuterPosition(e,t,i,n,s,r,a){const o=this.margin;let l;switch(n.type){case"RangeColumn":case"RangeArea":case"SplineRangeArea":case"Hilo":l=0===s&&!this.yAxisInversed||1===s&&this.yAxisInversed,e=this.updateLabelLocation(i,e,r,o,t,l);break;case"Candle":l=(0===s||2===s)&&!this.yAxisInversed||(1===s||3===s)&&this.yAxisInversed,e=this.updateLabelLocation(i,e,r,o,t,l,s>1);break;case"HiloOpenClose":s<=1?(l=0===s&&!this.yAxisInversed||1===s&&this.yAxisInversed,e=this.updateLabelLocation(i,e,r,o,t,l)):e=this.yAxisInversed?this.inverted?e-r-o.right:e+r+o.top:this.inverted?e+r+o.left:e-r-o.bottom;break;default:e=a&&"Top"===i||!a&&"Outer"===i?this.inverted?e+r+o.left+this.markerHeight:e-r-o.bottom-this.markerHeight:this.inverted?e-r-o.right-this.markerHeight:e+r+o.top+this.markerHeight}return e}updateLabelLocation(e,t,i,n,s,r,a=!1){return this.inverted?r?"Outer"!==e||a?t-i-n.right-this.markerHeight:t+i+n.left+this.markerHeight:"Outer"!==e||a?t-s.width+i+n.left+this.markerHeight:t-s.width-i-n.right-this.markerHeight:r?"Outer"!==e||a?t+i+n.top+this.markerHeight:t-i-n.bottom-this.markerHeight:"Outer"!==e||a?t+s.height-i-n.bottom-this.markerHeight:t+s.height+i+n.top+this.markerHeight}calculatePathActualPosition(e,t,i,n,s,r){const a=i.points,o=n.index,l=a[o].yValue;let h;const c=a.length-1>o?a[o+1]:null,d=o>0?a[o-1]:null;let p,g,u,m,f=!0;const b=this.chart.dataLabelCollections;if("Bubble"===i.type)h="Top";else if(i.type.indexOf("Step")>-1)h="Top",o&&(h=d&&d.visible&&l>d.yValue===this.yAxisInversed&&l!==d.yValue?"Bottom":"Top");else if("BoxAndWhisker"===i.type)1===r||3===r||r>4?h=i.yAxis.isInversed?"Bottom":"Top":2===r||4===r?h=i.yAxis.isInversed?"Top":"Bottom":(f=!1,h="Middle",p=this.calculatePathPosition(e,h,i,n,s,r));else if(0===o)h=!c||!c.visible||l>c.yValue||l<c.yValue&&this.yAxisInversed?"Top":"Bottom";else if(o===a.length-1)h=!d||!d.visible||l>d.yValue||l<d.yValue&&this.yAxisInversed?"Top":"Bottom";else if(c.visible||d&&d.visible)if(c.visible&&d){const e=(c.yValue-d.yValue)/2,t=e*o+(c.yValue-e*(o+1));h=this.yAxisInversed?t<l?"Bottom":"Top":t<l?"Top":"Bottom"}else h=c.yValue>l||d&&d.yValue>l?"Bottom":"Top";else h="Top";for(u="Bottom"===h,m=["Outer","Top","Bottom","Middle","Auto"].indexOf(h);f&&m<4;)p=this.calculatePathPosition(e,this.getPosition(m),i,n,s,r),g=mt(new Pt(this.locationX,p),s,this.margin),f=g.y<0||gt(g,b,i.clipRect)||g.y+g.height>i.clipRect.height,m=u?m-1:m+1,u=!1;return p}doDataLabelAnimation(e,t){const i=e.shapeElement.childNodes,n=e.textElement.childNodes,s=e.animation.delay+e.animation.duration,r=e.chart.animated?e.chart.duration:200;let a;const o=t?1:n.length;let l;for(let h=0;h<o;h++)l=n[h],t?(t.style.visibility="hidden",tt(t,s,r,"ZoomIn")):(a=new Pt(+l.getAttribute("x")+ +l.getAttribute("width")/2,+l.getAttribute("y")+ +l.getAttribute("height")/2),Ye(l,s,r,e,null,a,!0),i[h]&&(l=i[h],a=new Pt(+l.getAttribute("x")+ +l.getAttribute("width")/2,+l.getAttribute("y")+ +l.getAttribute("height")/2),Ye(l,s,r,e,null,a,!0)))}getPosition(e){return["Outer","Top","Bottom","Middle","Auto"][e]}getModuleName(){return"DataLabel"}destroy(){}}),Di.Inject(Ti,class extends vi{constructor(e){super(e),this.accumulation=e,this.addEventListener()}addEventListener(){this.accumulation.isDestroyed||(this.accumulation.on(r.d.isPointer?"pointerleave":"mouseleave",this.mouseLeaveHandler,this),this.accumulation.on(r.d.touchMoveEvent,this.mouseMoveHandler,this),this.accumulation.on(r.d.touchEndEvent,this.mouseUpHandler,this))}mouseLeaveHandler(e){this.removeTooltip(this.accumulation.tooltip.fadeOutDuration)}mouseUpHandler(e){let t=this.accumulation;t.tooltip.enable&&t.isTouch&&Ve(t.mouseX,t.mouseY,t.initialClipRect)&&(this.tooltip(e),this.removeTooltip(2e3))}mouseMoveHandler(e){let t=this.accumulation;t.tooltip.enable&&Ve(t.mouseX,t.mouseY,t.initialClipRect)&&this.tooltip(e)}tooltip(e){let t=this.getElement(this.element.id+"_tooltip_svg"),i=t&&parseInt(t.getAttribute("opacity"),10)>0,n=this.getTooltipElement(i);this.renderSeriesTooltip(e,this.accumulation,!i,n)}renderSeriesTooltip(e,t,i,n){let s=this.getPieData(e,t,t.mouseX,t.mouseY);if(this.currentPoints=[],!s.point||this.previousPoints[0]&&this.previousPoints[0].point===s.point)!s.point&&this.isRemove&&(this.removeTooltip(this.accumulation.tooltip.fadeOutDuration),this.isRemove=!1);else{if(this.previousPoints[0]&&s.point.index===this.previousPoints[0].point.index&&s.series.index===this.previousPoints[0].series.index)return null;this.pushData(s,i,n,!1)&&this.triggerTooltipRender(s,i,this.getTooltipText(s,t.tooltip),this.findHeader(s))}}triggerTooltipRender(e,t,i,n,s=!0){let a={cancel:!1,name:"tooltipRender",text:i,point:e.point,textStyle:this.textStyle,series:this.accumulation.isBlazor?{}:e.series,headerText:n,data:{pointX:e.point.x,pointY:e.point.y,seriesIndex:e.series.index,pointIndex:e.point.index,pointText:e.point.text,seriesName:e.series.name}},o=i=>{i.cancel?(this.removeHighlight(),Object(r.kb)(this.getElement(this.element.id+"_tooltip"))):(this.formattedText=this.formattedText.concat(i.text),this.text=this.formattedText,this.headerText=i.headerText,this.createTooltip(this.chart,t,e.point.symbolLocation,e.series.clipRect,e.point,["Circle"],0,this.chart.initialClipRect,null,e.point,this.accumulation.tooltip.template?i.template:"")),this.isRemove=!0};o.bind(this,e),this.chart.trigger("tooltipRender",a,o)}getPieData(e,t,i,n){let s=ze(e.target.id,!0);if(!isNaN(s.series)){let e=s.series,i=s.point;if(!(Object(r.Z)(e)||isNaN(e)||Object(r.Z)(i)||isNaN(i))){let n=this.getSeriesFromIndex(e,t.visibleSeries);if(n.enableTooltip)return new _t(n.points[i],n)}}return new _t(null,null)}getSeriesFromIndex(e,t){return t[0]}getTooltipText(e,t){let i=this.accumulation.useGroupingSeparator?"${point.x} : <b>${point.separatorY}</b>":"${point.x} : <b>${point.y}</b>";return i=t.format?t.format:i,this.parseTemplate(e.point,e.series,i)}findHeader(e){return""===this.header?"":(this.header=this.parseTemplate(e.point,e.series,this.header),""!==this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim()?this.header:"")}parseTemplate(e,t,i){let n,s;for(let r of Object.keys(e))n=new RegExp("${point."+r+"}","gm"),i=i.replace(n.source,e[r]);for(let r of Object.keys(Object.getPrototypeOf(t)))n=new RegExp("${series."+r+"}","gm"),s=t[r],i=i.replace(n.source,s);return i}getModuleName(){return"AccumulationTooltip"}destroy(e){}},class extends Ei{constructor(e){if(super(e),this.rightSideRenderingPoints=[],this.leftSideRenderingPoints=[],this.id=e.element.id+"_datalabel_Series_",e.title){const t=b(e.title,e.titleStyle);this.titleRect=new C(e.availableSize.width/2-t.width/2,e.margin.top,t.width,t.height)}}getDataLabelPosition(e,t,i,n){const s=this.isCircular()?this.isVariousRadius()?this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],e):this.accumulation.pieSeriesModule.labelRadius:this.getLabelDistance(e,t);this.getLabelRegion(e,t.position,i,s,this.marginValue),e.labelAngle=e.midAngle,e.labelPosition=t.position,this.accumulation.enableSmartLabels&&this.getSmartLabel(e,t,i,n)}getLabelRegion(e,t,i,n,s,r=0){const a=r||e.midAngle,o=Me(a,n,this.isCircular()?this.center:this.getLabelLocation(e,t));o.y="Inside"===t?o.y-i.height/2:o.y,o.x="Inside"===t?o.x-i.width/2:o.x,e.labelRegion=new C(o.x,o.y,i.width+2*s,i.height+2*s),"Outside"===t&&(e.labelRegion.y-=e.labelRegion.height/2,a>=90&&a<=270?e.labelRegion.x-=e.labelRegion.width+10:e.labelRegion.x+=10)}getSmartLabel(e,t,i,n){const s=this.isCircular();let r=s?this.radius:this.getLabelDistance(e,t);r+=St(s?t.connectorStyle.length||"4%":"0px",r);let a=this.findPreviousPoint(n,e.index,e.labelPosition);var o,l;if("Inside"===t.position?(e.labelRegion.height-=4,e.labelRegion.width-=4,(a&&a.labelRegion&&(ut(e.labelRegion,a.labelRegion)||this.isOverlapping(e,n))||!s&&!((o=e.region).x<=(l=e.labelRegion).x&&o.x+o.width>=l.x+l.width&&o.y<=l.y&&o.height+o.y>=l.y+l.height))&&(e.labelPosition="Outside",s||(r=this.getLabelDistance(e,t)),this.getLabelRegion(e,e.labelPosition,i,r,this.marginValue),a=this.findPreviousPoint(n,e.index,e.labelPosition),a&&(ut(e.labelRegion,a.labelRegion)||this.isConnectorLineOverlapping(e,a))&&this.setOuterSmartLabel(a,e,t.border.width,r,i,this.marginValue))):a&&a.labelRegion&&(ut(e.labelRegion,a.labelRegion)||this.isOverlapping(e,n)||this.isConnectorLineOverlapping(e,a))&&this.setOuterSmartLabel(a,e,t.border.width,r,i,this.marginValue),this.isOverlapping(e,n)&&("Pyramid"===this.accumulation.type||"Funnel"===this.accumulation.type)){const r="OutsideLeft",o=10,l=e.midAngle||0,h=s?this.radius:this.getLabelDistance(e,t),c=Me(l,-h,this.isCircular()?this.center:this.getLabelLocation(e,r));e.labelRegion=new C(c.x,c.y,i.width+2*this.marginValue,i.height+2*this.marginValue),e.labelRegion.y-=e.labelRegion.height/2,e.labelRegion.x=e.labelRegion.x-o-e.labelRegion.width,a&&a.labelRegion&&(ut(e.labelRegion,a.labelRegion)||this.isOverlapping(e,n)||this.isConnectorLineOverlapping(e,a))&&this.setOuterSmartLabel(a,e,t.border.width,h,i,this.marginValue)}}move(e,t,i,n){if(e.target.textContent.indexOf("...")>-1){const s=e.target.id.split(this.id);if(2===s.length){const e=parseInt(s[1].split("_text_")[0],10),r=parseInt(s[1].split("_text_")[1],10);if(!isNaN(e)&&!isNaN(r)){n&&Oe(this.accumulation.element.id+"_EJ2_Datalabel_Tooltip");const s=function(e,t){for(let i of t)if(e===i.index)return i;return t[0]}(e,this.accumulation.visibleSeries).points[r];Ae(s.text||s.y.toString(),t,i,this.areaRect.width,this.accumulation.element.id+"_EJ2_Datalabel_Tooltip",nt(this.accumulation.element.id+"_Secondary_Element"))}}}else Oe(this.accumulation.element.id+"_EJ2_Datalabel_Tooltip");n&&(clearTimeout(this.clearTooltip),this.clearTooltip=+setTimeout(()=>{Oe(this.accumulation.element.id+"_EJ2_Datalabel_Tooltip")},1e3))}findPreviousPoint(e,t,i){let n=e[0];for(let s=t-1;s>=0;s--)if(n=e[s],n.visible&&n.labelVisible&&n.labelRegion&&n.labelPosition===i)return n;return null}isOverlapping(e,t){for(let i=e.index-1;i>=0;i--)if(t[i].visible&&t[i].labelVisible&&t[i].labelRegion&&e.labelRegion&&e.labelVisible&&ut(e.labelRegion,t[i].labelRegion))return!0;return!1}textTrimming(e,t,i,n){if(ut(e.labelRegion,t)){let s=e.labelRegion.width;"Right"===n?s=t.x-e.labelRegion.x:"Left"===n?(s=e.labelRegion.x-(t.x+t.width),s<0&&(s+=e.labelRegion.width,e.labelRegion.x=t.x+t.width)):"InsideRight"===n?s=t.x+t.width-e.labelRegion.x:"InsideLeft"===n?(s=e.labelRegion.x+e.labelRegion.width-t.x,s<e.labelRegion.width&&(e.labelRegion.x=t.x)):this.setPointVisibileFalse(e),e.labelVisible&&e.labelRegion&&(s<e.labelRegion.width&&(e.label=vt(s-2*this.marginValue,e.label,i),e.labelRegion.width=s),3===e.label.length&&e.label.indexOf("...")>-1&&this.setPointVisibileFalse(e))}}setPointVisibileFalse(e){e.labelVisible=!1,e.labelRegion=null}setPointVisibleTrue(e){e.labelVisible=!0}setOuterSmartLabel(e,t,i,n,s,r){if(this.isCircular()){let a=this.getOverlappedAngle(e.labelRegion,t.labelRegion,t.midAngle,2*i);for(this.getLabelRegion(t,"Outside",s,n,r,a),a>t.endAngle&&(a=t.midAngle),t.labelAngle=a;t.labelVisible&&(ut(e.labelRegion,t.labelRegion)||a<=e.labelAngle||this.isConnectorLineOverlapping(t,e))&&!(a>t.endAngle);)t.labelAngle=a,this.getLabelRegion(t,"Outside",s,n,r,a),a+=.1}else this.setSmartLabelForSegments(t,e)}setSmartLabelForSegments(e,t){const i=e.labelRegion,n="Funnel"===this.accumulation.type?t.labelRegion.y-(i.y+i.height):e.labelRegion.y-(t.labelRegion.y+t.labelRegion.height);n<0&&(e.labelRegion.y+="Funnel"===this.accumulation.type?n:-n)}isConnectorLineOverlapping(e,t){let i;!this.isCircular()&&e.labelRegion.x<e.region.x&&(i="outsideLeft");const n=this.getLabelLocation(e,i),s=new Pt(0,0);this.getEdgeOfLabel(e.labelRegion,e.labelAngle,s,0,e);const r=this.getLabelLocation(t),a=new Pt(0,0);return this.getEdgeOfLabel(t.labelRegion,t.labelAngle,a,0,e),this.isLineRectangleIntersect(n,s,e.labelRegion)||this.isLineRectangleIntersect(n,s,t.labelRegion)||this.isLineRectangleIntersect(r,a,e.labelRegion)}isLineRectangleIntersect(e,t,i){const n=[new Pt(Math.round(i.x),Math.round(i.y)),new Pt(Math.round(i.x+i.width),Math.round(i.y)),new Pt(Math.round(i.x+i.width),Math.round(i.y+i.height)),new Pt(Math.round(i.x),Math.round(i.y+i.height))];e.x=Math.round(e.x),e.y=Math.round(e.y),t.x=Math.round(t.x),t.y=Math.round(t.y);for(let s=0;s<n.length;s++)if(this.isLinesIntersect(e,t,n[s],n[(s+1)%n.length]))return!0;return!1}isLinesIntersect(e,t,i,n){const s=t.y-e.y,r=e.x-t.x,a=s*e.x+r*e.y,o=n.y-i.y,l=i.x-n.x,h=o*i.x+l*i.y,c=s*l-o*r;if(0!==c){const d=(l*a-r*h)/c,p=(s*h-o*a)/c;let g=Math.min(e.x,t.x)<=d&&d<=Math.max(e.x,t.x);return g=g&&Math.min(e.y,t.y)<=p&&p<=Math.max(e.y,t.y),g=g&&Math.min(i.x,n.x)<=d&&d<=Math.max(i.x,n.x),g=g&&Math.min(i.y,n.y)<=p&&p<=Math.max(i.y,n.y),g}return!1}getOverlappedAngle(e,t,i,n){let s=e.x;return i>=90&&i<=270?(t.y=e.y-(n+t.height/2),s=e.x+e.width):t.y=e.y+e.height+n,function(e,t){let i=Math.atan2(t.y-e.y,t.x-e.x);return i=i<0?6.283+i:i,i*(180/Math.PI)}(this.center,new Pt(s,t.y))}getConnectorPath(e,t,i,n=0){const s=i.connectorStyle,r=this.isCircular()?this.isVariousRadius()?this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],t):this.labelRadius:this.getLabelDistance(t,i),a=this.getConnectorStartPoint(t,s),o=this.accumulation.enableSmartLabels?t.midAngle:n||t.midAngle;let l=new Pt(0,0);const h=this.getEdgeOfLabel(e,o,l,s.width,t);if("Curve"===s.type){if(this.isCircular()){const e=r-(this.isVariousRadius()?St(t.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius);return t.isLabelUpdated?l=this.getPerpendicularDistance(a,t):(l=Me(o,r-e/2,this.center),"Outside"===t.labelPosition&&"Inside"===i.position&&(l=Me(o,r-1.25*e,this.center))),"M "+a.x+" "+a.y+" Q "+l.x+" "+l.y+" "+h.x+" "+h.y}return this.getPolyLinePath(a,h)}return"M "+a.x+" "+a.y+" L "+l.x+" "+l.y+" L "+h.x+" "+h.y}getPolyLinePath(e,t){const i=[e,t];if(e.y===t.y)return"M "+e.x+" "+e.y+" L "+t.x+" "+t.y;let n="M";for(let s=0;s<=16;s++){const e=this.getBezierPoint(s/16,i,0,2);n+=e.x+","+e.y,16!==s&&(n+=" L")}return n}getBezierPoint(e,t,i,n){if(1===n)return t[i];const s=this.getBezierPoint(e,t,i,n-1),r=this.getBezierPoint(e,t,i+1,n-1);return{x:(1-e)*s.x+e*r.x,y:(1-e)*s.y+e*r.y}}getEdgeOfLabel(e,t,i,n=1,s){const r=new Pt(e.x,e.y);return t>=90&&t<=270?(r.x+=e.width+n/2,r.y+=e.height/2,i.x=r.x+10,i.y=r.y):s&&s.region&&s.region.x>s.labelRegion.x?(r.x+=2*n+e.width,r.y+=e.height/2,i.x=r.x+10,i.y=r.y):(r.x-=n/2,r.y+=e.height/2,i.x=r.x-10,i.y=r.y),r}getLabelDistance(e,t){if(e.labelPosition&&t.position!==e.labelPosition||t.connectorStyle.length){const e=St(t.connectorStyle.length||"70px",this.accumulation.initialClipRect.width);if(e<this.accumulation.initialClipRect.width)return e}const i=(this.accumulation.initialClipRect.width-this.accumulation.visibleSeries[0].triangleSize.width)/2;let n;switch(e.labelPosition||t.position){case"Inside":return 0;case"Outside":return n=e.symbolLocation.x+e.labelOffset.x,this.accumulation.initialClipRect.width-n-i}}getLabelLocation(e,t="Outside"){if("Pie"!==this.accumulation.type){const i={x:e.symbolLocation.x,y:e.symbolLocation.y-e.labelOffset.y};switch(t="OutsideLeft"===t?"OutsideLeft":e.labelPosition||t){case"Inside":i.y=e.region.y+e.region.height/2;break;case"Outside":i.x+=e.labelOffset.x;break;case"OutsideLeft":i.x-=e.labelOffset.x}return i}return Me(e.midAngle,this.isVariousRadius()?St(e.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius,this.center)}getConnectorStartPoint(e,t){let i;return!this.isCircular()&&e.region.x>e.labelRegion.x&&(i="OutsideLeft"),this.isCircular()?Me(e.midAngle,(this.isVariousRadius()?St(e.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius)-t.width,this.center):this.getLabelLocation(e,i)}findAreaRect(){this.areaRect=new C(0,0,this.accumulation.availableSize.width,this.accumulation.availableSize.height);const e=this.accumulation.margin;De(this.areaRect,new Nt(e.left,e.right,e.top,e.bottom))}renderDataLabel(e,t,i,n,s,a,o){const l=this.accumulation.element.id+"_datalabel_Series_"+s+"_",h=this.accumulation.renderer.createGroup({id:l+"g_"+e.index});e.label=e.originalText||e.y.toString();const c={width:t.border.width,color:t.border.color},d=Object(r.L)({},Object(r.X)("properties",t.font),null,!0),p={cancel:!1,name:"textRender",series:this.accumulation.visibleSeries[0],point:e,text:e.label,border:c,color:t.fill,template:t.template,font:d};this.accumulation.trigger("textRender",p),e.argsData=p;const g=null!==p.template;e.labelVisible=!p.cancel,e.text=e.label=p.text,Number(e.label)&&(e.label=this.accumulation.intl.formatNumber(+e.label,{useGrouping:this.accumulation.useGroupingSeparator})),this.marginValue=p.border.width?5+p.border.width:1;const u=Object(r.G)("div",{id:this.accumulation.element.id+"_Series_0_DataLabel_"+e.index,styles:"position: absolute;background-color:"+p.color+";"+ot(t.font)+";border:"+p.border.width+"px solid "+p.border.color+";"});this.calculateLabelSize(g,u,e,n,p,h,l,t,o)}calculateLabelSize(e,t,i,n,s,r,a,o,l,h,c){const d=e?c?{width:h.width,height:h.height}:this.getTemplateSize(t,i,s,l,e,n,r,a,o):b(i.label,o.font);d.height+=4,d.width+=4,i.textSize=d,i.templateElement=t,this.getDataLabelPosition(i,o,d,n),i.labelRegion&&this.correctLabelRegion(i.labelRegion,i.textSize)}drawDataLabels(e,t,i,n,s){let a,o;const l=e.leftSidePoints.concat(e.rightSidePoints);l.sort((e,t)=>e.index-t.index),"Pie"===e.type&&this.accumulation.enableSmartLabels&&this.extendedLabelsCalculation();for(const h of l)if(!Object(r.Z)(h.argsData)&&!Object(r.Z)(h.y)){this.finalizeDatalabels(h,l,t);const e=this.accumulation.element.id+"_datalabel_Series_0_",c=this.accumulation.renderer.createGroup({id:e+"g_"+h.index});let d,p,g;if(h.visible&&h.labelVisible){if(a=o=t.angle,h.argsData.template)this.setTemplateStyle(h.templateElement,h,n,t.font.color,h.color,s);else{p=new Pt(h.labelRegion.x+this.marginValue,h.labelRegion.y+3*h.textSize.height/4+this.marginValue),g=nt(e+"shape_"+h.index);const i=g?new Pt(+g.getAttribute("x"),+g.getAttribute("y")):null;d=this.accumulation.renderer.drawRectangle(new Dt(e+"shape_"+h.index,h.argsData.color,h.argsData.border,1,h.labelRegion,t.rx,t.ry)),ct(!1,c,d,s,!0,"x","y",i,null,!1,!1,null,this.accumulation.duration);const n=h.textSize.width,r=h.textSize.height;let l;0!==a&&t.enableRotation?(o="Outside"===h.labelPosition?0:h.midAngle>=90&&h.midAngle<=270?h.midAngle+180:h.midAngle,l="rotate("+o+","+(p.x+n/2)+","+(p.y-r/4)+")"):(o=a?a>360?a-360:a<-360?a+360:a:0,l="rotate("+o+","+(p.x+n/2)+","+p.y+")"),h.transform=l,It(this.accumulation.renderer,new w(e+"text_"+h.index,p.x,p.y,"start",h.label,l,"auto",o),h.argsData.font,h.argsData.font.color||this.getSaturatedColor(h,h.argsData.color),c,!1,s,!0,!1,this.accumulation.duration),g=null}if(this.accumulation.accumulationLegendModule&&("Outside"===t.position||this.accumulation.enableSmartLabels)&&this.accumulation.visibleSeries[0].findMaxBounds(this.accumulation.visibleSeries[0].labelBound,h.labelRegion),"Outside"===h.labelPosition){const i=nt(e+"connector_"+h.index),n=i?i.getAttribute("d"):"";ct(!1,c,this.accumulation.renderer.drawPath(new A(e+"connector_"+h.index,"transparent",t.connectorStyle.width,t.connectorStyle.color||h.color,1,t.connectorStyle.dashArray,this.getConnectorPath(Object(r.L)({},h.labelRegion,null,!0),h,t,h.labelAngle))),s,!0,null,null,null,n,!1,!1,null,this.accumulation.duration)}ct(!1,i,c,s)}}}finalizeDatalabels(e,t,i){if((this.isOverlapping(e,t)||this.titleRect&&e.labelRegion&&ut(e.labelRegion,this.titleRect))&&this.isCircular()&&"Outside"===e.labelPosition&&this.setPointVisibileFalse(e),this.accumulation.accumulationLegendModule&&e.labelVisible&&e.labelRegion){const t=this.accumulation.accumulationLegendModule.legendBounds,n=this.accumulation.legendSettings.border.width/2;this.textTrimming(e,new C(t.x-n,t.y-n,t.width+2*n,t.height+2*n),i.font,this.accumulation.accumulationLegendModule.position)}if(e.labelVisible&&e.labelRegion){const t=this.isCircular()?e.labelRegion.x>=this.center.x?"InsideRight":"InsideLeft":e.labelRegion.x>=e.region.x?"InsideRight":"InsideLeft";this.textTrimming(e,this.areaRect,i.font,t)}e.labelVisible&&e.labelRegion&&(e.labelRegion.y+e.labelRegion.height>this.areaRect.y+this.areaRect.height||e.labelRegion.y<this.areaRect.y||e.labelRegion.x<this.areaRect.x||e.labelRegion.x+e.labelRegion.width>this.areaRect.x+this.areaRect.width)&&this.setPointVisibileFalse(e)}getTemplateSize(e,t,i,n,s,r,a,o,l){const h=lt(e=at(e,t.index,i.template,this.accumulation,t,this.accumulation.visibleSeries[0],this.accumulation.element.id+"_DataLabel",0,i,s,r,a,o,l,n),n);return{width:h.width,height:h.height}}setTemplateStyle(e,t,i,n,s,r){if(e.style.left=t.labelRegion.x+"px",e.style.top=t.labelRegion.y+"px",e.style.color=n||this.getSaturatedColor(t,s),this.accumulation.isBlazor){const i=this.isCircular()?t.labelRegion.x>=this.center.x?"InsideRight":"InsideLeft":t.labelRegion.x>=t.region.x?"InsideRight":"InsideLeft";e.style.transform="InsideRight"===i?"translate(0%, -50%)":"translate(-100%, -50%)"}e.childElementCount&&(ct(!1,i,e,r,!0,"left","top"),this.doTemplateAnimation(this.accumulation,e))}getSaturatedColor(e,t){let i;i=this.marginValue>=1?"transparent"===t?this.getLabelBackground(e):t:this.getLabelBackground(e),i="transparent"===i?window.getComputedStyle(document.body,null).backgroundColor:i;const n=yt(xt(i));return Math.round((299*n.r+587*n.g+114*n.b)/1e3)>=128?"black":"white"}doTemplateAnimation(e,t){const i=e.visibleSeries[0],n=i.animation.delay+i.animation.duration;i.animation.enable&&e.animateSeries&&(t.style.visibility="hidden",tt(t,n,200,"ZoomIn"))}getLabelBackground(e){return"Outside"===e.labelPosition?this.accumulation.background||this.accumulation.themeStyle.background:e.color}correctLabelRegion(e,t,i=4){e.height-=i,e.width-=i,e.x+=i/2,e.y+=i/2,t.height-=i,t.width-=i}getModuleName(){return"AccumulationDataLabel"}destroy(){}extendedLabelsCalculation(){const e=this.accumulation.series[0];e.rightSidePoints.forEach((e,t,i)=>{e.initialLabelRegion=e.labelRegion,e.isLabelUpdated=0,this.skipPoints(e,i,t)}),e.leftSidePoints.forEach((e,t,i)=>{e.initialLabelRegion=e.labelRegion,e.isLabelUpdated=0,this.skipPoints(e,i,t)}),this.arrangeLeftSidePoints(e),this.isIncreaseAngle=!1,this.arrangeRightSidePoints(e)}arrangeRightSidePoints(e){let t,i;const n=e.rightSidePoints.filter(e=>e.labelVisible&&"Outside"===e.labelPosition);let s,r;this.rightSideRenderingPoints=n;const a=n[n.length-1];let o;a&&a.labelAngle>90&&a.labelAngle<270&&(this.isIncreaseAngle=!0,this.changeLabelAngle(a,89));for(let l=n.length-1;l>=0;l--)if(r=n[l],o=n[l+1],this.isOverlapWithNext(r,n,l)&&r.labelVisible||!(r.labelAngle<=90||r.labelAngle>=270))if(s=a.labelAngle+10,i=!0,t?this.isIncreaseAngle=!1:s>90&&s<270&&o.isLabelUpdated&&(this.isIncreaseAngle=!0),this.isIncreaseAngle)for(let t=l+1;t>0;t--)this.decreaseAngle(n[t],n[t-1],e,!0);else for(let t=l+1;t<n.length;t++)this.increaseAngle(n[t-1],n[t],e,!0);else i&&o&&!o.isLabelUpdated&&(t=!0)}arrangeLeftSidePoints(e){const t=e.leftSidePoints.filter(e=>e.labelVisible&&"Outside"===e.labelPosition);let i,n,s,r;this.leftSideRenderingPoints=t;for(let a=0;a<t.length;a++)if(n=t[a],i=t[a-1],this.isOverlapWithPrevious(n,t,a)&&n.labelVisible||!(n.labelAngle<270))if(s=!0,r&&(this.isIncreaseAngle=!1),this.isIncreaseAngle)for(let i=a;i<t.length;i++)this.increaseAngle(t[i-1],t[i],e,!1);else for(let i=a;i>0;i--)this.decreaseAngle(t[i],t[i-1],e,!1),t.filter((e,i)=>{e.isLabelUpdated&&t[i].labelAngle-10<100&&(this.isIncreaseAngle=!0)});else s&&i&&i.isLabelUpdated&&(r=!0)}decreaseAngle(e,t,i,n){if(Object(r.Z)(e)||Object(r.Z)(t))return null;let s=1;if(n)for(;ut(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&!(t.labelRegion.height+t.labelRegion.y<e.labelRegion.y);){let e=t.midAngle-s;if(e<0&&(e=360+e),e<=270&&e>=90){e=270,this.isIncreaseAngle=!0;break}this.changeLabelAngle(t,e),s++}else for(e.labelAngle>270&&(this.changeLabelAngle(e,270),t.labelAngle=270);ut(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&e.labelRegion.y+e.labelRegion.height>t.labelRegion.y;){let n=t.midAngle-s;if(!(n<=270&&n>=90)){n=90,this.isIncreaseAngle=!0;break}if(this.changeLabelAngle(t,n),ut(e.labelRegion,t.labelRegion)&&!i.leftSidePoints.indexOf(t)&&n-1<90&&n-1>270){this.changeLabelAngle(e,e.labelAngle+1),this.arrangeLeftSidePoints(i);break}s++}}increaseAngle(e,t,i,n){if(Object(r.Z)(e)||Object(r.Z)(t))return null;let s=1;if(n)for(;ut(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&!(e.labelRegion.y+e.labelRegion.height<t.labelRegion.y);){let n=t.midAngle+s;if(n<270&&n>90){n=90,this.isIncreaseAngle=!0;break}if(this.changeLabelAngle(t,n),ut(e.labelRegion,t.labelRegion)&&n+1>90&&n+1<270&&this.rightSideRenderingPoints.indexOf(t)===this.rightSideRenderingPoints.length-1){this.changeLabelAngle(e,e.labelAngle-1),t.labelRegion=t.initialLabelRegion,this.arrangeRightSidePoints(i);break}s++}else for(;ut(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&e.labelRegion.y<t.labelRegion.y+t.labelRegion.height;){let e=t.midAngle+s;if(!(e<270&&e>90)){e=270,this.isIncreaseAngle=!1;break}this.changeLabelAngle(t,e),s++}}changeLabelAngle(e,t){const i=this.accumulation.series[0].dataLabel;let n;this.isVariousRadius()&&(n=this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],e));const s="Outside"===e.labelPosition&&this.accumulation.enableSmartLabels&&"Inside"===i.position?this.radius+St(i.connectorStyle.length||"4%",this.accumulation.pieSeriesModule.size/2):this.isVariousRadius()?n:this.accumulation.pieSeriesModule.labelRadius+10,r=this.isVariousRadius()?n:s;this.getLabelRegion(e,"Outside",e.textSize,r,this.marginValue,t),e.isLabelUpdated=1,e.labelAngle=t}isOverlapWithPrevious(e,t,i){for(let n=0;n<i;n++)if(n!==t.indexOf(e)&&t[n].visible&&t[n].labelVisible&&t[n].labelRegion&&e.labelRegion&&e.labelVisible&&ut(e.labelRegion,t[n].labelRegion))return!0;return!1}isOverlapWithNext(e,t,i){for(let n=i;n<t.length;n++)if(n!==t.indexOf(e)&&t[n].visible&&t[n].labelVisible&&t[n].labelRegion&&e.labelRegion&&e.labelVisible&&ut(e.labelRegion,t[n].labelRegion))return!0;return!1}skipPoints(e,t,i){if(i>0&&(e.midAngle<285&&e.midAngle>255||e.midAngle<105&&e.midAngle>75)){const n=t[i-1],s=e.endAngle%360-e.startAngle%360;n.endAngle%360-n.startAngle%360<=s&&s<5&&n.labelVisible&&this.setPointVisibleTrue(e)}else if(i>1&&(e.midAngle<300&&e.midAngle>240||e.midAngle<120&&e.midAngle>60)){const n=t[i-1],s=t[i-2],r=n.endAngle%360-n.startAngle%360,a=s.endAngle%360-s.startAngle%360;e.endAngle%360-e.startAngle%360<3&&r<3&&a<3&&n.labelVisible&&e.labelVisible&&this.setPointVisibleTrue(e)}}getPerpendicularDistance(e,t){let i;const n=10+10*Math.sin(t.midAngle*Math.PI/360);return i=t.midAngle>270&&t.midAngle<360?new Pt(e.x+n*Math.cos((360-t.midAngle)*Math.PI/180),e.y-n*Math.sin((360-t.midAngle)*Math.PI/180)):t.midAngle>0&&t.midAngle<90?new Pt(e.x+n*Math.cos(t.midAngle*Math.PI/180),e.y+n*Math.sin(t.midAngle*Math.PI/180)):t.midAngle>0&&t.midAngle<90?new Pt(e.x-n*Math.cos((t.midAngle-90)*Math.PI/180),e.y+n*Math.sin((t.midAngle-90)*Math.PI/180)):new Pt(e.x-n*Math.cos((t.midAngle-180)*Math.PI/180),e.y-n*Math.sin((t.midAngle-180)*Math.PI/180)),i}},class extends oi{constructor(e){super(e),this.library=this,this.titleRect=new C(0,e.margin.top,0,0)}getLegendOptions(e,t){this.legendCollections=[];for(let i=0;i<1;i++){let e=t[i].type;"Pie"!==e&&"Doughnut"!==e||(e="0"!==t[i].innerRadius&&"0%"!==t[i].innerRadius?"Doughnut":"Pie");for(const n of t[i].points)Object(r.Z)(n.x)||Object(r.Z)(n.y)||this.legendCollections.push(new li(n.x.toString(),n.color,t[i].legendShape,n.visible,e,n.legendImageUrl,null,null,n.index,t[i].index))}}getLegendBounds(e,t,i){this.calculateLegendTitle(i,t),this.isTitle=!!i.title;let n=0,s=0;const r=i.padding,a=i.titlePosition;let o=0;const l=this.arrowWidth,h=i.enablePages?0:this.arrowHeight;this.isVertical?n=i.width?0:e.width/100*5:s=i.height?0:e.height/100*5,t.width+=n,t.height+=s;const c=i.shapePadding;let d=0;const p=i.shapeWidth;let g=0,u=0;const m=[];let f,y=0,x=0,C=0;this.maxItemHeight=Math.max(b("MeasureText",i.textStyle).height,i.shapeHeight);let v=!1;for(const w of this.legendCollections)f={fill:w.fill,text:w.text,shape:w.shape,name:"legendRender",cancel:!1},this.chart.trigger("legendRender",f),w.render=!f.cancel,w.text=f.text.indexOf("&")>-1?this.convertHtmlEntities(f.text):f.text,w.fill=f.fill,w.shape=f.shape,w.textSize=b(w.text,i.textStyle),w.render&&""!==w.text&&(v=!0,x=p+c+w.textSize.width+r,this.isVertical?(++u,y=u*(this.maxItemHeight+r)+r+this.legendTitleSize.height+h,u*(this.maxItemHeight+r)+r+h>t.height&&(y=Math.max(y,u*(this.maxItemHeight+r)+r+h),g+=d,m.push(d),this.totalPages=Math.max(u,this.totalPages||1),d=0,u=1),d=Math.max(x,d)):(i.enablePages||(o=this.isTitle&&"Top"!==a?this.legendTitleSize.width+this.fivePixel:0,o+=l),g+=x,t.width<r+g+o&&(d=Math.max(d,g+r+o-x),0===u&&x!==g&&(u=1),g=x,u++,y=u*(this.maxItemHeight+r)+r+this.legendTitleSize.height)));C="Top"===a?this.legendTitleSize.height:0,this.isVertical?(g+=d,this.isPaging=t.width<g+r,y=Math.max(y,(this.totalPages||1)*(this.maxItemHeight+r)+r+h),this.isPaging=this.isPaging&&this.totalPages>1,m[m.length-1]!==d&&m.push(d)):(this.isPaging=t.height<y,y=!i.enablePages&&this.isPaging?this.maxItemHeight+r+r+C:y,this.totalPages=this.totalRowCount=u,y=Math.max(y,this.maxItemHeight+r+r+C),this.isPaging||(g+=this.isTitle&&"Top"!==a?this.fivePixel+this.legendTitleSize.width+this.fivePixel:0)),this.maxColumns=0;const S=this.isVertical?this.getMaxColumn(m,t.width,r,g+r):Math.max(g+r,d);v?this.setBounds(S,y,i,t):this.setBounds(0,0,i,t)}convertHtmlEntities(e){let t=e.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">").replace("&quot;",'"').replace("&nbsp;"," ").replace("&cent;","\xa2").replace("&pound;","\xa3").replace("&yen;","\xa5").replace("&euro;","\u20ac").replace("&copy;","\xa9").replace("&reg;","\xae");return t=t.replace("&#38;","&").replace("&#60;","<").replace("&#62;",">").replace("&#34;",'"').replace("&#160;"," ").replace("&#162;","\xa2").replace("&#163;","\xa3").replace("&#165;","\xa5").replace("&#8364;","\u20ac").replace("&#169;","\xa9").replace("&#174;","\xae"),t}getMaxColumn(e,t,i,n){let s=i;this.maxColumnWidth=Math.max.apply(null,e);for(const r of e)if(s+=this.maxColumnWidth,this.maxColumns++,s+i>t){s-=this.maxColumnWidth,this.maxColumns--;break}return this.isPaging=s<n&&this.totalPages>1,s===i&&(s=t),this.maxColumns=Math.max(1,this.maxColumns),this.maxWidth=s,s}getAvailWidth(e,t){return this.isVertical&&(t=this.maxWidth),t-(2*this.legend.padding+this.legend.shapeWidth+this.legend.shapePadding)}getRenderPoint(e,t,i,n,s,r,a){const o=this.legend.padding;if(this.isVertical)r===a||n.location.y+1.5*this.maxItemHeight+2*o>s.y+s.height?(e.location.x=n.location.x+(r===a?0:this.maxColumnWidth),e.location.y=t.y,this.pageXCollections.push(e.location.x-this.legend.shapeWidth/2-o),this.totalPages++):(e.location.x=n.location.x,e.location.y=n.location.y+this.maxItemHeight+o);else{const l=n.location.x+i+n.textSize.width;l+(e.textSize.width+i)>s.x+s.width+this.legend.shapeWidth/2?(e.location.y=r===a?n.location.y:n.location.y+this.maxItemHeight+o,e.location.x=t.x):(e.location.y=n.location.y,e.location.x=r===a?n.location.x:l),this.totalPages=this.totalRowCount}const l=this.getAvailWidth(e.location.x,this.legendBounds.width);e.text=vt(+l.toFixed(4),e.text,this.legend.textStyle)}getSmartLegendLocation(e,t,i){let n;switch(this.position){case"Left":n=(e.x-t.width-i.left)/2,t.x=e.x-t.width<i.left?t.x:e.x-t.width-n;break;case"Right":n=(this.chart.availableSize.width-i.right-(e.x+e.width+t.width))/2,t.x=e.x+e.width+t.width>this.chart.availableSize.width-i.right?t.x:e.x+e.width+n;break;case"Top":this.getTitleRect(this.chart),n=(e.y-t.height-(this.titleRect.y+this.titleRect.height))/2,t.y=e.y-t.height<i.top?t.y:e.y-t.height-n;break;case"Bottom":n=(this.chart.availableSize.height-i.bottom-(e.y+e.height+t.height))/2,t.y=e.y+e.height+t.height>this.chart.availableSize.height-i.bottom?t.y:e.y+e.height+n}}getTitleRect(e){if(!e.title)return null;const t=b(e.title,e.titleStyle);this.titleRect=new C(e.availableSize.width/2-t.width/2,e.margin.top,t.width,t.height)}legendByIndex(e,t){for(const i of t)if(i.pointIndex===e)return i;return null}click(e){const t=e.target.id,i=this.chart,n=[this.legendID+"_text_",this.legendID+"_shape_",this.legendID+"_shape_marker_"];this.chart.accumulationSelectionModule&&Object(r.L)([],this.chart.accumulationSelectionModule.selectedDataIndexes,null,!0),this.chart.animateSeries=!1;for(const s of n)if(t.indexOf(s)>-1){const e=parseInt(t.split(s)[1],10);if(this.chart.legendSettings.toggleVisibility&&!isNaN(e)){const t=this.chart.visibleSeries[0],n=ki(e,t.points),s=this.legendByIndex(e,this.legendCollections);n.visible=!n.visible,s.visible=n.visible,t.sumOfPoints+=n.visible?n.y:-n.y,i.redraw=i.enableAnimation,this.sliceVisibility(e,n.visible),i.removeSvg(),Tt(i),this.chart.refreshPoints(t.points),this.chart.renderElements()}else this.chart.accumulationSelectionModule&&!isNaN(e)&&this.chart.accumulationSelectionModule.legendSelection(this.chart,0,e)}t.indexOf(this.legendID+"_pageup")>-1?this.changePage(e,!0):t.indexOf(this.legendID+"_pagedown")>-1&&this.changePage(e,!1),i.redraw=!1}sliceVisibility(e,t){let i=this.chart.element.id+"_Series_0_Point_";this.chart.visibleSeries[0].dataLabel.visible&&(i=this.chart.element.id+"_datalabel_Series_0_",this.sliceAnimate(nt(i+"g_"+e),t))}sliceAnimate(e,t){if(!e)return null;new r.b({}).animate(e,{duration:300,delay:0,name:t?"FadeIn":"FadeOut",end:e=>{e.element.style.visibility=t?"visible":"hidden"}})}getModuleName(){return"AccumulationLegend"}destroy(){}});class ka{constructor(e){this.parent=e,this.addEventListener()}addEventListener(){this.parent.on("initiateChart",this.initiateChartHandler,this),this.parent.on("refreshChartCellObj",this.refreshChartCellObj,this),this.parent.on("updateChart",this.updateChartHandler,this),this.parent.on("deleteChart",this.deleteChart,this),this.parent.on("clearChartBorder",this.clearBorder,this),this.parent.on("insertChart",this.insertChartHandler,this),this.parent.on("chartRangeSelection",this.chartRangeHandler,this),this.parent.on("chartDesignTab",this.chartDesignTabHandler,this),this.parent.on("addChartEle",this.updateChartElement,this)}insertChartHandler(e){let t="Column";switch(e.id){case"clusteredColumn":t="Column";break;case"stackedColumn":t="StackingColumn";break;case"stackedColumn100":t="StackingColumn100";break;case"clusteredBar":t="Bar";break;case"stackedBar":t="StackingBar";break;case"stackedBar100":t="StackingBar100";break;case"area":t="Area";break;case"stackedArea":t="StackingArea";break;case"stackedArea100":t="StackingArea100";break;case"line":t="Line";break;case"stackedLine":t="StackingLine";break;case"stackedLine100":t="StackingLine100";break;case"pie":t="Pie";break;case"doughnut":t="Doughnut";break;case"scatter":t="Scatter"}e.isChart?this.parent.notify("setChart",{chart:[{type:t}]}):this.parent.notify("chartDesignTab",{chartType:t})}chartRangeHandler(){const e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e){const t=e.getElementsByClassName("e-control")[0].id,i=this.parent.chartColl,n=i.length;for(let s=0;s<n;s++){const n=document.getElementById(i[s].id);e&&n&&i[s].id===t&&this.parent.notify("initiateChart",{option:i[s],chartCount:this.parent.chartCount,isRefresh:!0})}}}getPropertyValue(e,t,i){const n=this.parent.sheets;if(n[i]&&n[i].rows[e]&&n[i].rows[e].cells[t]){const n=Cs(e,t,this.parent.sheets[i]);let s="";if(n.format){const i={type:pn(n.format),value:n&&n.value,format:n&&n.format?n.format:"General",formattedText:n&&n.value,onLoad:!0,isRightAlign:!1,cell:n,rowIdx:e.toString(),colIdx:t.toString()};if(n)if(this.parent.notify("getFormattedCell",i),"number"==typeof i.value){const e=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");i.formattedText=i.formattedText.toString().replace(e,""),s=parseInt(i.formattedText.toString(),10)}else s=i.formattedText.toString()}else s=this.parent.sheets[i].rows[e].cells[t].value;return s=Object(r.Z)(s)?"":s,s}return""}updateChartHandler(e){const t=this.initiateChartHandler({option:e.chart,isRefresh:!0}),i=this.parent.element.querySelector("."+e.chart.id);if(i){let e=Object(r.N)(i,"chart");Object(r.Z)(e)&&(e=Object(r.N)(i,"accumulationchart")),e.series=t,e.refresh()}}refreshChartCellObj(e){const t=this.parent.sheets[this.parent.activeSheetIndex],i=Cs(e.prevRowIdx,e.prevColIdx,t),n=Cs(e.currentRowIdx,e.currentColIdx,t),s=i?i.chart:[];let a,o;const l=s&&s.length?s.length:0;if(i&&i.chart){for(let t=0;t<l;t++){const i=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active")[0],n=document.getElementById(s[t].id);if(Object(r.D)(n,"."+i.classList[1])===i){a=s[t],a.height=e.currentHeight,a.width=e.currentWidth,a.top=e.currentTop,a.left=e.currentLeft,s.splice(t,1);for(let t=0,i=this.parent.chartColl.length;t<i;t++)a.id===this.parent.chartColl[t].id&&(a.height=e.currentHeight,this.parent.chartColl[t].width=e.currentWidth,this.parent.chartColl[t].top=e.currentTop,this.parent.chartColl[t].left=e.currentLeft)}}n&&n.chart&&(o=n.chart,a&&o.push(a)),vs(e.currentRowIdx,e.currentColIdx,t,o?{chart:o}:{chart:[a]},!0),"chartRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:this.parent.activeSheetIndex},action:"chartRefresh"})}}processChartRange(e,t,i){let n,s,a;const o=e[0],l=e[1];let h=!1;const c=e[2],d=e[3],p=o===c,g=l===d,u=this.getPropertyValue(o,d,t),m=this.getPropertyValue(c,l,t),f=this.getPropertyValue(o,l,t);return tn(m)&&f||(h=!0),Object(r.Z)(f)&&!p&&!g||"Scatter"===i.type&&e[3]-e[1]==1?(n=[o+1,l,c,l],s=[o+1,l+1,c,d],a=[o,l+1,o,d]):Object(r.Z)(m)||!h||p||g?(s=[o,l,c,d],Object(r.Z)(u)||tn(u)||en(u)?Object(r.Z)(f)&&(p||g)&&(a=[o,l,o,d],p?(s[1]=s[1]+1,a[3]=a[1]):s[0]=s[0]+1):(a=[o,l,o,d],s[0]=s[0]+1)):Object(r.Z)(u)||tn(u)&&f?(n=[o,l,c,l],s=[o,l+1,c,d]):(n=[o+1,l,c,l],s=[o+1,l+1,c,d],a=[o,l+1,o,d]),{xRange:n,yRange:s,lRange:a}}toIntrnlRange(e,t){return e?"string"==typeof e&&(e=Ni[e]):e=Ni[this.parent.sheets[t].selectedRange],e}getRangeData(e){e.range=this.toIntrnlRange(e.range,e.sheetIdx);const t=[];return this.pushRowData(e,e.range[0],e.range[1],e.range[2],e.range[3],t,[],!0,e.isYvalue),t}pushRowData(e,t,i,n,s,a,o,l,h){const c=i,d=this.parent.sheets[e.sheetIdx];for(;t<=n;)if(Ys(d,t))t++;else{for(i=c;i<=s;){if(ir(d,i)){i++;continue}let e="";const n=Cs(t,i,d);if(n&&n.format&&!h){const s={value:n&&n.value,format:n&&n.format?n.format:"General",formattedText:n&&n.value,onLoad:!0,type:n&&pn(n.format),rowIdx:t.toString(),colIdx:i.toString(),isRightAlign:!1,cell:n};this.parent.notify("getFormattedCell",s),e=s.formattedText.toString()}else e=n?Object(r.Z)(n.value)?"":n.value:"";a.push({value:e}),i++}t++}o.push(t)}toArrayData(e){let t,i=0;const n=[],s=e.length;for(;i<s;)t=e[i],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),i++;return n}getVirtualXValues(e){let t=1;const i=[];for(;t<e;)i.push(t.toString()),t++;return i}processChartSeries(e,t,i,n,s){e=e||{};let a="";const o={};let l,h,c,d,p,g,u={},m=0,f=0;const b=[];let y;t=Object(r.Z)(t)?this.parent.getActiveSheet().index:t;const x=this.parent.sheets[t],C=this.getRangeData({range:n,sheetIdx:t,skipFormula:!0,isYvalue:!0}),v=n[2]-n[0]+1-this.parent.hiddenCount(n[0],n[2],"rows",x),S=n[3]-n[1]+1-this.parent.hiddenCount(n[0],n[2],"columns",x);e.isSeriesInRows?(h=s?this.toArrayData(this.getRangeData({range:s,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(S+1),i&&(c=this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),d=v):(h=i?this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(v+1),s&&(c=this.toArrayData(this.getRangeData({range:s,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),d=S);const w=h.length,I=e.isSeriesInRows?1:d;for(Object(r.Z)(e.dataLabelSettings)||(o.visible=e.dataLabelSettings.visible,o.position=e.dataLabelSettings.position);m<d;){for(g=0,p=[],f=e.isSeriesInRows?f:m;g<w;)C[f]&&(l=C[f].value,tn(l)?l=Number(l):(y=Qi(l),l=isNaN(y)?0:y),p.push({x:h[g],y:l})),f+=I,g++;if(a=c&&c.length>0?c[m]:"series"+m,e.type){const t=e.type;if("Line"===t||"StackingLine"===t||"StackingLine100"===t)u={dataSource:p,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{visible:!0,width:10,height:10,dataLabel:o}};else if("Scatter"===t)u={dataSource:p,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:o}};else if("Pie"===t||"Doughnut"===t){const t="Pie"===e.type?"0%":"40%",i=o.visible,n=Object(r.Z)(o.position)?"Inside":"Outer"===o.position?"Outside":"Inside";u={dataSource:p,dataLabel:{visible:!Object(r.Z)(i)&&i,position:n,name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",innerRadius:t}}else u={dataSource:p,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{dataLabel:o}}}b.push(u),m++}let O;return e.type&&(O={series:b,xRange:e.isSeriesInRows?s:i,yRange:n,lRange:e.isSeriesInRows?i:s}),O}primaryYAxisFormat(e){if(Object(r.Z)(e))return"{value}";let t;const i=Cs(e[0],e[1],this.parent.getActiveSheet());if(i&&i.format){if(t=pn(i.format),"Accounting"===t)return"${value}";if("Currency"===t)return"${value}";if("Percentage"===t)return"{value}%"}return"{value}"}focusChartRange(e,t,i){const n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];let s;this.clearBorder();const r=this.parent.getActiveSheet(),a=!(!r.frozenRows&&!r.frozenColumns);i&&(a?s=i:this.parent.notify("focusBorder",{startcell:{rowIndex:i[0],colIndex:i[1]},endcell:{rowIndex:i[2],colIndex:i[3]},classes:[n[0],n[1]]})),e&&(a?s?(s[0]=Math.min(i[0],e[0]),s[1]=Math.min(i[1],e[1]),s[2]=Math.max(i[2],e[2]),s[3]=Math.max(i[3],e[3])):s=e:this.parent.notify("focusBorder",{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[n[2],n[3]]})),this.parent.notify("focusBorder",a&&s?{startcell:{rowIndex:Math.min(s[0],t[0]),colIndex:Math.min(s[1],t[1])},endcell:{rowIndex:Math.max(s[2],t[2]),colIndex:Math.max(s[3],t[3])},classes:[n[4],n[5]]}:{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[n[4],n[5]]})}clearBorder(){const e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)return void[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(e=>{Object(r.J)(e)});const t=this.parent.getMainContent(),i=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];for(let n=0,s=i.length;n<s;n++){const e=t.querySelectorAll("."+i[n]);for(let t=0,s=e.length;t<s;t++)e[t].classList.remove(i[n])}}initiateChartHandler(e){const t=e.option;let i=!0;i=!!Object(r.Z)(e.isInitCell)||!e.isInitCell,e.isUndoRedo=!!Object(r.Z)(e.isUndoRedo)||e.isUndoRedo,e.isRefresh=!Object(r.Z)(e.isRefresh)&&e.isRefresh;const n=this.parent.getActiveSheet();let s=t.range?t.range.indexOf("!")>0?t.range.split("!")[1]:t.range.split("!")[0]:this.parent.getActiveSheet().selectedRange;const a=Ni(s);let o,l,h={};if(!this.parent.allowChart&&n.isProtected)return;const c=t.range&&t.range.indexOf("!")>0?Ls(this.parent,t.range.split("!")[0]):this.parent.activeSheetIndex,d={sheetIndex:c,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:t,range:s,operation:"create"};h=d.options,s=d.range,h=h||{},a.length>0&&a[2]-a[0]<a[3]-a[1]&&(o=!0),h.isSeriesInRows=!!o||!!h.isSeriesInRows&&h.isSeriesInRows,e.dataSheetIdx=Object(r.Z)(e.dataSheetIdx)?c:e.dataSheetIdx;const p=this.processChartRange(a,e.dataSheetIdx,h),g=p.xRange,u=p.yRange,m=p.lRange;c===this.parent.activeSheetIndex&&i&&this.focusChartRange(g,u,m);const f=this.processChartSeries(h,e.dataSheetIdx,g,u,m),b={majorGridLines:t.primaryXAxis&&t.primaryXAxis.majorGridLines&&!Object(r.Z)(t.primaryXAxis.majorGridLines.width)?{width:t.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:t.primaryXAxis&&t.primaryXAxis.minorGridLines&&!Object(r.Z)(t.primaryXAxis.minorGridLines.width)?{width:t.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:t.primaryXAxis&&t.primaryXAxis.minorGridLines&&t.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Category",visible:!t.primaryXAxis||t.primaryXAxis.visible,title:t.primaryXAxis?t.primaryXAxis.title:""},y={lineStyle:{width:0},majorGridLines:t.primaryYAxis&&t.primaryYAxis.majorGridLines&&!Object(r.Z)(t.primaryYAxis.majorGridLines.width)?{width:t.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:t.primaryYAxis&&t.primaryYAxis.minorGridLines&&!Object(r.Z)(t.primaryYAxis.minorGridLines.width)?{width:t.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:t.primaryYAxis&&t.primaryYAxis.minorGridLines&&t.primaryYAxis.minorGridLines.width>0?5:0,labelFormat:this.primaryYAxisFormat(u),visible:!t.primaryYAxis||t.primaryYAxis.visible,title:t.primaryYAxis?t.primaryYAxis.title:""};if(e.isRefresh)return f.series;if(e.isUndoRedo){if(l={type:t.type,theme:t.theme,isSeriesInRows:t.isSeriesInRows,range:t.range,id:t.id,height:t.height,width:t.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},this.parent.notify(vn,{eventArgs:l,action:"beforeInsertChart"}),l.cancel)return[];t.type=l.type,t.theme=l.theme,t.isSeriesInRows=l.isSeriesInRows,t.range=l.range,t.id=l.id,t.height=l.height,t.width=l.width}const x=t.id+"_overlay",C=e.isPaste?this.parent.getActiveSheet().index:e.option.range&&e.option.range.indexOf("!")>0?Ls(this.parent,e.option.range.split("!")[0]):this.parent.activeSheetIndex,v=this.parent.serviceLocator.getService(Fa),S=!Object(r.Z)(e.isInitCell)&&e.isInitCell?e.range:s,w=v.insertOverlayElement(x,S,C);w.classList.add("e-datavisualization-chart"),w.style.width=t.width+"px",w.style.height=t.height+"px",n.frozenRows||n.frozenColumns?v.adjustFreezePaneSize(t,w,S):(w.style.top=Object(r.Z)(t.top)?w.style.top:t.top+"px",w.style.left=Object(r.Z)(t.left)?w.style.left:t.left+"px",t.top=parseInt(w.style.top.replace("px",""),10),t.left=parseInt(w.style.left.replace("px",""),10)),this.parent.notify("overlayEleSize",{height:t.height,width:t.width});const I="Pie"===t.type||"Doughnut"===t.type?{position:"Bottom",visible:!0}:{};Object(r.Z)(t.legendSettings)||(I.visible=t.legendSettings.visible,I.position=t.legendSettings.position);const O=this.parent.createElement("div",{id:t.id,className:t.id});"Pie"!==t.type&&"Doughnut"!==t.type?(this.chart=new fi({primaryXAxis:b,primaryYAxis:y,chartArea:{border:{width:0}},title:t.title,legendSettings:I,theme:t.theme,series:f.series,tooltip:{enable:!0},width:w.style.width,height:w.style.height,load:e=>{let i=t.theme;i=i||"Material",e.chart.theme=i},beforeResize:e=>{e.cancelResizedEvent=!0}}),this.chart.appendTo(O)):(this.chart=new Di({title:t.title,legendSettings:I,theme:t.theme,series:f.series,width:w.style.width,height:w.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,load:e=>{let i=t.theme;i=i||"Material",e.chart.theme=i},beforeResize:e=>{e.cancelResizedEvent=!0}}),this.chart.appendTo(O)),w.appendChild(O),e.isUndoRedo&&this.parent.notify(Cn,{eventArgs:l,action:"insertChart"})}deleteChart(e){this.clearBorder();let t,i,n,s=null,a=this.parent.getActiveSheet();if(Object(r.Z)(e.id)?(s=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=s?s.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",s=document.getElementById(e.id)),Object(r.Z)(e.id)||Object(r.Z)(s))return;e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";let o,l=!1;for(let r=0,p=this.parent.chartColl.length;r<p;r++)if(this.parent.chartColl[r].id===e.id.split("_overlay")[0]){o=this.parent.chartColl[r];break}const h={id:o.id,range:o.range,type:o.type,theme:o.theme,height:o.height,width:o.width,isSeriesInRows:o.isSeriesInRows,isInitCell:!0,posRange:null,top:o.top,left:o.left,cancel:!1};if(s){let n,r;if(a.frozenRows||a.frozenColumns){const e=s.getBoundingClientRect();n={clientY:e.top},r={clientX:e.left},e.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(n.target=this.parent.getColumnHeaderContent()),e.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(r.target=this.parent.getRowHeaderTable())}else n={clientY:s.offsetTop,isImage:!0},r={clientX:s.offsetLeft,isImage:!0};this.parent.notify("deleteChartColl",{id:e.id}),this.parent.notify("getRowIdxFromClientY",n),this.parent.notify("getColIdxFromClientX",r),l=!0,t=n.clientY,i=r.clientX,a=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify("deleteChartColl",{id:e.id});const n=e.range&&e.range.indexOf("!")>0?Ls(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,s=Ni(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);t=s[0],i=s[1],a=this.parent.sheets[n]}const c=Cs(t,i,a);c&&(n=c.chart);const d=n?n.length:null;for(let p=0;p<d;p++){const t=document.getElementById(e.id),i=document.getElementById(n[p].id);Object(r.D)(i,"."+t.classList[1])===t&&n.splice(p,1)}l&&(document.getElementById(e.id).remove(),this.parent.notify("removeDesignChart",{})),vs(t,i,a,{chart:n},!0),h.posRange=_i(t,i),e.isUndoRedo||this.parent.notify(Cn,{eventArgs:h,action:"deleteChart"})}updateChartModel(e,t,i,n,s){const a=t;t=t;const o=this.parent.chartColl[n].id;if(!(s&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(let l=0,h=i.chart.length;l<h;l++)if(i.chart[l].id===o)switch(e){case"PHAxes":case"PHAxisTitle":Object(r.Z)(i.chart[l].primaryXAxis)&&(i.chart[l].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),"PHAxes"===e?(i.chart[l].primaryXAxis.visible=t.primaryXAxis.visible,this.parent.chartColl[n].primaryXAxis.visible=t.primaryXAxis.visible):"PHAxisTitle"===e&&(i.chart[l].primaryXAxis.title=t.primaryXAxis.title,this.parent.chartColl[n].primaryXAxis.title=t.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":Object(r.Z)(i.chart[l].primaryYAxis)&&(i.chart[l].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),"PVAxes"===e?(i.chart[l].primaryYAxis.visible=t.primaryYAxis.visible,this.parent.chartColl[n].primaryYAxis.visible=t.primaryYAxis.visible):"PVAxisTitle"===e&&(i.chart[l].primaryYAxis.title=t.primaryYAxis.title,this.parent.chartColl[n].primaryYAxis.title=t.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":i.chart[l].title=t.title,this.parent.chartColl[n].title=t.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(Object(r.Z)(i.chart[l].dataLabelSettings)&&(i.chart[l].dataLabelSettings={},this.parent.chartColl[n].dataLabelSettings={}),"DLNone"===e)i.chart[l].dataLabelSettings.visible=!1,this.parent.chartColl[n].dataLabelSettings.visible=!1;else{let e;i.chart[l].dataLabelSettings.visible=!0,this.parent.chartColl[n].dataLabelSettings.visible=!0,e=s?"Outside"===a.series[0].dataLabel.position?"Outer":"Middle":t.series[0].marker.dataLabel.position,i.chart[l].dataLabelSettings.position=e,this.parent.chartColl[n].dataLabelSettings.position=e}break;case"GLMajorHorizontal":Object(r.Z)(i.chart[l].primaryYAxis)&&(i.chart[l].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),Object(r.Z)(i.chart[l].primaryYAxis.majorGridLines)&&(i.chart[l].primaryYAxis.majorGridLines={},this.parent.chartColl[n].primaryYAxis.majorGridLines={}),i.chart[l].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width,this.parent.chartColl[n].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":Object(r.Z)(i.chart[l].primaryXAxis)&&(i.chart[l].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),Object(r.Z)(i.chart[l].primaryXAxis.majorGridLines)&&(i.chart[l].primaryXAxis.majorGridLines={},this.parent.chartColl[n].primaryXAxis.majorGridLines={}),i.chart[l].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width,this.parent.chartColl[n].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":Object(r.Z)(i.chart[l].primaryYAxis)&&(i.chart[l].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),Object(r.Z)(i.chart[l].primaryYAxis.minorGridLines)&&(i.chart[l].primaryYAxis.minorGridLines={},this.parent.chartColl[n].primaryYAxis.minorGridLines={}),i.chart[l].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width,this.parent.chartColl[n].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":Object(r.Z)(i.chart[l].primaryXAxis)&&(i.chart[l].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),Object(r.Z)(i.chart[l].primaryXAxis.minorGridLines)&&(i.chart[l].primaryXAxis.minorGridLines={},this.parent.chartColl[n].primaryXAxis.minorGridLines={}),i.chart[l].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width,this.parent.chartColl[n].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if(Object(r.Z)(i.chart[l].legendSettings)&&(i.chart[l].legendSettings={},this.parent.chartColl[n].legendSettings={}),i.chart[l].legendSettings.visible=t.legendSettings.visible,this.parent.chartColl[n].legendSettings.visible=t.legendSettings.visible,"LegendNone"!==e){i.chart[l].legendSettings.position=t.legendSettings.position,this.parent.chartColl[n].legendSettings.position=t.legendSettings.position;break}}}updateChartElement(e,t,i,n,s,r){if(r&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)return;let a;switch(e){case"PHAxes":(t=t).primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":(t=t).primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":(t=t).primaryXAxis.title=s;break;case"PVAxisTitle":(t=t).primaryYAxis.title=s;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=s;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(a=(t=t).series,"DLNone"===e)for(let e=0,t=a.length;e<t;e++)r?a[e].dataLabel.visible=!1:a[e].marker.dataLabel.visible=!1;else for(let t=0,i=a.length;t<i;t++)if(r){const i="DLOutsideend"===e?"Outside":"Inside";a[t].dataLabel.visible=!0,a[t].dataLabel.position=i}else{const i="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":a[0].marker.dataLabel.position;a[t].marker.dataLabel.visible=!0,a[t].marker.dataLabel.position=i}t.series=a,r&&t.refresh();break;case"GLMajorHorizontal":(t=t).primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":(t=t).primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":(t=t).primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":(t=t).primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}this.updateChartModel(e,t,i,n,r)}chartDesignTabHandler(e){let t=!1;const i=this.parent.sheets[this.parent.activeSheetIndex],n=e.switchRowColumn,s=e.chartType,a=e.chartTheme,o=e.addChartEle;let l,h=null;const c=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(!c)return;let d,p;if(i.frozenRows||i.frozenColumns){const e=c.getBoundingClientRect();d={clientY:e.top},p={clientX:e.left},e.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent()),e.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(p.target=this.parent.getRowHeaderTable())}else d={clientY:c.offsetTop,isImage:!0},p={clientX:c.offsetLeft,isImage:!0};this.parent.notify("getRowIdxFromClientY",d),this.parent.notify("getColIdxFromClientX",p);const g=Cs(d.clientY,p.clientX,i);let u=c.querySelector(".e-chart");Object(r.Z)(u)&&(u=c.querySelector(".e-accumulationchart"));const m=u.getAttribute("id");for(let r=0,f=this.parent.chartColl.length;r<f;r++)m===this.parent.chartColl[r].id&&(l=r);if(u&&(h=Object(r.N)(u,"chart"),Object(r.Z)(h)&&(h=Object(r.N)(u,"accumulationchart"),t=!0)),n&&!t){this.parent.chartColl[l].isSeriesInRows=!!Object(r.Z)(this.parent.chartColl[l].isSeriesInRows)||!this.parent.chartColl[l].isSeriesInRows;for(let t=0,i=g.chart.length;t<i;t++)g.chart[t].id===m&&(g.chart[t].isSeriesInRows=!!Object(r.Z)(g.chart[t].isSeriesInRows)||!g.chart[t].isSeriesInRows);const e=this.initiateChartHandler({option:this.parent.chartColl[l],isRefresh:!0});h.series=e}if(s){const e=this.parent.chartColl[l].type;this.parent.chartColl[l].type=s;for(let t=0,i=g.chart.length;t<i;t++)g.chart[t].id===m&&(g.chart[t].type=s);if("Pie"!==s&&"Doughnut"!==s)if("Pie"===e||"Doughnut"===e)this.changeCharType(l);else{const e=h.series;for(let t=0,i=e.length;t<i;t++)e[t].type=s;h.series=e,h.refresh()}else if("Pie"===e||"Doughnut"===e){const e=h.series;for(let t=0,i=e.length;t<i;t++)e[t].innerRadius="Pie"===s?"0%":"40%";h.series=e,h.refresh()}else this.changeCharType(l)}if(a){this.parent.chartColl[l].theme=a;for(let e=0,t=g.chart.length;e<t;e++)g.chart[e].id===m&&(g.chart[e].theme=a);h.theme=a,h.refresh()}if(o)if("ChartTitleAbove"===o||"PHAxisTitle"===o||"PVAxisTitle"===o){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(o,h,g,l,t)}else this.updateChartElement(o,h,g,l,"",t)}changeCharType(e){let t=document.getElementById(this.parent.chartColl[e].id),i=Object(r.D)(t,".e-datavisualization-chart");i.remove(),this.parent.notify("initiateChart",{option:this.parent.chartColl[e],isInitCell:!1,isUndoRedo:!0,isPaste:!1}),t=document.getElementById(this.parent.chartColl[e].id),i=Object(r.D)(t,".e-datavisualization-chart"),i.classList.contains("e-ss-overlay-active")||i.classList.add("e-ss-overlay-active")}titleDlgHandler(e,t,i,n,s){let r="";if(s&&("PHAxisTitle"===e||"PVAxisTitle"===e))return;const a=this.parent.serviceLocator.getService(Da),o=this.parent.serviceLocator.getService(Ma);o.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:a.getConstant("chart_abovechart"===e?"ChartTitle":"PHAxisTitle"===e?"HorizontalAxisTitle":"VerticalAxisTitle"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:()=>{o.dialogInstance.content=this.titleDlgContent(e,t),o.dialogInstance.dataBind(),this.parent.element.focus()},buttons:[{buttonModel:{content:a.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:()=>{const s=this.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];r=s.getElementsByTagName("input")[0].value,o.hide(),this.updateChartElement(e,t,i,n,r)}}]}),o.dialogInstance.refresh()}titleDlgContent(e,t){const i=this.parent.serviceLocator.getService(Da).getConstant("EnterTitle"),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),s=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:i}),r=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(s),n.appendChild(r),t&&(r.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:r.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:r.value:t.title?t.title:r.value),n}removeEventListener(){this.parent.isDestroyed||(this.parent.off("initiateChart",this.initiateChartHandler),this.parent.off("refreshChartCellObj",this.refreshChartCellObj),this.parent.off("updateChart",this.updateChartHandler),this.parent.off("deleteChart",this.deleteChart),this.parent.off("clearChartBorder",this.clearBorder),this.parent.off("insertChart",this.insertChartHandler),this.parent.off("chartRangeSelection",this.chartRangeHandler),this.parent.off("chartDesignTab",this.chartDesignTabHandler),this.parent.off("addChartEle",this.updateChartElement))}destroy(){this.removeEventListener(),this.parent=null;let e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&Object(r.J)(e),this.chart=null}getModuleName(){return"spreadsheetChart"}}var Ea=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let La=(()=>{class e extends r.e{}return Ea([Object(r.t)(!1)],e.prototype,"isFinite",void 0),Ea([Object(r.t)(!0)],e.prototype,"enableVirtualization",void 0),e})(),Ta=(()=>{class e extends r.e{}return Ea([Object(r.t)("Multiple")],e.prototype,"mode",void 0),e})();const ja="e-wraptext",Da="spreadsheetLocale",Ma="dialog",Fa="shape",Pa={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Na={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},Ba={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"Ok",Close:"Close",Cancel:"CANCEL",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",T:"Checks whether a value is text and returns the text if it is, or returns empty string if it is not.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",UNIQUE:"Returns a unique values from a range or array",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",TODAY:"Returns the current date as date value.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"Clear All",APPLY:"Apply",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",unProtectPassword:"Password",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnProtectWorkbook:"Unprotect Workbook",UnProtectPasswordAlert:"The password you supplied is not correct.",InCorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF document"};class Ha{constructor(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}refreshSelectALLContent(){let e;const t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){const t=this.getSelectAllTable().querySelector("thead"),i=this.rowRenderer.render();t.appendChild(i),e=this.parent.createElement("th",{className:"e-select-all-cell"}),i.appendChild(e)}else e=this.headerPanel.firstElementChild,e.classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall e-icons",id:`${this.parent.element.id}_select_all`}))}updateLeftColGroup(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());let i=t.querySelector("table");const n=this.parent.getActiveSheet();let s;if(e)i.querySelector("colgroup").firstElementChild.style.width=`${this.colGroupWidth}px`;else{s=this.parent.createElement("colgroup");const e=this.col.cloneNode();e.style.width=`${this.colGroupWidth}px`,s.appendChild(e),i.insertBefore(s,i.querySelector("tbody"))}(n.frozenRows||n.frozenColumns)&&(i=this.getSelectAllTable(),e?i.querySelector("colgroup").firstElementChild.style.width=`${this.colGroupWidth}px`:i.insertBefore(s.cloneNode(!0),i.querySelector("thead"))),this.setPanelWidth(n,t),this.setPanelHeight(n)}setPanelWidth(e,t){const i=this.getScrollSize(!0),n=this.getRowHeaderWidth(e),s=this.parent.enableRtl?"right":"left";if(e.frozenColumns){const e=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];e.style.height=`calc(100% - ${i}px)`,e.style[s]=n-Rr(1)+"Px",e.style.display=""}this.setHeaderPanelWidth(this.getSelectAllContent(),n),this.getColHeaderPanel().style.width=`calc(100% - ${n}px)`,this.getColHeaderPanel().style[s]=n+"px",this.setHeaderPanelWidth(t,n),this.getContentPanel().style.width=`calc(100% - ${n}px)`,this.getContentPanel().style[s]=n+"px";let a=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;a&&(i?a.style.height=i+1+"px":(a.style.height="1px",a.style.borderTopWidth="0px"),a=a.firstElementChild,a.style[s]=n+"px",a.style.width=`calc(100% - ${n}px)`,r.d.userAgent.indexOf("Mac OS")>-1&&"safari"===r.d.info.name&&(a.style.height="7px",a.style.top="-7px"))}getScrollSize(e){const t=this.parent.enableRtl?"margin-left":"margin-right";return parseInt(this.headerPanel.style[t],10)?parseInt(this.headerPanel.style[t],10)+(e?1:0):0}setHeaderPanelWidth(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(e=>{t+=parseInt(e.style.width,10)}),e.style.width=t+"px"}setPanelHeight(e){const t=this.getScrollSize(!0);if(e.frozenRows){const i=this.getColHeaderHeight(e);this.headerPanel.style.height=e.showHeaders||e.frozenColumns?"":i+"px",this.contentPanel.style.height=`calc(100% - ${i+t}px)`;const n=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];n.style.width=r.d.isDevice?"100%":`calc(100% - ${t}px)`,n.style.top=i-1-(e.showHeaders?1:0)+"px",n.style.display=""}else this.contentPanel.style.height=`calc(100% - ${(e.showHeaders?Rr(31):0)+t}px)`}renderPanel(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});const e=this.parent.getActiveSheet(),t=this.parent.element.id;this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:`${t}_row_header`})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();const i=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&i.classList.add("e-frozen-columns"),e.frozenRows&&i.classList.add("e-frozen-rows"),this.updateHideHeaders(e,i),e.showGridLines||i.classList.add("e-hide-gridlines");const n=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:`${t}_main_content`}));this.parent.allowScrolling||(n.style.overflow="hidden"),e.frozenRows&&i.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&i.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),r.d.userAgent.indexOf("Mac OS")>-1&&"safari"===r.d.info.name&&i.classList.add("e-mac-safari")}initHeaderPanel(){const e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:`${e}_selectall`})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:`${e}_col_header`}))}createHeaderTable(){const e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)}updateTable(e,t,i){const n=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});n.classList.add(`e-${t}-table`),i.appendChild(n),e.forEach(e=>{n.appendChild(this.parent.createElement(e))})}renderTable(e){let t,i,n;const s=this.parent.getActiveSheet(),a=document.createDocumentFragment();if(a.appendChild(this.headerPanel),a.appendChild(this.contentPanel),this.parent.allowScrolling){const e=this.parent.createElement("div",{className:"e-scrollbar"});e.appendChild(this.parent.createElement("div",{className:"e-scroller"})),a.appendChild(e)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);const o=this.parent.createElement("colgroup");let l;const h=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();const c=this.getSelectAllContent().querySelector("colgroup"),d=this.getRowHeaderPanel().querySelector("colgroup"),p=this.getSelectAllContent().querySelector("thead .e-header-row"),g=this.contentPanel.querySelector(".e-row-header tbody"),u=this.getSelectAllContent().querySelector("tbody"),m=this.headerPanel.querySelector(".e-column-header thead"),f=this.headerPanel.querySelector(".e-column-header tbody"),b=this.rowRenderer.render();m.appendChild(b),this.getColHeaderTable().insertBefore(o,m);const y=this.parent.frozenRowCount(s),x=this.parent.frozenColCount(s);this.parent.notify("beforeContentLoaded",{top:e.top,left:e.left});const C=s.colCount.toString(),v=s.colCount.toString(),S=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";let w;this.parent.getColHeaderTable().setAttribute("aria-colcount",C),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",v),Object(r.y)(this.parent.getContentTable(),{"aria-rowcount":v,"aria-colcount":C}),e.cells.forEach((r,a)=>{if(t=Ni(a),t[1]!==e.indexes[1]&&i||(n=this.rowRenderer.render(t[0],!0),x&&y&&t[1]<x&&t[0]<y?(w=u.querySelector(".e-empty"),w?u.insertBefore(n,w):u.appendChild(n),i=n):x&&t[1]<x?(g.appendChild(n),i=n):(i=this.rowRenderer.render(t[0]),y&&t[0]<y?(w=f.querySelector(".e-empty"),w?f.insertBefore(i,w):f.appendChild(i)):h.appendChild(i),t[1]===e.indexes[1]&&(y&&t[0]<y?u.appendChild(n):g.appendChild(n))),t[1]===e.indexes[1]&&n.appendChild(this.cellRenderer.renderRowHeader(t[0]))),i.appendChild(this.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:r,address:a,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:!0,row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isRefreshing:e.isRefreshing,first:S?S.includes("Row")?t[0]===e.indexes[0]?"Row":S.includes("Column")&&t[1]===e.indexes[1]?"Column":"":t[1]===e.indexes[1]?"Column":"":""})),x&&t[1]===x-1&&(i=null),t[0]===e.indexes[0])if(x&&t[1]<x){l=this.updateCol(s,t[1],c);const e=d.querySelector(".e-empty");e?d.insertBefore(l.cloneNode(!0),e):d.appendChild(l.cloneNode(!0)),p.appendChild(this.cellRenderer.renderColHeader(t[1]))}else this.updateCol(s,t[1],o),b.appendChild(this.cellRenderer.renderColHeader(t[1]))}),this.parent.isReact&&this.parent.renderReactTemplates(),h.parentElement.insertBefore(o.cloneNode(!0),h),nr(()=>{const t=this.parent.getMainContent(),i=document.getElementById(this.parent.element.id+"_sheet");if(i.appendChild(a),i.style.backgroundColor="",e.top&&(t.parentElement.scrollTop=e.top),e.left&&(t.scrollLeft=e.left,this.parent.getColumnHeaderContent().scrollLeft=e.left),this.parent.notify("contentLoaded",e),this.checkTableWidth(s),this.parent.notify(un,{action:"renderEditor"}),e.initLoad||this.parent.isOpen||this.parent.hideSpinner(),kr(t,{busy:!1}),this.parent.trigger("dataBound",{}),this.parent.isEdit&&this.parent.notify("initiateEdit",null),e.initLoad){let e=!0;if(this.parent.scrollSettings.enableVirtualization)for(let t=0;t<s.ranges.length;t++)if(s.ranges[t].info.count-1>this.parent.viewport.bottomIndex){e=!1;break}e&&(this.parent.isReact?setTimeout(()=>this.triggerCreatedEvent()):this.triggerCreatedEvent())}})}triggerCreatedEvent(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?this.parent.created.observers=this.parent.createdHandler.observers:this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger("created",null),this.parent.notify("clearUndoRedoCollection",null))}checkTableWidth(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){const t=tr(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),i=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-i-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width=`calc(100% - ${i}px)`,this.getColHeaderPanel().style.width=`calc(100% - ${i}px)`)}}refreshColumnContent(e){let t,i,n,s,r,a=0;const o=this.parent.getActiveSheet(),l=document.createDocumentFragment(),h=document.createDocumentFragment();let c=this.parent.element.querySelector(".e-sheet-content tbody"),d=this.parent.element.querySelector(".e-column-header tbody"),p=this.parent.element.querySelector(".e-sheet-content colgroup");p=p.cloneNode(),l.appendChild(p),c=l.appendChild(c.cloneNode(!0));const g=p.cloneNode();let u;h.appendChild(g),u=this.parent.element.querySelector(".e-column-header thead"),u=h.appendChild(u.cloneNode(!0));const m=u.querySelector("tr");m.innerHTML="";const f=this.parent.frozenRowCount(o),b=this.parent.frozenColCount(o);f&&(d=h.appendChild(d.cloneNode(!0))),e.cells.forEach((n,l)=>{if(t=Ni(l),t[0]===e.indexes[0]&&(r=this.updateCol(o,t[1],g),p.appendChild(r.cloneNode()),m.appendChild(this.cellRenderer.renderColHeader(t[1]))),t[1]-b===e.indexes[1]){if(i=t[0]<f?d.children[a]:c.children[a],!i)return;i.innerHTML="",a++}s=i.appendChild(this.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:n,address:l,row:i,pRow:i.previousSibling,first:e.skipUpdateOnFirst||t[1]!==e.indexes[1]?this.parent.scrollSettings.enableVirtualization&&t[0]===e.indexes[0]&&this.parent.viewport.topIndex!==Vr(o,0,!0)?"Row":"":"Column",isRefreshing:!0})),this.checkColMerge(t,e.indexes,s,n),f&&t[0]===f-1&&(a=0)}),nr(()=>{n=this.getColHeaderTable(),sr(n),n.appendChild(h),n=this.getContentTable(),sr(n),n.appendChild(l),this.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify("forRefSelRender",{}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",null),this.parent.isOpen||this.parent.hideSpinner(),kr(this.parent.getMainContent(),{busy:!1})})}refreshRowContent(e){let t,i,n,s=this.colGroupWidth;const a=this.parent.getActiveSheet();let o;const l=document.createDocumentFragment(),h=this.parent.createElement("tbody"),c=document.createDocumentFragment(),d=h.cloneNode();c.appendChild(d),l.appendChild(h);const p=this.parent.frozenColCount(a);e.cells.forEach((r,l)=>{t=Ni(l),t[1]!==e.indexes[1]&&i||(n=this.rowRenderer.render(t[0],!0),p&&t[1]<p?(d.appendChild(n),i=n):(t[1]===e.indexes[1]&&d.appendChild(n),i=this.rowRenderer.render(t[0]),h.appendChild(i)),t[1]===e.indexes[1]&&(n.appendChild(this.cellRenderer.renderRowHeader(t[0])),s=rr(t[0]+1))),p&&(n=d.lastElementChild||n),o=i.appendChild(this.cellRenderer.render({rowIdx:t[0],colIdx:t[1],cell:r,address:l,lastCell:t[1]===e.indexes[3],row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||t[0]!==e.indexes[0]?this.parent.scrollSettings.enableVirtualization&&t[1]===e.indexes[1]&&this.parent.viewport.leftIndex!==Vr(a,0,!0,"columns")?"Column":"":"Row",isRefreshing:!0})),this.checkRowMerge(t,e.indexes,o,r),p&&t[1]===p-1&&(i=null)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),this.contentPanel.querySelector(".e-row-header tbody")&&(Object(r.J)(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(c)),this.contentPanel.querySelector(".e-sheet-content tbody")&&(Object(r.J)(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(l)),this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.isOpen||this.parent.hideSpinner(),kr(this.parent.getMainContent(),{busy:!1})}updateCol(e,t,i){const n=this.col.cloneNode();if(n.style.width=Object(r.M)(er(e,t,null,!0)),i){const e=i.querySelector(".e-empty");return e?i.insertBefore(n,e):i.appendChild(n)}return n}updateColContent(e){nr(()=>{let t,i,n,s,a,o=0;const l=this.parent.getActiveSheet(),h=this.parent.element.querySelector(".e-column-header .e-header-row"),c=h.firstElementChild,d=this.parent.element.querySelector(".e-sheet-content colgroup"),p=this.parent.element.querySelector(".e-column-header colgroup"),g=d.firstElementChild;let u;const m=p.firstElementChild,f=this.parent.element.querySelector(".e-sheet-content tbody"),b=this.parent.element.querySelector(".e-column-header tbody"),y=this.parent.frozenRowCount(l),x=this.parent.frozenColCount(l);e.cells.forEach((C,v)=>{if(!u){if(t=Ni(v),"first"===e.direction&&t[1]===e.indexes[1]&&this.checkColMerge([t[0],this.parent.viewport.leftIndex+x],e.indexes,((t[0]<y?b:f).rows[o]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],Cs(t[0],this.parent.viewport.leftIndex+x,l)||{}),t[0]===e.indexes[0]&&("last"===e.direction?(a=this.col.cloneNode(),a.style.width=Object(r.M)(er(l,t[1],null,!0)),d.insertBefore(a,g),p.insertBefore(a.cloneNode(),m),h.insertBefore(this.cellRenderer.renderColHeader(t[1]),c)):(a=this.updateCol(l,t[1],d),p.appendChild(a.cloneNode()),h.appendChild(this.cellRenderer.renderColHeader(t[1]))),this.parent.scrollSettings.enableVirtualization&&e.direction&&(Object(r.J)(d[e.direction+"ElementChild"]),Object(r.J)(p[e.direction+"ElementChild"]),Object(r.J)(h[e.direction+"ElementChild"]))),t[1]===e.indexes[1]){if(t[0]<y)i=b.children[o];else if(i=f.children[o],!i)return void(u=!0);o++,n=i.firstElementChild}s=this.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:C,address:v,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||t[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&t[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction}),"last"===e.direction?(this.checkColMerge(t,e.indexes,s,C,((t[0]<y?b:f).rows[o-1]||{cells:[]}).cells[0]),i.insertBefore(s,n)):i.appendChild(s),this.parent.scrollSettings.enableVirtualization&&e.direction&&Object(r.J)(i[e.direction+"ElementChild"]),y&&t[0]===y-1&&(o=0)}}),this.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",null),this.parent.isEdit&&this.parent.notify("forRefSelRender",{}),this.parent.isOpen||this.parent.hideSpinner(),kr(this.parent.getMainContent(),{busy:!1})})}updateRowContent(e){let t,i,n,s=this.colGroupWidth;const a=this.parent.getActiveSheet();let o=0;const l=this.parent.getMainContent().querySelector("tbody"),h=this.parent.getRowHeaderContent().querySelector("tbody"),c=document.createDocumentFragment();let d;const p=document.createDocumentFragment();this.parent.showSpinner();const g=this.parent.frozenColCount(a),u=this.parent.frozenRowCount(a);let m;e.cells.forEach((f,b)=>{d=Ni(b),"first"===e.direction&&d[0]===e.indexes[0]&&(void 0===m&&(m=(d[1]<g?h:l).rows[e.indexes[2]-e.indexes[0]+1]||null),this.checkRowMerge([this.parent.viewport.topIndex+u,d[1]],e.indexes,(m||{cells:[]}).cells[d[1]<g?o+1:o],Cs(this.parent.viewport.topIndex+u,d[1],a)||{})),d[1]!==e.indexes[1]&&t||(i=this.rowRenderer.render(d[0],!0),g&&d[1]<g?(c.appendChild(i),t=i):(t=this.rowRenderer.render(d[0]),p.appendChild(t),d[1]===e.indexes[1]&&c.appendChild(i),this.parent.scrollSettings.enableVirtualization&&e.direction&&Object(r.J)(l[e.direction+"ElementChild"])),d[1]===e.indexes[1]&&(i.appendChild(this.cellRenderer.renderRowHeader(d[0])),s=rr(d[0]+1),this.parent.scrollSettings.enableVirtualization&&e.direction&&Object(r.J)(h[e.direction+"ElementChild"]))),g&&(i=c.lastElementChild||i),n=t.appendChild(this.cellRenderer.render({colIdx:d[1],rowIdx:d[2],cell:f,address:b,lastCell:d[1]===e.indexes[3],row:t,pHRow:i.previousSibling,checkNextBorder:"last"===e.direction&&d[2]===e.indexes[2]?"Row":"",pRow:t.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:i,first:"last"!==e.direction||e.skipUpdateOnFirst||d[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction})),"last"===e.direction&&l.rows.length&&this.checkRowMerge(d,e.indexes,n,f,(d[1]<g?h:l).rows[0].cells[d[1]<g?o+1:o]),o++,g&&d[1]===g-1&&(t=null,m=void 0,o=0)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),"last"===e.direction?(h.insertBefore(c,h.firstElementChild),l.insertBefore(p,l.firstElementChild)):(h.appendChild(c),l.appendChild(p)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isOpen||this.parent.hideSpinner(),kr(this.parent.getMainContent(),{busy:!1})}checkRowMerge(e,t,i,n,s){if(this.parent.scrollSettings.enableVirtualization&&i&&(!Object(r.Z)(n.rowSpan)||!Object(r.Z)(n.colSpan))){const r=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e[0]===this.parent.viewport.topIndex+r){if(n.rowSpan<0){const n={td:i,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify("checkMerge",n),n.insideFreezePane)return;this.parent.viewport.topIndex+r>=t[0]&&this.refreshPrevMerge(t[0]+1,e[1])}s&&(s.colSpan>1||s.rowSpan>1)&&this.cellRenderer.refresh(e[0]+(t[2]-t[0])+1,e[1],null,s)}else if(n.rowSpan>1){const i=t[2]+1;e[0]+n.rowSpan-1>i&&e[0]<i&&this.refreshPrevMerge(i,e[1],this.parent.viewport.topIndex+r)}}}refreshPrevMerge(e,t,i){const n=this.parent.getCell(e,t,this.parent.getRow(i||0,null,t));n&&n.rowSpan>1&&this.cellRenderer.refresh(e,t,null,n)}checkColMerge(e,t,i,n,s){if(this.parent.scrollSettings.enableVirtualization&&i&&e[1]===this.parent.viewport.leftIndex+this.parent.frozenColCount(this.parent.getActiveSheet())&&(!Object(r.Z)(n.rowSpan)||!Object(r.Z)(n.colSpan))){if(n.colSpan<0){const t={td:i,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify("checkMerge",t),t.insideFreezePane)return}s&&(s.colSpan>1||s.rowSpan>1)&&this.cellRenderer.refresh(e[0],e[1]+(t[3]-t[1])+1,null,s)}}showHideHeaders(){const e=this.parent.getActiveSheet();nr(()=>{if(e.showHeaders){const t=this.getContentPanel();this.setPanelWidth(e,this.getRowHeaderPanel()),this.setPanelHeight(e),document.getElementById(this.parent.element.id+"_sheet").classList.remove("e-hide-headers"),this.getColHeaderPanel().scrollLeft=t.scrollLeft,this.parent.selectRange(e.selectedRange)}else{if(this.updateHideHeaders(e,document.getElementById(this.parent.element.id+"_sheet")),this.setPanelHeight(e),this.parent.frozenColCount(e)||this.parent.frozenRowCount(e))this.setPanelWidth(e,this.getRowHeaderPanel()),this.parent.selectRange(e.selectedRange);else{this.getContentPanel().style.width="";const e=this.parent.enableRtl?"right":"left";this.getContentPanel().style[e]=""}this.getScrollElement().style.left=this.getRowHeaderWidth(e)+"px"}})}updateHideHeaders(e,t){e.showHeaders||t.classList.add("e-hide-headers")}rowHeightChange(e){if(e.threshold){const t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}}colWidthChange(e){if(e.threshold){const t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}}getRowHeaderWidth(e,t){let i=0;if(!t&&e.frozenColumns){const t=Bi(e.topLeftCell)[1];i=tr(e,t,t+e.frozenColumns-1,!0)}return i+=e.showHeaders?Rr(this.colGroupWidth):0,i}getColHeaderHeight(e,t){const i=Bi(e.topLeftCell)[0];return(e.showHeaders&&!t?Rr(31):0)+Ks(e,i,i+e.frozenRows-1,!0)}getSelectAllContent(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]}getScrollElement(){return(this.contentPanel.parentElement||this.contentPanel.nextElementSibling).querySelector(".e-scroller")}getSelectAllTable(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]}getColHeaderTable(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]}getRowHeaderTable(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]}getContentTable(){return this.contentPanel.getElementsByClassName("e-content-table")[0]}getRowHeaderPanel(){return this.contentPanel.getElementsByClassName("e-row-header")[0]}getColHeaderPanel(){return this.headerPanel.getElementsByClassName("e-column-header")[0]}getContentPanel(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]}addEventListener(){this.parent.on("created",this.triggerCreatedEvent,this),this.parent.on("rowHeightChanged",this.rowHeightChange,this),this.parent.on("colWidthChanged",this.colWidthChange,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}destroy(){this.removeEventListener(),this.parent=null}removeEventListener(){this.parent.off("created",this.triggerCreatedEvent),this.parent.off("rowHeightChanged",this.rowHeightChange),this.parent.off("colWidthChanged",this.colWidthChange),this.parent.off("spreadsheetDestroyed",this.destroy)}}class _a{constructor(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=e.serviceLocator.getService("cell")}render(e,t,i){const n=this.element.cloneNode();if(void 0===e)return n.classList.add("e-header-row"),n;n.classList.add("e-row");const s=this.parent.getActiveSheet();return Object(r.y)(n,{"aria-rowindex":(e+1).toString()}),n.style.height=`${Xs(s,e,!0)}px`,t&&!i&&(Ys(s,e+1)&&!Ys(s,e-1)&&n.classList.add("e-hide-start"),0!==e&&Ys(s,e-1)&&!Ys(s,e+1)&&n.classList.add("e-hide-end")),n}refresh(e,t,i,n){let s;const r=this.parent.getActiveSheet();if(n)s=this.render(e,!0,!0),s.appendChild(this.cellRenderer.renderRowHeader(e));else{s=this.render(e);const n=this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col");for(let a=this.parent.viewport.leftIndex;a<=n;a++)s.appendChild(this.cellRenderer.render({colIdx:a,rowIdx:e,cell:Cs(e,a,r),address:_i(e,a),lastCell:a===n,row:s,hRow:i,isHeightCheckNeeded:!0,pRow:t,first:e===this.parent.viewport.topIndex&&Vr(r,e,!0)!==Vr(r,0,!0)?"Row":""}))}return s}}class za{constructor(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on("updateView",this.updateView,this),this.parent.on("calculateFormula",this.calculateFormula,this)}renderColHeader(e){const t=this.th.cloneNode();Object(r.y)(t,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"}),t.innerHTML=Vi(e+1);const i=this.parent.getActiveSheet();return ir(i,e+1)&&t.classList.add("e-hide-start"),0!==e&&ir(i,e-1)&&t.classList.add("e-hide-end"),t}renderRowHeader(e){const t=this.element.cloneNode();return Object(r.w)([t],"e-header-cell"),Object(r.y)(t,{role:"rowheader",tabindex:"-1"}),t.innerHTML=(e+1).toString(),t}render(e){const t=this.parent.getActiveSheet(),i=Cs(e.rowIdx,e.colIdx,t),n=Js(t,e.colIdx);let s;if(i&&i.validation?s=i.validation:n&&n.validation&&(s=n.validation),e.td=this.element.cloneNode(),e.td.className="e-cell",Object(r.y)(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return e.td;e.isRefresh=!1,this.update(e),e.cell&&e.td&&(s&&s.isHighlighted&&this.parent.notify("addHighlight",{range:zi([e.rowIdx,e.colIdx]),td:e.td}),this.parent.notify("cFRender",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,isChecked:!1}),e.td&&e.td.children[0]&&"e-cf-databar"===e.td.children[0].className&&(e.cell.style&&e.cell.style.fontSize&&(e.td.children[0].querySelector(".e-databar-value").style.fontSize=e.cell.style.fontSize),e.td.children[0].style.height="100%",e.td.children[0].firstElementChild.nextElementSibling.style.height="100%")),Dr(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)||this.parent.notify("renderFilterCell",{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx});const a={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx};return this.parent.trigger("beforeCellRender",a),this.updateRowHeight({rowIdx:e.rowIdx,cell:a.element,lastCell:e.lastCell,rowHgt:20,row:e.row,hRow:e.hRow,colIdx:e.colIdx,sheet:t}),this.setWrapByValue(t,e),a.element}setWrapByValue(e,t){const i=t.td.classList.contains("e-wraptext"),n=t.td.innerHTML;n.indexOf("\n")>-1&&!i&&n.split("\n").length>1&&(vs(t.rowIdx,t.colIdx,e,{wrap:!0},!0),this.parent.notify("wrapText",{range:[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],wrap:!0,initial:!0,sheet:e,td:t.td,row:t.row,hRow:t.hRow}))}update(e){const t=this.parent.getActiveSheet(),i=this.processTemplates(e.cell,e.rowIdx,e.colIdx);if(i&&("string"==typeof i?e.td.innerHTML=i:(sr(e.td),e.td.appendChild(i))),e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(t,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(t,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return;e.cell&&!e.cell.hyperlink&&e.td.querySelector(".e-hyperlink")&&e.td.removeChild(e.td.querySelector(".e-hyperlink"))}e.cell&&e.cell.formula&&(!e.cell.value||e.isRefreshing)&&-1===e.cell.formula.indexOf("UNIQUE")&&this.calculateFormula(e);const n={type:e.cell&&pn(e.cell.format),value:e.cell&&e.cell.value,format:e.cell&&e.cell.format?e.cell.format:"General",formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIdx:e.rowIdx.toString(),colIdx:e.colIdx.toString()};e.cell&&this.parent.notify("getFormattedCell",n),Object(r.Z)(e.td)||this.parent.refreshNode(e.td,{type:n.type,result:n.formattedText,curSymbol:Object(r.S)(this.parent.locale,"USD"),isRightAlign:n.isRightAlign,value:n.value||""});let s={};if(e.cell){if(e.cell.style&&(s=e.cell.style.properties?Ss(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify("setChart",{chart:e.cell.chart,isInitCell:!0,range:_i(e.rowIdx,e.colIdx)}),e.cell.hyperlink&&this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.rowSpan>1){const i=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));i>1&&(e.td.rowSpan=i,this.mergeFreezeRow(t,e.rowIdx,e.colIdx,i,e.row))}if(e.cell.colSpan>1){const i=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");i>1&&(e.td.colSpan=i,this.mergeFreezeCol(t,e.rowIdx,e.colIdx,i))}if(e.cell.image)for(let t=0;t<e.cell.image.length;t++)e.cell.image[t]&&this.parent.notify("createImageElement",{options:{src:e.cell.image[t].src,imageId:e.cell.image[t].id,height:e.cell.image[t].height,width:e.cell.image[t].width,top:e.cell.image[t].top,left:e.cell.image[t].left},range:zi([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),this.parent.allowChart&&e.lastCell&&this.parent.notify("refreshChart",{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),this.applyStyle(e,s),this.parent.allowConditionalFormat&&e.lastCell&&this.parent.notify("checkConditionalFormat",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td}),"Row"===e.checkNextBorder){const t=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===t||e.cell&&e.cell.style&&e.cell.style.bottomPriority||this.parent.notify(rn,{style:{borderBottom:t},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){const t=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===t||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||this.parent.notify(rn,{style:{borderRight:t},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if(e.cell&&e.cell.hyperlink&&!Dr(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)){let t;"string"==typeof e.cell.hyperlink?(t=e.cell.hyperlink,0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("ftp://")&&(e.cell.hyperlink=0===t.toLowerCase().indexOf("www.")?"http://"+t:t)):(t=e.cell.hyperlink.address,0!==t.indexOf("http://")&&0!==t.indexOf("https://")&&0!==t.indexOf("ftp://")&&(e.cell.hyperlink.address=0===t.toLowerCase().indexOf("www.")?"http://"+t:t)),this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx})}if(e.cell&&e.cell.wrap){const i=Xs(t,e.rowIdx);this.parent.notify("wrapText",{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:t,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&i>20})}}applyStyle(e,t){(Object.keys(t).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(rn,{style:Object(r.L)({},this.parent.commonCellStyle,t),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate})}calculateFormula(e){const t=hs(e.cell.formula);this.parent.notify(an,{action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:t,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing}),e.cell.value=Cs(e.rowIdx,e.colIdx,Object(r.Z)(e.sheetIndex)?this.parent.getActiveSheet():Fs(this.parent,e.sheetIndex)).value}checkMerged(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){const t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){const i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(hn,i);const n=this.parent.frozenRowCount(t),s=this.parent.frozenColCount(t);let r;r=t.frozenRows&&t.frozenColumns?i.range[0]<n&&i.range[1]<s?e.rowIdx<n&&e.colIdx<s:i.range[0]<n?e.rowIdx<n:!(i.range[1]<s)||e.colIdx<s:n?i.range[0]>=n||e.rowIdx<n:i.range[1]>=s||e.colIdx<s,r&&(e.td.style.display="none")}else e.td.style.display="none";return e.cell.colSpan<0&&(this.parent.notify("checkPrevMerge",e),e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop})),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify("checkPrevMerge",e),e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),!0}return!1}mergeFreezeRow(e,t,i,n,s,a){const o=this.parent.frozenRowCount(e);if(o&&t<o&&t+(n-1)>=o){let l,h,c=0;const d=this.parent.frozenColCount(e),p=s||this.parent.getRow(t,null,i),g=[].slice.call(p.parentElement.querySelectorAll(".e-empty"));if(a){const s=t+n-o;if(s<g.length)return;{let a=0;if(s===g.length){let n,r,l;for(d&&i<d?(r=Bi(e.topLeftCell)[1],l=d):(r=this.parent.viewport.leftIndex+d,l=this.parent.viewport.rightIndex);r<l;r++)r!==i&&(n=Cs(t,r,e,!1,!0),n.rowSpan&&t+n.rowSpan-o>a&&(a=t+n.rowSpan-o));if(a===s)return}else a=s;let l=t+(n-1);for(let t=a,i=g.length;t<i;t++)c+=Xs(e,l),l--,Object(r.J)(g.pop());return this.updateSpanTop(i,d,c,!0),void(g.length||this.updateColZIndex(i,d,!0))}}this.updateColZIndex(i,d);for(let i=o,s=t+(n-1);i<=s;i++)h=Xs(e,i),c+=-h,o+g.length>i||(l=p.cloneNode(),l.classList.add("e-empty"),l.style.visibility="hidden",l.style.height=h+"px",p.parentElement.appendChild(l));this.updateSpanTop(i,d,c)}}updateSpanTop(e,t,i,n){const s=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(s.style.top,10))return;i=parseInt(s.style.top,10)+i}if(t&&e<t&&(n||!parseInt(s.style.top,10)||i<parseInt(s.style.top,10))){s.style.top=i+"px";const e=s.nextElementSibling;e&&(e.style.top=i+"px")}}mergeFreezeCol(e,t,i,n,s){const a=this.parent.frozenColCount(e);if(a&&i<a&&i+(n-1)>=a){let o,l;const h=this.parent.frozenRowCount(e),c=(t<h?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),d=[].slice.call(c.querySelectorAll(".e-empty"));if(s){const s=i+n-a;if(s<d.length)return;{let n=0;if(s===d.length){let r,o,l;for(h&&t<a?(o=h,l=Bi(e.topLeftCell)[0]):(o=this.parent.viewport.bottomIndex,l=this.parent.viewport.topIndex+h);l<o;l++)l!==t&&(r=Cs(l,i,e,!1,!0),r.colSpan&&i+r.colSpan-a>n&&(n=i+r.colSpan-a));if(n===s)return}else n=s;for(let e=n,t=d.length;e<t;e++)Object(r.J)(d.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(d.length||this.updateRowZIndex(t,h,!0))}}this.updateRowZIndex(t,h);for(let t=a,s=i+(n-1);t<=s;t++)a+d.length>t||(o=c.childNodes[0].cloneNode(),o.classList.add("e-empty"),o.style.visibility="hidden",l=er(e,t,null,!0),o.style.width=l+"px",c.appendChild(o),t===s&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}}updateColZIndex(e,t,i){e<t?this.updateSelectAllZIndex(i):(this.parent.getColumnHeaderContent().style.zIndex=i?"":"2",this.updatedHeaderZIndex(i))}updateSelectAllZIndex(e){const t=this.parent.element.querySelector(".e-frozen-row"),i=this.parent.element.querySelector(".e-frozen-column");e?(this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),i&&(i.style.zIndex="")):this.parent.getRowHeaderContent().style.zIndex||this.parent.getColumnHeaderContent().style.zIndex?(this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),i&&(i.style.zIndex="4")):this.parent.getSelectAllContent().style.zIndex="2"}updatedHeaderZIndex(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";const e=this.parent.element.querySelector(".e-frozen-row"),t=this.parent.element.querySelector(".e-frozen-column");t&&(t.style.zIndex="4"),e&&(e.style.zIndex="4")}}updateRowZIndex(e,t,i){e<t?this.updateSelectAllZIndex(i):(this.parent.getRowHeaderContent().style.zIndex=i?"":"2",this.updatedHeaderZIndex(i))}processTemplates(e,t,i){const n=this.parent.getActiveSheet(),s=n.ranges;let r;for(let a=0,o=s.length;a<o;a++)if(s[a].template&&(r=Ni(s[a].address.length?s[a].address:s[a].startCell),r[0]<=t&&r[1]<=i&&r[2]>=t&&r[3]>=i)){if(e)return this.compileCellTemplate(s[a].template,e);if(!Cs(t,i,n,!0))return this.compileCellTemplate(s[a].template,Cs(t,i,n,null,!0))}return""}compileCellTemplate(e,t){let i;if("string"==typeof e){let n;return n=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,i=Object(r.F)(n),i(t,null,null,"",!0)[0].outerHTML}return i=Object(r.F)(e),i(t,this.parent,"ranges","")[0]}updateRowHeight(e){if(e.cell&&e.cell.children.length){const t=e.cell.cloneNode(!0);t.style.width=er(e.sheet,e.colIdx,!0)+"px",this.tableRow.appendChild(t)}if(e.lastCell&&this.tableRow.childElementCount){const t=e.row||this.parent.getRow(e.rowIdx),i=Xs(e.sheet,e.rowIdx),n=this.getRowHeightOnInit();if(n>i){const i=Rr(n);t.style.height=`${i}px`,(e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height=`${i}px`,$s(e.sheet,e.rowIdx,n)}this.tableRow.innerHTML=""}}getRowHeightOnInit(){const e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);const t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t}removeStyle(e,t,i){let n;if(e.style.length){n=this.parent.getCellStyleValue(["borderLeft","border"],[t,i+1]);const s=n.borderLeft||n.border;n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,i]);const r=n.borderTop||n.border;s||r?[].slice.call(e.style).forEach(t=>{s&&r?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!s||t.indexOf("border-right")>-1||r&&"none"!==r)&&(!r||t.indexOf("border-bottom")>-1||s&&"none"!==s)||e.style.removeProperty(t)}):e.removeAttribute("style")}const s=this.parent.getCell(t-1,i);if(s&&s.style.borderBottom){const e=Number(s.parentElement.getAttribute("aria-rowindex"))-1;n=this.parent.getCellStyleValue(["borderBottom","border"],[e,i]),n.borderBottom||n.border||(s.style.borderBottom="")}const r=e.previousElementSibling;r&&r.style.borderRight&&(i=Number(r.getAttribute("aria-colindex"))-1,n=this.parent.getCellStyleValue(["borderRight","border"],[t,i]),n.borderRight||n.border||(r.style.borderRight=""))}refreshRange(e,t,i){const n=this.parent.getActiveSheet(),s=e.slice();let r,a;if(dr(this.parent,s,!0))for(let o=s[0];o<=s[2];o++)if(!Ys(n,o))for(let e=s[1];e<=s[3];e++)ir(n,e)||(a=this.parent.getCell(o,e),a&&(r={rowIdx:o,colIdx:e,td:a,cell:Cs(o,e,n),isRefreshing:t,lastCell:e===s[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""},this.update(r),this.parent.notify("renderFilterCell",{td:a,rowIndex:o,colIndex:e}),i&&this.setWrapByValue(n,r)))}refresh(e,t,i,n){const s=this.parent.getActiveSheet();if((n||!Ys(s,e)&&!ir(s,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){const r=n||this.parent.getCell(e,t);if(!r)return;this.update({rowIdx:e,colIdx:t,td:r,cell:Cs(e,t,s),lastCell:i,isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""}),this.parent.notify("renderFilterCell",{td:r,rowIndex:e,colIndex:t})}}updateView(e){Object(r.Z)(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex?this.refreshRange(e.indexes,e.refreshing,e.checkWrap):e.refreshing&&this.calculateFormula({cell:Cs(e.indexes[0],e.indexes[1],Fs(this.parent,e.sheetIndex),!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})}}class Va{constructor(e){this.parent=e,this.addEventListener()}render(e){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify("ribbon",null),this.parent.notify("formulaBar",null));const t=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});if(this.parent.enableRtl&&t.classList.add("e-rtl"),this.parent.element.appendChild(t),this.parent.showSheetTabs)this.parent.notify("sheetTabs",null);else{const e=Hs(this.parent,0);this.parent.notify(an,{action:"addSheet",sheetName:"Sheet1",index:1,visibleName:e}),this.parent.notify(an,{action:"initiateDefinedNames"})}this.parent.isMobileView()&&(this.parent.notify("formulaBar",null),this.parent.notify("ribbon",null)),(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),this.setSheetPanelSize(),this.renderSheet(t),this.checkTopLeftCell(!0,e)}checkTopLeftCell(e,t){const i=this.parent.getActiveSheet();this.parent.showSpinner();let n="A1"===i.topLeftCell;const s=Bi(i.topLeftCell);let r;if(i.topLeftCell!==i.paneTopLeftCell&&(i.frozenRows||i.frozenColumns)){const e=Bi(i.paneTopLeftCell);r=this.parent.scrollSettings.enableVirtualization,n=i.frozenRows&&i.frozenColumns?s[0]+i.frozenRows===e[0]&&s[1]+i.frozenColumns===e[1]:i.frozenRows?s[0]+i.frozenRows===e[0]&&0===s[1]:s[1]+i.frozenColumns===e[1]&&0===s[0],this.parent.viewport.beforeFreezeHeight=s[0]&&e[0]>s[0]?Ks(i,0,s[0]-1,!0):0,this.parent.viewport.beforeFreezeWidth=s[1]&&e[1]>s[1]?tr(i,0,s[1]-1,!0):0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;if(!this.parent.scrollSettings.enableVirtualization||n)this.refreshUI({rowIndex:s[0],colIndex:s[1],refresh:"All"},null,e,t),r&&(this.parent.viewport.topIndex=Vr(i,0,!0),this.parent.viewport.leftIndex=Vr(i,0,!0,"columns"));else{const n=i.paneTopLeftCell===i.topLeftCell?s:Bi(i.paneTopLeftCell),a=this.parent.frozenRowCount(i),o=this.parent.frozenColCount(i),l={preventScroll:!0};l.scrollTop=n[0]>a?Ks(i,a||0,n[0]-1):0,l.scrollLeft=n[1]>o?tr(i,o||0,n[1]-1):0,this.parent.notify("onContentScroll",l);let h=this.parent.getThreshold("row");const c=i.frozenRows?s[0]:s[0]>h?Vr(i,s[0]-h,!0):0,d=[];i.frozenRows&&d.push(n[0]-h>a?n[0]-h:a),h=this.parent.getThreshold("col");const p=i.frozenColumns?s[1]:s[1]>h?Vr(i,s[1]-h,!0,"columns"):0;i.frozenColumns?(d.length||d.push(a),d.push(n[1]-h>o?n[1]-h:o)):d.length&&d.push(o),this.refreshUI({rowIndex:c,colIndex:p,refresh:"All",top:l.scrollTop,left:l.scrollLeft,frozenIndexes:d},null,e,t),r&&(d[0]>=a&&(this.parent.viewport.topIndex=Vr(i,d[0]-a,!0)),d[1]>=o&&(this.parent.viewport.leftIndex=Vr(i,d[1]-o,!0,"columns")))}}renderSheet(e=document.getElementById(this.parent.element.id+"_sheet_panel")){e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()}refreshUI(e,t,i,n){"All"!==e.refresh&&this.parent.showSpinner();const s=this.parent.serviceLocator.getService("sheet"),a=this.parent.getActiveSheet(),o=Hs(this.parent),l={rowCount:a.rowCount,colCount:a.colCount};if(e.frozenIndexes=e.frozenIndexes?e.frozenIndexes:[],!t)if(this.parent.scrollSettings.enableVirtualization){let i=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),n=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col");const s=this.parent.frozenRowCount(a),o=this.parent.frozenColCount(a);e.frozenIndexes.length&&(i+=e.frozenIndexes[0]-s,n+=e.frozenIndexes[1]-o),i+=a.frozenRows,n+=a.frozenColumns;let l=a.rowCount-1,h=0;this.parent.scrollSettings.isFinite&&i>l&&(h=i-l,i=l,h&&!Object(r.Z)(this.parent.viewport.topIndex)&&(h=this.parent.viewport.topIndex-h>-1?this.parent.viewport.topIndex-h:0,this.parent.viewport.topIndex=e.rowIndex=this.skipHiddenIdx(h,!0))),l=a.colCount-1,h=0,this.parent.scrollSettings.isFinite&&n>l&&(h=n-l,n=l,h&&!Object(r.Z)(this.parent.viewport.leftIndex)&&(h=this.parent.viewport.leftIndex-h>-1?this.parent.viewport.leftIndex-h:0,this.parent.viewport.leftIndex=e.colIndex=this.skipHiddenIdx(h,!0,"columns")));let c=this.parent.skipHidden(e.rowIndex,i);if(e.rowIndex!==c[0]){const t=Bi(a.topLeftCell);t[0]===e.rowIndex&&this.parent.updateTopLeftCell(c[0],t[1],"row"),e.rowIndex=c[0]}let d=e.rowIndex;i=c[1];const p=Bi(a.topLeftCell);c=this.parent.skipHidden(e.colIndex,n,"columns"),e.colIndex!==c[0]&&(p[1]===e.colIndex&&this.parent.updateTopLeftCell(p[0],c[0],"col"),e.colIndex=c[0]);let g=e.colIndex;n=c[1],"Row"===e.refresh&&(d+=s,s&&(i+=p[0])),"Column"===e.refresh&&(g+=o,o&&(n+=p[1])),this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=i,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=n,t=`${_i(d,g)}:${_i(i,n)}`}else{if("All"===e.refresh){const t=Bi(a.topLeftCell),i=Bi(a.paneTopLeftCell);if(a.frozenRows){const t=this.parent.frozenRowCount(a);i[0]>t&&(e.top=Ks(a,t,i[0]-1))}else e.rowIndex=0,0!==t[0]&&(e.top=Ks(a,0,t[0]-1));if(a.frozenColumns){const t=this.parent.frozenRowCount(a);i[1]>t&&(e.left=tr(a,t,i[1]-1))}else e.colIndex=0,0!==t[1]&&(e.left=tr(a,0,t[1]-1))}this.parent.viewport.bottomIndex=a.rowCount-1,this.parent.viewport.rightIndex=a.colCount-1,t=`${_i(e.rowIndex,e.colIndex)}:${_i(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex)}`}"All"===e.refresh&&this.parent.trigger("beforeDataBound",{}),kr(this.parent.getMainContent(),{busy:!0});const h=this.parent.sheets.length;Is(this.parent,`${o}!${t}`,null,null,e.frozenIndexes).then(r=>{if(h<this.parent.sheets.length)return;const o=this.parent.sheets.indexOf(a);if(-1===o||o!==this.parent.activeSheetIndex)return void(o>-1&&this.checkTopLeftCell());const c=[e.rowIndex,e.colIndex,...Bi(t.split(":")[1])];let d,p;switch(e.refresh){case"All":s.renderTable({cells:r,indexes:c,top:e.top,left:e.left,initLoad:i,isRefreshing:n});break;case"Row":s.refreshRowContent({cells:r,indexes:c,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l}),d=!1,p={isEdit:!1},this.parent.notify("isFormulaBarEdit",p),p.isEdit&&this.parent.notify(un,{action:"startEdit",refreshCurPos:!1});break;case"Column":s.refreshColumnContent({cells:r,indexes:c,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l});break;case"RowPart":s.updateRowContent({cells:r,indexes:c,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l});break;case"ColumnPart":s.updateColContent({cells:r,indexes:c,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l})}this.parent.isReact&&this.parent.renderReactTemplates()}),this.parent.notify("beforeVirtualContentLoaded",{refresh:e.refresh,skipTranslate:e.skipTranslate})}skipHiddenIdx(e,t,i="rows",n=this.parent.getActiveSheet()){return n[i][e]&&n[i][e].hidden&&(e=t?++e:--e,e=this.skipHiddenIdx(e,t,i,n)),e}removeSheet(){Object(r.kb)(document.getElementById(this.parent.element.id+"_sheet"))}refreshSheet(e){this.removeSheet(),this.renderSheet(),this.parent.notify("deInitProperties",{}),this.checkTopLeftCell(!1,e)}setSheetPanelSize(){const e=document.getElementById(this.parent.element.id+"_sheet_panel"),t=this.parent.element.getBoundingClientRect();let i;"auto"===this.parent.height?(e.style.height="260px",i=230):(i=t.height-hr(e),e.style.height=`${i}px`,i-=32),this.parent.viewport.height=i,this.parent.viewport.width=t.width-32,this.parent.viewport.rowCount=this.roundValue(i,20),this.parent.viewport.colCount=this.roundValue(t.width,64)}roundValue(e,t){const i=e/t,n=Math.round(i);return Math.abs(i-n)<.5?n:n-1}moveOrDuplicateSheetHandler(e){this.parent.notify("refreshSheetTabs",null),e.refresh&&this.refreshSheet(e.isDuplicate)}instantiateRenderer(){this.parent.serviceLocator.register("cell",new za(this.parent)),this.parent.serviceLocator.register("row",new _a(this.parent)),this.parent.serviceLocator.register("sheet",new Ha(this.parent))}destroy(){this.removeEventListener(),this.parent=null}addEventListener(){this.parent.on("initialLoad",this.instantiateRenderer,this),this.parent.on("dataRefresh",this.refreshSheet,this),this.parent.on("spreadsheetDestroyed",this.destroy,this),this.parent.on("moveOrDuplicateSheet",this.moveOrDuplicateSheetHandler,this)}removeEventListener(){this.parent.off("initialLoad",this.instantiateRenderer),this.parent.off("dataRefresh",this.refreshSheet),this.parent.off("spreadsheetDestroyed",this.destroy),this.parent.off("moveOrDuplicateSheet",this.moveOrDuplicateSheetHandler)}}class Ua{constructor(e){this.parent=e}show(e,t){let i;t=!!Object(r.Z)(t);const n=e.close||null,s={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=()=>{this.destroyDialog(),n&&n()},Object(r.L)(s,e),t&&(i=this.parent.serviceLocator.getService(Da).getConstant(s.buttons.length?"Cancel":"Ok"),s.buttons.push({buttonModel:{content:i,isPrimary:0===s.buttons.length},click:this.hide.bind(this)}));const a=this.parent.createElement("div");document.body.appendChild(a),this.dialogInstance=new g.a(s),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(a),this.dialogInstance.refreshPosition()}destroyDialog(){this.dialogInstance.destroy(),Object(r.kb)(this.dialogInstance.element),this.dialogInstance=null}hide(){this.dialogInstance&&this.dialogInstance.hide()}destroy(){this.parent=null}}class qa{constructor(e){this.parent=e,this.addEventListener()}initializeActionBegin(){const e=this.parent.beforeCellFormat;this.parent.beforeCellFormat=t=>{this.actionEventHandler({evtArgs:t,evtFunc:e,actionType:"begin",eventType:"format"})};const t=this.parent.beforeOpen;this.parent.beforeOpen=e=>{this.actionEventHandler({evtArgs:e,evtFunc:t,actionType:"begin",eventType:"beforeOpen"})};const i=this.parent.beforeSave;this.parent.beforeSave=e=>{this.actionEventHandler({evtArgs:e,evtFunc:i,actionType:"begin",eventType:"beforeSave"})};const n=this.parent.beforeSort;this.parent.beforeSort=e=>{this.actionEventHandler({evtArgs:e,evtFunc:n,actionType:"begin",eventType:"beforeSort"})}}initializeActionComplete(){const e=this.parent.sortComplete;this.parent.sortComplete=t=>{this.actionEventHandler({evtArgs:t,evtFunc:e,actionType:"complete",eventType:"sorting"})};const t=this.parent.cellSave;this.parent.cellSave=e=>{this.actionEventHandler({evtArgs:e,evtFunc:t,actionType:"complete",eventType:"cellSave"})}}actionEventHandler(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})}actionBeginHandler(e){this.parent.trigger("actionBegin",{action:e.action,args:e}),"clipboard"!==e.action&&"beforeSort"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"filter"!==e.action&&"cellDelete"!==e.action||this.parent.notify("setActionData",{args:e})}actionCompleteHandler(e){this.parent.notify("triggerDataChange",e),this.parent.trigger("actionComplete",e),"undoRedo"!==e.action&&"gotoSheet"!==e.action&&this.parent.notify("updateUndoRedoCollection",{args:e})}addEventListener(){this.parent.on(Cn,this.actionCompleteHandler,this),this.parent.on(vn,this.actionBeginHandler,this)}removeEventListener(){this.parent.off(Cn,this.actionCompleteHandler),this.parent.off(vn,this.actionBeginHandler)}}class Wa{constructor(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e}insertOverlayElement(e,t,i){const n=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),s=Ni(t),r=this.parent.sheets[i],a=this.parent.frozenRowCount(r),o=this.parent.frozenColCount(r),l=pr(r,s,a,o,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);if(s[0]>=a&&s[1]<o){const e=this.parent.sheetModule.contentPanel;e.scrollTop&&(l.top-=e.scrollTop,l.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(s[1]>=o&&s[0]<a){const e=this.parent.getScrollElement();e.scrollLeft&&(l.left-=e.scrollLeft,l.left+=this.parent.sheetModule.getRowHeaderWidth(r))}let h;return s[0]<a||s[1]<o?(h=document.getElementById(this.parent.element.id+"_sheet"),a&&(s[0]>=a?l.top+=(r.showHeaders?31:0)+Ks(r,Bi(r.topLeftCell)[0],a-1):o||(l.left+=this.parent.sheetModule.getRowHeaderWidth(r,!0))),o&&(s[1]>=o?l.left+=this.parent.sheetModule.getRowHeaderWidth(r):a||(l.left+=r.showHeaders?31:0))):h=this.parent.getMainContent(),n.style.top=l.top+"px",n.style.left=l.left+"px",h.appendChild(n),this.renderResizeHandles(n),this.addEventListener(n),this.originalWidth=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px","")),n}adjustFreezePaneSize(e,t,i){const n=Ni(i),s=this.parent.getActiveSheet(),a=this.parent.frozenRowCount(s),o=this.parent.frozenColCount(s);if(n[0]<a||n[1]<o?(Object(r.Z)(e.top)||(t.style.top=e.top+(s.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),Object(r.Z)(e.left)||(t.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(s,!0)-this.parent.viewport.beforeFreezeWidth+"px")):(Object(r.Z)(e.top)||(t.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(a?Ks(s,Bi(s.topLeftCell)[0],a-1):0)+"px"),Object(r.Z)(e.left)||(t.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(o?tr(s,Bi(s.topLeftCell)[1],o-1):0)+"px")),Object(r.Z)(e.top)){const t=Bi(s.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(a&&t===n[0]?0:Ks(s,a?t:0,n[0]-1))}if(Object(r.Z)(e.left)){const t=Bi(s.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(o&&t===n[1]?0:tr(s,o?t:0,n[1]-1))}}addEventListener(e){const t=e;r.l.add(t,"mousedown",this.overlayClickHandler,this),r.l.add(t,"mousemove",this.overlayMouseMoveHandler,this),r.l.add(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler,this),r.l.add(document,"mouseup",this.overlayMouseUpHandler,this),this.parent.on("overlayEleSize",this.setOriginalSize,this)}setOriginalSize(e){this.originalHeight=e.height,this.originalWidth=e.width}overlayMouseMoveHandler(e){const t=e.target,i=document.getElementsByClassName("e-ss-overlay-active")[0],n=this.parent.getActiveSheet(),s=n.frozenRows||n.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(n,!0)]:[-1,-1];let a,o,l,h,c,d;if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":a=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),o=e.clientY-(this.originalMouseY-this.originalResizeTop),a>180&&o>s[0]&&(i.style.height=a+"px",i.style.top=o+"px",this.resizedReorderTop=o,this.currenHeight=a,this.parent.notify("refreshChartSize",{height:i.style.height,width:i.style.width,overlayEle:i}));break;case"e-ss-overlay-r":l=this.originalWidth+(e.pageX-this.originalMouseX),l>180&&(i.style.width=l+"px",this.currentWidth=l,this.parent.notify("refreshChartSize",{height:i.style.height,width:i.style.width,overlayEle:i}));break;case"e-ss-overlay-b":h=this.originalHeight+(e.pageY-this.originalMouseY),h>180&&(i.style.height=h+"px",this.currenHeight=h,this.parent.notify("refreshChartSize",{height:i.style.height,width:i.style.width,overlayEle:i}));break;case"e-ss-overlay-l":c=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),d=e.clientX-(this.originalMouseX-this.originalResizeLeft),c>180&&d>s[1]&&(i.style.width=c+"px",i.style.left=d+"px",this.resizedReorderLeft=d,this.currentWidth=c,this.parent.notify("refreshChartSize",{height:i.style.height,width:i.style.width,overlayEle:i}))}else if(this.isOverlayClicked)if(Object(r.D)(t,".e-sheet")&&!t.classList.contains("e-sheet-content")||t.classList.contains("e-cell")){if(!i)return;const t=e.clientX-this.diffX,n=e.clientY-this.diffY;t>s[1]&&(i.style.left=t+"px"),n>s[0]&&(i.style.top=n+"px"),this.resizedReorderLeft=t<0?0:t,this.resizedReorderTop=n<0?0:n}else this.overlayMouseUpHandler(e,!0)}overlayMouseUpHandler(e,t){if(this.parent.getActiveSheet().isProtected)return;this.isResizerClicked=!1;let i=e.target;const n=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");i.classList.contains("e-ss-overlay")||(i=Object(r.D)(e.target,".e-datavisualization-chart")?Object(r.D)(e.target,".e-datavisualization-chart"):i);const s=this.parent.getActiveSheet(),a={prevTop:s.frozenRows||s.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:s.frozenRows||s.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?this.resizedReorderLeft:this.originalReorderLeft,id:i.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||t){let e,t;const o={clientY:a.prevTop,isImage:!0},l={clientX:a.prevLeft,isImage:!0},h=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(s.frozenRows||s.frozenColumns){if(!h)return;o.isImage=!1,l.isImage=!1,o.target=h,l.target=h,a.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(o.target=this.parent.getColumnHeaderContent()),a.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable());const i=h.getBoundingClientRect();e={clientY:i.top},t={clientX:i.left},i.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(e.target=this.parent.getColumnHeaderContent()),i.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(t.target=this.parent.getRowHeaderTable())}else e={clientY:a.currentTop,isImage:!0},t={clientX:a.currentLeft,isImage:!0};if(this.parent.notify("getRowIdxFromClientY",o),this.parent.notify("getRowIdxFromClientY",e),this.parent.notify("getColIdxFromClientX",l),this.parent.notify("getColIdxFromClientX",t),e.size&&(a.currentTop=e.size),t.size&&(a.currentLeft=t.size),a.prevRowIdx=o.clientY,a.prevColIdx=l.clientX,a.currentRowIdx=e.clientY,a.currentColIdx=t.clientX,(s.frozenColumns||s.frozenRows)&&!Object(r.D)(h,".e-sheet-content")){const e=this.parent.frozenColCount(s),t=this.parent.frozenRowCount(s);if(a.currentRowIdx>=t&&a.currentColIdx>=e){let e=parseInt(h.style.top,10),t=parseInt(h.style.left,10);e+=this.parent.sheetModule.contentPanel.scrollTop,e-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,t+=this.parent.getScrollElement().scrollLeft,t-=this.parent.sheetModule.getRowHeaderWidth(s),h.style.top=e+"px",h.style.left=t+"px",this.parent.getMainContent().appendChild(h)}}n&&n[0]&&n[0].querySelector(".e-control")&&(a.id=n[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(a.id=h.id,n&&n[0]?(a.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",a)):this.parent.notify("refreshImgCellObj",a),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(a.id=i.id.indexOf("overlay")>0?i.id:i.parentElement?i.parentElement.id:"",n&&n[0]?(a.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",a)):this.parent.notify("refreshImgCellObj",a),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}overlayClickHandler(e){if(this.parent.getActiveSheet().isProtected)return;this.isOverlayClicked=!0;const t=e.target;let i=e.target;t.classList.contains("e-ss-overlay")||(i=t.parentElement,Object(r.D)(e.target,".e-datavisualization-chart")&&(i=Object(r.D)(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px",""))));const n=this.parent.getActiveSheet();if((n.frozenColumns||n.frozenRows)&&Object(r.D)(i,".e-sheet-content")){let e=parseInt(i.style.top,10),t=parseInt(i.style.left,10);e-=this.parent.sheetModule.contentPanel.scrollTop,e+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,t-=this.parent.getScrollElement().scrollLeft,t+=this.parent.sheetModule.getRowHeaderWidth(n),i.style.top=e+"px",i.style.left=t+"px",document.getElementById(this.parent.element.id+"_sheet").appendChild(i)}this.originalReorderLeft=parseInt(i.style.left,10),this.originalReorderTop=parseInt(i.style.top,10),this.resizedReorderLeft=parseInt(i.style.left,10),this.resizedReorderTop=parseInt(i.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;const s=document.getElementsByClassName("e-ss-overlay-active")[0];s&&Object(r.lb)([s],"e-ss-overlay-active"),document.getElementById(i.id).classList.add("e-ss-overlay-active"),t.classList.contains("e-ss-resizer")&&(this.resizer=t.classList[0],this.originalWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),i.classList.contains("e-datavisualization-chart")&&(this.parent.notify("focusChartBorder",{id:i.id}),s||this.parent.notify("insertDesignChart",{id:i.id}));const a=i.getBoundingClientRect();this.prevX=a.left,this.prevY=a.top}renderResizeHandles(e){const t=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"];let i,n=0;const s=e;for(;t.length>n;)i=this.parent.createElement("div",{attrs:{class:t[n]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),s.appendChild(i),n++}removeEventListener(){const e=document.getElementById(this.parent.element.id+"_overlay");e&&(r.l.remove(e,"mousedown",this.overlayClickHandler),r.l.remove(e,"mousemove",this.overlayMouseMoveHandler)),r.l.remove(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler),r.l.remove(document,"mouseup",this.overlayMouseUpHandler),this.parent.off("overlayEleSize",this.setOriginalSize)}destroy(){this.removeEventListener(),this.parent=null}}var Za,Ga=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};let Ya=(()=>{let e=Za=class extends Ws{constructor(e,t){super(e),this.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0},this.needsID=!0,Za.Inject(ba,ya,Ca,Gr,Zr,$r,Kr,Wr,gn,va,wa,Sa,Ia,Jr,xa,sa,Gn,In,On,Zn,cn,zn,Oa,Vn,Qr,na,Un,Ra,ia,Yn,ra,aa,Xn,$n,oa,Kn,la,Qn,ha,Jn,ca,es,Aa,da,qn,ts,ka,Wn),t&&this.appendTo(t)}getCell(e,t,i){return i||(i=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),i?i.cells[t]:i}getRow(e,t,i){if(!t){const n=this.getActiveSheet(),s=this.frozenRowCount(n),a=this.frozenColCount(n);t=Object(r.Z)(i)||e>s-1&&i>a-1?this.getContentTable():e<s&&i<a?this.sheetModule.getSelectAllTable():e<s?this.getColHeaderTable():this.getRowHeaderTable()}return e=this.getViewportIndex(e),t?t.rows[e]:null}hiddenCount(e,t,i="rows",n=this.getActiveSheet()){let s=0;for(let r=e;r<=t;r++)n[i][r]&&n[i][r].hidden&&s++;return s}getViewportIndex(e,t){const i=this.getActiveSheet();if(t){const t=this.frozenColCount(i);if(t){const n=Bi(i.topLeftCell)[1];if(e<t)return e-n+1;e-=t}}else{const t=this.frozenRowCount(i);if(t){const n=Bi(i.topLeftCell)[0];if(e<t)return e-n+1;e-=t}}return this.scrollSettings.enableVirtualization&&(t?(e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex):(e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex)),e}preRender(){super.preRender(),this.serviceLocator=new Vs,this.initServices()}initServices(){this.serviceLocator.register(Da,new r.q(this.getModuleName(),Ba,this.locale)),this.serviceLocator.register(Ma,new Ua(this)),this.serviceLocator.register("actionEvents",new qa(this)),this.serviceLocator.register(Fa,new Wa(this))}render(){super.render(),this.element.setAttribute("tabindex","0"),kr(this.element,{role:"grid"}),this.renderModule=new Va(this),this.notify("initialLoad",null),this.renderSpreadsheet(),this.wireEvents(),this.created&&(this.created.observers?this.created.observers.length>0&&(this.createdHandler={observers:this.created.observers},this.created.observers=[]):(this.createdHandler=this.created,this.setProperties({created:void 0},!0)))}renderSpreadsheet(){this.cssClass&&Object(r.w)([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),Object(g.f)({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new Yr(this)),this.scrollSettings.enableVirtualization&&new Xr(this),this.renderModule.render(this.refreshing),new ta(this)}showSpinner(){Object(g.l)(this.element)}hideSpinner(){Object(g.j)(this.element)}protectSheet(e,t){"string"==typeof e&&(e=Ls(this,e)),e&&(this.setSheetPropertyOnMute(this.sheets[e],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[e],"protectSettings",t)),e=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),super.protectSheet(e,t)}unprotectSheet(e){"string"==typeof e&&(e=Ls(this,e)),e?this.sheets[e].isProtected=!1:this.getActiveSheet().isProtected=!1,super.unprotectSheet(e)}find(e){const t=this.getActiveSheet().activeCell;if(super.findHandler(e),!e.isAction)return t!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null}replace(e){super.replaceHandler(e={value:e.value,mode:e.mode?e.mode:"Sheet",isCSen:!!e.isCSen&&e.isCSen,isEMatch:!!e.isEMatch&&e.isEMatch,searchBy:e.searchBy?e.searchBy:"By Row",replaceValue:e.replaceValue,replaceBy:e.replaceBy,sheetIndex:e.sheetIndex?e.sheetIndex:this.activeSheetIndex,findOpt:e.findOpt?e.findOpt:""})}findAll(e,t,i,n,s){const r=[];return this.notify("findAllValues",{value:e,mode:t=t||"Sheet",sheetIndex:s=s||this.activeSheetIndex,isCSen:i=i||!1,isEMatch:n=n||!1,findCollection:r}),r}goTo(e){if(e.includes("!")){const t=e.split("!"),i=Ls(this,t[0]);if(void 0===i)return;if(i!==this.activeSheetIndex){const e=t[1].split(":")[0],n=this.sheets[i];this.setSheetPropertyOnMute(n,"activeCell",e),this.setSheetPropertyOnMute(n,"selectedRange",t[1]);const s=Bi(e);if(n.frozenColumns||n.frozenRows){const e=Bi(n.topLeftCell);if(!(n.frozenRows&&s[0]<e[0]||n.frozenColumns&&s[1]<e[1])){const t=this.frozenRowCount(n),i=this.frozenColCount(n),r=[],a=[],o=Bi(n.paneTopLeftCell);t?(r.push(e[0]),a.push(s[0]>=t?s[0]:o[0])):(r.push(s[0]),a.push(s[0])),i?(r.push(e[1]),a.push(s[1]>=i?s[1]:o[1])):(r.push(s[1]),a.push(s[1])),this.setSheetPropertyOnMute(n,"topLeftCell",_i(r[0],r[1])),this.setSheetPropertyOnMute(n,"paneTopLeftCell",_i(a[0],a[1]))}}else s[0]<this.viewport.rowCount&&(s[0]=0),s[1]<this.viewport.colCount&&(s[1]=0),this.updateTopLeftCell(s[0],s[1],null,n);return this.activeSheetIndex=i,void this.dataBind()}}const t=Ni(e),i=this.getActiveSheet(),n=this.frozenRowCount(i),s=this.frozenColCount(i),r=this.insideViewport(t[0],t[1]);if(r){this.selectRange(e);let r=Bi(i.paneTopLeftCell),a=this.viewport.height-this.getScrollElement().parentElement.getBoundingClientRect().height,o=0,l=0;if(n)for(let e=Bi(i.topLeftCell)[0];e<n;e++)if(o+=Xs(i,e),o>a){l=e;break}if(0===l)for(let e=r[0];e<this.viewport.bottomIndex;e++)if(o+=Xs(i,e),o>a){l=e;break}r[2]=l;let h=0;if(o=0,a=this.viewport.width-this.sheetModule.getScrollSize(),s)for(let e=Bi(i.topLeftCell)[1];e<s;e++)if(o+=er(i,e),o>a){h=e;break}if(0===h)for(let e=r[1];e<this.viewport.rightIndex;e++)if(o+=er(i,e),o>a){h=e;break}if(r[3]=h,t[0]>=r[0]&&t[0]<r[2]&&t[1]>=r[1]&&t[1]<r[3])return;if(n||s){if(r=[].concat(Bi(i.topLeftCell),[n,r[3]]),t[0]>=r[0]&&t[0]<r[2]&&t[1]>=r[1]&&t[1]<r[3])return;if(r[2]=l,r[3]=s,t[0]>=r[0]&&t[0]<r[2]&&t[1]>=r[1]&&t[1]<r[3])return}}let a,o,l,h,c,d,p=this.getMainContent().parentElement;t[0]===n?l=0:(l=Ks(i,n,t[0]-1,!0),this.scrollSettings.enableVirtualization&&(d=l+this.getContentTable().getBoundingClientRect().height,c=parseFloat(p.querySelector(".e-virtualtrack").style.height),d>c&&(d+=10,a=p.querySelector(".e-virtualtrack"),a.style.height=`${d}px`,nr(()=>{a.style.height=`${c}px`})))),p.scrollTop=l,p=this.element.getElementsByClassName("e-scroller")[0],t[1]===s?l=0:(l=tr(i,s,t[1]-1,!0),this.scrollSettings.enableVirtualization&&(d=l+this.getContentTable().getBoundingClientRect().width,h=parseFloat(p.querySelector(".e-virtualtrack").style.width),d>h&&(d+=10,a=p.querySelector(".e-virtualtrack"),a.style.width=`${d}px`,o=this.getColumnHeaderContent().querySelector(".e-virtualtrack"),o.style.width=`${d}px`,a=this.getMainContent().querySelector(".e-virtualtrack"),a.style.width=`${d}px`,nr(()=>{a.style.width=`${h}px`,o.style.width=`${h}px`})))),p.scrollLeft=l,r||this.selectRange(e)}insideViewport(e,t){const i=this.getActiveSheet();if(i.frozenRows||i.frozenColumns){const n=this.frozenRowCount(i),s=this.frozenColCount(i),r=Bi(i.topLeftCell);return(e>=r[0]&&e<n||e>=this.viewport.topIndex+n&&e<=this.viewport.bottomIndex)&&(t>=r[1]&&t<s||t>=this.viewport.leftIndex+s&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex}resize(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet()}cut(e){const t=new Promise((e,t)=>{e(void 0)});return this.notify("cut",e?{range:Ui(e),sId:this.sheets[Ls(this,js(e))]?this.sheets[Ls(this,js(e))].id:this.getActiveSheet().id,promise:t}:{promise:t}),t}copy(e){const t=new Promise((e,t)=>{e(void 0)});return this.notify("copy",e?{range:Ui(e),sId:this.sheets[Ls(this,js(e))]?this.sheets[Ls(this,js(e))].id:this.getActiveSheet().id,promise:t}:{promise:t}),t}paste(e,t){this.notify(yn,{range:e?Ui(e):e,sIdx:e?Ls(this,js(e)):e,type:t,isAction:!1,isInternal:!0})}updateAction(e){jr(e,this)}setHeight(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=Object(r.M)(this.height)}setWidth(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=Object(r.M)(this.width)}setColWidth(e=64,t=0,i){const n=this.getThreshold("col"),s=this.viewport.leftIndex+this.viewport.colCount+2*n,a=Object(r.Z)(i)?this.getActiveSheet():this.sheets[i];if(a){const i=t,n="number"==typeof e?e+"px":e;if(t=Object(r.Z)(t)?Bi(a.activeCell)[1]:t,a===this.getActiveSheet())if(t>=this.viewport.leftIndex&&t<=s){let e;this.scrollSettings.enableVirtualization&&(t-=this.viewport.leftIndex),e=a.showHeaders?this.getColumnHeaderContent().getElementsByClassName("e-header-cell")[t]:this.getContentTable().getElementsByClassName("e-row")[0].getElementsByClassName("e-cell")[t];const i=er(a,t,null,!0);let s=Rr(parseInt(n,10))-i;s<0&&i<-s&&(Bi(a.activeCell),s=-i);const r=parseInt(e.getAttribute("aria-colindex"),10)-1;this.getActiveSheet()===a&&(this.notify("colWidthChanged",{threshold:s,colIdx:r}),Er(t,t,n,!0,this))}else{const e=er(a,t);let i;i=parseInt(n,10)>0?-(e-parseInt(n,10)):-e,this.notify("colWidthChanged",{threshold:i,colIdx:t})}Js(a,i).width=parseInt(n,10)>0?parseInt(n,10):0,a.columns[i].customWidth=!0}}setRowHeight(e=20,t=0,i,n){const s=Object(r.Z)(i)?this.getActiveSheet():this.sheets[i-1];if(s){const i=t,a="number"==typeof e?e+"px":e;if(t=Object(r.Z)(t)?Bi(s.activeCell)[0]:t,s===this.getActiveSheet())if(t<=this.viewport.bottomIndex&&t>=this.viewport.topIndex){let e;this.scrollSettings.enableVirtualization&&(t-=this.viewport.topIndex),e=s.showHeaders?this.getRowHeaderContent().getElementsByClassName("e-header-cell")[t].parentElement:this.getContentTable().getElementsByClassName("e-row")[t];const i=Xs(s,t,!0);let o=Rr(parseInt(a,10))-i;o<0&&i<-o&&(o=-i);const l=parseInt(e.getAttribute("aria-rowindex"),10)-1;this.getActiveSheet()===s&&(this.notify("rowHeightChanged",{threshold:o,rowIdx:l}),Object(r.Z)(n)&&(n=!1),n||(Er(t,t,a,!1,this),n=!1))}else{const e=Xs(s,t);let i;i=parseInt(a,10)>0?-(e-parseInt(a,10)):-e,this.notify("rowHeightChanged",{threshold:i,rowIdx:t})}$s(s,i,parseInt(a,10)>0?parseInt(a,10):0),s.rows[i].customHeight=!0}}autoFit(e){const t=this.getIndexes(e);let i=t.startIdx,n=t.endIdx;const s=t.isCol,r=s?Hi("XFD"):1048576;if(i<=r)for(n>r&&(n=r);i<=n;i++)this.notify("setAutoFit",{idx:i,isCol:s})}getIndexes(e){let t,i,n,s;if(-1!==e.indexOf(":")){const t=e.split(":");n=t[0],s=t[1]}else n=e,s=e;if(!Object(r.Z)(n)){const e=this.getAddress(n);n=e.address,t=e.isCol}if(!Object(r.Z)(s)){const e=this.getAddress(s);s=e.address,i=e.isCol}const a=!0===t&&!0===i;return{startIdx:a?Hi(n.toUpperCase()):parseInt(n,10),endIdx:a?Hi(s.toUpperCase()):parseInt(s,10),isCol:a}}getAddress(e){let t;return e.substring(0,1).match(/\D/g)?(t=!0,{address:e=e.replace(/[0-9]/g,""),isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:{address:e=(parseInt(e,10)-1).toString(),isCol:t}}addHyperlink(e,t){this.insertHyperlink(e,t,"",!0)}removeHyperlink(e){let t,i,n=this.getActiveSheet();if(e&&-1!==e.indexOf("!")){t=e.split("!");const s=this.sheets;for(let e=0;e<s.length;e++)s[e].name===t[0]&&(i=e);n=this.sheets[i],e=t[1]}const s=Ni(e||this.getActiveSheet().activeCell);for(let r=s[0];r<=s[2];r++)for(let e=s[1];e<=s[3];e++)if(n&&n.rows[r]&&n.rows[r].cells[e]){const t=this.getCell(r,e);let i=[];for(let e=0;e<t.classList.length;e++)i.push(t.classList[e]);this.notify("deleteHyperlink",{sheet:n,rowIdx:r,colIdx:e});for(let n=0;n<i.length;n++)this.getCell(r,e).classList.contains(i[n])||this.getCell(r,e).classList.add(i[n])}}insertHyperlink(e,t,i,n){if(this.allowHyperlink){let s,a,o,l=this.getActiveSheet();o=Ni(t=t||this.getActiveSheet().activeCell);const h=this.getCell(o[0],o[1]);let c=[];for(let e=0;e<h.classList.length;e++)c.push(h.classList[e]);const d={hyperlink:e,cell:t,cancel:!1},p={hyperlink:e,cell:t};if(n||this.trigger("beforeHyperlinkCreate",d),!d.cancel){if(super.addHyperlink(e=d.hyperlink,t=d.cell),t&&-1!==t.indexOf("!")){s=t.split("!");const e=this.sheets;for(let t=0;t<e.length;t++)e[t].name===s[0]&&(a=t);l=this.sheets[a],t=s[1]}if(!l)return;o=Ni(t=t||this.getActiveSheet().activeCell);const h=l.rows[o[0]].cells[o[1]];if(Object(r.Z)(h.value)||""===h.value?Object(r.Z)(i)||""===i||(h.value=i):h.value!==i&&(h.value=i),n||this.trigger("afterHyperlinkCreate",p),l===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(o);for(let e=0;e<c.length;e++)this.getCell(o[0],o[1]).classList.contains(c[e])||this.getCell(o[0],o[1]).classList.add(c[e]);this.notify("refreshRibbonIcons",null)}}}}addDataValidation(e,t){super.addDataValidation(e,t)}removeDataValidation(e){super.removeDataValidation(e)}addInvalidHighlight(e){super.addInvalidHighlight(e)}removeInvalidHighlight(e){super.removeInvalidHighlight(e)}conditionalFormat(e){super.conditionalFormat(e)}clearConditionalFormat(e){e=e||this.getActiveSheet().selectedRange,super.clearConditionalFormat(e)}setPanelSize(){if("auto"!==this.height){const e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-hr(e)+"px"}}open(e){this.isOpen=!0,super.open(e),this.isOpen&&this.showSpinner()}hideRow(e,t=e,i=!0){const n=this.getActiveSheet();!this.renderModule||n.frozenRows||n.frozenColumns?super.hideRow(e,t,i):this.notify("hideShow",{startIndex:e,endIndex:t,hide:i})}hideColumn(e,t=e,i=!0){const n=this.getActiveSheet();!this.renderModule||n.frozenRows||n.frozenColumns?super.hideColumn(e,t,i):this.notify("hideShow",{startIndex:e,endIndex:t,hide:i,isCol:!0})}clear(e){this.notify("clearViewer",{options:e,isPublic:!0})}refresh(e){this.isReact&&this.clearTemplate(),e?this.notify("blankWorkbook",{}):super.refresh()}insertImage(e,t){let i;for(i=0;i<e.length;i++)this.notify("createImageElement",{options:e[i],range:t||this.getActiveSheet().selectedRange,isPublic:!0})}deleteImage(e,t){this.notify("deleteImage",{id:e,range:t||this.getActiveSheet().selectedRange})}getRowHeaderContent(){return this.sheetModule.getRowHeaderPanel()}getColumnHeaderContent(){return this.sheetModule.getColHeaderPanel()}getMainContent(){return this.sheetModule.getContentPanel()}getSelectAllContent(){return this.sheetModule.getSelectAllContent()}getScrollElement(){return this.sheetModule.getScrollElement()}getContentTable(){return this.sheetModule.getContentTable()}getRowHeaderTable(){return this.sheetModule.getRowHeaderTable()}getColHeaderTable(){return this.sheetModule.getColHeaderTable()}getThreshold(e){const t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t}isMobileView(){return(this.cssClass.indexOf("e-mobile-view")>-1||r.d.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1}getValueRowCol(e,t,i,n,s){return super.getValueRowCol(e,t,i,n,s)}updateCell(e,t){t=t||this.getActiveSheet().activeCell,super.updateCell(e,t),this.notify("activeCellChanged",null)}getRowData(e,t){return super.getRowData(e,t)}sort(e,t){return this.allowSorting?super.sort(e,t).then(e=>(this.notify("sortComplete",e),Promise.resolve(e))):Promise.reject()}setValueRowCol(e,t,i,n){if("circular reference: "===t){const e={action:"isCircularReference",argValue:t};this.notify("formulaOperation",e),t=e.argValue}super.setValueRowCol(e,t,i,n),this.notify(un,{action:"refreshDependentCellValue",rowIdx:i,colIdx:n,sheetIdx:Ts(this,e)})}getModuleName(){return"spreadsheet"}refreshNode(e,t){let i;if(e){const n=Object(r.ob)("#"+this.element.id+"_currency",e);let s="e-right-align";if(t){if(t.result=Object(r.Z)(t.result)?"":t.result.toString(),n&&Object(r.J)(n),"Accounting"===t.type&&tn(t.value))return e.querySelector("a")?e.querySelector("a").textContent=t.result.split(t.curSymbol).join(""):e.innerHTML="",e.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:`${t.curSymbol}`,styles:"float: left"})),e.querySelector("a")||(e.innerHTML+=t.result.split(t.curSymbol).join("")),void e.classList.add(s);!t.result||"true"!==t.result.toLowerCase()&&"false"!==t.result.toLowerCase()||(t.result=t.result.toUpperCase(),s="e-center-align",t.isRightAlign=!0),i=t.result,t.isRightAlign?e.classList.add(s):e.classList.remove(s)}if(i=Object(r.Z)(i)?"":i,!Object(r.Z)(e)){let t=e.lastChild;const n=e.querySelector(".e-wrap-content");e.querySelector(".e-databar-value")&&(t=e.querySelector(".e-databar-value").lastChild),e.querySelector(".e-hyperlink")&&(t=e.querySelector(".e-hyperlink").lastChild),n&&(n.lastChild||n.appendChild(document.createTextNode("")),t=n.lastChild),!t||3!==t.nodeType&&1!==t.nodeType?e.appendChild(document.createTextNode(i)):t.nodeValue=i}}}calculateHeight(e,t=1,i=1){const n=e&&e.fontSize||this.cellStyle.fontSize,s="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*s*t+i*s}skipHidden(e,t,i="rows"){const n=this.getActiveSheet();let s;this.scrollSettings.isFinite&&(s=("rows"===i?n.rowCount:n.colCount)-1);for(let r=e;r<=t;r++)if(n[i][r]&&n[i][r].hidden){if(n.frozenColumns||n.frozenRows){"rows"===i?Gs(n,r,{hidden:!1}):Qs(n,r,{hidden:!1});continue}if(e===r&&e++,t++,s&&t>s){t=s;break}}return[e,t]}updateActiveBorder(e,t=".e-ribbon"){const i=Object(r.ob)(`${t} .e-tab-header .e-indicator`,this.element);i.style.display="none",Object(r.rb)(i,{left:"",right:""}),Object(r.rb)(i,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),i.style.display=""}undo(){this.notify("performUndoRedo",{isUndo:!0,isPublic:!0})}redo(){this.notify("performUndoRedo",{isUndo:!1,isPublic:!0})}updateUndoRedoCollection(e){this.notify("updateUndoRedoCollection",{args:e,isPublic:!0})}addDefinedName(e){const t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify("formulaOperation",t),t.isAdded}removeDefinedName(e,t){return super.removeDefinedName(e,t)}mouseClickHandler(e){this.notify("click",e)}mouseDownHandler(e){this.notify("mouseDown",e)}keyUpHandler(e){Object(r.D)(e.target,".e-find-dlg")?this.notify("findKeyUp",e):this.notify(mn,e)}keyDownHandler(e){Object(r.D)(e.target,".e-findtool-dlg")||this.notify(fn,e)}freeze(e){const t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(vn,{eventArgs:t,action:"freezePanes"}),!t.cancel){if(this.on("contentLoaded",this.freezePaneUpdated,this),e.row||e.column){let e=!1;if(this.notify("getFilteredCollection",null),this.filterCollection)for(let t=0,i=this.filterCollection.length;t<i;t++)if(this.filterCollection[t].sheetIndex===this.activeSheetIndex){e=!0;break}e&&this.clearFilter()}this.freezePanes(e.row,e.column),this.notify("refreshRibbonIcons",null)}}freezePaneUpdated(){this.off("contentLoaded",this.freezePaneUpdated);const e=this.getActiveSheet();this.notify(Cn,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})}wireEvents(){r.l.add(this.element,"click",this.mouseClickHandler,this),r.l.add(this.element,fr(),this.mouseDownHandler,this),r.l.add(this.element,"keyup",this.keyUpHandler,this),r.l.add(this.element,"keydown",this.keyDownHandler,this),r.l.add(this.element,"noderefresh",this.refreshNode,this),this.on("freeze",this.freeze,this)}destroy(){this.isReact&&this.clearTemplate(),this.unwireEvents(),this.notify("spreadsheetDestroyed",null),super.destroy(),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width")}unwireEvents(){r.l.remove(this.element,"click",this.mouseClickHandler),r.l.remove(this.element,fr(),this.mouseDownHandler),r.l.remove(this.element,"keyup",this.keyUpHandler),r.l.remove(this.element,"keydown",this.keyDownHandler),r.l.remove(this.element,"noderefresh",this.refreshNode),this.off("freeze",this.freeze)}addContextMenuItems(e,t,i=!0,n){this.notify("addContextMenuItems",{items:e,text:t,insertAfter:i,isUniqueId:n})}removeContextMenuItems(e,t){this.notify("removeContextMenuItems",{items:e,isUniqueId:t})}enableContextMenuItems(e,t=!0,i){this.notify("enableContextMenuItems",{items:e,enable:t,isUniqueId:i})}enableFileMenuItems(e,t=!0,i){this.notify("enableFileMenuItems",{items:e,enable:t,isUniqueId:i})}hideFileMenuItems(e,t=!0,i){this.notify("hideFileMenuItems",{items:e,hide:t,isUniqueId:i})}addFileMenuItems(e,t,i=!0,n){this.notify("addFileMenuItems",{items:e,text:t,insertAfter:i,isUniqueId:n})}hideRibbonTabs(e,t=!0){this.notify("hideRibbonTabs",{tabs:e,hide:t})}enableRibbonTabs(e,t=!0){this.notify("enableRibbonTabs",{tabs:e,enable:t})}addRibbonTabs(e,t){this.notify("addRibbonTabs",{items:e,insertBefore:t})}enableToolbarItems(e,t,i){this.notify("enableToolbarItems",[{tab:e,items:t,enable:void 0===i||i}])}hideToolbarItems(e,t,i=!0){this.notify("hideToolbarItems",{tab:e,indexes:t,hide:i})}addToolbarItems(e,t,i){this.notify("addToolbarItems",{tab:e,items:t,index:i})}selectRange(e){this.notify("selectRange",{address:e})}startEdit(){this.notify(un,{action:"startEdit",isNewValueEdit:!1})}closeEdit(){this.notify(un,{action:"cancelEdit"})}endEdit(){this.notify(un,{action:"endEdit"})}onPropertyChanged(e,t){super.onPropertyChanged(e,t);for(const i of Object.keys(e)){let n,s;switch(i){case"enableRtl":if(n=this.getColumnHeaderContent(),n&&(n=n.parentElement),!n)break;e.enableRtl?(n.style.marginLeft=or()+"px",n.style.marginRight="",document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl")):(n.style.marginRight=or()+"px",n.style.marginLeft="",document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl")),this.renderModule.refreshSheet();break;case"cssClass":t.cssClass&&Object(r.lb)([this.element],t.cssClass.split(" ")),e.cssClass&&Object(r.w)([this.element],e.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify("activeSheetChanged",{idx:e.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify("ribbon",{uiUpdate:!0});break;case"showFormulaBar":this.notify("formulaBar",{uiUpdate:!0});break;case"showSheetTabs":this.notify("sheetTabs",null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":this.allowEditing&&this.notify(un,{action:"renderEditor"});break;case"allowInsert":s=this.element.getElementsByClassName("e-add-sheet-tab")[0],s&&(s.disabled=!this.allowInsert,this.allowInsert?s.classList.contains("e-disabled")&&s.classList.remove("e-disabled"):s.classList.contains("e-disabled")||s.classList.add("e-disabled"));break;case"sheets":if(e.sheets===this.sheets){this.renderModule.refreshSheet(),this.notify("refreshSheetTabs",null);break}Object.keys(e.sheets).forEach((i,n)=>{const s=e.sheets[i];if(s.ranges&&Object.keys(s.ranges).length){const e=Object.keys(s.ranges);let t;e.forEach((e,i)=>{s.ranges[e].info||(t=i)}),e.forEach((n,a)=>{s.ranges[n].dataSource&&(Object(r.cb)(t)||!Object(r.cb)(t)&&t===a)&&this.notify("dataSourceChanged",{sheetIdx:i,rangeIdx:n,isLastRange:e.length-1===a,changedData:s.ranges[n].dataSource})})}else if(s.paneTopLeftCell&&t.sheets&&t.sheets[i]&&t.sheets[i].paneTopLeftCell){if(this.activeSheetIndex!==Number(i))return;const e=Bi(s.paneTopLeftCell),n=Bi(t.sheets[i].paneTopLeftCell);if(e[0]!=n[0]){const t=this.frozenRowCount(this.getActiveSheet()),i=e[0]>t?Ks(this.getActiveSheet(),t,e[0]-1):0;this.notify("updateScroll",{top:i})}if(e[1]!=n[1]){const t=this.frozenColCount(this.getActiveSheet()),i=e[1]>t?tr(this.getActiveSheet(),t,e[1]-1):0;this.notify("updateScroll",{left:i})}}else 0===n&&this.renderModule.refreshSheet(),this.showSheetTabs&&s.name&&this.notify("sheetNameUpdate",{items:this.element.querySelector(".e-sheet-tabs-items").children[i],value:s.name,idx:i})});break;case"locale":this.refresh();break;case"password":this.password.length>0&&this.showSheetTabs&&(this.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(this.isProtected){const e=this.element.getElementsByClassName("e-add-sheet-tab")[0];e&&(e.disabled=this.isProtected,this.isProtected?e.classList.contains("e-disabled")&&e.classList.add("e-disabled"):e.classList.contains("e-disabled")||e.classList.remove("e-disabled"))}}}}requiredModules(){return function(e){const t=[];return function(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]}),e.showFormulaBar&&t.push({member:"formulaBar",args:[e]}),e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]}),e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]})),e.allowOpen&&t.push({member:"open",args:[e]}),e.allowSave&&t.push({member:"save",args:[e]}),e.enableContextMenu&&t.push({member:"contextMenu",args:[e]}),"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]}),e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]}),e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]}),e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]}),e.enableClipboard&&t.push({member:"clipboard",args:[e]}),e.allowCellFormatting&&t.push({member:"cellformat",args:[e]}),e.allowSorting&&t.push({member:"sort",args:[e]}),e.allowResizing&&t.push({member:"resize",args:[e]}),t.push({member:"collaborativeEditing",args:[e]}),t.push({member:"protectSheet",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]}),e.allowUndoRedo&&t.push({member:"undoredo",args:[e]}),e.allowFiltering&&t.push({member:"filter",args:[e]}),e.allowWrap&&t.push({member:"wrapText",args:[e]}),e.allowInsert&&t.push({member:"insert",args:[e]}),e.allowDelete&&t.push({member:"delete",args:[e]}),e.allowDataValidation&&t.push({member:"dataValidation",args:[e]}),e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]}),e.allowMerge&&t.push({member:"merge",args:[e]}),e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"spreadsheetImage",args:[e]}),e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}(e,t),is(e,t),t}(this)}appendTo(e){super.appendTo(e)}filter(e,t){return this.allowFiltering?(t=t||this.getActiveSheet().selectedRange,super.filter(e,t)):Promise.reject()}clearFilter(e){e?this.notify("clearFilter",{field:e}):super.clearFilter()}applyFilter(e,t){this.notify("initiateFilterUI",{predicates:e,range:t})}addCustomFunction(e,t){super.addCustomFunction(e,t),this.notify("refreshFormulaDatasource",null)}};return Ga([Object(r.t)("")],e.prototype,"cssClass",void 0),Ga([Object(r.t)(!0)],e.prototype,"allowScrolling",void 0),Ga([Object(r.t)(!0)],e.prototype,"allowResizing",void 0),Ga([Object(r.t)(!0)],e.prototype,"enableClipboard",void 0),Ga([Object(r.t)(!0)],e.prototype,"enableContextMenu",void 0),Ga([Object(r.t)(!0)],e.prototype,"enableKeyboardNavigation",void 0),Ga([Object(r.t)(!0)],e.prototype,"enableKeyboardShortcut",void 0),Ga([Object(r.t)(!0)],e.prototype,"allowUndoRedo",void 0),Ga([Object(r.t)(!0)],e.prototype,"allowWrap",void 0),Ga([Object(r.g)({},Ta)],e.prototype,"selectionSettings",void 0),Ga([Object(r.g)({},La)],e.prototype,"scrollSettings",void 0),Ga([Object(r.k)()],e.prototype,"beforeCellRender",void 0),Ga([Object(r.k)()],e.prototype,"beforeSelect",void 0),Ga([Object(r.k)()],e.prototype,"select",void 0),Ga([Object(r.k)()],e.prototype,"contextMenuBeforeOpen",void 0),Ga([Object(r.k)()],e.prototype,"fileMenuBeforeOpen",void 0),Ga([Object(r.k)()],e.prototype,"contextMenuBeforeClose",void 0),Ga([Object(r.k)()],e.prototype,"dialogBeforeOpen",void 0),Ga([Object(r.k)()],e.prototype,"fileMenuBeforeClose",void 0),Ga([Object(r.k)()],e.prototype,"contextMenuItemSelect",void 0),Ga([Object(r.k)()],e.prototype,"fileMenuItemSelect",void 0),Ga([Object(r.k)()],e.prototype,"beforeDataBound",void 0),Ga([Object(r.k)()],e.prototype,"dataBound",void 0),Ga([Object(r.k)()],e.prototype,"dataSourceChanged",void 0),Ga([Object(r.k)()],e.prototype,"cellEdit",void 0),Ga([Object(r.k)()],e.prototype,"cellEditing",void 0),Ga([Object(r.k)()],e.prototype,"cellSave",void 0),Ga([Object(r.k)()],e.prototype,"beforeCellSave",void 0),Ga([Object(r.k)()],e.prototype,"created",void 0),Ga([Object(r.k)()],e.prototype,"beforeSort",void 0),Ga([Object(r.k)()],e.prototype,"beforeHyperlinkCreate",void 0),Ga([Object(r.k)()],e.prototype,"afterHyperlinkCreate",void 0),Ga([Object(r.k)()],e.prototype,"beforeHyperlinkClick",void 0),Ga([Object(r.k)()],e.prototype,"afterHyperlinkClick",void 0),Ga([Object(r.k)()],e.prototype,"beforeConditionalFormat",void 0),Ga([Object(r.k)()],e.prototype,"actionBegin",void 0),Ga([Object(r.k)()],e.prototype,"actionComplete",void 0),Ga([Object(r.k)()],e.prototype,"openComplete",void 0),Ga([Object(r.k)()],e.prototype,"sortComplete",void 0),e=Za=Ga([r.r],e),e})();var Xa=i("SVse");const $a=["template"];let Ka=["height","id","left","src","top","width"],Ja=[],Qa=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(Ja),this.directivePropList=Ka}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-image"]],inputs:{height:"height",id:"id",left:"left",src:"src",top:"top",width:"width"},features:[n.zb]}),e})(),eo=(()=>{class e extends s.a{constructor(){super("image")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-images"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,Qa,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),to=["dataLabelSettings","height","id","isSeriesInRows","legendSettings","primaryXAxis","primaryYAxis","range","theme","title","type","width"],io=[],no=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(io),this.directivePropList=to}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-chart"]],inputs:{dataLabelSettings:"dataLabelSettings",height:"height",id:"id",isSeriesInRows:"isSeriesInRows",legendSettings:"legendSettings",primaryXAxis:"primaryXAxis",primaryYAxis:"primaryYAxis",range:"range",theme:"theme",title:"title",type:"type",width:"width"},features:[n.zb]}),e})(),so=(()=>{class e extends s.a{constructor(){super("chart")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-charts"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,no,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),ro=["chart","colSpan","format","formula","hyperlink","image","index","isLocked","rowSpan","style","validation","value","wrap"],ao=[],oo=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,this.tags=["image","chart"],Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(ao),this.directivePropList=ro}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-cell"]],contentQueries:function(e,t,i){if(1&e&&(n.Ib(i,eo,1),n.Ib(i,so,1)),2&e){let e;n.wc(e=n.gc())&&(t.childImage=e.first),n.wc(e=n.gc())&&(t.childChart=e.first)}},inputs:{chart:"chart",colSpan:"colSpan",format:"format",formula:"formula",hyperlink:"hyperlink",image:"image",index:"index",isLocked:"isLocked",rowSpan:"rowSpan",style:"style",validation:"validation",value:"value",wrap:"wrap"},features:[n.zb]}),e})(),lo=(()=>{class e extends s.a{constructor(){super("cells")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-cells"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,oo,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),ho=["cells","customHeight","format","height","hidden","index"],co=[],po=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,this.tags=["cells"],Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(co),this.directivePropList=ho}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-row"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,lo,1),2&e){let e;n.wc(e=n.gc())&&(t.childCells=e.first)}},inputs:{cells:"cells",customHeight:"customHeight",format:"format",height:"height",hidden:"hidden",index:"index"},features:[n.zb]}),e})(),go=(()=>{class e extends s.a{constructor(){super("rows")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-rows"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,po,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),uo=["customWidth","format","hidden","index","isLocked","validation","width"],mo=[],fo=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(mo),this.directivePropList=uo}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-column"]],inputs:{customWidth:"customWidth",format:"format",hidden:"hidden",index:"index",isLocked:"isLocked",validation:"validation",width:"width"},features:[n.zb]}),e})(),bo=(()=>{class e extends s.a{constructor(){super("columns")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-columns"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,fo,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})();var yo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let xo=["address","dataSource","query","showFieldAsHeader","startCell","template"],Co=[],vo=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(Co),this.directivePropList=xo}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-range"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,$a,1),2&e){let e;n.wc(e=n.gc())&&(t.template=e.first)}},inputs:{address:"address",dataSource:"dataSource",query:"query",showFieldAsHeader:"showFieldAsHeader",startCell:"startCell",template:"template"},features:[n.zb]}),function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);r>3&&a&&Object.defineProperty(t,i,a)}([Object(s.f)(),yo("design:type",Object)],e.prototype,"template",void 0),e})(),So=(()=>{class e extends s.a{constructor(){super("ranges")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-ranges"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,vo,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),wo=["cFColor","format","range","type","value"],Io=[],Oo=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(Io),this.directivePropList=wo}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-conditionalformat"]],inputs:{cFColor:"cFColor",format:"format",range:"range",type:"type",value:"value"},features:[n.zb]}),e})(),Ro=(()=>{class e extends s.a{constructor(){super("conditionalformats")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-conditionalformats"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,Oo,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),Ao=["activeCell","colCount","columns","conditionalFormats","frozenColumns","frozenRows","index","isProtected","name","paneTopLeftCell","protectSettings","ranges","rowCount","rows","selectedRange","showGridLines","showHeaders","state","topLeftCell","usedRange"],ko=[],Eo=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,this.tags=["rows","columns","ranges","conditionalFormats"],Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(ko),this.directivePropList=Ao}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-sheet"]],contentQueries:function(e,t,i){if(1&e&&(n.Ib(i,go,1),n.Ib(i,bo,1),n.Ib(i,So,1),n.Ib(i,Ro,1)),2&e){let e;n.wc(e=n.gc())&&(t.childRows=e.first),n.wc(e=n.gc())&&(t.childColumns=e.first),n.wc(e=n.gc())&&(t.childRanges=e.first),n.wc(e=n.gc())&&(t.childConditionalFormats=e.first)}},inputs:{activeCell:"activeCell",colCount:"colCount",columns:"columns",conditionalFormats:"conditionalFormats",frozenColumns:"frozenColumns",frozenRows:"frozenRows",index:"index",isProtected:"isProtected",name:"name",paneTopLeftCell:"paneTopLeftCell",protectSettings:"protectSettings",ranges:"ranges",rowCount:"rowCount",rows:"rows",selectedRange:"selectedRange",showGridLines:"showGridLines",showHeaders:"showHeaders",state:"state",topLeftCell:"topLeftCell",usedRange:"usedRange"},features:[n.zb]}),e})(),Lo=(()=>{class e extends s.a{constructor(){super("sheets")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-sheets"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,Eo,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})(),To=["comment","name","refersTo","scope"],jo=[],Do=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(jo),this.directivePropList=To}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-definedname"]],inputs:{comment:"comment",name:"name",refersTo:"refersTo",scope:"scope"},features:[n.zb]}),e})(),Mo=(()=>{class e extends s.a{constructor(){super("definednames")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-definednames"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,Do,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})();var Fo=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},Po=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const No=["actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeCellFormat","beforeCellRender","beforeCellSave","beforeConditionalFormat","beforeDataBound","beforeHyperlinkClick","beforeHyperlinkCreate","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","contextMenuBeforeClose","contextMenuBeforeOpen","contextMenuItemSelect","created","dataBound","dataSourceChanged","dialogBeforeOpen","fileMenuBeforeClose","fileMenuBeforeOpen","fileMenuItemSelect","openComplete","openFailure","queryCellInfo","saveComplete","select","sortComplete"],Bo=[""];let Ho=(()=>{let e=class extends Ya{constructor(e,t,i,n){super(),this.ngEle=e,this.srenderer=t,this.viewContainerRef=i,this.injector=n,this.tags=["sheets","definedNames"],this.element=this.ngEle.nativeElement,this.injectedModules=this.injectedModules||[];try{let e=this.injector.get("SpreadsheetClipboard");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(r){}try{let e=this.injector.get("SpreadsheetEdit");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(a){}try{let e=this.injector.get("SpreadsheetKeyboardNavigation");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(o){}try{let e=this.injector.get("SpreadsheetKeyboardShortcut");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(l){}try{let e=this.injector.get("SpreadsheetCollaborativeEditing");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(h){}try{let e=this.injector.get("SpreadsheetSelection");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(c){}try{let e=this.injector.get("SpreadsheetContextMenu");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(d){}try{let e=this.injector.get("SpreadsheetFormulaBar");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(p){}try{let e=this.injector.get("SpreadsheetRibbon");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(g){}try{let e=this.injector.get("SpreadsheetSave");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(u){}try{let e=this.injector.get("SpreadsheetOpen");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(m){}try{let e=this.injector.get("SpreadsheetSheetTabs");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(f){}try{let e=this.injector.get("SpreadsheetDataBind");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(b){}try{let e=this.injector.get("SpreadsheetAllModule");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(y){}try{let e=this.injector.get("SpreadsheetBasicModule");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(x){}try{let e=this.injector.get("SpreadsheetCellFormat");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(C){}try{let e=this.injector.get("SpreadsheetNumberFormat");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(v){}try{let e=this.injector.get("SpreadsheetFormula");-1===this.injectedModules.indexOf(e)&&this.injectedModules.push(e)}catch(S){}this.registerEvents(No),this.addTwoWay.call(this,Bo),Object(s.g)("currentInstance",this,this.viewContainerRef),this.context=new s.c}ngOnInit(){this.context.ngOnInit(this)}ngAfterViewInit(){this.context.ngAfterViewInit(this)}ngOnDestroy(){this.context.ngOnDestroy(this)}ngAfterContentChecked(){this.tagObjects[0].instance=this.childSheets,this.childDefinedNames&&(this.tagObjects[1].instance=this.childDefinedNames),this.context.ngAfterContentChecked(this)}};return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-spreadsheet"]],contentQueries:function(e,t,i){if(1&e&&(n.Ib(i,$a,1),n.Ib(i,Lo,1),n.Ib(i,Mo,1)),2&e){let e;n.wc(e=n.gc())&&(t.template=e.first),n.wc(e=n.gc())&&(t.childSheets=e.first),n.wc(e=n.gc())&&(t.childDefinedNames=e.first)}},inputs:{activeSheetIndex:"activeSheetIndex",allowCellFormatting:"allowCellFormatting",allowChart:"allowChart",allowConditionalFormat:"allowConditionalFormat",allowDataValidation:"allowDataValidation",allowDelete:"allowDelete",allowEditing:"allowEditing",allowFiltering:"allowFiltering",allowFindAndReplace:"allowFindAndReplace",allowHyperlink:"allowHyperlink",allowImage:"allowImage",allowInsert:"allowInsert",allowMerge:"allowMerge",allowNumberFormatting:"allowNumberFormatting",allowOpen:"allowOpen",allowResizing:"allowResizing",allowSave:"allowSave",allowScrolling:"allowScrolling",allowSorting:"allowSorting",allowUndoRedo:"allowUndoRedo",allowWrap:"allowWrap",cellStyle:"cellStyle",cssClass:"cssClass",definedNames:"definedNames",enableClipboard:"enableClipboard",enableContextMenu:"enableContextMenu",enableKeyboardNavigation:"enableKeyboardNavigation",enableKeyboardShortcut:"enableKeyboardShortcut",enablePersistence:"enablePersistence",enableRtl:"enableRtl",height:"height",isProtected:"isProtected",locale:"locale",openUrl:"openUrl",password:"password",saveUrl:"saveUrl",scrollSettings:"scrollSettings",selectionSettings:"selectionSettings",sheets:"sheets",showFormulaBar:"showFormulaBar",showRibbon:"showRibbon",showSheetTabs:"showSheetTabs",width:"width"},outputs:{actionBegin:"actionBegin",actionComplete:"actionComplete",afterHyperlinkClick:"afterHyperlinkClick",afterHyperlinkCreate:"afterHyperlinkCreate",beforeCellFormat:"beforeCellFormat",beforeCellRender:"beforeCellRender",beforeCellSave:"beforeCellSave",beforeConditionalFormat:"beforeConditionalFormat",beforeDataBound:"beforeDataBound",beforeHyperlinkClick:"beforeHyperlinkClick",beforeHyperlinkCreate:"beforeHyperlinkCreate",beforeOpen:"beforeOpen",beforeSave:"beforeSave",beforeSelect:"beforeSelect",beforeSort:"beforeSort",cellEdit:"cellEdit",cellEditing:"cellEditing",cellSave:"cellSave",contextMenuBeforeClose:"contextMenuBeforeClose",contextMenuBeforeOpen:"contextMenuBeforeOpen",contextMenuItemSelect:"contextMenuItemSelect",created:"created",dataBound:"dataBound",dataSourceChanged:"dataSourceChanged",dialogBeforeOpen:"dialogBeforeOpen",fileMenuBeforeClose:"fileMenuBeforeClose",fileMenuBeforeOpen:"fileMenuBeforeOpen",fileMenuItemSelect:"fileMenuItemSelect",openComplete:"openComplete",openFailure:"openFailure",queryCellInfo:"queryCellInfo",saveComplete:"saveComplete",select:"select",sortComplete:"sortComplete"},features:[n.zb],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),Fo([Object(s.f)(),Po("design:type",Object)],e.prototype,"template",void 0),e=Fo([Object(s.d)([s.c]),Po("design:paramtypes",[n.l,n.E,n.P,n.s])],e),e})(),_o=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[Xa.c]]}),e})();const zo={provide:"SpreadsheetClipboard",useValue:Wr},Vo={provide:"SpreadsheetEdit",useValue:Zr},Uo={provide:"SpreadsheetKeyboardNavigation",useValue:$r},qo={provide:"SpreadsheetKeyboardShortcut",useValue:Kr},Wo={provide:"SpreadsheetCollaborativeEditing",useValue:ea},Zo={provide:"SpreadsheetSelection",useValue:Gr},Go={provide:"SpreadsheetContextMenu",useValue:wa},Yo={provide:"SpreadsheetFormulaBar",useValue:ya},Xo={provide:"SpreadsheetRibbon",useValue:ba},$o={provide:"SpreadsheetSave",useValue:Sa},Ko={provide:"SpreadsheetOpen",useValue:va},Jo={provide:"SpreadsheetSheetTabs",useValue:Ca},Qo={provide:"SpreadsheetDataBind",useValue:gn},el={provide:"SpreadsheetAllModule",useValue:class{constructor(){Ya.Inject(ba,ya,Ca,Gr,Zr,$r,Kr,Wr,gn,va,Sa,Ia,Jr,xa,Oa,Qr,ea,na,Ra,ia,sa,ra,aa,oa,la,ha,ca,Aa,da,ka)}getModuleName(){return"all"}destroy(){}}},tl={provide:"SpreadsheetBasicModule",useValue:class{constructor(){Ya.Inject(ba,ya,Ca,Gr,Zr,$r,Kr,Wr,gn,va,wa,Sa,Ia,Jr,xa,Oa,ea,na,Qr,Ra,ia,sa,ra,aa,la,oa,ha,ca,da,Aa,ka)}getModuleName(){return"basic"}destroy(){}}},il={provide:"SpreadsheetCellFormat",useValue:Jr},nl={provide:"SpreadsheetNumberFormat",useValue:Ia},sl={provide:"SpreadsheetFormula",useValue:xa};let rl=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({providers:[zo,Vo,Uo,qo,Wo,Zo,Go,Yo,Xo,$o,Ko,Jo,Qo,el,tl,il,nl,sl],imports:[[Xa.c,_o],_o]}),e})()},BrIm:function(e,t,i){"use strict";i.d(t,"e",function(){return p}),i.d(t,"b",function(){return b}),i.d(t,"c",function(){return y}),i.d(t,"a",function(){return S}),i.d(t,"d",function(){return w});var n=i("8Y7J"),s=i("k5hD"),r=i("5YkT"),a=i("SVse");const o=["content"],l=["headerTemplate"],h=[[["div"]]],c=["div"],d=["headerText"];let p=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[a.c]]}),e})();var g=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=["content","cssClass","disabled","header","headerTemplate","id","visible"],f=[],b=(()=>{class e extends s.b{constructor(e){super(),this.viewContainerRef=e,Object(s.g)("currentInstance",this,this.viewContainerRef),this.registerEvents(f),this.directivePropList=m}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-tabitem"]],contentQueries:function(e,t,i){if(1&e&&(n.Ib(i,o,1),n.Ib(i,d,1),n.Ib(i,l,1)),2&e){let e;n.wc(e=n.gc())&&(t.content=e.first),n.wc(e=n.gc())&&(t.header_text=e.first),n.wc(e=n.gc())&&(t.headerTemplate=e.first)}},inputs:{content:"content",cssClass:"cssClass",disabled:"disabled",header:"header",headerTemplate:"headerTemplate",id:"id",visible:"visible"},features:[n.zb]}),g([Object(s.f)(),u("design:type",Object)],e.prototype,"content",void 0),g([Object(s.f)(),u("design:type",Object)],e.prototype,"header_text",void 0),g([Object(s.f)(),u("design:type",Object)],e.prototype,"headerTemplate",void 0),e})(),y=(()=>{class e extends s.a{constructor(){super("items")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-tabitems"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,b,0),2&e){let e;n.wc(e=n.gc())&&(t.children=e)}},features:[n.zb]}),e})();var x=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const C=["added","adding","created","destroyed","dragged","dragging","onDragStart","removed","removing","selected","selecting"],v=[""];let S=(()=>{let e=class extends r.g{constructor(e,t,i,n){super(),this.ngEle=e,this.srenderer=t,this.viewContainerRef=i,this.injector=n,this.tags=["items"],this.element=this.ngEle.nativeElement,this.injectedModules=this.injectedModules||[],this.registerEvents(C),this.addTwoWay.call(this,v),Object(s.g)("currentInstance",this,this.viewContainerRef),this.containerContext=new s.c}ngOnInit(){this.containerContext.ngOnInit(this)}ngAfterViewInit(){this.containerContext.ngAfterViewInit(this)}ngOnDestroy(){this.containerContext.ngOnDestroy(this)}ngAfterContentChecked(){this.tagObjects[0].instance=this.childItems,this.containerContext.ngAfterContentChecked(this)}};return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-tab"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,y,1),2&e){let e;n.wc(e=n.gc())&&(t.childItems=e.first)}},inputs:{allowDragAndDrop:"allowDragAndDrop",animation:"animation",cssClass:"cssClass",dragArea:"dragArea",enableHtmlSanitizer:"enableHtmlSanitizer",enablePersistence:"enablePersistence",enableRtl:"enableRtl",headerPlacement:"headerPlacement",height:"height",heightAdjustMode:"heightAdjustMode",items:"items",loadOn:"loadOn",locale:"locale",overflowMode:"overflowMode",scrollStep:"scrollStep",selectedItem:"selectedItem",showCloseButton:"showCloseButton",width:"width"},outputs:{added:"added",adding:"adding",created:"created",destroyed:"destroyed",dragged:"dragged",dragging:"dragging",onDragStart:"onDragStart",removed:"removed",removing:"removing",selected:"selected",selecting:"selecting"},features:[n.zb],ngContentSelectors:c,decls:1,vars:0,template:function(e,t){1&e&&(n.nc(h),n.mc(0))},encapsulation:2,changeDetection:0}),e=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a}([Object(s.d)([s.c]),x("design:paramtypes",[n.l,n.E,n.P,n.s])],e),e})(),w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[a.c]]}),e})()},e7Im:function(e,t,i){"use strict";i.d(t,"b",function(){return g}),i.d(t,"c",function(){return u}),i.d(t,"a",function(){return m});var n=i("8Y7J"),s=i("k5hD"),r=i("Naoh"),a=i("SVse");const o=["content"],l=["*"];var h=function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const d=["afterClose","afterOpen","beforeClose","beforeCollision","beforeOpen","beforeRender","created","destroyed"],p=[""];let g=(()=>{let e=class extends r.c{constructor(e,t,i,n){super(),this.ngEle=e,this.srenderer=t,this.viewContainerRef=i,this.injector=n,this.element=this.ngEle.nativeElement,this.injectedModules=this.injectedModules||[],this.registerEvents(d),this.addTwoWay.call(this,p),Object(s.g)("currentInstance",this,this.viewContainerRef),this.containerContext=new s.c}ngOnInit(){this.containerContext.ngOnInit(this)}ngAfterViewInit(){this.containerContext.ngAfterViewInit(this)}ngOnDestroy(){this.containerContext.ngOnDestroy(this)}ngAfterContentChecked(){this.containerContext.ngAfterContentChecked(this)}};return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-tooltip"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,o,1),2&e){let e;n.wc(e=n.gc())&&(t.content=e.first)}},inputs:{animation:"animation",closeDelay:"closeDelay",content:"content",cssClass:"cssClass",enableHtmlParse:"enableHtmlParse",enableHtmlSanitizer:"enableHtmlSanitizer",enablePersistence:"enablePersistence",enableRtl:"enableRtl",height:"height",isSticky:"isSticky",locale:"locale",mouseTrail:"mouseTrail",offsetX:"offsetX",offsetY:"offsetY",openDelay:"openDelay",opensOn:"opensOn",position:"position",showTipPointer:"showTipPointer",target:"target",tipPointerPosition:"tipPointerPosition",width:"width",windowCollision:"windowCollision"},outputs:{afterClose:"afterClose",afterOpen:"afterOpen",beforeClose:"beforeClose",beforeCollision:"beforeCollision",beforeOpen:"beforeOpen",beforeRender:"beforeRender",created:"created",destroyed:"destroyed"},features:[n.zb],ngContentSelectors:l,decls:1,vars:0,template:function(e,t){1&e&&(n.nc(),n.mc(0))},encapsulation:2,changeDetection:0}),h([Object(s.f)(),c("design:type",Object)],e.prototype,"content",void 0),e=h([Object(s.d)([s.c]),c("design:paramtypes",[n.l,n.E,n.P,n.s])],e),e})(),u=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[a.c]]}),e})(),m=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({providers:[],imports:[[a.c,u],u]}),e})()}}]);