!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw s}}}}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function r(e,t,i){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var i,n=p(e);if(t){var r=p(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return d(this,i)}}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"10VE":function(e,t,i){"use strict";i.d(t,"a",function(){return v}),i.d(t,"b",function(){return y});var n,r=i("8Y7J"),s=i("s7LF"),h=i("k5hD"),d=i("gnsf"),p=i("SVse"),g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=["blur","change","cleared","close","created","destroyed","focus","navigated","open","renderDayCell","valueChange"],m=["value"],v=function(){var e=n=function(e){l(i,e);var t=c(i);function i(e,n,r,s){var o;a(this,i),(o=t.call(this)).ngEle=e,o.srenderer=n,o.viewContainerRef=r,o.injector=s,o.skipFromEvent=!0,o.element=o.ngEle.nativeElement,o.injectedModules=o.injectedModules||[];try{var l=o.injector.get("CalendarsIslamic");-1===o.injectedModules.indexOf(l)&&o.injectedModules.push(l)}catch(d){}try{var c=o.injector.get("CalendarsMaskedDateTime");-1===o.injectedModules.indexOf(c)&&o.injectedModules.push(c)}catch(p){}return o.registerEvents(f),o.addTwoWay.call(u(o),m),Object(h.g)("currentInstance",u(o),o.viewContainerRef),o.formContext=new h.e,o.formCompContext=new h.c,o}return o(i,[{key:"registerOnChange",value:function(e){}},{key:"registerOnTouched",value:function(e){}},{key:"writeValue",value:function(e){}},{key:"setDisabledState",value:function(e){}},{key:"ngOnInit",value:function(){this.formCompContext.ngOnInit(this)}},{key:"ngAfterViewInit",value:function(){this.formContext.ngAfterViewInit(this)}},{key:"ngOnDestroy",value:function(){this.formCompContext.ngOnDestroy(this)}},{key:"ngAfterContentChecked",value:function(){this.formCompContext.ngAfterContentChecked(this)}}]),i}(d.b);return e.\u0275fac=function(t){return new(t||e)(r.Pb(r.l),r.Pb(r.E),r.Pb(r.P),r.Pb(r.s))},e.\u0275cmp=r.Jb({type:e,selectors:[["ejs-datepicker"]],inputs:{allowEdit:"allowEdit",calendarMode:"calendarMode",cssClass:"cssClass",dayHeaderFormat:"dayHeaderFormat",depth:"depth",enableMask:"enableMask",enablePersistence:"enablePersistence",enableRtl:"enableRtl",enabled:"enabled",firstDayOfWeek:"firstDayOfWeek",floatLabelType:"floatLabelType",format:"format",htmlAttributes:"htmlAttributes",isMultiSelection:"isMultiSelection",keyConfigs:"keyConfigs",locale:"locale",maskPlaceholder:"maskPlaceholder",max:"max",min:"min",openOnFocus:"openOnFocus",placeholder:"placeholder",readonly:"readonly",serverTimezoneOffset:"serverTimezoneOffset",showClearButton:"showClearButton",showTodayButton:"showTodayButton",start:"start",strictMode:"strictMode",value:"value",values:"values",weekNumber:"weekNumber",weekRule:"weekRule",width:"width",zIndex:"zIndex"},outputs:{blur:"blur",change:"change",cleared:"cleared",close:"close",created:"created",destroyed:"destroyed",focus:"focus",navigated:"navigated",open:"open",renderDayCell:"renderDayCell",valueChange:"valueChange"},features:[r.Bb([{provide:s.d,useExisting:Object(r.U)(function(){return n}),multi:!0}]),r.zb],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),e=n=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s}([Object(h.d)([h.c,h.e]),g("design:paramtypes",[r.l,r.E,r.P,r.s])],e)}(),y=function(){var e=function e(){a(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({imports:[[p.c]]}),e}()},"7YrF":function(i,n,s){"use strict";s.d(n,"a",function(){return Jl}),s.d(n,"b",function(){return Ql}),s.d(n,"g",function(){return th}),s.d(n,"h",function(){return ih}),s.d(n,"c",function(){return ah}),s.d(n,"d",function(){return sh}),s.d(n,"e",function(){return ch}),s.d(n,"f",function(){return dh}),s.d(n,"i",function(){return yh}),s.d(n,"j",function(){return bh}),s.d(n,"l",function(){return Ah}),s.d(n,"k",function(){return Yh});var h=s("8Y7J"),g=s("k5hD"),f=s("4SUy"),m=s("H552"),v=s("5YkT"),y=s("ngVE"),b=s("TF3C"),C=s("OyPL"),x=s("72GX"),S=s("n6zm"),w=s("Naoh"),k=s("/ui1"),I=function(){function e(t){a(this,e),this.svgLink="http://www.w3.org/2000/svg",this.rootId=t}return o(e,[{key:"getOptionValue",value:function(e,t){return e[t]}},{key:"createSvg",value:function(e){return Object(f.Z)(e.id)&&(e.id=this.rootId+"_svg"),this.svgObj=document.getElementById(e.id),Object(f.Z)(document.getElementById(e.id))&&(this.svgObj=document.createElementNS(this.svgLink,"svg")),this.svgObj=this.setElementAttributes(e,this.svgObj),this.setSVGSize(e.width,e.height),this.svgObj}},{key:"setSVGSize",value:function(e,t){var i=document.getElementById(this.rootId),n=Object(f.Z)(i)?null:i.getBoundingClientRect();Object(f.Z)(this.width)||this.width<=0?this.svgObj.setAttribute("width",e?e.toString():n.width.toString()):this.svgObj.setAttribute("width",this.width.toString()),Object(f.Z)(this.height)||this.height<=0?this.svgObj.setAttribute("height",t?t.toString():"450"):this.svgObj.setAttribute("height",this.height.toString())}},{key:"drawPath",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"path")),t=this.setElementAttributes(e,t)}},{key:"drawLine",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"line")),t=this.setElementAttributes(e,t)}},{key:"drawRectangle",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"rect")),t=this.setElementAttributes(e,t)}},{key:"drawCircle",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"circle")),t=this.setElementAttributes(e,t)}},{key:"drawPolyline",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"polyline")),t=this.setElementAttributes(e,t)}},{key:"drawEllipse",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"ellipse")),t=this.setElementAttributes(e,t)}},{key:"drawPolygon",value:function(e){var t=document.getElementById(e.id);return null===t&&(t=document.createElementNS(this.svgLink,"polygon")),t=this.setElementAttributes(e,t)}},{key:"drawImage",value:function(e){var t=document.createElementNS(this.svgLink,"image");return t.setAttributeNS(null,"height",e.height.toString()),t.setAttributeNS(null,"width",e.width.toString()),t.setAttributeNS("http://www.w3.org/1999/xlink","href",e.href),t.setAttributeNS(null,"x",e.x.toString()),t.setAttributeNS(null,"y",e.y.toString()),t.setAttributeNS(null,"id",e.id),t.setAttributeNS(null,"visibility",e.visibility),Object(f.Z)(this.getOptionValue(e,"clip-path"))||t.setAttributeNS(null,"clip-path",this.getOptionValue(e,"clip-path")),Object(f.Z)(e.preserveAspectRatio)||t.setAttributeNS(null,"preserveAspectRatio",e.preserveAspectRatio),t}},{key:"createText",value:function(e,t){var i=document.createElementNS(this.svgLink,"text");return i=this.setElementAttributes(e,i),Object(f.Z)(t)||(i.textContent=t),i}},{key:"createTSpan",value:function(e,t){var i=document.createElementNS(this.svgLink,"tspan");return i=this.setElementAttributes(e,i),Object(f.Z)(t)||(i.textContent=t),i}},{key:"createTitle",value:function(e){var t=document.createElementNS(this.svgLink,"title");return t.textContent=e,t}},{key:"createDefs",value:function(){return document.createElementNS(this.svgLink,"defs")}},{key:"createClipPath",value:function(e){var t=document.createElementNS(this.svgLink,"clipPath");return t=this.setElementAttributes(e,t)}},{key:"createForeignObject",value:function(e){var t=document.createElementNS(this.svgLink,"foreignObject");return t=this.setElementAttributes(e,t)}},{key:"createGroup",value:function(e){var t=document.createElementNS(this.svgLink,"g");return t=this.setElementAttributes(e,t)}},{key:"createPattern",value:function(e,t){var i=document.createElementNS(this.svgLink,t);return i=this.setElementAttributes(e,i)}},{key:"createRadialGradient",value:function(e,t,i){var n;return Object(f.Z)(e[0].colorStop)?n=e[0].color.toString():(this.drawGradient("radialGradient",{id:this.rootId+"_"+t+"radialGradient",cx:i.cx+"%",cy:i.cy+"%",r:i.r+"%",fx:i.fx+"%",fy:i.fy+"%"},e),n="url(#"+this.rootId+"_"+t+"radialGradient)"),n}},{key:"createLinearGradient",value:function(e,t,i){var n;return Object(f.Z)(e[0].colorStop)?n=e[0].color.toString():(this.drawGradient("linearGradient",{id:this.rootId+"_"+t+"linearGradient",x1:i.x1+"%",y1:i.y1+"%",x2:i.x2+"%",y2:i.y2+"%"},e),n="url(#"+this.rootId+"_"+t+"linearGradient)"),n}},{key:"drawGradient",value:function(e,t,i){var n=this.createDefs(),r=document.createElementNS(this.svgLink,e);r=this.setElementAttributes(t,r);for(var a=0;a<i.length;a++){var s=document.createElementNS(this.svgLink,"stop");s.setAttribute("offset",i[a].colorStop),s.setAttribute("stop-color",i[a].color),s.setAttribute("stop-opacity",i[a].opacity?i[a].opacity:"1"),Object(f.Z)(i[a].style)||s.setAttribute("style",i[a].style),r.appendChild(s)}return n.appendChild(r),n}},{key:"drawClipPath",value:function(e){var t=this.createDefs(),i=this.createClipPath({id:e.id});e.id=e.id+"_Rect";var n=this.drawRectangle(e);return i.appendChild(n),t.appendChild(i),t}},{key:"drawCircularClipPath",value:function(e){var t=this.createDefs(),i=this.createClipPath({id:e.id});e.id=e.id+"_Circle";var n=this.drawCircle(e);return i.appendChild(n),t.appendChild(i),t}},{key:"setElementAttributes",value:function(e,t){for(var i=Object.keys(e),n=0;n<i.length;n++)t.setAttribute(i[n],e[i[n]]);return t}},{key:"createCanvas",value:function(){return null}}]),e}(),O=function(){function e(t){a(this,e),this.rootId=t}return o(e,[{key:"getOptionValue",value:function(e,t){return e[t]}},{key:"createCanvas",value:function(e){var t=document.createElement("canvas");return t.setAttribute("id",this.rootId+"_canvas"),this.ctx=t.getContext("2d"),this.canvasObj=t,this.setCanvasSize(e.width,e.height),this.canvasObj}},{key:"setCanvasSize",value:function(e,t){var i=document.getElementById(this.rootId),n=Object(f.Z)(i)?null:i.getBoundingClientRect();Object(f.Z)(this.width)?this.canvasObj.setAttribute("width",e?e.toString():n.width.toString()):this.canvasObj.setAttribute("width",this.width.toString()),Object(f.Z)(this.height)?this.canvasObj.setAttribute("height",t?t.toString():"450"):this.canvasObj.setAttribute("height",this.height.toString())}},{key:"setAttributes",value:function(e){this.ctx.lineWidth=this.getOptionValue(e,"stroke-width");var t=this.getOptionValue(e,"stroke-dasharray");if(!Object(f.Z)(t)){var i=t.split(",");this.ctx.setLineDash([parseInt(i[0],10),parseInt(i[1],10)])}this.ctx.strokeStyle=this.getOptionValue(e,"stroke")}},{key:"drawLine",value:function(e){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.stroke(),this.ctx.restore()}},{key:"drawRectangle",value:function(e,t){var i=this.ctx,n=e.rx;return this.ctx.save(),this.ctx.beginPath(),t&&this.ctx.translate(t[0],t[1]),this.ctx.globalAlpha=this.getOptionValue(e,"opacity"),this.setAttributes(e),this.ctx.rect(e.x,e.y,e.width,e.height),null!==n&&n>=0?this.drawCornerRadius(e):("none"===e.fill&&(e.fill="transparent"),this.ctx.fillStyle=e.fill,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.stroke()),this.ctx.restore(),this.ctx=i,this.canvasObj}},{key:"drawCornerRadius",value:function(e){var t=e.rx,i=e.x,n=e.y,r=e.width,a=e.height;"none"===e.fill&&(e.fill="transparent"),this.ctx.fillStyle=e.fill,r<2*t&&(t=r/2),a<2*t&&(t=a/2),this.ctx.beginPath(),this.ctx.moveTo(i+r-t,n),this.ctx.arcTo(i+r,n,i+r,n+a,t),this.ctx.arcTo(i+r,n+a,i,n+a,t),this.ctx.arcTo(i,n+a,i,n,t),this.ctx.arcTo(i,n,i+r,n,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}},{key:"drawPath",value:function(e,t){var i=e.d.split(" "),n=this.getOptionValue(e,"stroke-width"),r=this.ctx,a=!0;this.ctx.save(),this.ctx.beginPath(),t&&this.ctx.translate(t[0],t[1]),this.ctx.globalAlpha=e.opacity?e.opacity:this.getOptionValue(e,"fill-opacity"),this.setAttributes(e);for(var s=0;s<i.length;s+=3){var o=parseFloat(i[s+1]),l=parseFloat(i[s+2]);switch(i[s]){case"M":e.innerR||e.cx||this.ctx.moveTo(o,l);break;case"L":e.innerR||this.ctx.lineTo(o,l);break;case"Q":var h=parseFloat(i[s+3]),c=parseFloat(i[s+4]);this.ctx.quadraticCurveTo(o,l,h,c),s+=2;break;case"C":var d=parseFloat(i[s+3]),u=parseFloat(i[s+4]),p=parseFloat(i[s+5]),g=parseFloat(i[s+6]);this.ctx.bezierCurveTo(o,l,d,u,p,g),s+=4;break;case"A":e.innerR?a&&(this.ctx.arc(e.x,e.y,e.radius,e.start,e.end,e.counterClockWise),this.ctx.arc(e.x,e.y,e.innerR,e.end,e.start,!e.counterClockWise),a=!1):e.cx?this.ctx.arc(e.cx,e.cy,e.radius,0,2*Math.PI,e.counterClockWise):(this.ctx.moveTo(e.x,e.y),this.ctx.arc(e.x,e.y,e.radius,e.start,e.end,e.counterClockWise),this.ctx.lineTo(e.x,e.y)),s+=5;break;case"z":case"Z":this.ctx.closePath(),s-=2}}return"none"!==e.fill&&void 0!==e.fill&&(this.ctx.fillStyle=e.fill,this.ctx.fill()),n>0&&this.ctx.stroke(),this.ctx.restore(),this.ctx=r,this.canvasObj}},{key:"createText",value:function(e,t,i,n,r,a){var s=this.getOptionValue(e,"font-weight");Object(f.Z)(s)||"regular"!==s.toLowerCase()||(s="normal");var o=this.getOptionValue(e,"font-size"),l=this.getOptionValue(e,"font-family"),h=this.getOptionValue(e,"font-style").toLowerCase()+" "+s+" "+o+" "+l,c=this.getOptionValue(e,"text-anchor"),d=void 0!==e.opacity?e.opacity:1;return"middle"===c&&(c="center"),this.ctx.save(),this.ctx.fillStyle=e.fill,this.ctx.font=h,this.ctx.textAlign=c,this.ctx.globalAlpha=d,e.baseline&&(this.ctx.textBaseline=e.baseline),a||(this.ctx.translate(e.x+0+(i||0),e.y+(n||0)),this.ctx.rotate(e.labelRotation*Math.PI/180)),this.ctx.fillText(t,a?e.x:0,a?r:0),this.ctx.restore(),this.canvasObj}},{key:"drawCircle",value:function(e,t){var i=this.ctx;return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.cx,e.cy,e.r,0,2*Math.PI),this.ctx.fillStyle=e.fill,this.ctx.globalAlpha=e.opacity,this.ctx.fill(),t&&this.ctx.translate(t[0],t[1]),this.setAttributes(e),this.ctx.stroke(),this.ctx.restore(),this.ctx=i,this.canvasObj}},{key:"drawPolyline",value:function(e){this.ctx.save(),this.ctx.beginPath();for(var t=e.points.split(" "),i=0;i<t.length-1;i++){var n=t[i].split(","),r=parseFloat(n[0]),a=parseFloat(n[1]);0===i?this.ctx.moveTo(r,a):this.ctx.lineTo(r,a)}this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.stroke(),this.ctx.restore()}},{key:"drawEllipse",value:function(e,t){var i=this.ctx,n=Math.max(e.rx,e.ry),r=e.rx/n,a=e.ry/n;this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(e.cx,e.cy),t&&this.ctx.translate(t[0],t[1]),this.ctx.save(),this.ctx.scale(r,a),this.ctx.arc(0,0,n,0,2*Math.PI,!1),this.ctx.fillStyle=e.fill,this.ctx.fill(),this.ctx.restore(),this.ctx.lineWidth=this.getOptionValue(e,"stroke-width"),this.ctx.strokeStyle=e.stroke,this.ctx.stroke(),this.ctx.restore(),this.ctx=i}},{key:"drawImage",value:function(e){this.ctx.save();var t=new Image;Object(f.Z)(e.href)||(t.src=e.href,this.ctx.drawImage(t,e.x,e.y,e.width,e.height)),this.ctx.restore()}},{key:"createLinearGradient",value:function(e){var t;return Object(f.Z)(e[0].colorStop)||(t=this.ctx.createLinearGradient(0,0,0,this.canvasObj.height)),this.setGradientValues(e,t)}},{key:"createRadialGradient",value:function(e){var t;return Object(f.Z)(e[0].colorStop)||(t=this.ctx.createRadialGradient(0,0,0,0,0,this.canvasObj.height)),this.setGradientValues(e,t)}},{key:"setGradientValues",value:function(e,t){var i;if(Object(f.Z)(e[0].colorStop))i=e[0].color.toString();else{for(var n=0;n<=e.length-1;n++){var r=e[n].color,a=e[n].colorStop.slice(0,-1),s=parseInt(a,10)/100;t.addColorStop(s,r)}i=t.toString()}return i}},{key:"setElementAttributes",value:function(e,t){for(var i=Object.keys(e),n=Object.keys(e).map(function(t){return e[t]}),r=0;r<i.length;r++)t.setAttribute(i[r],n[r]);return null}},{key:"updateCanvasAttributes",value:function(e){this.setElementAttributes(e,this.canvasObj);var t=this.ctx;if(!Object(f.Z)(this.dataUrl)){var i=new Image;i.onload=function(){t.drawImage(i,0,0)},i.src=this.dataUrl}}},{key:"clearRect",value:function(e){this.ctx.restore(),this.ctx.clearRect(e.x,e.y,e.width,e.height)}},{key:"createGroup",value:function(){return null}},{key:"drawClipPath",value:function(){return null}},{key:"canvasClip",value:function(e){this.ctx.save(),this.ctx.fillStyle="transparent",this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.fill(),this.ctx.clip()}},{key:"canvasRestore",value:function(){this.ctx.restore()}},{key:"drawPolygon",value:function(){return null}},{key:"createDefs",value:function(){return null}},{key:"createClipPath",value:function(){return null}},{key:"createSvg",value:function(){return null}}]),e}();function R(e,t){var i=e||"",n=document.getElementById("chartmeasuretext");if(null===n&&(n=Object(f.G)("text",{id:"chartmeasuretext"}),document.body.appendChild(n)),"string"==typeof e&&(e.indexOf("<")>-1||e.indexOf(">")>-1)){for(var r=e.split(" "),a=0;a<r.length;a++)-1===r[a].indexOf("<br/>")&&(r[a]=r[a].replace(/[<>]/g,"&"));e=r.join(" ")}return n.innerHTML=i.indexOf("<br>")>-1||i.indexOf("<br/>")>-1?i:e,n.style.position="fixed",n.style.fontSize=t.size,n.style.fontWeight=t.fontWeight,n.style.fontStyle=t.fontStyle,n.style.fontFamily=t.fontFamily,n.style.visibility="hidden",n.style.top="-100",n.style.left="0",n.style.whiteSpace="nowrap",n.style.lineHeight="normal",new E(n.clientWidth,n.clientHeight)}function A(e,t,i,n,r,a,s,o,l,h,c){var d="",u=i.x,p=i.y,g=i.x+i.width,f=i.y+i.height;return c=c||0,a?(d=(d=d.concat("M "+u+" "+(p+t)+" Q "+u+" "+p+" "+(u+e)+" "+p+"  L "+(g-e)+" "+p+" Q "+g+" "+p+" "+g+" "+(p+t))).concat(" L "+g+" "+(f-t)+" Q "+g+" "+f+" "+(g-e)+" "+f),0!==r&&(d=(d=d.concat(" L "+(n.x+r/2)+" "+f)).concat(" L "+(l+c)+" "+(f+r-c)),d+=" Q "+l+" "+(f+r)+" "+(l-c)+" "+(f+r-c)),d=d.concat(n.x-r/2>u?" L "+(n.x-r/2)+" "+f+" L "+(u+e)+" "+f+" Q "+u+" "+f+" "+u+" "+(f-t)+" z":0===r?" L "+(u+e)+" "+f+" Q "+u+" "+f+" "+u+" "+(f-t)+" z":" L "+u+" "+(f+t)+" z")):s?(d=(d=d.concat("M "+u+" "+(p+t)+" Q "+u+" "+p+" "+(u+e)+" "+p+" L "+(n.x-r/2)+" "+p)).concat(" L "+(l-c)+" "+(n.y+c)),d=(d=(d+=" Q "+l+" "+n.y+" "+(l+c)+" "+(n.y+c)).concat(" L "+(n.x+r/2)+" "+p+" L "+(g-e)+" "+p+" Q "+g+" "+p+" "+g+" "+(p+t))).concat(" L "+g+" "+(f-t)+" Q "+g+" "+f+" "+(g-e)+" "+f+" L "+(u+e)+" "+f+" Q "+u+" "+f+" "+u+" "+(f-t)+" z")):o?(d=(d=(d=d.concat("M "+u+" "+(p+t)+" Q "+u+" "+p+" "+(u+e)+" "+p)).concat(" L "+(g-e)+" "+p+" Q "+g+" "+p+" "+g+" "+(p+t)+" L "+g+" "+(n.y-r/2))).concat(" L "+(g+r-c)+" "+(h-c)),d=(d=(d+=" Q "+(g+r)+" "+h+" "+(g+r-c)+" "+(h+c)).concat(" L "+g+" "+(n.y+r/2)+" L "+g+" "+(f-t)+" Q "+g+" "+f+" "+(g-e)+" "+f)).concat(" L "+(u+e)+" "+f+" Q "+u+" "+f+" "+u+" "+(f-t)+" z")):(d=(d=d.concat("M "+(u+e)+" "+p+" Q "+u+" "+p+" "+u+" "+(p+t)+" L "+u+" "+(n.y-r/2))).concat(" L "+(u-r+c)+" "+(h-c)),d=(d=(d+=" Q "+(u-r)+" "+h+" "+(u-r+c)+" "+(h+c)).concat(" L "+u+" "+(n.y+r/2)+" L "+u+" "+(f-t)+" Q "+u+" "+f+" "+(u+e)+" "+f)).concat(" L "+(g-e)+" "+f+" Q "+g+" "+f+" "+g+" "+(f-t)+" L "+g+" "+(p+t)+" Q "+g+" "+p+" "+(g-e)+" "+p+" z")),d}var E=function e(t,i){a(this,e),this.width=t,this.height=i},L=function e(t,i,n,r){a(this,e),this.x=t,this.y=i,this.width=n,this.height=r},T=function e(t,i){a(this,e),this.isRight=i,this.isBottom=t},j=function e(t){a(this,e),this.id=t},D=function(e){l(i,e);var t=c(i);function i(e,n,r,s,o){var l,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",c=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0;return a(this,i),(l=t.call(this,e)).transform="",l.baseLine="auto",l.labelRotation=0,l.x=n,l.y=r,l.anchor=s,l.text=o,l.transform=h,l.baseLine=c,l.labelRotation=d,l}return i}(j);function M(e){return document.getElementById(e)}function F(e){var t=M(e);t&&Object(f.kb)(t)}function P(e,t,i,n,r,a){var s=new I(""),o=function(e,t,i,n,r){var a,s="Path",o=t.width,l=t.height,h=e.x,c=e.y,d=e.x+-o/2,u=e.y+-l/2;switch(i){case"Circle":case"Bubble":s="Ellipse",Object(f.gb)(n,{rx:o/2,ry:l/2,cx:h,cy:c});break;case"Cross":a="M "+d+" "+c+" L "+(h+o/2)+" "+c+" M "+h+" "+(c+l/2)+" L "+h+" "+(c+-l/2),Object(f.gb)(n,{d:a});break;case"HorizontalLine":a="M "+d+" "+c+" L "+(h+o/2)+" "+c,Object(f.gb)(n,{d:a});break;case"VerticalLine":a="M "+h+" "+(c+l/2)+" L "+h+" "+(c+-l/2),Object(f.gb)(n,{d:a});break;case"Diamond":a="M "+d+" "+c+" L "+h+" "+(c+-l/2)+" L "+(h+o/2)+" "+c+" L "+h+" "+(c+l/2)+" L "+d+" "+c+" z",Object(f.gb)(n,{d:a});break;case"Rectangle":a="M "+d+" "+(c+-l/2)+" L "+(h+o/2)+" "+(c+-l/2)+" L "+(h+o/2)+" "+(c+l/2)+" L "+d+" "+(c+l/2)+" L "+d+" "+(c+-l/2)+" z",Object(f.gb)(n,{d:a});break;case"Triangle":a="M "+d+" "+(c+l/2)+" L "+h+" "+(c+-l/2)+" L "+(h+o/2)+" "+(c+l/2)+" L "+d+" "+(c+l/2)+" z",Object(f.gb)(n,{d:a});break;case"InvertedTriangle":a="M "+(h+o/2)+" "+(c-l/2)+" L "+h+" "+(c+l/2)+" L "+(h-o/2)+" "+(c-l/2)+" L "+(h+o/2)+" "+(c-l/2)+" z",Object(f.gb)(n,{d:a});break;case"Pentagon":for(var p,g,m=0;m<=5;m++)p=o/2*Math.cos(Math.PI/180*(72*m)),g=l/2*Math.sin(Math.PI/180*(72*m)),a=0===m?"M "+(h+p)+" "+(c+g)+" ":a.concat("L "+(h+p)+" "+(c+g)+" ");a=a.concat("Z"),Object(f.gb)(n,{d:a});break;case"Image":s="Image",Object(f.gb)(n,{href:r,height:l,width:o,x:d,y:u})}return{renderOption:n,functionName:s}}(e,i,t,r,n),l=s["draw"+o.functionName](o.renderOption);return l.setAttribute("aria-label",a),l}var N,B,H,_,z,V,U=function(e){l(i,e);var t=c(i);function i(e,n,r,s,o,l,h){var c;return a(this,i),(c=t.call(this,e)).opacity=o,c.fill=n,c.stroke=s,c["stroke-width"]=r,c["stroke-dasharray"]=l,c.d=h,c}return i}(j),q=function e(t,i){a(this,e),this.x=t,this.y=i},W=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Z=(z=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),W([Object(f.t)(null)],z.prototype,"size",void 0),W([Object(f.t)("")],z.prototype,"color",void 0),W([Object(f.t)("Segoe UI")],z.prototype,"fontFamily",void 0),W([Object(f.t)("Normal")],z.prototype,"fontWeight",void 0),W([Object(f.t)("Normal")],z.prototype,"fontStyle",void 0),W([Object(f.t)(1)],z.prototype,"opacity",void 0),z),G=(_=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),W([Object(f.t)("")],_.prototype,"color",void 0),W([Object(f.t)(1)],_.prototype,"width",void 0),_),Y=(H=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),W([Object(f.t)(0)],H.prototype,"x",void 0),W([Object(f.t)(0)],H.prototype,"y",void 0),W([Object(f.t)(0)],H.prototype,"width",void 0),W([Object(f.t)(0)],H.prototype,"height",void 0),H),X=(B=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),W([Object(f.t)(0)],B.prototype,"x",void 0),W([Object(f.t)(0)],B.prototype,"y",void 0),B),K=(N=function(e){l(n,e);var i=c(n);function n(e,t){return a(this,n),i.call(this,e,t)}return o(n,[{key:"preRender",value:function(){this.allowServerDataBinding=!1,this.initPrivateVariable(),this.isCanvas||this.removeSVG(),this.createTooltipElement()}},{key:"initPrivateVariable",value:function(){this.renderer=new I(this.element.id),this.themeStyle=function(e){var t;switch(e){case"Highcontrast":case"HighContrast":t={tooltipFill:"#ffffff",tooltipBoldLabel:"#000000",tooltipLightLabel:"#000000",tooltipHeaderLine:"#969696"};break;case"MaterialDark":case"FabricDark":case"BootstrapDark":t={tooltipFill:"#F4F4F4",tooltipBoldLabel:"#282727",tooltipLightLabel:"#333232",tooltipHeaderLine:"#9A9A9A"};break;case"Bootstrap4":t={tooltipFill:"rgba(0, 0, 0, 0.9)",tooltipBoldLabel:"rgba(255, 255, 255)",tooltipLightLabel:"rgba(255, 255, 255, 0.9)",tooltipHeaderLine:"rgba(255, 255, 255, 0.2)"};break;case"Tailwind":t={tooltipFill:"#111827",tooltipBoldLabel:"#D1D5DB",tooltipLightLabel:"#F9FAFB",tooltipHeaderLine:"#6B7280"};break;case"TailwindDark":t={tooltipFill:"#F9FAFB",tooltipBoldLabel:"#6B7280",tooltipLightLabel:"#1F2937",tooltipHeaderLine:"#9CA3AF"};break;default:t={tooltipFill:"rgba(0, 8, 22, 0.75)",tooltipBoldLabel:"#ffffff",tooltipLightLabel:"#dbdbdb",tooltipHeaderLine:"#ffffff"}}return t}(this.theme),this.formattedText=[],this.padding=5,this.isFirst=!0,this.markerPoint=[]}},{key:"removeSVG",value:function(){var e=document.getElementById(this.element.id+"_svg"),t=document.getElementById(this.element.id+"parent_template");this.blazorTemplate&&Object(f.mb)(this.element.id+"parent_template_blazorTemplate"),e&&e.parentNode&&Object(f.kb)(e),t&&t.parentNode&&Object(f.kb)(t)}},{key:"render",value:function(){if(this.fadeOuted=!1,this.template)this.updateTemplateFn(),this.createTemplate(this.areaBounds,this.location);else{this.renderText(this.isFirst),this.trigger("tooltipRender",{cancel:!1,name:"tooltipRender",tooltip:this});var e=this.renderTooltipElement(this.areaBounds,this.location);this.drawMarker(e.isBottom,e.isRight,this.markerSize)}this.trigger("loaded",{tooltip:this});var t=document.getElementById("chartmeasuretext");t&&Object(f.kb)(t),this.allowServerDataBinding=!0}},{key:"createTooltipElement",value:function(){if(this.textElements=[],!this.template||this.shared){var e=this.renderer.createSvg({id:this.element.id+"_svg"});this.element.appendChild(e);var t=document.getElementById(this.element.id+"_group");t||(t=this.renderer.createGroup({id:this.element.id+"_group"})).setAttribute("transform","translate(0,0)"),e.appendChild(t);var i=this.renderer.drawPath({id:this.element.id+"_path","stroke-width":this.border.width,fill:this.fill||this.themeStyle.tooltipFill,opacity:"TailwindDark"!==this.theme&&"Tailwind"!==this.theme||.75!==this.opacity?this.opacity:1,stroke:this.border.color});t.appendChild(i)}}},{key:"drawMarker",value:function(e,i,n){if(this.shapes.length<=0)return null;var r,a,s=0,o=this.renderer.createGroup({id:this.element.id+"_trackball_group"}),l=M(this.element.id+"_group"),h=2*this.marginX+n/2+(i?this.arrowPadding:0),c=t(this.shapes);try{for(c.s();!(a=c.n()).done;){var d=a.value;"None"!==d&&(r=new U(this.element.id+"_Trackball_"+s,this.palette[s],1,"#cccccc",1,null),this.markerPoint[s]&&o.appendChild(P(new q(h,this.markerPoint[s]-this.padding+(e?this.arrowPadding:0)),d,new E(n,n),"",r,null)),s++)}}catch(u){c.e(u)}finally{c.f()}l.appendChild(o)}},{key:"renderTooltipElement",value:function(e,t){var i,n=M(this.element.id),r=new q(0,0),a=new q(0,0),s=M(this.element.id+"_svg"),o=M(this.element.id+"_group"),l=M(this.element.id+"_path"),h=!1,c=!1,d=!1,u=0,p=0;if(this.tipRadius=1,""!==this.header&&(this.elementSize.height+=this.marginY),this.content.length>1?(i=this.sharedTooltipLocation(e,this.location.x,this.location.y),h=!0):(i=this.tooltipLocation(e,t,r,a),this.inverted?u=(c=i.x<t.x+this.clipBounds.x)?0:this.arrowPadding:(d=!(h=i.y<t.y+this.clipBounds.y),p=h?0:this.arrowPadding)),""!==this.header){var g=R(this.isWrap?this.wrappedText:this.header,this.textStyle).height+2*this.marginY+(d?this.arrowPadding:0)+(this.isWrap?5:0),m=this.renderer.drawPath({id:this.element.id+"_header_path","stroke-width":1,fill:null,opacity:.8,stroke:this.themeStyle.tooltipHeaderLine,d:"M "+(3*this.marginX+(c||h||d?0:this.arrowPadding))+" "+g+"L "+(i.width+(c||h||d?0:this.arrowPadding)-2*this.marginX)+" "+g});o.appendChild(m)}var v=this.border.width/2,y=new L(v+u,v+p,i.width-v,i.height-v);if(o.setAttribute("opacity","1"),!this.enableAnimation||this.shared||this.isFirst?this.updateDiv(n,i.x,i.y):this.animateTooltipDiv(n,i),s.setAttribute("height",(i.height+this.border.width+(this.inverted?0:this.arrowPadding)+5).toString()),s.setAttribute("width",(i.width+this.border.width+(this.inverted?this.arrowPadding:0)+5).toString()),s.setAttribute("opacity","1"),Object(f.Z)(this.tooltipPlacement)||(h=this.tooltipPlacement.indexOf("Top")>-1,d=this.tooltipPlacement.indexOf("Bottom")>-1,c=this.tooltipPlacement.indexOf("Left")>-1),l.setAttribute("d",A(this.rx,this.ry,y,r,this.arrowPadding,h,d,c,a.x,a.y,this.tipRadius)),this.enableShadow&&"Bootstrap4"!==this.theme){var b=this.element.id+"_shadow";"Tailwind"===this.theme||"TailwindDark"===this.theme?l.setAttribute("box-shadow","0px 1px 2px rgba(0, 0, 0, 0.06), 0px 1px 3px rgba(0, 0, 0, 0.1)"):l.setAttribute("filter",f.d.isIE?"":"url(#"+b+")");var C='<filter id="'+b+'" height="130%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/>';C+='<feOffset dx="3" dy="3" result="offsetblur"/><feComponentTransfer><feFuncA type="linear" slope="0.5"/>',C+='</feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';var x=this.renderer.createDefs();x.setAttribute("id",this.element.id+"SVG_tooltip_definition"),o.appendChild(x),x.innerHTML=C}return l.setAttribute("stroke",this.border.color),this.changeText(new q(u,p),d,!c&&!h&&!d),new T(d,!c&&!h&&!d)}},{key:"changeText",value:function(e,t,i){var n=document.getElementById(this.element.id+"_text");t&&n.setAttribute("transform","translate(0,"+this.arrowPadding+")"),i&&n.setAttribute("transform","translate("+this.arrowPadding+" 0)")}},{key:"findFormattedText",value:function(){this.formattedText=[],""!==this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim()&&(this.formattedText=this.formattedText.concat(this.header)),this.formattedText=this.formattedText.concat(this.content)}},{key:"renderText",value:function(e){var t,i,n,r,a,s=0,o=0,l=0,h=Object(f.L)({},this.textStyle,null,!0).properties,c=M(this.element.id+"_group"),d="";this.findFormattedText();var u="rtl"===document.body.getAttribute("dir")?"end":"start";this.leftSpace=this.areaBounds.x+this.location.x,this.rightSpace=this.areaBounds.x+this.areaBounds.width-this.leftSpace;var p=this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim(),g=this.header.indexOf("<b>")>-1&&this.header.indexOf("</b>")>-1,m=R(this.formattedText[0],h).width+2*this.marginX+this.arrowPadding,v=this.location.x-m<this.location.x,y=this.areaBounds.x+this.areaBounds.width<this.location.x+m,b=""!==p?this.marginY:0,C=!0,x=!0;this.markerPoint=[];var S,w=this.shapes.length>0?10:0,k=this.shapes.length>0?5:0,O="Normal",A=this.themeStyle.tooltipLightLabel,L=22/parseFloat("13px")*parseFloat(h.size);e&&!this.isCanvas||(F(this.element.id+"_text"),F(this.element.id+"_header_path"),F(this.element.id+"_trackball_group"),F(this.element.id+"SVG_tooltip_definition"));for(var T=new D(this.element.id+"_text",2*this.marginX,2*this.marginY+2*this.padding+(2===this.marginY?3:0),u,""),j=function(e,t,i,n){var r,a=new I("");r={id:e.id,x:e.x,y:e.y,fill:null,"font-size":t.size,"font-style":t.fontStyle,"font-family":t.fontFamily,"font-weight":t.fontWeight,"text-anchor":e.anchor,transform:e.transform,opacity:t.opacity,"dominant-baseline":e.baseLine};var s=a.createText(r,"string"==typeof e.text?e.text:e.text[0]);return s.style.fontFamily=t.fontFamily,s.style.fontStyle=t.fontStyle,s.style.fontSize=t.size,s.style.fontWeight=t.fontWeight,s.style.color=t.color,n.appendChild(s),s}(T,h,0,c),P=1===this.formattedText.length&&this.formattedText[0].indexOf(" : <b>")>-1,N=""!==this.header,B=N&&g?16:13,H=0,_=this.formattedText.length;H<_;H++)if(n=this.formattedText[H].replace(/<(b|strong)>/g,"<b>").replace(/<\/(b|strong)>/g,"</b>").split(/<br.*?>/g),0===H&&!P&&this.isTextWrap&&(this.leftSpace<m||v)&&(this.rightSpace<m||y)&&(S=Math.round(this.leftSpace>this.rightSpace?this.leftSpace/B:this.rightSpace/B),n=(""!==p?p:this.formattedText[H]).match(new RegExp(".{1,"+S+"}","g")),this.wrappedText=g?"<b>"+n.join("<br>")+"</b>":n.join("<br>"),this.isWrap=n.length>1),""!==n[0]){0===H&&""!==p||this.markerPoint.push((""!==p?this.marginY:0)+T.y+s);for(var z=0,V=n.length;z<V;z++){l=0,x=!0,s+=L;for(var U=0,q=(t=n[z].replace(/<b>/g,"<br><b>").replace(/<\/b>/g,"</b><br>").replace(/:/g,"<br>\u200e:<br>").split("<br>")).length;U<q;U++)r=t[U],/\S/.test(r)||""===r||(r=" "),(!x&&" "===r||""!==r.replace(/<b>/g,"").replace(/<\/b>/g,"").trim())&&(l+=" "!==r?4:0,x&&!C?(a={x:2*this.marginX+(w+k),dy:L+(x?b:0),fill:""},b=null):a=C&&x?{x:""===p?2*this.marginX+(w+k):2*this.marginX+(this.isWrap?w+k:0)}:{},x=!1,i=this.renderer.createTSpan(a,""),j.appendChild(i),r.indexOf("<b>")>-1||g&&0===U&&0===H&&(N||this.isWrap)?(O="bold",A=this.themeStyle.tooltipBoldLabel,d="font-weight:"+O,h.fontWeight=O,i.setAttribute("fill",this.textStyle.color||A)):(d="bold"===O?"font-weight:"+O:"",h.fontWeight=O,i.setAttribute("fill",this.textStyle.color||A)),(r.indexOf("</b>")>-1||g&&U===q-1&&0===H&&(N||this.isWrap))&&(O="Normal",A=this.themeStyle.tooltipLightLabel),i.textContent=r=this.getTooltipTextContent(r),l+=R(r,h).width,""!==d&&(i.style.fontWeight=d.split("font-weight:")[1],i.style.color=i.getAttribute("fill")),i.style.fontFamily="inherit",i.style.fontStyle="inherit",i.style.fontSize="inherit",C=!1);l-=4,o=Math.max(o,l)}}this.elementSize=new E(o+(o>0?2*this.marginX:0),s),this.elementSize.width+=w+k;var W=j.childNodes[0];if(""!==p&&W&&!this.isWrap){h.fontWeight="bold";var Z=(this.elementSize.width+2*this.padding)/2-R(p,h).width/2;W.setAttribute("x",Z.toString())}}},{key:"getTooltipTextContent",value:function(e){var t=e.match(/<[a-zA-Z\/](.|\n)*?>/g);if(Object(f.Z)(t))return e;for(var i=/[\u0590-\u07FF\u200F\u202B\u202E\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(e),n=0;n<t.length;n++)this.isValidHTMLElement(t[n].replace("<","").replace("/","").replace(">","").trim())&&(e=e.replace(t[n],i?"\u200e":""));return e}},{key:"isValidHTMLElement",value:function(e){return"[object HTMLUnknownElement]"!=document.createElement(e).toString()}},{key:"createTemplate",value:function(e,t){var i={cancel:!1,name:"tooltipRender",tooltip:this};this.trigger("tooltipRender",i);var n=document.getElementById(this.element.id);this.isCanvas&&this.removeSVG();var r=n.firstElementChild;if(r&&Object(f.kb)(r),i.cancel)Object(f.kb)(M(this.element.id+"_tooltip"));else{for(var a=Object(f.G)("div",{id:this.element.id+"parent_template"}),s=this.templateFn(this.data,this.controlInstance,a.id,a.id+"_blazorTemplate","");s&&s.length>0;)Object(f.Y)()||1===s.length?(a.appendChild(s[0]),s=null):a.appendChild(s[0]);n.appendChild(a);var o=this.isCanvas?a:this.element,l=o.getBoundingClientRect();this.padding=0,this.elementSize=new E(l.width,l.height);var h=this.shared?this.sharedTooltipLocation(e,this.location.x,this.location.y):this.tooltipLocation(e,t,new q(0,0),new q(0,0));if(!this.enableAnimation||this.shared||this.isFirst?this.updateDiv(o,h.x,h.y):this.animateTooltipDiv(this.element,h),this.blazorTemplate){var c=function(){var i=M(d.element.id).getBoundingClientRect();d.elementSize=new E(i.width,i.height);var n=d.tooltipLocation(e,t,new q(0,0),new q(0,0));d.updateDiv(M(d.element.id),n.x,n.y)},d=this;c.bind(d,e,t),Object(f.vb)(this.element.id+"parent_template_blazorTemplate",this.blazorTemplate.name,this.blazorTemplate.parent,void 0,c)}}}},{key:"sharedTooltipLocation",value:function(e,t,i){var n=this.elementSize.height+2*this.marginY,r=new L(t+2*this.padding,i-n-this.padding,this.elementSize.width+2*this.marginX,n);return r.y<e.y&&(r.y+=r.height+2*this.padding),r.x+r.width>e.x+e.width&&(r.x-=r.width+4*this.padding),r}},{key:"getCurrentPosition",value:function(e,t,i,n){var r=this.tooltipPlacement,a=this.clipBounds.x,s=this.clipBounds.y,o=this.offset,l=this.elementSize.width+2*this.marginX,h=this.elementSize.height+2*this.marginY,c=new q(t.x,t.y);return"Top"===r||"Bottom"===r?(c=new q(c.x+a-this.elementSize.width/2-this.padding,c.y+s-this.elementSize.height-2*this.padding-this.arrowPadding-o),i.x=n.x=l/2,"Bottom"===r&&(c.y=t.y+s+o),e.x+e.width<c.x+l?(c.x=e.width>l?e.x+e.width-l+6:e.x,i.x=n.x=e.width>l?e.x+t.x-c.x:t.x):e.x>c.x&&(c.x=e.x,i.x=n.x=t.x)):(c=new q(c.x+a+o,c.y+s-this.elementSize.height/2-this.padding),i.y=n.y=h/2,"Left"===r&&(c.x=t.x+a-o-(l+this.arrowPadding)),e.y+e.height<c.y+h?(c.y=e.height>h?e.y+e.height-h+6:e.y,i.y=n.y=e.height>h?e.y+t.y-c.y:t.y):e.y>c.y&&(c.y=e.y,i.y=n.y=t.y)),new L(c.x,c.y,l,h)}},{key:"tooltipLocation",value:function(e,t,i,n){if(!Object(f.Z)(this.tooltipPlacement))return this.getCurrentPosition(e,t,i,n);var r=new q(t.x,t.y),a=this.elementSize.width+2*this.marginX,s=this.elementSize.height+2*this.marginY,o=this.offset,l=this.clipBounds.x,h=this.clipBounds.y,c=e.x,d=e.y;return this.inverted?(r=new q(r.x+l+o,r.y+h-this.elementSize.height/2-this.padding),i.y=n.y=s/2,(r.x+a+this.arrowPadding>c+e.width||this.isNegative)&&(r.x=(t.x>e.width?e.width:t.x)+l-o-(a+this.arrowPadding)),r.x<c&&(r.x=(t.x<0?0:t.x)+l+o),r.y<=d&&(i.y-=d-r.y,n.y-=d-r.y,r.y=d),r.y+s>=d+e.height&&(i.y+=r.y+s-(d+e.height),n.y+=r.y+s-(d+e.height),r.y-=r.y+s-(d+e.height)),i.y+this.arrowPadding/2>s-this.ry&&(i.y=s-this.ry-this.arrowPadding/2,n.y=s,this.tipRadius=0),i.y-this.arrowPadding/2<this.ry&&(i.y=this.ry+this.arrowPadding/2,n.y=0,this.tipRadius=0)):(r=new q(r.x+l-this.elementSize.width/2-this.padding,r.y+h-this.elementSize.height-2*this.padding-this.arrowPadding-o),i.x=n.x=a/2,(r.y<d||this.isNegative)&&(r.y=(t.y<0?0:t.y)+h+o),r.y+s+this.arrowPadding>d+e.height&&(r.y=Math.min(t.y,d+e.height)+h-this.elementSize.height-2*this.padding-this.arrowPadding-o),n.x=a/2,r.x<c&&(i.x-=c-r.x,n.x-=c-r.x,r.x=c),r.x+a>c+e.width&&(i.x+=r.x+a-(c+e.width),n.x+=r.x+a-(c+e.width),r.x-=r.x+a-(c+e.width)),i.x+this.arrowPadding/2>a-this.rx&&(i.x=a-this.rx-this.arrowPadding/2,n.x=a,this.tipRadius=0),i.x-this.arrowPadding/2<this.rx&&(i.x=this.rx+this.arrowPadding/2,n.x=0,this.tipRadius=0)),new L(r.x,r.y,a,s)}},{key:"animateTooltipDiv",value:function(e,t){var i,n=this,r=parseFloat(e.style.left),a=parseFloat(e.style.top);new f.b({}).animate(e,{duration:this.duration,progress:function(n){i=n.timeStamp/n.duration,e.style.animation=null,e.style.left=r+i*(t.x-r)+"px",e.style.top=a+i*(t.y-a)+"px"},end:function(i){n.updateDiv(e,t.x,t.y),n.trigger("animationComplete",{tooltip:n})}})}},{key:"updateDiv",value:function(e,t,i){e.style.left=t+"px",e.style.top=i+"px"}},{key:"updateTemplateFn",value:function(){if(this.template)try{document.querySelectorAll(this.template).length&&(this.templateFn=Object(f.F)(document.querySelector(this.template).innerHTML.trim()))}catch(e){this.templateFn=Object(f.F)(this.template)}}},{key:"fadeOut",value:function(){var e=this,t=M(this.isCanvas&&!this.template?this.element.id+"_svg":this.element.id);if(t){var i=t.firstChild;if(this.isCanvas&&!this.template&&(i=document.getElementById(this.element.id+"_group")?document.getElementById(this.element.id+"_group"):i),!i)return null;var n=parseFloat(i.getAttribute("opacity"))||1;new f.b({}).animate(i,{duration:200,progress:function(t){e.progressAnimation(i,n,t.timeStamp/t.duration)},end:function(){e.fadeOuted=!0,e.endAnimation(i)}})}}},{key:"progressAnimation",value:function(e,t,i){e.style.animation="",e.setAttribute("opacity",(t-i).toString())}},{key:"endAnimation",value:function(e){e.setAttribute("opacity","0"),this.template&&(e.style.display="none"),this.trigger("animationComplete",{tooltip:this})}},{key:"getPersistData",value:function(){return this.addOnPersist([])}},{key:"getModuleName",value:function(){return"tooltip"}},{key:"destroy",value:function(){r(p(n.prototype),"destroy",this).call(this),this.element.classList.remove("e-tooltip")}},{key:"onPropertyChanged",value:function(e,t){this.blazorTemplate&&Object(f.mb)(this.element.id+"parent_template_blazorTemplate"),this.isFirst=!1,this.render()}}]),n}(f.h),W([Object(f.t)(!1)],N.prototype,"enable",void 0),W([Object(f.t)(!1)],N.prototype,"shared",void 0),W([Object(f.t)(!0)],N.prototype,"enableShadow",void 0),W([Object(f.t)(null)],N.prototype,"fill",void 0),W([Object(f.t)("")],N.prototype,"header",void 0),W([Object(f.t)(.75)],N.prototype,"opacity",void 0),W([Object(f.g)({size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},Z)],N.prototype,"textStyle",void 0),W([Object(f.t)(null)],N.prototype,"template",void 0),W([Object(f.t)(!0)],N.prototype,"enableAnimation",void 0),W([Object(f.t)(300)],N.prototype,"duration",void 0),W([Object(f.t)(!1)],N.prototype,"inverted",void 0),W([Object(f.t)(!1)],N.prototype,"isNegative",void 0),W([Object(f.g)({color:"#cccccc",width:.5},G)],N.prototype,"border",void 0),W([Object(f.t)([])],N.prototype,"content",void 0),W([Object(f.t)(10)],N.prototype,"markerSize",void 0),W([Object(f.g)({x:0,y:0},X)],N.prototype,"clipBounds",void 0),W([Object(f.t)([])],N.prototype,"palette",void 0),W([Object(f.t)([])],N.prototype,"shapes",void 0),W([Object(f.g)({x:0,y:0},X)],N.prototype,"location",void 0),W([Object(f.t)(0)],N.prototype,"offset",void 0),W([Object(f.t)(2)],N.prototype,"rx",void 0),W([Object(f.t)(2)],N.prototype,"ry",void 0),W([Object(f.t)(5)],N.prototype,"marginX",void 0),W([Object(f.t)(5)],N.prototype,"marginY",void 0),W([Object(f.t)(12)],N.prototype,"arrowPadding",void 0),W([Object(f.t)(null)],N.prototype,"data",void 0),W([Object(f.t)("Material")],N.prototype,"theme",void 0),W([Object(f.g)({x:0,y:0,width:0,height:0},Y)],N.prototype,"areaBounds",void 0),W([Object(f.t)(null)],N.prototype,"availableSize",void 0),W([Object(f.t)()],N.prototype,"blazorTemplate",void 0),W([Object(f.t)(!1)],N.prototype,"isCanvas",void 0),W([Object(f.t)(!1)],N.prototype,"isTextWrap",void 0),W([Object(f.t)(null)],N.prototype,"tooltipPlacement",void 0),W([Object(f.t)(null)],N.prototype,"controlInstance",void 0),W([Object(f.k)()],N.prototype,"tooltipRender",void 0),W([Object(f.k)()],N.prototype,"loaded",void 0),W([Object(f.k)()],N.prototype,"animationComplete",void 0),N=W([f.r],N)),J=s("eNK/");function Q(e){var t;switch(e){case"Fabric":t=["#4472c4","#ed7d31","#ffc000","#70ad47","#5b9bd5","#c1c1c1","#6f6fe2","#e269ae","#9e480e","#997300"];break;case"Bootstrap4":case"Bootstrap":t=["#a16ee5","#f7ce69","#55a5c2","#7ddf1e","#ff6ea6","#7953ac","#b99b4f","#407c92","#5ea716","#b91c52"];break;case"HighContrastLight":case"Highcontrast":case"HighContrast":t=["#79ECE4","#E98272","#DFE6B6","#C6E773","#BA98FF","#FA83C3","#00C27A","#43ACEF","#D681EF","#D8BC6E"];break;case"MaterialDark":t=["#00bdae","#404041","#357cd2","#e56590","#f8b883","#70ad47","#dd8abd","#7f84e8","#7bb4eb","#ea7a57"];break;case"FabricDark":t=["#4472c4","#ed7d31","#ffc000","#70ad47","#5b9bd5","#c1c1c1","#6f6fe2","#e269ae","#9e480e","#997300"];break;case"BootstrapDark":t=["#a16ee5","#f7ce69","#55a5c2","#7ddf1e","#ff6ea6","#7953ac","#b99b4f","#407c92","#5ea716","#b91c52"];break;case"Tailwind":t=["#5A61F6","#65A30D","#334155","#14B8A6","#8B5CF6","#0369A1","#F97316","#9333EA","#F59E0B","#15803D"];break;case"TailwindDark":t=["#8B5CF6","#22D3EE","#F87171","#4ADE80","#E879F9","#FCD34D","#F97316","#2DD4BF","#F472B6","#10B981"];break;default:t=["#00bdae","#404041","#357cd2","#e56590","#f8b883","#70ad47","#dd8abd","#7f84e8","#7bb4eb","#ea7a57"]}return t}function $(e){var t,i="MaterialDark"===e?"#303030":"FabricDark"===e?"#201F1F":"1A1A1A";switch(e){case"HighContrastLight":case"Highcontrast":case"HighContrast":t={axisLabel:"#ffffff",axisTitle:"#ffffff",axisLine:"#ffffff",majorGridLine:"#BFBFBF",minorGridLine:"#969696",majorTickLine:"#BFBFBF",minorTickLine:"#969696",chartTitle:"#ffffff",legendLabel:"#ffffff",background:"#000000",areaBorder:"#ffffff",errorBar:"#ffffff",crosshairLine:"#ffffff",crosshairFill:"#ffffff",crosshairLabel:"#000000",tooltipFill:"#ffffff",tooltipBoldLabel:"#000000",tooltipLightLabel:"#000000",tooltipHeaderLine:"#969696",markerShadow:"#BFBFBF",selectionRectFill:"rgba(255, 217, 57, 0.3)",selectionRectStroke:"#ffffff",selectionCircleStroke:"#FFD939"};break;case"MaterialDark":case"FabricDark":case"BootstrapDark":t={axisLabel:"#DADADA",axisTitle:"#ffffff",axisLine:" #6F6C6C",majorGridLine:"#414040",minorGridLine:"#514F4F",majorTickLine:"#414040",minorTickLine:" #4A4848",chartTitle:"#ffffff",legendLabel:"#DADADA",background:i,areaBorder:" #9A9A9A",errorBar:"#ffffff",crosshairLine:"#F4F4F4",crosshairFill:"#F4F4F4",crosshairLabel:"#282727",tooltipFill:"#F4F4F4",tooltipBoldLabel:"#282727",tooltipLightLabel:"#333232",tooltipHeaderLine:"#9A9A9A",markerShadow:null,selectionRectFill:"rgba(56,169,255, 0.1)",selectionRectStroke:"#38A9FF",selectionCircleStroke:"#282727"};break;case"Bootstrap4":t={axisLabel:"#212529",axisTitle:"#212529",axisLine:"#CED4DA",majorGridLine:"#CED4DA",minorGridLine:"#DEE2E6",majorTickLine:"#ADB5BD",minorTickLine:"#CED4DA",chartTitle:"#212529",legendLabel:"#212529",background:"#FFFFFF",areaBorder:"#DEE2E6",errorBar:"#000000",crosshairLine:"#6C757D",crosshairFill:"#495057",crosshairLabel:"#FFFFFF",tooltipFill:"rgba(0, 0, 0, 0.9)",tooltipBoldLabel:"rgba(255,255,255)",tooltipLightLabel:"rgba(255,255,255, 0.9)",tooltipHeaderLine:"rgba(255,255,255, 0.2)",markerShadow:null,selectionRectFill:"rgba(255,255,255, 0.1)",selectionRectStroke:"rgba(0, 123, 255)",selectionCircleStroke:"#495057"};break;case"Tailwind":t={axisLabel:"#6B728",axisTitle:"#374151",axisLine:" #D1D5DB",majorGridLine:"#E5E7EB",minorGridLine:"#E5E7EB",majorTickLine:"#D1D5DB",minorTickLine:" #D1D5DB",chartTitle:"#374151",legendLabel:"#374151",background:"rgba(255,255,255, 0.0)",areaBorder:" #E5E7EB",errorBar:"#374151",crosshairLine:"#1F2937",crosshairFill:"#111827",crosshairLabel:"#F9FAFB",tooltipFill:"#111827",tooltipBoldLabel:"#D1D5DB",tooltipLightLabel:"#F9FAFB",tooltipHeaderLine:"#6B7280",markerShadow:null,selectionRectFill:"rgba(79,70,229, 0.1)",selectionRectStroke:"#4F46E5",selectionCircleStroke:"#6B7280"};break;case"TailwindDark":t={axisLabel:"#9CA3AF",axisTitle:"#9CA3AF",axisLine:" #4B5563",majorGridLine:"#374151",minorGridLine:"#374151",majorTickLine:"#4B5563",minorTickLine:" #4B5563",chartTitle:"#D1D5DB",legendLabel:"#D1D5DB",background:"rgba(255,255,255, 0.0)",areaBorder:" #374151",errorBar:"#374151",crosshairLine:"#9CA3AF",crosshairFill:"#F9FAFB",crosshairLabel:"#1F2937",tooltipFill:"#F9FAFB",tooltipBoldLabel:"#6B7280",tooltipLightLabel:"#1F2937",tooltipHeaderLine:"#9CA3AF",markerShadow:null,selectionRectFill:"rgba(34,211,238, 0.1)",selectionRectStroke:"#22D3EE",selectionCircleStroke:"#282727"};break;default:t={axisLabel:"#686868",axisTitle:"#424242",axisLine:"#b5b5b5",majorGridLine:"#dbdbdb",minorGridLine:"#eaeaea",majorTickLine:"#b5b5b5",minorTickLine:"#d6d6d6",chartTitle:"#424242",legendLabel:"#353535",background:"#FFFFFF",areaBorder:"Gray",errorBar:"#000000",crosshairLine:"#4f4f4f",crosshairFill:"#4f4f4f",crosshairLabel:"#e5e5e5",tooltipFill:"rgba(0, 8, 22, 0.75)",tooltipBoldLabel:"#ffffff",tooltipLightLabel:"#dbdbdb",tooltipHeaderLine:"#ffffff",markerShadow:null,selectionRectFill:"rgba(41, 171, 226, 0.1)",selectionRectStroke:"#29abe2",selectionCircleStroke:"#29abe2"}}return t}s("gnsf"),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.axisTitleFont={size:"14px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartTitleFont={size:"15px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartSubTitleFont={size:"11px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.crosshairLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.tooltipLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendTitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.stripLineLabelFont={size:"12px",fontWeight:"Regular",color:"#353535",fontStyle:"Normal",fontFamily:"Segoe UI"},e.stockEventFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"}}(V||(V={}));var ee,te,ie,ne,re,ae,se,oe,le,he,ce,de,ue,pe,ge,fe,me,ve,ye,be,Ce,xe,Se,we,ke,Ie,Oe,Re,Ae,Ee=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Le=(he=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)("Line")],he.prototype,"type",void 0),Ee([Object(f.t)(null)],he.prototype,"color",void 0),Ee([Object(f.t)(1)],he.prototype,"width",void 0),Ee([Object(f.t)(null)],he.prototype,"length",void 0),Ee([Object(f.t)("")],he.prototype,"dashArray",void 0),he),Te=(le=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)("Normal")],le.prototype,"fontStyle",void 0),Ee([Object(f.t)("16px")],le.prototype,"size",void 0),Ee([Object(f.t)("Normal")],le.prototype,"fontWeight",void 0),Ee([Object(f.t)("")],le.prototype,"color",void 0),Ee([Object(f.t)("Center")],le.prototype,"textAlignment",void 0),Ee([Object(f.t)("Segoe UI")],le.prototype,"fontFamily",void 0),Ee([Object(f.t)(1)],le.prototype,"opacity",void 0),Ee([Object(f.t)("Trim")],le.prototype,"textOverflow",void 0),le),je=(oe=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)("")],oe.prototype,"color",void 0),Ee([Object(f.t)(1)],oe.prototype,"width",void 0),oe),De=(se=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(0)],se.prototype,"x",void 0),Ee([Object(f.t)(0)],se.prototype,"y",void 0),se),Me=(ae=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.g)({},je)],ae.prototype,"border",void 0),Ee([Object(f.t)("transparent")],ae.prototype,"background",void 0),Ee([Object(f.t)(1)],ae.prototype,"opacity",void 0),Ee([Object(f.t)(null)],ae.prototype,"backgroundImage",void 0),ae),Fe=(re=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(10)],re.prototype,"left",void 0),Ee([Object(f.t)(10)],re.prototype,"right",void 0),Ee([Object(f.t)(10)],re.prototype,"top",void 0),Ee([Object(f.t)(10)],re.prototype,"bottom",void 0),re),Pe=(ne=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(0)],ne.prototype,"left",void 0),Ee([Object(f.t)(0)],ne.prototype,"right",void 0),Ee([Object(f.t)(0)],ne.prototype,"top",void 0),Ee([Object(f.t)(0)],ne.prototype,"bottom",void 0),ne),Ne=(ie=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(!0)],ie.prototype,"enable",void 0),Ee([Object(f.t)(1e3)],ie.prototype,"duration",void 0),Ee([Object(f.t)(0)],ie.prototype,"delay",void 0),ie),Be=(te=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(0)],te.prototype,"series",void 0),Ee([Object(f.t)(0)],te.prototype,"point",void 0),te),He=(ee=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(0)],ee.prototype,"topLeft",void 0),Ee([Object(f.t)(0)],ee.prototype,"topRight",void 0),Ee([Object(f.t)(0)],ee.prototype,"bottomLeft",void 0),Ee([Object(f.t)(0)],ee.prototype,"bottomRight",void 0),ee),_e=function e(t,i){a(this,e),this.series=t,this.point=i},ze=(ue=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(null)],ue.prototype,"fill",void 0),Ee([Object(f.g)({color:"transparent",width:0},je)],ue.prototype,"border",void 0),Ee([Object(f.t)("Gap")],ue.prototype,"mode",void 0),ue),Ve=(de=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(!1)],de.prototype,"enable",void 0),Ee([Object(f.t)(null)],de.prototype,"minY",void 0),Ee([Object(f.t)(null)],de.prototype,"maxY",void 0),Ee([Object(f.t)(null)],de.prototype,"fill",void 0),de),Ue=(ce=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ee([Object(f.t)(!1)],ce.prototype,"enable",void 0),Ee([Object(f.t)(!0)],ce.prototype,"enableMarker",void 0),Ee([Object(f.t)(!1)],ce.prototype,"shared",void 0),Ee([Object(f.t)(null)],ce.prototype,"fill",void 0),Ee([Object(f.t)(null)],ce.prototype,"header",void 0),Ee([Object(f.t)(.75)],ce.prototype,"opacity",void 0),Ee([Object(f.g)(V.tooltipLabelFont,Te)],ce.prototype,"textStyle",void 0),Ee([Object(f.t)(null)],ce.prototype,"format",void 0),Ee([Object(f.t)(null)],ce.prototype,"template",void 0),Ee([Object(f.t)(!0)],ce.prototype,"enableAnimation",void 0),Ee([Object(f.t)(300)],ce.prototype,"duration",void 0),Ee([Object(f.t)(1e3)],ce.prototype,"fadeOutDuration",void 0),Ee([Object(f.t)("Move")],ce.prototype,"fadeOutMode",void 0),Ee([Object(f.t)(!1)],ce.prototype,"enableTextWrap",void 0),Ee([Object(f.g)({color:"#cccccc",width:.5},je)],ce.prototype,"border",void 0),ce),qe=function(){function e(t,i){a(this,e),t<i?(this.mStart=t,this.mEnd=i):(this.mStart=i,this.mEnd=t)}return o(e,[{key:"start",get:function(){return this.mStart}},{key:"end",get:function(){return this.mEnd}},{key:"delta",get:function(){return this.mEnd-this.mStart}},{key:"median",get:function(){return this.mStart+(this.mEnd-this.mStart)/2}}]),e}(),We=function(){function e(t){a(this,e),this.isColumn=0,this.chart=t}return o(e,[{key:"calculateNumericNiceInterval",value:function(e,i,n){var r=Ut(n,e),a=i/r;if(!Object(f.Z)(e.desiredIntervals))return a;var s,o=Math.pow(10,Math.floor(mt(a,10))),l=t(e.intervalDivs);try{for(l.s();!(s=l.n()).done;){var h=o*s.value;if(r<i/h)break;a=h}}catch(c){l.e(c)}finally{l.f()}return a}},{key:"getActualRange",value:function(e,t){this.initializeDoubleRange(e),!e.startFromZero&&this.isColumn>0?(e.actualRange.interval=e.interval||this.calculateNumericNiceInterval(e,e.doubleRange.delta,t),e.actualRange.max=e.doubleRange.end+e.actualRange.interval,e.actualRange.min=e.doubleRange.start-e.actualRange.interval<0&&e.doubleRange.start>0?0:e.doubleRange.start-e.actualRange.interval):(e.actualRange.interval=e.interval||this.calculateNumericNiceInterval(e,e.doubleRange.delta,t),e.actualRange.min=e.doubleRange.start,e.actualRange.max=e.doubleRange.end)}},{key:"initializeDoubleRange",value:function(e){null!==e.minimum?this.min=e.minimum:null!==this.min&&this.min!==Number.POSITIVE_INFINITY||(this.min=0),null!==e.maximum?this.max=e.maximum:null!==this.max&&this.max!==Number.NEGATIVE_INFINITY||(this.max=5),this.min===this.max&&(this.max=e.valueType.indexOf("Category")>-1?this.max:this.min+1),e.doubleRange=new qe(this.min,this.max),e.actualRange={}}},{key:"calculateRangeAndInterval",value:function(e,t){this.calculateRange(t),this.getActualRange(t,e),this.applyRangePadding(t,e),this.calculateVisibleLabels(t,this.chart)}},{key:"calculateRange",value:function(e){if(this.min=null,this.max=null,!zt(e)){var i,n=t(e.series);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.visible&&(this.paddingInterval=0,e.maxPointLength=r.points.length,((r.type.indexOf("Column")>-1||r.type.indexOf("Histogram")>-1)&&"Horizontal"===e.orientation||r.type.indexOf("Bar")>-1&&"Vertical"===e.orientation)&&("Double"!==r.xAxis.valueType&&"DateTime"!==r.xAxis.valueType||"Auto"!==r.xAxis.rangePadding||(this.paddingInterval=.5*Mt(r.xAxis,e.series))),"Horizontal"===e.orientation&&(this.chart.requireInvertedAxis?this.yAxisRange(e,r):this.findMinMax(r.xMin-this.paddingInterval,r.xMax+this.paddingInterval)),"Vertical"===e.orientation&&(this.isColumn+="Column"===r.type||"Bar"===r.type||"Column"===r.drawType?1:0,this.chart.requireInvertedAxis?this.findMinMax(r.xMin-this.paddingInterval,r.xMax+this.paddingInterval):this.yAxisRange(e,r)))}}catch(a){n.e(a)}finally{n.f()}}}},{key:"yAxisRange",value:function(e,t){t.dragSettings.enable&&this.chart.dragY&&(this.chart.dragY>=e.visibleRange.max&&(t.yMax=this.chart.dragY+e.visibleRange.interval),this.chart.dragY<=e.visibleRange.min&&(t.yMin=this.chart.dragY-e.visibleRange.interval)),this.findMinMax(t.yMin,t.yMax)}},{key:"findMinMax",value:function(e,t){(null===this.min||this.min>e)&&(this.min=e),(null===this.max||this.max<t)&&(this.max=t),this.max===this.min&&this.max<0&&this.min<0&&(this.max=0)}},{key:"applyRangePadding",value:function(e,t){var i=e.actualRange.min,n=e.actualRange.max;if(!zt(e)){var r=e.actualRange.interval,a=e.getRangePadding(this.chart);"Additional"===a||"Round"===a?this.findAdditional(e,i,n,r):"Normal"===a?this.findNormal(e,i,n,r,t):this.updateActualRange(e,i,n,r)}e.actualRange.delta=e.actualRange.max-e.actualRange.min,this.calculateVisibleRange(t,e)}},{key:"updateActualRange",value:function(e,t,i,n){e.actualRange={min:null!=e.minimum?e.minimum:t,max:null!=e.maximum?e.maximum:i,interval:null!=e.interval?e.interval:n,delta:e.actualRange.delta}}},{key:"findAdditional",value:function(e,t,i,n){var r,a;r=Math.floor(t/n)*n,a=Math.ceil(i/n)*n,"Additional"===e.rangePadding&&(r-=n,a+=n),this.updateActualRange(e,r,a,n)}},{key:"findNormal",value:function(e,t,i,n,r){var a,s,o=t;t<0?(o=0,.365*n>=n+(a=t+.05*t)%n&&(a-=n),a%n<0&&(a=a-n-a%n)):(a=t<5/6*i?0:t-.5*(i-t))%n>0&&(a-=a%n),.365*n>=n-(s=i>0?i+.05*(i-o):i-.05*(i-o))%n&&(s+=n),s%n>0&&(s=s+n-s%n),e.doubleRange=new qe(a,s),0===a&&(n=this.calculateNumericNiceInterval(e,e.doubleRange.delta,r),s=Math.ceil(s/n)*n),this.updateActualRange(e,a,s,n)}},{key:"calculateVisibleRange",value:function(e,t){if(t.visibleRange={max:t.actualRange.max,min:t.actualRange.min,delta:t.actualRange.delta,interval:t.actualRange.interval},"Cartesian"===this.chart.chartAreaType){var i=!Object(f.Z)(t.zoomingScrollBar)&&t.zoomingScrollBar.isLazyLoad;(t.zoomFactor<1||t.zoomPosition>0)&&!i&&(t.calculateVisibleRangeOnZooming(this.chart),t.calculateAxisRange(e,this.chart),t.visibleRange.interval=t.enableAutoIntervalOnZooming&&"Category"!==t.valueType?this.calculateNumericNiceInterval(t,t.doubleRange.delta,e):t.visibleRange.interval)}t.triggerRangeRender(this.chart,t.visibleRange.min,t.visibleRange.max,t.visibleRange.interval)}},{key:"calculateVisibleLabels",value:function(e,t){e.visibleLabels=[];var i,n=e.visibleRange.min;("chart"!==t.getModuleName()||"PolarRadar"!==t.chartAreaType)&&(e.zoomFactor<1||e.zoomPosition>0||this.paddingInterval)&&(n=e.visibleRange.min-e.visibleRange.min%e.visibleRange.interval);var r,a=this.getFormat(e),s=null!==a.match("{value}"),o=0,l=0;for(e.labelFormat&&e.labelFormat.indexOf("n")>-1&&(l=parseInt(e.labelFormat.substring(1,e.labelFormat.length),10)),e.format=t.intl.getNumberFormat({format:s?"":a,useGrouping:t.useGroupingSeparator}),e.startLabel=e.format(e.visibleRange.min),e.endLabel=e.format(e.visibleRange.max),e.visibleRange.interval&&(e.visibleRange.interval+"").indexOf(".")>=0&&(o=(e.visibleRange.interval+"").split(".")[1].length);n<=e.visibleRange.max&&r!==n;n+=e.visibleRange.interval)r=n,i=Object(f.L)({},Object(f.X)("properties",e.labelStyle),null,!0),bt(n,e.visibleRange)&&_t(t,n,this.formatValue(e,s,a,n),i,e);n&&(n+"").indexOf(".")>=0&&(n+"").split(".")[1].length>10&&((n=(n+"").split(".")[1].length>(l||o)?+n.toFixed(l||o):n)<=e.visibleRange.max&&_t(t,n,this.formatValue(e,s,a,n),i,e)),e.getMaxLabelWidth&&e.getMaxLabelWidth(this.chart)}},{key:"getFormat",value:function(e){return e.labelFormat?0===e.labelFormat.indexOf("p")&&-1===e.labelFormat.indexOf("{value}")&&e.isStack100?"{value}%":e.labelFormat:e.isStack100?"{value}%":""}},{key:"formatValue",value:function(e,t,i,n){return t?i.replace("{value}",e.format(n)):e.format(n)}}]),e}(),Ze=/~\d+~/g,Ge=/\^\d+\^/g,Ye=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Xe=(be=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)("0")],be.prototype,"x",void 0),Ye([Object(f.t)("0")],be.prototype,"y",void 0),Ye([Object(f.t)(null)],be.prototype,"content",void 0),Ye([Object(f.t)("Center")],be.prototype,"horizontalAlignment",void 0),Ye([Object(f.t)("Pixel")],be.prototype,"coordinateUnits",void 0),Ye([Object(f.t)("Chart")],be.prototype,"region",void 0),Ye([Object(f.t)("Middle")],be.prototype,"verticalAlignment",void 0),Ye([Object(f.t)(null)],be.prototype,"xAxisName",void 0),Ye([Object(f.t)(null)],be.prototype,"yAxisName",void 0),Ye([Object(f.t)(null)],be.prototype,"description",void 0),be),Ke=(ye=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)("")],ye.prototype,"color",void 0),Ye([Object(f.t)(1)],ye.prototype,"width",void 0),Ye([Object(f.t)("Rectangle")],ye.prototype,"type",void 0),ye),Je=(ve=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)(null)],ve.prototype,"start",void 0),Ye([Object(f.t)(null)],ve.prototype,"end",void 0),Ye([Object(f.t)("")],ve.prototype,"text",void 0),Ye([Object(f.t)(null)],ve.prototype,"maximumTextWidth",void 0),Ye([Object(f.t)(null)],ve.prototype,"customAttributes",void 0),Ye([Object(f.t)("")],ve.prototype,"type",void 0),ve),Qe=(me=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)(!0)],me.prototype,"visible",void 0),Ye([Object(f.t)(!1)],me.prototype,"startFromAxis",void 0),Ye([Object(f.t)(null)],me.prototype,"start",void 0),Ye([Object(f.t)(null)],me.prototype,"end",void 0),Ye([Object(f.t)(null)],me.prototype,"size",void 0),Ye([Object(f.t)("#808080")],me.prototype,"color",void 0),Ye([Object(f.t)(null)],me.prototype,"dashArray",void 0),Ye([Object(f.t)("Auto")],me.prototype,"sizeType",void 0),Ye([Object(f.t)(!1)],me.prototype,"isRepeat",void 0),Ye([Object(f.t)(null)],me.prototype,"repeatEvery",void 0),Ye([Object(f.t)(null)],me.prototype,"repeatUntil",void 0),Ye([Object(f.t)(!1)],me.prototype,"isSegmented",void 0),Ye([Object(f.t)(null)],me.prototype,"segmentStart",void 0),Ye([Object(f.t)(null)],me.prototype,"segmentEnd",void 0),Ye([Object(f.t)(null)],me.prototype,"segmentAxisName",void 0),Ye([Object(f.g)({color:"transparent",width:1},je)],me.prototype,"border",void 0),Ye([Object(f.t)("")],me.prototype,"text",void 0),Ye([Object(f.t)(null)],me.prototype,"rotation",void 0),Ye([Object(f.t)("Middle")],me.prototype,"horizontalAlignment",void 0),Ye([Object(f.t)("Middle")],me.prototype,"verticalAlignment",void 0),Ye([Object(f.g)(V.stripLineLabelFont,Te)],me.prototype,"textStyle",void 0),Ye([Object(f.t)("Behind")],me.prototype,"zIndex",void 0),Ye([Object(f.t)(1)],me.prototype,"opacity",void 0),me),$e=(fe=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)("Center")],fe.prototype,"alignment",void 0),Ye([Object(f.t)("Wrap")],fe.prototype,"overflow",void 0),Ye([Object(f.g)(V.axisLabelFont,Te)],fe.prototype,"textStyle",void 0),Ye([Object(f.g)({color:null,width:1,type:"Rectangle"},Ke)],fe.prototype,"border",void 0),Ye([Object(f.f)([],Je)],fe.prototype,"categories",void 0),fe),et=(ge=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)(null)],ge.prototype,"minimum",void 0),Ye([Object(f.t)(null)],ge.prototype,"maximum",void 0),ge),tt=(pe=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ye([Object(f.t)(!1)],pe.prototype,"enable",void 0),Ye([Object(f.t)(null)],pe.prototype,"pointsLength",void 0),Ye([Object(f.g)({},et)],pe.prototype,"range",void 0),pe),it=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},nt=(Ae=function(e){l(i,e);var t=c(i);function i(){var e;return a(this,i),(e=t.apply(this,arguments)).axes=[],e.nearSizes=[],e.farSizes=[],e}return o(i,[{key:"computeSize",value:function(e,t){var i=0;e.visible&&e.internalVisibility&&(i+=e.findTickSize(e.crossInAxis)+t+e.findLabelSize(e.crossInAxis,5)+.5*e.lineStyle.width),e.opposedPosition?this.farSizes.push(i):this.nearSizes.push(i)}}]),i}(f.e),it([Object(f.t)("100%")],Ae.prototype,"height",void 0),it([Object(f.g)({},je)],Ae.prototype,"border",void 0),Ae),rt=(Re=function(e){l(i,e);var t=c(i);function i(){var e;return a(this,i),(e=t.apply(this,arguments)).axes=[],e.nearSizes=[],e.farSizes=[],e.padding=0,e}return o(i,[{key:"computeSize",value:function(e,t){var i=0;e.visible&&e.internalVisibility&&(i+=e.findTickSize(e.crossInAxis)+t+e.findLabelSize(e.crossInAxis,5)+.5*e.lineStyle.width),e.opposedPosition?this.farSizes.push(i):this.nearSizes.push(i)}}]),i}(f.e),it([Object(f.t)("100%")],Re.prototype,"width",void 0),it([Object(f.g)({},je)],Re.prototype,"border",void 0),Re),at=(Oe=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(1)],Oe.prototype,"width",void 0),it([Object(f.t)("")],Oe.prototype,"dashArray",void 0),it([Object(f.t)(null)],Oe.prototype,"color",void 0),Oe),st=(Ie=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(.7)],Ie.prototype,"width",void 0),it([Object(f.t)("")],Ie.prototype,"dashArray",void 0),it([Object(f.t)(null)],Ie.prototype,"color",void 0),Ie),ot=(ke=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(1)],ke.prototype,"width",void 0),it([Object(f.t)("")],ke.prototype,"dashArray",void 0),it([Object(f.t)(null)],ke.prototype,"color",void 0),ke),lt=(we=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(1)],we.prototype,"width",void 0),it([Object(f.t)(5)],we.prototype,"height",void 0),it([Object(f.t)(null)],we.prototype,"color",void 0),we),ht=(Se=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(.7)],Se.prototype,"width",void 0),it([Object(f.t)(5)],Se.prototype,"height",void 0),it([Object(f.t)(null)],Se.prototype,"color",void 0),Se),ct=(xe=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),it([Object(f.t)(!1)],xe.prototype,"enable",void 0),it([Object(f.t)(null)],xe.prototype,"fill",void 0),it([Object(f.g)(V.crosshairLabelFont,Te)],xe.prototype,"textStyle",void 0),xe),dt=(Ce=function(e){l(n,e);var i=c(n);function n(e,t,r,s){var o;return a(this,n),(o=i.call(this,e,t,r,s)).visibleLabels=[],o.series=[],o.rect=new L(void 0,void 0,0,0),o.axisBottomLine=null,o.intervalDivs=[10,5,2,1],o.isStack100=!1,o.crossAt=null,o.updatedRect=null,o.multiLevelLabelHeight=0,o.isChart=!0,o.isIntervalInDecimal=!0,o.titleCollection=[],o.titleSize=new E(0,0),o.internalVisibility=!0,o.angle=o.labelRotation,o}return o(n,[{key:"findTickSize",value:function(e){return"Inside"===this.tickPosition?0:!e||e.visibleRange&&!this.isInside(e.visibleRange)?this.majorTickLines.height:0}},{key:"isInside",value:function(e){return yt(this.crossAt,e)||!this.opposedPosition&&this.crossAt>=e.max||this.opposedPosition&&this.crossAt<=e.min}},{key:"findLabelSize",value:function(e,t){var i=0,n="Horizontal"===this.orientation;if(this.title&&(this.titleSize=R(this.title,this.titleStyle),i=this.titleSize.height+t,this.rect.width||this.rect.height)&&(this.titleCollection=mi(this.title,this.titleStyle,n?this.rect.width:this.rect.height),i*=this.titleCollection.length),"Inside"===this.labelPosition)return i+t;var r,a,s=i+t+this.titlePadding+this.labelPadding+("Vertical"===this.orientation?this.maxLabelSize.width:this.maxLabelSize.height)+this.multiLevelLabelHeight;if(e&&this.placeNextToAxisLine){var o=e.visibleRange,l="Horizontal"===e.orientation?e.rect.width:e.rect.height;if(!o||!l)return 0;this.isInside(o)&&(s=(r=(a=this.findDifference(e))*((l-((r=a*(l/o.delta))<s?s-r:0))/o.delta))<s?s-r:0)}return s}},{key:"updateCrossValue",value:function(){var e=this.crossAt;if(null===e||!this.isInside(this.crossInAxis.visibleRange))return this.updatedRect=this.rect,null;var t=this.crossInAxis.visibleRange;this.opposedPosition?this.crossAt<t.min&&(e=t.min):this.crossAt>t.max&&(e=t.max),this.updatedRect=Object(f.L)({},this.rect,null,!0),"Horizontal"===this.orientation?(e=this.crossInAxis.rect.height-Et(e,this.crossInAxis)*this.crossInAxis.rect.height,this.updatedRect.y=this.crossInAxis.rect.y+e):(e=Et(e,this.crossInAxis)*this.crossInAxis.rect.width,this.updatedRect.x=this.crossInAxis.rect.x+e)}},{key:"findDifference",value:function(e){var t;return t=this.opposedPosition?e.isInversed?e.visibleRange.min:e.visibleRange.max:e.isInversed?e.visibleRange.max:e.visibleRange.min,Math.abs(this.crossAt-t)}},{key:"calculateVisibleRangeOnZooming",value:function(e){if(Vt(this)){var t,i,n=this.actualRange;i=!this.isInversed||e.zoomModule?(t=this.actualRange.min+this.zoomPosition*this.actualRange.delta)+this.zoomFactor*this.actualRange.delta:(t=this.actualRange.max-this.zoomPosition*this.actualRange.delta)-this.zoomFactor*this.actualRange.delta,t<n.min&&(i+=n.min-t,t=n.min),i>n.max&&(t-=i-n.max,i=n.max),this.doubleRange=new qe(t,i),this.visibleRange={min:this.doubleRange.start,max:this.doubleRange.end,delta:this.doubleRange.delta,interval:this.visibleRange.interval}}}},{key:"calculateAxisRange",value:function(e,i){if(i.enableAutoIntervalOnBothAxis){if("Horizontal"===this.orientation&&"X"===i.zoomSettings.mode)for(var n=0;n<this.series.length;n++){var r,a=[],s=t(this.series[n].visiblePoints);try{for(s.s();!(r=s.n()).done;){var o=r.value;o.xValue>this.visibleRange.min&&o.xValue<this.visibleRange.max&&a.push(o.yValue)}}catch(C){s.e(C)}finally{s.f()}var l,h=t(i.axisCollections);try{for(h.s();!(l=h.n()).done;){var c=l.value;"Vertical"!==c.orientation||Object(f.Z)(c.series[n])||(c.series[n].yMin=Math.min.apply(Math,a),c.series[n].yMax=Math.max.apply(Math,a),c.baseModule.calculateRangeAndInterval(e,c))}}catch(C){h.e(C)}finally{h.f()}}if("Vertical"===this.orientation&&"Y"===i.zoomSettings.mode)for(var d=0;d<this.series.length;d++){var u,p=[],g=t(this.series[d].visiblePoints);try{for(g.s();!(u=g.n()).done;){var m=u.value;m.yValue>this.visibleRange.min&&m.yValue<this.visibleRange.max&&p.push(m.xValue)}}catch(C){g.e(C)}finally{g.f()}var v,y=t(i.axisCollections);try{for(y.s();!(v=y.n()).done;){var b=v.value;"Horizontal"!==b.orientation||Object(f.Z)(b.series[d])||(b.series[d].xMin=Math.min.apply(Math,p),b.series[d].xMax=Math.max.apply(Math,p),b.baseModule.calculateRangeAndInterval(e,b))}}catch(C){y.e(C)}finally{y.f()}}}}},{key:"triggerRangeRender",value:function(e,t,i,n){var r={cancel:!1,name:"axisRangeCalculated",axis:this,minimum:t,maximum:i,interval:n};e.trigger("axisRangeCalculated",r),r.cancel||(this.visibleRange={min:r.minimum,max:r.maximum,interval:r.interval,delta:r.maximum-r.minimum})}},{key:"getRangePadding",value:function(e){var t=this.rangePadding;if("Auto"!==t)return t;switch(this.orientation){case"Horizontal":t=e.requireInvertedAxis?this.isStack100||this.baseModule.chart.stockChart?"Round":"Normal":"None";break;case"Vertical":t=e.requireInvertedAxis?"None":this.isStack100||this.baseModule.chart.stockChart?"Round":"Normal"}return t}},{key:"getMaxLabelWidth",value:function(e){var t,i,n=0,r=!1;this.angle=this.labelRotation,this.maxLabelSize=new E(0,0);for(var a,s=this.labelIntersectAction,o=0,l=this.visibleLabels.length;o<l;o++){(i=pt((a=this.visibleLabels[o]).originalText))?(a.size=R(a.originalText.replace(/<br>/g," "),this.labelStyle),a.breakLabelSize=R(this.enableTrim?a.text.join("<br>"):a.originalText,this.labelStyle)):a.size=R(a.text,this.labelStyle);var h=i?a.breakLabelSize.width:a.size.width;h>this.maxLabelSize.width&&(this.maxLabelSize.width=h,this.rotatedLabel=a.text);var c=i?a.breakLabelSize.height:a.size.height;if(c>this.maxLabelSize.height&&(this.maxLabelSize.height=c),i&&(a.text=this.enableTrim?a.text:a.originalText.split("<br>")),"None"!==s&&"Hide"!==s&&"Trim"!==s&&("None"!==s||this.angle%360==0)&&"Horizontal"===this.orientation&&this.rect.width>0&&!r){var d=i?a.breakLabelSize.width:a.size.width;switch(t=Et(a.value,this)*this.rect.width+this.rect.x,t-=d/2,"Shift"===this.edgeLabelPlacement&&(0===o&&t<this.rect.x&&(t=this.rect.x),o===this.visibleLabels.length-1&&t+d>this.rect.x+this.rect.width&&(t=this.rect.x+this.rect.width-d)),s){case"MultipleRows":o>0&&this.findMultiRows(o,t,a,i);break;case"Rotate45":case"Rotate90":o>0&&(this.isInversed?t+d>=n:t<=n)&&(this.angle="Rotate45"===s?45:90,r=!0);break;default:if(i){for(var u=void 0,p=[],g=void 0,m=0;m<a.text.length;m++)if((u=yi(a.text[m],this.rect.width/this.visibleLabels.length,this.labelStyle)).length>1)for(var v=0;v<u.length;v++)g=u[v],p.push(g);else p.push(u[0]);a.text=p}else a.text=yi(a.text,this.rect.width/this.visibleLabels.length,this.labelStyle);var y=a.size.height*a.text.length;y>this.maxLabelSize.height&&(this.maxLabelSize.height=y)}n=this.isInversed?t:t+d}}if(0!==this.angle&&"Horizontal"===this.orientation){this.rotatedLabel=Object(f.Z)(this.rotatedLabel)?"":this.rotatedLabel;var b=-360===this.angle||0===this.angle||-180===this.angle||180===this.angle||360===this.angle;this.maxLabelSize="Outside"===this.labelPosition&&!b&&pt(this.rotatedLabel)?new E(this.maxLabelSize.height,this.maxLabelSize.width):function(e,t,i,n){var r,a,s,o,l,h=new I(n.element.id),c=[],d={id:"rotate_text",x:n.initialClipRect.x,y:n.initialClipRect.y,"font-size":e.size,"font-style":e.fontStyle,"font-family":e.fontFamily,"font-weight":e.fontWeight,transform:"rotate("+i+", 0, 0)","text-anchor":"middle"};r=pt(t)?(c=t.split("<br>"))[0]:t;var u=h.createText(d,r);if(n.delayRedraw||n.redraw||n.element.appendChild(n.svgObject),"string"!=typeof c&&c.length>1)for(var p=1,g=c.length;p<g;p++)a=R(c[p],e).height,s=d.y+p*a,o=c[p],l=h.createTSpan({x:d.x,id:d.id,y:s},o),u.appendChild(l);n.svgObject.appendChild(u);var m=u.getBoundingClientRect();return Object(f.kb)(u),n.delayRedraw||n.redraw||Object(f.kb)(n.svgObject),new E(m.right-m.left,m.bottom-m.top)}(this.labelStyle,this.rotatedLabel,this.angle,e)}e.multiLevelLabelModule&&this.multiLevelLabels.length>0&&e.multiLevelLabelModule.getMultilevelLabelsHeight(this)}},{key:"findMultiRows",value:function(e,t,i,n){for(var r,a,s,o=[],l=e-1;l>=0;l--)r=this.visibleLabels[l],s=n?r.breakLabelSize.width:r.size.width,a=Et(r.value,this)*this.rect.width+this.rect.x,(this.isInversed?t+i.size.width>a-.5*s:t<a+.5*s)?(o.push(r.index),i.index=i.index>r.index?i.index:r.index+1):i.index=o.indexOf(r.index)>-1?i.index:r.index;var h=(n?i.breakLabelSize.height:i.size.height)*i.index+5*(i.index-1);h>this.maxLabelSize.height&&(this.maxLabelSize.height=h)}},{key:"getModule",value:function(e){this.baseModule="Double"===this.valueType?new We(e):e[Dt(this.valueType)+"Module"]}}]),n}(f.e),it([Object(f.g)(V.axisLabelFont,Te)],Ce.prototype,"labelStyle",void 0),it([Object(f.g)({},ct)],Ce.prototype,"crosshairTooltip",void 0),it([Object(f.t)("")],Ce.prototype,"title",void 0),it([Object(f.g)(V.axisTitleFont,Te)],Ce.prototype,"titleStyle",void 0),it([Object(f.t)("")],Ce.prototype,"labelFormat",void 0),it([Object(f.t)("")],Ce.prototype,"skeleton",void 0),it([Object(f.t)("DateTime")],Ce.prototype,"skeletonType",void 0),it([Object(f.t)("Center")],Ce.prototype,"lineBreakAlignment",void 0),it([Object(f.t)(0)],Ce.prototype,"plotOffset",void 0),it([Object(f.t)(null)],Ce.prototype,"plotOffsetLeft",void 0),it([Object(f.t)(null)],Ce.prototype,"plotOffsetTop",void 0),it([Object(f.t)(null)],Ce.prototype,"plotOffsetRight",void 0),it([Object(f.t)(null)],Ce.prototype,"plotOffsetBottom",void 0),it([Object(f.t)(!1)],Ce.prototype,"isIndexed",void 0),it([Object(f.t)(10)],Ce.prototype,"logBase",void 0),it([Object(f.t)(0)],Ce.prototype,"columnIndex",void 0),it([Object(f.t)(0)],Ce.prototype,"rowIndex",void 0),it([Object(f.t)(1)],Ce.prototype,"span",void 0),it([Object(f.t)(null)],Ce.prototype,"desiredIntervals",void 0),it([Object(f.t)(3)],Ce.prototype,"maximumLabels",void 0),it([Object(f.t)(1)],Ce.prototype,"zoomFactor",void 0),it([Object(f.t)(0)],Ce.prototype,"zoomPosition",void 0),it([Object(f.t)(!0)],Ce.prototype,"enableScrollbarOnZooming",void 0),it([Object(f.t)(!1)],Ce.prototype,"opposedPosition",void 0),it([Object(f.t)(!0)],Ce.prototype,"enableAutoIntervalOnZooming",void 0),it([Object(f.t)("Auto")],Ce.prototype,"rangePadding",void 0),it([Object(f.t)("Double")],Ce.prototype,"valueType",void 0),it([Object(f.t)("None")],Ce.prototype,"edgeLabelPlacement",void 0),it([Object(f.t)("Auto")],Ce.prototype,"intervalType",void 0),it([Object(f.t)("BetweenTicks")],Ce.prototype,"labelPlacement",void 0),it([Object(f.t)("Outside")],Ce.prototype,"tickPosition",void 0),it([Object(f.t)("Outside")],Ce.prototype,"labelPosition",void 0),it([Object(f.t)("")],Ce.prototype,"name",void 0),it([Object(f.t)(!0)],Ce.prototype,"visible",void 0),it([Object(f.t)(0)],Ce.prototype,"minorTicksPerInterval",void 0),it([Object(f.t)(0)],Ce.prototype,"labelRotation",void 0),it([Object(f.t)(null)],Ce.prototype,"crossesAt",void 0),it([Object(f.t)(!0)],Ce.prototype,"placeNextToAxisLine",void 0),it([Object(f.t)(null)],Ce.prototype,"crossesInAxis",void 0),it([Object(f.t)(null)],Ce.prototype,"minimum",void 0),it([Object(f.t)(null)],Ce.prototype,"maximum",void 0),it([Object(f.t)(null)],Ce.prototype,"interval",void 0),it([Object(f.t)(34)],Ce.prototype,"maximumLabelWidth",void 0),it([Object(f.t)(!1)],Ce.prototype,"enableTrim",void 0),it([Object(f.t)(5)],Ce.prototype,"labelPadding",void 0),it([Object(f.t)(5)],Ce.prototype,"titlePadding",void 0),it([Object(f.g)({},lt)],Ce.prototype,"majorTickLines",void 0),it([Object(f.g)({},ht)],Ce.prototype,"minorTickLines",void 0),it([Object(f.g)({},at)],Ce.prototype,"majorGridLines",void 0),it([Object(f.g)({},st)],Ce.prototype,"minorGridLines",void 0),it([Object(f.g)({},ot)],Ce.prototype,"lineStyle",void 0),it([Object(f.t)("Trim")],Ce.prototype,"labelIntersectAction",void 0),it([Object(f.t)(!1)],Ce.prototype,"isInversed",void 0),it([Object(f.t)(100)],Ce.prototype,"coefficient",void 0),it([Object(f.t)(0)],Ce.prototype,"startAngle",void 0),it([Object(f.t)(!0)],Ce.prototype,"startFromZero",void 0),it([Object(f.t)(null)],Ce.prototype,"description",void 0),it([Object(f.t)(2)],Ce.prototype,"tabIndex",void 0),it([Object(f.f)([],Qe)],Ce.prototype,"stripLines",void 0),it([Object(f.f)([],$e)],Ce.prototype,"multiLevelLabels",void 0),it([Object(f.g)({color:null,width:0,type:"Rectangle"},Ke)],Ce.prototype,"border",void 0),it([Object(f.g)({},tt)],Ce.prototype,"scrollbarSettings",void 0),Ce),ut=function e(t,i,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new E(0,0),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new E(0,0),l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;a(this,e),this.text=t,this.originalText=r,this.value=i,this.labelStyle=n,this.size=s,this.breakLabelSize=o,this.index=l};function pt(e){return-1!==e.indexOf("<br>")}function gt(e){for(var t,i=Object(f.L)([],e.points,null,!0),n=[],r=0,a=0;a<i.length;a++)t=i[a],Object(f.Z)(t.x)||""===t.x||(t.index=r++,n.push(t));return n}function ft(e){if(!e)return null;var t="string"==typeof e?Zt(e):e;t&&Object(f.kb)(t)}function mt(e,t){return Math.log(e)/Math.log(t)}function vt(e,t,i,n,r,a,s,o){var l=document.getElementById(r),h=R(e,{fontFamily:"Segoe UI",size:"12px",fontStyle:"Normal",fontWeight:"Regular"}),c=h.width+5;t=t+c>n?t-(c+15):t,i=o?i-h.height/2:i+15,l?(l.innerHTML=e,l.style.top=i.toString()+"px",l.style.left=(t+15).toString()+"px"):(l=Object(f.G)("div",{innerHTML:e,id:r,styles:"top:"+i.toString()+"px;left:"+(t+15).toString()+'px;background-color: rgb(255, 255, 255) !important; color:black !important; position:absolute;border:1px solid rgb(112, 112, 112); padding-left : 3px; padding-right : 2px;padding-bottom : 2px; padding-top : 2px; font-size:12px; font-family: "Segoe UI"'}),a.appendChild(l),parseInt(l.style.left.replace("px",""),10)<0&&(l.style.left="0px")),s&&setTimeout(function(){ft(r)},1500)}function yt(e,t){return e<t.max&&e>t.min}function bt(e,t){return e<=t.max&&e>=t.min}function Ct(e,t){return"Logarithmic"===t.valueType?mt(e,t.logBase):e}function xt(e,t,i,n){var r=Ct(t.xValue,n.xAxis),a=e?Ct(e.xValue,n.xAxis):r,s=i?Ct(i.xValue,n.xAxis):r,o=Math.floor(n.xAxis.visibleRange.min),l=Math.ceil(n.xAxis.visibleRange.max);return a>=o&&a<=l||r>=o&&r<=l||s>=o&&s<=l||o>=a&&o<=s}function St(e){var i,n=0,r=t(e);try{for(r.s();!(i=r.n()).done;){n+=i.value}}catch(a){r.e(a)}finally{r.f()}return n}function wt(e,t){return e.x+=t.left,e.y+=t.top,e.width-=t.left+t.right,e.height-=t.top+t.bottom,e}function kt(e,t,i){var n=e*Math.PI/180;return new Ii(Math.cos(n)*t+i.x,Math.sin(n)*t+i.y)}function It(e){return e*(Math.PI/180)}function Ot(e,t,i,n){for(var r=[],a=0;a<4;a++){var s=e[a],o=s.x-t,l=s.y-i,h=o*Math.cos(It(n))-l*Math.sin(It(n)),c=o*Math.sin(It(n))+l*Math.cos(It(n));s.x=h+t,s.y=c+i,r.push(new Ii(s.x,s.y))}return r}function Rt(e,t){var i,n,r,a,s,o,l,h,c=[e,t];for(a=0;a<c.length;a++){var d=c[a];for(s=0;s<d.length;s++){var u=d[s],p=d[(s+1)%d.length],g=new Ii(p.y-u.y,u.x-p.x);for(i=n=void 0,o=0;o<e.length;o++)r=g.x*e[o].x+g.y*e[o].y,(Object(f.Z)(i)||r<i)&&(i=r),(Object(f.Z)(n)||r>n)&&(n=r);for(l=h=void 0,o=0;o<t.length;o++)r=g.x*t[o].x+g.y*t[o].y,(Object(f.Z)(l)||r<l)&&(l=r),(Object(f.Z)(h)||r>h)&&(h=r);if(n<l||h<i)return!1}}return!0}function At(e,t){for(var i=[],n=0;n<=t-1;n++)i.push(e[n]);return i}function Et(e,t){var i=t.visibleRange,n=(e-i.min)/i.delta;return t.isInversed?1-n:n}function Lt(e,t,i,n,r,a){e="Logarithmic"===i.valueType?mt(e>1?e:1,i.logBase):e,t="Logarithmic"===n.valueType?mt(t>1?t:1,n.logBase):t,e+="Category"===i.valueType&&"BetweenTicks"===i.labelPlacement&&"Radar"!==a.type?.5:0;var s,o,l,h,c,d=a.chart.radius*Et(t,n),u=function(e,t){t=t<0?t+360:t;var i=Math.PI*(1.5-2*e);return i+=t*Math.PI/180,{x:Math.cos(i),y:Math.sin(i)}}((s=e,c=(o=i).visibleRange,"Category"!==o.valueType?(l=c.max-("DateTime"===o.valueType?o.dateTimeInterval:c.interval)-c.min,h=o.visibleLabels.length-1,l=0===l?1:l):(l=1===o.visibleLabels.length?1:o.visibleLabels[o.visibleLabels.length-1].value-o.visibleLabels[0].value,h=o.visibleLabels.length),o.isInversed?(s-c.min)/l*(1-1/h):1-(s-c.min)/l*(1-1/h)),a.chart.primaryXAxis.startAngle);return{x:a.clipRect.width/2+a.clipRect.x+d*u.x,y:a.clipRect.height/2+a.clipRect.y+d*u.y}}function Tt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=["NaN","NaN"];return e.indexOf("_Point_")>-1?i=e.split("_Series_")[1].split("_Point_"):e.indexOf("_shape_")>-1&&(!t||t&&-1===e.indexOf("_legend_"))?(i=e.split("_shape_"))[0]="0":e.indexOf("_text_")>-1&&(!t||t&&-1===e.indexOf("_legend_"))&&((i=e.split("_text_"))[0]="0"),new _e(parseInt(i[0],10),parseInt(i[1],10))}function jt(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return e>=i.x-n&&e<=i.x+i.width+n&&t>=i.y-r&&t<=i.y+i.height+r}function Dt(e){return e.substr(0,1).toLowerCase()+e.substr(1)}function Mt(e,t){for(var i,n,r,a=Number.MAX_VALUE,s=0;s<t.length;s++){var o=t[s];if(i=[],o.visible&&(e.name===o.xAxisName||"primaryXAxis"===e.name&&null===o.xAxisName||e.name===o.chart.primaryXAxis.name&&!o.xAxisName))if((i=o.points.map(function(e){return e.xValue})).sort(function(e,t){return e-t}),1===i.length)r="DateTime"===e.valueType&&o.xMin===o.xMax?o.xMin-2592e6:o.xMin,0!==(n=i[0]-(Object(f.Z)(r)?e.visibleRange.min:r))&&(a=Math.min(a,n));else for(var l=0;l<i.length;l++){var h=i[l];l>0&&h&&(0!==(n=h-i[l-1])&&(a=Math.min(a,n)))}}return a===Number.MAX_VALUE&&(a=1),a}function Ft(e){var t;switch(e){case"Linear":t=Pt}return t}function Pt(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}function Nt(e,t,i,n,r,a,s){var o=a.x,l=a.y,h=0;e.style.visibility="hidden",new f.b({}).animate(e,{duration:i,delay:t,progress:function(t){t.timeStamp>t.delay&&(t.element.style.visibility="visible",h=(t.timeStamp-t.delay)/t.duration,e.setAttribute("transform","translate("+o+" "+l+") scale("+h+") translate("+-o+" "+-l+")"))},end:function(){e.style.visibility="","Scatter"!==n.type&&"Bubble"!==n.type||s||r!==n.points.length-1||n.chart.trigger("animationComplete",{series:n.chart.isBlazor?{}:n})}})}function Bt(e,t,i,n,r){if(!i||!n&&!e)return null;var a=300;r&&(a=r);var s,o,l,h=n||e.getAttribute("d"),c=h.split(/(?=[LMCZAQ])/),d=t.split(/(?=[LMCZAQ])/),u=[],p=[];e.setAttribute("d",h),new f.b({}).animate(Object(f.G)("div"),{duration:a,progress:function(t){s="",c.map(function(e,i){if(u=e.split(" "),p=d[i]?d[i].split(" "):u,s+="Z"===u[0]?"Z ":u[0]+" "+Pt(t.timeStamp,+u[1],+p[1]-+u[1],t.duration)+" "+Pt(t.timeStamp,+u[2],+p[2]-+u[2],t.duration)+" ","C"===u[0]||"Q"===u[0])for(o=3,l="Q"===u[0]?4:6;o<l;)s+=Pt(t.timeStamp,+u[o],+p[o]-+u[o],t.duration)+" "+Pt(t.timeStamp,+u[++o],+p[o]-+u[o],t.duration)+" ",++o;"A"===u[0]&&(s+="0 0 1 "+Pt(t.timeStamp,+u[6],+p[6]-+u[6],t.duration)+" "+Pt(t.timeStamp,+u[7],+p[7]-+u[7],t.duration)+" ")}),e.setAttribute("d",s)},end:function(){e.setAttribute("d",t)}})}function Ht(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"drawClipPath",r=ui(e,t.id,t,i);if(r){var a=i.createDefs();return a.appendChild(r),a}return i[n](t)}function _t(e,t,i,n,r){var a={cancel:!1,name:"axisLabelRender",axis:r,text:i,value:t,labelStyle:n};if(e.trigger("axisLabelRender",a),!a.cancel){var s=-1!==a.text.indexOf("<br>"),o=r.enableTrim?s?function(e,t,i){for(var n=[],r=t.split("<br>"),a=0;a<r.length;a++){var s=R(t=r[a],i).width;if(s>e){for(var o=t.length-1;o>=0;--o)if((s=R(t=t.substring(0,o)+"...",i).width)<=e){n.push(t);break}}else n.push(t)}return n}(r.maximumLabelWidth,a.text,r.labelStyle):ci(r.maximumLabelWidth,a.text,r.labelStyle):a.text;r.visibleLabels.push(new ut(o,a.value,a.labelStyle,a.text))}}function zt(e){return null!=e.minimum&&null!=e.maximum}function Vt(e){return e.zoomFactor<1&&e.zoomPosition>=0}function Ut(e,t){var i="Horizontal"===t.orientation?e.width:e.height;if(Object(f.Z)(t.desiredIntervals)){var n=("Horizontal"===t.orientation?.533:1)*t.maximumLabels;return n=Math.max(i*(n/100),1)}return t.desiredIntervals}function qt(e,t,i,n,r){new f.b({}).animate(e,{duration:i,delay:t,name:n,progress:function(e){e.element.style.visibility="visible"},end:function(e){r?Object(f.kb)(e.element):e.element.style.visibility="visible"}})}function Wt(e,t,i,n,r,a,s,o,l,h){var c=s||new I(""),d=function(e,t,i,n,r,a,s){var o,l,h,c="Path",d=a&&"Circle"===i?t.width-2:t.width,u=a&&"Circle"===i?t.height-2:t.height,p=a?s.targetWidth:0,g=e.x,m=e.y,v=e.y+-u/2,y=e.x+-d/2;switch(i){case"Bubble":case"Circle":c="Ellipse",Object(f.gb)(n,{rx:d/2,ry:u/2,cx:g,cy:m});break;case"Cross":o="M "+y+" "+m+" L "+(g+d/2)+" "+m+" M "+g+" "+(m+u/2)+" L "+g+" "+(m+-u/2),Object(f.gb)(n,{d:o,stroke:n.fill});break;case"Multiply":o="M "+(g-p)+" "+(m-p)+" L "+(g+p)+" "+(m+p)+" M "+(g-p)+" "+(m+p)+" L "+(g+p)+" "+(m-p),Object(f.gb)(n,{d:o,stroke:n.fill});break;case"HorizontalLine":o="M "+y+" "+m+" L "+(g+d/2)+" "+m,Object(f.gb)(n,{d:o});break;case"VerticalLine":o="M "+g+" "+(m+u/2)+" L "+g+" "+(m+-u/2),Object(f.gb)(n,{d:o});break;case"Diamond":o="M "+y+" "+m+" L "+g+" "+(m+-u/2)+" L "+(g+d/2)+" "+m+" L "+g+" "+(m+u/2)+" L "+y+" "+m+" z",Object(f.gb)(n,{d:o});break;case"ActualRect":o="M "+y+" "+(m+-u/8)+" L "+(g+p)+" "+(m+-u/8)+" L "+(g+p)+" "+(m+u/8)+" L "+y+" "+(m+u/8)+" L "+y+" "+(m+-u/8)+" z",Object(f.gb)(n,{d:o});break;case"TargetRect":o="M "+(y+p)+" "+(m+-u/2)+" L "+(g+p/2)+" "+(m+-u/2)+" L "+(g+p/2)+" "+(m+u/2)+" L "+(y+p)+" "+(m+u/2)+" L "+(y+p)+" "+(m+-u/2)+" z",Object(f.gb)(n,{d:o});break;case"Rectangle":case"Hilo":case"HiloOpenClose":case"Candle":case"Waterfall":case"BoxAndWhisker":case"StepArea":case"StackingStepArea":case"Square":case"Flag":o="M "+y+" "+(m+-u/2)+" L "+(g+d/2)+" "+(m+-u/2)+" L "+(g+d/2)+" "+(m+u/2)+" L "+y+" "+(m+u/2)+" L "+y+" "+(m+-u/2)+" z",Object(f.gb)(n,{d:o});break;case"Pyramid":case"Triangle":o="M "+y+" "+(m+u/2)+" L "+g+" "+(m+-u/2)+" L "+(g+d/2)+" "+(m+u/2)+" L "+y+" "+(m+u/2)+" z",Object(f.gb)(n,{d:o});break;case"Funnel":case"InvertedTriangle":o="M "+(g+d/2)+" "+(m-u/2)+" L "+g+" "+(m+u/2)+" L "+(g-d/2)+" "+(m-u/2)+" L "+(g+d/2)+" "+(m-u/2)+" z",Object(f.gb)(n,{d:o});break;case"Pentagon":for(var b=0;b<=5;b++)l=d/2*Math.cos(Math.PI/180*(72*b)),h=u/2*Math.sin(Math.PI/180*(72*b)),o=0===b?"M "+(g+l)+" "+(m+h)+" ":o.concat("L "+(g+l)+" "+(m+h)+" ");o=o.concat("Z"),Object(f.gb)(n,{d:o});break;case"Image":c="Image",Object(f.gb)(n,{href:r,height:u,width:d,x:y,y:v})}return{renderOption:n=function(e,t,i,n){var r="",a=t.height,s=t.width,o=e.x,l=e.y;switch(i){case"MultiColoredLine":case"Line":case"StackingLine":case"StackingLine100":r="M "+(o+-s/2)+" "+l+" L "+(o+s/2)+" "+l,Object(f.gb)(n,{d:r});break;case"StepLine":n.fill="transparent",r="M "+(o+-s/2-2.5)+" "+(l+a/2)+" L "+(o+-s/2+s/10)+" "+(l+a/2)+" L "+(o+-s/2+s/10)+" "+l+" L "+(o+-s/10)+" "+l+" L "+(o+-s/10)+" "+(l+a/2)+" L "+(o+s/5)+" "+(l+a/2)+" L "+(o+s/5)+" "+(l+-a/2)+" L "+(o+s/2)+" "+(l+-a/2)+"L "+(o+s/2)+" "+(l+a/2)+" L"+(o+s/2+2.5)+" "+(l+a/2),Object(f.gb)(n,{d:r});break;case"UpArrow":n.fill=n.stroke,n.stroke="transparent",r="M "+(o+-s/2)+" "+(l+a/2)+" L "+o+" "+(l-a/2)+" L "+(o+s/2)+" "+(l+a/2)+"L "+(o+s/2-2)+" "+(l+a/2)+" L "+o+" "+(l-a/2+4)+"L"+(o-s/2+2)+" "+(l+a/2)+" Z",Object(f.gb)(n,{d:r});break;case"DownArrow":r="M "+(o-s/2)+" "+(l-a/2)+" L "+o+" "+(l+a/2)+" L "+(o+s/2)+" "+(l-a/2)+"L "+(o+s/2-2)+" "+(l-a/2)+" L "+o+" "+(l+a/2-4)+"L"+(o-s/2+2)+" "+(l-a/2)+" Z",Object(f.gb)(n,{d:r});break;case"RightArrow":r="M "+(o+-s/2)+" "+(l-a/2)+" L "+(o+s/2)+" "+l+" L "+(o+-s/2)+" "+(l+a/2)+" L "+(o+-s/2)+" "+(l+a/2-2)+" L "+(o+s/2-4)+" "+l+" L"+(o+-s/2)+" "+(l-a/2+2)+" Z",Object(f.gb)(n,{d:r});break;case"LeftArrow":n.fill=n.stroke,n.stroke="transparent",r="M "+(o+s/2)+" "+(l-a/2)+" L "+(o+-s/2)+" "+l+" L "+(o+s/2)+" "+(l+a/2)+" L "+(o+s/2)+" "+(l+a/2-2)+" L "+(o+-s/2+4)+" "+l+" L"+(o+s/2)+" "+(l-a/2+2)+" Z",Object(f.gb)(n,{d:r});break;case"Column":case"Pareto":case"StackingColumn":case"StackingColumn100":case"RangeColumn":case"Histogram":r="M "+(o-s/5*3)+" "+(l-a/5)+" L "+(o+-s/10*3)+" "+(l-a/5)+" L "+(o+-s/10*3)+" "+(l+a/2)+" L "+(o-s/5*3)+" "+(l+a/2)+" Z M "+(o+-s/10-s/20)+" "+(l-a/4-5)+" L "+(o+s/10+s/20)+" "+(l-a/4-5)+" L "+(o+s/10+s/20)+" "+(l+a/2)+" L "+(o+-s/10-s/20)+" "+(l+a/2)+" Z M "+(o+s/10*3)+" "+l+" L "+(o+s/5*3)+" "+l+" L "+(o+s/5*3)+" "+(l+a/2)+" L "+(o+s/10*3)+" "+(l+a/2)+" Z",Object(f.gb)(n,{d:r});break;case"Bar":case"StackingBar":case"StackingBar100":r="M "+(o+-s/2+-2.5)+" "+(l-a/5*3)+" L "+(o+s/10*3)+" "+(l-a/5*3)+" L "+(o+s/10*3)+" "+(l-a/10*3)+" L "+(o-s/2-2.5)+" "+(l-a/10*3)+" Z M "+(o+-s/2+-2.5)+" "+(l-a/5+.5)+" L "+(o+s/2+2.5)+" "+(l-a/5+.5)+" L "+(o+s/2+2.5)+" "+(l+a/10+.5)+" L "+(o-s/2-2.5)+" "+(l+a/10+.5)+" Z M "+(o-s/2-2.5)+" "+(l+a/5+1)+" L "+(o+-s/4)+" "+(l+a/5+1)+" L "+(o+-s/4)+" "+(l+a/2+1)+" L "+(o-s/2-2.5)+" "+(l+a/2+1)+" Z",Object(f.gb)(n,{d:r});break;case"Spline":n.fill="transparent",r="M "+(o-s/2)+" "+(l+a/5)+" Q "+o+" "+(l-a)+" "+o+" "+(l+a/5)+" M "+o+" "+(l+a/5)+" Q "+(o+s/2)+" "+(l+a/2)+" "+(o+s/2)+" "+(l-a/2),Object(f.gb)(n,{d:r});break;case"Area":case"MultiColoredArea":case"RangeArea":case"StackingArea":case"StackingArea100":r="M "+(o-s/2-2.5)+" "+(l+a/2)+" L "+(o+-s/4+-1.25)+" "+(l-a/2)+" L "+o+" "+(l+a/4)+" L "+(o+s/4+1.25)+" "+(l+-a/2+a/4)+" L "+(o+a/2+2.5)+" "+(l+a/2)+" Z",Object(f.gb)(n,{d:r});break;case"SplineArea":case"SplineRangeArea":r="M "+(o-s/2)+" "+(l+a/5)+" Q "+o+" "+(l-a)+" "+o+" "+(l+a/5)+" Z M "+o+" "+(l+a/5)+" Q "+(o+s/2)+" "+(l+a/2)+" "+(o+s/2)+" "+(l-a/2)+"  Z",Object(f.gb)(n,{d:r});break;case"Pie":case"Doughnut":n.stroke="transparent",r=function(e,t,i,n,r,a){var s=kt(270,i,new Ii(e,t)),o=kt(270,i,new Ii(e+r/10,t));return"M "+e+" "+t+" L "+(e+i)+" "+t+" A "+i+" "+i+" 0 1 1 "+s.x+" "+s.y+" Z M "+(e+r/10)+" "+(t-n/10)+" L"+(e+i)+" "+(t-n/10)+" A "+i+" "+i+" 0 0 0 "+o.x+" "+o.y+" Z"}(o,l,Math.min(a,s)/2,a,s),Object(f.gb)(n,{d:r})}return{renderOption:n}}(e,new E(d,u),i,n).renderOption,functionName:c}}(e,i,t,r,n,l,h);return c["draw"+d.functionName](d.renderOption,o?new Int32Array([o.x,o.y]):null)}function Zt(e){return document.getElementById(e)}function Gt(e,t,i,n,r,a,s,o,l,h){var c=e.getBoundingClientRect();t.accumulationDataLabelModule.calculateLabelSize(i,e,a,n,r,s,o,l,h,c,!0)}function Yt(e,t,i,n,r,a){var s=document.getElementById(t.element.id+"_Series_"+(void 0===n.index?n.category:n.index)+"_DataLabelCollections");s&&(0===i.index&&(t.dataLabelCollections=[]),t.dataLabelModule.calculateTemplateLabelSize(s,e,i,n,n.marker.dataLabel,r,n.clipRect,a,!0))}function Xt(e,t,i,n,r,a,s,o,l,h,c,d,u,p,g){var m,v=function(e){var t=null;try{document.querySelectorAll(e).length&&(t=Object(f.F)(document.querySelector(e).innerHTML.trim()))}catch(i){t=Object(f.F)(e)}return t}(i);try{var y,b=window.Blazor?s?r:{point:r}:{chart:n,series:a,point:r},C=v?v(b,n,s?s+"_template":"template",s||e.id.replace(/[^a-zA-Z0-9]/g,"")):[];if(C.length)for(var x=(m=Array.prototype.slice.call(C)).length,S=0;S<x;S++)e.appendChild(m[S]);"accumulationchart"===n.getModuleName()?(y=Gt.bind(this,e,n,h,c,l,c[t],d,u,p,g),n.isReact&&n.renderReactTemplates(y)):"chart"===n.getModuleName()&&(y=r&&a?Yt.bind(this,e,n,r,a,o,g):y,n.isReact&&n.renderReactTemplates(y))}catch(w){return e}return e}function Kt(e){return"font-size:"+e.size+"; font-style:"+e.fontStyle+"; font-weight:"+e.fontWeight+"; font-family:"+e.fontFamily+";opacity:"+e.opacity+"; color:"+e.color+";"}function Jt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;i||document.body.appendChild(e);var n=e.getBoundingClientRect();return t?Object(f.kb)(e):i||ft(e.id),n}function Qt(e,t,i,n,r){e="Logarithmic"===i.valueType?mt(e>0?e:Math.pow(i.logBase,i.visibleRange.min),i.logBase):e,t="Logarithmic"===n.valueType?mt(t>0?t:Math.pow(n.logBase,n.visibleRange.min),n.logBase):t,e=Et(e,i),t=Et(t,n);var a=r?i.rect.height:i.rect.width,s=r?n.rect.width:n.rect.height;return new Ii(r?t*s:e*a,r?(1-e)*a:(1-t)*s)}function $t(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"x",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"y",o=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>12?arguments[12]:void 0;if(e)return null;var p=t.querySelector("#"+i.id),g=p||Zt(i.id),m=i,v=u||300;if(n&&r&&g)if(o=o||("DIV"===g.tagName?new Ii(+g.style[a].split("px")[0],+g.style[s].split("px")[0]):new Ii(+g.getAttribute(a),+g.getAttribute(s))),l&&"undefined"!==l)Bt(i,i.getAttribute("d"),n,l,v);else if(c&&d)!function(e,t,i,n,r){var a=function(t){e.setAttribute("x",t.x+""),e.setAttribute("y",t.y+""),e.setAttribute("width",t.width+""),e.setAttribute("height",t.height+"")};new f.b({}).animate(Object(f.G)("div"),{duration:i,delay:0,progress:function(e){a(new L(Pt(e.timeStamp,r.x,n.x-r.x,e.duration),Pt(e.timeStamp,r.y,n.y-r.y,e.duration),Pt(e.timeStamp,r.width,n.width-r.width,e.duration),Pt(e.timeStamp,r.height,n.height-r.height,e.duration)))},end:function(){a(n)}})}(m,0,v,new L(+g.getAttribute("x"),+g.getAttribute("y"),+g.getAttribute("width"),+g.getAttribute("height")),d);else{var y="DIV"===m.tagName?new Ii(+m.style[a].split("px")[0],+m.style[s].split("px")[0]):new Ii(+m.getAttribute(a),+m.getAttribute(s));!function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"x",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"y",s="DIV"===e.tagName,o=function(t,i){s?(e.style[r]=t+"px",e.style[a]=i+"px"):(e.setAttribute(r,t+""),e.setAttribute(a,i+""))};o(i.x,i.y),new f.b({}).animate(Object(f.G)("div"),{duration:t,progress:function(e){o(Pt(e.timeStamp,i.x,n.x-i.x,e.duration),Pt(e.timeStamp,i.y,n.y-i.y,e.duration))},end:function(){o(n.x,n.y)}})}(m,v,o,y,a,s)}else n&&r&&!g&&h&&qt(m,0,600,"FadeIn");p?t.replaceChild(m,g):t.appendChild(m)}function ei(e,i,n){var r=i.yAxis.labelFormat,a=[],s=null!==r.match("{value}");switch(i.seriesType){case"XY":"PolarRadar"===i.chart.chartAreaType?-1!==i.drawType.indexOf("Stacking")?("Logarithmic"===i.yAxis.valueType&&Ct(i.stackedValues.endValues[e.index],i.yAxis)||bt(i.stackedValues.endValues[e.index],i.yAxis.visibleRange))&&a.push(e.text||e.yValue.toString()):("Logarithmic"===i.yAxis.valueType&&Ct(e.yValue,i.yAxis)||bt(e.yValue,i.yAxis.visibleRange))&&a.push(e.text||e.yValue.toString()):a.push(e.text||e.yValue.toString());break;case"HighLow":a.push(e.text||Math.max(e.high,e.low).toString()),a.push(e.text||Math.min(e.high,e.low).toString());break;case"HighLowOpenClose":a.push(e.text||Math.max(e.high,e.low).toString()),a.push(e.text||Math.min(e.high,e.low).toString()),a.push(e.text||Math.max(e.open,e.close).toString()),a.push(e.text||Math.min(e.open,e.close).toString());break;case"BoxPlot":a.push(e.text||e.median.toString()),a.push(e.text||e.maximum.toString()),a.push(e.text||e.minimum.toString()),a.push(e.text||e.upperQuartile.toString()),a.push(e.text||e.lowerQuartile.toString());var o,l=t(e.outliers);try{for(l.s();!(o=l.n()).done;){var h=o.value;a.push(e.text||h.toString())}}catch(d){l.e(d)}finally{l.f()}}if(r&&!e.text){i.yAxis.format=n.intl.getNumberFormat({format:s?"":r,useGrouping:n.useGroupingSeparator});for(var c=0;c<a.length;c++)a[c]=s?r.replace("{value}",i.yAxis.format(parseFloat(a[c]))):i.yAxis.format(parseFloat(a[c]))}return a}function ti(e){window.clearInterval(e)}function ii(e,t,i){var n=new L(e.x+i.x,e.y+i.y,e.width,e.height);return t.some(function(e){return n.x<e.x+e.width&&n.x+n.width>e.x&&n.y<e.y+e.height&&n.height+n.y>e.y})}function ni(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.height+e.y>t.y}function ri(e,t,i){return new L(e.x-t.width/2-i.left,e.y-t.height/2-i.top,t.width+i.left+i.right,t.height+i.top+i.bottom)}function ai(e){return"#"+si(e.r)+si(e.g)+si(e.b)}function si(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function oi(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new Ri(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):new Ri(255,255,255)}function li(e){e="transparent"===e?"white":e,document.body.appendChild(Object(f.G)("text",{id:"chartmeasuretext"}));var t=document.getElementById("chartmeasuretext");t.style.color=e,e=window.getComputedStyle(t).color,Object(f.kb)(t);var i=/^(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/.exec(e);return ai(new Ri(parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10)))}function hi(e,t){(e=(e=li(e)).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;for(var i,n="#",r=0;r<3;r++)i=parseInt(e.substr(2*r,2),16),n+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*t),255))).toString(16)).substr(i.toString(16).length);return n}function ci(e,t,i){var n=t,r=R(t,i).width;if(r>e)for(var a=t.length-1;a>=0;--a)if((r=R(n=t.substring(0,a)+"...",i).width)<=e)return n;return n}function di(e,t){return null!=e?-1!==e.indexOf("%")?t/100*parseInt(e,10):parseInt(e,10):null}function ui(e,t,i,n){if(!e)return null;var r=Zt(t);return r&&i&&n.setElementAttributes(i,"clipPath"===r.tagName?r.childNodes[0]:r),r}function pi(e,t,i,n,r){var a,s,o,l,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9?arguments[9]:void 0,g=arguments.length>10?arguments[10]:void 0,f=arguments.length>12?arguments[12]:void 0,m=arguments.length>13?arguments[13]:void 0,v={};v={id:t.id,x:t.x,y:t.y,fill:n||"black","font-size":i.size,"font-style":i.fontStyle,"font-family":i.fontFamily,"font-weight":i.fontWeight,"text-anchor":t.anchor,labelRotation:t.labelRotation,transform:t.transform,opacity:i.opacity,"dominant-baseline":t.baseLine};var y=e.createText(v,"string"==typeof t.text?t.text:h?t.text[t.text.length-1]:t.text[0],g?g.x:0,g?g.y:0);if(y.style.fontFamily=i.fontFamily,y.style.fontStyle=i.fontStyle,y.style.fontSize=i.size,y.style.fontWeight=i.fontWeight,y.style.color=i.color,y.style.textAnchor=t.anchor,"string"!=typeof t.text&&t.text.length>1)for(var b=1,C=t.text.length;b<C;b++)s=R(t.text[b],i).height,o=t.y+(h?-b*s:b*s),l=h?t.text[t.text.length-(b+1)]:t.text[b],m?a=e.createText(v,l,null,null,o,!0):(a=e.createTSpan({x:t.x,id:t.id,y:o},l),y.appendChild(a));return f||$t(e instanceof O,r,y,c,d,"x","y",null,null,u,!1,null,p),y}function gi(e){var t=e.element.clientWidth||e.element.offsetWidth,i=e.element.clientHeight;e.stockChart&&(t=e.stockChart.availableSize.width,i=e.stockChart.availableSize.height);var n,r=450;if("rangeNavigator"===e.getModuleName()){var a=e,s=a.periodSelectorSettings.periods.length?a.periodSelectorSettings.height:0;n=a.margin.top+a.margin.bottom+(a.tooltip.enable?35:0);var o=R("tempString",a.labelStyle).height;r=(e.series.length?f.d.isDevice?80:120:(a.enableGrouping?55+o:40)+n)+s,a.disableRangeSelector&&(r=s)}e.availableSize=new E(di(e.width,t)||t||600,di(e.height,i||r)||i||r)}function fi(e){e.canvasRender=new O(e.element.id),e.renderer=e.enableCanvas?e.canvasRender:new I(e.element.id),gi(e),e.svgObject=e.stockChart&&"chart"===e.getModuleName()?e.stockChart.chartObject:e.stockChart&&"rangeNavigator"===e.getModuleName()?e.stockChart.selectorObject:e.enableCanvas?e.renderer.createCanvas({id:e.element.id+"_canvas",width:e.availableSize.width,height:e.availableSize.height}):e.renderer.createSvg({id:e.element.id+"_svg",width:e.availableSize.width,height:e.availableSize.height})}function mi(e,t,i){var n=[];switch(t.textOverflow){case"Wrap":n=yi(e,i,t);break;case"Trim":n.push(ci(i,e,t));break;default:n.push(e)}return n}function vi(e,t){return"Near"===t.textAlignment?e.x:"Center"===t.textAlignment?e.x+e.width/2:e.x+e.width}function yi(e,t,i){for(var n,r=e.split(" "),a="",s=[],o=0,l=r.length;o<l;o++)n=r[o],R(a.concat(n),i).width<t?a=a.concat((""===a?"":" ")+n):""!==a?(s.push(ci(t,a,i)),a=n):(s.push(ci(t,n,i)),n=""),a&&o===l-1&&s.push(ci(t,a,i));return s}function bi(e,t){for(var i=e.replace(t," "),n=e.match(t),r=" ",a=" ",s=0,o={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"},l={0:"\u2070",1:"\xb9",2:"\xb2",3:"\xb3",4:"\u2074",5:"\u2075",6:"\u2076",7:"\u2077",8:"\u2078",9:"\u2079"},h=0;h<=i.length-1;h++)if(" "===i[h]){r=n[s].replace(t===Ze?/~/g:/\^/g,"");for(var c=0;c<r.length;c++)a+=t===Ze?o[r[c]]:l[r[c]];s++}else a+=i[h];return a.trim()}function Ci(e){for(var t=0;t<e.annotations.length;t++)Object(f.mb)((e.element.id+"_Annotation_"+t).replace(/[^a-zA-Z0-9]/g,""),"ContentTemplate");Object(f.mb)(e.element.id+"_tooltipparent_template_blazorTemplate","Template"),Object(f.mb)(e.element.id+"_DataLabel")}var xi=function e(t,i){a(this,e),this.startValues=t,this.endValues=i},Si=function(e){l(i,e);var t=c(i);function i(e,n,r,s,o,l,h,c,d){var u;return a(this,i),(u=t.call(this,e,n,r.width,r.color,s,d)).y=o.y,u.x=o.x,u.height=o.height,u.width=o.width,u.rx=l||0,u.ry=h||0,u.transform=c||"",u.stroke=0!==r.width&&""!==u.stroke?r.color:"transparent",u}return i}(U),wi=function e(t,i,n,r,s,o,l,h){a(this,e),this.height=t,this.width=i,this.href=n,this.x=r,this.y=s,this.id=o,this.visibility=l,this.preserveAspectRatio=h},ki=function(e){l(i,e);var t=c(i);function i(e,n,r,s,o,l,h){var c;return a(this,i),(c=t.call(this,e,n,r.width,r.color,s)).cy=l,c.cx=o,c.r=h,c}return i}(U),Ii=function e(t,i){a(this,e),this.x=t,this.y=i},Oi=function e(t,i,n,r){a(this,e),this.left=t,this.right=i,this.top=n,this.bottom=r},Ri=function e(t,i,n){a(this,e),this.r=t,this.g=i,this.b=n},Ai=function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,e),this.point=t,this.series=i,this.lierIndex=n},Ei=function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,e),this.point=t,this.series=i,this.index=n};function Li(e,t){var i="";return Number(t)===e.start?i=e.colors[0]:Number(t)===e.end?i=e.colors[e.colors.length-1]:i=ai(function(e,t){var i,n,r=t.start,a=t.end,s=0,o=a-r;if(s=(e-r)/o,t.colors.length<=2)i="#"===t.colors[0].charAt(0)?t.colors[0]:li(t.colors[0]),n="#"===t.colors[t.colors.length-1].charAt(0)?t.colors[t.colors.length-1]:li(t.colors[t.colors.length-1]);else{i="#"===t.colors[0].charAt(0)?t.colors[0]:li(t.colors[0]),n="#"===t.colors[t.colors.length-1].charAt(0)?t.colors[t.colors.length-1]:li(t.colors[t.colors.length-1]);for(var l=o/(t.colors.length-1),h=t.colors.length-1,c=[],d={},u=1;u<h;u++)d={b:r+u*l,color:t.colors[u]},c.push(d);for(var p=0;p<c.length;p++)r<=e&&e<=c[p].b&&0===p?(n="#"===c[p].color.charAt(0)?c[p].color:li(c[p].color),s=e<=c[p].b?1-Math.abs((e-c[p].b)/l):(e-c[p].b)/l):c[p].b<=e&&e<=a&&p===c.length-1&&(i="#"===c[p].color.charAt(0)?c[p].color:li(c[p].color),s=e<c[p].b?1-Math.abs((e-c[p].b)/l):(e-c[p].b)/l),p!==c.length-1&&p<c.length&&c[p].b<=e&&e<=c[p+1].b&&(i="#"===c[p].color.charAt(0)?c[p].color:li(c[p].color),n="#"===c[p+1].color.charAt(0)?c[p+1].color:li(c[p+1].color),s=Math.abs(e-c[p+1].b)/l)}return function(e,t,i){var n=i.split("#")[1],r=t.split("#")[1],a=Ti(e,parseInt(r.substr(0,2),16),parseInt(n.substr(0,2),16)),s=Ti(e,parseInt(r.substr(2,2),16),parseInt(n.substr(2,2),16)),o=Ti(e,parseInt(r.substr(4,2),16),parseInt(n.substr(4,2),16));return new Ri(a,s,o)}(s,i,n)}(Number(t),e)),i}function Ti(e,t,i){return Math.round(t+(i-t)*e)}var ji,Di,Mi,Fi,Pi,Ni,Bi,Hi,_i,zi,Vi,Ui,qi,Wi,Zi,Gi,Yi,Xi,Ki,Ji=function(){function e(t){a(this,e),this.chart=t,this.padding=5}return o(e,[{key:"measureAxis",value:function(e){var t=this.chart;this.crossAt(t),this.seriesClipRect=new L(e.x,e.y,e.width,e.height),this.initialClipRect=e,this.leftSize=0,this.rightSize=0,this.topSize=0,this.bottomSize=0,this.measureRowAxis(t,this.initialClipRect),this.initialClipRect=wt(this.initialClipRect,new Oi(this.leftSize,this.rightSize,0,0)),this.measureColumnAxis(t,this.initialClipRect),this.initialClipRect=wt(this.initialClipRect,new Oi(0,0,this.topSize,this.bottomSize)),this.chart.delayRedraw||this.calculateAxisSize(this.initialClipRect),this.leftSize=0,this.rightSize=0,this.topSize=0,this.bottomSize=0,this.measureRowAxis(t,this.initialClipRect),this.seriesClipRect=wt(this.seriesClipRect,new Oi(this.leftSize,this.rightSize,0,0)),this.measureColumnAxis(t,this.initialClipRect),this.seriesClipRect=wt(this.seriesClipRect,new Oi(0,0,this.topSize,this.bottomSize)),this.chart.delayRedraw||(t.refreshAxis(),this.calculateAxisSize(this.seriesClipRect))}},{key:"measureRowAxis",value:function(e,i){var n;this.calculateRowSize(i);var r,a=t(e.rows);try{for(a.s();!(r=a.n()).done;){(n=r.value).nearSizes=[],n.farSizes=[],this.arrangeAxis(n),this.measureDefinition(n,e,new E(e.availableSize.width,n.computedHeight)),this.leftSize<St(n.nearSizes)&&(this.leftSize=St(n.nearSizes)),this.rightSize<St(n.farSizes)&&(this.rightSize=St(n.farSizes))}}catch(s){a.e(s)}finally{a.f()}}},{key:"measureColumnAxis",value:function(e,i){var n;this.calculateColumnSize(i);var r,a=t(e.columns);try{for(a.s();!(r=a.n()).done;){(n=r.value).farSizes=[],n.nearSizes=[],this.arrangeAxis(n),this.measureDefinition(n,e,new E(n.computedWidth,e.availableSize.height)),this.bottomSize<St(n.nearSizes)&&(this.bottomSize=St(n.nearSizes)),this.topSize<St(n.farSizes)&&(this.topSize=St(n.farSizes))}}catch(s){a.e(s)}finally{a.f()}}},{key:"measureDefinition",value:function(e,i,n){var r,a=t(e.axes);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.scrollBarHeight=i.scrollBarModule&&i.zoomModule&&i.zoomSettings.enableScrollbar&&s.enableScrollbarOnZooming&&i.zoomModule.isZoomed&&(s.zoomFactor<1||s.zoomPosition>0)?16:0,s.scrollBarHeight=i.scrollBarModule&&(i.zoomModule&&i.zoomSettings.enableScrollbar&&s.enableScrollbarOnZooming&&i.zoomModule.isZoomed&&(s.zoomFactor<1||s.zoomPosition>0)||s.scrollbarSettings.enable)?16:0,s.getModule(i),s.baseModule.calculateRangeAndInterval(n,s),e.computeSize(s,s.scrollBarHeight)}}catch(o){a.e(o)}finally{a.f()}e.farSizes.length>0&&(e.farSizes[e.farSizes.length-1]-=10),e.nearSizes.length>0&&(e.nearSizes[e.nearSizes.length-1]-=10)}},{key:"calculateAxisSize",value:function(e){var t,i,n,r,a,s,o,l=this.chart,h=0,c=0,d=0;this.calculateRowSize(e);for(var u=0,p=l.rows.length;u<p;u++){h=0,c=0;for(var g=0,f=(t=l.rows[u]).axes.length;g<f;g++){if(o=(r=t.axes[g]).plotOffset,0===r.rect.height){r.rect.height=t.computedHeight,d=0;for(var m=u+1,v=u+r.span;m<v;m++)d+=(n=l.rows[m]).computedHeight;r.rect.y=t.computedTop-d+(r.plotOffsetTop?r.plotOffsetTop:o),r.rect.height=r.rect.height+d-this.getAxisOffsetValue(r.plotOffsetTop,r.plotOffsetBottom,r.plotOffset),r.rect.width=0}r.opposedPosition?(a=e.x+e.width+St(At(t.farSizes,c)),r.rect.x=r.rect.x>=a?r.rect.x:a,c++):(a=e.x-St(At(t.nearSizes,h)),r.rect.x=r.rect.x<=a?r.rect.x:a,h++)}}this.calculateColumnSize(e);for(var y=0,b=l.columns.length;y<b;y++){h=0,c=0;for(var C=0,x=(i=l.columns[y]).axes.length;C<x;C++){if(o=(r=i.axes[C]).plotOffset,0===r.rect.width){for(var S=y,w=y+r.span;S<w;S++)n=l.columns[S],r.rect.width+=n.computedWidth;r.rect.x=i.computedLeft+(r.plotOffsetLeft?r.plotOffsetLeft:o),r.rect.width-=this.getAxisOffsetValue(r.plotOffsetLeft,r.plotOffsetRight,r.plotOffset),r.rect.height=0}r.opposedPosition?(s=e.y-St(At(i.farSizes,c)),r.rect.y=r.rect.y<=s?r.rect.y:s,c++):(s=e.y+e.height+St(At(i.nearSizes,h)),r.rect.y=r.rect.y>=s?r.rect.y:s,h++)}}}},{key:"measure",value:function(){var e,i,n,r,a,s,o=this.chart,l=t(o.axisCollections);try{for(l.s();!(s=l.n()).done;){var h=s.value;if("Vertical"===h.orientation){o.verticalAxes.push(h),r=this.getActualRow(h),e=o.rows[r],this.pushAxis(e,h),a=r+h.span>o.rows.length?o.rows.length:r+h.span;for(var c=r+1;c<a;c++)(n=o.rows[c]).axes[e.axes.length-1]=h,o.rows[c]=n;o.rows[r]=e}else{o.horizontalAxes.push(h),r=this.getActualColumn(h),i=o.columns[r],this.pushAxis(i,h),a=r+h.span>o.columns.length?o.columns.length:r+h.span;for(var d=r+1;d<a;d++)(n=o.columns[d]).axes[i.axes.length-1]=h,o.columns[d]=n;o.columns[r]=i}}}catch(u){l.e(u)}finally{l.f()}}},{key:"getAxisOffsetValue",value:function(e,t,i){return e?e+(t||i):t?t+i:2*i}},{key:"crossAt",value:function(e){var i,n=t(e.axisCollections);try{for(n.s();!(i=n.n()).done;){var r=i.value;if(null!==r.crossesAt)if(r.crossesInAxis)for(var a=2,s=e.axisCollections.length;a<s;a++)r.crossesInAxis!==e.axisCollections[a].name||(r.crossInAxis=e.axisCollections[a],r.crossAt=this.updateCrossAt(r.crossInAxis,r.crossesAt));else r.crossInAxis=e.requireInvertedAxis?"Horizontal"===r.orientation?e.primaryXAxis:e.primaryYAxis:"Horizontal"===r.orientation?e.primaryYAxis:e.primaryXAxis,r.crossAt=this.updateCrossAt(r.crossInAxis,r.crossesAt)}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateCrossAt",value:function(e,t){switch(e.valueType){case"DateTime":var i={skeleton:"full",type:"dateTime"},n=this.chart.intl.getDateParser(i),r=this.chart.intl.getDateFormat(i);return Date.parse(n(r(new Date(m.c.parse.parseJson({val:t}).val))));case"Category":return parseFloat(t)?parseFloat(t):e.labels.indexOf(t);case"Logarithmic":return mt(t,e.logBase);default:return t}}},{key:"pushAxis",value:function(e,t){for(var i=0,n=e.axes.length;i<=n;i++)if(!e.axes[i]){e.axes[i]=t;break}}},{key:"arrangeAxis",value:function(e){for(var t=[],i=0,n=e.axes.length;i<=n;i++)e.axes[i]&&t.push(e.axes[i]);e.axes=t}},{key:"getActualColumn",value:function(e){var t=this.chart.columns.length,i=e.columnIndex;return i>=t?t-1:i<0?0:i}},{key:"getActualRow",value:function(e){var t=this.chart.rows.length,i=e.rowIndex;return i>=t?t-1:i<0?0:i}},{key:"calculateRowSize",value:function(e){for(var t,i=this.chart,n=e.y+e.height,r=0,a=Math.max(0,e.height),s=0,o=i.rows.length;s<o;s++)r=-1!==(t=i.rows[s]).height.indexOf("%")?Math.min(a,e.height*parseInt(t.height,10)/100):Math.min(a,parseInt(t.height,10)),r=s!==o-1?r:a,t.computedHeight=r,n-=r,t.computedTop=n,a-=r}},{key:"calculateColumnSize",value:function(e){for(var t,i=this.chart,n=e.x,r=0,a=Math.max(0,e.width),s=0,o=i.columns.length;s<o;s++)r=-1!==(t=i.columns[s]).width.indexOf("%")?Math.min(a,e.width*parseInt(t.width,10)/100):Math.min(a,parseInt(t.width,10)),r=s!==o-1?r:a,t.computedWidth=r,t.computedLeft=n,n+=r,a-=r}},{key:"renderAxes",value:function(){for(var e,t,i,n=this.chart,r=n.renderer.createGroup({id:n.element.id+"AxisInsideCollection"}),a=n.renderer.createGroup({id:n.element.id+"AxisOutsideCollection"}),s=0,o=n.axisCollections.length;s<o;s++)e=n.axisCollections[s],this.element=n.renderer.createGroup({id:n.element.id+"AxisGroup"+s+"Inside"}),t=n.renderer.createGroup({id:n.element.id+"AxisGroup"+s+"Outside"}),i=this.findAxisPosition(e),"Horizontal"===e.orientation?(e.updateCrossValue(),e.visible&&e.internalVisibility&&e.lineStyle.width>0&&this.drawAxisLine(e,s,e.plotOffset,0,i?t:this.element,e.updatedRect),(e.majorGridLines.width>0||e.majorTickLines.width>0)&&this.drawXAxisGridLine(e,s,i||"Inside"===e.tickPosition?t:this.element,e.updatedRect),e.visible&&e.internalVisibility&&(this.drawXAxisLabels(e,s,i||"Inside"===e.labelPosition?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect),this.drawXAxisBorder(e,s,i||"Inside"===e.labelPosition?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect),this.drawXAxisTitle(e,s,i?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect))):(e.updateCrossValue(),e.visible&&e.internalVisibility&&e.lineStyle.width>0&&this.drawAxisLine(e,s,0,e.plotOffset,i?t:this.element,e.updatedRect),(e.majorGridLines.width>0||e.majorTickLines.width>0)&&this.drawYAxisGridLine(e,s,i||"Inside"===e.tickPosition?t:this.element,e.updatedRect),e.visible&&e.internalVisibility&&(this.drawYAxisLabels(e,s,i||"Inside"===e.labelPosition?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect),this.drawYAxisBorder(e,s,i||"Inside"===e.labelPosition?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect),this.drawYAxisTitle(e,s,i?t:this.element,e.placeNextToAxisLine?e.updatedRect:e.rect))),this.chart.enableCanvas||(r.appendChild(this.element),t&&t.childNodes.length>0&&a.appendChild(t)),n.scrollBarModule&&(n.zoomSettings.enableScrollbar&&e.enableScrollbarOnZooming||e.scrollbarSettings.enable)&&this.renderScrollbar(n,e);this.element=n.renderer.createGroup({id:n.element.id+"DefinitionLine"});for(var l=0,h=n.rows.length;l<h;l++){var c=n.rows[l];c.border.color&&this.drawBottomLine(c,l,!0)}for(var d=0,u=n.columns.length;d<u;d++){var p=n.columns[d];p.border.color&&this.drawBottomLine(p,d,!1)}return this.chart.enableCanvas||r.appendChild(this.element),$t(n.enableCanvas,n.svgObject,r,n.redraw),a}},{key:"renderScrollbar",value:function(e,t){(!Object(f.Z)(e.zoomModule)&&e.zoomModule.isZoomed&&(t.zoomFactor<1||t.zoomPosition>0)||t.scrollbarSettings.enable&&(t.zoomFactor<=1||t.zoomPosition>=0))&&(!t.zoomingScrollBar.isScrollUI||e.visibleSeries[0].type.indexOf("Bar")>=0)?(e.scrollElement||(e.scrollElement=ui(e.redraw,e.element.id+"_scrollElement")||Object(f.G)("div",{id:e.element.id+"_scrollElement"})),$t(!1,e.scrollElement,t.zoomingScrollBar.render(!0),!0)):1===t.zoomFactor&&0===t.zoomPosition&&t.zoomingScrollBar.svgObject&&!t.scrollbarSettings.enable&&t.zoomingScrollBar.destroy(),t.zoomingScrollBar.isScrollUI&&(t.zoomingScrollBar.isScrollUI=!1)}},{key:"findAxisPosition",value:function(e){return null!==e.crossAt&&e.isInside(e.crossInAxis.visibleRange)}},{key:"drawBottomLine",value:function(e,t,i){var n,r,a,s,o,l,h=this.chart;i?(a=s=(e=e).computedTop+e.computedHeight,r=(n=this.seriesClipRect.x)+this.seriesClipRect.width,o="Row"):(n=r=(e=e).computedLeft,s=(a=this.seriesClipRect.y)+this.seriesClipRect.height,o="Column"),l={id:h.element.id+"_AxisBottom_"+o+t,x1:n,y1:a,x2:r,y2:s,"stroke-width":e.border.width,stroke:e.border.color},this.htmlObject=h.renderer.drawLine(l),this.element.appendChild(this.htmlObject)}},{key:"drawAxisLine",value:function(e,t,i,n,r,a){var s,o=this.chart,l=Zt(o.element.id+"AxisLine_"+t),h=l?l.getAttribute("d"):"";l=null,s={id:o.element.id+"AxisLine_"+t,d:"M "+(a.x-i)+" "+(a.y-n)+" L "+(a.x+a.width+i)+" "+(a.y+a.height+n),"stroke-dasharray":e.lineStyle.dashArray,"stroke-width":e.lineStyle.width,stroke:e.lineStyle.color||o.themeStyle.axisLine},this.htmlObject=o.renderer.drawPath(s),$t(o.enableCanvas,r,this.htmlObject,o.redraw,!0,"x","y",null,h)}},{key:"drawYAxisGridLine",value:function(e,t,i,n){var r,a,s="Logarithmic"===e.valueType,o=e.valueType.indexOf("Category")>-1,l=0,h="",c="",d=e.opposedPosition?e.majorTickLines.height:-e.majorTickLines.height,u=e.opposedPosition?.5*e.lineStyle.width:.5*-e.lineStyle.width,p="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?.5:0,g=Object(f.Z)(e.crossesAt)?e.opposedPosition?e.scrollBarHeight:-e.scrollBarHeight:0,m="Inside"===e.tickPosition,v=m?n.x-d-u:n.x+d+u+g,y=e.visibleLabels.length,b=this.chart.themeStyle;e.valueType.indexOf("Category")>-1&&"BetweenTicks"===e.labelPlacement&&y>0&&(y+=1);for(var C=e.minorGridLines,x=e.minorTickLines,S=0;S<y;S++)(l=-1*(l=Et(r=e.visibleLabels[S]?e.visibleLabels[S].value-p:e.visibleLabels[S-1].value+e.visibleRange.interval-p,e)*n.height)+(n.y+n.height))>=n.y&&n.y+n.height>=l&&((yt(r,e.visibleRange)||this.isBorder(e,S,l))&&(h="M "+this.seriesClipRect.x+" "+l+" L "+(this.seriesClipRect.x+this.seriesClipRect.width)+" "+l,this.renderGridLine(e,t,h,e.majorGridLines,"_MajorGridLine_",S,this.element,b.majorGridLine,e.majorGridLines.dashArray)),c="M "+(n.x+u+(m?g:0))+" "+l+" L "+v+" "+l,this.renderGridLine(e,t,c,e.majorTickLines,"_MajorTickLine_",S,i,b.majorTickLine),(C.width>0||x.width>0)&&e.minorTicksPerInterval>0&&(0!==S||!Vt(e)||s||o||this.renderMinorGridOnZooming(e,r,n,S,t,b,i),a=this.drawAxisMinorLine(e,r,n,S),this.renderGridLine(e,t,a[0],C,"_MinorGridLine_",S,this.element,b.minorGridLine,C.dashArray),this.renderGridLine(e,t,a[1],x,"_MinorTickLine_",S,i,b.minorTickLine),S===y-1&&Vt(e)&&s&&!o&&this.renderMinorGridOnZooming(e,r+e.visibleRange.interval,n,S,t,b,i)))}},{key:"isBorder",value:function(e,t,i){var n=this.chart.chartArea.border,r=this.seriesClipRect,a=e.orientation,s="Horizontal"===a?r.x:r.y,o="Horizontal"===a?r.width:r.height;return e.plotOffset>0||(i===s||i===s+o)&&(n.width<=0||"transparent"===n.color)||i!==s&&t===("Horizontal"===a?0:e.visibleLabels.length-1)||i!==s+o&&t===("Horizontal"===a?e.visibleLabels.length-1:0)}},{key:"drawYAxisLabels",value:function(e,t,i,n){var r,a,s,o=this.chart,l=0,h=0,c="Inside"===e.labelPosition,d=e.opposedPosition,u=(e.labelPosition===e.tickPosition?e.majorTickLines.height:0)+e.labelPadding+.5*e.lineStyle.width;u=e.opposedPosition?u:-u;var p=d&&c||!d&&!c?"end":"start";p=o.isRtlEnabled?e.opposedPosition?"end":"start":p;for(var g,m,v,y=o.renderer.createGroup({id:o.element.id+"AxisLabels"+t}),b=Object(f.Z)(e.crossesAt)?e.scrollBarHeight*(d?1:-1):0,C=0,x=e.visibleLabels.length;C<x;C++){s=pt(e.visibleLabels[C].originalText),l=c?n.x-u:n.x+u+b,r=s?e.visibleLabels[C].breakLabelSize:e.visibleLabels[C].size,h=Et(e.visibleLabels[C].value,e)*n.height+(o.stockChart?7:0),h=Math.floor(-1*h+(n.y+n.height)),g=r.height/8*e.visibleLabels[C].text.length/2,m=r.height/4*3+3,h=s?"Inside"===e.labelPosition?h-r.height/2-g+m:h-g:"Inside"===e.labelPosition?h+m:h+r.height/4,v=e.majorGridLines.width>e.majorTickLines.width?e.majorGridLines.width:e.majorTickLines.width,"Far"===e.labelStyle.textAlignment?h=h-v-10:"Near"===e.labelStyle.textAlignment?h=h+v+10:"Center"===e.labelStyle.textAlignment&&(h=h),l=s?this.getAxisLabelXvalue(l,e,r.width):l;var S=s?this.getAnchor(e):p;if(a=new D(o.element.id+t+"_AxisLabel_"+C,l,h,S,e.visibleLabels[C].text),e.edgeLabelPlacement)switch(e.edgeLabelPlacement){case"None":break;case"Hide":((0===C||e.isInversed&&C===x-1)&&a.y>n.y+n.height||(C===x-1||e.isInversed&&0===C)&&a.y-.5*r.height<n.y)&&(a.text="");break;case"Shift":(0===C||e.isInversed&&C===x-1)&&a.y>n.y+n.height?a.y=h=n.y+n.height:(C===x-1||e.isInversed&&0===C)&&a.y-.5*r.height<n.y&&(a.y=h=n.y+.5*r.height)}pi(o.renderer,a,e.labelStyle,e.labelStyle.color||o.themeStyle.axisLabel,y,!1,o.redraw,!0,!0,null,null,0,null,o.enableCanvas)}this.chart.enableCanvas||(o.delayRedraw?e.visible&&e.internalVisibility&&this.createZoomingLabel(this.chart,y,e,t,n):$t(o.enableCanvas,i,y,o.redraw))}},{key:"getAxisLabelXvalue",value:function(e,t,i){var n=t.lineBreakAlignment,r="Inside"===t.labelPosition,a=t.opposedPosition;return a&&r||!a&&!r?"Right"===n?e:"Center"===n?e-i/2:e-i:"Left"===n?e:"Center"===n?e+i/2:e+i}},{key:"drawYAxisBorder",value:function(e,t,i,n){if(e.border.width>0){var r,a,s="Outside"===e.labelPosition?e.scrollBarHeight:0;s*=e.opposedPosition?1:-1;for(var o,l=n.height/e.visibleRange.delta*("DateTime"===e.valueType?e.dateTimeInterval:e.visibleRange.interval),h=e.maxLabelSize.width+10+(e.tickPosition===e.labelPosition?e.majorTickLines.height:0),c="",d="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?-.5:0,u=e.opposedPosition&&"Inside"===e.labelPosition||!e.opposedPosition&&"Outside"===e.labelPosition?n.x-h+s:n.x+h+s,p=0,g=e.visibleLabels.length;p<g;p++)switch(a=Et(e.visibleLabels[p].value+d,e),a=(e.isInversed?1-a:a)*n.height,"Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?(r=-1*a+(n.y+n.height),o=-1*a-l+(n.y+n.height)):(r=-1*a+l/2+(n.y+n.height),o=-1*a-l/2+(n.y+n.height)),e.border.type){case"Rectangle":case"WithoutTopBorder":r>n.y+n.height?c+="M "+u+" "+(n.y+n.height)+" L "+u+" "+o+" ":Math.floor(n.y)>o?c+="M "+(n.x+s)+" "+r+" L "+u+" "+r+" L "+u+" "+n.y+" ":(c+="M "+(n.x+s)+" "+r+" L "+u+" "+r+" L "+u+" "+o+" ",p===e.visibleLabels.length-1&&(c+="M "+(n.x+s)+" "+o+" L "+u+" "+o+" "));break;case"WithoutTopandBottomBorder":r>n.y+n.height||o<Math.floor(n.y)||(c+="M "+(n.x+s)+" "+r+" L "+u+" "+r+" M "+u+" "+o+" L "+(n.x+s)+" "+o)}""!==(c+="Rectangle"===e.border.type?"M "+(n.x+s)+" "+n.y+" L "+(n.x+s)+" "+(n.y+n.height)+" ":"")&&this.createAxisBorderElement(e,t,c,i)}e.multiLevelLabels.length>0&&this.chart.multiLevelLabelModule&&this.chart.multiLevelLabelModule.renderYAxisMultiLevelLabels(e,t,i,n)}},{key:"drawYAxisTitle",value:function(e,t,i,n){if(e.title){var r=this.chart,a=e.opposedPosition?90:-90,s=("Inside"===e.tickPosition?0:e.majorTickLines.height+e.titlePadding)+("Inside"===e.labelPosition?0:e.maxLabelSize.width+e.multiLevelLabelHeight+this.padding);s=e.opposedPosition?s+e.scrollBarHeight:-s-e.scrollBarHeight;var o=n.x+s,l=n.y+.5*n.height,h=new D(r.element.id+"_AxisTitle_"+t,o,l-e.labelPadding-e.titleSize.height*(e.titleCollection.length-1),"middle",e.titleCollection,"rotate("+a+","+o+","+l+")",null,a),c=pi(r.renderer,h,e.titleStyle,e.titleStyle.color||r.themeStyle.axisTitle,i,null,null,null,null,null,null,0,null,r.enableCanvas);c.setAttribute("tabindex",e.tabIndex.toString()),c.setAttribute("aria-label",e.description||e.title)}}},{key:"drawXAxisGridLine",value:function(e,t,i,n){var r,a,s="Logarithmic"===e.valueType,o=e.valueType.indexOf("Category")>-1,l=0,h="",c="",d=e.opposedPosition?-e.majorTickLines.height:e.majorTickLines.height,u=e.opposedPosition?.5*-e.lineStyle.width:.5*e.lineStyle.width,p=Object(f.Z)(e.crossesAt)?e.opposedPosition?-e.scrollBarHeight:e.scrollBarHeight:0,g=e.valueType.indexOf("Category")>-1&&"BetweenTicks"===e.labelPlacement?.5:0,m=e.visibleLabels.length,v="Inside"===e.tickPosition,y=v?n.y-d-u:n.y+d+u+p,b=this.chart.themeStyle;e.valueType.indexOf("Category")>-1&&m>0&&"BetweenTicks"===e.labelPlacement&&(m+=1);for(var C=0;C<m;C++)(l=Et(r="DateTimeCategory"!==e.valueType?e.visibleLabels[C]?e.visibleLabels[C].value-g:e.visibleLabels[C-1].value+e.visibleRange.interval-g:e.visibleLabels[C]?e.visibleLabels[C].value-g:e.visibleRange.max,e)*n.width+n.x)>=n.x&&n.x+n.width>=l&&((yt(r,e.visibleRange)||this.isBorder(e,C,l))&&(h="M "+l+" "+(this.seriesClipRect.y+this.seriesClipRect.height)+" L "+l+" "+this.seriesClipRect.y,this.renderGridLine(e,t,h,e.majorGridLines,"_MajorGridLine_",C,this.element,b.majorGridLine,e.majorGridLines.dashArray)),c="M "+l+" "+(n.y+u+(v?p:0))+" L "+l+" "+y,this.renderGridLine(e,t,c,e.majorTickLines,"_MajorTickLine_",C,i,b.majorTickLine),e.minorTicksPerInterval>0&&(e.minorGridLines.width>0||e.minorTickLines.width>0)&&(0!==C||!Vt(e)||s||o||this.renderMinorGridOnZooming(e,r,n,C,t,b,i),a=this.drawAxisMinorLine(e,r,n,C),this.renderGridLine(e,t,a[0],e.minorGridLines,"_MinorGridLine_",C,this.element,b.minorGridLine,e.minorGridLines.dashArray),this.renderGridLine(e,t,a[1],e.minorTickLines,"_MinorTickLine_",C,i,b.minorTickLine),C===m-1&&Vt(e)&&s&&!o&&this.renderMinorGridOnZooming(e,r+e.visibleRange.interval,n,C,t,b,i)))}},{key:"renderMinorGridOnZooming",value:function(e,t,i,n,r,a,s){var o=this.drawAxisMinorLine(e,t,i,n,!0);this.renderGridLine(e,r,o[0],e.minorGridLines,"_MinorGridLine_",-1,this.element,a.minorGridLine,e.minorGridLines.dashArray),this.renderGridLine(e,r,o[1],e.minorTickLines,"_MinorTickLine_",-1,s,a.minorTickLine)}},{key:"drawAxisMinorLine",value:function(e,t,i,n,r){var a,s=t,o=0,l=0,h=e.visibleRange,c="Inside"===e.tickPosition,d=[],u=e.opposedPosition?-e.minorTickLines.height:e.minorTickLines.height,p=1,g=1,f=c?i.y-u:i.y+u,m=c?i.x+u:i.x-u,v="",y="";if("Logarithmic"===e.valueType&&(g=(a=Math.pow(e.logBase,s-h.interval))+(p=(Math.pow(e.logBase,s)-a)/(e.minorTicksPerInterval+1))),"Horizontal"===e.orientation)for(var b=0;b<e.minorTicksPerInterval;b++)s=this.findLogNumeric(e,g,s,n,r),g+=p,yt(s,h)&&(l=(s-h.min)/(h.max-h.min),l=Math.ceil((e.isInversed?1-l:l)*i.width),o=Math.floor(l+i.x),v=v.concat("M "+o+" "+this.seriesClipRect.y+"L "+o+" "+(this.seriesClipRect.y+this.seriesClipRect.height)),o=Math.floor(l+i.x),y=y.concat("M "+o+" "+i.y+"L "+o+" "+(f+e.scrollBarHeight)));else for(var C=0;C<e.minorTicksPerInterval;C++)yt(s=this.findLogNumeric(e,g,s,n,r),h)&&(l=(s-h.min)/(h.max-h.min),l=-1*Math.ceil((e.isInversed?1-l:l)*i.height),o=Math.floor(l+i.y+i.height),v=v.concat("M "+this.seriesClipRect.x+" "+o+"L "+(this.seriesClipRect.x+this.seriesClipRect.width)+" "+o+" "),o=Math.floor(l+i.y+i.height),y=y.concat("M "+i.x+" "+o+"L "+(m-e.scrollBarHeight)+" "+o+" ")),g+=p;return d.push(v),d.push(y),d}},{key:"findLogNumeric",value:function(e,t,i,n,r){var a,s=e.visibleRange;if("Logarithmic"===e.valueType)i=mt(t,e.logBase);else if("DateTime"===e.valueType)a=e.dateTimeInterval/(e.minorTicksPerInterval+1),i=r?i-a:i+a;else if("DateTimeCategory"===e.valueType){var o="BetweenTicks"===e.labelPlacement?.5:0;i+=((e.visibleLabels[n+1]?e.visibleLabels[n+1].value-o:e.visibleRange.max)-(e.visibleLabels[n]?e.visibleLabels[n].value-o:e.visibleRange.min))/(e.minorTicksPerInterval+1)}else a=s.interval/(e.minorTicksPerInterval+1),i=r?i-a:i+a;return i}},{key:"drawXAxisLabels",value:function(e,t,i,n){var r,a,s,o,l,h,c,d,u,p=this.chart,g=0,m=0,v=e.labelPadding,y=p.renderer.createGroup({id:p.element.id+"AxisLabels"+t}),b="Inside"===e.labelPosition,C=e.opposedPosition,x=e.labelPosition===e.tickPosition?e.majorTickLines.height:0,S=x+v+.5*e.lineStyle.width,w=e.angle%360,k=0===w||-180===w||180===w,I=e.isInversed?n.x+n.width:n.x,O=0,R=e.visibleLabels.length,A=e.scrollbarSettings.enable||!b&&Object(f.Z)(e.crossesAt)&&(e.zoomFactor<1||e.zoomPosition>0)?e.scrollBarHeight:0,E=[],T=!1;S+=90===w||270===w||-90===w||-270===w?b?5:-5:0;for(var j=!C&&!b||C&&b,M=j?360>=w&&w>=180||-1>=w&&w>=-180:1<=w&&w<=180||-181>=w&&w>=-360,F=0,P=R;F<P;F++){u=pt((d=e.visibleLabels[F]).originalText),g=Et(d.value,e)*n.width+n.x,a=d.size,c=n.width/R,h=u?d.breakLabelSize.width:a.width,O=("Trim"===e.labelIntersectAction||"Wrap"===e.labelIntersectAction)&&0===w&&h>c?c:h,r=a.height/4,g-=u||0!==w?0:O/2,0!==w&&(g-=u?"Left"===e.lineBreakAlignment?d.breakLabelSize.width/2:"Right"===e.lineBreakAlignment?-d.breakLabelSize.width/2:0:-90===w||270===w?-r:90===w||-270===w?r:0),"Far"===e.labelStyle.textAlignment?g=g+O-10:"Near"===e.labelStyle.textAlignment?g=g-O+10:"Center"===e.labelStyle.textAlignment&&(g=g),u&&"Center"!==e.lineBreakAlignment&&0===w&&(g+="Left"===e.lineBreakAlignment?-O/2:O/2);var N=u?k?a.height:d.breakLabelSize.width/2:0;if(S=u?x+v+.5*e.lineStyle.width:S,b&&w?m=u?C?n.y+S+N:n.y-S-N:C?n.y+S+r:n.y-S-r:(s=u?j?S+A+(w?N:3*r):-(S+A+N):j?S+A+(w?1:3)*r:-(S+A+(w?r:d.index>1?2*r:0)),m=n.y+s*d.index),o=u?this.getAnchor(e):p.isRtlEnabled||M?"end":"",l=new D(p.element.id+t+"_AxisLabel_"+F,g,m,o),e.edgeLabelPlacement&&0===w)switch(e.edgeLabelPlacement){case"None":break;case"Hide":if((0===F||e.isInversed&&F===P-1)&&l.x<n.x||(F===P-1||e.isInversed&&0===F)&&l.x+O>n.x+n.width)continue;break;case"Shift":(0===F||e.isInversed&&F===P-1)&&l.x<n.x?(c-=n.x-l.x,l.x=g=n.x):(F===P-1||e.isInversed&&0===F)&&l.x+O>n.x+n.width&&(a.width>c&&"Trim"===e.labelIntersectAction?c-=l.x+O-(n.x+n.width):c=O,l.x=g=n.x+n.width-c)}var B=void 0,H=void 0;if(l.text=this.getLabelText(d,e,c),u&&0===w?"Right"===e.lineBreakAlignment?(B=l.x-O,H=l.x):"Center"===e.lineBreakAlignment?(B=l.x-O/2,H=l.x+O/2):(B=l.x,H=l.x+O):(B=l.x,H=l.x+O),0!==w||"Hide"!==e.labelIntersectAction||0===F||!(e.isInversed?H>=I:B<=I)){if(I=u?"Right"===e.lineBreakAlignment?e.isInversed?l.x-O:l.x:"Center"===e.lineBreakAlignment?e.isInversed?l.x-O/2:l.x+O/2:e.isInversed?l.x:l.x+O:e.isInversed?l.x:l.x+O,0!==w){var _=void 0,z=void 0;if(u){var V=0,U=0;_=d.breakLabelSize.height,U=d.breakLabelSize.height-4,"Center"===e.lineBreakAlignment?V=-d.breakLabelSize.width/2:"Right"===e.lineBreakAlignment&&(V=-d.breakLabelSize.width),j&&(U=d.breakLabelSize.height/(l.text.length+1)),z=new L(l.x+V,l.y-U,d.breakLabelSize.width,_)}else _=m-(l.y-(d.size.height/2+10)),z=new L(l.x,l.y-(d.size.height/2-5),d.size.width,_);var q=this.getRectanglePoints(z),W=u?z.x+z.width/2:g,Z=u?z.y+z.height/2:m-_/2;l.transform=u?"rotate("+w+","+W+","+Z+")":"rotate("+w+","+g+","+m+")",E.push(Ot(q,W,Z,w)),T=!1;for(var G=F;G>0;G--)if(E[F]&&E[G-1]&&Rt(E[F],E[G-1])){T=!0,E[F]=null;break}}pi(p.renderer,l,d.labelStyle,d.labelStyle.color||p.themeStyle.axisLabel,y,e.opposedPosition!==("Inside"===e.labelPosition),p.redraw,!0,null,null,null,0,T,p.enableCanvas)}}this.chart.enableCanvas||(p.delayRedraw?e.visible&&e.internalVisibility&&this.createZoomingLabel(this.chart,y,e,t,n):i.appendChild(y))}},{key:"getAnchor",value:function(e){return"Center"===e.lineBreakAlignment?"middle":"Left"===e.lineBreakAlignment?"start":"end"}},{key:"getRectanglePoints",value:function(e){return[new Ii(e.x,e.y),new Ii(e.x+e.width,e.y),new Ii(e.x+e.width,e.y+e.height),new Ii(e.x,e.y+e.height)]}},{key:"getLabelText",value:function(e,t,i){if(pt(e.originalText)){for(var n,r=[],a=0;a<e.text.length;a++)n=this.findAxisLabel(t,e.text[a],i),r.push(n);return r}return this.findAxisLabel(t,e.text,i)}},{key:"drawXAxisBorder",value:function(e,t,i,n){if(e.border.width>0){for(var r,a,s,o="Outside"===e.labelPosition?e.scrollBarHeight:0,l=n.y+(e.opposedPosition?-1:1)*o,h=n.width/e.visibleRange.delta*("DateTime"===e.valueType?e.dateTimeInterval:e.visibleRange.interval),c=e.maxLabelSize.height+(e.tickPosition===e.labelPosition?e.majorTickLines.height:0),d="",u="Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?-.5:0,p=e.opposedPosition&&"Inside"===e.labelPosition||!e.opposedPosition&&"Outside"===e.labelPosition?n.y+c+10+o:n.y-c-10-o,g=0,f=e.visibleLabels.length;g<f;g++)switch(a=Et(e.visibleLabels[g].value+u,e),a=(e.isInversed?1-a:a)*n.width,"Category"===e.valueType&&"BetweenTicks"===e.labelPlacement?(r=a+n.x,s=a+h+n.x):(r=a-.5*h+n.x,s=a+.5*h+n.x),e.border.type){case"Rectangle":case"WithoutTopBorder":r<n.x?d+="M "+n.x+" "+p+" L "+s+" "+p+" ":Math.floor(s)>n.width+n.x&&1!==e.visibleLabels.length?d+="M "+r+" "+l+" L "+r+" "+p+" L "+(n.width+n.x)+" "+p+" ":(d+="M "+r+" "+l+" L "+r+" "+p+" L "+s+" "+p+" ",0===g&&(d+="M "+r+" "+l+" L "+r+" "+p+" M "+r+" "+p+" L "+n.x+" "+p),g===e.visibleLabels.length-1&&(d+="M "+s+" "+l+" L "+s+" "+p+" M "+s+" "+p+" L "+(n.width+n.x)+" "+p));break;case"WithoutTopandBottomBorder":r<n.x||Math.floor(s)>n.width+n.x||(d+="M "+r+" "+l+" L "+r+" "+p+" M "+s+" "+l+" L "+s+" "+p)}""!==(d+="Rectangle"===e.border.type?"M  "+n.x+" "+l+"L "+(n.x+n.width)+" "+l:"")&&this.createAxisBorderElement(e,t,d,i)}this.chart.multiLevelLabelModule&&e.multiLevelLabels.length>0&&this.chart.multiLevelLabelModule.renderXAxisMultiLevelLabels(e,t,i,n)}},{key:"createAxisBorderElement",value:function(e,t,i,n){var r=Zt(this.chart.element.id+"_BorderLine_"+t),a=r?r.getAttribute("d"):"",s=this.chart.renderer.drawPath(new U(this.chart.element.id+"_BorderLine_"+t,"transparent",e.border.width,e.border.color||this.chart.themeStyle.axisLine,1,"",i));s.setAttribute("style","pointer-events: none"),$t(this.chart.enableCanvas,n,s,this.chart.redraw,!0,"x","y",null,a,!0)}},{key:"findAxisLabel",value:function(e,t,i){return"Trim"===e.labelIntersectAction?e.angle%360!=0||e.enableTrim?t:ci(i,t,e.labelStyle):t}},{key:"drawXAxisTitle",value:function(e,t,i,n){if(e.title){var r=this.chart,a=R(e.title,e.titleStyle),s=Object(f.Z)(e.crossesAt)?e.scrollBarHeight:0,o=("Inside"===e.tickPosition?0:e.majorTickLines.height+e.titlePadding)+("Inside"===e.labelPosition?0:e.maxLabelSize.height+e.multiLevelLabelHeight+e.labelPadding),l=e.titleSize.height*(e.titleCollection.length-1);o=e.opposedPosition?-(o+a.height/4+s+l):o+3*a.height/4+s;var h=new D(r.element.id+"_AxisTitle_"+t,n.x+.5*n.width,n.y+o,"middle",e.titleCollection),c=pi(r.renderer,h,e.titleStyle,e.titleStyle.color||r.themeStyle.axisTitle,i,null,null,null,null,null,null,0,null,r.enableCanvas);c.setAttribute("aria-label",e.description||e.title),c.setAttribute("tabindex",e.tabIndex.toString())}}},{key:"renderGridLine",value:function(e,t,i,n,r,a,s,o){var l,h,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=this.chart;n.width>0&&e.visible&&e.internalVisibility&&i&&(l=(h=Zt(d.element.id+r+t+"_"+a))?h.getAttribute("d"):null,h=null,this.htmlObject=d.renderer.drawPath(new U(d.element.id+r+t+"_"+a,"transparent",n.width,n.color||o,null,c,i)),$t(d.enableCanvas,s,this.htmlObject,d.redraw,!0,"x","y",null,l,!0))}},{key:"findParentNode",value:function(e,t,i){return document.getElementById(e+"AxisGroup"+i+"Inside").contains(document.getElementById(t.id))?document.getElementById(e+"AxisGroup"+i+"Inside"):document.getElementById(e+"AxisGroup"+i+"Outside")}},{key:"createZoomingLabel",value:function(e,t,i,n,r){var a=this.findParentNode(e.element.id,t,n);t.setAttribute("opacity","0.3");var s=e.renderer.createGroup({id:e.element.id+"AxisLabels_Zoom"+n});s=function(e,t,i,n,r,a){for(var s,o,l,h,c,d=t.opposedPosition,u=r?"start":"auto",p=e.availableSize.width,g=t.scrollbarSettings.enable||t.zoomingScrollBar&&t.zoomingScrollBar.svgObject?t.scrollBarHeight:0,f=0;f<2;f++)s=R(f?t.endLabel:t.startLabel,t.labelStyle),r?(h=f?new Ii(a.x-g,a.y+3):new Ii(t.rect.x-g,a.y+a.height-3),o=a.x+(d?a.width+5+g:-(s.width+5+5+g)),l=a.y+(f?0:a.height-s.height-5),o+=o<0||p<o+s.width+5?d?-s.width/2:s.width/2:0,c=A(3,3,new L(o,l,s.width+5,s.height+5),h,5,!1,!1,!d,h.x,h.y+(f?-3:3))):(h=new Ii(f?a.x+a.width-3:a.x+3,a.y+a.height+g),o=a.x+(f?a.width-s.width-5:0),l=d?a.y-s.height-10-g:a.y+a.height+5+g,c=A(3,3,new L(o,l,s.width+5,s.height+5),h,5,d,!d,!1,h.x+(f?3:-3),h.y)),o+=2.5,l=l+s.height/4*3+2.5,i.appendChild(e.renderer.drawPath(new U(e.element.id+"_Zoom_"+n+"_AxisLabel_Shape_"+f,e.themeStyle.crosshairFill,2,e.themeStyle.crosshairFill,1,null,c))),pi(e.renderer,new D(e.element.id+"_Zoom_"+n+"_AxisLabel_"+f,o,l,u,f?t.endLabel:t.startLabel),{color:e.themeStyle.crosshairLabel,fontFamily:"Segoe UI",fontWeight:"Regular",size:"11px"},e.themeStyle.crosshairLabel,i);return i}(e,i,s,n,"Vertical"===i.orientation,r),a.replaceChild(t,document.getElementById(t.id)),Zt(e.element.id+"AxisLabels_Zoom"+n)?a.replaceChild(s,document.getElementById(s.id)):a.appendChild(s)}}]),e}(),Qi=function(){function e(t){a(this,e),this.currentPoints=[],this.previousPoints=[],this.insideRegion=!1,this.chart=t,this.lierIndex=0}return o(e,[{key:"getData",value:function(){for(var e,t,i,n,r=this.chart,a=null,s=null,o=r.visibleSeries.length-1;o>=0;o--){if(e="Scatter"===(s=r.visibleSeries[o]).type||"Scatter"===s.drawType||s.marker.visible?(s.marker.height+5)/2:0,t="Scatter"===s.type||"Scatter"===s.drawType||s.marker.visible?(s.marker.width+5)/2:0,i=r.mouseX,n=r.mouseY,s.dragSettings.enable&&s.isRectSeries)if("Bar"===s.type&&r.isTransposed||!r.isTransposed&&"Bar"!==s.type){var l=s.marker.height/2;n=s.yAxis.isInversed?n-l:n+l}else{var h=s.marker.width/2;i=s.yAxis.isInversed?i+h:i-h}if(s.visible&&jt(i,n,s.clipRect,e,t)&&(a=this.getRectPoint(s,s.clipRect,i,n)),a)return new Ai(a,s)}return new Ai(a,s)}},{key:"isSelected",value:function(e){return(e.selectionMode.indexOf("Drag")>-1||e.selectionMode.indexOf("Lasso")>-1)&&e.selectionModule&&null!==e.selectionModule.rectPoints}},{key:"getRectPoint",value:function(e,i,n,r){var a,s,o,l,h,c,d=0;if(this.chart.isScrolling)return null;var u,p=t(e.points);try{for(p.s();!(u=p.n()).done;){var g=u.value;if(g.regionData||g.regions&&g.regions.length){if(g.regionData&&"PolarRadar"===this.chart.chartAreaType&&e.drawType.indexOf("Column")>-1&&(a=n-(e.clipRect.width/2+e.clipRect.x),s=r-(e.clipRect.height/2+e.clipRect.y),d=2*Math.PI*(g.regionData.currentXPosition<0?1+g.regionData.currentXPosition:g.regionData.currentXPosition),o=(o=(Math.atan2(s,a)+.5*Math.PI-d)%(2*Math.PI))<0?2*Math.PI+o:o,o+=2*Math.PI*e.chart.primaryXAxis.startAngle,l=g.regionData.startAngle,l=(l-=d)<0?2*Math.PI+l:l,h=g.regionData.endAngle,h=(h-=d)<0?2*Math.PI+h:h,c=Math.sqrt(Math.pow(Math.abs(a),2)+Math.pow(Math.abs(s),2)),o>=l&&o<=h&&(c>=g.regionData.innerRadius&&c<=g.regionData.radius||c<=g.regionData.innerRadius&&c>=g.regionData.radius)&&c<=e.chart.radius))return g;if((e.dragSettings.enable&&e.isRectSeries||e.isRectSeries&&e.marker.visible)&&this.isPointInThresholdRegion(n,r,g,i,e))return this.insideRegion=!0,g;if(!this.insideRegion&&this.checkRegionContainsPoint(g.regions,i,n,r))return g;if(this.insideRegion&&this.checkRegionContainsPoint(g.regions,i,n,r))return g}}}catch(f){p.e(f)}finally{p.f()}return null}},{key:"checkRegionContainsPoint",value:function(e,t,i,n){var r=this;return e.some(function(e,a){return r.lierIndex=a,jt(i,n,new L(("Cartesian"===r.chart.chartAreaType?t.x:0)+e.x,("Cartesian"===r.chart.chartAreaType?t.y:0)+e.y,e.width,e.height))})}},{key:"isPointInThresholdRegion",value:function(e,t,i,n,r){var a,s=this,o="Bar"===r.type,l=r.yAxis.isInversed,h=r.chart.isTransposed,c=0,d=0,u=a=20;return l&&h?o?(c=i.regions[0].height-10,a=i.regions[0].width):(d=-10,u=i.regions[0].height):l||i.yValue<0?o?(d=-10,u=i.regions[0].height):(c=i.regions[0].height-10,a=i.regions[0].width):h?o?(c=-10,a=i.regions[0].width):(d=i.regions[0].width-10,u=i.regions[0].height):o?(d=i.regions[0].width-10,u=i.regions[0].height):(c=-10,a=i.regions[0].width),i.regions.some(function(i){return jt(e,t,new L(("Cartesian"===s.chart.chartAreaType?n.x:0)+i.x+d,("Cartesian"===s.chart.chartAreaType?n.y:0)+i.y+c,a,u))})}},{key:"getClosest",value:function(e,t,i){var n,r,a=i||e.xData;if(t>=e.xAxis.visibleRange.min&&t<=e.xAxis.visibleRange.max)for(var s=0;s<a.length;s++)r=a[s],(null==n||Math.abs(r-t)<Math.abs(n-t))&&(n=r);return-1!==e.xData.indexOf(n)?n:null}},{key:"getClosestX",value:function(e,i,n){var r,a=i.clipRect;r=e.requireInvertedAxis?function(e,t,i){return(i.isInversed?e/t:1-e/t)*i.visibleRange.delta+i.visibleRange.min}(e.mouseY-a.y,a.height,i.xAxis):function(e,t,i){return(i.isInversed?1-e/t:e/t)*i.visibleRange.delta+i.visibleRange.min}(e.mouseX-a.x,a.width,i.xAxis);var s,o=this.getClosest(i,r,n),l=t(i.points);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(o===h.xValue&&h.visible)return new Ai(h,i)}}catch(c){l.e(c)}finally{l.f()}return null}},{key:"mergeXvalues",value:function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i].xData);return t.filter(function(e,i){return i===t.indexOf(e)})}}]),e}(),$i=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},en=(Di=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),$i([Object(f.t)(!1)],Di.prototype,"visible",void 0),$i([Object(f.t)(!0)],Di.prototype,"showZero",void 0),$i([Object(f.t)(null)],Di.prototype,"name",void 0),$i([Object(f.t)("transparent")],Di.prototype,"fill",void 0),$i([Object(f.t)(1)],Di.prototype,"opacity",void 0),$i([Object(f.t)(0)],Di.prototype,"angle",void 0),$i([Object(f.t)(!1)],Di.prototype,"enableRotation",void 0),$i([Object(f.t)("Auto")],Di.prototype,"position",void 0),$i([Object(f.t)(5)],Di.prototype,"rx",void 0),$i([Object(f.t)(5)],Di.prototype,"ry",void 0),$i([Object(f.t)("Center")],Di.prototype,"alignment",void 0),$i([Object(f.g)({width:null,color:null},je)],Di.prototype,"border",void 0),$i([Object(f.g)({left:5,right:5,top:5,bottom:5},Fe)],Di.prototype,"margin",void 0),$i([Object(f.g)({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},Te)],Di.prototype,"font",void 0),$i([Object(f.t)(null)],Di.prototype,"template",void 0),$i([Object(f.t)("Hide")],Di.prototype,"labelIntersectAction",void 0),Di),tn=(ji=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),$i([Object(f.t)(!1)],ji.prototype,"visible",void 0),$i([Object(f.t)("Circle")],ji.prototype,"shape",void 0),$i([Object(f.t)("")],ji.prototype,"imageUrl",void 0),$i([Object(f.t)(5)],ji.prototype,"height",void 0),$i([Object(f.t)(5)],ji.prototype,"width",void 0),$i([Object(f.g)({width:2,color:null},je)],ji.prototype,"border",void 0),$i([Object(f.g)({x:0,y:0},De)],ji.prototype,"offset",void 0),$i([Object(f.t)(null)],ji.prototype,"fill",void 0),$i([Object(f.t)(1)],ji.prototype,"opacity",void 0),$i([Object(f.g)({},en)],ji.prototype,"dataLabel",void 0),ji),nn=function e(){a(this,e),this.symbolLocations=null,this.regions=null,this.percentage=null,this.regionData=null,this.isSelect=!1,this.marker={visible:!1},this.isPointInRange=!0},rn=(Hi=function(e){l(i,e);var t=c(i);function i(){var e;return a(this,i),(e=t.apply(this,arguments)).clipRect=new L(0,0,0,0),e}return o(i,[{key:"setDataSource",value:function(e,t){e&&(this.points=e.points),t.trendLineModule.initDataSource(this),t.visibleSeriesCount++}}]),i}(f.e),$i([Object(f.t)("")],Hi.prototype,"name",void 0),$i([Object(f.t)("0")],Hi.prototype,"dashArray",void 0),$i([Object(f.t)(!0)],Hi.prototype,"visible",void 0),$i([Object(f.t)("Linear")],Hi.prototype,"type",void 0),$i([Object(f.t)(2)],Hi.prototype,"period",void 0),$i([Object(f.t)(2)],Hi.prototype,"polynomialOrder",void 0),$i([Object(f.t)(0)],Hi.prototype,"backwardForecast",void 0),$i([Object(f.t)(0)],Hi.prototype,"forwardForecast",void 0),$i([Object(f.g)({},Ne)],Hi.prototype,"animation",void 0),$i([Object(f.g)({},tn)],Hi.prototype,"marker",void 0),$i([Object(f.t)(!0)],Hi.prototype,"enableTooltip",void 0),$i([Object(f.t)(null)],Hi.prototype,"intercept",void 0),$i([Object(f.t)("")],Hi.prototype,"fill",void 0),$i([Object(f.t)(1)],Hi.prototype,"width",void 0),$i([Object(f.t)("SeriesType")],Hi.prototype,"legendShape",void 0),Hi),an=(Bi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),$i([Object(f.t)(1)],Bi.prototype,"width",void 0),$i([Object(f.t)(10)],Bi.prototype,"length",void 0),$i([Object(f.t)(null)],Bi.prototype,"color",void 0),$i([Object(f.t)(1)],Bi.prototype,"opacity",void 0),Bi),sn=(Ni=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),$i([Object(f.t)(null)],Ni.prototype,"value",void 0),$i([Object(f.t)(null)],Ni.prototype,"color",void 0),$i([Object(f.t)("0")],Ni.prototype,"dashArray",void 0),Ni),on=(Pi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),$i([Object(f.t)(!1)],Pi.prototype,"visible",void 0),$i([Object(f.t)("Fixed")],Pi.prototype,"type",void 0),$i([Object(f.t)("Both")],Pi.prototype,"direction",void 0),$i([Object(f.t)("Vertical")],Pi.prototype,"mode",void 0),$i([Object(f.t)(null)],Pi.prototype,"color",void 0),$i([Object(f.t)(1)],Pi.prototype,"verticalError",void 0),$i([Object(f.t)(1)],Pi.prototype,"width",void 0),$i([Object(f.t)(1)],Pi.prototype,"horizontalError",void 0),$i([Object(f.t)(3)],Pi.prototype,"verticalPositiveError",void 0),$i([Object(f.t)(3)],Pi.prototype,"verticalNegativeError",void 0),$i([Object(f.t)(1)],Pi.prototype,"horizontalPositiveError",void 0),$i([Object(f.t)(1)],Pi.prototype,"horizontalNegativeError",void 0),$i([Object(f.g)(null,an)],Pi.prototype,"errorBarCap",void 0),Pi),ln=(Fi=function(i){l(r,i);var n=c(r);function r(){var e;return a(this,r),(e=n.apply(this,arguments)).currentViewData=[],e.clipRect=new L(0,0,0,0),e.seriesType="XY",e.isRectTypeSeries=!1,e}return o(r,[{key:"processJsonData",value:function(){var e,t,i,n=0,r=new nn,a=this instanceof hn&&"Histogram"===this.type?"x":this.xName,s=this instanceof hn&&this.marker.dataLabel.name?this.marker.dataLabel.name:"";this instanceof hn&&("Waterfall"!==this.type&&"Histogram"!==this.type||(this.currentViewData=this.chart[Dt(this.type)+"SeriesModule"].processInternalData(Object(f.L)([],this.currentViewData,null,!0),this)),"Pareto"===this.category&&(this.currentViewData=(e=Object(f.L)([],this.currentViewData,null,!0),t=[this.yName],(i=Object(f.L)([],e,null)).sort(function(e,i){for(var n=0,r=0,a=0;a<t.length;a++)n+=e[t[a]],r+=i[t[a]];return n>r?-1:n===r?0:1}),i),"Line"===this.type&&(this.currentViewData=this.chart.paretoSeriesModule.performCumulativeCalculation(this.currentViewData,this))),this.isRectTypeSeries=this.type.indexOf("Column")>-1||this.type.indexOf("Bar")>-1||this.type.indexOf("Histogram")>-1);var o=Object.keys(this.currentViewData).length;if(this.points=[],this.xMin=1/0,this.xMax=-1/0,this.yMin=1/0,this.yMax=-1/0,this.sizeMax=-1/0,this.getSeriesType(),"Category"===this.xAxis.valueType)for(;n<o;)r=this.dataPoint(n,s,a),this.pushCategoryData(r,n,r.x),this.pushData(r,n),this.setEmptyPoint(r,n),n++;else if(this.xAxis.valueType.indexOf("DateTime")>-1)for(var l={skeleton:"full",type:"dateTime"},h=this.chart.intl.getDateParser(l),c=this.chart.intl.getDateFormat(l);n<o;)r=this.dataPoint(n,s,a),Object(f.Z)(r.x)||""===r.x?r.visible=!1:(r.x=new Date(m.c.parse.parseJson({val:r.x}).val),"DateTime"===this.xAxis.valueType?r.xValue=Date.parse(r.x.toString()):this.pushCategoryData(r,n,this.chart.isBlazor?Date.parse(r.x.toString()).toString():Date.parse(h(c(r.x))).toString()),this.pushData(r,n),this.setEmptyPoint(r,n)),n++;else for(;n<o;)(r=this.dataPoint(n,s,a)).xValue=r.x,this.pushData(r,n),this.setEmptyPoint(r,n),n++;if(this instanceof hn)if(this.type.indexOf("Spline")>-1||this.drawType.indexOf("Spline")>-1&&"PolarRadar"===this.chart.chartAreaType){var d=this.type.indexOf("Area")>-1||this.drawType.indexOf("Area")>-1,u=this.type.indexOf("Range")>-1;this.chart["spline"+(d?u?"RangeArea":"Area":"")+"SeriesModule"].findSplinePoint(this)}else this.type.indexOf("Histogram")>-1&&(this.xAxis.maximum||this.xAxis.minimum)&&this.chart.histogramSeriesModule.calculateBinValues(this)}},{key:"pushData",value:function(e,t){e.index=t,e.yValue=e.y,this.xMin=Math.min(this.xMin,e.xValue),this.xMax=Math.max(this.xMax,e.xValue),this.xData.push(e.xValue)}},{key:"dataPoint",value:function(e,t,i){this.points[e]=new nn;var n=this.points[e],r=this.currentViewData,a=this.enableComplexProperty?f.X:this.getObjectValue;return n.x=a(i,r[e]),n.high=a(this.high,r[e]),n.low=a(this.low,r[e]),n.open=a(this.open,r[e]),n.close=a(this.close,r[e]),n.volume=a(this.volume,r[e]),n.interior=a(this.pointColorMapping,r[e]),this instanceof hn&&(n.y=a(this.yName,r[e]),n.size=a(this.size,r[e]),n.text=a(t,r[e]),n.tooltip=a(this.tooltipMappingName,r[e]),this.chart.rangeColorSettings&&this.chart.rangeColorSettings.length>0&&this.isAdvancedColorSupported()&&(n.colorValue=a(this.colorName&&this.colorName.length>0?this.colorName:this.yName,r[e]),n.interior=this.getPointFillColor(n.interior,n.colorValue))),n}},{key:"isAdvancedColorSupported",value:function(){return 1===this.chart.visibleSeries.length&&("Column"===this.chart.series[0].type||"Bar"===this.chart.series[0].type||"Scatter"===this.chart.series[0].type||"Bubble"===this.chart.series[0].type)}},{key:"getPointFillColor",value:function(e,i){var n=e;if(i&&this.chart.rangeColorSettings&&this.chart.rangeColorSettings.length>0){var r,a=t(this.chart.rangeColorSettings);try{for(a.s();!(r=a.n()).done;){var s=r.value;i>=s.start&&i<=s.end&&(n=s.colors.length>1?Li(s,i):s.colors[0])}}catch(o){a.e(o)}finally{a.f()}}return n}},{key:"getObjectValue",value:function(e,t){return t[e]}},{key:"setEmptyPoint",value:function(e,t){if(!this.findVisibility(e))return e.visible=!0,null;switch(e.isEmpty=!0,this instanceof hn&&e.isPointInRange?this.emptyPointSettings.mode:"Drop"){case"Zero":e.visible=!0,this instanceof hn&&this.seriesType.indexOf("HighLow")>-1?(e.high=e.low=0,this.seriesType.indexOf("HighLowOpenClose")>-1&&(e.open=e.close=0)):e.y=e.yValue=this.yData[t]=0;break;case"Average":this instanceof hn&&(this.seriesType.indexOf("HighLow")>-1?(e.high=Object(f.Z)(e.high)||isNaN(+e.high)?this.getAverage(this.high,t):e.high,e.low=Object(f.Z)(e.low)||isNaN(+e.low)?this.getAverage(this.low,t):e.low,this.seriesType.indexOf("HighLowOpenClose")>-1&&(e.open=Object(f.Z)(e.open)||isNaN(+e.open)?this.getAverage(this.open,t):e.open,e.close=Object(f.Z)(e.close)||isNaN(+e.close)?this.getAverage(this.close,t):e.close)):e.y=e.yValue=this.yData[t]=this.getAverage(this.yName,t)),e.visible=!0;break;case"Drop":case"Gap":this.yData[t]=null,e.visible=!1}}},{key:"findVisibility",value:function(t){var i,n=this.yAxis.minimum,r=this.yAxis.maximum;switch(this instanceof hn?this.seriesType:"HighLowOpenClose"){case"XY":return"PolarRadar"===this.chart.chartAreaType&&(!Object(f.Z)(n)&&t.yValue<n||!Object(f.Z)(r)&&t.yValue>r)?(t.isPointInRange=!1,!0):(this.setXYMinMax(t.yValue),this.yData.push(t.yValue),this instanceof hn&&"Bubble"===this.type&&(this.sizeMax=Math.max(this.sizeMax,Object(f.Z)(t.size)||isNaN(+t.size)?this.sizeMax:t.size)),Object(f.Z)(t.x)||Object(f.Z)(t.y)||isNaN(+t.y));case"HighLow":return this.setHiloMinMax(t.high,t.low),Object(f.Z)(t.x)||Object(f.Z)(t.low)||isNaN(+t.low)||Object(f.Z)(t.high)||isNaN(+t.high);case"HighLowOpenClose":return this.setHiloMinMax(t.high,t.low),Object(f.Z)(t.x)||Object(f.Z)(t.low)||isNaN(+t.low)||Object(f.Z)(t.open)||isNaN(+t.open)||Object(f.Z)(t.close)||isNaN(+t.close)||Object(f.Z)(t.high)||isNaN(+t.high);case"BoxPlot":return i=(t.y||[null]).filter(function(e){return!Object(f.Z)(e)&&!isNaN(e)}).sort(function(e,t){return e-t}),t.y=i,this.yMin=Math.min(this.yMin,Math.min.apply(Math,e(i))),this.yMax=Math.max(this.yMax,Math.max.apply(Math,e(i))),!i.length}}},{key:"setXYMinMax",value:function(e){var t,i="Logarithmic"===this.yAxis.valueType||"Logarithmic"===this.xAxis.valueType,n=e<0;t=this.isRectTypeSeries&&!zt(this.yAxis)?i||n?e:0:e,this.yMin=i?Math.min(this.yMin,Object(f.Z)(t)||isNaN(t)||0===t?this.yMin:t):Math.min(this.yMin,Object(f.Z)(t)||isNaN(t)?this.yMin:t),this.yMax=Math.max(this.yMax,Object(f.Z)(e)||isNaN(e)?this.yMax:e)}},{key:"setHiloMinMax",value:function(e,t){this.yMin=Math.min(this.yMin,Math.min(Object(f.Z)(t)||isNaN(t)?this.yMin:t,Object(f.Z)(e)||isNaN(e)?this.yMin:e)),this.yMax=Math.max(this.yMax,Math.max(Object(f.Z)(t)||isNaN(t)?this.yMax:t,Object(f.Z)(e)||isNaN(e)?this.yMax:e))}},{key:"getSeriesType",value:function(){var e;if(this instanceof hn){var t="PolarRadar"===this.chart.chartAreaType?this.drawType:this.type;if(t)switch(t){case"RangeColumn":case"RangeArea":case"SplineRangeArea":case"Hilo":e="HighLow";break;case"HiloOpenClose":case"Candle":e="HighLowOpenClose";break;case"BoxAndWhisker":e="BoxPlot";break;default:e="XY"}}this.seriesType=e}},{key:"pushCategoryData",value:function(e,t,i){if(!this.chart.tooltip.shared&&!this.visible)return null;this.xAxis.isIndexed?(this.xAxis.labels[t]?this.xAxis.labels[t]+=", "+i:this.xAxis.labels.push(i),e.xValue=t):(this.xAxis.labels.indexOf(i)<0&&this.xAxis.labels.push(i),e.xValue=this.xAxis.labels.indexOf(i))}},{key:"getAverage",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentViewData;return((i[t-1]&&i[t-1][e]||0)+(i[t+1]&&i[t+1][e]||0))/2}},{key:"refreshDataManager",value:function(e){var t,i=this;this.chart=e,(t=e.isAngular?Object.keys(this.dataSource).length?this.dataSource:e.dataSource:this.dataSource||e.dataSource)instanceof m.b||!Object(f.Z)(this.query)?this.dataModule.getData(this.dataModule.generateQuery().requiresCount()).then(function(e){return i.dataManagerSuccess(e)}):this.dataManagerSuccess({result:t,count:t.length},!1)}},{key:"dataManagerSuccess",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentViewData=e.count?e.result:[],this.chart.allowServerDataBinding=!1,this instanceof hn){this.chart.stockChart&&(this.chart.stockChart.series[this.index].localData=this.currentViewData);var i={name:"seriesRender",series:this,data:this.currentViewData,fill:this.interior};this.chart.trigger("seriesRender",i),this.interior=i.fill,this.currentViewData=i.data}!this.chart.stockChart||this instanceof hn||(this.currentViewData=this.chart.stockChart.findCurrentData(this.chart.stockChart.series[0].localData,this.chart.stockChart.series[0].xName)),this.processJsonData(),this.recordsCount=e.count,this.refreshChart(t),this.currentViewData=null}},{key:"refreshChart",value:function(e){var i=this.chart;if(this instanceof hn&&(i.visibleSeriesCount+=e?1:0),i.refreshTechnicalIndicator(this),this instanceof hn&&"TrendLine"!==this.category){var n,r=t(this.trendlines);try{for(r.s();!(n=r.n()).done;)n.value.setDataSource(this,i)}catch(a){r.e(a)}finally{r.f()}}i.visibleSeries.length===i.visibleSeriesCount&&(i.refreshBound(),i.trigger("loaded",{chart:i.isBlazor?{}:i}),this.chart.stockChart&&this.chart.stockChart.initialRender&&(this.chart.stockChart.initialRender=!1,this.chart.stockChart.stockChartDataManagerSuccess())),this instanceof hn&&(i.visibleSeriesCount+=e?0:1)}}]),r}(f.e),$i([Object(f.t)("")],Fi.prototype,"xName",void 0),$i([Object(f.t)("")],Fi.prototype,"colorName",void 0),$i([Object(f.t)("")],Fi.prototype,"high",void 0),$i([Object(f.t)("")],Fi.prototype,"low",void 0),$i([Object(f.t)("")],Fi.prototype,"open",void 0),$i([Object(f.t)("")],Fi.prototype,"close",void 0),$i([Object(f.t)("")],Fi.prototype,"volume",void 0),$i([Object(f.t)("")],Fi.prototype,"pointColorMapping",void 0),$i([Object(f.t)(!0)],Fi.prototype,"visible",void 0),$i([Object(f.t)(null)],Fi.prototype,"xAxisName",void 0),$i([Object(f.t)(null)],Fi.prototype,"yAxisName",void 0),$i([Object(f.g)(null,Ne)],Fi.prototype,"animation",void 0),$i([Object(f.t)(null)],Fi.prototype,"fill",void 0),$i([Object(f.t)(1)],Fi.prototype,"width",void 0),$i([Object(f.t)("0")],Fi.prototype,"dashArray",void 0),$i([Object(f.t)("")],Fi.prototype,"dataSource",void 0),$i([Object(f.t)()],Fi.prototype,"query",void 0),$i([Object(f.f)([],sn)],Fi.prototype,"segments",void 0),$i([Object(f.t)("X")],Fi.prototype,"segmentAxis",void 0),$i([Object(f.t)(!1)],Fi.prototype,"enableComplexProperty",void 0),Fi),hn=(Mi=function(e){l(n,e);var i=c(n);function n(e,t,r,s){var o;return a(this,n),(o=i.call(this,e,t,r,s)).visibleSeriesCount=0,o.category="Series",o.isRectSeries=!1,o.drawPoints=[],o.lowDrawPoints=[],o.delayedAnimation=!1,o}return o(n,[{key:"refreshAxisLabel",value:function(){if("Category"!==this.xAxis.valueType)return null;this.xAxis.labels=[];var e,i=t(this.xAxis.series);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.visible&&"TrendLine"!==n.category){n.xMin=1/0,n.xMax=-1/0;var r,a=t(n.points);try{for(a.s();!(r=a.n()).done;){var s=r.value;n.pushCategoryData(s,s.index,s.x),n.xMin=Math.min(n.xMin,s.xValue),n.xMax=Math.max(n.xMax,s.xValue)}}catch(o){a.e(o)}finally{a.f()}}}}catch(o){i.e(o)}finally{i.f()}}},{key:"findSeriesCollection",value:function(e,i,n){var r,a=[],s=t(i.axes);try{for(s.s();!(r=s.n()).done;){var o,l=t(r.value.series);try{for(l.s();!(o=l.n()).done;){var h,c=o.value,d=t(e.axes);try{for(d.s();!(h=d.n()).done;){var u,p=t(h.value.series);try{for(p.s();!(u=p.n()).done;){var g=u.value;g===c&&g.visible&&this.rectSeriesInChart(g,n)&&a.push(g)}}catch(f){p.e(f)}finally{p.f()}}}catch(f){d.e(f)}finally{d.f()}}}catch(f){l.e(f)}finally{l.f()}}}catch(f){s.e(f)}finally{s.f()}return a}},{key:"rectSeriesInChart",value:function(e,t){var i=e.type.toLowerCase();return-1!==i.indexOf("column")||-1!==i.indexOf("bar")||-1!==i.indexOf("histogram")||-1!==i.indexOf("hiloopenclose")||-1!==i.indexOf("candle")||-1!==i.indexOf("pareto")||-1!==i.indexOf("hilo")||-1!==e.drawType.indexOf("Column")||-1!==i.indexOf("waterfall")||-1!==i.indexOf("boxandwhisker")||t}},{key:"calculateStackedValue",value:function(e,i){var n,r=t(i.columns);try{for(r.s();!(n=r.n()).done;){var a,s=n.value,o=t(i.rows);try{for(o.s();!(a=o.n()).done;){var l=a.value;this.calculateStackingValues(this.findSeriesCollection(s,l,!0),e)}}catch(h){o.e(h)}finally{o.f()}}}catch(h){r.e(h)}finally{r.f()}}},{key:"calculateStackingValues",value:function(e,i){var n,r,a,s,o,l=[],h=[],c=[],d=[];i&&(d=this.findFrequencies(e));var u,p=[],g=[],f=[],m=t(e);try{for(m.s();!(u=m.n()).done;){var v=u.value;if(-1!==v.type.indexOf("Stacking")||-1!==v.drawType.indexOf("Stacking")&&"PolarRadar"===v.chart.chartAreaType){h[a=-1!==v.type.indexOf("StackingArea")?"StackingArea100":-1!==v.type.indexOf("StackingLine")?"StackingLine100":v.stackingGroup]||(h[a]=[],c[a]=[]),l=v.yData,n=[],r=[],p.push(v),f=gt(v);for(var y=0,b=f.length;y<b;y++)s=0,o=+l[y],void 0===h[a][f[y].xValue]&&(h[a][f[y].xValue]=0),void 0===c[a][f[y].xValue]&&(c[a][f[y].xValue]=0),i?(o=o/d[a][f[y].xValue]*100,o=isNaN(o)?0:o,f[y].percentage=+o.toFixed(2)):g[y]=g[y]?g[y]+Math.abs(o):Math.abs(o),o>=0?(s=h[a][f[y].xValue],h[a][f[y].xValue]+=o):(s=c[a][f[y].xValue],c[a][f[y].xValue]+=o),n.push(s),r.push(o+s),i&&r[y]>100&&(r[y]=100);v.stackedValues=new xi(n,r);var C="Logarithmic"===v.yAxis.valueType,x=-1!==v.type.indexOf("Column")||-1!==v.type.indexOf("Bar");v.yMin=C&&x&&v.yMin<1?v.yMin:Math.min.apply(0,n),v.yMax=Math.max.apply(0,r),v.yMin>Math.min.apply(0,r)&&(v.yMin=i?-100:C&&x&&v.yMin<1?v.yMin:Math.min.apply(0,r)),v.yMax<Math.max.apply(0,n)&&(v.yMax=0)}}}catch(S){m.e(S)}finally{m.f()}this.findPercentageOfStacking(p,g,i)}},{key:"findPercentageOfStacking",value:function(e,i,n){var r,a=t(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(n)return null;var o,l=t(gt(s));try{for(l.s();!(o=l.n()).done;){var h=o.value;h.percentage=Math.abs(+(h.y/i[h.index]*100).toFixed(2))}}catch(c){l.e(c)}finally{l.f()}}}catch(c){a.e(c)}finally{a.f()}}},{key:"findFrequencies",value:function(e){var i,n,r=[],a=[],s=t(e);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(o.yAxis.isStack100=-1!==o.type.indexOf("100"),a=gt(o),-1!==o.type.indexOf("Stacking")){r[i=-1!==o.type.indexOf("StackingArea")?"StackingArea100":-1!==o.type.indexOf("StackingLine")?"StackingLine100":o.stackingGroup]||(r[i]=[]);for(var l=0,h=a.length;l<h;l++)void 0===r[i][a[l].xValue]&&(r[i][a[l].xValue]=0),o.yData[l]>0?r[i][a[l].xValue]+=o.yData[l]:r[i][a[l].xValue]-=o.yData[l]}}}catch(c){s.e(c)}finally{s.f()}return r}},{key:"renderSeries",value:function(e){var t=Dt(this.type);e[(t=t.replace("100",""))+"SeriesModule"]&&("Indicator"!==this.category&&"TrendLine"!==this.category&&this.createSeriesElements(e),this.visiblePoints=gt(this),e[t+"SeriesModule"].render(this,this.xAxis,this.yAxis,e.requireInvertedAxis),"Indicator"!==this.category&&(this.errorBar.visible&&this.chart.errorBarModule.render(this),this.marker.dataLabel.visible&&e.dataLabelModule.render(this,this.chart,this.marker.dataLabel),this.appendSeriesElement(e.seriesElements,e)),this.chart.enableCanvas||this.performAnimation(e,t,this.errorBar,this.marker,this.marker.dataLabel))}},{key:"createSeriesElements",value:function(e){if("Indicator"!==this.category){var t,i,n,r=e.element.id,a=this.marker.border.width+8+5,s="Scatter"===this.type||"Bubble"===this.type?e.svgRenderer:e.renderer,o=void 0===this.index?this.category:this.index;if("Scatter"===this.type?(t=e.primaryYAxis.maximum||e.primaryXAxis.maximum?0:(this.marker.height+a)/2,i=e.primaryYAxis.maximum||e.primaryXAxis.maximum?0:(this.marker.width+a)/2):(t=0,i=0),"PolarRadar"===e.chartAreaType){var l="Scatter"===this.drawType?Math.max(this.marker.width,this.marker.height):0;n=new ki(r+"_ChartSeriesClipRect_"+o,"transparent",{width:1,color:"Gray"},1,this.clipRect.width/2+this.clipRect.x,this.clipRect.height/2+this.clipRect.y,e.radius+l),this.clipRectElement=Ht(e.redraw,n,s,"drawCircularClipPath")}else n=new Si(r+"_ChartSeriesClipRect_"+o,"transparent",{width:1,color:"Gray"},1,{x:-i,y:-t,width:this.clipRect.width+2*i,height:this.clipRect.height+2*t}),this.clipRectElement=Ht(e.redraw,n,s);var h="Cartesian"===e.chartAreaType?"translate("+this.clipRect.x+","+this.clipRect.y+")":"";this.symbolElement=null,this.seriesElement=s.createGroup({id:r+"SeriesGroup"+o,transform:h,"clip-path":"url(#"+r+"_ChartSeriesClipRect_"+o+")"}),this.chart.enableCanvas&&"Scatter"!==this.type&&"Bubble"!==this.type||this.seriesElement.appendChild(this.clipRectElement)}}},{key:"appendSeriesElement",value:function(e,t){var i=this.marker,n=i.dataLabel,r=t.redraw;"TrendLine"!==this.category&&($t(t.enableCanvas,t.seriesElements,this.seriesElement,r),this.errorBar.visible&&$t(t.enableCanvas,t.seriesElements,"PolarRadar"===t.chartAreaType?this.seriesElement:this.errorBarElement,r),"Scatter"!==this.type&&"Bubble"!==this.type||$t(!1,t.seriesElements,this.seriesElement,r)),i.visible&&("Cartesian"===t.chartAreaType||"Scatter"!==this.drawType&&"PolarRadar"===t.chartAreaType)&&"Scatter"!==this.type&&"Bubble"!==this.type&&"Candle"!==this.type&&"Hilo"!==this.type&&"HiloOpenClose"!==this.type&&this.symbolElement&&$t(t.enableCanvas,t.seriesElements,this.symbolElement,r),n.visible&&this.textElement&&($t(t.enableCanvas,t.dataLabelElements,this.shapeElement,r),$t(t.enableCanvas,t.dataLabelElements,this.textElement,r)),!t.enableCanvas&&t.dataLabelElements.hasChildNodes()&&t.seriesElements.appendChild(t.dataLabelElements)}},{key:"performAnimation",value:function(e,t,i,n,r){this.animation.enable&&e.animateSeries&&(e[t+"SeriesModule"].doAnimation(this),i.visible&&e.errorBarModule.doErrorBarAnimation(this),n.visible&&e.markerRender.doMarkerAnimation(this),r.visible&&"edge"!==f.d.info.name&&!f.d.isIE&&e.dataLabelModule.doDataLabelAnimation(this))}},{key:"setPointColor",value:function(e,t){return t=e.interior||t,e.isEmpty&&this.emptyPointSettings.fill||t}},{key:"setBorderColor",value:function(e,t){return t.width=e.isEmpty&&this.emptyPointSettings.border.width||t.width,t.color=e.isEmpty&&this.emptyPointSettings.border.color||t.color,t}}]),n}(ln),$i([Object(f.t)("")],Mi.prototype,"name",void 0),$i([Object(f.t)("")],Mi.prototype,"yName",void 0),$i([Object(f.t)("Line")],Mi.prototype,"drawType",void 0),$i([Object(f.t)(!0)],Mi.prototype,"isClosed",void 0),$i([Object(f.t)("#2ecd71")],Mi.prototype,"bearFillColor",void 0),$i([Object(f.t)("#e74c3d")],Mi.prototype,"bullFillColor",void 0),$i([Object(f.t)(!1)],Mi.prototype,"enableSolidCandles",void 0),$i([Object(f.t)("")],Mi.prototype,"size",void 0),$i([Object(f.t)(null)],Mi.prototype,"binInterval",void 0),$i([Object(f.t)(!1)],Mi.prototype,"showNormalDistribution",void 0),$i([Object(f.t)("")],Mi.prototype,"stackingGroup",void 0),$i([Object(f.g)({color:"transparent",width:0},je)],Mi.prototype,"border",void 0),$i([Object(f.t)(1)],Mi.prototype,"opacity",void 0),$i([Object(f.t)(0)],Mi.prototype,"zOrder",void 0),$i([Object(f.t)("Line")],Mi.prototype,"type",void 0),$i([Object(f.g)(null,on)],Mi.prototype,"errorBar",void 0),$i([Object(f.g)(null,tn)],Mi.prototype,"marker",void 0),$i([Object(f.g)({},Ve)],Mi.prototype,"dragSettings",void 0),$i([Object(f.f)([],rn)],Mi.prototype,"trendlines",void 0),$i([Object(f.t)(!0)],Mi.prototype,"enableTooltip",void 0),$i([Object(f.t)("")],Mi.prototype,"tooltipFormat",void 0),$i([Object(f.t)("")],Mi.prototype,"tooltipMappingName",void 0),$i([Object(f.t)("SeriesType")],Mi.prototype,"legendShape",void 0),$i([Object(f.t)("")],Mi.prototype,"legendImageUrl",void 0),$i([Object(f.t)(null)],Mi.prototype,"selectionStyle",void 0),$i([Object(f.t)(null)],Mi.prototype,"unSelectedStyle",void 0),$i([Object(f.t)(null)],Mi.prototype,"nonHighlightStyle",void 0),$i([Object(f.t)(1)],Mi.prototype,"minRadius",void 0),$i([Object(f.t)(3)],Mi.prototype,"maxRadius",void 0),$i([Object(f.t)("Natural")],Mi.prototype,"splineType",void 0),$i([Object(f.t)(.5)],Mi.prototype,"cardinalSplineTension",void 0),$i([Object(f.g)(null,ze)],Mi.prototype,"emptyPointSettings",void 0),$i([Object(f.t)(!0)],Mi.prototype,"showMean",void 0),$i([Object(f.t)("Normal")],Mi.prototype,"boxPlotMode",void 0),$i([Object(f.t)(null)],Mi.prototype,"columnWidth",void 0),$i([Object(f.t)(0)],Mi.prototype,"columnSpacing",void 0),$i([Object(f.t)("#C64E4A")],Mi.prototype,"negativeFillColor",void 0),$i([Object(f.t)("#4E81BC")],Mi.prototype,"summaryFillColor",void 0),$i([Object(f.t)()],Mi.prototype,"intermediateSumIndexes",void 0),$i([Object(f.t)()],Mi.prototype,"sumIndexes",void 0),$i([Object(f.g)({color:"black",width:2},Le)],Mi.prototype,"connector",void 0),$i([Object(f.g)(null,He)],Mi.prototype,"cornerRadius",void 0),Mi),cn=function(){function e(t,i){a(this,e),this.initDataManager(t,i)}return o(e,[{key:"initDataManager",value:function(e,t){this.dataManager=e instanceof m.b?e:new m.b(e),this.query=t instanceof m.h?t:new m.h}},{key:"generateQuery",value:function(){return this.query.clone()}},{key:"getData",value:function(e){var t=this;if(this.dataManager.ready){var i=new m.d;return this.dataManager.ready.then(function(){t.dataManager.executeQuery(e).then(function(e){i.resolve(e)})}).catch(function(e){i.reject(e)}),i.promise}return this.dataManager.executeQuery(e)}}]),e}(),dn=function(e){l(n,e);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).addEventListener(),t}return o(n,[{key:"render",value:function(e){var i=this,n=e.chart.redraw;this.createElement(e,n);var r,a=t(e.points);try{var s=function(){var t=r.value;t.visible&&t.symbolLocations&&t.symbolLocations.length&&t.symbolLocations.map(function(r,a){"None"!==e.marker.shape&&i.renderMarker(e,t,r,a,n)})};for(a.s();!(r=a.n()).done;)s()}catch(o){a.e(o)}finally{a.f()}}},{key:"renderMarker",value:function(e,t,i,n,r){var a,s,o,l,h=void 0===e.index?e.category:e.index,c=e.marker,d={color:c.border.color,width:c.border.width},u=c.border.color;i.x=i.x+c.offset.x,i.y=i.y-c.offset.y;var p,g="BoxAndWhisker"===e.type,m=c.fill||(g?t.interior||e.interior:"#ffffff"),v=g?function(e,t){for(var i,n=0,r=e.length;n<r;n++)e[n].id.indexOf(t)>-1&&(i=e[n]);return i}(e.seriesElement.childNodes,"Series_"+e.index+"_Point_"+t.index):e.symbolElement;d.color=u||e.setPointColor(t,e.interior);var y=this.elementId+"_Series_"+h+"_Point_"+t.index+"_Symbol"+(n||""),b={cancel:!1,name:"pointRender",series:e,point:t,fill:t.isEmpty&&e.emptyPointSettings.fill||m,border:{color:"BoxAndWhisker"===e.type?Object(f.Z)(u)||"transparent"===u?hi(m,-.6):u:d.color,width:d.width},height:c.height,width:c.width,shape:c.shape};if(b.border=e.setBorderColor(t,{width:b.border.width,color:b.border.color}),e.isRectSeries&&"BoxAndWhisker"!==e.type||(this.chart.trigger("pointRender",b),t.color=b.fill),t.color=b.fill,b.cancel)i=null,t.marker={visible:!1};else{var C;C="RangeArea"===e.type||"RangeColumn"===e.type||"RangeColumn"===e.drawType||"SplineRangeArea"===e.type?n?t.low:t.high:g?t.outliers[n]:t.y;var x,S=b.point.marker.fill||b.fill;x=Object(f.Z)(b.point.marker.border)?{color:b.border.color,width:b.border.width}:{color:b.point.marker.border.color||b.border.color,width:b.point.marker.border.width||b.border.width};var w=b.point.marker.width||b.width,k=b.point.marker.height||b.height,I=b.point.marker.shape||b.shape,O=b.point.marker.imageUrl||c.imageUrl;l=new U(y,S,x.width,x.color,b.point.marker.opacity||c.opacity,null),(null!=v||this.chart.enableCanvas)&&(r&&Zt(l.id)&&(o="Circle"===I?"c":"",a={x:+(p=Zt(l.id)).getAttribute(o+"x"),y:+p.getAttribute(o+"y")},s=p.getAttribute("d")),p=Wt(i,I,new E(w,k),O,l,(t.x.toString(),C.toString()),this.chart.renderer,e.clipRect),$t(this.chart.enableCanvas,v,p,r,!0,o+"x",o+"y",a,s,!1,!1,null,e.chart.duration)),t.marker={border:x,fill:S,height:k,visible:!0,shape:I,width:w,imageUrl:O}}}},{key:"createElement",value:function(e,t){var i,n,r=e.marker,a=r.border.width+8+5,s=e.chart.svgRenderer,o=void 0===e.index?e.category:e.index,l="Cartesian"===e.chart.chartAreaType?"translate("+e.clipRect.x+","+e.clipRect.y+")":"";if(r.visible){var h=(r.height+a)/2,c=(r.width+a)/2;"Cartesian"===e.chart.chartAreaType?i=Ht(t,n=new Si(this.elementId+"_ChartMarkerClipRect_"+o,"transparent",{width:1,color:"Gray"},1,{x:-c,y:-h,width:e.clipRect.width+2*c,height:e.clipRect.height+2*h}),s):i=Ht(t,n=new ki(this.elementId+"_ChartMarkerClipRect_"+o,"transparent",{width:1,color:"Gray"},1,e.clipRect.width/2+e.clipRect.x,e.clipRect.height/2+e.clipRect.y,e.chart.radius+Math.max(h,c)),s,"drawCircularClipPath"),n={id:this.elementId+"SymbolGroup"+o,transform:l,"clip-path":"url(#"+this.elementId+"_ChartMarkerClipRect_"+o+")"},e.symbolElement=s.createGroup(n),e.symbolElement.appendChild(i),this.chart.enableCanvas&&document.getElementById(this.chart.element.id+"_tooltip_svg").appendChild(e.symbolElement)}}},{key:"getRangeLowPoint",value:function(e,t){var i=e.x,n=e.y;return t.chart.requireInvertedAxis?(n+=e.height/2,i+=t.yAxis.isInversed?e.width:0):(n+=t.yAxis.isInversed?0:e.height,i+=e.width/2),{x:i,y:n}}},{key:"doMarkerAnimation",value:function(e){if("Scatter"!==e.type&&"Bubble"!==e.type&&"Candle"!==e.type&&"Hilo"!==e.type&&"HiloOpenClose"!==e.type&&("PolarRadar"!==e.chart.chartAreaType||"Scatter"!==e.drawType))for(var t=e.symbolElement.childNodes,i=e.animation.delay+e.animation.duration,n=e.chart.animated?e.chart.duration:200,r=1,a="RangeArea"===e.type||"RangeColumn"===e.type||"SplineRangeArea"===e.type?2:1,s=0;s<e.points.length;s++)if(e.points[s].symbolLocations){if(!e.points[s].symbolLocations.length||!t[r])continue;if(Nt(t[r],i,n,e,s,e.points[s].symbolLocations[0],!1),2===a){var o=this.getRangeLowPoint(e.points[s].regions[0],e);Nt(t[r+1],i,n,e,s,o,!1)}r+=a}}}]),n}(function(e){l(n,e);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).elementId=e.element.id,t}return o(n,[{key:"addEventListener",value:function(){this.chart.isDestroyed||(this.chart.on(f.d.touchMoveEvent,this.mouseMoveHandler,this),this.chart.on(f.d.touchEndEvent,this.mouseUpHandler,this))}},{key:"removeEventListener",value:function(){this.chart.isDestroyed||(this.chart.off(f.d.touchMoveEvent,this.mouseMoveHandler),this.chart.off(f.d.touchEndEvent,this.mouseUpHandler))}},{key:"mouseUpHandler",value:function(){var e=this.chart;!e.isTouch||e.crosshair.enable||this.isSelected(e)||this.markerMove(!0)}},{key:"mouseMoveHandler",value:function(){var e=this.chart;e.crosshair.enable&&!e.tooltip.enable||e.isTouch&&!e.startMove||this.isSelected(e)||this.markerMove(!1)}},{key:"markerMove",value:function(e){var i,n,r,a,s=this,o=this.chart;if(this.currentPoints=[],o.tooltip.shared&&o.tooltip.enable){if(!jt(o.mouseX,o.mouseY,o.chartAxisLayoutPanel.seriesClipRect))return null;if(o.tooltip.enable){var l,h="PolarRadar"===o.chartAreaType?this.getData():null,c=this.mergeXvalues(this.chart.visibleSeries),d=t(o.visibleSeries);try{for(d.s();!(l=d.n()).done;){var u=l.value;u.enableTooltip&&"Indicator"!==u.category&&("Cartesian"===o.chartAreaType&&u.visible?i=this.getClosestX(o,u,c):"PolarRadar"===o.chartAreaType&&u.visible&&null!==h.point&&(i=new Ai(u.points[h.point.index],u)),i&&(this.currentPoints.push(i),i=null))}}catch(y){d.e(y)}finally{d.f()}}}else i=this.getData(),a=i.series,n=this.previousPoints[0],r=a&&("Bubble"===a.type||"Scatter"===a.drawType||"Scatter"===a.type||"Candle"!==a.type&&"Hilo"!==a.type&&"HiloOpenClose"!==a.type&&a.marker.visible&&0!==a.marker.width&&0!==a.marker.height),i.lierIndex=this.lierIndex,i.point&&r&&(!n||n.point!==i.point||n&&n.lierIndex>3&&n.lierIndex!==this.lierIndex)&&this.currentPoints.push(i),i.point&&r&&o.isPointMouseDown&&this.currentPoints.push(i);var p=this.previousPoints.length;if(this.currentPoints.length>0&&(0===p||o.isPointMouseDown||p>0&&this.previousPoints[0].point!==this.currentPoints[0].point)){this.previousPoints.length>0&&this.removeHighlightedMarker();var g,m=t(this.currentPoints);try{var v=function(){var e=g.value;(e&&e.point||"Candle"!==a.type&&"Hilo"!==a.type&&"HiloOpenClose"!==a.type)&&(ti(s.markerExplode),s.isRemove=!0,e.point.symbolLocations.map(function(t,i){e.series.isRectSeries&&!e.point.marker.visible||s.drawTrackBall(e.series,e.point,t,i)}))};for(m.s();!(g=m.n()).done;)v()}catch(y){m.e(y)}finally{m.f()}this.previousPoints=Object(f.L)([],this.currentPoints,null,!0)}o.tooltip.enable||!(0===this.currentPoints.length&&this.isRemove||e&&this.isRemove)&&jt(o.mouseX,o.mouseY,o.chartAxisLayoutPanel.seriesClipRect)||(this.isRemove=!1,this.markerExplode=+setTimeout(function(){s.removeHighlightedMarker()},2e3)),this.currentPoints=[]}},{key:"drawTrackBall",value:function(e,t,i,n){var r=t.marker,a=e.marker,s=r.shape||a.shape;if("None"===s)return null;var o,l=e.symbolElement||e.seriesElement;this.chart.highlightModule&&"None"!==this.chart.highlightMode&&(o=this.chart.highlightModule.generateStyle(e)),this.chart.selectionModule&&"None"!==this.chart.selectionMode&&(o=this.chart.selectionModule.generateStyle(e));for(var h=this.elementId+"_Series_"+e.index+"_Point_"+t.index+"_Trackball"+(n||""),c=new E((r.width||a.width)+5,(r.height||a.height)+5),d=r.border||e.border,u="BoxAndWhisker"===e.type||"Bubble"===e.type||"Scatter"===e.type,p=d.color&&"transparent"!==d.color?d.color:r.fill||t.interior||(u?t.color:e.interior),g=oi(li(p)),m=r.border?r.border.width:a.border.width,v=e.chart.themeStyle.markerShadow||"rgba("+g.r+","+g.g+","+g.b+",0.2)",y=0;y<2;y++){var b=new U(h+"_"+y,y?r.fill||t.color||(u?e.interior:"#ffffff"):"transparent",m+(y?0:8),y?p:v,r.opacity||a.opacity,null,null),C=Wt(i,s,c,r.imageUrl,b,0,this.chart.svgRenderer,e.clipRect);C.setAttribute("class","EJ2-Trackball");var x=-1!==l.id.indexOf("Symbol")?"_Symbol":"",S=document.getElementById(this.elementId+"_Series_"+e.index+"_Point_"+t.index+x);""===o||Object(f.Z)(o)||Object(f.Z)(S)||!S.hasAttribute("class")||o!==S.getAttribute("class")||C.classList.add(o),C.setAttribute("clip-path",l.getAttribute("clip-path")),C.setAttribute("transform",l.getAttribute("transform")),this.chart.svgObject.appendChild(C)}}},{key:"removeHighlightedMarker",value:function(){for(var e=document.getElementsByClassName("EJ2-Trackball"),t=0,i=e.length;t<i;t++)Object(f.kb)(e[0]);this.previousPoints=[]}}]),n}(Qi)),un=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},pn=(zi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),un([Object(f.t)(0)],zi.prototype,"x",void 0),un([Object(f.t)(0)],zi.prototype,"y",void 0),zi),gn=(_i=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),un([Object(f.t)(!0)],_i.prototype,"visible",void 0),un([Object(f.t)(null)],_i.prototype,"height",void 0),un([Object(f.t)(null)],_i.prototype,"width",void 0),un([Object(f.g)({x:0,y:0},pn)],_i.prototype,"location",void 0),un([Object(f.t)("Auto")],_i.prototype,"position",void 0),un([Object(f.t)("Series")],_i.prototype,"mode",void 0),un([Object(f.t)(8)],_i.prototype,"padding",void 0),un([Object(f.t)("Center")],_i.prototype,"alignment",void 0),un([Object(f.g)(V.legendLabelFont,Te)],_i.prototype,"textStyle",void 0),un([Object(f.t)(10)],_i.prototype,"shapeHeight",void 0),un([Object(f.t)(10)],_i.prototype,"shapeWidth",void 0),un([Object(f.g)({},je)],_i.prototype,"border",void 0),un([Object(f.g)({left:0,right:0,top:0,bottom:0},Fe)],_i.prototype,"margin",void 0),un([Object(f.g)({left:0,right:0,top:0,bottom:0},Pe)],_i.prototype,"containerPadding",void 0),un([Object(f.t)(5)],_i.prototype,"shapePadding",void 0),un([Object(f.t)("transparent")],_i.prototype,"background",void 0),un([Object(f.t)(1)],_i.prototype,"opacity",void 0),un([Object(f.t)(!0)],_i.prototype,"toggleVisibility",void 0),un([Object(f.t)(null)],_i.prototype,"description",void 0),un([Object(f.t)(3)],_i.prototype,"tabIndex",void 0),un([Object(f.t)(null)],_i.prototype,"title",void 0),un([Object(f.g)(V.legendTitleFont,Te)],_i.prototype,"titleStyle",void 0),un([Object(f.t)("Top")],_i.prototype,"titlePosition",void 0),un([Object(f.t)(100)],_i.prototype,"maximumTitleWidth",void 0),un([Object(f.t)(!0)],_i.prototype,"enablePages",void 0),un([Object(f.t)(!1)],_i.prototype,"isInversed",void 0),_i),fn=function(){function e(t){a(this,e),this.pageXCollections=[],this.legendTitleCollections=[],this.legendRegions=[],this.pagingRegions=[],this.chart=t,this.legend=t.legendSettings,this.legendID=t.element.id+"_chart_legend",this.isChartControl="chart"===t.getModuleName(),this.isBulletChartControl="bulletChart"===t.getModuleName(),this.isStockChartControl="stockChart"===t.getModuleName(),this.bulletChart=this.chart,this.fivePixel=5,this.rowCount=0,this.pageButtonSize=8,this.maxColumns=0,this.maxWidth=0,this.currentPage=1,this.backwardArrowOpacity=0,this.forwardArrowOpacity=1,this.arrowWidth=2*(this.fivePixel+this.pageButtonSize+this.fivePixel),this.arrowHeight=this.arrowWidth,this.isTop=!1,this.isTitle=!1,this.currentPageNumber=1}return o(e,[{key:"calculateLegendBounds",value:function(e,t,i){var n=this.legend,r=this.isBulletChartControl?"40%":"20%";this.getPosition(n.position,t),this.legendBounds=new L(e.x,e.y,0,0),this.isVertical="Left"===this.position||"Right"===this.position,this.isVertical?(this.legendBounds.height=di(n.height,t.height-(e.y-this.chart.margin.top))||e.height,this.legendBounds.width=di(n.width||r,t.width)):(this.legendBounds.width=di(n.width,t.width)||e.width,this.legendBounds.height=di(n.height||r,t.height)),this.library.getLegendBounds(t,this.legendBounds,n),this.isBulletChartControl||(this.legendBounds.width+=this.legend.containerPadding.left+this.legend.containerPadding.right,this.legendBounds.height+=this.legend.containerPadding.top+this.legend.containerPadding.bottom),this.getLocation(this.position,n.alignment,this.legendBounds,e,t,i)}},{key:"getPosition",value:function(e,t){var i=this.chart,n=this.chart;this.isChartControl||this.isBulletChartControl||this.isStockChartControl?this.position="Auto"!==e?e:"Bottom":("Auto"===e&&((i||n).visibleSeries&&"Funnel"===(i||n).visibleSeries[0].type||"Pyramid"===(i||n).visibleSeries[0].type)&&(e="Top"),this.position="Auto"!==e?e:t.width>t.height?"Right":"Bottom")}},{key:"setBounds",value:function(e,t,i,n){var r=i.title&&"Top"===i.titlePosition?this.legendTitleSize.height+this.fivePixel:0;this.isVertical&&this.isPaging&&!i.enablePages&&!this.isBulletChartControl&&(r=i.title&&"Top"===i.titlePosition?this.legendTitleSize.height+this.fivePixel:0,r+=this.pageButtonSize+this.fivePixel),e=Math.min(e,n.width),t=Math.min(t,n.height),"Gradient"===i.mode?(n.width=i.width?n.width:this.isVertical?e:.75*n.width,n.height=i.height?n.height:this.isVertical?.75*n.height:t):(n.width=i.width?n.width:e,n.height=i.height?n.height:t),this.isBulletChartControl||this.isTop&&"None"!==i.titleStyle.textOverflow&&(this.calculateLegendTitle(i,n),n.height+="Wrap"===i.titleStyle.textOverflow&&this.legendTitleCollections.length>1?this.legendTitleSize.height-this.legendTitleSize.height/this.legendTitleCollections.length:0),this.rowCount=Math.max(1,Math.ceil((n.height-i.padding-r)/(this.maxItemHeight+i.padding)))}},{key:"getLocation",value:function(e,t,i,n,r,a){var s=this.legend.border.width,o=this.isBulletChartControl,l=this.bulletChart,h="Inside"===l.labelPosition,c="Inside"===l.tickPosition,d="Vertical"===l.orientation,u=o&&""!==l.categoryField?a.width+this.chart.border.width+3*s:0,p=this.chart.margin.bottom,g=i.height+s+this.legend.margin.top+this.legend.margin.bottom,f=i.width+s+this.legend.margin.left+this.legend.margin.right;"Bottom"===e?(i.x=this.alignLegend(i.x,r.width,i.width,t),i.y=n.y+(n.height-g)+s+this.legend.margin.top,i.y+=!o||l.opposedPosition||h||c||d?d&&""!==l.categoryField?a.height+2*s:0:l.majorTickLines.height+p+this.legend.border.width+2*s,wt(n,new Oi(0,0,0,g))):"Top"===e?(i.x=this.alignLegend(i.x,r.width,i.width,t),i.y=n.y+s+this.legend.margin.top,i.y-=!o||!l.opposedPosition||h||c||d?0:l.majorTickLines.height+this.chart.margin.top,wt(n,new Oi(0,0,g-=o?2*-s:0,0))):"Right"===e?(i.x=n.x+(n.width-i.width)-this.legend.margin.right,i.y=n.y+this.alignLegend(0,r.height-(n.y+p),i.height,t),f+=o&&l.opposedPosition&&!h&&!c&&d?this.chart.margin.left+this.chart.margin.right+l.majorTickLines.height:0,wt(n,new Oi(0,f,0,0))):"Left"===e?(i.x=i.x+this.legend.margin.left,i.y=n.y+this.alignLegend(0,r.height-(n.y+p),i.height,t),f+=!o||l.opposedPosition||h||c||!d?"Vertical"!==l.orientation&&""!==l.categoryField?u:0:i.x-this.chart.margin.left+s+l.majorTickLines.height,wt(n,new Oi(f,0,0,0))):(i.x=this.legend.location.x,i.y=this.legend.location.y,wt(n,new Oi(0,0,0,0)))}},{key:"alignLegend",value:function(e,t,i,n){switch(n){case"Far":e=t-i-e;break;case"Center":e=(t-i)/2}return e}},{key:"renderLegend",value:function(e,i,n,r){var a,s=0,o=(new L(0,0,0,0),new L(0,0,0,0)),l=this.findFirstLegendPosition(this.legendCollections),h=i.padding,c=i.enablePages,d=i.titlePosition,u=this.isPaging&&!i.enablePages&&this.isVertical?this.pageButtonSize:0,p=e.renderer.createGroup({id:this.legendID+"_g"}),g=this.createLegendElements(e,n,p,i,this.legendID,r);this.legendRegions=[];for(var f=0,m=0;m<this.legendCollections.length;m++)if(""!==this.legendCollections[m].text){f=Math.max(this.legendCollections[m].textSize.height,f);break}if(this.maxItemHeight=Math.max(f,i.shapeHeight),c||!this.isPaging||this.isVertical?this.isPaging||this.isVertical||(s=this.isTitle&&"Left"===d?this.fivePixel+this.legendTitleSize.width:0):(s=this.isTitle&&"Left"===d?this.legendTitleSize.width:0,s+=this.pageButtonSize+2*this.fivePixel),a=this.isTitle&&(this.isTop||this.isVertical)?this.legendTitleSize.height:0,"Gradient"===e.legendSettings.mode&&this.legendCollections.length>1)this.getLinearLegend(n,e,i,g),this.totalPages=1;else if(l!==this.legendCollections.length){var v,y=0,b=this.legendCollections[l],C=new Ii(this.isBulletChartControl?n.x+s+h+i.shapeWidth/2:n.x+s+h+i.shapeWidth/2+i.containerPadding.left,this.isBulletChartControl?n.y+a+u+h+this.maxItemHeight/2:n.y+a+u+h+this.maxItemHeight/2+i.containerPadding.top),x=new D("",C.x,C.y,e.isRtlEnabled?"end":"start"),S=i.shapePadding+h+i.shapeWidth;if(this.totalPages=this.totalPages=this.isChartControl||this.isBulletChartControl||this.isStockChartControl?this.totalPages:0,this.pageXCollections=[],this.legendCollections[l].location=C,!i.enablePages&&this.isPaging){var w=C.x-this.fivePixel,k=C.y-this.fivePixel,I=this.isTitle&&!this.isVertical&&"Left"===d?this.legendTitleSize.width+this.fivePixel:0,O=this.isVertical?this.pageButtonSize+Math.abs(k-n.y):0,R=this.isTitle&&!this.isVertical&&"Right"===d?this.legendTitleSize.width+this.fivePixel:0;R+=this.isVertical?0:this.fivePixel+this.pageButtonSize+this.fivePixel,o=new L(w,k,n.width-R-I,n.height-O)}else o=n;var A,E=t(this.legendCollections);try{for(E.s();!(A=E.n()).done;){var T=A.value;"accumulationchart"===this.chart.getModuleName()&&(T.fill=(this.chart||this.chart||this.chart).visibleSeries[0].points[T.pointIndex].color),"stockChart"===this.chart.getModuleName()&&(T.type=this.chart.visibleSeries[y].type),this.accessbilityText=this.isBulletChartControl?"Legend of bullet chart"+T.text:"Click to show or hide the "+T.text+" series",T.render&&""!==T.text&&((v=e.renderer.createGroup({id:this.legendID+this.generateId(T,"_g_",y)}))&&(v.setAttribute("tabindex",i.tabIndex.toString()),v.setAttribute("aria-label",i.description||this.accessbilityText)),this.library.getRenderPoint(T,C,S,b,o,y,l),this.renderSymbol(T,v,y),this.renderText(e,T,v,x,y),v&&v.setAttribute("style","outline: none; cursor: "+(!i.toggleVisibility&&("None"===e.selectionMode||"None"===e.highlightMode||"None"===e.selectionMode)||this.isBulletChartControl?"auto":"pointer")),g&&g.appendChild(v),b=T),y++}}catch(j){E.e(j)}finally{E.f()}this.isPaging?this.renderPagingElements(e,n,x,p):this.totalPages=1}$t(e.enableCanvas,e.svgObject,p,r)}},{key:"getLinearLegend",value:function(e,i,n,r){var a="http://www.w3.org/2000/svg",s=this.legendCollections[0],o=this.legendCollections[1],l=this.chart.renderer.createDefs(),h=document.createElementNS(a,"linearGradient"),c=[],d=[];n.title&&(this.isVertical?(e.y+=this.legendTitleSize.height,e.height-=this.legendTitleSize.height):"Left"===n.titlePosition?(e.x+=this.legendTitleSize.width,e.width-=this.legendTitleSize.width):"Right"===n.titlePosition?e.width-=this.legendTitleSize.width:"Top"===n.titlePosition&&(e.y+=this.legendTitleSize.height,e.height-=this.legendTitleSize.height));var u,p=t(this.chart.rangeColorSettings);try{for(p.s();!(u=p.n()).done;){var g=u.value;if(d.indexOf(g.start)<0&&d.push(g.start),g.colors.length>2){var f=g.end-g.start,m=g.colors.length-1;if(f>0){f/=m;for(var v=1;v<m;v++)d.push(g.start+f*v)}else for(var y=1;y<m;y++)d.push(g.start)}d.indexOf(g.end)<0&&d.push(g.end);var b,C=t(g.colors);try{for(C.s();!(b=C.n()).done;){var x=b.value;c.indexOf(x)<0&&c.push(x)}}catch(Q){C.e(Q)}finally{C.f()}g.colors.length>0&&g.colors.length<2&&c.push(g.colors[0])}}catch(Q){p.e(Q)}finally{p.f()}var S=this.isVertical?"0":"100",w=this.isVertical?"100":"0";h.setAttribute("id",this.generateId(s,"linearGradient",0)),h.setAttribute("x1","0%"),h.setAttribute("y1","0%"),h.setAttribute("x2",S+"%"),h.setAttribute("y2",w+"%");for(var k=d[d.length-1]-d[0],I=0;I<c.length;I++){var O=d[I]-d[0];O/=k;var A=document.createElementNS(a,"stop");A.setAttribute("offset",O.toString()),A.setAttribute("stop-color",c[I]),A.setAttribute("stop-opacity",1..toString()),h.appendChild(A)}var E,T,j,M,F=s.text.toString(),P=o.text.toString(),N=R(F,n.textStyle),B=R(P,n.textStyle),H=N.width>B.width?N.width:B.width,_=N.height>B.height?N.height:B.height,z=2*H+4*n.padding,V=e.width,U=e.height,q=e.x+H+2*n.padding,W=e.y+n.padding;if(this.isVertical){if(z=2*_+4*n.padding,V=e.width-2*n.padding,U=e.height-z,q=e.x+n.padding,W=e.y+_+2*n.padding,E=e.y+n.padding+_,T=W+U+_,M=j=e.x+.5*e.width-.5*H,V>30){var Z=V-30;V=30,q+=Z/2}}else if(V=e.width-z,U=e.height-2*n.padding,j=e.x+n.padding+(H-N.width),M=e.x+V+3*n.padding+H,T=E=e.y+.5*e.height+.25*_,U>30){var G=U-30;U=30,W+=G/2}var Y=new D("",j,E,"",F);Y.id=this.legendID+this.generateId(s,"_text_",1);var X=s.visible?n.textStyle.color||i.themeStyle.legendLabel:"#D3D3D3",K=!this.isStockChartControl&&this.chart.enableCanvas;pi(i.renderer,Y,n.textStyle,X,r,!1,!1,!1,!1,null,this.currentPageNumber&&K?new L(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null),(Y=new D("",M,T,"",P)).id=this.legendID+this.generateId(s,"_text_",2),pi(i.renderer,Y,n.textStyle,X,r,!1,!1,!1,!1,null,this.currentPageNumber&&K?new L(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null);var J=i.renderer.drawRectangle({width:V,height:U,x:q,y:W,fill:"url(#"+this.generateId(s,"linearGradient",0)+")"});l.appendChild(h),r.appendChild(l),r.appendChild(J)}},{key:"findFirstLegendPosition",value:function(e){var i,n=0,r=t(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.render&&""!==a.text)break;n++}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"calculateLegendTitle",value:function(e,t){if(e.title){this.isTop="Top"===e.titlePosition;var i="Trim"===e.titleStyle.textOverflow?2*e.padding:0;this.isTop||this.isVertical?this.legendTitleCollections=mi(e.title,e.titleStyle,t.width-i):this.legendTitleCollections[0]=ci(e.maximumTitleWidth,e.title,e.titleStyle),this.legendTitleSize=R(this.isTop?e.title:this.legendTitleCollections[0],e.titleStyle),this.legendTitleSize.height*=this.legendTitleCollections.length}else this.legendTitleSize=new E(0,0)}},{key:"renderLegendTitle",value:function(e,t,i,n){var r=t.padding,a=t.titleStyle.textAlignment;this.isTop="Top"===t.titlePosition;var s="Near"===a?"start":"Far"===a?"end":"middle",o=vi(i,t.titleStyle);s=this.isTop||this.isVertical?s:"",o="Near"===a?o+r:"Far"===a?o-r:o,o=this.isTop||this.isVertical?o:i.x+("Left"===t.titlePosition?5:i.width-this.legendTitleSize.width-5);var l=new D(this.legendID+"_title",o,i.y+(this.isTop||this.isVertical?this.legendTitleSize.height/this.legendTitleCollections.length:i.height/2+this.legendTitleSize.height/4),s,this.legendTitleCollections);pi(e.renderer,l,t.titleStyle,t.titleStyle.color,n)}},{key:"createLegendElements",value:function(e,t,i,n,r,a){var s=n.padding,o=new Si(r+"_element",n.background,n.border,n.opacity,t),l=e.renderer.createGroup({id:r+"_collections"}),h=!this.isStockChartControl&&e.enableCanvas,c=e.renderer.createClipPath({id:r+"_clipPath"});return i?i.appendChild(e.renderer.drawRectangle(o)):e.renderer.drawRectangle(o),n.title&&this.renderLegendTitle(e,n,t,i),h||i.appendChild(l),this.legendTranslateGroup=e.renderer.createGroup({id:r+"_translate_g"}),h||l.appendChild(this.legendTranslateGroup),o.y+=s+(this.isTop?this.legendTitleSize.height:0),o.id+="_clipPath_rect",o.width=this.isChartControl||"bulletChart"===e.getModuleName()||this.isStockChartControl||!this.isVertical?t.width:this.maxWidth-s+n.containerPadding.left+n.containerPadding.right,h?this.pagingClipRect=o:(this.clipRect=e.renderer.drawRectangle(o),c.appendChild(this.clipRect)),$t(h,e.svgObject,c,a),h||l.setAttribute("style","clip-path:url(#"+c.id+")"),this.legendTranslateGroup}},{key:"renderSymbol",value:function(e,t,i){var n,r,a=this.isBulletChartControl?this.chart:null,s=e.visible?e.fill:"#D3D3D3",o=("chart"===this.chart.getModuleName()||"stockChart"===this.chart.getModuleName())&&"SeriesType"===e.shape&&e.type.toLowerCase().indexOf("line")>-1&&-1===e.type.toLowerCase().indexOf("area"),l=!("chart"!==this.chart.getModuleName()&&"stockChart"!==this.chart.getModuleName()||"Scatter"!==e.type&&"Bubble"!==e.type),h=!this.isStockChartControl&&this.chart.enableCanvas,c="SeriesType"===e.shape?e.type:e.shape,d=o?"Series"===this.legend.mode?this.chart.visibleSeries[i].width:this.chart.visibleSeries[0].width:this.isBulletChartControl&&"Multiply"===e.shape?4:1;if(c="Scatter"===c?e.markerShape:c,l&&i<this.chart.visibleSeries.length){var u=this.chart.visibleSeries[i].border;n=u.color?u.color:s,d=u.width?u.width:1}var p=new U(this.legendID+this.generateId(e,"_shape_",i),s,d,l?n:s,1,"",""),g=R(e.text,this.legend.textStyle),f=this.legend.isInversed?e.location.x+g.width+this.legend.shapePadding:e.location.x,m=e.location.y;h?(r=-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),Wt({x:f,y:m},c,new E(this.legend.shapeWidth,this.legend.shapeHeight),"",p,0,this.chart.renderer,this.currentPageNumber?new L(0,r,0,0):null,this.isBulletChartControl,a),this.legendRegions.push({rect:new L(e.location.x,e.location.y,this.legend.shapeWidth,this.legend.shapeHeight+r),index:i})):t.appendChild(Wt({x:f,y:m},c,new E(this.legend.shapeWidth,this.legend.shapeHeight),e.url,p,0,this.chart.renderer,null,this.isBulletChartControl,a)),("Line"===c&&e.markerVisibility&&"Image"!==e.markerShape||"Doughnut"===e.type&&"Doughnut"===c)&&(p.id=this.legendID+this.generateId(e,"_shape_marker_",i),c="Doughnut"===e.type?"Circle":e.markerShape,p.fill="Doughnut"===e.type?"#FFFFFF":p.fill,h?Wt({x:f,y:m},c,new E(this.legend.shapeWidth/2,this.legend.shapeHeight/2),"",p,0,this.chart.renderer,this.currentPageNumber?new L(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null,this.isBulletChartControl,a):t.appendChild(Wt({x:f,y:m},c,new E(this.legend.shapeWidth/2,this.legend.shapeHeight/2),"",p,0,null,null,this.isBulletChartControl,a)))}},{key:"renderText",value:function(e,t,i,n,r){var a=e.legendSettings,s=t.visible?a.textStyle.color||e.themeStyle.legendLabel:"#D3D3D3",o=!this.isStockChartControl&&this.chart.enableCanvas;n.id=this.legendID+this.generateId(t,"_text_",r),n.text=t.text,n.x=a.isInversed?t.location.x-a.shapeWidth/2:t.location.x+a.shapeWidth/2+a.shapePadding,n.y=t.location.y+this.maxItemHeight/4;var l=pi(e.renderer,n,a.textStyle,s,i,!1,!1,!1,!1,null,this.currentPageNumber&&o?new L(0,-this.translatePage(null,this.currentPageNumber-1,this.currentPageNumber),0,0):null);if(l&&l.setAttribute("aria-label",a.description||this.accessbilityText),o){var h=R(n.text,a.textStyle);this.legendRegions[r].rect.y=n.y<this.legendRegions[r].rect.y?n.y:this.legendRegions[r].rect.y,this.legendRegions[r].rect.width+=h.width,this.legendRegions[r].rect.height=h.height,this.legendRegions[r].rect.y-=.5*h.height}}},{key:"renderPagingElements",value:function(e,t,i,n){var r,a=e.renderer.createGroup({id:this.legendID+"_navigation"}),s=!this.isStockChartControl&&e.enableCanvas,o=this.isBulletChartControl?0:this.legendTitleSize.height,l=e.legendSettings,h=new U(this.legendID+"_pageup","transparent",5,"#545454",1,"",""),c=this.pageButtonSize,d=l.enablePages||!this.isPaging||this.isVertical||this.isBulletChartControl?this.rowCount-1:1,u=this.isTitle&&"Left"===l.titlePosition?this.legendTitleSize.width:0;this.pagingRegions=[],this.backwardArrowOpacity=1!==this.currentPage?1:0,this.forwardArrowOpacity=this.currentPage===this.totalPages?0:1,s||n.appendChild(a),this.totalPages=this.isChartControl||this.isBulletChartControl||this.isStockChartControl||!this.isVertical?Math.ceil(this.totalPages/Math.max(1,this.rowCount-1)):Math.ceil(this.totalPages/this.maxColumns),a&&a.setAttribute("style","cursor: pointer"),this.clipPathHeight=d*(this.maxItemHeight+l.padding),s?(this.pagingClipRect.height=this.legendBounds.height-this.clipPathHeight-(this.pagingClipRect.y-this.legendBounds.y)-l.border.width,this.pagingClipRect.y=this.pagingClipRect.y+this.clipPathHeight,this.pagingClipRect.x+=l.border.width,this.pagingClipRect.width-=l.border.width+l.border.width/2,this.chart.renderer.clearRect(new L(this.pagingClipRect.x,this.pagingClipRect.y,this.pagingClipRect.width,this.pagingClipRect.height))):this.clipRect.setAttribute("height",this.clipPathHeight.toString());var p=t.x+c/2,g=t.y+this.clipPathHeight+(o+t.height-this.clipPathHeight)/2;!this.isPaging||l.enablePages||this.isVertical||this.isBulletChartControl||(p=t.x+this.fivePixel+this.pageButtonSize+u,g=l.title&&this.isTop?t.y+8+o+c/1+.5:t.y+8+c+.5);var f=R(this.totalPages+"/"+this.totalPages,l.textStyle);s?Wt({x:p,y:g},"LeftArrow",new E(c,c),"",h,0,this.chart.renderer,new L(t.width-(2*(c+8)+8+f.width),0,0,0)):!this.isVertical||l.enablePages||this.isBulletChartControl?(h.opacity=this.isBulletChartControl?h.opacity:l.enablePages?1:this.backwardArrowOpacity,a.appendChild(Wt({x:p,y:g},"LeftArrow",new E(c,c),"",h))):(p=t.x+t.width/2,g=t.y+c/2+8+o,h.opacity=this.backwardArrowOpacity,a.appendChild(Wt({x:p,y:g},"UpArrow",new E(c,c),"",h))),this.pagingRegions.push(new L(p+t.width-(2*(c+8)+8+f.width)-.5*c,g-.5*c,c,c)),i.x=p+c/2+8,i.y=g+f.height/4,i.id=this.legendID+"_pagenumber",i.text="1/"+this.totalPages,s&&this.totalNoOfPages&&(i.text=this.currentPageNumber+"/"+this.totalNoOfPages),(l.enablePages||this.isBulletChartControl)&&(r=pi(e.renderer,i,l.textStyle,l.textStyle.color,a,!1,!1,!1,!1,null,new L(t.width-(2*(c+8)+8+f.width),0,0,0))),p=i.x+8+c/2+f.width,!this.isPaging||l.enablePages||this.isVertical||(p=t.x+t.width-this.fivePixel-this.pageButtonSize-(l.title&&"Right"===l.titlePosition?this.legendTitleSize.width+this.fivePixel:0)),h.id=this.legendID+"_pagedown",h.opacity=l.enablePages?1:this.forwardArrowOpacity,s?Wt({x:p,y:g},"RightArrow",new E(c,c),"",h,0,this.chart.renderer,new L(t.width-(2*(c+8)+8+f.width),0,0,0)):!this.isVertical||l.enablePages||this.isBulletChartControl?a.appendChild(Wt({x:p,y:g},"RightArrow",new E(c,c),"",h)):(p=t.x+t.width/2,g=t.y+t.height-c/2-8,a.appendChild(Wt({x:p,y:g},"DownArrow",new E(c,c),"",h))),this.pagingRegions.push(new L(p+(t.width-(2*(c+8)+8+f.width)-.5*c),g-.5*c,c,c)),s||!l.enablePages&&!this.isBulletChartControl?(1===this.currentPageNumber&&this.calTotalPage&&(l.enablePages||this.isBulletChartControl)&&(this.totalNoOfPages=this.totalPages,this.calTotalPage=!1),l.enablePages||this.isBulletChartControl||this.translatePage(null,this.currentPage-1,this.currentPage,l)):a.setAttribute("transform","translate("+(t.width-(2*(c+8)+8+f.width))+", 0)"),(l.enablePages||this.isBulletChartControl)&&this.translatePage(r,this.currentPage-1,this.currentPage,l)}},{key:"translatePage",value:function(e,t,i,n){var r=this.clipPathHeight*t,a="translate(0,-"+r+")";return this.isChartControl||this.isBulletChartControl||this.isStockChartControl||!this.isVertical||(a="translate(-"+(r=(r=this.pageXCollections[t*this.maxColumns]-this.legendBounds.x)<0?0:r)+",0)"),this.chart.enableCanvas||this.legendTranslateGroup.setAttribute("transform",a),this.chart.enableCanvas||!n.enablePages&&!this.isBulletChartControl||(e.textContent=i+"/"+this.totalPages),this.currentPage=i,r}},{key:"changePage",value:function(e,t){var i=this.chart.legendSettings,n=document.getElementById(this.legendID+"_pageup"),r=document.getElementById(this.legendID+"_pagedown"),a=i.enablePages||this.isBulletChartControl?document.getElementById(this.legendID+"_pagenumber"):null,s=i.enablePages||this.isBulletChartControl?parseInt(a.textContent.split("/")[0],10):this.currentPage;t&&s>1?this.translatePage(a,s-2,s-1,i):!t&&s<this.totalPages&&this.translatePage(a,s,s+1,i),!this.isPaging||i.enablePages||this.isBulletChartControl||(this.currentPage===this.totalPages?this.hideArrow(r):this.showArrow(r),1===this.currentPage?this.hideArrow(n):this.showArrow(n))}},{key:"hideArrow",value:function(e){e.setAttribute("opacity","0")}},{key:"showArrow",value:function(e){e.setAttribute("opacity","1")}},{key:"generateId",value:function(e,t,i){return this.isChartControl||this.isStockChartControl?t+i:t+e.pointIndex}},{key:"move",value:function(e){var t=this,i=this.chart.mouseX,n=this.chart.mouseY;if(e.target.textContent.indexOf("...")>-1){var r=e.target.id.split(this.legendID+"_text_");if(2===r.length){var a=parseInt(r[1],10),s=this.chart.element;isNaN(a)||(this.chart.isTouch&&ft(this.chart.element.id+"_EJ2_Legend_Tooltip"),this.isChartControl?vt(this.chart.series[a].name,i,n,s.offsetWidth,s.id+"_EJ2_Legend_Tooltip",Zt(this.chart.element.id+"_Secondary_Element")):vt(this.chart.visibleSeries[0].points[a].x.toString(),i+10,n+10,s.offsetWidth,s.id+"_EJ2_Legend_Tooltip",Zt(this.chart.element.id+"_Secondary_Element")))}}else ft(this.chart.element.id+"_EJ2_Legend_Tooltip");this.chart.isTouch&&(clearTimeout(this.clearTooltip),this.clearTooltip=+setTimeout(function(){ft(t.chart.element.id+"_EJ2_Legend_Tooltip")},1e3))}}]),e}(),mn=function e(t,i,n,r,s,o,l,h,c,d){a(this,e),this.location={x:0,y:0},this.text=t,this.fill=i,this.shape=n,this.url=o,this.visible=r,this.type=s,this.markerVisibility=h,this.markerShape=l,this.pointIndex=c,this.seriesIndex=d},vn=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},yn=(Vi=function(e){l(i,e);var t=c(i);function i(){var e;return a(this,i),(e=t.apply(this,arguments)).clipRect=new L(0,0,0,0),e}return o(i,[{key:"setDataSource",value:function(e,t){e&&(this.xData=e.xData,this.yData=e.yData,this.points=e.points),t[Dt(this.type)+"IndicatorModule"].initDataSource(this,t),t.visibleSeriesCount+=this.targetSeries.length}}]),i}(ln),vn([Object(f.t)("Sma")],Vi.prototype,"type",void 0),vn([Object(f.t)(14)],Vi.prototype,"period",void 0),vn([Object(f.t)(14)],Vi.prototype,"kPeriod",void 0),vn([Object(f.t)(3)],Vi.prototype,"dPeriod",void 0),vn([Object(f.t)(80)],Vi.prototype,"overBought",void 0),vn([Object(f.t)(20)],Vi.prototype,"overSold",void 0),vn([Object(f.t)(2)],Vi.prototype,"standardDeviation",void 0),vn([Object(f.t)("Close")],Vi.prototype,"field",void 0),vn([Object(f.t)(12)],Vi.prototype,"slowPeriod",void 0),vn([Object(f.t)(26)],Vi.prototype,"fastPeriod",void 0),vn([Object(f.t)(!0)],Vi.prototype,"showZones",void 0),vn([Object(f.g)({color:"#ff9933",width:2},Le)],Vi.prototype,"macdLine",void 0),vn([Object(f.t)("Both")],Vi.prototype,"macdType",void 0),vn([Object(f.t)("#2ecd71")],Vi.prototype,"macdPositiveColor",void 0),vn([Object(f.t)("#e74c3d")],Vi.prototype,"macdNegativeColor",void 0),vn([Object(f.t)("rgba(211,211,211,0.25)")],Vi.prototype,"bandColor",void 0),vn([Object(f.g)({color:"#ffb735",width:1},Le)],Vi.prototype,"upperLine",void 0),vn([Object(f.g)({color:"#f2ec2f",width:1},Le)],Vi.prototype,"lowerLine",void 0),vn([Object(f.g)({color:"#f2ec2f",width:1},Le)],Vi.prototype,"periodLine",void 0),vn([Object(f.t)("")],Vi.prototype,"seriesName",void 0),Vi),bn=function(){function e(t){a(this,e),this.control=t}return o(e,[{key:"print",value:function(e){this.printWindow=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth+",tabbar=no"),this.printWindow.moveTo(0,0),this.printWindow.resizeTo(screen.availWidth,screen.availHeight);var t={cancel:!1,htmlContent:this.getHTMLContent(e),name:"beforePrint"};this.control.trigger("beforePrint",t),t.cancel||Object(f.jb)(t.htmlContent,this.printWindow)}},{key:"getHTMLContent",value:function(e){var t=Object(f.G)("div");if(e)if(e instanceof Array)for(var i=0;i<e.length;i++)t.appendChild(Zt(e[i]).cloneNode(!0));else e instanceof Element?t.appendChild(e.cloneNode(!0)):t.appendChild(Zt(e).cloneNode(!0));else t.appendChild(this.control.element.cloneNode(!0));return t}},{key:"export",value:function(e,t,i,n,r,a,s,o,l){var h=this,c=this.getControlsValue(n,s);r=r||c.width,a=a||c.height;var d,u=this.control.svgObject,p=this.control.enableCanvas;p||(u=Object(f.G)("canvas",{id:"ej2-canvas",attrs:{width:r.toString(),height:a.toString()}}));var g=!(f.d.userAgent.toString().indexOf("HeadlessChrome")>-1);i=Object(f.Z)(i)?J.l.Landscape:i;var m=window.URL.createObjectURL(new Blob("SVG"===e?['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+c.svg.outerHTML+"</svg>"]:[(new XMLSerializer).serializeToString(c.svg)],{type:"image/svg+xml"}));if("SVG"===e)if("msie"===f.d.info.name){var v=new Blob([(new XMLSerializer).serializeToString(c.svg)],{type:"application/octet-stream"});window.navigator.msSaveOrOpenBlob(v,t+"."+e.toLocaleLowerCase())}else this.triggerDownload(t,e,m,g);else if("msie"===f.d.info.name){var y=u;p||(y=this.createCanvas()),d=y.toDataURL(),"PDF"===e?this.exportPdf(y,i,r,a,g,t,o,l):this.doexport(e,d,t)}else{var b=new Image,C=u.getContext("2d");b.onload=function(){C.drawImage(b,0,0),window.URL.revokeObjectURL(m),"PDF"===e?h.exportPdf(u,i,r,a,g,t,o,l):window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(u.toBlob(null),t+"."+e.toLocaleLowerCase()):h.triggerDownload(t,e,u.toDataURL("image/"+e.toLowerCase()),g)},b.src=m}p||ft(document.getElementById(this.control.element.id+"_canvas"))}},{key:"getDataUrl",value:function(e){var t=this.getControlsValue([e]),i=this.control.svgObject,n=this.control.enableCanvas;n||(i=Object(f.G)("canvas",{id:"ej2-canvas",attrs:{width:t.width.toString(),height:t.height.toString()}}));var r=window.URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t.svg)],{type:"image/svg+xml"}));if("msie"===f.d.info.name){var a=i;n||(a=this.createCanvas());var s={name:"afterExport",cancel:!1,dataUrl:i.toDataURL("image/png")};return e.trigger("afterExport",s),{element:a,dataUrl:a.toDataURL()}}var o=new Image,l=i.getContext("2d");return o.onload=function(){l.drawImage(o,0,0),window.URL.revokeObjectURL(r);var t={name:"afterExport",cancel:!1,dataUrl:i.toDataURL("image/png")};return e.trigger("afterExport",t),t.dataUrl},o.src=r,{element:i,blobUrl:r}}},{key:"triggerDownload",value:function(e,t,i,n){Object(f.G)("a",{attrs:{download:e+"."+t.toLocaleLowerCase(),href:i}}).dispatchEvent(new MouseEvent(n?"click":"move",{view:window,bubbles:!1,cancelable:!0}))}},{key:"getControlsValue",value:function(e,t){var i=0,n=0,r=this.control.enableCanvas,a=new I("").createSvg({id:"Svg_Export_Element",width:200,height:200});return e.map(function(e){var s=e.svgObject.cloneNode(!0),o=e.renderer.createGroup({style:Object(f.Z)(t)||t?"transform: translateY("+n+"px)":"transform: translateX("+i+"px)"}),l=s.childNodes[0].getAttribute("fill");"Tailwind"!==e.theme&&"TailwindDark"!==e.theme||"rgba(255,255,255, 0.0)"!==l&&"transparent"!==l||s.childNodes[0].setAttribute("fill","rgba(255,255,255, 1)"),r||o.appendChild(s),i=Object(f.Z)(t)||t?Math.max(e.availableSize.width,i):i+e.availableSize.width,n=Object(f.Z)(t)||t?n+e.availableSize.height:Math.max(e.availableSize.height,n),r||a.appendChild(o)}),r||(a.setAttribute("width",i+""),a.setAttribute("height",n+"")),{width:i,height:n,svg:a}}},{key:"createCanvas",value:function(){var e=this.control;this.canvasRender(!0,e);var t=e.svgObject;return this.canvasRender(!1,e),t}},{key:"canvasRender",value:function(e,t){t.enableCanvas=e,t.preRender(),t.render()}},{key:"exportPdf",value:function(e,t,i,n,r,a,s,o){var l=new J.e,h=l.pageSettings.margins,c=l.pageSettings.width,d=l.pageSettings.height,u=e.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream");l.pageSettings.orientation=t;var p=c<i?i+h.left+h.right:c,g=d<n?n+h.top+h.bottom:d;if(void 0!==s){var f=new J.q(1,s.fontSize||15),m=new J.n(p,40);m.graphics.drawString(s.content+"",f,null,new J.p(new J.c(0,0,0)),s.x,s.y,null),l.template.top=m}if(void 0!==o){var v=new J.q(1,o.fontSize||15),y=new J.n(p,40);y.graphics.drawString(o.content+"",v,null,new J.p(new J.c(0,0,0)),o.x,o.y,null),l.template.bottom=y}l.pageSettings.size=new J.y(p,g),u=u.slice(u.indexOf(",")+1),l.pages.add().graphics.drawImage(new J.a(u),0,0,i,n),r&&(l.save(a+".pdf"),l.destroy())}},{key:"doexport",value:function(e,t,i){var n;n=[t],this.exportImage(n,i,e||"JPG",t)}},{key:"exportImage",value:function(e,t,i,n){for(var r=[],a=e instanceof HTMLElement?0:e.length,s=0;s<a;s++){for(var o=e[s].replace(/^data:[a-z]*;,/,"").split(","),l=atob(o[1]),h=new ArrayBuffer(l.length),c=new Uint8Array(h),d=0;d<l.length;d++)c[d]=l.charCodeAt(d);r.push(h)}for(var u=0;u<r.length;u++){var p=new Blob([r[u]],{type:"application/octet-stream"});"msie"===f.d.info.name&&window.navigator.msSaveOrOpenBlob(p,t+"."+i.toLocaleLowerCase())}}}]),e}(),Cn=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},xn=(Zi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Cn([Object(f.t)()],Zi.prototype,"start",void 0),Cn([Object(f.t)()],Zi.prototype,"end",void 0),Cn([Object(f.t)([])],Zi.prototype,"colors",void 0),Cn([Object(f.t)("")],Zi.prototype,"label",void 0),Zi),Sn=(Wi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Cn([Object(f.t)(!1)],Wi.prototype,"enable",void 0),Cn([Object(f.t)("")],Wi.prototype,"dashArray",void 0),Cn([Object(f.g)({color:null,width:1},je)],Wi.prototype,"line",void 0),Cn([Object(f.t)("Both")],Wi.prototype,"lineType",void 0),Cn([Object(f.t)("")],Wi.prototype,"verticalLineColor",void 0),Cn([Object(f.t)("")],Wi.prototype,"horizontalLineColor",void 0),Cn([Object(f.t)(1)],Wi.prototype,"opacity",void 0),Wi),wn=(qi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Cn([Object(f.t)(!1)],qi.prototype,"enableSelectionZooming",void 0),Cn([Object(f.t)(!1)],qi.prototype,"enablePinchZooming",void 0),Cn([Object(f.t)(!1)],qi.prototype,"enableMouseWheelZooming",void 0),Cn([Object(f.t)(!0)],qi.prototype,"enableDeferredZooming",void 0),Cn([Object(f.t)("XY")],qi.prototype,"mode",void 0),Cn([Object(f.t)(["Zoom","ZoomIn","ZoomOut","Pan","Reset"])],qi.prototype,"toolbarItems",void 0),Cn([Object(f.t)(!1)],qi.prototype,"enablePan",void 0),Cn([Object(f.t)(!1)],qi.prototype,"enableScrollbar",void 0),qi),kn=(Ui=function(e){l(n,e);var i=c(n);function n(e,t){var r;return a(this,n),(r=i.call(this,e,t)).rotatedDataLabelCollections=[],r.animated=!1,r.isPointMouseDown=!1,r.isScrolling=!1,r.checkResize=0,r.visible=0,r.clickCount=0,r.singleClickTimer=0,r.chartAreaType="Cartesian",r.isRtlEnabled=!1,r.chartid=57723,Object(f.tb)("mergePersistData",r.mergePersistChartData,u(r)),r}return o(n,[{key:"mergePersistChartData",value:function(){var e=window.localStorage.getItem(this.getModuleName()+this.element.id);if(!Object(f.Z)(e)&&""!==e){var t=JSON.parse(e),i=Object.keys(t);this.isProtectedOnChange=!0;for(var n=0,r=i;n<r.length;n++){var a=r[n];"object"!=typeof this[a]||Object(f.Z)(this[a])?this[a]=t[a]:Object(f.L)(this[a],t[a])}this.isProtectedOnChange=!1}}},{key:"isIdHasSpecialCharacter",value:function(e){var t=/^[A-Za-z ]+$/,i=/^[0-9 ]+$/,n="";if(t.test(e))return e;var r=0;i.test(e[0])&&(n+="\\3"+e[0],r=1);for(var a=r;a<e.length;a++)t.test(e[a])||-1!==e.indexOf("-")||-1!==e.indexOf("_")||-1!==e.indexOf("\\")||i.test(e[a])?n+=e[a]:n+="\\"+e[a];return n}},{key:"preRender",value:function(){this.element.id=this.isIdHasSpecialCharacter(this.element.id),this.isBlazor=window.Blazor,this.allowServerDataBinding=!1,this.unWireEvents(),this.initPrivateVariable(),this.setCulture(),this.wireEvents(),this.stockChart&&(null===this.stockChart.tooltip.header&&(this.tooltip.header="<b>${point.x}</b>"),null===this.stockChart.tooltip.format&&(this.tooltip.format="High : <b>${point.high}</b><br/>Low : <b>${point.low}</b><br/>Open : <b>${point.open}</b><br/>Close : <b>${point.close}</b>",""!==this.stockChart.series[0].volume&&(this.tooltip.format+="<br/>Volume : <b>${point.volume}</b>")),this.animateSeries=!1)}},{key:"initPrivateVariable",value:function(){if(this.animateSeries=!0,this.delayRedraw=!1,this.horizontalAxes=[],this.verticalAxes=[],this.refreshAxis(),this.refreshDefinition(this.rows),this.refreshDefinition(this.columns),this.tooltipModule&&(this.tooltipModule.previousPoints=[]),""===this.element.id){var e=document.getElementsByClassName("e-chart").length;this.element.id="chart_"+this.chartid+"_"+e}this.svgId=this.stockChart?this.stockChart.element.id+"_stockChart_chart":this.element.id+(this.enableCanvas?"_canvas":"_svg")}},{key:"render",value:function(){var e=this;this.svgRenderer=new I(this.element.id);var t={chart:this.isBlazor?{}:this,theme:this.theme,name:"load",cancel:!1};this.stockChart?(this.isRtlEnabled="rtl"===window.getComputedStyle(document.querySelector("body")).direction,this.cartesianChartRendering(t)):this.trigger("load",t,function(){t.cancel||e.cartesianChartRendering(t)})}},{key:"cartesianChartRendering",value:function(e){this.theme=this.isBlazor?e.theme:this.theme,this.createChartSvg(),this.setTheme(),this.markerRender=new dn(this),this.calculateAreaType(),this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.calculateVisibleAxis(),this.processData(),this.renderComplete(),this.allowServerDataBinding=!0}},{key:"getLocalizedLabel",value:function(e){return this.localeObject.getConstant(e)}},{key:"animate",value:function(e){this.redraw=!0,this.animated=!0,this.duration=e||1e3}},{key:"refreshBound",value:function(){if(this.rotatedDataLabelCollections=[],this.legendModule&&this.legendSettings.visible&&this.legendModule.getLegendOptions(this.visibleSeries,this),this.tooltip.enable&&this.tooltipModule&&(this.tooltipModule.previousPoints=[]),this.calculateStackValues(),this.calculateBounds(),this.stockChart&&!this.stockChart.rangeFound&&(this.stockChart.enablePeriodSelector||this.stockChart.enableSelector))return null;this.renderElements(),ft("chartmeasuretext"),this.removeSelection()}},{key:"calculateStackValues",value:function(){for(var e,t=!1,i=0,n=this.visibleSeries.length;i<n;i++)(e=this.visibleSeries[i]).position=e.rectCount=void 0,-1===e.type.indexOf("Stacking")&&(-1===e.drawType.indexOf("Stacking")||"PolarRadar"!==this.chartAreaType)||t||(e.calculateStackedValue(e.type.indexOf("100")>-1,this),t=!0)}},{key:"removeSelection",value:function(){var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.visible){var r,a=t(n.points);try{for(a.s();!(r=a.n()).done;)r.value.isSelect=!1}catch(s){a.e(s)}finally{a.f()}}}}catch(s){i.e(s)}finally{i.f()}Zt(this.element.id+"_ej2_drag_multi_group")?(this.selectionMode.indexOf("Drag")>-1&&(this.selectionModule.filterArray=[]),ft(this.element.id+"_ej2_drag_multi_group"),this.selectionModule.calculateDragSelectedElements(this,new L(0,0,0,0),!0)):Zt(this.element.id+"_ej2_drag_group")&&("Lasso"!==this.selectionMode&&(this.selectionModule.filterArray=[]),ft(this.element.id+"_ej2_drag_group"),this.selectionModule.calculateDragSelectedElements(this,new L(0,0,0,0),!0))}},{key:"renderElements",value:function(){this.renderBorder(),this.renderTitle(),this.renderAreaBorder(),this.renderSeriesElements(this.renderAxes()),this.renderLegend(),this.applyZoomkit(),this.performSelection(),this.setSecondaryElementPosition();var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n=e.value;Object(f.vb)(this.element.id+"_DataLabel","Template",n.marker.dataLabel)}}catch(r){i.e(r)}finally{i.f()}this.renderAnnotation()}},{key:"renderAxes",value:function(){var e;return this.yAxisElements=this.renderer.createGroup({id:this.element.id+"yAxisCollection"}),this.rows.length>0&&this.columns.length>0&&(e=this.chartAxisLayoutPanel.renderAxes()),this.stripLineModule&&this.stripLineModule.renderStripLine(this,"Behind",this.axisCollections),e}},{key:"renderLegend",value:function(){if(this.legendModule&&this.legendModule.legendCollections.length&&this.legendSettings.visible){this.legendModule.calTotalPage=!0;var e=this.legendSettings.border.width,t=this.legendModule.legendBounds,i=new L(t.x,t.y,t.width,t.height);this.enableCanvas&&(i=new L(i.x-e/2,i.y-e/2,i.width+e,i.height+e),this.renderer.canvasClip(i)),this.legendModule.renderLegend(this,this.legendSettings,t),this.enableCanvas&&this.renderer.canvasRestore()}this.redraw||(this.stockChart?Zt(this.stockChart.chartObject.id)||this.stockChart.mainObject.appendChild(this.svgObject):this.element.appendChild(this.svgObject))}},{key:"setSecondaryElementPosition",value:function(){var e=Zt(this.element.id+"_Secondary_Element");if(e){var t=this.element.getBoundingClientRect(),i=Zt(this.svgId).getBoundingClientRect();e.style.left=Math.max(i.left-t.left,0)+"px",e.style.top=Math.max(i.top-t.top,0)+"px"}}},{key:"initializeModuleElements",value:function(){this.dataLabelCollections=[];var e=this.element.id;this.series.length&&(this.seriesElements="Scatter"===this.series[0].type||"Bubble"===this.series[0].type?this.svgRenderer.createGroup({id:e+"SeriesCollection"}):this.renderer.createGroup({id:e+"SeriesCollection"})),this.indicators.length&&(this.indicatorElements=this.renderer.createGroup({id:e+"IndicatorCollection"})),this.hasTrendlines()&&(this.trendLineElements=this.renderer.createGroup({id:e+"TrendLineCollection"})),this.dataLabelElements=this.renderer.createGroup({id:e+"DataLabelCollection"})}},{key:"hasTrendlines",value:function(){var e,i,n=t(this.series);try{for(n.s();!(i=n.n()).done&&!(e=!!i.value.trendlines.length););}catch(r){n.e(r)}finally{n.f()}return e}},{key:"renderSeriesElements",value:function(e){this.initializeModuleElements();var t=this.element.id;if("g"!==this.element.tagName){var i=ui(this.redraw,t+"_Secondary_Element")||this.createElement("div");i.id=t+"_Secondary_Element",i.setAttribute("style","position: relative"),$t(!1,this.element,i,this.redraw)}if(this.enableCanvas){var n=document.getElementById(t+"_Secondary_Element");n=n||this.createElement("div",{id:t+"_Secondary_Element",attrs:{style:"position: relative; left:0px; top:0px"}});var r=this.svgRenderer.createSvg({id:t+"_tooltip_svg",width:this.availableSize.width,height:this.availableSize.height});r.setAttribute("style","position: absolute; pointer-events: none"),n.appendChild(r)}this.tooltip.enable&&$t(this.enableCanvas,this.svgObject,this.renderer.createGroup({id:t+"_UserInteraction",style:"pointer-events:none;"}),this.redraw),this.rows.length>0&&this.columns.length>0&&(this.initializeIndicator(),this.initializeTrendLine(),this.renderSeries(),this.trendLineElements&&$t(this.enableCanvas,this.svgObject,this.trendLineElements,this.redraw),this.appendElementsAfterSeries(e))}},{key:"renderSeries",value:function(){this.enableCanvas&&this.renderer.canvasClip(this.chartAxisLayoutPanel.seriesClipRect);var e,i,n,r=t(this.visibleSeries);try{for(r.s();!(e=r.n()).done;){var a=e.value;("TrendLine"===a.category?this.series[a.sourceIndex].trendlines[a.index].visible:a.visible)&&(this.visible++,n=void 0,n=(i=a).clipRect,i.chart.requireInvertedAxis?(n.x=i.yAxis.rect.x,n.y=i.xAxis.rect.y,n.width=i.yAxis.rect.width,n.height=i.xAxis.rect.height):(n.x=i.xAxis.rect.x,n.y=i.yAxis.rect.y,n.width=i.xAxis.rect.width,n.height=i.yAxis.rect.height),this.enableCanvas&&this.renderCanvasSeries(a),a.renderSeries(this))}}catch(o){r.e(o)}finally{r.f()}if(this.enableCanvas&&this.renderer.canvasRestore(),this.visible=0,this.seriesElements){this.enableCanvas||this.seriesElements.appendChild(Ht(this.redraw,{id:this.element.id+"_ChartAreaClipRect_",x:this.chartAxisLayoutPanel.seriesClipRect.x,y:this.chartAxisLayoutPanel.seriesClipRect.y,width:this.chartAxisLayoutPanel.seriesClipRect.width,height:this.chartAxisLayoutPanel.seriesClipRect.height,fill:"transparent","stroke-width":1,stroke:"Gray"},this.renderer));var s=document.getElementById(this.element.id+"_series_svg");s?$t(!1,s,this.seriesElements,this.redraw):$t(this.enableCanvas,this.svgObject,this.seriesElements,this.redraw)}}},{key:"renderCanvasSeries",value:function(e){var t,i;if("Bubble"===e.type||"Scatter"===e.type){t=t||this.svgRenderer.createSvg({id:this.element.id+"_series_svg",width:this.availableSize.width,height:this.availableSize.height}),(i=i||this.createElement("div",{id:this.element.id+"_series"})).setAttribute("style","position: absolute");var n=document.getElementById(this.element.id+"_Secondary_Element");i.appendChild(t),n.appendChild(i)}t=!this.enableCanvas||"Bubble"!==e.type&&"Scatter"!==e.type?this.svgObject:t}},{key:"initializeIndicator",value:function(){var e,i=t(this.indicators);try{for(i.s();!(e=i.n()).done;){var n=e.value;this[Dt(n.type)+"IndicatorModule"]&&this[Dt(n.type)+"IndicatorModule"].createIndicatorElements(this,n,n.index)}}catch(r){i.e(r)}finally{i.f()}this.indicatorElements&&$t(this.enableCanvas,this.svgObject,this.indicatorElements,this.redraw)}},{key:"initializeTrendLine",value:function(){var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.trendlines.length&&this.trendLineModule.getTrendLineElements(n,this)}}catch(r){i.e(r)}finally{i.f()}}},{key:"appendElementsAfterSeries",value:function(e){"PolarRadar"===this.chartAreaType&&$t(this.enableCanvas,this.svgObject,this.yAxisElements,this.redraw),$t(this.enableCanvas,this.svgObject,e,this.redraw),(this.zoomModule&&this.zoomSettings.enableScrollbar&&this.scrollElement.childElementCount||this.scrollElement&&this.scrollElement.childElementCount)&&$t(!1,Zt(this.element.id+"_Secondary_Element"),this.scrollElement,this.redraw),this.stripLineModule&&this.stripLineModule.renderStripLine(this,"Over",this.axisCollections),this.tooltip.enable||$t(this.enableCanvas,this.svgObject,this.renderer.createGroup({id:this.element.id+"_UserInteraction",style:"pointer-events:none;"}),this.redraw),this.stockChart&&this.stockChart.calculateStockEvents()}},{key:"applyZoomkit",value:function(){"PolarRadar"!==this.chartAreaType&&(this.redraw||!this.zoomModule||this.zoomSettings.enablePan&&!this.zoomModule.performedUI||this.zoomModule.applyZoomToolkit(this,this.axisCollections))}},{key:"renderAnnotation",value:function(){this.annotationModule&&this.annotationModule.renderAnnotations(Zt((this.stockChart?this.stockChart.element.id:this.element.id)+"_Secondary_Element"))}},{key:"performSelection",value:function(){var e=[];this.selectionModule&&(e=Object(f.L)([],this.selectionModule.selectedDataIndexes,null,!0),this.selectionModule.invokeSelection(this)),this.highlightModule&&this.highlightModule.invokeHighlight(this),e.length>0&&(this.selectionModule.selectedDataIndexes=e,this.selectionModule.redrawSelection(this,this.selectionMode))}},{key:"processData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.visibleSeriesCount=0;var i,n=!0,r=t(this.visibleSeries);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.visible||this.legendSettings.visible?"Indicator"!==a.category&&"TrendLine"!==a.category&&this.initializeDataModule(a):this.visibleSeriesCount++}}catch(h){r.e(h)}finally{r.f()}var s,o=t(this.indicators);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.dataSource&&(this.initializeDataModule(l),n=!1)}}catch(h){o.e(h)}finally{o.f()}e&&(!this.visibleSeries.length||this.visibleSeriesCount===this.visibleSeries.length&&n)&&(this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}))}},{key:"initializeDataModule",value:function(e){var t;e.xData=[],e.yData=[],t=this.isAngular?Object.keys(e.dataSource).length?e.dataSource:this.dataSource:e.dataSource||this.dataSource,e.dataModule=new cn(t,e.query),e.points=[],e.refreshDataManager(this)}},{key:"calculateBounds",value:function(){var e=this.margin,i=0,n=0,r=0,a=e.left,s=this.availableSize.width-a-e.right-this.border.width;if(this.titleCollection=[],this.subTitleCollection=[],this.title&&(this.titleCollection=mi(this.title,this.titleStyle,s),i=R(this.title,this.titleStyle).height*this.titleCollection.length+15,this.subTitle)){var o,l=0,h=t(this.titleCollection);try{for(h.s();!(o=h.n()).done;)l=(r=R(o.value,this.titleStyle).width)>l?r:l}catch(u){h.e(u)}finally{h.f()}this.subTitleCollection=mi(this.subTitle,this.subTitleStyle,l),n=R(this.subTitle,this.subTitleStyle).height*this.subTitleCollection.length+15}var c=e.top+n+i+.5*this.chartArea.border.width,d=this.availableSize.height-c-this.border.width-e.bottom;this.stockChart&&this.stockChart.legendSettings.visible&&this.stockChart.stockLegendModule&&("Top"===this.stockChart.legendSettings.position?c+=this.stockChart.stockLegendModule.legendBounds.height:"Left"===this.stockChart.legendSettings.position&&(a+=this.stockChart.stockLegendModule.legendBounds.width)),this.initialClipRect=new L(a,c,s,d),this.legendModule&&this.legendSettings.visible&&this.legendModule.calculateLegendBounds(this.initialClipRect,this.availableSize,null),this.chartAxisLayoutPanel.measureAxis(this.initialClipRect)}},{key:"print",value:function(e){new bn(this).print(e)}},{key:"initTrendLines",value:function(){this.isProtectedOnChange=!0;var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n,r=e.value,a=0,s=t(r.trendlines);try{for(s.s();!(n=s.n()).done;){var o=n.value;this.trendLineModule&&(o.index=a,o.sourceIndex=r.index,this.trendLineModule.initSeriesCollection(o,this),o.targetSeries&&(o.targetSeries.xAxisName=r.xAxisName,o.targetSeries.yAxisName=r.yAxisName,this.visibleSeries.push(o.targetSeries))),a++}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}this.isProtectedOnChange=!1}},{key:"calculateAreaType",value:function(){var e=this.series[0];this.chartArea.border.width=this.stockChart?0:this.chartArea.border.width,e&&(this.requireInvertedAxis=-1!==e.type.indexOf("Bar")&&!this.isTransposed||-1===e.type.indexOf("Bar")&&this.isTransposed&&"PolarRadar"!==this.chartAreaType),this.chartAxisLayoutPanel="PolarRadar"===this.chartAreaType?this.polarSeriesModule||this.radarSeriesModule:new Ji(this)}},{key:"calculateVisibleAxis",value:function(){var e,i=[this.primaryXAxis,this.primaryYAxis];i="Cartesian"===this.chartAreaType?i.concat(this.axes):i,this.paretoSeriesModule&&"Pareto"===this.series[0].type&&(i=i.concat(this.paretoSeriesModule.paretoAxes)),this.axisCollections=[],this.zoomModule&&(this.zoomModule.isPanning=this.zoomModule.isAxisZoomed(i)&&this.zoomSettings.enablePan,this.svgObject.setAttribute("cursor",this.zoomModule.isPanning?"pointer":"auto"),this.scrollBarModule&&(this.scrollBarModule.axes=i)),this.scrollSettingEnabled&&this.scrollBarModule&&(this.scrollBarModule.axes=i);for(var n=0,r=i.length;n<r;n++){(e=i[n]).series=[],e.labels=[];var a,s=t(this.visibleSeries);try{for(s.s();!(a=s.n()).done;){var o=a.value;this.initAxis(o,e,!0)}}catch(d){s.e(d)}finally{s.f()}var l,h=t(this.indicators);try{for(h.s();!(l=h.n()).done;){var c=l.value;this.initAxis(c,e,!1)}}catch(d){h.e(d)}finally{h.f()}this.scrollBarModule&&!e.zoomingScrollBar&&this.scrollBarModule.injectTo(e,this),null!=e.orientation&&this.axisCollections.push(e)}this.rows.length>0&&this.columns.length>0&&this.chartAxisLayoutPanel.measure()}},{key:"initAxis",value:function(e,t,i){e.xAxisName===t.name||null==e.xAxisName&&"primaryXAxis"===t.name?(t.orientation=this.requireInvertedAxis?"Vertical":"Horizontal",e.xAxis=t,i&&t.series.push(e)):(e.yAxisName===t.name||null==e.yAxisName&&"primaryYAxis"===t.name)&&(t.orientation=this.requireInvertedAxis?"Horizontal":"Vertical",e.yAxis=t,i&&t.series.push(e))}},{key:"initTechnicalIndicators",value:function(){var e,i=0,n=t(this.indicators);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r,s=Dt(a.type);if(this[s+"IndicatorModule"]){a.index=i,this[s+"IndicatorModule"].initSeriesCollection(a,this);var o,l=t(a.targetSeries);try{for(l.s();!(o=l.n()).done;){var h=o.value;(r.seriesName||r.dataSource)&&this.visibleSeries.push(h)}}catch(c){l.e(c)}finally{l.f()}}i++}}catch(c){n.e(c)}finally{n.f()}}},{key:"refreshTechnicalIndicator",value:function(e){if(this.indicators.length)if(e instanceof hn&&"Indicator"!==e.category){var i,n=t(this.indicators);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.seriesName!==e.name||r.dataSource||r.setDataSource(e,this)}}catch(a){n.e(a)}finally{n.f()}}else e instanceof yn&&e.setDataSource(e instanceof hn?e:null,this)}},{key:"calculateVisibleSeries",value:function(){var e;this.visibleSeries=[];for(var t=this.palettes.length?this.palettes:Q(this.theme),i=t.length,n=this.series.sort(function(e,t){return e.zOrder-t.zOrder}),r=0,a=n.length;r<a;r++){switch((e=n[r]).category="Pareto"===n[0].type?"Pareto":"Series",e.index=r,e.interior=e.fill||t[r%i],e.type){case"Bar":case"StackingBar":case"StackingBar100":if(-1===n[0].type.indexOf("Bar"))continue;break;case"Polar":case"Radar":if("PolarRadar"!==this.chartAreaType)continue;if("PolarRadar"===this.chartAreaType&&(null===e.xAxisName&&null!==e.yAxisName||null!==e.xAxisName&&null===e.yAxisName||null!==e.xAxisName&&null!==e.yAxisName))continue;break;case"Pareto":this.visibleSeries.push(e),this.paretoSeriesModule.initSeries(e,this);continue;default:if("PolarRadar"===this.chartAreaType||n[0].type.indexOf("Bar")>-1)continue}this.visibleSeries.push(e),n[r]=e}}},{key:"renderTitle",value:function(){var e,t=this.margin;if(this.title){var i=this.titleStyle.textAlignment,n="Near"===i?"start":"Far"===i?"end":"middle",r=R(this.title,this.titleStyle);e=new L(t.left,0,this.availableSize.width-t.left-t.right,0);var a=new D(this.element.id+"_ChartTitle",vi(e,this.titleStyle),this.margin.top+3*r.height/4,n,this.titleCollection,"","auto"),s=ui(this.redraw,this.element.id+"_ChartTitle",a,this.renderer)||pi(this.renderer,a,this.titleStyle,this.titleStyle.color||this.themeStyle.chartTitle,this.svgObject,null,null,null,null,null,null,0,null,this.enableCanvas);s&&(s.setAttribute("aria-label",this.description||this.title),s.setAttribute("tabindex",this.tabIndex.toString())),this.subTitle&&this.renderSubTitle(a)}}},{key:"renderSubTitle",value:function(e){var i,n=0,r=0,a=this.titleStyle.textAlignment,s=t(this.titleCollection);try{for(s.s();!(i=s.n()).done;)n=(r=R(i.value,this.titleStyle).width)>n?r:n}catch(d){s.e(d)}finally{s.f()}var o=R(this.subTitle,this.subTitleStyle),l=new L("Center"===a?e.x-.5*n:"Far"===a?e.x-n:e.x,0,n,0),h=new D(this.element.id+"_ChartSubTitle",vi(l,this.subTitleStyle),e.y*e.text.length+3*o.height/4+10,function(e){return"Near"===e?"start":"Far"===e?"end":"middle"}(this.subTitleStyle.textAlignment),this.subTitleCollection,"","auto"),c=ui(this.redraw,this.element.id+"_ChartSubTitle",h,this.renderer)||pi(this.renderer,h,this.subTitleStyle,this.subTitleStyle.color||this.themeStyle.chartTitle,this.svgObject,null,null,null,null,null,null,0,null,this.enableCanvas);c&&(c.setAttribute("aria-label",this.description||this.subTitle),c.setAttribute("tabindex",this.tabIndex.toString()))}},{key:"renderBorder",value:function(){if(!this.stockChart){var e=this.border.width,t=this.backgroundImage,i=new Si(this.element.id+"_ChartBorder",t?"transparent":this.background||this.themeStyle.background,this.border,1,new L(.5*e,.5*e,this.availableSize.width-e,this.availableSize.height-e));if(this.htmlObject=ui(this.redraw,this.element.id+"_ChartBorder",i,this.renderer)||this.renderer.drawRectangle(i),$t(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw),t){var n=new wi(this.availableSize.height-e,this.availableSize.width-e,t,0,0,this.element.id+"_ChartBackground","visible","none");this.htmlObject=ui(this.redraw,this.element.id+"_ChartBackground",n,this.renderer)||this.renderer.drawImage(n),$t(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw)}}}},{key:"renderAreaBorder",value:function(){if("PolarRadar"===this.chartAreaType)return null;var e=Zt(this.element.id+"_ChartAreaBorder"),t=e?new L(+e.getAttribute("x"),+e.getAttribute("y"),+e.getAttribute("width"),+e.getAttribute("height")):null,i=new Si(this.element.id+"_ChartAreaBorder",this.chartArea.background,{width:this.chartArea.border.width,color:this.chartArea.border.color||this.themeStyle.areaBorder},this.chartArea.opacity,this.chartAxisLayoutPanel.seriesClipRect);this.htmlObject=this.renderer.drawRectangle(i),$t(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw,!0,"x","y",null,null,!0,!0,t),this.htmlObject=null;var n=this.chartArea.backgroundImage;if(n){var r=this.chartArea.border.width,a=new wi(this.initialClipRect.height-r,this.initialClipRect.width-r,n,this.initialClipRect.x,this.initialClipRect.y,this.element.id+"_ChartAreaBackground","visible","none");this.htmlObject=this.renderer.drawImage(a),$t(this.enableCanvas,this.svgObject,this.htmlObject,this.redraw,!0,"x","y",null,null,!0,!0)}}},{key:"addSeries",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r=new hn(this,"series",r),this.series.push(r)}}catch(a){n.e(a)}finally{n.f()}this.refresh()}},{key:"removeSeries",value:function(e){this.redraw=!1,this.series.splice(e,1),this.refresh()}},{key:"clearSeries",value:function(){this.series=[],this.refresh()}},{key:"addAxes",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r=new dt(this,"axes",r),this.isBlazor&&(r.interval=isNaN(r.interval)?null:r.interval,r.desiredIntervals=isNaN(r.desiredIntervals)?null:r.desiredIntervals),this.axes.push(r)}}catch(a){n.e(a)}finally{n.f()}this.refresh()}},{key:"removeAxis",value:function(e){this.redraw=!1,this.axes.splice(e,1),this.refresh()}},{key:"destroy",value:function(){this.scrollBarModule&&this.scrollBarModule.destroy(),this.markerRender&&(this.markerRender.removeEventListener(),this.markerRender=null),this.horizontalAxes=[],this.verticalAxes=[],this.visibleSeries=[],this.axisCollections=[],this.rotatedDataLabelCollections=[],this.seriesElements=null,this.chartAxisLayoutPanel=null,this.dataLabelCollections=null,this.dataLabelElements=null,this.yAxisElements=null,this.element&&(this.unWireEvents(),this.isReact&&this.clearTemplate(),r(p(n.prototype),"destroy",this).call(this),this.enableCanvas||(this.removeSvg(),this.svgObject=null))}},{key:"getModuleName",value:function(){return"chart"}},{key:"getPersistData",value:function(){return this.addOnPersist(["loaded","animationComplete","primaryXAxis","primaryYAxis"])}},{key:"createChartSvg",value:function(){this.removeSvg(),fi(this)}},{key:"unWireEvents",value:function(){var e=f.d.touchMoveEvent,t=f.d.touchEndEvent,i=f.d.isPointer?"pointerleave":"mouseleave";f.l.remove(this.element,f.d.touchStartEvent,this.chartOnMouseDown),f.l.remove(this.element,e,this.mouseMove),f.l.remove(this.element,t,this.mouseEnd),f.l.remove(this.element,"click",this.chartOnMouseClick),f.l.remove(this.element,"contextmenu",this.chartRightClick),f.l.remove(this.element,i,this.mouseLeave),window.removeEventListener(f.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.resizeBound),this.touchObject&&(this.touchObject.destroy(),this.touchObject=null)}},{key:"wireEvents",value:function(){if(this.element){var e=f.d.isPointer?"pointerleave":"mouseleave";f.l.add(this.element,f.d.touchStartEvent,this.chartOnMouseDown,this),f.l.add(this.element,f.d.touchMoveEvent,this.mouseMove,this),f.l.add(this.element,f.d.touchEndEvent,this.mouseEnd,this),f.l.add(this.element,"click",this.chartOnMouseClick,this),f.l.add(this.element,"contextmenu",this.chartRightClick,this),f.l.add(this.element,e,this.mouseLeave,this),this.resizeBound=this.chartResize.bind(this),window.addEventListener(f.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.resizeBound),this.longPressBound=this.longPress.bind(this),this.touchObject=new f.v(this.element,{tapHold:this.longPressBound,tapHoldThreshold:500}),this.setStyle(this.element)}}},{key:"chartRightClick",value:function(e){return!this.crosshair.enable||!this.crosshairModule||2!==e.buttons&&0!==e.which&&"touch"!==e.pointerType||(e.preventDefault(),e.stopPropagation(),!1)}},{key:"setStyle",value:function(e){var t=this.zoomSettings,i=t.enableSelectionZooming||t.enablePinchZooming||"None"!==this.selectionMode||this.crosshair.enable||"None"!==this.highlightMode;e.style.touchAction=i?"none":"element",e.style.msTouchAction=i?"none":"element",e.style.msContentZooming="none",e.style.msUserSelect="none",e.style.webkitUserSelect="none",e.style.position="relative",e.style.display="block",e.style.overflow="hidden"}},{key:"isOrientation",value:function(){return"orientation"in window&&"onorientationchange"in window}},{key:"longPress",value:function(e){return this.mouseX=e&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].clientX:0,this.mouseY=e&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].clientY:0,this.startMove=!0,this.setMouseXY(this.mouseX,this.mouseY),this.notify("tapHold",e),!1}},{key:"setMouseXY",value:function(e,t){if(Zt(this.svgId)){var i=Zt(this.svgId).getBoundingClientRect(),n=this.element.getBoundingClientRect();this.mouseY=t-n.top-Math.max(i.top-n.top,0),this.mouseX=e-n.left-Math.max(i.left-n.left,0)}}},{key:"export",value:function(e,t){this.exportModule&&(this.exportModule.export(e,t),this.afterExport&&this.exportModule.getDataUrl(this))}},{key:"chartResize",value:function(){var e=this;this.animateSeries=!1;var t={chart:this.isBlazor?{}:this,name:"resized",currentSize:new E(0,0),previousSize:new E(this.availableSize.width,this.availableSize.height)},i={name:"beforeResize",cancelResizedEvent:!1};return this.resizeTo&&clearTimeout(this.resizeTo),this.trigger("beforeResize",i),i.cancelResizedEvent||(this.resizeTo=+setTimeout(function(){e.isDestroyed||e.stockChart?clearTimeout(e.resizeTo):(e.createChartSvg(),t.currentSize=e.availableSize,e.trigger("resized",t),e.refreshAxis(),e.refreshBound(),e.trigger("loaded",{chart:e.isBlazor?{}:e}))},500)),!1}},{key:"mouseMove",value:function(e){var t,i,n;return"touchmove"===e.type?(this.isTouch=!0,t=(n=e).changedTouches[0].clientX,i=n.changedTouches[0].clientY):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType||this.isTouch,t=e.clientX,i=e.clientY),Zt(this.svgId)&&(this.setMouseXY(t,i),this.chartOnMouseMove(e)),!1}},{key:"mouseLeave",value:function(e){var t,i,n;return"touchleave"===e.type?(this.isTouch=!0,t=(n=e).changedTouches[0].clientX,i=n.changedTouches[0].clientY):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType,t=e.clientX,i=e.clientY),this.setMouseXY(t,i),this.chartOnMouseLeave(e),!1}},{key:"chartOnMouseLeave",value:function(e){var t=f.d.isPointer?"pointerleave":"mouseleave";return this.trigger("chartMouseLeave",{target:e.target.id,x:this.mouseX,y:this.mouseY}),ft(this.element.id+"_EJ2_AxisLabel_Tooltip"),this.isChartDrag=this.isPointMouseDown=!1,this.notify(t,e),!1}},{key:"chartOnMouseClick",value:function(e){var t,i=this;return this.trigger("chartMouseClick",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.clickCount++,t=this.isAngular?this.pointDoubleClick.observers.length>0?400:0:this.pointDoubleClick?400:0,1===this.clickCount&&this.pointClick?this.singleClickTimer=+setTimeout(function(){i.clickCount=0,i.triggerPointEvent("pointClick",e)},t):2===this.clickCount&&this.pointDoubleClick&&(clearTimeout(this.singleClickTimer),this.clickCount=0,this.triggerPointEvent("pointDoubleClick",e)),this.axisLabelClick&&this.triggerAxisLabelClickEvent("axisLabelClick",e),this.notify("click",e),!1}},{key:"triggerPointEvent",value:function(e,t){var i=t,n=new Qi(this).getData();n.series&&n.point&&this.trigger(e,{series:this.isBlazor?{}:n.series,point:n.point,seriesIndex:n.series.index,pointIndex:n.point.index,x:this.mouseX,y:this.mouseY,pageX:i.pageX,pageY:i.pageY})}},{key:"triggerAxisLabelClickEvent",value:function(e,t){var i=t.target,n=t;if(-1!==i.id.indexOf("_AxisLabel_")){var r=i.id.split("_AxisLabel_"),a=+r[0].slice(-1),s=+r[1],o=this.axisCollections[a];!o.visible||0!==a&&1!==a||this.trigger(e,{chart:this,axis:o,text:o.visibleLabels[s].text,labelID:i.id,index:s,location:new Ii(n.pageX,n.pageY),value:o.visibleLabels[s].value})}}},{key:"chartOnMouseMove",value:function(e){return this.trigger("chartMouseMove",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointMove&&this.triggerPointEvent("pointMove",e),this.isTouch||(this.titleTooltip(e,this.mouseX,this.mouseY),this.axisTooltip(e,this.mouseX,this.mouseY)),this.dataEditingModule&&this.dataEditingModule.pointMouseMove(e),this.notify(f.d.touchMoveEvent,e),this.isTouch=!1,!1}},{key:"titleTooltip",value:function(e,t,i,n){var r=e.target.id,a=r===this.element.id+"_ChartTitle"||r===this.element.id+"_ChartSubTitle"||r.indexOf("_AxisTitle")>-1||r.indexOf("_legend_title")>-1,s=0;r.indexOf("_AxisTitle")>-1&&(s=parseInt(r.replace(this.element.id,"").replace("AxisLabel_","").split("_")[2],10)),a&&e.target.textContent.indexOf("...")>-1?vt(r===this.element.id+"_ChartTitle"?this.title:r.indexOf("_AxisTitle")>-1?this.axisCollections[s].title:r.indexOf("_ChartSubTitle")>-1?this.subTitle:this.legendSettings.title,t,i,this.element.offsetWidth,this.element.id+"_EJ2_Title_Tooltip",Zt(this.element.id+"_Secondary_Element"),n):ft(this.element.id+"_EJ2_Title_Tooltip")}},{key:"axisTooltip",value:function(e,t,i,n){var r=e.target.id;if((r.indexOf("AxisLabel")>-1||r.indexOf("Axis_MultiLevelLabel")>-1)&&e.target.textContent.indexOf("...")>-1){var a=this.legendSettings.visible||""===this.primaryXAxis.title;vt(this.findAxisLabel(r),t,i,this.element.offsetWidth,this.element.id+"_EJ2_AxisLabel_Tooltip",Zt(this.element.id+"_Secondary_Element"),n,a)}else ft(this.element.id+"_EJ2_AxisLabel_Tooltip")}},{key:"findAxisLabel",value:function(e){var t;return e.indexOf("AxisLabel")>-1?(t=e.replace(this.element.id,"").replace("AxisLabel_","").split("_"),this.axisCollections[parseInt(t[0],10)].visibleLabels[parseInt(t[1],10)].originalText):(t=e.replace(this.element.id,"").replace("Axis_MultiLevelLabel_Level_","").replace("Text_","").split("_"),this.axisCollections[parseInt(t[0],10)].multiLevelLabels[parseInt(t[1],10)].categories[parseInt(t[2],10)].text)}},{key:"chartOnMouseDown",value:function(e){var t,i,n,r,a=f.d.isDevice?20:30,s=this.element.getBoundingClientRect();this.trigger("chartMouseDown",{target:e.target.id,x:this.mouseX,y:this.mouseY}),"touchstart"===e.type?(this.isTouch=!0,t=(r=e).changedTouches[0].clientX,i=r.changedTouches[0].clientY,n=r.target):(this.isTouch="touch"===e.pointerType,t=e.clientX,i=e.clientY,n=e.target);var o=Zt(this.svgId).getBoundingClientRect();return this.mouseDownX=this.previousMouseMoveX=t-s.left-Math.max(o.left-s.left,0),this.mouseDownY=this.previousMouseMoveY=i-s.top-Math.max(o.top-s.top,0),this.isTouch&&(this.isDoubleTap=(new Date).getTime()<this.threshold&&-1===n.id.indexOf(this.element.id+"_Zooming_")&&(this.mouseDownX-a>=this.mouseX||this.mouseDownX+a>=this.mouseX)&&(this.mouseDownY-a>=this.mouseY||this.mouseDownY+a>=this.mouseY)&&(this.mouseX-a>=this.mouseDownX||this.mouseX+a>=this.mouseDownX)&&(this.mouseY-a>=this.mouseDownY||this.mouseY+a>=this.mouseDownY)),this.dataEditingModule&&this.dataEditingModule.pointMouseDown(),this.notify(f.d.touchStartEvent,e),!1}},{key:"mouseEnd",value:function(e){var t,i,n;return"touchend"===e.type?(i=(n=e).changedTouches[0].clientX,this.isTouch=!0,t=n.changedTouches[0].clientY):(t=e.clientY,i=e.clientX,this.isTouch="touch"===e.pointerType||"2"===e.pointerType),this.setMouseXY(i,t),this.chartOnMouseUp(e),!1}},{key:"chartOnMouseUp",value:function(e){return this.trigger("chartMouseUp",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.isChartDrag=!1,this.isTouch&&(this.titleTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.axisTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.threshold=(new Date).getTime()+300),this.dataEditingModule&&this.dataEditingModule.pointMouseUp(),!this.enableCanvas&&this.seriesElements&&this.seriesElements.removeAttribute("clip-path"),this.notify(f.d.touchEndEvent,e),!1}},{key:"setCulture",value:function(){this.intl=new f.n,this.setLocaleConstants(),this.localeObject=new f.q(this.getModuleName(),this.defaultLocalConstants,this.locale)}},{key:"setAnnotationValue",value:function(e,t){var i,n=Zt(this.element.id+"_Annotation_Collections"),r=this.annotations[e];null!==t&&(r.content=t,n?(ft(this.element.id+"_Annotation_"+e),i=this.createElement("div"),this.annotationModule.processAnnotation(r,e,i),n.appendChild(i.children[0])):this.annotationModule.renderAnnotations(Zt(this.element.id+"_Secondary_Element")))}},{key:"setLocaleConstants",value:function(){this.defaultLocalConstants={ZoomIn:"Zoom in",Zoom:"Zoom",ZoomOut:"Zoom out",Pan:"Pan",Reset:"Reset",ResetZoom:"Reset Zoom"}}},{key:"setTheme",value:function(){this.themeStyle=$(this.theme)}},{key:"requiredModules",value:function(){var e,t,i=this,n=[],r=this.series,a=!1,s=!1,o=!1,l=this.zoomSettings;return this.chartAreaType=r.length>0&&("Polar"===r[0].type||"Radar"===r[0].type)?"PolarRadar":"Cartesian",this.tooltip.enable&&n.push({member:"Tooltip",args:[this]}),r.map(function(t){i.isLegend=i.legendSettings.visible&&(""!==t.name||!!i.isLegend),e=-1!==t.type.indexOf("100")?t.type.replace("100","")+"Series":t.type+"Series",a=t.errorBar.visible||a,o=t.marker.dataLabel.visible||o,s=t.dragSettings.enable||s,n.some(function(t){return t.member===e})||n.push({member:e,args:[i,r]}),"PolarRadar"===i.chartAreaType&&n.push({member:t.drawType+"Series",args:[i,r]}),"Pareto"===t.type&&(n.push({member:"ColumnSeries",args:[i,r]}),n.push({member:"LineSeries",args:[i,r]}))}),this.findIndicatorModules(n),this.findTrendLineModules(n),n=this.findAxisModule(n),t=this.annotations.some(function(e){return null!==e.content}),a&&n.push({member:"ErrorBar",args:[this,r]}),this.isLegend&&n.push({member:"Legend",args:[this]}),(this.enableExport||this.allowExport)&&n.push({member:"Export",args:[this]}),"PolarRadar"!==this.chartAreaType&&!this.scrollSettingEnabled&&(l.enableSelectionZooming||l.enableMouseWheelZooming||l.enablePinchZooming||l.enablePan||l.enableScrollbar)&&(n.push({member:"Zoom",args:[this,this.zoomSettings]}),l.enableScrollbar&&n.push({member:"ScrollBar",args:[this]})),"None"===this.selectionMode||"PolarRadar"===this.chartAreaType&&this.selectionMode.indexOf("Drag")>-1||n.push({member:"Selection",args:[this]}),"None"!==this.highlightMode&&n.push({member:"Highlight",args:[this]}),o&&n.push({member:"DataLabel",args:[this,r]}),s&&n.push({member:"DataEditing",args:[this]}),t&&n.push({member:"Annotation",args:[this]}),"PolarRadar"!==this.chartAreaType&&this.crosshair.enable&&n.push({member:"Crosshair",args:[this]}),n}},{key:"findAxisModule",value:function(e){var i=[];i.push(this.primaryXAxis),i.push(this.primaryYAxis);var n,r=!1,a=!1,s=!1,o=!1,l=!1,h=!1,c=t(i=i.concat(this.axes));try{for(c.s();!(n=c.n()).done;){var d=n.value;r="DateTime"===d.valueType||r,a="Category"===d.valueType||a,s="Logarithmic"===d.valueType||s,l="DateTimeCategory"===d.valueType||l,o=this.findStriplineVisibility(d.stripLines)||o,h=d.multiLevelLabels.length>0||h,this.scrollSettingEnabled=!!d.scrollbarSettings.enable||this.scrollSettingEnabled}}catch(u){c.e(u)}finally{c.f()}return r&&e.push({member:"DateTime",args:[this]}),a&&e.push({member:"Category",args:[this]}),s&&e.push({member:"Logarithmic",args:[this]}),o&&e.push({member:"StripLine",args:[this]}),h&&e.push({member:"MultiLevelLabel",args:[this]}),l&&e.push({member:"DateTimeCategory",args:[this]}),this.scrollSettingEnabled&&e.push({member:"ScrollBar",args:[this]}),e}},{key:"findIndicatorModules",value:function(e){var i,n,r=this.indicators;if(this.indicators.length){e.push({member:"LineSeries",args:[this]}),r.map(function(e){i=i||"Macd"===e.type,n=n||"BollingerBands"===e.type}),i&&e.push({member:"ColumnSeries",args:[this]}),n&&e.push({member:"RangeAreaSeries",args:[this]}),n&&e.push({member:"SplineRangeAreaSeries",args:[this]});var a,s=t(this.indicators);try{for(s.s();!(a=s.n()).done;){var o=a.value;e.push({member:o.type+"Indicator",args:[this]})}}catch(l){s.e(l)}finally{s.f()}}}},{key:"findTrendLineModules",value:function(e){var i,n,r,a=this,s=t(this.series);try{var o=function(){var t=r.value,s=void 0;t.trendlines.map(function(e){s=s||e.marker.visible,i=!(!i&&"Linear"!==e.type&&"MovingAverage"!==e.type),n=!(!n&&i)}),s&&e.push({member:"Marker",args:[a,t]})};for(s.s();!(r=s.n()).done;)o()}catch(l){s.e(l)}finally{s.f()}(i||n)&&e.push({member:"TrendLine",args:[this]}),i&&e.push({member:"LineSeries",args:[this]}),n&&e.push({member:"SplineSeries",args:[this]})}},{key:"findStriplineVisibility",value:function(e){var i,n=!1,r=t(e);try{for(r.s();!(i=r.n()).done;)if(i.value.visible){n=!0;break}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"removeSvg",value:function(){if(this.redraw)return null;if(Ci(this),this.enableCanvas&&this.svgObject&&"CANVAS"===this.svgObject.tagName)return this.renderer.clearRect(new L(0,0,this.availableSize.width,this.availableSize.height)),this.svgObject.parentNode&&Object(f.kb)(this.svgObject),null;ft(this.element.id+"_Secondary_Element"),this.isReact&&this.clearTemplate();var e=0;if(this.zoomModule&&this.zoomModule.pinchTarget&&(this.zoomModule.pinchTarget.id="",this.zoomModule.pinchTarget.setAttribute("opacity","0"),this.svgObject.appendChild(this.zoomModule.pinchTarget),e=1),!Object(f.Z)(this.resizeTo)){if(this.resizeTo!==this.checkResize&&this.isBlazor&&this.element.childElementCount)for(var t=document.querySelectorAll(".e-chart"),i=0;i<t.length;i++)for(var n=t[i];n.firstChild;)Object(f.kb)(n.firstChild);this.checkResize=this.resizeTo}if(this.svgObject){for(;this.svgObject.childNodes.length>e;)this.svgObject.removeChild(this.svgObject.firstChild);this.svgObject.hasChildNodes()||!this.svgObject.parentNode||this.stockChart||Object(f.kb)(this.svgObject)}}},{key:"refreshDefinition",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;)i.value.axes=[]}catch(r){n.e(r)}finally{n.f()}}},{key:"refreshAxis",value:function(){var e=this.primaryXAxis;e.rect=new L(void 0,void 0,0,0),(e=this.primaryYAxis).isStack100=!1,e.rect=new L(void 0,void 0,0,0);var i,n=t(this.axes);try{for(n.s();!(i=n.n()).done;)(e=i.value).rect=new L(void 0,void 0,0,0),e.isStack100=!1}catch(s){n.e(s)}finally{n.f()}if(this.paretoSeriesModule&&"Pareto"===this.series[0].type){var r,a=t(this.paretoSeriesModule.paretoAxes);try{for(a.s();!(r=a.n()).done;)(e=r.value).rect=new L(void 0,void 0,0,0),e.isStack100=!1}catch(s){a.e(s)}finally{a.f()}}}},{key:"axisChange",value:function(e){return!(!e.name&&!e.valueType||(this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(),0))}},{key:"getVisibleSeries",value:function(e,i){var n,r=t(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(i===a.index)return a}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"refreshLiveData",value:function(){this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(!1),this.isBlazor||(this.enableCanvas?this.createChartSvg():this.removeSvg(),this.refreshAxis(),this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}))}},{key:"removeStyles",value:function(){ft(this.element.id+"_ej2_chart_selection"),ft(this.element.id+"_ej2_chart_highlight")}},{key:"onPropertyChanged",value:function(e,t){var i=!1,n=!1;if(this.animateSeries=!1,!this.delayRedraw){for(var r=0,a=Object.keys(e);r<a.length;r++)switch(a[r]){case"primaryXAxis":n=this.axisChange(e.primaryXAxis),e.primaryXAxis.edgeLabelPlacement&&(i=!0),e.primaryXAxis.crosshairTooltip||(n=!0);break;case"primaryYAxis":n=this.axisChange(e.primaryYAxis),e.primaryYAxis.edgeLabelPlacement&&(i=!0),e.primaryYAxis.crosshairTooltip||(n=!0);break;case"axes":for(var s=0,o=Object.keys(e.axes);s<o.length;s++){var l=o[s];n=n||this.axisChange(e.axes[l]),e.axes[l].crosshairTooltip||(n=!0)}break;case"height":case"width":this.createChartSvg(),n=!0;break;case"subTitle":case"title":n=!0;break;case"titleStyle":e.titleStyle&&(e.titleStyle.size||e.titleStyle.textOverflow)?n=!0:i=!0;break;case"subTitleStyle":e.subTitleStyle&&(e.subTitleStyle.size||e.subTitleStyle.textOverflow)?n=!0:i=!0;break;case"border":i=!0;break;case"dataSource":this.processData(!1),n=!0;break;case"enableCanvas":this.refresh();break;case"series":for(var h=void 0,c=void 0,d=this.series.length,u=!1,p=0;p<d;p++)h=e.series[p],this.isBlazor&&h&&(h.visible!==t.series[p].visible||h.isClosed||h.marker||h.emptyPointSettings||h.type||h.boxPlotMode||h.showMean)&&(c=!0),h&&(h.dataSource||h.query||h.errorBar||h.xName||h.yName||h.size||h.high||h.low||h.open||h.close||h.fill||h.name||h.marker||c)&&(Object(f.L)(this.getVisibleSeries(this.visibleSeries,p),h,null,!0),u=!0);u&&(this.calculateVisibleSeries(),this.initTechnicalIndicators(),this.initTrendLines(),this.refreshDefinition(this.columns),this.refreshDefinition(this.rows),this.calculateVisibleAxis(),this.processData(!1),n=!0);break;case"indicators":n=!0;break;case"zoomSettings":(e.zoomSettings.enableScrollbar||t.zoomSettings.enableScrollbar)&&(n=!0),i=!0;break;case"background":i=!0;break;case"chartArea":e.chartArea.border&&e.chartArea.border.width&&(n=!0),i=!0;break;case"legendSettings":e.legendSettings.background&&e.legendSettings.opacity||(n=!0),i=!0;break;case"palettes":this.calculateVisibleSeries(),i=!0;break;case"selectedDataIndexes":this.selectionModule&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.selectedDataIndexes=this.selectedDataIndexes,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode,!0));break;case"selectionMode":this.selectionModule&&e.selectionMode&&-1===e.selectionMode.indexOf("Drag")&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode,!0));break;case"isMultiSelect":this.selectionModule&&!e.isMultiSelect&&this.selectionModule.selectedDataIndexes.length>1&&(this.selectionModule.currentMode=this.selectionMode,this.selectionModule.styleId=this.element.id+"_ej2_chart_selection",this.selectionModule.redrawSelection(this,t.selectionMode));break;case"highlightMode":case"selectionPattern":case"highlightPattern":this.removeStyles(),i=!0;break;case"theme":this.animateSeries=!0;break;case"locale":case"currencyCode":this.isBlazor?(this.setCulture(),i=!0):this.refresh();break;case"tooltip":this.tooltipModule&&(this.tooltipModule.previousPoints=[])}!n&&i&&(this.removeSvg(),this.renderElements(),this.trigger("loaded",{chart:this.isBlazor?{}:this})),n&&(this.enableCanvas?this.createChartSvg():this.removeSvg(),this.isReact&&this.clearTemplate(),this.refreshAxis(),this.refreshBound(),this.trigger("loaded",{chart:this.isBlazor?{}:this}),this.redraw=!1,this.animated=!1)}}}]),n}(f.h),Cn([Object(f.t)(null)],Ui.prototype,"width",void 0),Cn([Object(f.t)(null)],Ui.prototype,"height",void 0),Cn([Object(f.t)("")],Ui.prototype,"title",void 0),Cn([Object(f.t)("")],Ui.prototype,"dataSource",void 0),Cn([Object(f.g)(V.chartTitleFont,Te)],Ui.prototype,"titleStyle",void 0),Cn([Object(f.t)("")],Ui.prototype,"subTitle",void 0),Cn([Object(f.g)(V.chartSubTitleFont,Te)],Ui.prototype,"subTitleStyle",void 0),Cn([Object(f.g)({},Fe)],Ui.prototype,"margin",void 0),Cn([Object(f.g)({color:"#DDDDDD",width:0},je)],Ui.prototype,"border",void 0),Cn([Object(f.t)(null)],Ui.prototype,"background",void 0),Cn([Object(f.g)({border:{color:null,width:.5},background:"transparent"},Me)],Ui.prototype,"chartArea",void 0),Cn([Object(f.g)({name:"primaryXAxis"},dt)],Ui.prototype,"primaryXAxis",void 0),Cn([Object(f.g)({name:"primaryYAxis"},dt)],Ui.prototype,"primaryYAxis",void 0),Cn([Object(f.f)([{}],nt)],Ui.prototype,"rows",void 0),Cn([Object(f.f)([{}],rt)],Ui.prototype,"columns",void 0),Cn([Object(f.f)([{}],dt)],Ui.prototype,"axes",void 0),Cn([Object(f.f)([{}],hn)],Ui.prototype,"series",void 0),Cn([Object(f.f)([{}],Xe)],Ui.prototype,"annotations",void 0),Cn([Object(f.t)([])],Ui.prototype,"palettes",void 0),Cn([Object(f.t)("Material")],Ui.prototype,"theme",void 0),Cn([Object(f.g)({},Ue)],Ui.prototype,"tooltip",void 0),Cn([Object(f.g)({},Sn)],Ui.prototype,"crosshair",void 0),Cn([Object(f.g)({},gn)],Ui.prototype,"legendSettings",void 0),Cn([Object(f.f)([{}],xn)],Ui.prototype,"rangeColorSettings",void 0),Cn([Object(f.g)({},wn)],Ui.prototype,"zoomSettings",void 0),Cn([Object(f.t)("None")],Ui.prototype,"selectionMode",void 0),Cn([Object(f.t)("None")],Ui.prototype,"highlightMode",void 0),Cn([Object(f.t)("None")],Ui.prototype,"selectionPattern",void 0),Cn([Object(f.t)("None")],Ui.prototype,"highlightPattern",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"isMultiSelect",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"allowMultiSelection",void 0),Cn([Object(f.t)(!0)],Ui.prototype,"enableExport",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"allowExport",void 0),Cn([Object(f.f)([],Be)],Ui.prototype,"selectedDataIndexes",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"useGroupingSeparator",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"enableAutoIntervalOnBothAxis",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"isTransposed",void 0),Cn([Object(f.t)(!1)],Ui.prototype,"enableCanvas",void 0),Cn([Object(f.t)(null)],Ui.prototype,"backgroundImage",void 0),Cn([Object(f.f)([],yn)],Ui.prototype,"indicators",void 0),Cn([Object(f.t)(!0)],Ui.prototype,"enableAnimation",void 0),Cn([Object(f.t)(null)],Ui.prototype,"description",void 0),Cn([Object(f.t)(1)],Ui.prototype,"tabIndex",void 0),Cn([Object(f.t)(!0)],Ui.prototype,"enableSideBySidePlacement",void 0),Cn([Object(f.k)()],Ui.prototype,"resized",void 0),Cn([Object(f.k)()],Ui.prototype,"beforeResize",void 0),Cn([Object(f.k)()],Ui.prototype,"annotationRender",void 0),Cn([Object(f.k)()],Ui.prototype,"beforePrint",void 0),Cn([Object(f.k)()],Ui.prototype,"loaded",void 0),Cn([Object(f.k)()],Ui.prototype,"beforeExport",void 0),Cn([Object(f.k)()],Ui.prototype,"afterExport",void 0),Cn([Object(f.k)()],Ui.prototype,"load",void 0),Cn([Object(f.k)()],Ui.prototype,"animationComplete",void 0),Cn([Object(f.k)()],Ui.prototype,"legendRender",void 0),Cn([Object(f.k)()],Ui.prototype,"textRender",void 0),Cn([Object(f.k)()],Ui.prototype,"pointRender",void 0),Cn([Object(f.k)()],Ui.prototype,"seriesRender",void 0),Cn([Object(f.k)()],Ui.prototype,"axisLabelRender",void 0),Cn([Object(f.k)()],Ui.prototype,"axisLabelClick",void 0),Cn([Object(f.k)()],Ui.prototype,"axisRangeCalculated",void 0),Cn([Object(f.k)()],Ui.prototype,"axisMultiLabelRender",void 0),Cn([Object(f.k)()],Ui.prototype,"legendClick",void 0),Cn([Object(f.k)()],Ui.prototype,"multiLevelLabelClick",void 0),Cn([Object(f.k)()],Ui.prototype,"tooltipRender",void 0),Cn([Object(f.k)()],Ui.prototype,"sharedTooltipRender",void 0),Cn([Object(f.k)()],Ui.prototype,"chartMouseMove",void 0),Cn([Object(f.k)()],Ui.prototype,"chartMouseClick",void 0),Cn([Object(f.k)()],Ui.prototype,"pointClick",void 0),Cn([Object(f.k)()],Ui.prototype,"pointDoubleClick",void 0),Cn([Object(f.k)()],Ui.prototype,"pointMove",void 0),Cn([Object(f.k)()],Ui.prototype,"chartMouseLeave",void 0),Cn([Object(f.k)()],Ui.prototype,"chartMouseDown",void 0),Cn([Object(f.k)()],Ui.prototype,"chartMouseUp",void 0),Cn([Object(f.k)()],Ui.prototype,"dragComplete",void 0),Cn([Object(f.k)()],Ui.prototype,"selectionComplete",void 0),Cn([Object(f.k)()],Ui.prototype,"zoomComplete",void 0),Cn([Object(f.k)()],Ui.prototype,"onZooming",void 0),Cn([Object(f.k)()],Ui.prototype,"scrollStart",void 0),Cn([Object(f.k)()],Ui.prototype,"scrollEnd",void 0),Cn([Object(f.k)()],Ui.prototype,"scrollChanged",void 0),Cn([Object(f.k)()],Ui.prototype,"dragStart",void 0),Cn([Object(f.k)()],Ui.prototype,"drag",void 0),Cn([Object(f.k)()],Ui.prototype,"dragEnd",void 0),Cn([Object(f.t)("USD")],Ui.prototype,"currencyCode",void 0),Ui=Cn([f.r],Ui)),In=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"calculateDateTimeNiceInterval",value:function(e,t,i,n){var r,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new Date(i),o=new Date(n),l=Math.abs((s.getTime()-o.getTime())/864e5);switch(e.actualIntervalType=e.intervalType,e.intervalType){case"Years":r=this.calculateNumericNiceInterval(e,l/365,t);break;case"Quarter":r=this.calculateNumericNiceInterval(e,l/365*4,t);break;case"Months":r=this.calculateNumericNiceInterval(e,l/30,t);break;case"Weeks":r=this.calculateNumericNiceInterval(e,l/7,t);break;case"Days":r=this.calculateNumericNiceInterval(e,l,t);break;case"Hours":r=this.calculateNumericNiceInterval(e,24*l,t);break;case"Minutes":r=this.calculateNumericNiceInterval(e,24*l*60,t);break;case"Seconds":r=this.calculateNumericNiceInterval(e,24*l*60*60,t);break;case"Auto":return(r=this.calculateNumericNiceInterval(e,l/365,t))>=1?(e.actualIntervalType="Years",r):(r=this.calculateNumericNiceInterval(e,l/365*4,t))>=1&&!a?(e.actualIntervalType="Quarter",r):(r=this.calculateNumericNiceInterval(e,l/30,t))>=1?(e.actualIntervalType="Months",r):(r=this.calculateNumericNiceInterval(e,l/7,t))>=1&&!a?(e.actualIntervalType="Weeks",r):(r=this.calculateNumericNiceInterval(e,l,t))>=1?(e.actualIntervalType="Days",r):(r=this.calculateNumericNiceInterval(e,24*l,t))>=1?(e.actualIntervalType="Hours",r):(r=this.calculateNumericNiceInterval(e,24*l*60,t))>=1?(e.actualIntervalType="Minutes",r):(r=this.calculateNumericNiceInterval(e,24*l*60*60,t),e.actualIntervalType="Seconds",r)}return r}},{key:"getSkeleton",value:function(e,t,i,n){var r=e.actualIntervalType;return e.skeleton?e.skeleton:"Years"===r?n?"y":e.isChart?"DateTime"===e.valueType&&e.isIntervalInDecimal?"y":"yMMM":"y":"Quarter"===r?n?"y":"yMMM":"Months"===r?n?"m":e.isChart?"MMMd":"MMM":"Weeks"===r?n?"m":"MEd":"Days"===r?n?"d":e.isChart?this.getDayFormat(e,t,i):"MMMd":"Hours"===r?n?"t":e.isChart?"DateTime"===e.valueType?"Hm":"EHm":"h":"Minutes"===r?n?"T":e.isChart?"Hms":"hm":n?"T":e.isChart?"Hms":"hms"}},{key:"getMonthFormat",value:function(e,t,i){return new Date(t).getFullYear()===new Date(i).getFullYear()?e.isIntervalInDecimal?"MMM":"MMM d":"y MMM"}},{key:"getDayFormat",value:function(e,t,i){return"DateTime"===e.valueType?new Date(t).getMonth()!==new Date(i).getMonth()?"MMMd":e.isIntervalInDecimal?"d":"Ehm":"yMd"}},{key:"findCustomFormats",value:function(e,t,i){var n=e.labelFormat?e.labelFormat:"";return!e.isChart||e.skeleton||"Months"!==e.actualIntervalType||n||(n="DateTime"===e.valueType?this.getMonthFormat(e,t,i):"yMMM"),n}}]),i}(We),On=function(){function e(t){a(this,e),this.chart=t}return o(e,[{key:"enableComplexProperty",value:function(e){var i,n,r=[],a=[],s=e.xAxis.visibleRange,o=e.yAxis.visibleRange,l=e.points,h=e.clipRect,c=Math.abs(s.delta/h.width),d=Math.abs(o.delta/h.height),u=l[0]&&l[0].x>c?0:c,p=l[0]&&l[0].y>d?0:d,g=0,m=0,v=t(l);try{for(v.s();!(n=v.n()).done;){var y=n.value;y.symbolLocations=[],g=y.xValue?y.xValue:s.min,m=y.yValue?y.yValue:o.min,(Math.abs(u-g)>=c||Math.abs(p-m)>=d)&&(r.push(y),u=g,p=m)}}catch(C){v.e(C)}finally{v.f()}for(var b=0;b<r.length;b++)i=r[b],Object(f.Z)(i.x)||""===i.x||a.push(i);return a}},{key:"getLineDirection",value:function(e,t,i,n,r,a){var s="";if(null!=e){var o=r(e.xValue,e.yValue,i.xAxis,i.yAxis,n,i),l=r(t.xValue,t.yValue,i.xAxis,i.yAxis,n,i);s=a+" "+o.x+" "+o.y+" L "+l.x+" "+l.y+" "}return s}},{key:"appendLinePath",value:function(e,t,i){var n=Zt(e.id),r=t.chart,a=n?n.getAttribute("d"):null,s=t.chart.renderer.drawPath(e,new Int32Array([t.clipRect.x,t.clipRect.y]));s&&s.setAttribute("clip-path",i),t.pathElement=s,t.chart.enableCanvas||t.seriesElement.appendChild(s),t.isRectSeries=!1,Bt(n,e.d,t.chart.redraw,a,r.duration)}},{key:"renderMarker",value:function(e){e.marker&&e.marker.visible&&e.chart.markerRender.render(e)}},{key:"doProgressiveAnimation",value:function(e,t){var i,n=new f.b({}),r=e.pathElement,a=r.getAttribute("stroke-dasharray"),s=e.pathElement.getTotalLength();r.style.visibility="hidden",n.animate(r,{duration:t.duration,delay:t.delay,progress:function(e){e.timeStamp>=e.delay&&(r.style.visibility="visible",i=Math.abs(Math.round((e.timeStamp-e.delay)*s/e.duration)),r.setAttribute("stroke-dasharray",i+","+s))},end:function(){r.setAttribute("stroke-dasharray",a),e.chart.trigger("animationComplete",{series:e.chart.isBlazor?{}:e})}})}},{key:"storePointLocation",value:function(e,t,i,n){var r=t.marker&&t.marker.width?t.marker.width:0,a=t.marker&&t.marker.height?t.marker.height:0;e.symbolLocations.push(n(e.xValue,e.yValue,t.xAxis,t.yAxis,i,t)),e.regions.push(new L(e.symbolLocations[0].x-r,e.symbolLocations[0].y-a,2*r,2*a))}},{key:"withinYRange",value:function(e,t){return e.yValue>=t.visibleRange.min&&e.yValue<=t.visibleRange.max}},{key:"getFirstLastVisiblePoint",value:function(e){var i,n=null,r=null,a=t(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;null===n&&s.visible&&(n=r=s),r=s.visible?s:r}}catch(o){a.e(o)}finally{a.f()}return{first:n||e[0],last:r||e[e.length-1]}}},{key:"doLinearAnimation",value:function(e,t){var i,n=e.clipRectElement.childNodes[0].childNodes[0],r=e.chart.animated?e.chart.duration:t.duration,a=Ft("Linear"),s=+n.getAttribute("height"),o=+n.getAttribute("width"),l=+n.getAttribute("x"),h=e.chart.requireInvertedAxis?+n.getAttribute("height")+ +n.getAttribute("y"):+n.getAttribute("y");n.style.visibility="hidden",new f.b({}).animate(n,{duration:r,delay:t.delay,progress:function(t){t.timeStamp>=t.delay&&(n.style.visibility="visible",e.chart.requireInvertedAxis?(i=a(t.timeStamp-t.delay,0,s,t.duration),n.setAttribute("transform","translate("+l+" "+h+") scale(1,"+i/s+") translate("+-l+" "+-h+")")):(i=a(t.timeStamp-t.delay,0,o,t.duration),n.setAttribute("transform","translate("+l+" "+h+") scale("+i/o+", 1) translate("+-l+" "+-h+")")))},end:function(){n.setAttribute("transform","translate(0,0)"),e.chart.trigger("animationComplete",{series:e.chart.isBlazor?{}:e})}})}}]),e}(),Rn=function(){function e(){a(this,e)}return o(e,[{key:"getSideBySideInfo",value:function(e){e.chart.enableSideBySidePlacement&&!e.position&&this.getSideBySidePositions(e);var t=e.chart.enableSideBySidePlacement?e.position:0,i=e.chart.enableSideBySidePlacement?e.rectCount:1;e.isRectSeries=!0;var n,r=e.chart.visibleSeries,a=e.chart.enableSideBySidePlacement?e.columnSpacing:0,s=null===e.columnWidth||isNaN(+e.columnWidth)?"Histogram"===e.type?1:.7:e.columnWidth,o=Mt(e.xAxis,r)*s,l=t/i-.5,h=new qe(l,l+1/i);return isNaN(h.start)||isNaN(h.end)||(n=a*(h=new qe(h.start*o,h.end*o)).delta,h=new qe(h.start+n/2,h.end-n/2)),h}},{key:"getRectangle",value:function(e,t,i,n,r){var a=Qt(e,t,r.xAxis,r.yAxis,r.chart.requireInvertedAxis),s=Qt(i,n,r.xAxis,r.yAxis,r.chart.requireInvertedAxis);return new L(Math.min(a.x,s.x),Math.min(a.y,s.y),Math.abs(s.x-a.x),Math.abs(s.y-a.y))}},{key:"getSideBySidePositions",value:function(e){var i,n=e.chart,r=t(n.columns);try{for(r.s();!(i=r.n()).done;){var a,s=i.value,o=t(n.rows);try{for(o.s();!(a=o.n()).done;){var l=a.value;this.findRectPosition(e.findSeriesCollection(s,l,!1))}}catch(h){o.e(h)}finally{o.f()}}}catch(h){r.e(h)}finally{r.f()}}},{key:"findRectPosition",value:function(e){for(var t=[],i={rectCount:0,position:null},n=0;n<e.length;n++){var r=e[n];-1!==r.type.indexOf("Stacking")?r.stackingGroup?void 0===t[r.stackingGroup]?(r.position=i.rectCount,t[r.stackingGroup]=i.rectCount++):r.position=t[r.stackingGroup]:null===i.position?(r.position=i.rectCount,i.position=i.rectCount++):r.position=i.position:r.position=i.rectCount++}for(var a=0;a<e.length;a++)e[a].rectCount=i.rectCount}},{key:"updateSymbolLocation",value:function(e,t,i){i.chart.requireInvertedAxis?this.updateYRegion(e,t,i):this.updateXRegion(e,t,i),"Histogram"===i.type&&(e.minimum=+e.x-i.histogramValues.binWidth/2,e.maximum=+e.x+i.histogramValues.binWidth/2)}},{key:"updateXRegion",value:function(e,t,i){e.symbolLocations.push({x:t.x+t.width/2,y:"BoxPlot"===i.seriesType||-1!==i.seriesType.indexOf("HighLow")||e.yValue>=0==!i.yAxis.isInversed?t.y:t.y+t.height}),this.getRegion(e,t,i),"RangeColumn"===i.type&&e.symbolLocations.push({x:t.x+t.width/2,y:t.y+t.height})}},{key:"updateYRegion",value:function(e,t,i){e.symbolLocations.push({x:"BoxPlot"===i.seriesType||-1!==i.seriesType.indexOf("HighLow")||e.yValue>=0==!i.yAxis.isInversed?t.x+t.width:t.x,y:t.y+t.height/2}),this.getRegion(e,t,i),"RangeColumn"===i.type&&e.symbolLocations.push({x:t.x,y:t.y+t.height/2})}},{key:"renderMarker",value:function(e){e.marker&&e.marker.visible&&e.chart.markerRender.render(e)}},{key:"getRegion",value:function(e,t,i){if(0===e.y){var n=i.marker&&i.marker.width?i.marker.width:0,r=i.marker&&i.marker.height?i.marker.height:0;e.regions.push(new L(e.symbolLocations[0].x-n,e.symbolLocations[0].y-r,2*n,2*r))}else e.regions.push(t)}},{key:"triggerEvent",value:function(e,t,i,n){var r={cancel:!1,name:"pointRender",series:e,point:t,fill:e.setPointColor(t,i),border:e.setBorderColor(t,n)};return e.chart.trigger("pointRender",r),t.color=r.fill,r}},{key:"drawRectangle",value:function(e,t,i,n){var r,a=e.chart;if((a.requireInvertedAxis?i.height:i.width)<=0)return null;r=0===t.y?this.calculateRoundedRectPath(i,0,0,0,0):this.calculateRoundedRectPath(i,e.cornerRadius.topLeft,e.cornerRadius.topRight,e.cornerRadius.bottomLeft,e.cornerRadius.bottomRight);var s="Indicator"===e.category?a.element.id+"_Indicator_"+e.index+"_"+e.name+"_Point_"+t.index:a.element.id+"_Series_"+e.index+"_Point_"+t.index,o=ui(a.redraw,s),l=o?o.getAttribute("d"):"",h=new U(s,n.fill,n.border.width,n.border.color,e.opacity,e.dashArray,r),c=a.renderer.drawPath(h,new Int32Array([e.clipRect.x,e.clipRect.y]));switch(e.seriesType){case"XY":c.setAttribute("aria-label",t.x.toString()+":"+t.yValue.toString());break;case"HighLow":c.setAttribute("aria-label",t.x.toString()+":"+t.high.toString()+":"+t.low.toString())}$t(e.chart.enableCanvas,e.seriesElement,c,a.redraw),e.chart.enableCanvas||Bt(c,r,a.redraw,l,a.duration)}},{key:"animate",value:function(e){var i,n=e.seriesElement.childNodes,r="Indicator"===e.category?0:1,a=t(gt(e));try{for(a.s();!(i=a.n()).done;){var s=i.value;(s.symbolLocations.length||"BoxAndWhisker"===e.type&&s.regions.length)&&(this.animateRect(n[r],e,s),r++)}}catch(o){a.e(o)}finally{a.f()}}},{key:"animateRect",value:function(e,t,i){var n,r,a,s,o,l=t.animation,h=t.chart.animated?t.chart.duration:l.duration,c=Ft("Linear"),d=i.yValue<0,u=+i.regions[0].height,p=+i.regions[0].width;t.chart.requireInvertedAxis?(r=+i.regions[0].y,t.type.indexOf("Stacking")>-1?(n=Et(0,t.yAxis)*t.yAxis.rect.width,a=n,s=r):(n=+i.regions[0].x,s=d?r:r+u,a=-1!==t.seriesType.indexOf("HighLow")||-1!==t.type.indexOf("Waterfall")?n+p/2:d!==t.yAxis.isInversed?n+p:n)):(n=+i.regions[0].x,t.type.indexOf("Stacking")>-1?(r=(1-Et(0,t.yAxis))*t.yAxis.rect.height,a=n,s=r):(r=+i.regions[0].y,s=-1!==t.seriesType.indexOf("HighLow")||-1!==t.type.indexOf("Waterfall")?r+u/2:d!==t.yAxis.isInversed?r:r+u,a=d?n:n+p)),Object(f.Z)(e)||(e.style.visibility="hidden",new f.b({}).animate(e,{duration:h,delay:l.delay,progress:function(i){i.timeStamp>=i.delay&&(e.style.visibility="visible",t.chart.requireInvertedAxis?(p=p||1,o=c(i.timeStamp-i.delay,0,p,i.duration),e.setAttribute("transform","translate("+a+" "+s+") scale("+o/p+", 1) translate("+-a+" "+-s+")")):(u=u||1,o=c(i.timeStamp-i.delay,0,u,i.duration),e.setAttribute("transform","translate("+a+" "+s+") scale(1,"+o/u+") translate("+-a+" "+-s+")")))},end:function(){e.setAttribute("transform","translate(0,0)");var n=t.seriesElement;if((e===n.lastElementChild||i.index===t.points.length-1||"Waterfall"===t.type&&e===n.children[n.childElementCount-2])&&(t.chart.trigger("animationComplete",{series:t.chart.isBlazor?{}:t}),"Waterfall"===t.type))for(var r=n.childNodes,a=0;a<r.length;a++)-1!==r[a].id.indexOf("Connector")&&(r[a].style.visibility="visible",r[a].setAttribute("transform","translate(0,0)"))}}))}},{key:"calculateRoundedRectPath",value:function(e,t,i,n,r){return"M "+e.x+" "+(t+e.y)+" Q "+e.x+" "+e.y+" "+(e.x+t)+" "+e.y+" L "+(e.x+e.width-i)+" "+e.y+" Q "+(e.x+e.width)+" "+e.y+" "+(e.x+e.width)+" "+(e.y+i)+" L "+(e.x+e.width)+" "+(e.y+e.height-r)+" Q "+(e.x+e.width)+" "+(e.y+e.height)+" "+(e.x+e.width-r)+" "+(e.y+e.height)+" L "+(e.x+n)+" "+(e.y+e.height)+" Q "+e.x+" "+(e.y+e.height)+" "+e.x+" "+(e.y+e.height-n)+" L "+e.x+" "+(t+e.y)+" Z"}}]),e}(),An=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"getAreaPathDirection",value:function(e,t,i,n,r,a,s){var o,l="";return null===a&&(l+=s+" "+(o=r(e,t,i.xAxis,i.yAxis,n,i)).x+" "+o.y+" "),l}},{key:"getAreaEmptyDirection",value:function(e,t,i,n,r){var a="";return a+=this.getAreaPathDirection(e.x,e.y,i,n,r,null,"L"),a+=this.getAreaPathDirection(t.x,t.y,i,n,r,null,"L")}},{key:"setPointColor",value:function(e,t,i,n,r){if(""===i.pointColorMapping){for(var a,s=0;s<r.length;s++)if(a=r[s],(n?e.xValue:e.yValue)<=this.getAxisValue(a.value,n?i.xAxis:i.yAxis,i.chart)||!a.value){e.interior=a.color;break}return null==e.interior&&(e.interior=i.interior),!1}return!!t&&i.setPointColor(e,i.interior)!==i.setPointColor(t,i.interior)}},{key:"sortSegments",value:function(e,t){var i=this,n="X"===e.segmentAxis?e.xAxis:e.yAxis;return[].concat(t).sort(function(t,r){return i.getAxisValue(t.value,n,e.chart)-i.getAxisValue(r.value,n,e.chart)})}},{key:"applySegmentAxis",value:function(e,t,i){var n=this;if(""!==e.pointColorMapping)return t.map(function(t){n.appendLinePath(t,e,"")}),null;var r,a="X"===e.segmentAxis,s=a?e.xAxis:e.yAxis,o=e.chart;this.includeSegment(i,s,e,i.length);for(var l,h,c,d=i.length,u=function(d){r=i[d],l=n.getAxisValue(r.value,s,e.chart),(h=n.createClipRect(d?n.getAxisValue(i[d-1].value,s,e.chart):s.visibleRange.min,l,e,d,a))&&t.map(function(t){Bt(Zt((c={"clip-path":h,"stroke-dasharray":r.dashArray,opacity:t.opacity,stroke:e.type.indexOf("Line")>-1?r.color||e.interior:e.border.color,"stroke-width":t["stroke-width"],fill:e.type.indexOf("Line")>-1?"none":r.color||e.interior,id:t.id+"_Segment_"+d,d:t.d}).id),c.d,o.redraw),e.seriesElement.appendChild(o.renderer.drawPath(c))})},p=0;p<d;p++)u(p)}},{key:"includeSegment",value:function(e,t,i,n){if(n<=0)return e.push({value:t.visibleRange.max,color:i.interior}),null;this.getAxisValue(e[n-1].value,t,i.chart)<t.visibleRange.max&&e.push({value:t.visibleRange.max,color:i.interior})}},{key:"createClipRect",value:function(e,t,i,n,r){var a,s=i.chart.requireInvertedAxis,o=Qt(r?e:i.xAxis.visibleRange.min,r?i.yAxis.visibleRange.max:t,i.xAxis,i.yAxis,s),l=Qt(r?t:i.xAxis.visibleRange.max,r?i.yAxis.visibleRange.min:e,i.xAxis,i.yAxis,s);return(l=s?[o,o=l][0]:l).x-o.x>0&&l.y-o.y>0?(a=new Si(i.chart.element.id+"_ChartSegment"+i.index+"ClipRect_"+n,"transparent",{width:1,color:"Gray"},1,{x:o.x,y:o.y,width:l.x-o.x,height:l.y-o.y}),i.seriesElement.appendChild(Ht(i.chart.redraw,a,i.chart.renderer)),"url(#"+i.chart.element.id+"_ChartSegment"+i.index+"ClipRect_"+n+")"):null}},{key:"getAxisValue",value:function(e,t,i){if(null===e&&(e=t.visibleRange.max),"DateTime"===t.valueType){var n={skeleton:"full",type:"dateTime"};return Date.parse(i.intl.getDateParser(n)(i.intl.getDateFormat(n)(new Date(m.c.parse.parseJson({val:e}).val))))}if(t.valueType.indexOf("Category")>-1){var r="DateTimeCategory"===t.valueType?e.getTime().toString():e;return t.labels.indexOf(r)<0?+e:t.labels.indexOf(r)}return+e}}]),i}(On),En=function(e){l(n,e);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).element=t.chart.element,t.textStyle=e.tooltip.textStyle,t.control=e,t}return o(n,[{key:"getElement",value:function(e){return document.getElementById(e)}},{key:"getTooltipElement",value:function(e){this.inverted=this.chart.requireInvertedAxis,this.header=null===this.control.tooltip.header?this.control.tooltip.shared?"<b>${point.x}</b>":"<b>${series.name}</b>":this.control.tooltip.header,this.formattedText=[];var t=document.getElementById(this.chart.element.id+"_tooltip"),i=this.chart.element.id.indexOf("stockChart")>-1;return!e&&!t||i?this.createElement():null}},{key:"createElement",value:function(){var e=document.createElement("div");return e.id=this.element.id+"_tooltip",e.className="ejSVGTooltip",e.setAttribute("style","pointer-events:none; position:absolute;z-index: 1"),e}},{key:"pushData",value:function(e,t,i,n){return!!e.series.enableTooltip&&(this.currentPoints.push(e),this.stopAnimation(),i&&!document.getElementById(i.id)&&(this.chart.stockChart?document.getElementById(this.chart.stockChart.element.id+"_Secondary_Element").appendChild(i):document.getElementById(this.element.id+"_Secondary_Element").appendChild(i)),!0)}},{key:"removeHighlight",value:function(){for(var e,t=0,i=this.previousPoints.length;t<i;t++)(e=this.previousPoints[t]).series.isRectSeries?e.series.visible&&this.highlightPoint(e.series,e.point.index,!1):e.series.marker.visible||"Scatter"===e.series.type||"Bubble"===e.series.type||(this.previousPoints.shift(),i-=1)}},{key:"highlightPoint",value:function(e,t,i){var n=this.getElement(this.element.id+"_Series_"+e.index+"_Point_"+t),r=this.control.accumulationSelectionModule,a=!!(r&&r.selectedDataIndexes.length>0);n&&(!a||a&&n.getAttribute("class")&&-1===n.getAttribute("class").indexOf("_ej2_chart_selection_series_")?n.setAttribute("opacity",(i?e.opacity/2:e.opacity).toString()):n.setAttribute("opacity",e.opacity.toString()))}},{key:"highlightPoints",value:function(){var e,i=t(this.currentPoints);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.series.isRectSeries&&"Series"===n.series.category&&this.highlightPoint(n.series,n.point.index,!0)}}catch(r){i.e(r)}finally{i.f()}}},{key:"createTooltip",value:function(e,t,i,n,r,a,s,o){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10?arguments[10]:void 0,d=this.currentPoints[0].series,u=e.tooltipModule||e.accumulationTooltipModule;if(u){var p=d.isRectSeries&&"Waterfall"!==d.type&&r&&r.y<0,g=this.chart.requireInvertedAxis&&d.isRectSeries,f=null;if(this.text.length<=1){var m,v,y=c||e.tooltip.template;if(y&&"chart"===e.getModuleName()&&"#"!==y[0]&&"string"==typeof y){var b=document.createElement("div");b.id="testing_template",b.className="ejSVGTooltip",b.setAttribute("style","pointer-events:none; position:absolute;z-index: 1"),document.getElementById(this.chart.element.id+"_Secondary_Element").appendChild(b);var C=y.replaceAll("${x}",r.x).replaceAll("${y}",r.y);b.innerHTML=C,m=new E(b.firstElementChild.offsetWidth,b.firstElementChild.offsetHeight),v=new E(0,0),b.remove()}else m=R(this.text[0],e.tooltip.textStyle),v=""!==this.header&&"<b></b>"!==this.header?R(this.header,this.textStyle):new E(0,0);var x=47;m.width=Math.max(m.width,v.width)+(a.length>0?x:0),m.height=m.height+v.height+(32+(v.height>0?20:0)),f=this.getCurrentPosition(p,g),p="Left"===(f=this.getPositionBySize(m,new L(0,0,o.width,o.height),i,f))||"Bottom"===f,g="Left"===f||"Right"===f}t?this.svgTooltip=new K({opacity:e.tooltip.opacity,header:this.headerText,content:this.text,fill:e.tooltip.fill,border:e.tooltip.border,enableAnimation:e.tooltip.enableAnimation,location:i,shared:e.tooltip.shared,shapes:a,clipBounds:"PolarRadar"===this.chart.chartAreaType?new Ii(0,0):n,areaBounds:o,palette:this.findPalette(),template:c||e.tooltip.template,data:h,theme:e.theme,offset:s,textStyle:e.tooltip.textStyle,isNegative:p,inverted:g,arrowPadding:this.text.length>1||this.chart.stockChart?0:12,availableSize:e.availableSize,duration:this.chart.tooltip.duration,isCanvas:this.chart.enableCanvas,isTextWrap:e.tooltip.enableTextWrap&&"chart"===e.getModuleName(),blazorTemplate:{name:"Template",parent:this.chart.tooltip},controlInstance:this.chart,tooltipPlacement:f,tooltipRender:function(){u.removeHighlight(),u.highlightPoints(),u.updatePreviousPoint(l)},animationComplete:function(e){e.tooltip.fadeOuted&&u.fadeOut(u.previousPoints)}},"#"+this.element.id+"_tooltip"):this.svgTooltip&&(this.svgTooltip.location=i,this.svgTooltip.content=this.text,this.svgTooltip.header=this.headerText,this.svgTooltip.offset=s,this.svgTooltip.palette=this.findPalette(),this.svgTooltip.shapes=a,this.svgTooltip.data=h,this.svgTooltip.template=e.tooltip.template,this.svgTooltip.textStyle=e.tooltip.textStyle,this.svgTooltip.isNegative=p,this.svgTooltip.inverted=g,this.svgTooltip.clipBounds="PolarRadar"===this.chart.chartAreaType?new Ii(0,0):n,this.svgTooltip.arrowPadding=this.text.length>1||this.chart.stockChart?0:12,this.svgTooltip.tooltipPlacement=f,this.svgTooltip.dataBind()),this.chart.isReact&&this.chart.renderReactTemplates()}}},{key:"getPositionBySize",value:function(e,t,i,n){var r=this.isTooltipFitPosition("Top",new L(0,0,t.width,t.height),i,e),a=this.isTooltipFitPosition("Bottom",new L(0,0,t.width,t.height),i,e),s=this.isTooltipFitPosition("Right",new L(0,0,t.width,t.height),i,e),o=this.isTooltipFitPosition("Left",new L(0,0,t.width,t.height),i,e);if(!(r||a||s||o)){var l=[i.x-t.x,t.x+t.width-i.x,i.y-t.y,t.y+t.height-i.y],h=l.indexOf(Math.max.apply(this,l));return 0===h?"Left":1===h?"Right":2===h?"Top":"Bottom"}return"Top"===n?r?"Top":a?"Bottom":s?"Right":"Left":"Bottom"===n?a?"Bottom":r?"Top":s?"Right":"Left":"Right"===n?s?"Right":o?"Left":r?"Top":"Bottom":o?"Left":s?"Right":r?"Top":"Bottom"}},{key:"isTooltipFitPosition",value:function(e,t,i,n){var r=new Ii(0,0),a=new Ii(0,0);switch(e){case"Top":r.x=i.x-n.width/2,r.y=i.y-n.height,a.x=i.x+n.width/2,a.y=i.y;break;case"Bottom":r.x=i.x-n.width/2,r.y=i.y,a.x=i.x+n.width/2,a.y=i.y+n.height;break;case"Right":r.x=i.x,r.y=i.y-n.height/2,a.x=i.x+n.width,a.y=i.y+n.height/2;break;case"Left":r.x=i.x-n.width,r.y=i.y-n.height/2,a.x=i.x,a.y=i.y+n.height/2}return jt(r.x,r.y,t)&&jt(a.x,a.y,t)}},{key:"getCurrentPosition",value:function(e,t){return t?e?"Left":"Right":e?"Bottom":"Top"}},{key:"findPalette",value:function(){var e,i=[],n=t(this.currentPoints);try{for(n.s();!(e=n.n()).done;){var r=e.value;i.push(this.findColor(r,r.series))}}catch(a){n.e(a)}finally{n.f()}return i}},{key:"findColor",value:function(e,t){return!t.isRectSeries||"Candle"!==t.type&&"Hilo"!==t.type&&"HiloOpenClose"!==t.type?(e.point.color&&"#ffffff"!==e.point.color?e.point.color:e.point.interior)||t.marker.fill||t.interior:e.point.color}},{key:"updatePreviousPoint",value:function(e){e&&(this.currentPoints=this.currentPoints.concat(e)),this.previousPoints=Object(f.L)([],this.currentPoints,null,!0)}},{key:"fadeOut",value:function(e){var t=this.getElement(this.chart.enableCanvas?this.element.id+"_tooltip_group":this.element.id+"_tooltip_svg");t&&parseInt(t.getAttribute("opacity"),10)>0||(this.valueX=null,this.valueY=null,this.currentPoints=[],this.removeHighlight(),this.removeHighlightedMarker(e),this.svgTooltip=null,this.control.trigger("animationComplete",{}))}},{key:"removeHighlightedMarker",value:function(e){if(this.chart.markerRender){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;ft(this.element.id+"_Series_"+r.series.index+"_Point_"+r.point.index+"_Trackball")}}catch(a){n.e(a)}finally{n.f()}this.chart.markerRender.removeHighlightedMarker()}this.previousPoints=[]}},{key:"removeText",value:function(){this.textElements=[];var e=this.getElement(this.element.id+"_tooltip_group");if(e&&e.childNodes.length>0)for(;e.lastChild&&1!==e.childNodes.length;)e.removeChild(e.lastChild)}},{key:"stopAnimation",value:function(){ti(this.toolTipInterval)}},{key:"removeTooltip",value:function(e){var t=this,i=this.getElement(this.element.id+"_tooltip"),n=i?this.getElement(i.id+"parent_template"):null,r=n&&"<div></div>"!==n.innerHTML;this.stopAnimation(),this.chart.isReact&&r&&this.chart.clearTemplate([n.id],[0]),i&&this.previousPoints.length>0&&(this.toolTipInterval=+setTimeout(function(){t.svgTooltip&&t.svgTooltip.fadeOut()},e))}}]),n}(Qi),Ln=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Tn=(Xi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ln([Object(f.t)(null)],Xi.prototype,"content",void 0),Ln([Object(f.t)("0")],Xi.prototype,"x",void 0),Ln([Object(f.t)("0")],Xi.prototype,"y",void 0),Ln([Object(f.t)("Pixel")],Xi.prototype,"coordinateUnits",void 0),Ln([Object(f.t)("Chart")],Xi.prototype,"region",void 0),Ln([Object(f.t)("Middle")],Xi.prototype,"verticalAlignment",void 0),Ln([Object(f.t)("Center")],Xi.prototype,"horizontalAlignment",void 0),Ln([Object(f.t)(null)],Xi.prototype,"description",void 0),Xi),jn=(Yi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ln([Object(f.t)(!1)],Yi.prototype,"visible",void 0),Ln([Object(f.t)(!0)],Yi.prototype,"showZero",void 0),Ln([Object(f.t)(null)],Yi.prototype,"name",void 0),Ln([Object(f.t)("transparent")],Yi.prototype,"fill",void 0),Ln([Object(f.t)("Inside")],Yi.prototype,"position",void 0),Ln([Object(f.t)(5)],Yi.prototype,"rx",void 0),Ln([Object(f.t)(5)],Yi.prototype,"ry",void 0),Ln([Object(f.t)(0)],Yi.prototype,"angle",void 0),Ln([Object(f.t)(!1)],Yi.prototype,"enableRotation",void 0),Ln([Object(f.g)({width:null,color:null},je)],Yi.prototype,"border",void 0),Ln([Object(f.g)({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},Te)],Yi.prototype,"font",void 0),Ln([Object(f.g)({},Le)],Yi.prototype,"connectorStyle",void 0),Ln([Object(f.t)(null)],Yi.prototype,"template",void 0),Yi),Dn=(Gi=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Ln([Object(f.t)("50%")],Gi.prototype,"x",void 0),Ln([Object(f.t)("50%")],Gi.prototype,"y",void 0),Gi),Mn=function e(){a(this,e),this.visible=!0,this.symbolLocation=null,this.region=null,this.labelRegion=null,this.labelVisible=!0,this.regions=null,this.isExplode=!1,this.isClubbed=!1,this.isSliced=!1,this.argsData=null,this.isLabelUpdated=null,this.initialLabelRegion=null},Fn=(Ki=function(e){l(n,e);var i=c(n);function n(){var e;return a(this,n),(e=i.apply(this,arguments)).points=[],e.clubbedPoints=[],e.sumOfPoints=0,e.isRectSeries=!0,e.clipRect=new L(0,0,0,0),e.category="Series",e.rightSidePoints=[],e.leftSidePoints=[],e}return o(n,[{key:"refreshDataManager",value:function(e,t){var i=this,n=this.dataSource||e.dataSource;n instanceof m.b||!Object(f.Z)(this.query)?this.dataModule.getData(this.dataModule.generateQuery().requiresCount()).then(function(t){return i.dataManagerSuccess(t,e)}):this.dataManagerSuccess({result:n,count:n.length},e,t)}},{key:"dataManagerSuccess",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n={name:"seriesRender",series:this,data:e.result};t.allowServerDataBinding=!1,t.trigger("seriesRender",n),this.resultData=""!==e.result?e.result:[],t.isBlazor||i||this.getPoints(this.resultData,t),(++t.seriesCounts===t.visibleSeries.length&&i||window.Blazor&&!i&&1===t.seriesCounts)&&(this.getPoints(this.resultData,t),t.refreshChart())}},{key:"getPoints",value:function(e,t){var i,n=Object.keys(e).length;if(this.sumOfPoints=0,0===n)return null;this.findSumOfPoints(e),this.points=[],this.clubbedPoints=[],this.sumOfClub=0;for(var r=this.palettes.length?this.palettes:Q(t.theme),a=di(this.groupTo,this.sumOfPoints),s=0;s<n;s++)i=this.setPoints(e,s,r,t),this.isClub(i,a,s)?(i.index=this.clubbedPoints.length,i.isExplode=!0,this.clubbedPoints.push(i),i.isSliced=!0):(Object(f.Z)(i.y)&&(i.visible=!1),this.pushPoints(i,r));if(this.lastGroupTo=this.groupTo,this.sumOfClub>0){var o=this.generateClubPoint();this.pushPoints(o,r);var l=this.points.length-1;this.clubbedPoints.map(function(e){e.index+=l,e.color=o.color})}this.clubbedPoints.length&&this.explode&&"Pie"===this.type&&(this.explodeAll||this.points[this.points.length-1].index===this.explodeIndex)&&(this.points.splice(this.points.length-1,1),this.points=this.points.concat(this.clubbedPoints))}},{key:"generateClubPoint",value:function(){var e=new Mn;return e.isClubbed=!0,e.x="Others",e.y=this.sumOfClub,e.text=e.originalText=e.x+": "+this.sumOfClub,e.sliceRadius="80%",e}},{key:"pushPoints",value:function(e,t){e.index=this.points.length,e.isExplode=this.explodeAll||e.index===this.explodeIndex,e.color=e.color||t[e.index%t.length],this.points.push(e)}},{key:"isClub",value:function(e,t,i){if(!Object(f.Z)(t)){if("Value"===this.groupMode&&Math.abs(e.y)<=t)return this.sumOfClub+=Math.abs(e.y),!0;if("Point"===this.groupMode&&i>=t)return this.sumOfClub+=Math.abs(e.y),!0}return!1}},{key:"findSumOfPoints",value:function(e){for(var t=Object.keys(e).length,i=0;i<t;i++)Object(f.Z)(e[i])||Object(f.Z)(e[i][this.yName])||isNaN(e[i][this.yName])||(this.sumOfPoints+=Math.abs(e[i][this.yName]))}},{key:"setPoints",value:function(e,t,i,n){var r=new Mn;return r.x=Object(f.X)(this.xName,e[t]),r.y=Object(f.X)(this.yName,e[t]),r.percentage=+(r.y/this.sumOfPoints*100).toFixed(2),r.legendImageUrl=Object(f.X)(this.legendImageUrl,e[t]),r.color=Object(f.X)(this.pointColorMapping,e[t]),r.text=r.originalText=Object(f.X)(this.dataLabel.name||"",e[t]),r.tooltip=Object(f.X)(this.tooltipMappingName||"",e[t]),r.sliceRadius=Object(f.X)(this.radius,e[t]),r.sliceRadius=Object(f.Z)(r.sliceRadius)?"80%":r.sliceRadius,r.separatorY=n.intl.formatNumber(r.y,{useGrouping:n.useGroupingSeparator}),this.setAccEmptyPoint(r,t,e,i),r}},{key:"renderSeries",value:function(e,t){var i,n=t?Zt(e.element.id+"_Series_"+this.index):e.renderer.createGroup({id:e.element.id+"_Series_"+this.index});this.renderPoints(e,n,t),e.accumulationDataLabelModule&&this.dataLabel.visible&&((i=e.renderer.createGroup({id:e.element.id+"_datalabel_Series_"+this.index})).style.visibility=this.animation.enable&&e.animateSeries&&"Pie"===this.type?"hidden":"visible",this.renderDataLabel(e,i,t)),"Pie"===this.type&&(this.findMaxBounds(this.labelBound,this.accumulationBound),e.pieSeriesModule.animateSeries(e,this.animation,this,n)),e.accumulationLegendModule&&(this.labelBound.x-=e.explodeDistance,this.labelBound.y-=e.explodeDistance,this.labelBound.height+=e.explodeDistance-this.labelBound.y,this.labelBound.width+=e.explodeDistance-this.labelBound.x)}},{key:"renderPoints",value:function(e,i,n){var r,a,s=e.element.id+"_Series_"+this.index+"_Point_",o=t(this.points);try{for(o.s();!(a=o.n()).done;){var l=a.value,h={cancel:!1,name:"pointRender",series:this,point:l,fill:l.color,border:this.isEmpty(l)?{width:this.emptyPointSettings.border.width,color:this.emptyPointSettings.border.color}:{width:this.border.width,color:this.border.color}};e.trigger("pointRender",h),l.color=h.fill,r=new U(s+l.index,l.color,h.border.width||1,h.border.color||l.color,this.opacity,"",""),e[Dt(this.type)+"SeriesModule"].renderPoint(l,this,e,r,i,n)}}catch(c){o.e(c)}finally{o.f()}$t(!1,e.getSeriesElement(),i,n)}},{key:"renderDataLabel",value:function(e,i,n){e.accumulationDataLabelModule.findAreaRect();var r=Object(f.G)("div",{id:e.element.id+"_Series_0_DataLabelCollections"});this.leftSidePoints=[],this.rightSidePoints=[];var a,s=[],o=[],l=t(this.points);try{for(l.s();!(a=l.n()).done;){var h=a.value;h.visible&&(this.dataLabel.showZero||!this.dataLabel.showZero&&(0!==h.y||0===h.y&&"Zero"===this.emptyPointSettings.mode))&&e.accumulationDataLabelModule.renderDataLabel(h,this.dataLabel,i,this.points,this.index,r,n),h.midAngle>=90&&h.midAngle<=270?this.leftSidePoints.push(h):h.midAngle>=0&&h.midAngle<=90?o.push(h):s.push(h)}}catch(d){l.e(d)}finally{l.f()}if(s.sort(function(e,t){return e.midAngle-t.midAngle}),o.sort(function(e,t){return e.midAngle-t.midAngle}),this.leftSidePoints.sort(function(e,t){return e.midAngle-t.midAngle}),this.rightSidePoints=s.concat(o),e.accumulationDataLabelModule.drawDataLabels(this,this.dataLabel,i,r,n),null!==this.dataLabel.template&&r.childElementCount){var c=e.accumulationDataLabelModule.drawDataLabels.bind(e.accumulationDataLabelModule,this,this.dataLabel,i,r,n);e.isReact&&e.renderReactTemplates(c),$t(!1,Zt(e.element.id+"_Secondary_Element"),r,n)}$t(!1,e.getSeriesElement(),i,n)}},{key:"findMaxBounds",value:function(e,t){e.x=t.x<e.x?t.x:e.x,e.y=t.y<e.y?t.y:e.y,e.height=t.y+t.height>e.height?t.y+t.height:e.height,e.width=t.x+t.width>e.width?t.x+t.width:e.width}},{key:"setAccEmptyPoint",value:function(e,t,i,n){if(!Object(f.Z)(e.y)&&!isNaN(e.y))return null;switch(e.color=this.emptyPointSettings.fill||e.color,this.emptyPointSettings.mode){case"Zero":e.y=0,e.visible=!0;break;case"Average":var r=i[t+1]&&i[t+1][this.yName]||0;e.y=(Math.abs(i[t-1]&&i[t-1][this.yName]||0)+Math.abs(r))/2,this.sumOfPoints+=e.y,e.visible=!0;break;default:e.visible=!1}}},{key:"isEmpty",value:function(e){return e.color===this.emptyPointSettings.fill}}]),n}(f.e),Ln([Object(f.t)("")],Ki.prototype,"dataSource",void 0),Ln([Object(f.t)()],Ki.prototype,"query",void 0),Ln([Object(f.t)("")],Ki.prototype,"xName",void 0),Ln([Object(f.t)("")],Ki.prototype,"name",void 0),Ln([Object(f.t)("")],Ki.prototype,"tooltipMappingName",void 0),Ln([Object(f.t)("")],Ki.prototype,"yName",void 0),Ln([Object(f.t)(!0)],Ki.prototype,"visible",void 0),Ln([Object(f.g)({color:null,width:0},je)],Ki.prototype,"border",void 0),Ln([Object(f.g)(null,Ne)],Ki.prototype,"animation",void 0),Ln([Object(f.t)("SeriesType")],Ki.prototype,"legendShape",void 0),Ln([Object(f.t)("")],Ki.prototype,"legendImageUrl",void 0),Ln([Object(f.t)("")],Ki.prototype,"pointColorMapping",void 0),Ln([Object(f.t)(null)],Ki.prototype,"selectionStyle",void 0),Ln([Object(f.t)(null)],Ki.prototype,"groupTo",void 0),Ln([Object(f.t)("Value")],Ki.prototype,"groupMode",void 0),Ln([Object(f.g)({},jn)],Ki.prototype,"dataLabel",void 0),Ln([Object(f.t)([])],Ki.prototype,"palettes",void 0),Ln([Object(f.t)(0)],Ki.prototype,"startAngle",void 0),Ln([Object(f.t)(null)],Ki.prototype,"endAngle",void 0),Ln([Object(f.t)("80%")],Ki.prototype,"radius",void 0),Ln([Object(f.t)("0")],Ki.prototype,"innerRadius",void 0),Ln([Object(f.t)("Pie")],Ki.prototype,"type",void 0),Ln([Object(f.t)(!0)],Ki.prototype,"enableTooltip",void 0),Ln([Object(f.t)(!1)],Ki.prototype,"explode",void 0),Ln([Object(f.t)("30%")],Ki.prototype,"explodeOffset",void 0),Ln([Object(f.t)(!1)],Ki.prototype,"explodeAll",void 0),Ln([Object(f.t)(null)],Ki.prototype,"explodeIndex",void 0),Ln([Object(f.g)({mode:"Drop"},ze)],Ki.prototype,"emptyPointSettings",void 0),Ln([Object(f.t)(0)],Ki.prototype,"gapRatio",void 0),Ln([Object(f.t)("80%")],Ki.prototype,"width",void 0),Ln([Object(f.t)("80%")],Ki.prototype,"height",void 0),Ln([Object(f.t)("20%")],Ki.prototype,"neckWidth",void 0),Ln([Object(f.t)("20%")],Ki.prototype,"neckHeight",void 0),Ln([Object(f.t)("Linear")],Ki.prototype,"pyramidMode",void 0),Ln([Object(f.t)(1)],Ki.prototype,"opacity",void 0),Ki);function Pn(e,i){var n,r=t(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.index===e)return a}}catch(s){r.e(s)}finally{r.f()}return null}var Nn,Bn,Hn,_n,zn=function(){function e(t){a(this,e),this.accumulation=t}return o(e,[{key:"center",get:function(){return this.pieCenter||("Pie"===this.accumulation.visibleSeries[0].type?this.accumulation.pieSeriesModule.pieBaseCenter:null)},set:function(e){this.pieCenter=e}},{key:"radius",get:function(){return void 0!==this.pieRadius?this.pieRadius:this.accumulation.pieSeriesModule.pieBaseRadius},set:function(e){this.pieRadius=e}},{key:"labelRadius",get:function(){return void 0!==this.pieLabelRadius?this.pieLabelRadius:this.accumulation.pieSeriesModule.pieBaseLabelRadius},set:function(e){this.pieLabelRadius=e}},{key:"isCircular",value:function(){return"Pie"===this.accumulation.type}},{key:"isVariousRadius",value:function(){return this.accumulation.pieSeriesModule.isRadiusMapped}},{key:"processExplode",value:function(e){if(e.target.id.indexOf("_Series_")>-1||e.target.id.indexOf("_datalabel_")>-1){var t=Tt(e.target.id).point;if(isNaN(t)||e.target.id.indexOf("_datalabel_")>-1&&"Outside"===this.accumulation.visibleSeries[0].points[t].labelPosition)return null;this.explodePoints(t,this.accumulation),this.deExplodeAll(t,this.accumulation.enableAnimation?300:0)}}},{key:"invokeExplode",value:function(){var e,i=this.accumulation.visibleSeries[0],n=this.accumulation.enableAnimation?300:0,r=t(i.points);try{for(r.s();!(e=r.n()).done;){var a=e.value;a.isExplode&&this.pointExplode(a.index,a,n)}}catch(h){r.e(h)}finally{r.f()}if(this.accumulation.accumulationSelectionModule&&"None"!==this.accumulation.selectionMode&&this.accumulation.accumulationSelectionModule.selectedDataIndexes.length){var s,o=t(this.accumulation.accumulationSelectionModule.selectedDataIndexes);try{for(o.s();!(s=o.n()).done;){var l=s.value;this.explodePoints(l.point,this.accumulation,!0),this.deExplodeAll(l.point,n)}}catch(h){o.e(h)}finally{o.f()}}}},{key:"deExplodeAll",value:function(e,i){var n,r=this.accumulation.element.id+"_Series_0_Point_",a=t(this.accumulation.visibleSeries[0].points);try{for(a.s();!(n=a.n()).done;){var s=n.value;(e!==s.index&&!s.isSliced||s.isClubbed)&&(s.isExplode=!1,this.deExplodeSlice(s.index,r,i))}}catch(o){a.e(o)}finally{a.f()}}},{key:"explodePoints",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.visibleSeries[0],r=n.points,a=Pn(e,r),s=!0,o=this.accumulation.enableAnimation?300:0;if(Object(f.Z)(a))return null;var l=!i&&(a.isSliced||n.clubbedPoints.length&&r[r.length-1].index===n.clubbedPoints[n.clubbedPoints.length-1].index);"Pie"===n.type&&(l||a.isClubbed)&&(s=this.clubPointExplode(e,a,n,r,t,o,l)),s&&this.pointExplode(e,a,o,i)}},{key:"getSum",value:function(e){var t=0;return e.map(function(e){t+=e.visible?e.y:0}),t}},{key:"clubPointExplode",value:function(e,t,i,n,r,a){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(t.isClubbed)return r.animateSeries=!1,n.splice(n.length-1,1),i.clubbedPoints.map(function(e){e.visible=!0,e.isExplode=!0}),r.visibleSeries[0].points=n.concat(i.clubbedPoints),this.deExplodeAll(e,a),i.sumOfPoints=this.getSum(r.visibleSeries[0].points),r.refreshChart(),!1;if(s||t.isSliced){r.animateSeries=!1,n.splice(n.length-i.clubbedPoints.length,i.clubbedPoints.length);var o=i.generateClubPoint();if(o.index=n.length,o.color=i.clubbedPoints[0].color,n.push(o),i.sumOfPoints=this.getSum(n),this.deExplodeAll(e,a),o.isExplode=!1,r.visibleSeries[0].points=n,r.refreshChart(),this.pointExplode(o.index,n[o.index],0,!0),o.isExplode=!1,this.deExplodeSlice(o.index,r.element.id+"_Series_0_Point_",a),t.isSliced)return!1}return!0}},{key:"pointExplode",value:function(e,t,i,n){var r,a=this.accumulation.element.id+"_Series_0_Point_",s=this.accumulation;r=this.isCircular()?kt(t.midAngle,s.explodeDistance,this.center):{x:t.labelRegion&&t.labelRegion.x<t.region.x?-s.explodeDistance:s.explodeDistance,y:0},this.isExplode(a+e)||n?(t.isExplode=!0,this.explodeSlice(e,r,a,this.center||{x:0,y:0},i)):(t.isExplode=!1,this.deExplodeSlice(e,a,i))}},{key:"isExplode",value:function(e){var t=Zt(e),i=t?t.getAttribute("transform"):null;return t&&("translate(0, 0)"===i||null===i||"translate(0)"===i)}},{key:"deExplodeSlice",value:function(e,t,i){var n=Zt(t+e);n&&n.parentNode.lastChild.hasAttribute("transform")&&n.parentNode.lastChild.removeAttribute("transform");var r=n?n.getAttribute("transform"):null;if(this.accumulation.enableAnimation&&n&&r&&"translate(0, 0)"!==r&&"translate(0)"!==r){var a=/translate\((-?\d+\.?\d*),?\s*(-?\d+[.]?\d*)?\)/.exec(r);this.performAnimation(e,t,0,0,+a[1],+a[2]||0,i,!0)}else this.performAnimation(e,t,0,0,0,0,i,!0)}},{key:"setTranslate",value:function(e,t,i,n){this.setElementTransform(t+e,i),this.accumulation.visibleSeries[0].dataLabel.visible&&(this.setElementTransform((t=this.accumulation.element.id+"_datalabel_Series_0_")+"shape_"+e,i),this.setElementTransform(t+"text_"+e,i+n),this.setElementTransform(t+"connector_"+e,i))}},{key:"setElementTransform",value:function(e,t){var i=Zt(e);i&&i.setAttribute("transform",t)}},{key:"explodeSlice",value:function(e,t,i,n,r){this.performAnimation(e,i,0,0,t.x-n.x,t.y-n.y,r)}},{key:"performAnimation",value:function(e,t,i,n,r,a,s,o){var l,h,c=this,d=this.accumulation,u=t.split("_"),p=parseInt(t.split("_")[u.length-3],10),g=d.visibleSeries[p].points[e];if(s<=0)return this.setTranslate(e,t,"translate("+r+", "+a+")",g.transform),null;new f.b({}).animate(Object(f.G)("div"),{duration:s,progress:function(s){l=Pt(s.timeStamp,i,r,s.duration),h=Pt(s.timeStamp,n,a,s.duration),c.setTranslate(e,t,"translate("+(o?r-l:l)+", "+(o?a-h:h)+")",g.transform)},end:function(){c.setTranslate(e,t,"translate("+(o?i:r)+", "+(o?i:a)+")",g.transform)}})}}]),e}(),Vn=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"renderPoint",value:function(e,t,i,n,r,a){var s=t.sumOfPoints;e.startAngle=this.startAngle;var o=s?Math.abs(e.visible?e.y:0)/s*this.totalAngle:null,l=Math.PI/180*(90-(360-this.startAngle)-90);this.radius=this.isRadiusMapped?di(e.sliceRadius,this.seriesRadius):this.radius,n.d=this.getPathOption(e,o,this.startAngle%360),e.midAngle=(this.startAngle-o/2)%360,e.endAngle=this.startAngle%360,e.symbolLocation=kt(e.midAngle,(this.radius+this.innerRadius)/2,this.center),a?(r.appendChild(i.renderer.drawPath(n)),this.refresh(e,o,l,i,n)):(r.appendChild(i.renderer.drawPath(n)),e.degree=o,e.start=l)}},{key:"findSeries",value:function(e){var t=0===this.innerRadius?this.radius+3:this.innerRadius-3;this.toggleInnerPoint(e,t,0===this.innerRadius?t+2:t-2)}},{key:"toggleInnerPoint",value:function(e,t,i){var n,r=Tt(e.target.id,!0),a=e.target.id.substring(0,e.target.id.indexOf("Series")-1),s=document.getElementById(this.accumulation.element.id+"PointHover_Border"),o=r.series,l=r.point,h=Zt(a+"_Series_"+o+"_Point_"+l);if(!isNaN(r.series)&&h){if(!(Object(f.Z)(o)||isNaN(o)||Object(f.Z)(l)||isNaN(l))){var c=this.accumulation.visibleSeries[0].points[l],d=h.getAttribute("class")===a+"_ej2_deselected"?this.accumulation.tooltip.enable?.5:.3:this.accumulation.tooltip.enable?.5:1,u=this.getPathArc(this.accumulation.pieSeriesModule.center,c.startAngle%360,(c.startAngle+c.degree)%360,t,i);s&&a===this.accumulation.element.id&&(s.getAttribute("d")!==u||c.isExplode)&&(s.parentNode.removeChild(s),s=null);var p=Zt(a+"_Series_"+o);if(!s&&(!c.isExplode||c.isExplode&&"click"!==e.type)){var g=new U(a+"PointHover_Border",c.color,1,c.color,d,"",u);if((n=this.accumulation.renderer.drawPath(g)).removeAttribute("transform"),"None"!==this.accumulation.selectionMode&&e.target.hasAttribute("class")&&this.accumulation.accumulationSelectionModule.addSvgClass(n,e.target.getAttribute("class")),p.appendChild(n),c.isExplode&&n){var m=h.getAttribute("transform");n.setAttribute("transform",m)}}}}else s&&(this.removeBorder(s,1e3),s=null)}},{key:"removeBorder",value:function(e,t){e&&setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},t)}},{key:"refresh",value:function(e,t,i,n,r){var a=this,s=Zt(r.id),o=n.duration?n.duration:300;new f.b({}).animate(Object(f.G)("div"),{duration:o,delay:0,progress:function(r){var o=Pt(r.timeStamp,e.degree,t-e.degree,r.duration),l=Pt(r.timeStamp,e.start,i-e.start,r.duration);l=(l/(Math.PI/180)+360)%360,s.setAttribute("d",a.getPathOption(e,o,l)),e.isExplode&&n.accBaseModule.explodePoints(e.index,n,!0),s.style.visibility="visible"},end:function(){s.style.visibility=e.visible?"visible":"hidden",s.setAttribute("d",r.d),e.degree=t,e.start=i}})}},{key:"getPathOption",value:function(e,t,i){if(!t)return"";var n=this.getPathArc(this.center,i%360,(i+t)%360,this.isRadiusMapped?di(e.sliceRadius,this.seriesRadius):this.radius,this.innerRadius);return this.startAngle+=t,n}},{key:"animateSeries",value:function(e,t,i,n){var r=e.element.id+"SeriesGroup"+i.index;if(i.animation.enable&&e.animateSeries){var a=e.renderer.createClipPath({id:r+"_clipPath"}),s=new U(r+"_slice","transparent",1,"transparent",1,"",""),o=e.renderer.drawPath(s);a.appendChild(o),e.svgObject.appendChild(a),n.setAttribute("style","clip-path:url(#"+a.id+"); -webkit-clip-path:url(#"+a.id+");"),this.doAnimation(o,i)}}},{key:"getModuleName",value:function(){return"PieSeries"}},{key:"destroy",value:function(){}}]),i}(function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"initProperties",value:function(e,t){this.accumulation=e,this.size=Math.min(e.initialClipRect.width,e.initialClipRect.height),this.initAngles(t);var i=parseInt(t.radius,10);if(-1===t.radius.indexOf("%")&&"number"!=typeof i||isNaN(i)){var n=[];this.isRadiusMapped=!0;for(var r=0;r<Object.keys(t.points).length;r++)n[r]=-1!==t.points[r].sliceRadius.indexOf("%")?di(t.points[r].sliceRadius,this.size/2):parseInt(t.points[r].sliceRadius,10);var a=Math.min.apply(null,n),s=Math.max.apply(null,n);this.pieBaseRadius=this.seriesRadius=s,this.innerRadius=di(t.innerRadius,this.seriesRadius),this.innerRadius=this.innerRadius>a?this.innerRadius/2:this.innerRadius}else this.isRadiusMapped=!1,this.pieBaseRadius=di(t.radius,this.size/2),this.innerRadius=di(t.innerRadius,this.pieBaseRadius),this.pieBaseLabelRadius="Inside"===t.dataLabel.position?(this.pieBaseRadius-this.innerRadius)/2+this.innerRadius:this.pieBaseRadius+di(t.dataLabel.connectorStyle.length||"4%",this.size/2);this.radius=this.pieBaseRadius,this.labelRadius=this.pieBaseLabelRadius,e.explodeDistance=t.explode?di(t.explodeOffset,this.pieBaseRadius):0,this.findCenter(e,t),this.center=this.pieBaseCenter,this.defaultLabelBound(t,t.dataLabel.visible,t.dataLabel.position),this.totalAngle-=.001}},{key:"getLabelRadius",value:function(e,t){return"Inside"===e.dataLabel.position?(di(t.sliceRadius,this.pieBaseRadius)-this.innerRadius)/2+this.innerRadius:di(t.sliceRadius,this.seriesRadius)+di(e.dataLabel.connectorStyle.length||"4%",this.size/2)}},{key:"findCenter",value:function(e,t){this.accumulation=e,this.pieBaseCenter={x:di(e.center.x,e.initialClipRect.width)+e.initialClipRect.x,y:di(e.center.y,e.initialClipRect.height)+e.initialClipRect.y};var i=this.getSeriesBound(t),n=new Ii(i.x+i.width/2,i.y+i.height/2);this.pieBaseCenter.x+=this.pieBaseCenter.x-n.x,this.pieBaseCenter.y+=this.pieBaseCenter.y-n.y,this.accumulation.origin=this.pieBaseCenter}},{key:"initAngles",value:function(e){var t=Object(f.Z)(e.endAngle)?e.startAngle:e.endAngle;this.totalAngle=(t-e.startAngle)%360,this.startAngle=e.startAngle-90,this.totalAngle=this.totalAngle<=0?360+this.totalAngle:this.totalAngle,this.startAngle=(this.startAngle<0?this.startAngle+360:this.startAngle)%360}},{key:"defaultLabelBound",value:function(e,t,i){var n=this.getSeriesBound(e);e.accumulationBound=n,e.labelBound=new L(n.x,n.y,n.width+n.x,n.height+n.y),t&&"Outside"===i&&(e.labelBound=new L(1/0,1/0,-1/0,-1/0))}},{key:"getSeriesBound",value:function(e){var t=new L(1/0,1/0,-1/0,-1/0);this.initAngles(e);var i=this.startAngle,n=this.totalAngle,r=(this.startAngle+n)%360;r=0===r?360:r,e.findMaxBounds(t,this.getRectFromAngle(i)),e.findMaxBounds(t,this.getRectFromAngle(r)),e.findMaxBounds(t,new L(this.pieBaseCenter.x,this.pieBaseCenter.y,0,0));var a=(90*Math.floor(i/90)+90)%360,s=90*Math.floor(r/90)%360;s=0===s?360:s,(n>=90||s===a)&&(e.findMaxBounds(t,this.getRectFromAngle(a)),e.findMaxBounds(t,this.getRectFromAngle(s))),(0===i||i+n>=360)&&e.findMaxBounds(t,this.getRectFromAngle(0));for(var o=a===s?0:Math.floor(n/90),l=1;l<o;l++)((a+=90)<s||r<i||360===n)&&e.findMaxBounds(t,this.getRectFromAngle(a));return t.width-=t.x,t.height-=t.y,t}},{key:"getRectFromAngle",value:function(e){var t=kt(e,this.pieBaseRadius,this.pieBaseCenter);return new L(t.x,t.y,0,0)}},{key:"getPathArc",value:function(e,t,i,n,r){var a=i-t,s=(a=a<0?a+360:a)<180?0:1;return r||0!==r?this.getDoughnutPath(e,kt(t,n,e),kt(i,n,e),n,kt(t,r,e),kt(i,r,e),r,s):this.getPiePath(e,kt(t,n,e),kt(i,n,e),n,s)}},{key:"getPiePath",value:function(e,t,i,n,r){return"M "+e.x+" "+e.y+" L "+t.x+" "+t.y+" A "+n+" "+n+" 0 "+r+" 1 "+i.x+" "+i.y+" Z"}},{key:"getDoughnutPath",value:function(e,t,i,n,r,a,s,o){return"M "+t.x+" "+t.y+" A "+n+" "+n+" 0 "+o+" 1 "+i.x+" "+i.y+" L "+a.x+" "+a.y+" A "+s+" "+s+" 0 "+o+",0 "+r.x+" "+r.y+" Z"}},{key:"doAnimation",value:function(e,t){var i,n=this,r=t.startAngle-90,a=this.accumulation.duration?this.accumulation.duration:t.animation.duration;this.pieBaseCenter.x+=1;var s=.75*Math.max(this.accumulation.availableSize.height,this.accumulation.availableSize.width);s+=.414*s;var o=Ft("Linear");new f.b({}).animate(e,{duration:a,delay:t.animation.delay,progress:function(t){i=o(t.timeStamp,r,n.totalAngle,t.duration),e.setAttribute("d",n.getPathArc(n.pieBaseCenter,r,i,s,0))},end:function(){n.pieBaseCenter.x-=1,e.setAttribute("d",n.getPathArc(n.pieBaseCenter,0,359.99999,s,0)),n.accumulation.trigger("animationComplete",n.accumulation.isBlazor?{}:{series:t,accumulation:n.accumulation,chart:n.accumulation}),Zt(n.accumulation.element.id+"_datalabel_Series_"+t.index).style.visibility=n.accumulation.isDestroyed?"hidden":"visible"}})}}]),i}(zn)),Un=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},qn=(Nn=function(e){l(n,e);var i=c(n);function n(e,t){var r;return a(this,n),(r=i.call(this,e,t)).animateselected=!1,r.explodeDistance=0,r.chartid=57724,r}return o(n,[{key:"animate",value:function(e){this.duration=e||700,this.animateselected=!0,this.animateSeries=!1;var t=0,i=[],n=[],r=[],a=this.visibleSeries[0],s=[];if(s=a.dataSource,a.sumOfPoints=0,a.points.length<Object.keys(a.dataSource).length)this.refresh();else if(a.points.length>Object.keys(a.dataSource).length){var o=this.visibleSeries[0];o.points=o.points.filter(function(e){return e.visible=!1,n.push(e.index),i.push(e.color),s.some(function(i){var n=i;return e.x===n.x&&(e.visible=!0,r.push(e.index),e.index=t,t++),e.x===n.x})});for(var l=n.filter(function(e){return r.indexOf(e)<0}),h=n.length-l.length,c=n.length-1;c>=h;c--)ft("container_Series_0_Point_"+n[c]);for(var d=0;d<o.points.length;d++)o.points[d].y=o.dataSource[d].y,o.points[d].color=i[d],o.sumOfPoints+=o.dataSource[d].y;this.redraw=this.enableAnimation,this.animateSeries=!1,this.calculateBounds(),this.renderElements()}else{for(var u=0;u<a.points.length;u++)a.points[u].y=a.dataSource[u][a.yName],a.points[u].color=null!=a.dataSource[u][a.pointColorMapping]?a.dataSource[u][a.pointColorMapping]:a.points[u].color,a.sumOfPoints+=a.dataSource[u][a.yName];this.redraw=this.enableAnimation,this.animateSeries=!1,this.removeSvg(),this.refreshPoints(a.points),this.renderElements()}}},{key:"type",get:function(){return this.series&&this.series.length?this.series[0].type:"Pie"}},{key:"preRender",value:function(){if(this.isBlazor=window.Blazor,this.allowServerDataBinding=!1,this.unWireEvents(),this.setCulture(),this.animateSeries=!0,""===this.element.id){var e=document.getElementsByClassName("e-accumulationchart").length;this.element.id="acc_chart_"+this.chartid+"_"+e}gi(this),this.wireEvents()}},{key:"setTheme",value:function(){this.themeStyle=$(this.theme)}},{key:"render",value:function(){var e=this;-1===this.element.className.indexOf("e-accumulationchart")&&this.element.classList.add("e-accumulationchart");var t={chart:this.isBlazor?{}:this,accumulation:this.isBlazor?{}:this,theme:this.theme,name:"load",cancel:!1};this.trigger("load",t,function(){e.theme=e.isBlazor?t.theme:e.theme,e.setTheme(),e.accBaseModule=new zn(e),e.pieSeriesModule=new Vn(e),e.calculateVisibleSeries(),e.processData(),e.renderComplete(),e.allowServerDataBinding=!0})}},{key:"unWireEvents",value:function(){var e=f.d.touchStartEvent,t=f.d.touchEndEvent,i=f.d.isPointer?"pointerleave":"mouseleave";f.l.remove(this.element,f.d.touchMoveEvent,this.accumulationMouseMove),f.l.remove(this.element,t,this.accumulationMouseEnd),f.l.remove(this.element,e,this.accumulationMouseStart),f.l.remove(this.element,"click",this.accumulationOnMouseClick),f.l.remove(this.element,"contextmenu",this.accumulationRightClick),f.l.remove(this.element,i,this.accumulationMouseLeave),window.removeEventListener(f.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.accumulationResize)}},{key:"wireEvents",value:function(){if(this.element){var e=f.d.touchStartEvent,t=f.d.touchEndEvent,i=f.d.isPointer?"pointerleave":"mouseleave";f.l.add(this.element,f.d.touchMoveEvent,this.accumulationMouseMove,this),f.l.add(this.element,t,this.accumulationMouseEnd,this),f.l.add(this.element,e,this.accumulationMouseStart,this),f.l.add(this.element,"click",this.accumulationOnMouseClick,this),f.l.add(this.element,"contextmenu",this.accumulationRightClick,this),f.l.add(this.element,i,this.accumulationMouseLeave,this),window.addEventListener(f.d.isTouch&&"orientation"in window&&"onorientationchange"in window?"orientationchange":"resize",this.accumulationResize.bind(this)),new f.v(this.element),this.setStyle(this.element)}}},{key:"setMouseXY",value:function(e){var t,i,n=Zt(this.element.id+"_svg");if(n&&this.element){var r=n.getBoundingClientRect(),a=this.element.getBoundingClientRect();e.type.indexOf("touch")>-1?(this.isTouch=!0,i=e.changedTouches[0].clientY,t=e.changedTouches[0].clientX):(this.isTouch="touch"===e.pointerType||"2"===e.pointerType,t=e.clientX,i=e.clientY),this.mouseY=i-a.top-Math.max(r.top-a.top,0),this.mouseX=t-a.left-Math.max(r.left-a.left,0)}}},{key:"accumulationMouseEnd",value:function(e){return this.setMouseXY(e),this.trigger("chartMouseUp",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.isTouch&&(this.titleTooltip(e,this.mouseX,this.mouseY,this.isTouch),this.accumulationDataLabelModule&&this.visibleSeries[0].dataLabel.visible&&this.accumulationDataLabelModule.move(e,this.mouseX,this.mouseY,this.isTouch),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.move(e)),this.notify(f.d.touchEndEvent,e),!1}},{key:"accumulationMouseStart",value:function(e){return this.setMouseXY(e),this.trigger("chartMouseDown",{target:e.target.id,x:this.mouseX,y:this.mouseY}),!1}},{key:"accumulationResize",value:function(){var e=this;this.animateSeries=!1;var t={accumulation:this.isBlazor?{}:this,previousSize:new E(this.availableSize.width,this.availableSize.height),name:"resized",currentSize:new E(0,0),chart:this.isBlazor?{}:this},i={name:"beforeResize",cancelResizedEvent:!1};return this.resizeTo&&clearTimeout(this.resizeTo),this.trigger("beforeResize",i),i.cancelResizedEvent||(this.resizeTo=+setTimeout(function(){e.isDestroyed?clearTimeout(e.resizeTo):(gi(e),t.currentSize=e.availableSize,e.trigger("resized",t),e.refreshSeries(),e.refreshChart())},500)),!1}},{key:"print",value:function(e){var t=document.getElementById(this.element.id+"_Series_0").style.clipPath;document.getElementById(this.element.id+"_Series_0").style.clipPath="",new bn(this).print(e),document.getElementById(this.element.id+"_Series_0").style.clipPath=t}},{key:"export",value:function(e,t){this.exportModule&&(this.exportModule.export(e,t),this.afterExport&&this.exportModule.getDataUrl(this))}},{key:"setStyle",value:function(e){e.style.touchAction="element",e.style.msTouchAction="element",e.style.msContentZooming="none",e.style.msUserSelect="none",e.style.webkitUserSelect="none",e.style.position="relative",e.style.display="block"}},{key:"setAnnotationValue",value:function(e,t){var i,n=this.annotations[e],r=Zt(this.element.id+"_Annotation_Collections");t&&(n.content=t,r?(i=this.createElement("div"),ft(this.element.id+"_Annotation_"+e),this.annotationModule.processAnnotation(n,e,i),r.appendChild(i.children[0])):this.annotationModule.renderAnnotations(Zt(this.element.id+"_Secondary_Element")))}},{key:"accumulationMouseMove",value:function(e){return!!Zt(this.element.id+"_svg")&&(this.setMouseXY(e),this.trigger("chartMouseMove",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointMove&&this.triggerPointEvent("pointMove",e.target,e),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.move(e),this.accumulationDataLabelModule&&this.visibleSeries[0]&&this.visibleSeries[0].dataLabel.visible&&this.accumulationDataLabelModule.move(e,this.mouseX,this.mouseY),this.isTouch||this.titleTooltip(e,this.mouseX,this.mouseY),this.enableBorderOnMouseMove&&"Pie"===this.type&&this.pieSeriesModule&&jt(this.mouseX,this.mouseY,this.initialClipRect)&&this.pieSeriesModule.findSeries(e),this.notify(f.d.touchMoveEvent,e),!1)}},{key:"titleTooltip",value:function(e,t,i,n){var r=e.target.id,a=r===this.element.id+"_title"||r===this.element.id+"_subTitle"||r===this.element.id+"_chart_legend_title";e.target.textContent.indexOf("...")>-1&&a?vt(r===this.element.id+"_title"?this.title:r===this.element.id+"_subTitle"?this.subTitle:this.legendSettings.title,t,i,this.element.offsetWidth,this.element.id+"_EJ2_Title_Tooltip",Zt(this.element.id+"_Secondary_Element"),n):ft(this.element.id+"_EJ2_Title_Tooltip")}},{key:"accumulationOnMouseClick",value:function(e){return this.setMouseXY(e),this.accumulationLegendModule&&this.legendSettings.visible&&this.accumulationLegendModule.click(e),"None"!==this.selectionMode&&this.accumulationSelectionModule&&this.accumulationSelectionModule.calculateSelectedElements(this,e),this.visibleSeries[0].explode&&this.accBaseModule.processExplode(e),this.enableBorderOnMouseMove&&this.pieSeriesModule&&"Pie"===this.type&&this.pieSeriesModule.findSeries(e),this.trigger("chartMouseClick",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.pointClick&&this.triggerPointEvent("pointClick",e.target,e),!1}},{key:"triggerPointEvent",value:function(e,t,i){var n=i,r=Tt(t.id,!0);r.series>=0&&r.point>=0&&this.trigger(e,{series:this.isBlazor?{}:this.series[r.series],point:this.series[r.series].points[r.point],seriesIndex:r.series,pointIndex:r.point,x:this.mouseX,y:this.mouseY,pageX:n.pageX,pageY:n.pageY})}},{key:"accumulationRightClick",value:function(e){return 2!==e.buttons&&"touch"!==e.pointerType||(e.preventDefault(),e.stopPropagation(),!1)}},{key:"accumulationMouseLeave",value:function(e){this.setMouseXY(e),this.trigger("chartMouseLeave",{target:e.target.id,x:this.mouseX,y:this.mouseY}),this.notify(f.d.isPointer?"pointerleave":"mouseleave",e);var t=document.getElementById(this.element.id+"PointHover_Border");return t&&(this.pieSeriesModule.removeBorder(t,1e3),t=null),!1}},{key:"setCulture",value:function(){this.intl=new f.n}},{key:"createPieSvg",value:function(){this.removeSvg(),fi(this)}},{key:"removeSvg",value:function(){if(this.redraw)return null;if(Ci(this),ft(this.element.id+"_Secondary_Element"),this.svgObject){for(;this.svgObject.childNodes.length>0;)this.svgObject.removeChild(this.svgObject.firstChild);!this.svgObject.hasChildNodes()&&this.svgObject.parentNode&&Object(f.kb)(this.svgObject)}ft("EJ2_legend_tooltip"),ft("EJ2_datalabel_tooltip"),ft(this.element.id+"PointHover_Border")}},{key:"createSecondaryElement",value:function(){var e=ui(this.redraw,this.element.id+"_Secondary_Element")||this.createElement("div",{id:this.element.id+"_Secondary_Element",styles:"position: relative"});$t(!1,this.element,e,this.redraw)}},{key:"calculateVisibleSeries",value:function(){this.visibleSeries=[];for(var e=0,t=this.series.length;e<t;e++)if(this.series[e].index=e,this.series[e].type===this.type&&0===this.visibleSeries.length){this.visibleSeries.push(this.series[e]);break}}},{key:"processData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.seriesCounts=0;var i,n=t(this.visibleSeries);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.dataModule=new cn(r.dataSource||this.dataSource,r.query),r.refreshDataManager(this,e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"refreshChart",value:function(){this.doGrouppingProcess(),this.createPieSvg(),this.calculateBounds(),this.renderElements(),ft("chartmeasuretext")}},{key:"doGrouppingProcess",value:function(){var e=this.visibleSeries[0];Object(f.Z)(e.resultData)||Object(f.Z)(e.lastGroupTo)||e.lastGroupTo===e.groupTo||e.getPoints(e.resultData,this)}},{key:"calculateBounds",value:function(){this.initialClipRect=new L(this.margin.left,this.margin.top,this.availableSize.width,this.availableSize.height),this.titleCollection=[],this.subTitleCollection=[];var e,i,n=0,r=0,a=0,s=0;if(this.titleCollection=mi(this.title,this.titleStyle,this.initialClipRect.width),n=this.title?R(this.title,this.titleStyle).height*this.titleCollection.length:n,this.subTitle){var o,l=t(this.titleCollection);try{for(l.s();!(o=l.n()).done;)a=(s=R(o.value,this.titleStyle).width)>a?s:a}catch(h){l.e(h)}finally{l.f()}this.subTitleCollection=mi(this.subTitle,this.subTitleStyle,a),r=R(this.subTitle,this.subTitleStyle).height*this.subTitleCollection.length}e=this.initialClipRect,i=new L(0,r+n,this.margin.right+this.margin.left,this.margin.bottom+this.margin.top),e.x+=i.x,e.y+=i.y,e.width-=i.x+i.width,e.height-=i.y+i.height,this.calculateLegendBounds()}},{key:"calculateLegendBounds",value:function(){if(!this.accumulationLegendModule||!this.legendSettings.visible)return null;this.accumulationLegendModule.getLegendOptions(this,this.visibleSeries),this.accumulationLegendModule.calculateLegendBounds(this.initialClipRect,this.availableSize,null)}},{key:"renderElements",value:function(){this.renderBorder(),this.createSecondaryElement(),this.renderSeries(),this.renderTitle(),this.renderLegend(),$t(!1,this.element,this.svgObject,this.redraw),this.processSelection(),this.processExplode(),this.renderAnnotation(),this.setSecondaryElementPosition(),Object(f.vb)(this.element.id+"_DataLabel","Template",this.series[0].dataLabel),this.trigger("loaded",{accumulation:this.isBlazor?{}:this,chart:this.isBlazor?{}:this}),this.animateSeries=!1}},{key:"setSecondaryElementPosition",value:function(){var e=Zt(this.element.id+"_Secondary_Element");if(e){var t=this.element.getBoundingClientRect(),i=Zt(this.element.id+"_svg").getBoundingClientRect();e.style.left=Math.max(i.left-t.left,0)+"px",e.style.top=Math.max(i.top-t.top,0)+"px"}}},{key:"renderAnnotation",value:function(){this.annotationModule&&this.annotationModule.renderAnnotations(Zt(this.element.id+"_Secondary_Element"))}},{key:"processExplode",value:function(){return this.redraw?null:this.visibleSeries[0].explode?void this.accBaseModule.invokeExplode():null}},{key:"renderSeries",value:function(){this.redraw||this.svgObject.appendChild(this.renderer.createGroup({id:this.element.id+"_SeriesCollection"}));var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.visible&&this[Dt(n.type)+"SeriesModule"]&&(this[Dt(n.type)+"SeriesModule"].initProperties(this,n),n.renderSeries(this,this.redraw))}}catch(r){i.e(r)}finally{i.f()}}},{key:"renderBorder",value:function(){var e=this.border.width;$t(!1,this.svgObject,this.renderer.drawRectangle(new Si(this.element.id+"_border",this.background||this.themeStyle.background,this.border,1,new L(e/2,e/2,this.availableSize.width-e,this.availableSize.height-e))),this.redraw);var t=this.backgroundImage;if(t){var i=new wi(this.availableSize.height-e,this.availableSize.width-e,t,0,0,this.element.id+"_background","visible","none");$t(!1,this.svgObject,this.renderer.drawImage(i),this.redraw)}}},{key:"renderLegend",value:function(){if(!this.accumulationLegendModule||!this.legendSettings.visible)return null;this.accumulationLegendModule.legendCollections.length&&("Pie"===this.visibleSeries[0].type&&this.accumulationLegendModule.getSmartLegendLocation(this.visibleSeries[0].labelBound,this.accumulationLegendModule.legendBounds,this.margin),this.accumulationLegendModule.renderLegend(this,this.legendSettings,this.accumulationLegendModule.legendBounds,this.redraw))}},{key:"processSelection",value:function(){if(!this.accumulationSelectionModule||"None"===this.selectionMode)return null;var e=Object(f.L)([],this.accumulationSelectionModule.selectedDataIndexes,null,!0);this.accumulationSelectionModule.invokeSelection(this),e.length>0&&(this.accumulationSelectionModule.selectedDataIndexes=e,this.accumulationSelectionModule.redrawSelection(this))}},{key:"renderTitle",value:function(){var e=this.margin;if(!this.title)return null;var t=this.titleStyle.textAlignment,i="Near"===t?"start":"Far"===t?"end":"middle",n=R(this.title,this.titleStyle),r=new L(e.left,0,this.availableSize.width-e.left-e.right,0),a=new D(this.element.id+"_title",vi(r,this.titleStyle),this.margin.top+3*n.height/4,i,this.titleCollection,"","auto"),s=pi(this.renderer,a,this.titleStyle,this.titleStyle.color||this.themeStyle.chartTitle,this.svgObject,!1,this.redraw);s&&s.setAttribute("aria-label",this.title),this.subTitle&&this.renderSubTitle(a)}},{key:"renderSubTitle",value:function(e){var i,n=0,r=0,a=this.titleStyle.textAlignment,s=R(this.subTitle,this.subTitleStyle),o=t(this.titleCollection);try{for(o.s();!(i=o.n()).done;)n=(r=R(i.value,this.titleStyle).width)>n?r:n}catch(c){o.e(c)}finally{o.f()}var l=new L("Center"===a?e.x-n/2:"Far"===a?e.x-n:e.x,0,n,0),h=new D(this.element.id+"_subTitle",vi(l,this.subTitleStyle),e.y*e.text.length+3*s.height/4+10,function(e){return"Near"===e?"start":"Far"===e?"end":"middle"}(this.subTitleStyle.textAlignment),this.subTitleCollection,"","auto");pi(this.renderer,h,this.subTitleStyle,this.subTitleStyle.color||this.themeStyle.chartTitle,this.svgObject,!1,this.redraw)}},{key:"getSeriesElement",value:function(){return this.svgObject.getElementsByTagName("g")[0]}},{key:"refreshSeries",value:function(){var e,i=t(this.visibleSeries);try{for(i.s();!(e=i.n()).done;){var n=e.value;this.refreshPoints(n.points)}}catch(r){i.e(r)}finally{i.f()}}},{key:"refreshPoints",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.labelPosition=null,r.labelRegion=null,r.labelVisible=!0}}catch(a){n.e(a)}finally{n.f()}}},{key:"getModuleName",value:function(){return"accumulationchart"}},{key:"destroy",value:function(){this.element&&(this.unWireEvents(),r(p(n.prototype),"destroy",this).call(this),this.element.classList.remove("e-accumulationchart"),this.removeSvg(),this.svgObject=null)}},{key:"requiredModules",value:function(){var e=[];return e.push({member:this.type+"Series",args:[this]}),this.legendSettings.visible&&e.push({member:"AccumulationLegend",args:[this]}),this.findDatalabelVisibility()&&e.push({member:"AccumulationDataLabel",args:[this]}),this.tooltip.enable&&e.push({member:"AccumulationTooltip",args:[this]}),"None"!==this.selectionMode&&e.push({member:"AccumulationSelection",args:[this]}),(this.enableExport||this.allowExport)&&e.push({member:"Export",args:[this]}),this.annotations.some(function(e){return null!==e.content})&&e.push({member:"Annotation",args:[this]}),e}},{key:"findDatalabelVisibility",value:function(){var e,i=t(this.series);try{for(i.s();!(e=i.n()).done;)if(e.value.dataLabel.visible)return!0}catch(n){i.e(n)}finally{i.f()}return!1}},{key:"changeVisibleSeries",value:function(e,i){var n,r=t(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(i===a.index)return a}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"getPersistData",value:function(){return""}},{key:"onPropertyChanged",value:function(e,t){for(var i={refreshElements:!1,refreshBounds:!1},a=0,s=Object.keys(e);a<s.length;a++)switch(s[a]){case"theme":this.animateSeries=!0;break;case"title":case"subTitle":case"height":case"width":case"margin":i.refreshBounds=!0;break;case"titleStyle":e.titleStyle&&(e.titleStyle.size||e.titleStyle.textOverflow)?i.refreshBounds=!0:i.refreshElements=!0;break;case"subTitleStyle":e.subTitleStyle&&(e.subTitleStyle.size||e.subTitleStyle.textOverflow)?i.refreshBounds=!0:i.refreshElements=!0;break;case"legendSettings":i.refreshBounds=!0,i.refreshElements=!0;break;case"dataSource":this.processData(!1),i.refreshBounds=!0;break;case"series":if(!this.animateselected){for(var o=this.series.length,l=void 0,h=void 0,c=!1,d=0;d<o;d++)l=e.series[d],this.isBlazor&&(l.startAngle||l.endAngle||l.explodeOffset||l.neckHeight||l.neckWidth||l.radius||l.innerRadius||l.groupMode||l.emptyPointSettings)&&(h=!0),e.series[d]&&(e.series[d].dataSource||e.series[d].yName||e.series[d].xName||e.series[d].dataLabel||h)&&(Object(f.L)(this.changeVisibleSeries(this.visibleSeries,d),l,null,!0),c=!0),e.series[d]&&!Object(f.Z)(e.series[d].explodeIndex)&&e.series[d].explodeIndex>=0&&e.series[d].explodeIndex!==t.series[d].explodeIndex&&(this.accBaseModule.explodePoints(e.series[d].explodeIndex,this),this.accBaseModule.deExplodeAll(e.series[d].explodeIndex,this.enableAnimation?300:0));c&&(this.processData(!1),i.refreshBounds=!0)}this.animateselected=!1,this.redraw=!1;break;case"locale":case"currencyCode":r(p(n.prototype),"refresh",this).call(this);break;case"background":case"border":case"annotations":case"enableSmartLabels":i.refreshElements=!0;break;case"isMultiSelect":case"selectedDataIndexes":case"selectionMode":this.accumulationSelectionModule&&(Object(f.Z)(this.accumulationSelectionModule.selectedDataIndexes)?this.accumulationSelectionModule.invokeSelection(this):this.accumulationSelectionModule.redrawSelection(this))}!i.refreshBounds&&i.refreshElements?(this.createPieSvg(),this.renderElements()):i.refreshBounds&&(this.refreshSeries(),this.createPieSvg(),this.calculateBounds(),this.renderElements())}}]),n}(f.h),Un([Object(f.t)(null)],Nn.prototype,"width",void 0),Un([Object(f.t)(null)],Nn.prototype,"height",void 0),Un([Object(f.t)(null)],Nn.prototype,"title",void 0),Un([Object(f.t)(null)],Nn.prototype,"backgroundImage",void 0),Un([Object(f.g)({},Dn)],Nn.prototype,"center",void 0),Un([Object(f.t)("")],Nn.prototype,"dataSource",void 0),Un([Object(f.g)(V.chartTitleFont,Te)],Nn.prototype,"titleStyle",void 0),Un([Object(f.t)(null)],Nn.prototype,"subTitle",void 0),Un([Object(f.g)(V.chartSubTitleFont,Te)],Nn.prototype,"subTitleStyle",void 0),Un([Object(f.g)({},gn)],Nn.prototype,"legendSettings",void 0),Un([Object(f.g)({},Ue)],Nn.prototype,"tooltip",void 0),Un([Object(f.t)("None")],Nn.prototype,"selectionMode",void 0),Un([Object(f.t)("None")],Nn.prototype,"highLightMode",void 0),Un([Object(f.t)("None")],Nn.prototype,"selectionPattern",void 0),Un([Object(f.t)("None")],Nn.prototype,"highlightPattern",void 0),Un([Object(f.t)(!0)],Nn.prototype,"enableBorderOnMouseMove",void 0),Un([Object(f.t)(!1)],Nn.prototype,"isMultiSelect",void 0),Un([Object(f.t)(!0)],Nn.prototype,"enableAnimation",void 0),Un([Object(f.f)([],Be)],Nn.prototype,"selectedDataIndexes",void 0),Un([Object(f.g)({},Fe)],Nn.prototype,"margin",void 0),Un([Object(f.t)(!0)],Nn.prototype,"enableSmartLabels",void 0),Un([Object(f.g)({color:"#DDDDDD",width:0},je)],Nn.prototype,"border",void 0),Un([Object(f.t)(null)],Nn.prototype,"background",void 0),Un([Object(f.f)([{}],Fn)],Nn.prototype,"series",void 0),Un([Object(f.f)([{}],Tn)],Nn.prototype,"annotations",void 0),Un([Object(f.t)("Material")],Nn.prototype,"theme",void 0),Un([Object(f.t)(!1)],Nn.prototype,"useGroupingSeparator",void 0),Un([Object(f.t)(!0)],Nn.prototype,"enableExport",void 0),Un([Object(f.t)(!1)],Nn.prototype,"allowExport",void 0),Un([Object(f.k)()],Nn.prototype,"loaded",void 0),Un([Object(f.k)()],Nn.prototype,"load",void 0),Un([Object(f.k)()],Nn.prototype,"seriesRender",void 0),Un([Object(f.k)()],Nn.prototype,"legendRender",void 0),Un([Object(f.k)()],Nn.prototype,"textRender",void 0),Un([Object(f.k)()],Nn.prototype,"tooltipRender",void 0),Un([Object(f.k)()],Nn.prototype,"pointRender",void 0),Un([Object(f.k)()],Nn.prototype,"annotationRender",void 0),Un([Object(f.k)()],Nn.prototype,"beforePrint",void 0),Un([Object(f.k)()],Nn.prototype,"chartMouseMove",void 0),Un([Object(f.k)()],Nn.prototype,"chartMouseClick",void 0),Un([Object(f.k)()],Nn.prototype,"pointClick",void 0),Un([Object(f.k)()],Nn.prototype,"pointMove",void 0),Un([Object(f.k)()],Nn.prototype,"animationComplete",void 0),Un([Object(f.k)()],Nn.prototype,"chartMouseDown",void 0),Un([Object(f.k)()],Nn.prototype,"chartMouseLeave",void 0),Un([Object(f.k)()],Nn.prototype,"chartMouseUp",void 0),Un([Object(f.k)()],Nn.prototype,"beforeResize",void 0),Un([Object(f.k)()],Nn.prototype,"resized",void 0),Un([Object(f.k)()],Nn.prototype,"afterExport",void 0),Un([Object(f.t)("USD")],Nn.prototype,"currencyCode",void 0),Nn=Un([f.r],Nn));function Wn(e){var t,i=[];return(e=-1===(e=e.indexOf("!")>-1?e.split("!")[1]:e).indexOf(":")?e+":"+e:e).split(":").forEach(function(e){t=Zn(e),i.push(t[0]),i.push(t[1])}),i}function Zn(e){return[parseInt(e.match(/\d+/)[0],10)-1,Gn(e.match(/[A-Z]+/i)[0].toUpperCase())]}function Gn(e){for(var t=0,i=(e=e.split("").reverse().join("")).length-1;i>=0;i--)t+=(e[i].charCodeAt(0)-64)*Math.pow(26,i);return t-1}function Yn(e,t){return Kn(t+1)+(e+1)}function Xn(e){return Yn(e[0],e[1])+":"+(Object(f.Z)(e[2])?Yn(e[0],e[1]):Yn(e[2],e[3]))}function Kn(e){return e/26>1?Kn(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function Jn(e){return Wn(Qn(e))}function Qn(e){return e.split("!")[1]||e}function $n(e){var t=e.slice();return e[0]>e[2]&&er(t,0,2),e[1]>e[3]&&er(t,1,3),t}function er(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function tr(e){return e[0]===e[2]&&e[1]===e[3]}function ir(e,t,i,n,r){return new nr(e,t,i,n,r)}!function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.tooltipLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"}}(Bn||(Bn={})),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"},e.tooltipLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.dataLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.titleFont={size:"15px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"},e.subTitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto-Regular"}}(Hn||(Hn={})),function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.smithchartTitleFont={size:"15px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.smithchartSubtitleFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.dataLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Roboto, Segoe UI, Noto, Sans-serif"}}(_n||(_n={}));var nr=function(){function t(e,i,n,r,s){a(this,t),this.preventCallback=!1,this.context=e,this.workerTask=i,this.defaultListener=n,this.workerData=r,s&&(this.preventCallback=!0),this.initWorker()}return o(t,[{key:"terminate",value:function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)}},{key:"initWorker",value:function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)}},{key:"messageFromWorker",value:function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])}},{key:"onError",value:function(e){throw this.terminate(),e.message||e}},{key:"getFnCode",value:function(){var e,t,i="",n="",r=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),r=!0),i+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),r=!0),i+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return i+="self.onmessage = "+(r?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"}},{key:"getCallbackMessageFn",value:function(t){postMessage(this.workerTask.apply(this,e(t.data)))}},{key:"getMessageFn",value:function(t){this.workerTask.apply(this,e(t.data))}}]),t}();function rr(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var i=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,i.toString().replace("-","").length),r=Math.abs(ar(i,n));return i/r+"/"+n/r}function ar(e,t){return e=Number(e),(t=Number(t))?ar(t,e%t):e}function sr(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),i=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+i).toUTCString().replace(" GMT",""))}function or(e,t,i){var n=new Date("01/01/1900"),r=lr(e)?e:new Date(e),a=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),s=(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())-a)/864e5;return(t?s:parseInt(s.toString(),10))+(i?0:s>60?2:1)}function lr(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function hr(e){return e-parseFloat(e)>=0}function cr(e){return e&&/^\d*\.?\d*$/.test(e)?parseFloat(e):e}var dr="setCellFormat",ur="applyCellFormat",pr="workbookFormulaOperation",gr="ShowDialog",fr="setMerge",mr="activeCellMergedRange",vr=function(){function e(t){a(this,e),this.parent=t,this.localeObj=Object(f.T)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return o(e,[{key:"numberFormatting",value:function(e){var t=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(t=Wa(this.parent,e.range.split("!")[0]));for(var i,n=this.parent.sheets[t],r=Wn(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:n.selectedRange),a=r[0];a<=r[2];a++)for(var s=r[1];s<=r[3];s++)Ma(a,s,n,{format:e.format},!0),i=Da(a,s,n,!0),this.getFormattedCell({type:br(i.format),value:i.value,format:i.format,rowIndex:a,colIndex:s,sheetIndex:t,cell:i})}},{key:"getFormattedCell",value:function(e){var t=Object(f.Z)(e.value)?"":e.value,i=this.parent.sheets[Object(f.Z)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex],n=Wn(i.activeCell),r=Number(e.sheetIndex)?Number(e.sheetIndex):this.parent.activeSheetIndex,a=e.cell?e.cell:Da(n[0],n[1],i),s=e.cell&&!Object(f.Z)(e.rowIdx)?e.rowIdx:n[0],o=e.cell&&!Object(f.Z)(e.colIdx)?e.colIdx:n[1],l=!1,h={},c=new f.n;c.getNumberFormat(h);var d=Object(f.S)(this.parent.locale,h.currency);if(""===e.format||"General"===e.format){a=a||{};var u={value:e.value,rowIndex:s,colIndex:o,sheetIndex:this.parent.activeSheetIndex,updatedVal:e.value,isDate:!1,isTime:!1};this.checkDateFormat(u),u.isDate?(l=!0,a.value=e.value=u.updatedVal,a.format=e.format=yr("ShortDate")):u.isTime&&(l=!0,a.value=e.value=u.updatedVal,a.format=e.format=yr("Time"))}e.type=e.format?br(e.format):"General";var p=this.processFormats(e,t,l,a,c,d,h.currency);return this.parent.getActiveSheet().id-1===r&&this.parent.notify("refreshCellElem",{isRightAlign:p.rightAlign,result:p.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:d,value:e.value||""}),!e.onLoad&&(e.rowIndex>i.usedRange.rowIndex||e.colIndex>i.usedRange.colIndex)&&this.parent.setUsedRange(e.rowIndex,e.colIndex),e.formattedText=p.fResult||e.value,e.isRightAlign=p.rightAlign,e.curSymbol=d,e.formattedText}},{key:"processFormats",value:function(e,t,i,n,r,a,s){var o;if(e.format=e.format?e.format:"General",""!==t)switch(e.type){case"General":t=(o=this.autoDetectGeneralFormat({args:e,currencySymbol:a,fResult:t,intl:r,isRightAlign:i,curCode:s,cell:n,rowIdx:Number(e.rowIdx),colIdx:Number(e.colIdx)})).fResult,i=o.isRightAlign;break;case"Number":hr(t)&&(t=this.applyNumberFormat(e,r),i=!0);break;case"Currency":hr(t)&&(t=this.currencyFormat(e,r,s),i=!0);break;case"Percentage":hr(t)&&(t=this.percentageFormat(e,r),i=!0);break;case"Accounting":hr(t)&&(t=this.accountingFormat(e,r,a,s),i=!0);break;case"ShortDate":i=!!(t=this.shortDateFormat(e,r));break;case"LongDate":i=!!(t=this.longDateFormat(e,r));break;case"Time":i=!!(t=this.timeFormat(e,r));break;case"Fraction":hr(t)&&(t=this.fractionFormat(e),i=!0);break;case"Scientific":hr(t)&&(t=this.scientificFormat(e),i=!0);break;case"Text":i=!1}return{fResult:t,rightAlign:i}}},{key:"autoDetectGeneralFormat",value:function(e){if(hr(e.fResult)&&(e.args.format&&""!==e.args.format&&(e.fResult=e.args.format.toString().indexOf("%")>-1?this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?this.currencyFormat(e.args,e.intl,e.curCode):this.applyNumberFormat(e.args,e.intl)),"General"===e.args.format&&e.fResult&&e.fResult.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args)),e.isRightAlign=!0),!Object(f.Z)(e.fResult)){var t=e.fResult.toString();t.indexOf("%")>-1&&""!==t.split("%")[0]&&""===t.split("%")[1].trim()&&"NaN"!==Number(t.split("%")[0].split(this.groupSep).join("")).toString()?(e.args.value=Number(t.split("%")[0].split(this.groupSep).join(""))/100,e.cell.format=e.args.format=this.getPercentageFormat(t),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0):t.indexOf(e.currencySymbol)>-1&&""!==t.split(e.currencySymbol)[1]&&"NaN"!==Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")).toString()&&(e.args.value=Number(t.split(e.currencySymbol)[1].split(this.groupSep).join("")),e.cell.format=e.args.format=yr("Currency"),e.fResult=this.currencyFormat(e.args,e.intl,e.curCode),e.cell.value=e.args.value.toString(),Ma(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}return{isRightAlign:e.isRightAlign,fResult:e.fResult}}},{key:"getPercentageFormat",value:function(e){return e.indexOf(this.decimalSep)>-1?yr("Percentage"):"0%"}},{key:"findSuffix",value:function(e,t){var i=e.length-t.length;return e.substr(0,i<0?0:i)+t}},{key:"applyNumberFormat",value:function(e,t){e.format=this.isCustomFormat(e.format.toString());var i=e.format.toString().split(";");if(Number(e.value)>0)e.format=i[0];else if(0===Number(e.value)){if(e.format=i[2]?i[2]:i[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=Object(f.Z)(i[1])?i[0]:i[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=i[3]?i[3]:i[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.decimalSep)>-1){var n=e.format.split(this.decimalSep)[1].length,r="";Number(e.value)%1&&(r=n>e.value.toString().split(".")[1].length?" ":"0"),e.format=e.format.split("?").join(r)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&(e.format=e.cell.format),t.formatNumber(Number(e.value),{format:e.format})}},{key:"isCustomFormat",value:function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),(e=""===e?yr("Number"):e).toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")}},{key:"currencyFormat",value:function(e,t,i){e.format=""===e.format?yr("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var n=e.format.toString().split(";");return e.format=Number(e.value)>=0||Object(f.Z)(n[1])?n[0]:n[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),t.formatNumber(Number(e.value),{format:e.format,currency:i})}},{key:"percentageFormat",value:function(e,t){return e.format=""===e.format?yr("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})}},{key:"accountingFormat",value:function(e,t,i,n){e.format=""===e.format?yr("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var r=e.format.split(";");return e.format=Number(e.value)>=0?r[0]:r[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),0===Number(e.value)?i+"- ":t.formatNumber(Number(e.value),{format:e.format,currency:n}).split("-").join("")}},{key:"getFormatForOtherCurrency",value:function(e){if(e.indexOf("[$")>-1){var t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e}},{key:"shortDateFormat",value:function(e,t){var i,n=sr(e.value),r=""===e.format||"General"===e.format?yr("ShortDate"):e.format.toString();return r===yr("ShortDate")?(r="M/d/yy",i={type:"date",skeleton:"yMd"}):i={type:"date",format:r},t.formatDate(n,i)}},{key:"longDateFormat",value:function(e,t){var i=sr(e.value),n=""===e.format||"General"===e.format?yr("LongDate"):e.format.toString();return n===yr("LongDate")&&(n="EEEE, MMMM d, y"),t.formatDate(i,{type:"date",format:n})}},{key:"timeFormat",value:function(e,t){if(Object(f.Z)(e.value))return"";Object(f.Z)(e.value.toString().split(this.decimalSep)[1])||(e.value=parseFloat("1"+this.decimalSep+e.value.toString().split(this.decimalSep)[1])||e.value);var i=sr(e.value),n=""===e.format||"General"===e.format?yr("Time"):e.format.toString();return n===yr("Time")&&(n="h:mm:ss a"),t.formatDate(i,{type:"time",skeleton:"medium",format:n})}},{key:"scientificFormat",value:function(e){e.format=""===e.format?yr("Scientific"):e.format;var t=e.format.split("+")[1],i=this.findDecimalPlaces(e.format,"Scientific"),n=Number(e.value).toExponential(i);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(t,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(t,n.split("e-")[1])),n}},{key:"fractionFormat",value:function(e){e.format=""===e.format?yr("Fraction"):e.format;var t,i="";return e.value.toString().indexOf(this.decimalSep)>-1&&hr(e.value)?(i=e.value.toString().split(this.decimalSep)[0],t=rr(Number(e.value)),0===Number(i)?" "+t:i+" "+t):i}},{key:"findDecimalPlaces",value:function(e,t){var i,n;switch(t){case"Scientific":if(i=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep),i>-1)return e.substring(n+1,i).length}return 2}},{key:"checkDateFormat",value:function(e){var t,i=new f.n,n=Object(f.Z)(e.value)?"":e.value.toString(),r=Da(e.rowIndex,e.colIndex,Ka(this.parent,Object(f.Z)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex)),a=this.checkCustomDateFormat(n);n&&(n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&"Invalid"!==a&&(((n=a)&&n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&(t=function(e,t,i,n){var r=f.o.getDependables(f.C,i,null).dateObject,a=r.dateTimeFormats.availableFormats,s={dateObj:null,isCustom:!1,type:""};if("string"==typeof e&&(e=e.toUpperCase()),n&&(s.dateObj=t.parseDate(e,{format:n}),s.dateObj&&(s.type=e.toString().indexOf(":")>-1?"time":"datetime",s.isCustom=!0)),Object(f.Z)(s.dateObj)){for(var o=0,l=Object.keys(r.dateFormats);o<l.length;o++){var h=l[o];if(s.dateObj=t.parseDate(e,{format:r.dateFormats[h],skeleton:h}),s.dateObj){s.type="date",s.isCustom=!1;break}}if(Object(f.Z)(s.dateObj))for(var c=0,d=Object.keys(a);c<d.length;c++){var u=d[c];if(s.dateObj=t.parseDate(e,{format:a[u],skeleton:u}),s.dateObj){if(s.type=e.toString().indexOf(":")>-1?"time":"datetime","time"===s.type){var p=s.dateObj.toLocaleTimeString();s.dateObj=new Date("01/01/1900 "+p)}s.isCustom=!0;break}}if(Object(f.Z)(s.dateObj))for(var g=0,m=Object.keys(r.timeFormats);g<m.length;g++){var v=m[g];if(s.dateObj=t.parseDate(e,{format:r.timeFormats[v],skeleton:v}),s.dateObj){var y=s.dateObj.toLocaleTimeString();s.dateObj=new Date("01/01/1900 "+y),s.type="time",s.isCustom=!1;break}}}return"#DIV/0!"===e||s.dateObj||"Invalid Date"===new Date(e).toString()||(s.dateObj=new Date(e)),s}(n,i,this.parent.locale,r&&r.format),Object(f.Z)(t.dateObj)||"Invalid Date"===t.dateObj.toString()||(r=r||{},n=or(t.dateObj,n.indexOf(":")>-1,t.type&&"time"===t.type).toString(),r.format&&""!==r.format||(r.format=yr("time"===t.type?"Time":"ShortDate")),e.isDate="date"===t.type||"datetime"===t.type,e.isTime="time"===t.type,e.dateObj=t.dateObj)),e.updatedVal=n)}},{key:"checkCustomDateFormat",value:function(e){var t=e.indexOf("/")>-1?e.split("/"):e.indexOf("-")>0?e.split("-"):[""],i=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];if(2===t.length)return i.indexOf(t[0].toLowerCase())>-1&&Number(t[1])<=31?"01-"+t[0]+"-"+t[1]:i.indexOf(t[1].toLowerCase())>-1&&Number(t[0])<=31||Number(t[0])<=31&&Number(t[1])<=12||Number(t[1])<=31&&Number(t[0])<=12?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[0])<=12&&Number(t[1])<=9999&&Number(t[1])>=1900?"01-"+t[0]+"-"+t[1]:"Invalid";if(t.length>2)for(var n=function(e){if(!(Number(t[e])>-1||i.filter(function(i){return t[e].toLowerCase().includes(i)}).length))return{v:"Invalid"}},r=0;r<t.length;r++){var a=n(r);if("object"==typeof a)return a.v}return e}},{key:"formattedBarText",value:function(e){var t=br(e.cell?e.cell.format:""),i=new f.n,n=e.value,r="ShortDate"===t&&e.cell&&e.cell.format?e.cell.format:yr("ShortDate"),a=yr("Time");switch(t){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:t,value:e.value,format:r},i);break;case"Time":e.value=n&&Number(n)>=1?this.shortDateFormat({type:t,value:e.value,format:r},i)+" "+this.timeFormat({type:t,value:e.value,format:a},i):this.timeFormat({type:t,value:e.value,format:a},i)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=n)}},{key:"addEventListener",value:function(){this.parent.on("applyNumber",this.numberFormatting,this),this.parent.on("getFormattedCell",this.getFormattedCell,this),this.parent.on("checkDateFormat",this.checkDateFormat,this),this.parent.on("getFormattedBarText",this.formattedBarText,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("applyNumber",this.numberFormatting),this.parent.off("getFormattedCell",this.getFormattedCell),this.parent.off("checkDateFormat",this.checkDateFormat),this.parent.off("getFormattedBarText",this.formattedBarText))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"workbookNumberFormat"}}]),e}();function yr(e){var t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function br(e){var t="General";switch(e){case"0.00":case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);[Red]($#,##0.00)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':t="Accounting";break;case"mm-dd-yyyy":case"dd-mm-yyyy":case"dd-mm-yy":case"mm-dd-yy":case"dd/MM/yyyy":case"yyyy-MM-dd":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text";break;default:e&&e.indexOf("[$")>-1&&(t=e.indexOf("* ")>-1?"Accounting":"Currency")}return t}var Cr=function(){function t(e){a(this,t),this.parent=e,this.requestedInfo=[],this.addEventListener()}return o(t,[{key:"addEventListener",value:function(){this.parent.on("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler,this),this.parent.on("dataSourceChanged",this.dataSourceChangedHandler,this),this.parent.on("dataChanged",this.dataChangedHandler,this),this.parent.on("triggerDataChange",this.triggerDataChangeHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("updateSheetFromDataSource",this.updateSheetFromDataSourceHandler),this.parent.off("dataSourceChanged",this.dataSourceChangedHandler),this.parent.off("dataChanged",this.dataChangedHandler))}},{key:"updateSheetFromDataSourceHandler",value:function(e){var t,i,n,r,a,s,o,l,h,c,d=this,u=[],p=[],g=new m.d;if(e.promise=g.promise,e.sheet&&e.sheet.ranges.length)for(var f=function(f){var v=e.indexes[0],y=e.indexes[2],b=e.sheet.ranges[f];l=Wn(b.startCell)[0],s=b.dataSource instanceof m.b?b.dataSource:b.dataSource?new m.b(b.dataSource):new m.b,a=a||s.dataSource.url,e.sheet.isLocalData=!s.dataSource.url,l<=v?v-=l:l<=y?(y-=l,v=0):v=-1,b.showFieldAsHeader&&0!==v&&(v-=1);var C=!1,x=0;d.initRangeInfo(b);var S=d.getMaxCount(b);if(c=d.getLoadedInfo(v,y,b),v=c.unloadedRange[0],y=c.unloadedRange[1],b.info.insertRowRange&&(b.info.insertRowRange.forEach(function(e){x+=e[1]-e[0]+1}),v-=x,y-=x),v>S?C=!0:y>S&&(y=S),d.requestedInfo.push({deferred:g,indexes:e.indexes,isNotLoaded:c.isNotLoaded}),v>=0&&c.isNotLoaded&&!C){p[f]=v,u[f]=!1;var w=(b.query?b.query:new m.h).clone();s.executeQuery(w.range(v,y>=S?y:y+1).requiresCount()).then(function(a){if(d.parent&&!d.parent.isDestroyed){if(r=a.result&&a.result.result?a.result.result:a.result,n=Wn(b.startCell),l=n[0],h=n[1],r&&r.length){if(b.info.count||(S=a.count,b.info.count=a.count),i=Object.keys(r[0]),b.info.fldLen||(b.info.fldLen=i.length,b.info.flds=i),b.info.insertColumnRange){var s=0;b.info.insertColumnRange.forEach(function(e){for(var t=e[0];t<=e[1];t++)i.splice(t<=h?0:t-h,0,"emptyCell".concat(s)),s++})}0===p[f]&&b.showFieldAsHeader&&(o=l+p[f]+x,i.forEach(function(i,n){(t=Da(o,h+n,e.sheet,!0))?t.value&&!e.dataSourceChange||i.includes("emptyCell")||(t.value=i):e.sheet.rows[l+p[f]].cells[h+n]=i.includes("emptyCell")?{}:{value:i}}));var g=e.formulaCellRef?Za(d.parent,e.sheet.id):void 0;r.forEach(function(n,r){o=l+p[f]+r+(b.showFieldAsHeader?1:0)+x;for(var a=0;a<i.length;a++)(t=Da(o,h+a,e.sheet,!0))?t.value&&!e.dataSourceChange||i[a].includes("emptyCell")||Ma(o,h+a,e.sheet,d.getCellDataFromProp(n[i[a]]),!0):e.sheet.rows[o].cells[h+a]=i[a].includes("emptyCell")?{}:d.getCellDataFromProp(n[i[a]]),d.checkDataForFormat({args:e,cell:t,colIndex:h+a,rowIndex:o,i:r,j:a,k:f,range:b,sRanges:p,value:n[i[a]],sheetIndex:g})})}else i=[];if(e.sheet.usedRange.rowIndex=Math.max(l+(S||a.count)+(b.showFieldAsHeader?1:0)+x-1,e.sheet.usedRange.rowIndex),e.sheet.usedRange.colIndex=Math.max(h+i.length-1,e.sheet.usedRange.colIndex),x?(c=d.getLoadedInfo(v,y,b),v=c.unloadedRange[0],y=c.unloadedRange[1],v>S&&(c.isNotLoaded=!1),c.isNotLoaded&&(y>S&&(y=S),b.info.loadedRange.push([v,y]))):b.info.loadedRange.push([v,y]),u[f]=!0,-1===u.indexOf(!1)){if(y+l<l+b.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(f);var m={sheet:e.sheet,indexes:[0,0,e.sheet.usedRange.rowIndex,e.sheet.usedRange.colIndex],promise:new Promise(function(e,t){e(void 0)}),rangeSettingCount:e.rangeSettingCount};d.updateSheetFromDataSourceHandler(m),m.promise.then(function(){"workbook"!==d.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||d.parent.notify("created",null),e.formulaCellRef&&d.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex))})}else e.formulaCellRef&&d.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex);d.checkResolve(e.indexes)}}})}else 0===f&&-1===u.indexOf(!1)&&d.checkResolve(e.indexes)},v=e.sheet.ranges.length-1;v>=0;v--)f(v);else g.resolve()}},{key:"notfyFormulaCellRefresh",value:function(e,t){this.parent.formulaRefCell=null,this.parent.notify("updateView",{indexes:Wn(e),sheetIndex:t,refreshing:!0})}},{key:"checkResolve",value:function(e){var t,i,n=0;this.requestedInfo.forEach(function(r,a){((i=JSON.stringify(r.indexes)===JSON.stringify(e))||t)&&(0===a?(r.deferred.resolve(),n++,t=!0):!t||!r.isLoaded&&r.isNotLoaded?i&&t?(r.deferred.resolve(),n++):i?r.isLoaded=!0:t=!1:(r.deferred.resolve(),n++))}),this.requestedInfo.splice(0,n)}},{key:"getCellDataFromProp",value:function(e){var t={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?t.formula=e.formula:e.value&&("string"!=typeof e.value||0!==e.value.indexOf("http://")&&0!==e.value.indexOf("https://")&&0!==e.value.indexOf("ftp://")&&0!==e.value.indexOf("www.")?t.value=e.value:t.hyperlink=e.value):Sa(e)?t.formula=e:"string"!=typeof e||0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("ftp://")&&0!==e.indexOf("www.")?t.value=e:t.hyperlink=e,t}},{key:"checkDataForFormat",value:function(e){if(""!==e.value){var t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1,sheetIndex:e.sheetIndex};this.parent.notify("checkDateFormat",t),t.isDate?e.cell?(e.cell.format=yr("ShortDate"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=yr("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format=yr("Time"),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=yr("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}}},{key:"getLoadedInfo",value:function(e,t,i){var n=!0;return i.info.loadedRange.forEach(function(i){i[0]<=e&&e<=i[1]?i[0]<=t&&t<=i[1]?n=!1:e=i[1]+1:i[0]<=t&&t<=i[1]&&(t=i[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}}},{key:"getMaxCount",value:function(e){if(e.query)for(var t=e.query.queries,i=0;i<t.length;i++)if("onTake"===t[i].fn)return Math.min(t[i].e.nos,e.info.count||t[i].e.nos);return e.info.count}},{key:"initRangeInfo",value:function(e){e.info||(e.info={loadedRange:[]})}},{key:"dataSourceChangedHandler",value:function(e){var t,i=this,n=this.parent.sheets[e.sheetIdx],r=n.ranges[e.rangeIdx];if(r&&(this.checkRangeHasChanges(n,e.rangeIdx)||!r.info)){var a=r.showFieldAsHeader,s=Zn(r.startCell);r.info&&(r.info.loadedRange.forEach(function(e){for(var i=e[0];i<=e[1]&&i<r.info.count+(a?1:0);i++)if(t=n.rows[i+s[0]])for(var o=s[1];o<s[1]+r.info.fldLen;o++)t.cells&&t.cells[o]&&delete t.cells[o]}),r.info=null);var o=this.parent.viewport,l=[o.topIndex,o.leftIndex,o.bottomIndex,o.rightIndex],h={sheet:n,indexes:l,dataSourceChange:!0,promise:new Promise(function(e,t){e(void 0)})};this.updateSheetFromDataSourceHandler(h),h.promise.then(function(){i.parent.notify("updateView",{indexes:l,checkWrap:!0}),i.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:Number(e.rangeIdx),sheetIndex:Number(e.sheetIdx)})})}}},{key:"checkRangeHasChanges",value:function(e,t){if(this.parent.isAngular){return e.changedRangeIdx===parseInt(t,10)&&(delete e.changedRangeIdx,!0)}return!0}},{key:"dataChangedHandler",value:function(t){var i,n,r,a,s,o,l,h,c,d=this,u=[{}],p=void 0===t.sheetIdx?this.parent.activeSheetIndex:t.sheetIdx,g=this.parent.sheets[p];g.ranges.forEach(function(f,m){if(f.dataSource){var v;if(a=Zn(f.startCell),r=[].concat(e(a),[a[0]+f.info.count+(f.showFieldAsHeader?0:-1),a[1]+f.info.fldLen-1]),"Row"===t.modelType)t.insertType?(s=(f.showFieldAsHeader||"above"!==t.insertType?r[0]<t.index:r[0]<=t.index)&&r[2]>=t.index,h=[t.index],s||r[2]+1===t.index&&"below"===t.insertType?(v=!0,f.info.count+=t.model.length):r[0]>=t.index&&(f.startCell=Yn(a[0]+t.model.length,a[1]))):(s=r[0]<=t.startIndex&&r[2]>=t.startIndex,t.isDataRequest?h=[t.startIndex,r[1],t.startIndex,r[1]]:i="delete");else{h=Wn("paste"===t.requestType?t.pastedRange.split("!")[1]:t.sheetIdx>-1?t.address:(t.address||t.range).split("!")[1]);var y=[f.showFieldAsHeader?r[0]+1:r[0]].concat(e(r.slice(1,4)));s=Oa(y,h,!0),"paste"===t.requestType&&t.copiedInfo.isCut&&(c=[].slice.call(t.copiedInfo.range),o=Oa(y,c,!0))}s||v||o?("Row"!==t.modelType||t.insertType||t.isDataRequest?function(){i=v?"add":"edit";var e=0;if(o){e=c[2]-c[0]+1;for(var r=function(e){u[e]={},f.info.flds.forEach(function(t,i){n=Da(c[0]+e,a[1]+i,g),u[e][t]=d.getFormattedValue(n)})},l=0;l<e;l++)r(l)}if(s||v)for(var p=function(t){u[t+e]={},f.info.flds.forEach(function(i,r){n=Da(h[0]+t,a[1]+r,g),u[t+e][i]=d.getFormattedValue(n)})},m=0;m<(v?t.model.length:h[2]-h[0]+1||1);m++)p(m)}():(t.deletedModel.forEach(function(e,t){u[t]={},f.info.flds.forEach(function(i,r){e.cells?(n=e.cells[a[1]+r],u[t][i]=d.getFormattedValue(n)):u[t][i]=null}),f.info.count-=1}),l={count:t.deletedModel.length,index:t.endIndex}),t.isDataRequest?t.data=u:d.parent.trigger("dataSourceChanged",{data:u,action:i,rangeIndex:m,sheetIndex:p})):l&&l.count&&r[0]>l.index&&(f.startCell=Yn(a[0]-l.count,a[1]))}})}},{key:"getFormattedValue",value:function(e){var t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t}},{key:"triggerDataChangeHandler",value:function(e){var t=!0;(("delete"===e.action||"insert"===e.action)&&["Column","Sheet"].indexOf(e.eventArgs.modelType)>-1||"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1||"clipboard"===e.action&&"Formats"===e.eventArgs.requestType)&&(t=!1),!e.isUndo||"delete"!==e.action&&"insert"!==e.action||("delete"===e.action?(e.eventArgs.index=e.eventArgs.startIndex,e.eventArgs.model=e.eventArgs.deletedModel,e.eventArgs.insertType="below"):(e.eventArgs.startIndex=e.eventArgs.index,e.eventArgs.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,e.eventArgs.deletedModel=e.eventArgs.model,delete e.eventArgs.insertType)),t&&["insert","delete","edit","cellDelete","cellSave","clipboard","clear"].indexOf(e.action)>-1&&this.parent.notify("dataChanged",e.eventArgs)}},{key:"getModuleName",value:function(){return"dataBind"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]}}]),t}(),xr="editOperation",Sr="keyUp",wr="keyDown",kr="contextmenuBeforeOpen",Ir="paste",Or="autoFitRowsColumns",Rr="actionComplete",Ar="actionBegin",Er="renderGotoDlgt",Lr="renderFindDlg",Tr=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"open",value:function(e){var t=this;if(this.parent.allowOpen)if(e.jsonObject)this.fetchSuccess(e.jsonObject,null,!0);else{var i=new FormData;if(e.file){i.append("file",e.file);var n={passWord:""};e.password&&e.password.length&&(n.passWord=e.password),n.passWord&&n.passWord.length&&(e.password=n.passWord),e.password&&i.append("password",e.password);var r={file:e.file||null,cancel:!1,requestData:{method:"POST",body:i},password:n.passWord};this.parent.trigger("beforeOpen",r),this.parent.notify(Ar,{eventArgs:r,action:"beforeOpen"}),r.cancel||fetch(this.parent.openUrl,r.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(e){return t.fetchSuccess(e,r)}).catch(function(e){return t.fetchFailure(e)})}else this.parent.isOpen=!1}}},{key:"fetchFailure",value:function(e){Object(f.cb)(e.status)&&Object(f.cb)(e.statusText)&&(e.statusText="Improper response"),this.parent.notify("openFailure",e),this.parent.isOpen=!1}},{key:"fetchSuccess",value:function(e,t,i){var n=("string"==typeof e?JSON.parse(e):e).Workbook;["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword"].indexOf(n)>-1?this.parent.notify("openSuccess",{context:this,data:n,eventArgs:t}):(this.updateModel(n,i),this.parent.notify("openSuccess",{context:this,data:n}),this.parent.isOpen=!1,t&&t.password&&t.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password=""))}},{key:"updateModel",value:function(e,t){this.parent.notify(pr,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,t),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify("sheetsDestroyed",{}),e.activeSheetIndex=e.activeSheetIndex||0,this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[]},!0),$a(this.parent),this.parent.notify("sheetCreated",null),this.parent.notify(pr,{action:"registerSheet",isImport:!0}),this.parent.notify(pr,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null),this.parent.notify("updateFilter",{isOpen:!0})}},{key:"setSelectAllRange",value:function(e,t){var i,n,r=this;e.forEach(function(e){if(e.selectedRange){var a=Wn(e.selectedRange),s=(Object(f.cb)(e.rowCount)?100:e.rowCount)-1,o=(Object(f.cb)(e.colCount)?100:e.colCount)-1;65535===a[2]&&(a[2]=s),255===a[3]&&(a[3]=o),65535===a[0]&&(a[0]=s),255===a[1]&&(a[1]=o),e.selectedRange=Xn(a)}if(t&&r.parent.isAngular)for(var l=0;l<r.parent.sheets.length;l++)if(i=r.parent.sheets[l],e.name===i.name){e.ranges&&e.ranges.forEach(function(e,t){(n=i.ranges[t])&&n.template&&(e.template=n.template)});break}})}},{key:"addEventListener",value:function(){this.parent.on("workbookOpen",this.open.bind(this))}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("workbookOpen",this.open.bind(this))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"workbookOpen"}}]),e}(),jr=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this,e)).isProcessCompleted=!1,n.saveJSON={},n.isFullPost=!1,n.needBlobData=!1,n.customParams=null,n.addEventListener(),n}return o(i,[{key:"getModuleName",value:function(){return"workbookSave"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("beginSave",this.initiateSave,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("beginSave",this.initiateSave)}},{key:"initiateSave",value:function(e){var t=e.saveSettings;this.parent.notify("getFilteredCollection",null),this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.updateBasicSettings(),this.processSheets()}},{key:"updateBasicSettings",value:function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t}},{key:"processSheets",value:function(){var e=0,t=this.parent.sheets.length,i=["dataSource","startCell","query","showFieldAsHeader"];for(this.parent.isAngular&&i.push("template");e<t;)ir(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[e],i),e]),e++}},{key:"updateSheet",value:function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)}},{key:"getSheetLength",value:function(e){var t=0;return e.forEach(function(e){e&&t++}),t}},{key:"save",value:function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify("onSave",t),t.cancel||(this.isFullPost?this.initiateFullPostSave():ir(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams],!0)),this.saveJSON={}}},{key:"updateSaveResult",value:function(e){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify("saveError",{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify("saveCompleted",t)}},{key:"ClientFileDownload",value:function(e){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),i=URL.createObjectURL(e);t.href=i,document.body.appendChild(t),t.click(),URL.revokeObjectURL(i),document.body.removeChild(t)}},{key:"initiateFullPostSave",value:function(){var e,t=Object.keys(this.saveSettings),i=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),n=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(n.value=JSON.stringify(this.saveJSON),i.appendChild(n),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.saveSettings[t[e]],i.appendChild(n);for(t=Object.keys(this.customParams),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.customParams[t[e]],i.appendChild(n);document.body.appendChild(i),i.submit(),Object(f.J)(i),this.parent.notify("saveCompleted",{})}},{key:"getStringifyObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return JSON.stringify(e,function(e,i){return t.indexOf(e)>-1?void 0:i&&"object"==typeof i&&i.hasOwnProperty("properties")?i.properties:null!==i?i:void 0})}},{key:"getFileNameWithExtension",value:function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),i=e.lastIndexOf(".");return i>-1&&(e=e.substr(0,i)),e+t}},{key:"getFileExtension",value:function(){return"."+this.saveSettings.saveType.toLowerCase()}}]),i}(function(){function e(t){a(this,e),this.parent=t}return o(e,[{key:"processSheet",value:function(e,t){return[t,JSON.parse(e,function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]}},{key:"processSave",value:function(e,t,i){var n,r=new FormData,a=Object.keys(t);for(r.append("JSONData",JSON.stringify(e)),n=0;n<a.length;n++)r.append(a[n],t[a[n]]);for(a=Object.keys(i),n=0;n<a.length;n++)r.append(a[n],i[a[n]]);fetch(t.url,{method:"POST",body:r}).then(function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})}).then(function(e){new Promise(function(t){var i=new FileReader;i.onload=function(){var n,r=i.result.toString();if(r.indexOf("data:text/plain;base64,")>-1||r.indexOf("data:text/html;base64,")>-1||r.indexOf("data:application/json;base64,")>-1){if((r=(r=r.replace("data:text/plain;base64,","")).replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(r=r.replace("data:application/json;base64,",""),n=atob(r).split(".")):n=atob(r).split(/(\r\n|\n|\r)/gm),n.length){var a=n[0].length>1&&'"'===n[0][0]?n[0].split('"')[1]+".":n[0];postMessage({dialog:a})}}else postMessage(e);t(i.result)},i.readAsDataURL(e)})}).catch(function(e){postMessage({error:e.message})})}}]),e}());function Dr(e,t){for(var i=t,n=e.replace(/\[/g,".").replace(/\]/g,"").split("."),r=0;r<n.length&&!Object(f.cb)(i);r++)i=i[n[r]];return i}function Mr(e,t,i){var n,r,a=e.replace(/\[/g,".").replace(/\]/g,"").split("."),s=i||{},o=s,l=a.length;for(n=0;n<l;n++)r=a[n],n+1===l?o[r]=void 0===t?{}:t:Object(f.Z)(o[r])&&(o[r]={}),o=o[r];return s}var Fr,Pr,Nr=function(){function e(t){a(this,e),this.loadedModules=[],this.parent=t}return o(e,[{key:"inject",value:function(e,i){var n=e.length;if(0!==n){this.loadedModules.length&&this.clearUnusedModule(e);for(var r=0;r<n;r++){var a,s=e[r],o=t(i);try{for(o.s();!(a=o.n()).done;){var l=a.value,h=s.member;if(l.prototype.getModuleName()===s.member&&!this.isModuleLoaded(h)){var c=this.createInstance(l,s.args),d=this.getMemberName(h);Mr(d,s.isProperty?l:c,this.parent);var u=s;u.member=d,this.loadedModules.push(u)}}}catch(p){o.e(p)}finally{o.f()}}}else this.clean()}},{key:"createInstance",value:function(e,t){var i=t;return i.unshift(void 0),new(Function.prototype.bind.apply(e,i))}},{key:"clean",value:function(){var e,i=t(this.loadedModules);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.isProperty||Dr(n.member,this.parent).destroy()}}catch(r){i.e(r)}finally{i.f()}this.loadedModules=[]}},{key:"clearUnusedModule",value:function(e){var i,n=this,r=e.map(function(e){return n.getMemberName(e.member)}),a=t(this.loadedModules.filter(function(e){return-1===r.indexOf(e.member)}));try{for(a.s();!(i=a.n()).done;){var s=i.value;s.isProperty||Dr(s.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(s),1),this.deleteObject(this.parent,s.member)}}catch(o){a.e(o)}finally{a.f()}}},{key:"getMemberName",value:function(e){return e[0].toLowerCase()+e.substring(1)+"Module"}},{key:"deleteObject",value:function(e,t){delete e[t]}},{key:"isModuleLoaded",value:function(e){var i,n=t(this.loadedModules);try{for(n.s();!(i=n.n()).done;){if(i.value.member===this.getMemberName(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}}]),e}(),Br=function(e){return e[e.na=0]="na",e[e.value=1]="value",e[e.ref=2]="ref",e[e.divzero=3]="divzero",e[e.num=4]="num",e[e.name=5]="name",e[e.null=6]="null",e}({}),Hr=function(e){return e[e.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",e[e.reservedWord_And=1]="reservedWord_And",e[e.reservedWord_Xor=2]="reservedWord_Xor",e[e.reservedWord_If=3]="reservedWord_If",e[e.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",e[e.reservedWord_Else=5]="reservedWord_Else",e[e.reservedWord_Not=6]="reservedWord_Not",e[e.invalid_char_in_number=7]="invalid_char_in_number",e[e.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",e[e.mismatched_parentheses=8]="mismatched_parentheses",e[e.unknown_formula_name=9]="unknown_formula_name",e[e.requires_a_single_argument=10]="requires_a_single_argument",e[e.requires_3_args=11]="requires_3_args",e[e.invalid_Math_argument=12]="invalid_Math_argument",e[e.requires_2_args=13]="requires_2_args",e[e.bad_index=14]="bad_index",e[e.too_complex=15]="too_complex",e[e.circular_reference=16]="circular_reference",e[e.missing_formula=17]="missing_formula",e[e.improper_formula=18]="improper_formula",e[e.invalid_expression=19]="invalid_expression",e[e.cell_empty=20]="cell_empty",e[e.bad_formula=21]="bad_formula",e[e.empty_expression=22]="empty_expression",e[e.virtual_mode_required=23]="virtual_mode_required",e[e.mismatched_tics=24]="mismatched_tics",e[e.wrong_number_arguments=25]="wrong_number_arguments",e[e.invalid_arguments=26]="invalid_arguments",e[e.iterations_do_not_converge=27]="iterations_do_not_converge",e[e.calculation_overflow=29]="calculation_overflow",e[e.already_registered=28]="already_registered",e[e.missing_sheet=30]="missing_sheet",e[e.cannot_parse=31]="cannot_parse",e[e.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator",e[e.spill=33]="spill",e}({}),_r=function(){function t(e){a(this,t),this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"T",category:"Text",description:"Checks whether a value is text and returns the text if it is, or returns empty string if it is not."}],this.isConcat=!1,this.parent=e,this.init()}return o(t,[{key:"init",value:function(){for(var e,t=0;t<this.formulas.length;t++)e=Object(f.X)("Compute"+this.formulas[t].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[t].formulaName.toUpperCase(),e,this.formulas[t].category,this.formulas[t].description)}},{key:"addFormulaCollection",value:function(e,t,i,n){this.parent.libraryFormulas={fName:e,handler:t,category:i,description:n}}},{key:"ComputeSUM",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var n,r,a=0;if(!Object(f.Z)(t))for(var s=t,o=0;o<s.length;o++){var l=s[o].toString();if(l.indexOf(":")>-1&&this.parent.isCellReference(l))for(var h=this.parent.getCellCollection(l.split(this.parent.tic).join("")),c=0;c<h.length;c++){if(n=this.parent.getValueFromArg(h[c]),this.parent.getErrorStrings().indexOf(n)>-1)return n;Object(f.Z)(n[0])||isNaN(this.parent.parseFloat(n))||(a+=this.parent.parseFloat(n))}else{if(s[o].split(this.parent.tic).join("")===this.parent.trueValue&&(s[o]="1"),s[o].split(this.parent.tic).join("")===this.parent.falseValue&&(s[o]="0"),r=this.parent.getValueFromArg(s[o].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(r)>-1)return r;if(Object(f.Z)(r)||isNaN(this.parent.parseFloat(r)))continue;r.length>0&&(a+=this.parent.parseFloat(r+""))}}return a}},{key:"ComputeT",value:function(){for(var e="",t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];if(Object(f.Z)(i)||1!==i.length||""===i[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var r=i[0];return r=r.indexOf(":")>-1?r.split(":")[0]:r,null===(r=this.parent.getValueFromArg(r)).match(/^[0-9.]+$/)&&"TRUE"!==r.toUpperCase()&&"FALSE"!==r.toUpperCase()&&(e=r),e}},{key:"ComputeINT",value:function(){for(var e,t,i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(!Object(f.Z)(r)&&1!==r.length||""===r[0])&&(e=this.parent.formulaErrorStrings[Hr.invalid_arguments]),""!==r[0]&&1===r.length&&(i=(e=r[0]).indexOf('"'),e=(e=e.indexOf('"')>-1?e.replace('"',""):e).indexOf('"')>-1?e.replace('"',""):e,e="TRUE"===(e=this.parent.getValueFromArg(e)).toUpperCase()?"1":"FALSE"===e?"0":e,t=this.parent.parseFloat(e),t=Math.floor(t)),isNaN(t)&&(e=i>-1?this.parent.getErrorStrings()[Br.value]:this.parent.getErrorStrings()[Br.name]),t||e}},{key:"ComputeTODAY",value:function(){for(var e,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];if(i&&""!==i[0])e=this.parent.formulaErrorStrings[Hr.invalid_arguments];else{var r=new Date(Date.now());e=r.getFullYear()+"/"+this.parent.calculateDate((r.getMonth()+1).toString())+"/"+this.parent.calculateDate(r.getDate().toString())}return e}},{key:"ComputeSUMPRODUCT",value:function(){for(var e,t=0,i=0,n=null,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];for(var o=a,l=0;l<o.length;++l){var h=o[l];if(h.startsWith(this.parent.tic)||!this.parent.isCellReference(h)){var c=this.parent.getValueFromArg(h);return e=c.indexOf('"'),this.parent.getErrorStrings().indexOf(c)>-1?c:e>-1?0:this.parent.formulaErrorStrings[Hr.invalid_arguments]}var d=h.indexOf(":"),u=this.parent.rowIndex(h.substr(0,d)),p=this.parent.rowIndex(h.substr(d+1));if(!(-1!==u||-1===p)==(-1===u||-1!==p))return this.parent.getErrorStrings()[Br.name];var g=this.parent.colIndex(h.substr(0,d)),f=this.parent.colIndex(h.substr(d+1));if(null===n)for(i=(p-u+1)*(f-g+1),n=[],d=0;d<i;++d)n[d]=1;d=0;for(var m=u;m<=p;++m)for(var v=g;v<=f;++v){var y=this.getSheetReference(h)+this.parent.convertAlpha(v)+m,b=this.parent.getValueFromArg(y);if(isNaN(parseFloat(b)))n[d]=0;else{if(isNaN(n[d]))return this.parent.getErrorStrings()[Br.name];n[d]=n[d]*parseFloat(b)}d++}}for(var C=0;C<i;++C)t+=n[C];return t}},{key:"ComputeROUNDUP",value:function(){for(var e,t,i,n,r,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];var l=s.length;if(!Object(f.Z)(s)&&l>2&&(e=this.parent.formulaErrorStrings[Hr.invalid_arguments]),1===l&&""!==s[0])r=s[0].indexOf('"'),i="TRUE"===(i=(i=s[0].indexOf('"')>-1?s[0].replace('"',""):s[0]).indexOf('"')>-1?i.replace('"',""):i).toUpperCase()?"1":"FALSE"===i?"0":i,i=this.parent.getValueFromArg(i),(t=this.parent.parseFloat(i))>0?t+=.4999999999:t<0&&(t-=.4999999999),e=(t=this.parent.parseFloat(t.toFixed(0))).toString();else if(2===l&&""!==s[0]&&""!==s[1]){r=s[0].indexOf('"')>-1?s[0].indexOf('"'):s[1].indexOf('"')>-1?s[1].indexOf('"'):-1,i=(i=s[0].indexOf('"')>-1?s[0].replace('"',""):s[0]).indexOf('"')>-1?i.replace('"',""):i,n=(n=s[1].indexOf('"')>-1?s[1].replace('"',""):s[1]).indexOf('"')>-1?n.replace('"',""):n,i="TRUE"===i.toUpperCase()?"1":"FALSE"===i?"0":i,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n,i=this.parent.getValueFromArg(i),n=this.parent.getValueFromArg(n);var h=Math.ceil(this.parent.parseFloat(n));t=this.parent.parseFloat(i),h>0?(t>0?t+=.4999999999/Math.pow(10,h):t<0&&(t-=.4999999999/Math.pow(10,h)),e=(t=this.parent.parseFloat(t.toFixed(h))).toFixed(h),isNaN(t)&&(e=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Br.value]:this.parent.getErrorStrings()[Br.name])):(t>0?t=t/Math.pow(10,-h)+.49999:t<0&&(t=t/Math.pow(10,-h)-.49999),e=(t=this.parent.parseFloat(t.toFixed(0))*Math.pow(10,-h)).toString(),isNaN(t)&&(e=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[Br.value]:e=this.parent.getErrorStrings()[Br.name]))}else e=r>-1?this.parent.getErrorStrings()[Br.value]:this.parent.formulaErrorStrings[Hr.invalid_arguments];return e}},{key:"ComputeCOUNT",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var n,r,a,s=t,o=0,l=0;l<s.length;l++)if((n=s[l]).indexOf(":")>-1&&this.parent.isCellReference(n)){r=this.parent.getCellCollection(n.split(this.parent.tic).join(""));for(var h=0;h<r.length;h++)a=this.parent.getValueFromArg(r[h]),isNaN(this.parent.parseFloat(a))||n.length>0&&""!==n&&" "!==n&&o++}else n=n.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(n)))||n.length>0&&""!==n&&" "!==n&&o++;return o}},{key:"ComputeDATE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var n=t;if(3!==n.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var r=0;r<n.length;++r)n[r]=this.parent.getValueFromArg(n[r]);n[0]="TRUE"===n[0].split(this.parent.tic).join("")?"1":"FALSE"===n[0].split(this.parent.tic).join("")?"0":n[0],n[1]="TRUE"===n[1].split(this.parent.tic).join("")?"1":"FALSE"===n[1].split(this.parent.tic).join("")?"0":n[1],n[2]="TRUE"===n[2].split(this.parent.tic).join("")?"1":"FALSE"===n[2].split(this.parent.tic).join("")?"0":n[2];var a=this.parent.parseFloat(n[0].split(this.parent.tic).join("")),s=this.parent.parseFloat(n[1].split(this.parent.tic).join("")),o=this.parent.parseFloat(n[2].split(this.parent.tic).join("")),l=0;if(isNaN(a)||isNaN(s)||isNaN(o))return this.parent.getErrorStrings()[Br.value].toString();if(a<0)return this.parent.getErrorStrings()[Br.num].toString();for(;s>12;)s-=12,a++;if(0===(l=this.parent.getSerialDateFromDate(a,s,o)))return this.parent.getErrorStrings()[Br.num].toString();var h=this.parent.fromOADate(l);return"Invalid Date"!==h.toString()?h.getFullYear()+"/"+this.parent.calculateDate((h.getMonth()+1).toString())+"/"+this.parent.calculateDate(h.getDate().toString()):l.toString()}},{key:"ComputeFLOOR",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var n,r,a=t,s=a.length,o=a[1].split(this.parent.tic).join(""),l=[];if(2!==s)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(l.push(n=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=o===this.parent.trueValue?"1":o===this.parent.falseValue?"0":a[1],l.push(r=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),n>0&&r<0)return this.parent.getErrorStrings()[Br.num];if(n>0&&0===r)return this.parent.getErrorStrings()[Br.divzero];for(var h=0;h<a.length;h++)if(a[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Br.value];return isNaN(n)?this.parent.getErrorStrings()[Br.name]:Math.floor(n/r)*r}},{key:"ComputeCEILING",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var n,r,a=t,s=[],o=a.length,l=a[1].split(this.parent.tic).join("");if(2!==o)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(s.push(n=this.parent.parseFloat(this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")))),a[1]=l===this.parent.trueValue?"1":l===this.parent.falseValue?"0":a[1],s.push(r=this.parent.parseFloat(this.parent.getValueFromArg(a[1].split(this.parent.tic).join("")))),n>0&&r<0)return this.parent.getErrorStrings()[Br.num];for(var h=0;h<a.length;h++)if(a[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Br.value];return isNaN(n)?this.parent.getErrorStrings()[Br.name]:0===r?0:Math.ceil(n/r)*r}},{key:"ComputeDAY",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t;if(Object(f.Z)(r)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];if(r.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(a))?(n=this.parent.parseDate(a),"[object Date]"===Object.prototype.toString.call(n)&&(n=n.getDate()),n):this.parent.getErrorStrings()[Br.name]}},{key:"ComputeIF",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];if(this.parent.getErrorStrings().indexOf(t[0])>0)return t[0];var n,r,a,s=t;if(4===s.length&&"nestedFormulaTrue"===s[3]&&(n=!0,s.pop()),s.length>3||1===s.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(s.length<=3){if(r=this.parent.getValueFromArg(s[0]),this.parent.getErrorStrings().indexOf(r)>-1)return r;if(r===this.parent.trueValue||this.parent.parseFloat(r)>0||this.parent.parseFloat(r)<0)a=this.parent.getValueFromArg(s[1]);else{if(r!==this.parent.falseValue&&0!==this.parent.parseFloat(r))return this.parent.formulaErrorStrings[Hr.requires_3_args];if(Object(f.Z)(s[2]))return this.parent.falseValue;a=this.parent.getValueFromArg(s[2])}}return!n&&a.indexOf(this.parent.tic)>-1?a.split(this.parent.tic).join(""):a}},{key:"ComputeIFERROR",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var n,r=t;return 2!==r.length?this.parent.formulaErrorStrings[Hr.wrong_number_arguments]:(n=this.parent.getValueFromArg(r[0]))===this.parent.trueValue||n===this.parent.falseValue?n:(n[0]===this.parent.arithMarker&&(n=n.replace(this.parent.arithMarker," ")),"#"===(n=this.parent.getValueFromArg(n).toUpperCase().split(this.parent.tic).join(""))[0]||n.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(n)>-1?this.parent.getValueFromArg(r[1]).split(this.parent.tic).join(""):n)}},{key:"ComputePRODUCT",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];var n,r,a,s=1,o=!0;if(!Object(f.Z)(t))for(var l=t,h=0;h<l.length;h++){var c=l[h];if(c.indexOf(":")>-1&&this.parent.isCellReference(c))for(var d=this.parent.getCellCollection(c),u=0;u<d.length;u++){if(n=this.parent.getValueFromArg(d[u].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,a=this.parent.parseFloat(n),isNaN(a)||n.length>0&&(s*=a,o=!1)}else{if(r=this.parent.getValueFromArg(l[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(r)>-1)return r;if(r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r,a=this.parent.parseFloat(r),isNaN(a)||r.length>0&&(s*=a,o=!1),this.parent.getErrorStrings().indexOf(r)>-1)return r}}return o?"0":s.toString()}},{key:"ComputeDAYS",value:function(){for(var e,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];if(Object(f.Z)(i)&&1===i.length&&""===i[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];if(2!==i.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=i;r[0].split(this.parent.tic).join("")===this.parent.trueValue&&(r[0]="1"),r[0].split(this.parent.tic).join("")===this.parent.falseValue&&(r[0]="0");var a=this.parent.getValueFromArg(r[0].split(this.parent.tic).join("")),s=this.parent.getValueFromArg(r[1].split(this.parent.tic).join(""));if(s=""===s||null==s?new Date(Date.parse("1899-12-31")).toDateString():s,"#"===(a=""===a||null==a?new Date(Date.parse("1899-12-31")).toDateString():a)[0])return a;if("#"===s[0])return s;var o=this.parent.intToDate(a),l=this.parent.intToDate(s);return"#"===o.toString()[0]?o.toString():"#"===l.toString()[0]?l.toString():"[object Date]"!==Object.prototype.toString.call(o)||"[object Date]"!==Object.prototype.toString.call(l)?this.parent.getErrorStrings()[Br.value]:(e=Math.ceil(o.getTime()-l.getTime())/864e5,Math.round(e))}},{key:"ComputeUNIQUE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t;if(Object(f.Z)(t)||""===t[0]||r.length>3)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var a=r[1]?r[1].toUpperCase():"FALSE",s=r[2]?r[2].toUpperCase():"FALSE",o=[];if(r[0].indexOf(":")>-1){if(Object(f.Z)(r[0].match(/[0-9]/))){var l=r[0].split(":");r[0]=l[0]+"1:"+l[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if(Object(f.Z)(r[0].toUpperCase().match(/[A-Z]/))){var h=r[0].split(":");r[0]="A"+h[0]+":"+Gr(this.parent.spreadSheetUsedRange[1]+1)+h[1]}var c=r[0].split(":");if(this.parent.isCellReference(c[0])&&this.parent.isCellReference(c[1])){for(var d=this.parent.dependencyCollection,u=0;u<d.length;u++)d[u].split(":")[0]===r[0].split(":")[0]&&this.clearDependency(d[u]);-1===this.parent.dependencyCollection.indexOf(r[0])?this.parent.dependencyCollection.push(r[0]):this.clearDependency(r[0]);var p,g=r[0].indexOf(":"),m=this.parent.rowIndex(this.parent.substring(r[0],0,g)),v=this.parent.colIndex(this.parent.substring(r[0],0,g)),y=this.parent.rowIndex(this.parent.substring(r[0],g+1,g+r[0].length-g-1)),b=this.parent.colIndex(this.parent.substring(r[0],g+1,g+r[0].length-g-1));m>y&&(p=y,y=m,m=p),v>b&&(p=b,b=v,v=p);var C="";0===r[0].indexOf("!")&&(C=(C=(C=r[0]).replace("!","")).indexOf("!"),C=r[0].substring(0,C+2)),r[0]=C+Gr(v)+m+":"+Gr(b)+y;for(var x=this.parent.getCellCollection(r[0]),S=b-v,w=[],k=0;k<x.length;k++)w.push(x[k]);if("FALSE"===a)if(0===S)for(var I=0;I<w.length;I++){var O=this.parent.getValueFromArg(w[I]);O=""===O?"0":O,o.push(O)}else for(var R="",A=S,E=0;E<w.length;E++){if(E===w.length-1){var L=this.parent.getValueFromArg(w[E]);R=R+(L=""===L?"0":L)+"+",o.push(R.substring(0,R.length-1))}if(E<=A){var T=this.parent.getValueFromArg(w[E]);R=R+(T=""===T?"0":T)+"+"}else{o.push(R.substring(0,R.length-1)),A=S+E;var j=this.parent.getValueFromArg(w[E]);R=(j=""===j?"0":j)+"+"}}else for(var D="",M=S+1,F=y-m,P=0;P<M;P++){for(var N=0;N<=F;N++){var B=this.parent.getValueFromArg(w[N*M+P]);D=D+(B=""===B?"0":B)+"+"}o.push(D.substring(0,D.length-1)),D=""}for(var H=[],_=[],z=0;z<o.length;z++)-1===H.indexOf(o[z])?H.push(o[z]):_.push(o[z]);if("TRUE"===s){for(var V=[],U=0;U<H.length;U++)-1===_.indexOf(H[U])&&V.push(H[U]);H=V}var q=this.parent.actCell,W=this.parent.rowIndex(q),Z=this.parent.colIndex(q);if(0===this.parent.dependencyLevel)if("FALSE"===a){for(var G=W,Y=H.length+W;G<Y;G++)for(var X=Z,K=H[0].split("+").length+Z;X<K;X++)G===Y-1&&X===K-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Gr(X)+G)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Gr(X)+G);for(var J=W,Q=H.length+W;J<Q;J++)for(var $=Z,ee=H[0].split("+").length+Z;$<ee;$++){var te=this.parent.getValueFromArg(Gr($)+J,!0);if(""!==te&&1!==te.indexOf("UNIQUE"))return this.parent.formulaErrorStrings[Hr.spill]}}else{for(var ie=Z,ne=H.length+Z;ie<ne;ie++)for(var re=W,ae=H[0].split("+").length+W;re<ae;re++)ie===ne-1&&re===ae-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Gr(ie)+re)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Gr(ie)+re);for(var se=Z,oe=H.length+Z;se<oe;se++)for(var le=W,he=H[0].split("+").length+W;le<he;le++){var ce=this.parent.getValueFromArg(Gr(se)+le,!0);if(""!==ce&&1!==ce.indexOf("UNIQUE"))return this.parent.formulaErrorStrings[Hr.spill]}}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(Gr(Z)+W,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[Hr.spill];if("FALSE"===a){for(var de=0;de<H.length;de++){var ue=H[de].split("+");de>0&&(W++,Z=this.parent.colIndex(q));for(var pe=0;pe<ue.length;pe++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,ue[pe],W,Z),ue[pe+1]&&Z++}n=H[0].split("+")[0]}else{for(var ge=0;ge<H.length;ge++)for(var fe=H[ge].split("+"),me=0;me<fe.length;me++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,fe[me],W,Z),fe[me+1]?W++:(Z++,W=this.parent.rowIndex(q));n=H[0].split("+")[0]}}}else this.parent.isCellReference(r[0])&&(-1===this.parent.dependencyCollection.indexOf(r[0])?this.parent.dependencyCollection.push(r[0]):this.clearDependency(r[0]),n=this.parent.getValueFromArg(r[0]));return n}},{key:"clearDependency",value:function(e){for(var t=this.parent.actCell,i=this.parent.rowIndex(t),n=this.parent.colIndex(t),r=e.indexOf(":"),a=this.parent.rowIndex(this.parent.substring(e,0,r)),s=this.parent.colIndex(this.parent.substring(e,0,r)),o=this.parent.rowIndex(this.parent.substring(e,r+1,r+e.length-r-1))-a+i,l=this.parent.colIndex(this.parent.substring(e,r+1,r+e.length-r-1))-s+n,h=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"",c=i;c<=o;c++)for(var d=n;d<=l;d++)if(this.parent.dependencyLevel>0||h.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+Gr(n)+i,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,null,c,d)}}},{key:"ComputeCHOOSE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];if(t.length<2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var n=t;if(n[0].indexOf(":")>-1&&this.parent.isCellReference(n[0])){var r=this.parent.getCellCollection(n[0]);if(1!==r.length)return this.parent.getErrorStrings()[Br.value];n[0]=r[0]}var a=this.parent.getValueFromArg(n[0]);if(this.parent.getErrorStrings().indexOf(a)>-1)return a;var s,o=this.parent.parseFloat(this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")));if(o<1)return this.parent.getErrorStrings()[Br.value];if(o=Math.floor(o),Object(f.Z)(n[o]))return this.parent.getErrorStrings()[Br.value];if(""===(s=n[o])&&(s="0"),s.indexOf(":")>-1&&this.parent.isCellReference(s)){var l=this.parent.getCellCollection(n[0].split(this.parent.tic).join(""));if(1!==l.length)return this.parent.getErrorStrings()[Br.value];n[0]=l[0]}return this.parent.getValueFromArg(s).split(this.parent.tic).join("")}},{key:"ComputeSUMIF",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0])||n[2]&&n[2].indexOf(":")<0&&!this.parent.isCellReference(n[2]))return this.parent.formulaErrorStrings[Hr.improper_formula];if(n.length>3||n.length<2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof r&&(this.parent.formulaErrorStrings.indexOf(r)||this.parent.getErrorStrings().indexOf(r))?r:r[0]}},{key:"ComputeABS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t,a="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(""===r[0].toString().split(this.parent.tic).join("").trim()||r[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Br.value];if(this.parent.isCellReference(r[0])){if(""===(a=this.parent.getValueFromArg(r[0])))return this.parent.getErrorStrings()[Br.name];if(n=this.parent.parseFloat(a),isNaN(n))return this.parent.getErrorStrings()[Br.value]}else if(n=this.parent.parseFloat(r[0]),isNaN(n))return this.parent.getErrorStrings()[Br.name];return Math.abs(n)}},{key:"ComputeAVERAGE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];for(var n=t,r=0;r<n.length;r++)if(n[r].indexOf(":")>-1&&n[r].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[Br.value];return this.parent.calculateAvg(n)}},{key:"ComputeAVERAGEIF",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(n[0].indexOf(":")<0&&!this.parent.isCellReference(n[0]))return this.parent.formulaErrorStrings[Hr.improper_formula];var r=this.parent.computeSumIfAndAvgIf(t);return"string"==typeof r&&(this.parent.formulaErrorStrings.indexOf(r)||this.parent.getErrorStrings().indexOf(r))?r:this.parent.parseFloat(r[0])/this.parent.parseFloat(r[1])}},{key:"ComputeCONCATENATE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.invalid_arguments];for(var n=t,r="",a="",s=0;s<n.length;s++){if(n[s].indexOf(":")>-1&&this.parent.isCellReference(n[s])){if(!this.isConcat)return this.parent.getErrorStrings()[Br.value];for(var o=this.parent.getCellCollection(n[s]),l=0;l<o.length;l++)r+=a=this.parent.getValueFromArg(o[l])}else{if(1===n.length&&n[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[Br.name];r+=a=this.parent.getValueFromArg(n[s])}if(this.parent.getErrorStrings().indexOf(a)>-1)return a}return r.split(this.parent.tic).join("")}},{key:"ComputeCONCAT",value:function(){return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,arguments)}},{key:"ComputeMAX",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeMinMax(t,"max")}},{key:"ComputeMIN",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeMinMax(t,"min")}},{key:"ComputeRAND",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 1===t.length&&""===t[0]&&(t.length=0),t.length>0?this.parent.formulaErrorStrings[Hr.wrong_number_arguments]:Math.random().toString()}},{key:"ComputeAND",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeAndOr(t,"and")}},{key:"ComputeOR",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeAndOr(t,"or")}},{key:"ComputeFIND",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var n=t;if(n.length>3)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=this.parent.removeTics(this.parent.getValueFromArg(n[0])),a=this.parent.removeTics(this.parent.getValueFromArg(n[1]));if(this.parent.getErrorStrings().indexOf(r)>-1||this.parent.getErrorStrings().indexOf(a)>-1)return this.parent.getErrorStrings()[Br.name];var s=1;if(3===n.length){if(s=this.parent.removeTics(this.parent.getValueFromArg(n[2])),this.parent.getErrorStrings().indexOf(s)>-1)return s;s=this.parent.parseFloat(s),isNaN(s)&&(s=1)}if(s<=0||s>a.length)return this.parent.getErrorStrings()[Br.value];var o=a.indexOf(r,s-1);return o<0?this.parent.getErrorStrings()[Br.value]:(Number(o)+Number(1)).toString()}},{key:"ComputeINDEX",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t,r=n.length;if(Object(f.Z)(t)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(r>3)return this.parent.getErrorStrings()[Br.ref];var a="",s=[];if(r>2)for(var o=0;o<r;o++){if(this.parent.isCellReference(n[o])&&n[o].indexOf(":")<0)return this.parent.getErrorStrings()[Br.ref];this.parent.isCellReference(n[o])&&(s[o]=n[o])}if(a=n[0],n[1]=""===n[1]?"1":n[1],n[1]=this.parent.getValueFromArg(n[1]),this.parent.getErrorStrings().indexOf(n[1])>-1)return n[1];if(!Object(f.Z)(n[2])){if(n[2]=""===n[2]?"1":n[2],n[2]=this.parent.getValueFromArg(n[2]),this.parent.getErrorStrings().indexOf(n[2])>-1)return n[2];if("0"===n[2])return this.parent.getErrorStrings()[Br.value]}var l=parseFloat(n[1]);l=isNaN(l)?-1:l;var h=parseFloat(n[2]?n[2]:"1");if(h=isNaN(h)?-1:h,-1===l||-1===h)return this.parent.getErrorStrings()[Br.value];var c=n[0].indexOf(":"),d=this.parent.rowIndex(a.substring(0,c)),u=this.parent.rowIndex(a.substring(c+1)),p=this.parent.colIndex(a.substring(0,c)),g=this.parent.colIndex(a.substring(c+1));if(l>u-d+1||h>g-p+1)return this.parent.getErrorStrings()[Br.ref];l=d+l-1,h=p+h-1;var m=this.getSheetReference(a)+this.parent.convertAlpha(h)+l,v=this.parent.getValueFromArg(m);return""===v?0:v}},{key:"getSheetReference",value:function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""}},{key:"ComputeIFS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(Object(f.Z)(t)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var r="",a="",s=0;s<n.length;s++){if((r=this.parent.getValueFromArg(n[s]))!==this.parent.trueValue&&r!==this.parent.falseValue)return this.parent.getErrorStrings()[Br.value];if(r===this.parent.trueValue)return n[s+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(a=this.parent.isCellReference(n[s+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(n[s+1]):n[s+1].indexOf(this.parent.tic)>-1?n[s+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[Br.name],s+=1,a);r===this.parent.falseValue&&(s+=1)}return this.parent.getErrorStrings()[Br.na]}},{key:"ComputeCOUNTA",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var n,r=t,a=0,s=0;s<r.length;s++)if(r[s].indexOf(":")>-1&&this.parent.isCellReference(r[s])){n=this.parent.getCellCollection(r[s].split(this.parent.tic).join(""));for(var o=0;o<n.length;o++)this.parent.getValueFromArg(n[o]).length>0&&a++}else this.parent.getValueFromArg(r[s].split(this.parent.tic).join("")).length>0&&a++;return a}},{key:"ComputeAVERAGEA",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Object(f.Z)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var n,r,a,s=t,o=0,l=0,h=0;h<s.length;h++){if(s[h].indexOf(":")>-1&&this.parent.isCellReference(s[h])){n=this.parent.getCellCollection(s[h].split(this.parent.tic).join(""));for(var c=0;c<n.length;c++)if((r=this.parent.getValueFromArg(n[c])).toUpperCase()===this.parent.trueValue)r="1";else if(r.toUpperCase()===this.parent.falseValue||""===r)r="0";else{if(this.parent.getErrorStrings().indexOf(r)>-1)return r;r.length>0&&(a=parseFloat(r),o+=r=isNaN(a)?0:a,l+=1)}l=n.length}else{if(s[h]===this.parent.trueValue&&(s[h]="1"),s[h]!==this.parent.falseValue&&""!==s[h]||(s[h]="0"),r=this.parent.getValueFromArg(s[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(r)>-1)return r;r.length>0&&(a=parseFloat(r),o+=r=isNaN(a)?0:a,l+=1)}if(0===l)return this.parent.getErrorStrings()[Br.divzero]}return o/l}},{key:"ComputeSORT",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t;if(Object(f.Z)(t)||""===t[0]||r.length>4)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];r[1]=r[1]?r[1]:"1",r[2]=r[2]?r[2]:"1";var a,s="1"===r[2]?"Ascending":"Descending";r[3]=r[3]?r[3].toUpperCase():"FALSE",r[0]=r[0].split("$").join("");var o=[];if(r[0].indexOf(":")>-1){var l=r[0].split(":");if(this.parent.isCellReference(l[0])&&this.parent.isCellReference(l[1])){var h,c=r[0].indexOf(":"),d=this.parent.rowIndex(this.parent.substring(r[0],0,c)),u=this.parent.colIndex(this.parent.substring(r[0],0,c)),p=this.parent.rowIndex(this.parent.substring(r[0],c+1,c+r[0].length-c-1)),g=this.parent.colIndex(this.parent.substring(r[0],c+1,c+r[0].length-c-1));if(d>p&&(h=p,p=d,d=h),u>g&&(h=g,g=u,u=h),r[2]=this.parent.getValueFromArg(r[2]),"1"!==r[2]&&"-1"!==r[2])return this.parent.getErrorStrings()[Br.value];if(!isNaN(this.parseDouble(r[1]))&&this.parseDouble(r[1])<1)return this.parent.getErrorStrings()[Br.value];if(r[3].toUpperCase()!==this.parent.trueValue&&r[3].toUpperCase()!==this.parent.falseValue)return this.parent.getErrorStrings()[Br.value];var v="";0===r[0].indexOf("!")&&(v=(v=(v=r[0]).replace("!","")).indexOf("!"),v=r[0].substring(0,v+2)),r[0]=v+Gr(u)+d+":"+Gr(g)+p,a=this.parent.getCellCollection(r[0]);for(var y=0;y<a.length;y++)o.push(this.parent.getValueFromArg(a[y]));var b=[],C=g-u+1;if("TRUE"===r[3])for(var x=0;x<C;x++)o[x+(this.parseDouble(r[1])-1)*C]&&b.push(isNaN(this.parseDouble(o[x+(this.parseDouble(r[1])-1)*C]))?o[x+(this.parseDouble(r[1])-1)*C]:this.parseDouble(o[x+(this.parseDouble(r[1])-1)*C]));if("FALSE"===r[3])for(var S=0;S<o.length;S++)o[S*C+this.parseDouble(r[1])-1]&&b.push(isNaN(this.parseDouble(o[S*C+this.parseDouble(r[1])-1]))?o[S*C+this.parseDouble(r[1])-1]:this.parseDouble(o[S*C+this.parseDouble(r[1])-1]));for(var w=m.c.sort(b,null,m.c.fnSort(s)),k=[],I=0;I<w.length;I++)for(var O=0;O<b.length;O++)JSON.stringify(w[I])===JSON.stringify(b[O])&&-1===k.indexOf(O)&&k.push(O);if("TRUE"===r[3]){for(var R=d,A=0;R<=p;R++,A++)for(var E=0,L=0;E<k.length;E++,L++){var T=this.parent.getValueFromArg(v+Gr(k[E]+u)+R),j=this.parent.actCell,D=this.parent.rowIndex(j),M=this.parent.colIndex(j);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,T,D+A,M+L)}n=this.parent.getValueFromArg(v+Gr(k[0]+u)+d)}if("FALSE"===r[3]){for(var F=0,P=0;F<k.length;F++,P++)for(var N=u,B=0;N<=g;N++,B++){var H=this.parent.getValueFromArg(v+Gr(N)+(k[F]+d)),_=this.parent.actCell,z=this.parent.rowIndex(_),V=this.parent.colIndex(_);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,H,z+P,V+B)}n=this.parent.getValueFromArg(v+Gr(u)+(k[0]+d))}}}return n}},{key:"ComputeCOUNTIF",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(Object(f.Z)(t)||""===t[0]||2!==n.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r,a,s=0,o=[],l="equal",h=n[1].split(this.parent.tic).join("");if(h.startsWith("<=")?(l="lessEq",h=h.substring(2)):h.startsWith(">=")?(l="greaterEq",h=h.substring(2)):h.startsWith("<>")?(l="notEq",h=h.substring(2)):h.startsWith("<")?(l="less",h=h.substring(1)):h.startsWith(">")?(l="greater",h=h.substring(1)):h.startsWith("=")&&(l="equal",h=h.substring(1)),n[0].indexOf(":")>-1&&this.parent.isCellReference(n[0])){r=this.parent.getCellCollection(n[0].split(this.parent.tic).join(""));for(var c=0;c<r.length;c++)a=this.parent.getValueFromArg(r[c]),(h.indexOf("*")>-1||h.indexOf("?")>-1)&&(a=this.parent.findWildCardValue(h,a)),o.push(a),o.push(h),this.parent.processLogical(o,l)===this.parent.trueValue&&s++}return s}},{key:"ComputeSUMIFS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeIfsFormulas(t,this.parent.falseValue)}},{key:"ComputeTEXT",value:function(){for(var e,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=i.length,a=0;a<r;a++)e=Object(f.Z)(e)?i[a]:e+","+i[a];var s=e.indexOf(","),o=e.slice(0,s),l=e.slice(e.indexOf('"')+1,e.length),h=l.indexOf('"');if(s>-1&&h!==l.length-1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var c=o,d=l.slice(0,l.length-1),u=new Date(1900,0,1,0,0,0),p=c+","+d,g=new f.n;if(this.parent.getErrorStrings().indexOf(p)>-1)return p;if(c=this.parent.getValueFromArg(c),""===(d=d.split(this.parent.tic).join("")))return"";""===c&&(d.length>0&&(d.toUpperCase().indexOf("M")>-1||d.toUpperCase().indexOf("D")>-1||d.toUpperCase().indexOf("Y")>-1||d.toUpperCase().indexOf("S")>-1||d.toUpperCase().indexOf("T")>-1)||d.toUpperCase().indexOf("H")>-1)&&(c=u.toString());var m=this.parseDouble(c);if(isNaN(m)&&null!==this.parent.isDate(new Date(c))&&(m=this.parent.toOADate(new Date(c))),u=Date.parse(c.split(this.parent.tic).join("")),!isNaN(m)||!isNaN(u)){if("["===d[0])return this.parent.tic+c+this.parent.tic;if(d.length>0&&(d.toUpperCase().indexOf("M")>-1||d.toUpperCase().indexOf("D")>-1||d.toUpperCase().indexOf("Y")>-1||d.toUpperCase().indexOf("S")>-1||d.toUpperCase().indexOf("T")>-1)||d.toUpperCase().indexOf("H")>-1){var v=(d=(d=d.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),y=!1,b=!1,C=0,x=0,S=0;for(C=0;C<v.length;){var w=v[C];"s"===w&&"M"===v[x]&&(v[x]="m","M"===v[x-1]&&(v[x-1]="m")),this.parent.isChar(w)?(x=C,"M"===w&&S++):S>1&&S++,"M"===w&&y&&(v[C]="m",b=!0),"h"===w?y=!0:this.parent.isChar(w)&&"M"!==w&&"h"!==w&&!b&&(y=!1,b=!1),C++}d=(d=String(v)).split(",").join("").split("\n").join(" ");var k=this.parent.fromOADate(m);0===m&&(k=u);var I=function(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM-yyyy":case"MMM yyyy":e="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;default:e=""}return e}(d);if(""===I)return this.parent.getErrorStrings()[Br.name];c=g.getDateFormat({skeleton:I,type:"date"})(new Date(k.toString()))}else c=g.formatNumber(m,{format:d})}return c}},{key:"ComputeCOUNTIFS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeIfsFormulas(t,this.parent.trueValue)}},{key:"ComputeAVERAGEIFS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.parent.computeIfsFormulas(t,this.parent.falseValue,this.parent.trueValue)}},{key:"ComputeMATCH",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t;if(Object(f.Z)(r)||1===r.length&&""===r[0]||r.length<2||r.length>3)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var a=[],s=r[0].split(this.parent.tic).join("");if(this.parent.isCellReference(s)&&(s=this.parent.getValueFromArg(s)),!s.toString().length)return this.parent.getErrorStrings()[Br.na];r[2]=Object(f.Z)(r[2])?"1":r[2].split(this.parent.tic).join(""),r[2].split(this.parent.tic).join("")===this.parent.trueValue&&(r[2]="1"),r[2].split(this.parent.tic).join("")===this.parent.falseValue&&(r[2]="0");var o=parseFloat(r[2]);if(-1!==o&&0!==o&&1!==o)return this.parent.getErrorStrings()[Br.na];var l=0,h="";if(r[1].indexOf(":")>-1||this.parent.isCellReference(r[1])){n=this.parent.getCellCollection(r[1].split(this.parent.tic).join(""));for(var c=0;c<n.length;c++)a[c]=this.parent.getValueFromArg(n[c]).split(this.parent.tic).join("");for(var d=0;d<a.length;d++)if(a[d].toString().length)if(1===o){if(s===a[d])return d+1;s>a[d]&&(h?a[d]>h&&(l=d+1,h=a[d]):(l=d+1,h=a[d]))}else if(0===o){if((s.indexOf("*")>-1||s.indexOf("?")>-1)&&(a[d]=this.parent.findWildCardValue(s,a[d])),s===a[d])return d+1;if(this.parent.parseFloat(s)===this.parent.parseFloat(a[d]))return d+1}else if(-1===o){if(s===a[d])return d+1;s<a[d]&&(h?a[d]<h&&(l=d+1,h=a[d]):(l=d+1,h=a[d]))}}return l||this.parent.getErrorStrings()[Br.na]}},{key:"ComputeSUBTOTAL",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=i,a="";if(r.length<2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var s=this.parent.parseFloat(this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))),o=r.slice(1,r.length);switch(s){case 1:case 101:a=this.ComputeAVERAGE.apply(this,e(o));break;case 2:case 102:a=this.ComputeCOUNT.apply(this,e(o));break;case 3:case 103:a=this.ComputeCOUNTA.apply(this,e(o));break;case 4:case 104:a=this.ComputeMAX.apply(this,e(o));break;case 5:case 105:a=this.ComputeMIN.apply(this,e(o));break;case 6:case 106:a=this.ComputePRODUCT.apply(this,e(o));break;case 7:case 107:a=this.ComputeDAY.apply(this,e(o));break;case 8:case 108:a=this.ComputeCONCAT.apply(this,e(o));break;case 9:case 109:a=this.ComputeSUM.apply(this,e(o));break;case 10:case 110:a=this.ComputeAVERAGEA.apply(this,e(o));break;case 11:case 111:a=this.ComputeABS.apply(this,e(o));break;default:a=this.parent.getErrorStrings()[Br.value]}return a}},{key:"ComputeRADIANS",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(""===n[0]||n.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(n[0].indexOf(":")>-1||""===n[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[Br.value];var r=n[0].split(this.parent.tic).join("");n[0]=isNaN(this.parent.parseFloat(r))?n[0]:r;var a=this.parent.getValueFromArg(n[0]),s=this.parent.parseFloat(a);return isNaN(s)?a.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[Br.value]:this.parent.getErrorStrings()[Br.name]:Math.PI*s/180}},{key:"ComputeRANDBETWEEN",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a,s=t.length;if(2!==s)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(var o=0;o<s;o++){if(""===t[o])return this.parent.getErrorStrings()[Br.na];if(t[o].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(t[o].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[Br.value];t[o]=t[o].split(this.parent.tic).join("")}if(a=parseFloat(this.parent.getValueFromArg(t[o])),this.parent.isCellReference(t[o])){if(a=""===this.parent.getValueFromArg(t[o])?0:a,0===o?n=a:r=a,0===n&&0===r)return"0";if(isNaN(a))return this.parent.getErrorStrings()[Br.value]}else{if(isNaN(a))return this.parent.getErrorStrings()[Br.name];0===o?n=a:r=a}}return r<n?this.parent.getErrorStrings()[Br.num]:0===n?Math.floor(Math.random()*(r-(n-1)))+n:r-n==1?Math.round(Math.random()*(r-n)+n):Math.floor(Math.random()*(r-(n-1)))+n}},{key:"ComputeSLOPE",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(2!==n.length||""===n[0])return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=this.parent.getCellCollection(n[1].split(this.parent.tic).join("")),a=this.parent.getCellCollection(n[0].split(this.parent.tic).join(""));if(a.length!==r.length)return this.parent.getErrorStrings()[Br.na];var s=this.getDataCollection(a),o=this.getDataCollection(r);if(o.indexOf("#NAME?")>-1||s.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[Br.name];for(var l=0,h=0,c=0,d=0,u=0,p=o.length;u<p;++u)"NaN"!==Number(o[u]).toString()&&"NaN"!==Number(s[u]).toString()&&(l+=Number(o[u])*Number(s[u]),c+=Number(o[u]),d+=Number(s[u]),h+=Number(o[u])*Number(o[u]));var g=((l-c*d/o.length)/(h-c*c/o.length)).toString();return"NaN"===g?this.parent.getErrorStrings()[Br.divzero]:g}},{key:"ComputeINTERCEPT",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(""===n[0]||2!==n.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=this.parent.getCellCollection(n[0].split(this.parent.tic).join("")),a=this.parent.getCellCollection(n[1].split(this.parent.tic).join(""));if(r.length!==a.length)return this.parent.getErrorStrings()[Br.na];var s=this.getDataCollection(a),o=this.getDataCollection(r);if(s.indexOf("#NAME?")>-1||o.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[Br.name];for(var l=0,h=0,c=0,d=s.length;c<d;++c)l+=Number(s[c]),h+=Number(o[c]);l/=s.length,h/=s.length;for(var u,p=0,g=0,f=0,m=s.length;f<m;++f)p+=(u=Number(s[f])-l)*(Number(o[f])-h),g+=u*u;var v=(h-p/g*l).toString();return"NaN"===v?this.parent.getErrorStrings()[Br.divzero]:v}},{key:"ComputeLN",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a=t,s="";if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(this.parent.isCellReference(a[0])){if(s=this.parent.getValueFromArg(a[0]),(n=this.parent.parseFloat(s))<=0||""===s)return this.parent.getErrorStrings()[Br.num];if(isNaN(n))return this.parent.getErrorStrings()[Br.value]}else{if(r=this.parent.getValueFromArg(a[0].split(this.parent.tic).join("")),(n=this.parent.parseFloat(r))<=0||""===n.toString())return this.parent.getErrorStrings()[Br.num];if(isNaN(n))return this.parent.getErrorStrings()[Br.value]}return Math.log(n)}},{key:"ComputeISNUMBER",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=t;if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];var r=this.parent.isCellReference(n[0])?this.parent.getValueFromArg(n[0]):this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""));if(""===r.toString())return!1;var a=this.parent.parseFloat(r);return!isNaN(a)}},{key:"ComputeROUND",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a,s,o,l=t,h=0,c=0;return 0===t.length||t.length>2?this.parent.formulaErrorStrings[Hr.wrong_number_arguments]:1===t.length?(n="TRUE"===l[0].split(this.parent.tic).join("")?"1":"FALSE"===l[0].split(this.parent.tic).join("")?"0":l[0],Math.round(this.parent.parseFloat(n)).toString()):(a=this.parent.getValueFromArg(l[0]),s=""===l[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(l[1].split(this.parent.tic).join("")),a="TRUE"===a.split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,s="TRUE"===s.split(this.parent.tic).join("")?"1":"FALSE"===s.split(this.parent.tic).join("")?"0":s,""!==a&&""!==s&&(h=this.parent.parseFloat(a),c=this.parent.parseFloat(s),!isNaN(c)&&!isNaN(h)&&c>0?r=h.toFixed(c):(o=Math.pow(10,-c),r=Math.round(h/o)*o)),r.toString())}},{key:"ComputePOWER",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a=t;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];n=this.parent.getValueFromArg(a[0]),r=this.parent.getValueFromArg(a[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r;var s=this.parent.parseFloat(n),o=this.parent.parseFloat(r);return isNaN(s)||isNaN(o)?this.parent.getErrorStrings()[Br.value]:0===s&&o<0?this.parent.getErrorStrings()[Br.divzero]:0===s&&0===o?this.parent.getErrorStrings()[Br.num]:Math.pow(s,o).toString()}},{key:"ComputeLOG",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a=t;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];if(n=this.parent.getValueFromArg(a[0]),r=2===t.length?this.parent.getValueFromArg(a[1]):"10",""===n||null===n||""===r||null===r)return this.parent.getErrorStrings()[Br.num];n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r;var s=this.parent.parseFloat(n),o=this.parent.parseFloat(r);return s<=0||o<=0?this.parent.getErrorStrings()[Br.num]:1===o?this.parent.getErrorStrings()[Br.divzero]:isNaN(s)||isNaN(o)?this.parent.getErrorStrings()[Br.value]:(Math.log(s)/Math.LN10/(Math.log(o)/Math.LN10)).toString()}},{key:"ComputeTRUNC",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t,a=0;if(0===t.length||t.length>2)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];2===t.length&&(a="TRUE"===(a=this.parent.getValueFromArg(r[1])).split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,a=this.parent.parseFloat(a)),n="TRUE"===(n=this.parent.getValueFromArg(r[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;var s=this.parent.parseFloat(n.split(this.parent.tic).join(""));if(isNaN(s)||isNaN(a))return r[0]===this.parent.tic||this.parent.isCellReference(r[0])||r[1]===this.parent.tic||this.parent.isCellReference(r[1])?this.parent.getErrorStrings()[Br.value]:this.parent.getErrorStrings()[Br.name];var o=Math.pow(10,a);return((s<0?-1:1)*Math.floor(o*Math.abs(s))/o).toString()}},{key:"ComputeEXP",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=t;if(0===t.length||t.length>1)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];""===(n="TRUE"===(n=this.parent.getValueFromArg(r[0])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n)&&(n="0");var a=this.parent.parseFloat(n);return a>709?this.parent.getErrorStrings()[Br.num]:isNaN(a)?r[0]===this.parent.tic||this.parent.isCellReference(r[0])?this.parent.getErrorStrings()[Br.value]:this.parent.getErrorStrings()[Br.name]:Math.exp(a).toString()}},{key:"ComputeGEOMEAN",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r,a,s,o=t,l=1,h=0,c=0;if(0===t.length)return this.parent.formulaErrorStrings[Hr.wrong_number_arguments];for(r=0;r<o.length;r++)if(o[r].indexOf(":")>-1){if(o[0]===this.parent.tic)return this.parent.getErrorStrings()[Br.value];for(s=this.parent.getCellCollection(o[r].split(this.parent.tic).join("")),a=0;a<s.length;a++){if(c="TRUE"===(c=this.parent.getValueFromArg(s[a])).split(this.parent.tic).join("")?"1":"FALSE"===c.split(this.parent.tic).join("")?"0":c,(n=this.parent.parseFloat(c))<=0)return this.parent.getErrorStrings()[Br.num];isNaN(n)||(h++,l*=n)}}else if((c=this.parent.getValueFromArg(o[r])).length>0){if(c="TRUE"===c.split(this.parent.tic).join("")?"1":"FALSE"===c.split(this.parent.tic).join("")?"0":c,!this.parent.isCellReference(o[r])&&isNaN(this.parent.parseFloat(c)))return this.parent.getErrorStrings()[Br.name];if((n=this.parent.parseFloat(c))<=0)return this.parent.getErrorStrings()[Br.num];isNaN(n)||(h++,l*=n)}return h>0&&(l=Math.pow(l,1/h)),l.toString()}},{key:"getDataCollection",value:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(this.parent.getValueFromArg(e[i]));return t}},{key:"parseDouble",value:function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t}},{key:"getModuleName",value:function(){return"basic-formulas"}}]),t}(),zr=function(){function e(t){a(this,e),this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=t}return o(e,[{key:"parse",value:function(e,t){if(this.parent.isTextEmpty(e))return e;this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===e[0]&&(e=e.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(e=this.checkForNamedRangeAndKeyValue(e),this.findNamedRange=!1),e=(e=(e=(e=e.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var i=this.storeStrings(e);e=this.storedStringText;var n=0;if(Object(f.Z)(i)&&(e=e.split(" ").join("")),(e=(e=e.split("=>").join(">=")).split("=<").join("<="))[e.length-1]===this.parent.arithMarker&&this.indexOfAny(e,this.tokens)===e.length-2||(e=e.toUpperCase()),e.indexOf(this.sheetToken)>-1){var r=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.size>0){e[0]!==this.sheetToken.toString()&&(e=this.parent.setTokensForSheets(e));var a=this.parent.getSheetToken(e.split(this.parent.tic).join(this.emptyStr)),s=this.checkScopedRange(e.split('"').join(this.emptyStr).split(this.sheetToken).join(""));Object(f.Z)(a)&&""!==a&&this.parent.namedRanges.size>0&&""!==s&&(e=s)}}e=this.markLibraryFormulas(e);try{e=this.formulaAutoCorrection(e)}catch(u){var o={message:u.message,exception:u,isForceCalculable:u.formulaCorrection,computeForceCalculate:!1};if(!o.isForceCalculable)throw this.parent.formulaErrorStrings[Hr.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",o),this.isFailureTriggered=!0),!o.isForceCalculable||!o.computeForceCalculate)throw this.parent.formulaErrorStrings[Hr.invalid_expression];e=this.formulaAutoCorrection(e,o),this.parent.storedData.get(t).formulaText="="+e}if(!this.ignoreBracet)for(n=e.indexOf(")");n>-1;){var l=e.substring(0,n).lastIndexOf("(");if(-1===l)throw new qr(this.parent.formulaErrorStrings[Hr.mismatched_parentheses]);if(l===n-1)throw new qr(this.parent.formulaErrorStrings[Hr.empty_expression]);var h=this.emptyStr;h=this.ignoreBracet?this.parent.substring(e,l,n-l+1):this.parent.substring(e,l+1,n-l-1);try{e=e.substring(0,l)+this.parseSimple(h)+e.substring(n+1)}catch(u){var c=this.exceptionArgs(u);this.isFailureTriggered||(this.parent.trigger("onFailure",c),this.isFailureTriggered=!0);var d="string"==typeof c.exception?c.exception:c.message;return(this.parent.getErrorLine(u)?"":"#"+this.parent.getErrorLine(u)+": ")+d}n=e.indexOf(")")}if(!this.ignoreBracet&&e.indexOf("(")>-1)throw new qr(this.parent.formulaErrorStrings[Hr.mismatched_parentheses]);return e=this.parseSimple(e),null!==i&&i.size>0&&(e=this.setStrings(e,i)),e}},{key:"exceptionArgs",value:function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}}},{key:"formulaAutoCorrection",value:function(e,t){var i=["*","+","-","/","^","&"],n=[">","=","<"],r=0,a="",s="",o="",l="",h="",c="",d="",u=0;if(this.parent.formulaErrorStrings.indexOf(e)>-1)return e;if(this.indexOfAny(e,this.specialSym)>-1)throw new qr(this.parent.formulaErrorStrings[Hr.invalid_expression],!1);for(;r<e.length;)if(e=e.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(e[r])&&e.length>r+1&&this.indexOfAny(e[r+1],i)>-1&&e.length>r+2&&!Object(f.Z)(e[r+2])&&this.indexOfAny(e[r+2],i)>-1&&("-"!==e[r+2]||"*"!==e[r+1]&&"/"!==e[r+1])){if(Object(f.Z)(t))throw new qr(this.parent.formulaErrorStrings[Hr.invalid_expression],!0);if(!t.computeForceCalculate)throw this.parent.formulaErrorStrings[Hr.improper_formula];this.parent.isDigit(e[r])?(u<1?(c=e[r],o=e[r+1],Object(f.Z)(o)&&(o=this.emptyStr),u+=1,a=a+c+(o="&"===o?"":o)):u<2&&(d=e[r],l=e[r-1],h=e[r+1],u=0,"-"===l?a=a+l+d+(h="&"===(h=Object(f.Z)(h)?this.emptyStr:h)?"":h):a=a+d+(h=Object(f.Z)(h)?this.emptyStr:h)),r+=2):(a="-"===e[r]?a+e[r]:a,r+=1)}else if((this.parent.isDigit(e[r])||e[r]===this.parent.rightBracket||this.parent.storedData.has(e[r].toUpperCase()))&&(Object(f.Z)(e[r+1])||this.indexOfAny(e[r+1],i))>-1)s="&"===(s=Object(f.Z)(e[r+1])?this.emptyStr:e[r+1])?"":s,a="-"===e[r-1]?a+e[r-1]+e[r]+s:a+e[r]+s,r+=2;else if(this.indexOfAny(e[r],n)>-1&&!Object(f.Z)(e[r-1])&&!Object(f.Z)(e[r+1]))a+=e[r],r+=1;else if("q"===e[r])for(;e[r]!==this.parent.leftBracket;)a+=e[r],r+=1;else e[r]===this.parent.leftBracket||e[r]===this.parent.rightBracket||"{"===e[r]||"}"===e[r]||"("===e[r]||")"===e[r]||this.parent.isUpperChar(e[r])||e[r].indexOf(":")>-1||e[r]===this.parent.getParseArgumentSeparator()||"%"===e[r]&&this.parent.isDigit(e[r-1])||e[r]===this.parent.tic||" "===e[r]||"."===e[r]||e[r]===this.sheetToken||"$"===e[r]?(a+=e[r],r+=1):(this.parent.isDigit(e[r])&&(a="-"===e[r-1]?a+e[r-1]+e[r]:a+e[r]),"-"!==e[r]&&"+"!==e[r]||(a=(a+=e[r]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==e[r]&&"*"!==e[r]||(a+=e[r]),r+=1);return a=a===this.emptyStr?e:a,this.indexOfAny(a[a.length-1],i)>-1&&(a=a.substring(0,a.length-1)),a=a.split("--").join("-").split("-+").join("-").split("+-").join("-")}},{key:"checkScopedRange",value:function(e){var t=this,i=this.emptyStr,n="NaN",r=this.parent.getSheetID(this.parent.grid),a=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var s=e.indexOf(this.sheetToken,1),o=parseInt(e.substr(1,s-1),10);s>1&&!this.parent.isNaN(o)&&(e=e.substring(s+1),r=o)}var l="!"+r.toString()+"!";return null===a||null==a.sheetNameToToken||a.sheetNameToToken.forEach(function(r,s){if(a.sheetNameToToken.get(s).toString()===l){var o=t.emptyStr;t.parent.namedRanges.forEach(function(r,s){o=Object(f.Z)(t.parent.parentObject)?a.sheetNameToToken.get(s).toUpperCase():(t.parent.parentObject.getActiveSheet().name+t.sheetToken+e).toUpperCase(),t.parent.getNamedRanges().has(o)&&(i=t.parent.getNamedRanges().get(o).toUpperCase(),n=i)})}}),n}},{key:"storeStrings",value:function(e){var t,i=0,n=0,r=0,a="",s=null;if(e.indexOf(this.parent.tic)>-1)for(i=e.indexOf(this.parent.tic);i>-1&&e.length>0;){if(null===s&&(s=this.stringsColl),-1===(n=i+1<e.length?e.indexOf(this.parent.tic,i+1):-1))throw new qr(this.parent.formulaErrorStrings[Hr.mismatched_tics]);t=this.parent.substring(e,i,n-i+1),a=this.parent.tic+this.spaceString+r.toString()+this.parent.tic,s=s.set(a,t),e=e.substring(0,i)+a+e.substring(n+1),(i+=a.length)<=e.length&&(i=e.indexOf(this.parent.tic,i)),r++}return this.storedStringText=e,s}},{key:"setStrings",value:function(e,t){for(var i=0;i<t.size;i++)t.forEach(function(t,i){e=e.split(i).join(t)});return e}},{key:"parseSimple",value:function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var i=[this.tokenMultiply,this.tokenDivide],n=[this.tokenAdd,this.tokenSubtract],r=[this.charMultiply,this.charDivide],a=[this.charAdd,this.charSubtract],s=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],o=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],l=[this.tokenAnd],h=[this.charAnd],c=[this.charOr],d=[this.tokenOr];return t=this.parseSimpleOperators(t,[this.tokenEp,this.tokenEm],[this.charEp,this.charEm]),t=this.parseSimpleOperators(t,d,c),t=this.parseSimpleOperators(t,i,r),t=this.parseSimpleOperators(t,n,a),t=this.parseSimpleOperators(t,s,o),t=this.parseSimpleOperators(t,l,h)}},{key:"parseSimpleOperators",value:function(e,t,i){if(this.parent.getErrorStrings().indexOf(e)>-1)return e;for(var n=e,r=0,a="",s=0;s<i.length;s++)a+=i[s];(n=(n=n.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===n[0]?(n="0-"+(n=n.substring(1).split("-").join(this.tokenOr)),n=(n=this.parseSimpleOperators(n,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):n.length>0&&"+"===n[0]?n=n.substring(1):n.length>0&&"+"===n[n.length-1]&&(n=n.substring(0,n.length-1));try{if(this.indexOfAny(n,i)>-1)for(r=this.indexOfAny(n,i);r>-1;){var o="",l="",h=0,c=0,d=0;if(n[r]===this.charNOTop)h=r;else if(n[d=r-1]===this.parent.arithMarker){var u=this.findLeftMarker(n.substring(0,d-1));if(u<0)throw new qr(this.parent.formulaErrorStrings[Hr.cannot_parse]);o=this.parent.substring(n,u+1,d-u-1),h=u+1}else if(n[d]===this.parent.rightBracket){for(var p=0,g=d-1;g>0&&("q"!==n[g]||0!==p);)"q"===n[g]?p--:n[g]===this.parent.rightBracket&&p++,g--;if(g<0)throw new qr(this.parent.formulaErrorStrings[Hr.cannot_parse]);o=this.parent.substring(n,g,d-g+1),h=g}else if(n[d]===this.parent.tic[0]){var f=n.substring(0,d-1).lastIndexOf(this.parent.tic);if(f<0)throw new qr(this.parent.formulaErrorStrings[Hr.cannot_parse]);o=this.parent.substring(n,f,d-f+1),h=f}else{for(var m=!1;d>-1&&(this.parent.isDigit(n[d])||!m&&n[d]===this.parent.getParseDecimalSeparator());)n[d]===this.parent.getParseDecimalSeparator()&&(m=!0),d-=1;if(d>-1&&m&&n[d]===this.parent.getParseDecimalSeparator())throw new qr(this.parent.formulaErrorStrings[Hr.number_contains_2_decimal_points]);if(0===(d+=1)||d>0&&!this.parent.isUpperChar(n[d-1]))o="n"+this.parent.substring(n,d,r-d),h=d;else{for(d-=1;d>-1&&(this.parent.isUpperChar(n[d])||this.parent.isDigit(n[d]));)d-=1;if(d>-1&&n[d]===this.sheetToken){for(d-=1;d>-1&&n[d]!==this.sheetToken;)d-=1;d>-1&&n[d]===this.sheetToken&&(d-=1)}if(d>-1&&":"===n[d]){for(d-=1;d>-1&&this.parent.isDigit(n[d]);)d-=1;for(;d>-1&&this.parent.isUpperChar(n[d]);)d-=1;if(d>-1&&n[d]===this.sheetToken){for(d--;d>-1&&n[d]!==this.sheetToken;)d--;d>-1&&n[d]===this.sheetToken&&d--}d+=1,o=this.parent.substring(n,d,r-d),o=this.parent.getCellFrom(o)}else d+=1,o=this.parent.substring(n,d,r-d);this.parent.updateDependentCell(o),h=d}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(o.toUpperCase())||this.parent.storedData.has(o.toUpperCase()))&&(o="n"+this.checkForNamedRangeAndKeyValue(o))}if(r===n.length-1)throw new qr(this.parent.formulaErrorStrings[Hr.expression_cannot_end_with_an_operator]);var v="u"===n[d=r+1];if(v&&(d+=1),n[d]===this.parent.tic[0]){var y=n.substring(d+1).indexOf(this.parent.tic);if(y<0)throw this.parent.formulaErrorStrings[Hr.cannot_parse];l=this.parent.substring(n,d,y+2),c=y+d+2}else if(n[d]===this.parent.arithMarker){var b=this.findRightMarker(n.substring(d+1));if(b<0)throw new qr(this.parent.formulaErrorStrings[Hr.cannot_parse]);l=this.parent.substring(n,d+1,b),c=b+d+2}else if("q"===n[d]){for(var C=0,x=d+1;x<n.length&&(n[x]!==this.parent.rightBracket||0!==C);)n[x]===this.parent.rightBracket?C++:"q"===n[x]&&C--,x++;if(x===n.length)throw this.parent.formulaErrorStrings[Hr.cannot_parse];l=this.parent.substring(n,d,x-d+1),v&&(l="u"+l),c=x+1}else if(this.parent.isDigit(n[d])||n[d]===this.parent.getParseDecimalSeparator()){var S=n[d]===this.parent.getParseDecimalSeparator();for(d+=1;d<n.length&&(this.parent.isDigit(n[d])||!S&&n[d]===this.parent.getParseDecimalSeparator());)n[d]===this.parent.getParseDecimalSeparator()&&(S=!0),d+=1;if(d<n.length&&"%"===n[d]&&(d+=1),S&&d<n.length&&n[d]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[Hr.number_contains_2_decimal_points];l="n"+this.parent.substring(n,r+1,d-r-1),c=d}else if(this.parent.isUpperChar(n[d])||n[d]===this.sheetToken||"u"===n[d]){if(n[d]===this.sheetToken)for(d+=1;d<n.length&&n[d]!==this.sheetToken;)d+=1;d+=1;for(var w=0,k=!1;d<n.length&&(this.parent.isUpperChar(n[d])||"_"===n[d]||"."===n[d]||"["===n[d]||"]"===n[d]||"#"===n[d]||" "===n[d]||"%"===n[d]||n[d]===this.parent.getParseDecimalSeparator()&&k);)d!==n.length-1&&"["===n[d]&&"["===n[d+1]&&(k=!0),d!==n.length-1&&"]"===n[d]&&"]"===n[d+1]&&(k=!1),d++,w++;var I=d===n.length||!this.parent.isDigit(n[d]);if(w>1){for(;d<n.length&&(this.parent.isUpperChar(n[d])||this.parent.isDigit(n[d])||" "===n[d]||"_"===n[d]);)d++;I=!0}for(;d<n.length&&this.parent.isDigit(n[d]);)d+=1;if(d<n.length&&":"===n[d]){if((d+=1)<n.length&&n[d]===this.sheetToken){for(d++;d<n.length&&n[d]!==this.sheetToken;)d+=1;d<n.length&&n[d]===this.sheetToken&&d++}for(;d<n.length&&this.parent.isUpperChar(n[d]);)d+=1;for(;d<n.length&&this.parent.isDigit(n[d]);)d+=1;d-=1,l=this.parent.substring(n,r+1,d-r),l=this.parent.getCellFrom(l)}else d-=1,l=this.parent.substring(n,r+1,d-r),(v="u"===n[d])&&(l="u"+l);I&&l.startsWith(this.sheetToken)&&(I=!this.parent.isCellReference(l)),I||this.parent.updateDependentCell(l),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(l.toUpperCase())||this.parent.storedData.has(l.toUpperCase()))&&(l="n"+this.checkForNamedRangeAndKeyValue(l)),c=d+1}var O=a.indexOf(n[r]),R=this.parent.arithMarker+o+l+t[O]+this.parent.arithMarker;h>0&&(R=n.substring(0,h)+R),c<n.length&&(R+=n.substring(c)),n=R=R.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),r=this.indexOfAny(n,i)}else if(n.length>0&&(this.parent.isUpperChar(n[0])||n[0]===this.sheetToken)){for(var A=!0,E=!0,L=!1,T=n.length,j=0;j<T;++j)if(n[j]===this.sheetToken){if(j>0&&!L)throw this.parent.getErrorStrings()[Br.ref];for(L=!0,j++;j<T&&this.parent.isDigit(n[j]);)j++;if(j===T||n[j]!==this.sheetToken){A=!1;break}}else{if(!E&&this.parent.isChar(n[j])){A=!1;break}if(!this.parent.isChar(n[j])&&!this.parent.isDigit(n[j])&&n[j]!==this.sheetToken){A=!1;break}E=this.parent.isUpperChar(n[j])}A&&this.parent.updateDependentCell(n)}return n}catch(D){return D}}},{key:"indexOfAny",value:function(e,t){for(var i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return i;return-1}},{key:"findLeftMarker",value:function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var i=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)i--;else if(e[n]===this.parent.leftBracket)i++;else if(e[n]===this.parent.arithMarker&&0===i){t=n;break}return t}},{key:"findRightMarker",value:function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var i=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)i--;else if(e[n]===this.parent.leftBracket)i++;else if(e[n]===this.parent.arithMarker&&0===i){t=n;break}return t}},{key:"parseFormula",value:function(e,t){if(e.length>0&&e[0]===this.parent.getFormulaCharacter()&&(e=e.substring(1)),e.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[Br.ref];e.length>0&&"+"===e[0]&&(e=e.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,e=this.parse(e.trim(),t),this.isFormulaParsed=!0}catch(r){var i=this.exceptionArgs(r);this.isFailureTriggered||(this.parent.trigger("onFailure",i),this.isFailureTriggered=!0);var n="string"==typeof i.exception?i.exception:i.message;e=(Object(f.Z)(this.parent.getErrorLine(r))?"":"#"+this.parent.getErrorLine(r)+": ")+n,this.isError=!0}return e}},{key:"markLibraryFormulas",value:function(e){var t=0,i=e.indexOf(")");if(-1===i)e=this.markNamedRanges(e);else for(;i>-1;){for(var n=0,r=i-1;r>-1&&("("!==e[r]||0!==n);)")"===e[r]&&n++,r--;if(-1===r)throw new qr(this.parent.formulaErrorStrings[Hr.mismatched_parentheses]);for(var a=r-1;a>-1&&this.parent.isChar(e[a]);)a--;var s=r-a-1,o=this.parent.substring(e,a+1,s);if(s>0&&!Object(f.Z)(this.parent.getFunction(o))){this.ignoreBracet="AREAS"===this.parent.substring(e,a+1,s);var l=this.parent.substring(e,r,i-r+1);try{l=l.split("(").join("").split(")").join(""),l="("+this.formulaAutoCorrection(l,void 0)+")"}catch(d){var h={message:d.message,exception:d,isForceCalculable:d.formulaCorrection,computeForceCalculate:!1};if(!h.isForceCalculable)throw this.parent.formulaErrorStrings[Hr.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",h),this.isFailureTriggered=!0,t+=1),h.computeForceCalculate=t>0||h.computeForceCalculate,!h.isForceCalculable)throw this.parent.formulaErrorStrings[Hr.improper_formula];if(!h.computeForceCalculate)throw this.parent.formulaErrorStrings[Hr.improper_formula];l=l.split("(").join("").split(")").join(""),l="("+this.formulaAutoCorrection(l,h)+")"}l=this.markNamedRanges(l),l=this.swapInnerParens(l),-1===(l=this.addParensToArgs(l)).lastIndexOf(this.parent.getParseArgumentSeparator())&&l.length>2&&"("===l[0]&&")"===l[l.length-1]&&"{"!==l[1]&&"("!==l[1]&&(l=(l=l.substring(0,l.length-1)+"}"+l.substring(l.length-1))[0]+"{"+l.substring(1)),e=e.substring(0,a+1)+"q"+this.parent.substring(e,a+1,s)+l.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+e.substring(i+1)}else{if(s>0)return this.parent.getErrorStrings()[Br.name];var c=this.emptyStr;r>0&&(c=e.substring(0,r)),c=c+"{"+this.parent.substring(e,r+1,i-r-1)+"}",i<e.length&&(c+=e.substring(i+1)),e=c=this.markNamedRanges(c)}i=e.indexOf(")")}return e.split("{").join("(").split("}").join(")")}},{key:"swapInnerParens",value:function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e}},{key:"addParensToArgs",value:function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var i=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===i)e.length>2&&"("===e[0]&&")"===e[e.length-1]&&("{"!==e[1]&&"("!==e[1]?e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1):(i=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[i+1]&&"}"===e[i-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,i+1)+"{"+e.substr(i+1))));else for(var r=!0;i>-1;){var a=this.indexOfAny(e.substring(i+1,e.length),t);a>=0?a=i+a+1:-1===a&&")"===e[e.length-1]&&(a=e.length-1),a>0&&"{"!==e[i+1]&&"}"!==e[a-1]&&(e=(e=e.substr(0,a)+"}"+e.substr(a)).substr(0,i+1)+"{"+e.substr(i+1)),i=e.substr(0,i).lastIndexOf(this.parent.getParseArgumentSeparator()),r&&-1===i&&"("===e[0]&&(i=0,r=!1)}return e.split("{}").join(this.emptyStr)}},{key:"lastIndexOfAny",value:function(e,t){for(var i=e.length-1;i>-1;i--)if(t.indexOf(e[i])>-1)return i;return-1}},{key:"markNamedRanges",value:function(e){var t=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],i=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var n=this.indexOfAny(e.substring(i),t);n>-1&&n+i<e.length;){var r=this.emptyStr,a=null;if(this.parent.substring(e,i,n).indexOf("[")>-1?a=this.getTableRange(this.parent.substring(e,i,n)):(this.parent.storedData.has(this.parent.substring(e,i,n))||this.parent.namedRanges.has(this.parent.substring(e,i,n)))&&(a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,i,n))),Object(f.Z)(a)&&("NaN"!==(r=this.checkScopedRange(this.parent.substring(e,i,n)))?(this.findNamedRange=!0,a=r):this.parent.substring(e,i,n).startsWith(this.sheetToken.toString()),!Object(f.Z)(a)&&this.findNamedRange&&a.indexOf(this.fixedReference)>-1&&(a=a.split(this.fixedReference).join(this.emptyStr))),Object(f.Z)(a)||(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a)),Object(f.Z)(a)||a===this.emptyStr)for(i+=n+1;i<e.length&&!this.parent.isUpperChar(e[i])&&e[i]!==this.sheetToken;)i++;else e=e.substring(0,i)+a+e.substring(i+n),i+=a.length+1;for(n=i,i<e.length-1&&"{"===e[i]&&(i+=1),n=this.indexOfAny(e.substring(i),t);0===n&&i<e.length-1;)i++,n=this.indexOfAny(e.substring(i),t);if((-1===n||e.substring(i).indexOf("[")>-1)&&i<e.length){if(a=e.substring(i).indexOf("[")>-1?this.getTableRange(e.substring(i)):this.parent.storedData.has(e.substring(i))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(i)):a:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(i)):a,Object(f.Z)(a)&&("NaN"!==(r=this.checkScopedRange(e.substring(i)))&&(a=r)),!Object(f.Z)(a)&&a!==this.emptyStr&&(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),null!=(a=this.markLibraryFormulas(a)))){var s=e.substring(i);e=")"===s[s.length-1]?e.substring(0,i)+a+")":e.substring(0,i)+a,i+=a.toString().length+1}n=i<e.length?this.indexOfAny(e.substring(i),t):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e}},{key:"checkForNamedRangeAndKeyValue",value:function(e){var t=this.emptyStr;if(e.indexOf("[")>-1){var i=this.getTableRange(e);Object(f.Z)(i)||(this.findNamedRange=!0,e=i)}if("NaN"!==(t=this.checkScopedRange(e)))this.findNamedRange=!0,e=t;else{if(e.indexOf(this.sheetToken)>-1){var n=this.parent.getSheetFamilyItem(this.parent.grid),r=e.split('"').join(this.emptyStr);r=r.substr(0,r.indexOf(this.sheetToken)),n.sheetNameToToken.has(r.toUpperCase())&&parseInt(n.sheetNameToToken.get(r.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(Object(f.Z)(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e}},{key:"getTableRange",value:function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);return t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_")),t.toUpperCase()}},{key:"findNextEndIndex",value:function(e,t){for(var i=0,n=t,r=!1;!r&&t<e.length;)"["===e[n]?i++:"]"===e[n]&&(0===--i&&(r=!0)),t++;return t-n}}]),e}(),Vr=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ur=(Pr=Fr=function(t){l(n,t);var i=c(n);function n(e){var t;a(this,n),(t=i.call(this,null,null)).lFormulas=new Map,t.storedData=new Map,t.keyToRowsMap=new Map,t.rowsToKeyMap=new Map,t.rightBracket=String.fromCharCode(161),t.leftBracket=String.fromCharCode(162),t.sheetToken="!",t.emptyString="",t.leftBrace="{",t.rightBrace="}",t.cell=t.emptyString,t.cellPrefix="!0!A",t.treatEmptyStringAsZero=!1,t.tic='"',t.singleTic="'",t.trueValue="TRUE",t.falseValue="FALSE",t.parseDecimalSeparator=".",t.arithMarker=String.fromCharCode(180),t.arithMarker2=t.arithMarker+t.arithMarker,t.dependentCells=null,t.dependentFormulaCells=null,t.minValue=Number.MIN_SAFE_INTEGER,t.maxValue=Number.MAX_SAFE_INTEGER,t.categoryCollection=["All"],t.dependencyLevel=0,t.refreshedCells=new Map,t.computedValues=null,t.randomValues=new Map,t.isRandomVal=!1,t.randCollection=[],t.dependencyCollection=[],t.uniqueRange=[],t.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!"],t.errorStrings=null,t.parseArgumentSeparator=",",t.dateTime1900=new Date(1900,0,1,0,0,0),t.isParseDecimalSeparatorChanged=!1,t.isArgumentSeparatorChanged=!1,t.sheetFamilyID=0,t.defaultFamilyItem=null,t.sheetFamiliesList=null,t.modelToSheetID=null,t.tokenCount=0,t.sortedSheetNames=null,t.tempSheetPlaceHolder=String.fromCharCode(133),t.namedRanges=new Map,t.formulaInfoTable=null,t.oaDate=new Date(1899,11,30),t.millisecondsOfaDay=864e5,t.parseDateTimeSeparator="/";var r=new Nr(u(t));return t.includeBasicFormulas&&Fr.Inject(_r),t.injectedModules&&t.injectedModules.length&&r.inject(t.requiredModules(),t.injectedModules),t.parentObject=Object(f.Z)(e)?u(t):e,t.grid=t.parentObject,t.parser=new zr(u(t)),t}return o(n,[{key:"libraryFormulas",get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})}},{key:"getParseArgumentSeparator",value:function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator}},{key:"setParseArgumentSeparator",value:function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0}},{key:"getParseDateTimeSeparator",value:function(){return this.parseDateTimeSeparator}},{key:"setTreatEmptyStringAsZero",value:function(e){this.treatEmptyStringAsZero=e}},{key:"getTreatEmptyStringAsZero",value:function(){return this.treatEmptyStringAsZero}},{key:"setParseDateTimeSeparator",value:function(e){this.parseDateTimeSeparator=e}},{key:"requiredModules",value:function(){return t=[],(e=this).includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t;var e,t}},{key:"getInjectedModules",value:function(){return this.injectedModules}},{key:"onPropertyChanged",value:function(e,t){}},{key:"getModuleName",value:function(){return"calculate"}},{key:"getFormulaCharacter",value:function(){return"="}},{key:"isUpperChar",value:function(e){var t=e.charCodeAt(0);return t>64&&t<91}},{key:"resetKeys",value:function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()}},{key:"updateDependentCell",value:function(e){var t=this.getSheetFamilyItem(this.grid),i=this.cell;if(i!==this.emptyString){if(null!==t.sheetNameToParentObject){var n=t.parentObjectToToken.get(this.grid);-1===i.indexOf(this.sheetToken)&&(i=n+i),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){var r=this.getDependentCells().get(e);r.indexOf(i)<0&&r.push(i)}else this.getDependentCells().set(e,[i]);this.addToFormulaDependentCells(e)}}},{key:"addToFormulaDependentCells",value:function(e){var t=this.cell,i=this.getSheetFamilyItem(this.grid);null!=i.sheetNameToParentObject&&-1===t.indexOf(this.sheetToken)&&(t=i.parentObjectToToken.get(this.grid)+t),this.getDependentFormulaCells().has(t)?this.getDependentFormulaCells().get(t).has(e)||this.getDependentFormulaCells().get(t).set(e,e):(this.getDependentFormulaCells().set(t,new Map),this.getDependentFormulaCells().get(t).set(e,e))}},{key:"getDependentCells",value:function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new Map),e.sheetDependentCells}return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells}},{key:"getDependentFormulaCells",value:function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells}},{key:"getLibraryFormulas",value:function(){return this.lFormulas}},{key:"getFunction",value:function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null}},{key:"intToDate",value:function(e){var t=Number(e);return(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1),new Date(864e5*(t-1)+new Date("01/01/1900").getTime())}},{key:"getFormulaInfoTable",value:function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable}},{key:"getFormula",value:function(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""}},{key:"getParseDecimalSeparator",value:function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator}},{key:"setParseDecimalSeparator",value:function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0}},{key:"getSheetToken",value:function(e){var t=0,i=this.emptyString;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;i=e.substring(0,t+1)}if(t<e.length)return i;throw this.formulaErrorStrings[Hr.bad_index]}},{key:"getSheetID",value:function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var i=t.parentObjectToToken.get(e);if(i){i=i.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(i);if(!this.isNaN(n))return n}}return-1}},{key:"parseFloat",value:function(e){return Number(e)}},{key:"rowIndex",value:function(e){var t=0,i=!1;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)i=!0,t++;var n=parseInt(e.substring(t),10);if(t<e.length&&!this.isNaN(n))return n;if(i)return-1;throw this.formulaErrorStrings[Hr.bad_index]}},{key:"colIndex",value:function(e){var t=0,i=0;if(t<(e=e.toUpperCase()).length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)i=26*i+e[t].charCodeAt(0)-64,t++;return 0===i?-1:i}},{key:"getErrorStrings",value:function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings}},{key:"substring",value:function(e,t,i){return e.substring(t,i+t)}},{key:"isChar",value:function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}},{key:"getSheetFamilyItem",value:function(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new Zr),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new Zr),this.sheetFamiliesList.get(t)}},{key:"setKeyValue",value:function(e,t){e=e.toUpperCase();var i=t.toString().trim();this.storedData.get(e)&&0!==i.indexOf(this.leftBrace)||(this.storedData.set(e,new Wr),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==i){var r=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(r)&&this.clearFormulaDependentCells(r)}i.length>0&&i[0]===this.getFormulaCharacter()?n.setFormulaText(i):n.getFormulaValue()!==i&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(i))}},{key:"clearFormulaDependentCells",value:function(e){var t=this,i=this.getDependentFormulaCells().get(e);null!=i&&(i.forEach(function(i,n){var r=n,a=t.getDependentCells().get(r);t.arrayRemove(a,e),0===a.length&&t.getDependentCells().delete(r)}),this.getDependentFormulaCells().delete(e))}},{key:"arrayRemove",value:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e}},{key:"getKeyValue",value:function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var t=this.storedData.get(e),i=t.getFormulaText();if(i.length>0&&i[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),i=i.substring(1);try{t.setParsedFormula(this.parser.parseFormula(i,e))}catch(s){var n={message:s.message,exception:s,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",n),t.setFormulaValue(n.message),this.storedData.get(e).getFormulaValue()}try{t.setFormulaValue(this.computeFormula(t.getParsedFormula()))}catch(s){var r={message:s.message,exception:s,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",r);var a="string"==typeof r.exception?r.exception:r.message;return(Object(f.Z)(this.getErrorLine(s))?"":"#"+this.getErrorLine(s)+": ")+a}}return this.storedData.get(e).getFormulaValue()}return this.emptyString}},{key:"getNamedRanges",value:function(){return this.namedRanges}},{key:"addNamedRange",value:function(e,t){var i=e.split(this.sheetToken);if(i.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(i[0]))return!1;e=i[0]+this.sheetToken+i[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0}},{key:"removeNamedRange",value:function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)}},{key:"convertAlpha",value:function(e){for(var t=[],i=0;e>0;){e--;var n="A".charCodeAt(0);t[i]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),i++}for(var r=[],a=0;a<i;a++)r[i-a-1]=t[a];return r.join("")}},{key:"getCellCollection",value:function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,i=e.indexOf(this.sheetToken);if(i>-1)for(var n=i+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var r,a,s,o,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var h=l-2;h>=0&&this.isDigit(e[h]);)h--;r=this.rowIndex(this.substring(e,0,l)),a=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),s=this.colIndex(this.substring(e,0,l)),o=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),r>a&&(l=a,a=r,r=l),s>o&&(l=o,o=s,s=l);var c,d=[],u=0;for(l=r;l<=a;l++)for(c=s;c<=o;c++)d[u]=t+this.emptyString+this.convertAlpha(c)+l.toString(),u++;return d}},{key:"computeFormula",value:function(e){return this.calculateFormula(e,!1)}},{key:"calculateFormula",value:function(t,i){var n,r,a,s,o=!1;if(this.parser.isError)return t;n=this.parser.isFormulaParsed?t:this.parser.parseFormula(t),this.parser.isFormulaParsed=!1;try{if((r=this.findLastIndexOfq(n))>0&&(o=!0),n!==this.emptyString&&r>-1)for(var l=r+1;l>-1;)if(n[l]===this.rightBracket){var h=n.substring(r,l+1),c=h.split(this.leftBracket)[0].split("q").join(this.emptyString),d=void 0;if(this.getLibraryFormulas().get(c.toUpperCase()).isCustom){d=h.substring(h.indexOf(this.leftBracket)+1,h.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());var u=0,p=[];for(u=0;u<d.length;u++)p.push(this.getValueFromArg(d[u]));d=p}else{if(d=h.substring(h.indexOf(this.leftBracket)+1,h.indexOf(this.rightBracket)).replace(",n",",").split(this.getParseArgumentSeparator()),h.includes(this.getParseArgumentSeparator()+this.tic))for(var g=null,m=0;m<d.length;m++)d[m]&&d[m][0]===this.tic&&d[m][d[m].length-1]!==this.tic&&(g=m),null!==g&&g===m-1&&d[m][0]!=this.tic&&d[m][d[m].length-1]===this.tic&&(d[g]=d[g]+this.getParseArgumentSeparator()+d[m],d.splice(m,1),g=null);o&&c&&"IF"===c&&d.push("nestedFormulaTrue")}if(a=Object(f.Z)(this.getFunction(c))?this.getErrorStrings()[Br.name]:this.getFunction(c).apply(void 0,e(d)),!o)break;s=this.processNestedFormula(n,h,a);var v=this.findLastIndexOfq(s);0===v&&(o=!1),-1===v&&(a=this.computeValue(s,i)),r=l=v,n=s}else l++;else this.formulaErrorStrings.indexOf(n)>-1?a=n:n!==this.emptyString&&-1===r&&(a=this.computeValue(n,i))}catch(C){var y={message:C.message,exception:C,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",y);var b="string"==typeof y.exception?y.exception:y.message;a=(Object(f.Z)(this.getErrorLine(C))?"":"#"+this.getErrorLine(C)+": ")+b}return a}},{key:"computeSumIfAndAvgIf",value:function(e){if(Object(f.Z)(e)||e[0]===this.emptyString||0===e.length)return this.formulaErrorStrings[Hr.wrong_number_arguments];for(var t=e,i=0;i<t.length;i++)if(this.isCellReference(t[i])&&Object(f.Z)(t[i].match(/[0-9]/))&&t[i].indexOf("!")<0){var n=t[i].split(":");t[i]=n[0]+"1:"+n[1]+this.spreadSheetUsedRange[0]}var r=t.length;if(2!==r&&3!==r&&0===r)return this.formulaErrorStrings[Hr.wrong_number_arguments];var a=t[0],s=t[1].trim();if((s=s.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[Br.value];var o=s.includes("*"),l=o?s.replace(/\*/g,"").trim():s;l=this.isCellReference(l)?this.getValueFromArg(l):s,o&&("*"===s[0]&&(l="*"+l),"*"===s[s.length-1]&&(l+="*")),s=l;var h=this.parser.tokenEqual;s.startsWith("<=")?(h=this.parser.tokenLessEq,s=s.substring(2)):s.startsWith(">=")?(h=this.parser.tokenGreaterEq,s=s.substring(2)):s.startsWith("<>")?(h=this.parser.tokenNotEqual,s=s.substring(2)):s.startsWith("<")?(h=this.parser.tokenLess,s=s.substring(1)):s.startsWith(">")?(h=this.parser.tokenGreater,s=s.substring(1)):s.startsWith("=")&&(h=this.parser.tokenEqual,s=s.substring(1));var c=this.parseFloat(s),d=t[0],u=this.getCellCollection(r>2?t[2]:a),p=this.getCellCollection(d),g=this.getComputeSumIfValue(p,u,s,c,h,o);return[g[0],g[1]]}},{key:"findWildCardValue",value:function(e,t){var i="";if(e.indexOf("?")>-1){var n=e.indexOf("?"),r=e[n-1],a=e[n+1];if(t.indexOf(r)>-1&&t.indexOf(a)>-1){var s=t.indexOf(r);i=t[s]===r&&t[s+2]===a?e:t}else i=t}else if(e.indexOf("*")>-1){for(var o=e.indexOf("*"),l="",h="",c=this.falseValue,d=this.falseValue,u=o-1;u>=0;u--)l+=e[u],d=this.trueValue;for(var p=o+1;p<e.length;p++)h+=e[p],c=this.trueValue;var g=""===l?-1:t.indexOf(l.split("").reverse().join("")),f=""===h?-1:t.indexOf(h);g>-1||f>-1?d===this.trueValue?i=l.split("").reverse().join("")===t.substr(0,l.length)?e:t:c===this.trueValue&&(i=h===t.substring(t.length-h.length,t.length)?e:t):i=t}return i}},{key:"getComputeSumIfValue",value:function(e,t,i,n,r,a){var s=0,o=0;switch(r){case this.parser.tokenEqual:for(var l=a?i.replace(/\*/g,""):i,h=0;h<e.length;h++){var c=this.getValueFromArg(e[h].split(this.tic).join("")),d=this.parseFloat(c);if(c===i&&d===n){var u=this.getValueFromArg(t[h].split(this.tic).join(""));s+=this.parseFloat(u),o+=1}else c===i?(s+=this.getValueFromRange(t,h),o+=1):a&&l&&c&&("*"===i[0]&&l.length<=c.length&&l===c.slice(0,l.length)&&(s+=this.getValueFromRange(t,h),o+=1),"*"===i[i.length-1]&&l.length<=c.length&&l===c.slice(c.length-l.length,c.length)&&(s+=this.getValueFromRange(t,h),o+=1))}break;case this.parser.tokenLess:for(var p=0;p<e.length;p++){var g=this.getValueFromArg(e[p].split(this.tic).join(""));if(this.parseFloat(g)<n){var f=this.getValueFromArg(t[p].split(this.tic).join(""));s+=this.parseFloat(f),o+=1}}break;case this.parser.tokenGreater:for(var m=0;m<e.length;m++){var v=this.getValueFromArg(e[m].split(this.tic).join(""));if(this.parseFloat(v)>n){var y=this.getValueFromArg(t[m].split(this.tic).join(""));s+=this.parseFloat(y),o+=1}}break;case this.parser.tokenLessEq:for(var b=0;b<e.length;b++){var C=this.getValueFromArg(e[b].split(this.tic).join(""));if(this.parseFloat(C)<=n){var x=this.getValueFromArg(t[b].split(this.tic).join(""));s+=this.parseFloat(x),o+=1}}break;case this.parser.tokenGreaterEq:for(var S=0;S<e.length;S++){var w=this.getValueFromArg(e[S].split(this.tic).join(""));if(this.parseFloat(w)>=n){var k=this.getValueFromArg(t[S].split(this.tic).join(""));s+=this.parseFloat(k),o+=1}}break;case this.parser.tokenNotEqual:for(var I=0;I<e.length;I++){var O=this.getValueFromArg(e[I].split(this.tic).join("")),R=this.parseFloat(O);if(O!==i&&R!==n){var A=this.getValueFromArg(t[I].split(this.tic).join(""));s+=this.parseFloat(A),o+=1}}}return[s,o]}},{key:"getValueFromRange",value:function(e,t){var i=e[t];return i=this.getValueFromArg(i),this.parseFloat(i.toString())}},{key:"computeAndOr",value:function(e,t){var i,n,r="and"===t;if(0===e.length)return this.formulaErrorStrings[Hr.wrong_number_arguments];for(var a=0,s=e.length;a<s;a++)if(e[a].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[Br.value];for(var o=e,l=0;l<o.length;l++){if(o[l]===this.tic)return this.getErrorStrings()[Br.value];if(o[l].indexOf(":")>-1&&this.isCellReference(o[l]))for(var h=this.getCellCollection(o[l]),c=0;c<h.length;c++){if(this.getErrorStrings().indexOf(h[c])>-1)return h[c];if(h[c][0]===this.tic)return this.getErrorStrings()[Br.name];if(""===(i=this.getValueFromArg(h[c]))&&(i=this.trueValue),this.getErrorStrings().indexOf(i)>-1)return i;n=this.parseFloat(i)}else{if(i=this.getValueFromArg(o[l]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(i)>-1)return i;var d=Date.parse(i.split(this.tic).join(""));if(isNaN(d)){if(i!==this.trueValue&&i!==this.falseValue)return this.getErrorStrings()[Br.value].toString()}else r=!0;n=this.parseFloat(i)}r="and"===t?r&&(i===this.trueValue||!isNaN(n)):r||i===this.trueValue||!isNaN(n)}return r?this.trueValue:this.falseValue}},{key:"removeTics",value:function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e}},{key:"getCellFrom",value:function(e){var t,i="",n=e.indexOf(":")>-1?e.split(":"):[e],r=n.length-1,a=this.rowIndex(n[0]);if(a===this.rowIndex(n[r])){var s=this.colIndex(n[0]),o=this.colIndex(n[r]),l=this.colIndex(this.cell);l>=s&&l<=o&&(i=Gr(l).toString()+a.toString())}else if(this.colIndex(n[0])===this.colIndex(n[r])){t=this.colIndex(n[0]);var h=this.rowIndex(n[r]),c=this.rowIndex(this.cell);c>=a&&c<=h&&(i=Gr(t).toString()+c.toString())}return i}},{key:"computeValue",value:function(e,t){try{var i=[],n=0,r="";for(i.length=0;n<e.length;){var a="u"===e[n];if(e[n]!==this.arithMarker){if(this.isDigit(e[n])){for(var s=this.emptyString;n<e.length&&(this.isDigit(e[n])||e[n]===this.parseDecimalSeparator);)s+=e[n],n+=1;if(i.push(s),!e[n])return i.toString()}if(e[n]===this.sheetToken){for(r=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)r+=e[n],n+=1;n<e.length&&(r+=e[n],n+=1)}else if(this.isUpperChar(e[n])){for(var o,l=this.emptyString;n<e.length&&this.isUpperChar(e[n]);)l+=e[n],n+=1;for(;n<e.length&&this.isDigit(e[n]);)l+=e[n],n+=1;if(n<e.length&&":"===e[n]){if(l+=e[n],(n+=1)<e.length&&e[n]===this.sheetToken)for(l+=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)l+=e[n],n+=1;for(;n<e.length&&this.isUpperChar(e[n]);)l+=e[n],n+=1;for(;n<e.length&&this.isDigit(e[n]);)l+=e[n],n+=1;l=r+this.getCellFrom(l)}else l=r+l;if(o=this.getParentObjectCellValue(l,t).toString(),r="","string"==typeof o&&this.getErrorStrings().indexOf(o)>-1)return o;i.push(o)}else if("q"===e[n]){var h=e.substring(n+1).indexOf(this.leftBracket),c=e.substring(n+h+1).indexOf(this.rightBracket);e=this.substring(e,n+h+2,c-1)}else if(e[n]===this.tic[0]){var d=e[n].toString();for(n+=1;n<e.length&&e[n]!==this.tic[0];)d+=e[n],n+=1;i.push(d.split(this.tic).join(this.emptyString)),n+=1}else if("%"===e[n]&&i.length>0){var u=this.parseFloat(i[0]);this.isNaN(u)||(i.pop(),i.push((u/100).toString())),n+=1}else if(0===e.substring(n).indexOf(this.trueValue))i.push(this.trueValue),n+=this.trueValue.length;else if(0===e.substring(n).indexOf(this.falseValue))i.push(this.falseValue),n+=this.falseValue.length;else if(e[n]===this.tic[0]||"|"===e[n]){var p=e[n].toString();for(n++;n<e.length&&e[n]!==this.tic[0];)p+=e[n],n+=1;i.push(p+this.tic),n+=1}else switch(e[n]){case"#":var g=0;this.getErrorStrings().indexOf(e.substring(n))>-1?(g=-1===e.indexOf("!")||-1===e.substring(n).indexOf("!")?e.indexOf("#N/A")>-1?e.indexOf("#N/A")+4+n:e.indexOf("?")+1+n:e.indexOf("!")+1+n,i.push(this.substring(e,n,g-n))):(g=n+1,i.push(this.substring(e,n,g-n))),n=g;break;case"n":n+=1;var f="";if(0===e.substring(n).indexOf("Infinity"))n+=(f="Infinity").length;else{for(("u"===e[n]||a||"-"===e[n])&&(f="-",a?a=!1:n+=1);n<e.length&&this.isDigit(e[n])||e[n]===this.getParseDecimalSeparator();)f+=e[n],n+=1;if(n<e.length&&"%"===e[n])if(n+=1,""===f){if(i.length>0){var m=this.parseFloat(i[0]);this.isNaN(m)||(i.pop(),i.push((m/100).toString()))}}else f=(this.parseFloat(f)/100).toString()}i.push(f);break;case this.parser.tokenAdd:this.getValArithmetic(i,"add"),n+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(i,"sub"),n+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(i,"mul"),n+=1;break;case this.parser.tokenDivide:this.getValArithmetic(i,"div"),n+=1;break;case this.parser.tokenLess:this.processLogical(i,"less"),n+=1;break;case this.parser.tokenGreater:this.processLogical(i,"greater"),n+=1;break;case this.parser.tokenGreaterEq:this.processLogical(i,"greaterEq"),n+=1;break;case this.parser.tokenLessEq:this.processLogical(i,"lessEq"),n+=1;break;case this.parser.tokenNotEqual:this.processLogical(i,"notEq"),n+=1;break;case this.parser.tokenOr:this.processLogical(i,"or"),n+=1;break;case this.parser.tokenAnd:this.processLogical(i,"and"),n+=1;break;case this.parser.tokenEqual:this.processLogical(i,"equal"),n+=1;break;default:return this.getErrorStrings()[Br.value]}}else n+=1}if(0===i.length)return this.emptyString;for(var v=this.emptyString,y=i.length;y>0;){if((v=i.pop()+v)===this.emptyString&&this.isCellReference(e)&&this.getTreatEmptyStringAsZero())return"0";y--}return v}catch(b){if(this.getErrorStrings().indexOf(b)>-1||this.formulaErrorStrings.indexOf(b)>-1)throw b;throw new qr(this.formulaErrorStrings[Hr.invalid_expression])}}},{key:"getValArithmetic",value:function(e,t){var i=e.pop();i=i===this.emptyString?"0":i;var n=Number(i);if(isNaN(n))throw i===this.getErrorStrings()[Br.divzero]?this.getErrorStrings()[Br.divzero]:this.getErrorStrings()[Br.value];var r=e.pop();if(r=r===this.emptyString?e.length?e.pop():"0":r,n=Number(r),isNaN(n))throw i===this.getErrorStrings()[Br.divzero]?this.getErrorStrings()[Br.divzero]:this.getErrorStrings()[Br.value];"add"===t&&e.push((Number(r)+Number(i)).toString()),"sub"===t&&e.push((Number(r)-Number(i)).toString()),"mul"===t&&e.push((Number(r)*Number(i)).toString()),"div"===t&&(this.isNaN(this.parseFloat(i))||this.isNaN(this.parseFloat(r))?e.push(this.getErrorStrings()[Br.value]):0===this.parseFloat(i)?e.push(this.getErrorStrings()[Br.divzero]):e.push((Number(r)/Number(i)).toString()))}},{key:"processLogical",value:function(e,t){var i,n,r,a,s;return"and"!==t&&"equal"!==t&&(i=e.pop(),n=e.pop(),r=i.indexOf(this.tic)>-1?i:this.parseFloat(i),a=n.indexOf(this.tic)>-1?n:this.parseFloat(n)),"less"===t&&(s=this.isNaN(r)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:a<r?this.trueValue:this.falseValue),"greater"===t&&(s=this.isNaN(r)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:a>r?this.trueValue:this.falseValue),"lessEq"===t&&(s=this.isNaN(r)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:a<=r?this.trueValue:this.falseValue),"greaterEq"===t&&(s=this.isNaN(r)||this.isNaN(a)?n.toUpperCase().split(this.tic).join("").localeCompare(i.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:a>=r?this.trueValue:this.falseValue),"notEq"===t&&(s=n!==i?this.trueValue:this.falseValue),"and"===t&&(i=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),s=(s=this.emptyString+n+i+this.emptyString).split(this.tic).join("")),"equal"===t&&(i=e.pop().toString(),""===(n=e.pop().toString())&&""!==i&&(n="0"),s=i===n?this.trueValue:this.falseValue),"or"===t&&(s=Math.pow(this.parseFloat(a),this.parseFloat(r)).toString()),e.push(s),s}},{key:"computeStoreCells",value:function(e){for(var t=e.cellValue,i=e.cellRange,n=e.criteria,r=e.argArray,a=e.isCriteria,s=e.storedCells,o=e.isCountIfS,l=e.countVal,h=a===this.trueValue?s:t,c=[],d=0;d<h.length;d++){var u=[],p=void 0,g=this.getValueFromArg(t[d]),f="";if(p=r[2].split(this.tic).join(this.emptyString),p=this.isCellReference(p)?this.getValueFromArg(p):p,(a=o===this.trueValue?this.trueValue:a)===this.trueValue){var m,v=0,y=0;for(s[d]=o===this.trueValue&&0===l?t[d]:s[d],m=s[d];!this.isDigit(m[v]);)v+=1;if(this.isCellReference(i[l])&&i[l].indexOf(":")>-1){var b=i[l].indexOf(":");for(f=this.substring(i[l],b);!this.isDigit(f[y]);)y+=1}var C=this.substring(m,v),x=this.substring(f,y);f=s[d].split(C).join(x),g=this.getValueFromArg(f),p=o===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}var S="equal";p.startsWith("<=")?(S="lessEq",p=p.substring(2)):p.startsWith(">=")?(S="greaterEq",p=p.substring(2)):p.startsWith("<>")?(S="notEq",p=p.substring(2)):p.startsWith("<")?(S="less",p=p.substring(1)):p.startsWith(">")?(S="greater",p=p.substring(1)):p.startsWith("=")&&(S="equal",p=p.substring(1)),(p.indexOf("*")>-1||p.indexOf("?")>-1)&&(g=this.findWildCardValue(p,g)),u.push(g.toLowerCase()),u.push(p.toLowerCase()),this.processLogical(u,S)===this.trueValue&&c.push(a===this.falseValue?t[d]:f)}return s=c,c=[],s}},{key:"computeIfsFormulas",value:function(e,t,i){if(Object(f.Z)(e)||""===e[0]||0===e.length)return this.formulaErrorStrings[Hr.wrong_number_arguments];var n=e,r=n.length;if(r<2||r>127)return this.formulaErrorStrings[Hr.wrong_number_arguments];for(var a=[],s=[],o=[],l=0,h=0;h<n.length;h++)n[h].indexOf(":")>-1&&this.isCellReference(n[h])?a.push(n[h]):s.push(n[h]);a=(a=a.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());for(var c,d,u=[],p=0;p<a.length;p++)u.push(this.getCellCollection(a[p]).length);for(var g=0;g<u.length;g++)if(u[g]&&u[g+1]&&u[g]!==u[g+1])return this.getErrorStrings()[Br.value];if(t===this.falseValue&&(d=this.falseValue,c=this.getCellCollection(a[1]),0===(o=this.computeStoreCells({cellValue:c,cellRange:a,criteria:s,argArray:n,isCriteria:d,storedCells:o,isCountIfS:t})).length))return i===this.trueValue?this.getErrorStrings()[Br.divzero]:0;for(var m=t===this.trueValue?0:2;m<a.length;m++)if(d=this.trueValue,d=t===this.trueValue&&0===m?this.falseValue:this.trueValue,c=this.getCellCollection(a[m]),0===(o=this.computeStoreCells({cellValue:c,cellRange:a,criteria:s,argArray:n,isCriteria:d,storedCells:o,isCountIfS:t,countVal:m})).length)return 0;for(var v=0,y=0;y<o.length;y++){var b,C="",x=0,S=0;for(b=o[y];!this.isDigit(b[x]);)x+=1;if(this.isCellReference(a[0])&&a[0].indexOf(":")>-1){var w=a[0].indexOf(":");for(C=this.substring(a[0],w);!this.isDigit(C[S]);)S+=1}var k=this.substring(b,x),I=this.substring(C,S);if(c=o[y].split(k).join(I),t===this.trueValue)l+=1;else{v++;var O=this.getValueFromArg(c);l+=parseFloat(""===O?"0":O)}}return i===this.trueValue&&(l/=v),l}},{key:"processNestedFormula",value:function(e,t,i){return e.split(t).join("n"+i)}},{key:"isNaN",value:function(e){return"NaN"===e.toString()||"string"==typeof e}},{key:"fromOADate",value:function(e){var t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t}},{key:"getSerialDateFromDate",value:function(e,t,i){var n=0;e<1900&&(e+=1900);for(var r=!1;!r;){for(;t>12;)e++,t-=12;r=!0;for(var a=new Date(e,t,1,-1).getDate();i>a;)a=new Date(e,t,1,-1).getDate(),t++,i-=a,r=!1;i<1&&(t--,i=(a=new Date(e,t,1,-1).getDate())-i)}var s=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+i.toString());return this.isNaN(s)||(n=this.toOADate(new Date(s))),n}},{key:"toOADate",value:function(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay}},{key:"calculateDate",value:function(e){return this.parseFloat(e)<10?"0"+e:e}},{key:"isTextEmpty",value:function(e){return null===e||""===e}},{key:"isDigit",value:function(e){var t=e.charCodeAt(0);return t>47&&t<58}},{key:"findLastIndexOfq",value:function(e){return e.lastIndexOf("q")}},{key:"getValueFromArg",value:function(e,t){var i=e=e.trim(),n=this.dateTime1900,r=i;if(Object(f.Z)(i)||this.isTextEmpty(i))return i;if(e[0]===this.tic||e[0]===this.singleTic)return n=this.isDate(e.split(this.tic).join("")),this.isNaN(this.parseFloat(e.split(this.tic).join("")))&&!Object(f.Z)(n)&&!this.isNaN(n.getDate())&&this.dateTime1900<=n?this.toOADate(n).toString():e;if(e=e.split("u").join("-"),!this.isUpperChar(i[0])&&(this.isDigit(i[0])||i[0]===this.getParseDecimalSeparator()||"-"===i[0]||"n"===i[0]))return"n"===i[0]&&(i=i.substring(1)).indexOf('"n')>-1&&(i=i.replace('"n','"')),i;if(-1===this.parser.indexOfAny(i,["+","-","/","*",")",")","{"])&&this.isUpperChar(i[0])||i[0]===this.sheetToken){if(i!==this.trueValue&&i!==this.falseValue&&this.isCellReference(i)){var a=this.getSheetFamilyItem(this.grid);null!==a.sheetNameToParentObject&&a.sheetNameToParentObject.size>0&&-1===i.indexOf(this.sheetToken)&&(i=a.parentObjectToToken.get(this.grid)+i)}if(i===this.cell){var s=this.getDependentCells().get(i);if(null!=s&&s.indexOf(i)>-1&&this.arrayRemove(s,i),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!t)throw this.formulaErrorStrings[Hr.circular_reference]+i}return r=this.getParentObjectCellValue(i,!1,t),this.updateDependentCell(i),r.toString()}return this.getErrorStrings().indexOf(e)>-1?e:this.computeValue(r.toString(),!1)}},{key:"isDate",value:function(e){if("object"==typeof e||null!==Date.parse(e)){var t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null}},{key:"isValidCellReference",value:function(e){var t=0,i=0,n=[89,71,69],r=this.emptyString;if(this.namedRanges.has(e))return!1;for(var a=0;a<e.length;a++)this.isChar(e[a])&&t++;if((r=e.substring(0,t)).length<4){for(;i<r.length;){if(Object(f.Z)(r[i])||!(r[i].charCodeAt(0)<n[i])){if(Object(f.Z)(r[i])&&i>0)break;return!1}i++}if(this.parseFloat(e.substring(t,e.length))<1048576)return!0}return!1}},{key:"parseDate",value:function(e){if(!this.isNaN(e)){if(e instanceof Date)return new Date(e);var t=parseInt(e,10);return t<0?this.getErrorStrings()[Br.num]:t<=60?new Date(this.dateTime1900.getTime()+864e5*(t-1)):new Date(this.dateTime1900.getTime()+864e5*(t-2))}return"string"!=typeof e||(e=new Date(e),this.isNaN(e))?this.getErrorStrings()[Br.value]:e}},{key:"isCellReference",value:function(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);var t=this.getSheetToken(e),i=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,r=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var a=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),s=0;s<a.length;s++)if(this.isChar(a[s]))n=!0;else if(this.isDigit(a[s]))r=!0;else{if(":"!==a[s])return!1;n&&r&&(i=!0),n=!1,r=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(i&&n&&r)||!(!(n&&!r||!n&&r)||i):!(!n||!r||-1!==e.indexOf(this.tic))}},{key:"setTokensForSheets",value:function(e){var t=this.getSheetFamilyItem(this.grid),i=this.getSortedSheetNames();if(null!=i)for(var n=0;n<i.length;n++){var r=t.sheetNameToToken.get(i[n]);r=r.split(this.sheetToken).join(this.tempSheetPlaceHolder);var a=this.singleTic+"SHEET"+i[n]+this.singleTic+this.sheetToken;-1===e.indexOf(a)&&(a="SHEET"+i[n]+this.sheetToken),e=e.split(a).join(r),a=i[n]+this.sheetToken,e=e.split(a).join(r)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var s=(e=e.replace("!!","!")).split("");s[1]=(parseInt(s[1],10)+1).toString(),e=s.join("")}return e}},{key:"getParentObjectCellValue",value:function(e,t,i){if(e===this.trueValue||e===this.falseValue)return e;var n=e.lastIndexOf(this.sheetToken),r=0,a=0,s=this.grid,o=this.getSheetFamilyItem(s);if(n>-1&&null!==o.tokenToParentObject)this.grid=o.tokenToParentObject.get(e.substring(0,n+1)),r=this.rowIndex(e),a=this.colIndex(e);else if(-1===n){for(var l=0;l<e.length&&this.isChar(e[l]);)l++;if(l===e.length)return""===(e=e.toLowerCase())?this.getErrorStrings()[Br.value]:this.getErrorStrings()[Br.name];r=this.rowIndex(e),a=this.colIndex(e),o.isSheetMember&&null!=o.parentObjectToToken&&(e=o.parentObjectToToken.get(this.grid)+e)}var h=""===this.cell||null===this.cell?"":this.cell;if(this.cell=e,h===this.cell&&!i)throw this.formulaErrorStrings[Hr.circular_reference];var c=this.getParentCellValue(r,a,this.grid,h,s,t);return this.grid=s,this.cell=h,c}},{key:"getParentCellValue",value:function(e,t,i,n,r,a){var s,o=this.getSheetId(i);return void 0!==this.parentObject.getValueRowCol?(n&&(n=r===i?"":n+","+(r&&"string"==typeof r&&Number(r)>-1?r:this.getSheetID(r))),s=this.parentObject.getValueRowCol(o,e,t,n,a),Object(f.Z)(s)?this.emptyString:s.toString()):(""!==(s=this.getValueRowCol(o,e,t))&&void 0!==s||(s=""),s)}},{key:"getSheetId",value:function(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1}},{key:"getValueRowCol",value:function(e,t,i){var n=this.rowsToKeyMap.get(t).toString(),r=this.getKeyValue(n).toString();if(null!=r&&"%"===r[r.length-1]&&r.length>1){var a=this.parseFloat(r.substring(0,r.length-1));this.isNaN(a)&&(r=(Number(a)/100).toString())}return r}},{key:"defineFunction",value:function(e,t){"string"==typeof t&&(t=Object(f.X)(t,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:t,isCustom:!0})}},{key:"valueChanged",value:function(e,t,i,n,r){var a=e;this.spreadSheetUsedRange=n,this.grid=e;var s=!0,o=!0,l=this.getSheetFamilyItem(a),h=Gr(t.getColIndex())+t.getRowIndex().toString();this.actCell=h,null!==l.sheetNameToParentObject&&l.sheetNameToParentObject.size>0&&(h=l.parentObjectToToken.get(a)+h);var c=t.getValue().toUpperCase();if(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(h)){var d=this.randCollection.toString();this.randomValues.has(h)?this.randomValues.has(h)&&(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(h,t.getValue()):t.getValue().toUpperCase()!==this.randomValues.get(h.toUpperCase())&&(this.randomValues.delete(h),d=d.split(h+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+h).join("").split(h).join(""),this.randCollection=d.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(h,t.getValue()),this.randCollection.push(h),this.isRandomVal=!0)}if(t.getValue()&&t.getValue()[0]===this.getFormulaCharacter()){var u;if(this.cell=h,Object(f.Z)(o)||(o=i),this.getFormulaInfoTable().has(h)){if(u=this.getFormulaInfoTable().get(h),t.getValue()!==u.getFormulaText()||null==u.getParsedFormula()){u.setFormulaText(t.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{u.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(g){u.setFormulaValue(g),o=!1}}if(o){this.parser.isFormulaParsed=!0;var p=this.calculateFormula(u.getParsedFormula(),r);s=p!==u.getFormulaValue(),u.setFormulaValue(p)}}else{(u=new Wr).setFormulaText(t.getValue()),this.getDependentFormulaCells().has(h)||this.getDependentFormulaCells().set(h,new Map);try{u.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(g){u.setFormulaValue(g),o=!1}o&&u.setFormulaValue(this.calculateFormula(u.getParsedFormula(),r)),this.getFormulaInfoTable().has(h),this.getFormulaInfoTable().set(h,u)}o&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(a)+1,u.getFormulaValue(),t.getRowIndex(),t.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(a),u.getFormulaValue(),t.getRowIndex(),t.getColIndex()))}else this.getFormulaInfoTable().has(h)&&(this.getFormulaInfoTable().delete(h),this.getDependentFormulaCells().has(h)&&this.clearFormulaDependentCells(h));o&&s&&this.getDependentCells().has(h)&&this.getDependentCells().get(h).toString()!==h&&(this.getComputedValue().clear(),this.refresh(h))}},{key:"getComputedValue",value:function(){return null===this.computedValues&&(this.computedValues=new Map),this.computedValues}},{key:"setValueRowCol",value:function(e,t,i,n){}},{key:"getSortedSheetNames",value:function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach(function(e,i){t.push(i),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames}},{key:"getErrorLine",value:function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null}},{key:"createSheetFamilyID",value:function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++}},{key:"computeMinMax",value:function(e,t){var i,n,r=0;if(Object(f.Z)(e)||0===e.length)return this.formulaErrorStrings[Hr.wrong_number_arguments];for(var a=0,s=e.length;a<s;a++)if(e[a].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[Br.value];i="max"===t?this.minValue:this.maxValue;var o=e;if(o.length>255)return this.getErrorStrings()[Br.value];for(var l=0;l<o.length;l++)if(o[l].indexOf(":")>-1&&this.isCellReference(o[l]))for(var h=this.getCellCollection(o[l]),c=0;c<h.length;c++){if(n=this.getValueFromArg(h[c]),this.getErrorStrings().indexOf(n)>-1)return n;var d=this.parseFloat(n);""===n||this.isNaN(this.parseFloat(d))?(r+=1)===h.length&&(i=0):i="max"===t?Math.max(i,d):Math.min(i,d)}else{var u=this.getValueFromArg(o[l]);if(this.getErrorStrings().indexOf(u)>-1)return u;var p=this.parseFloat(u);if(""===u||this.isNaN(this.parseFloat(p))){(r+=1)===n.length&&(i=0);continue}i="max"===t?Math.max(i,p):Math.min(i,p)}return i.toString()}},{key:"calculateAvg",value:function(e){for(var t=0,i=e,n=[],r=0,a=0,s=0;s<i.length;s++)if(i[s].indexOf(":")>-1&&this.isCellReference(i[s])){a=0,n=this.getCellCollection(i[s]),r=0;for(var o=0;o<n.length;o++){var l=this.getValueFromArg(n[o]);Object(f.Z)(l)||isNaN(this.parseFloat(l))||(r+=this.parseFloat(l),a+=1)}if(0===a)return this.getErrorStrings()[Br.divzero];t=(r/=a)+t}else{if(i[s].indexOf(this.tic)>-1&&isNaN(parseFloat(i[s].split(this.tic).join(""))))return this.getErrorStrings()[Br.value];0===i[s].length&&(i[s]="1");var h=this.getValueFromArg(i[s].split(this.tic).join(""));if(Object(f.Z)(h)||isNaN(this.parseFloat(h)))return this.getErrorStrings()[Br.name];t+=this.parseFloat(h)}return(t/(i.length-0)).toString()}},{key:"registerGridAsSheet",value:function(e,t,i){Object(f.Z)(this.modelToSheetID)&&(this.modelToSheetID=new Map),Object(f.Z)(this.modelToSheetID.get(t))&&this.modelToSheetID.set(t,i);var n=this.getSheetFamilyItem(t);n.isSheetMember=!0;var r=e.toUpperCase();if(0===n.parentObjectToToken.size&&(n.parentObjectToToken=new Map),0===n.sheetNameToParentObject.size&&(n.sheetNameToParentObject=new Map),0===n.sheetNameToToken.size&&(n.sheetNameToToken=new Map),0===n.tokenToParentObject.size&&(n.tokenToParentObject=new Map),Object(f.cb)(n.sheetNameToParentObject.get(r))){var a=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,n.tokenToParentObject.set(a,t),n.parentObjectToToken.set(t,a),n.sheetNameToToken.set(r,a),n.sheetNameToParentObject.set(r,t)}else{var s=n.sheetNameToToken.get(r);n.tokenToParentObject.set(s,t),n.parentObjectToToken.set(t,s)}return e}},{key:"unregisterGridAsSheet",value:function(e,t,i){var n=this,r=[t];i&&(r=[],Object(f.Z)(this.modelToSheetID)||this.modelToSheetID.forEach(function(e,t){r.push(t)})),r.forEach(function(t){var r=n.getSheetFamilyItem(t),a=(i?t:e).toUpperCase();if(null!=r.sheetNameToParentObject&&r.sheetNameToParentObject.has(a)){r.sheetNameToParentObject.delete(a);var s=r.sheetNameToToken.get(a);r.sheetNameToToken.delete(a),r.tokenToParentObject.delete(s),r.parentObjectToToken.delete(t),i&&(r.sheetDependentCells=new Map)}})}},{key:"computeExpression",value:function(e){var t=this.parser.parseFormula(e);return this.computeFormula(t)}},{key:"isSheetMember",value:function(){var e=this.getSheetFamilyItem(this.grid);return!Object(f.Z)(e)&&e.isSheetMember}},{key:"dispose",value:function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()}},{key:"refreshRandValues",value:function(e){var t,i,n,r,a="",s=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),s=s.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===s?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=s.split(this.parseArgumentSeparator));for(var o=0;o<this.randomValues.size;o++)t=this.rowIndex(this.randCollection[o]),i=this.colIndex(this.randCollection[o]),a=(parseFloat(this.getSheetToken(this.randCollection[o]).split(this.sheetToken).join(""))+1).toString(),r=this.getSheetFamilyItem(a),this.grid=r.sheetNameToParentObject.get(a),n=this.randomValues.get(this.randCollection[o]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,i):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,i)}},{key:"refresh",value:function(e){if(0===this.dependencyLevel&&this.refreshedCells.clear(),this.getDependentCells().has(e)&&null!==this.getDependentCells().get(e)){var t=this.getSheetFamilyItem(this.grid);this.dependencyLevel=this.dependencyLevel+1;try{var i,n=this.getDependentCells().get(e);for(i=0;i<n.length;i++){var r=n[i],a=this.getSheetToken(r);this.actCell=r.split(a)[1],a.length&&(this.grid=t.tokenToParentObject.get(a));try{var s=this.rowIndex(r),o=this.colIndex(r),l=this.getFormulaInfoTable().get(r),h=void 0;l&&(this.cell=r,this.getComputedValue().has(r)?h=this.getComputedValue().get(r):(this.parser.isFormulaParsed=!0,h=this.calculateFormula(l.getParsedFormula(),!0),this.computedValues.set(r,h)),l.setFormulaValue(h)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),s,o):this.parentObject.setValueRowCol(this.getSheetId(this.grid),l.getFormulaValue(),s,o),this.refreshedCells.has(r)||(this.refreshedCells.set(r,[]),this.refresh(r))}catch(c){continue}}}finally{this.grid=t.tokenToParentObject.get(this.getSheetToken(e)),this.dependencyLevel--,0===this.dependencyLevel&&this.refreshedCells.clear()}}}}],[{key:"Inject",value:function(){this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var n=0;n<t.length;n++)-1===this.prototype.injectedModules.indexOf(t[n])&&this.prototype.injectedModules.push(t[n])}}]),n}(f.c),Vr([Object(f.t)(!0)],Pr.prototype,"includeBasicFormulas",void 0),Vr([Object(f.k)()],Pr.prototype,"onFailure",void 0),Pr=Fr=Vr([f.r],Pr)),qr=function e(t,i){a(this,e),this.formulaCorrection=!1,this.message=t,this.formulaCorrection=i},Wr=function(){function e(){a(this,e),this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return o(e,[{key:"getFormulaText",value:function(){return this.formulaText}},{key:"setFormulaText",value:function(e){this.formulaText=e}},{key:"getFormulaValue",value:function(){return this.formulaValue}},{key:"setFormulaValue",value:function(e){this.formulaValue=e}},{key:"getParsedFormula",value:function(){return this.parsedFormula}},{key:"setParsedFormula",value:function(e){this.parsedFormula=e}}]),e}(),Zr=function e(){a(this,e),this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentCells=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map};function Gr(e){for(var t=[],i=0;e>0&&i<9;){e--;var n="A".charCodeAt(0);t[i]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),i++}for(var r=[],a=0;a<i;a++)r[i-a-1]=t[a];return r.join("")}var Yr=function e(t,i,n){return a(this,e),this.row=t,this.col=i,this.value=n,this.getRowIndex=function(){return t},this.setRowIndex=function(e){t=e},this.getColIndex=function(){return i},this.setColIndex=function(e){i=e},this.getValue=function(){return n},this},Xr=function(){function e(t){a(this,e),this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=t,this.init()}return o(e,[{key:"init",value:function(){this.addEventListener(),this.initCalculate(),this.registerSheet()}},{key:"destroy",value:function(){this.removeEventListener(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null}},{key:"addEventListener",value:function(){this.parent.on(pr,this.performFormulaOperation,this),this.parent.on("aggregateComputation",this.aggregateComputation,this),this.parent.on("getUniqueRange",this.getUniqueRange,this),this.parent.on("removeUniquecol",this.removeUniquecol,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off(pr,this.performFormulaOperation),this.parent.off("aggregateComputation",this.aggregateComputation),this.parent.off("getUniqueRange",this.getUniqueRange),this.parent.off("removeUniquecol",this.removeUniquecol))}},{key:"getModuleName",value:function(){return"workbookFormula"}},{key:"initCalculate",value:function(){this.calculateInstance=new Ur(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()}},{key:"performFormulaOperation",value:function(e){var t,i,n=e.action,r=this.calculateInstance.getLibraryFormulas(),a=Array.from(r.values());switch(n){case"getLibraryFormulas":e.formulaCollection=Array.from(r.keys());break;case"getFormulaCategory":t=["All"];for(var s=1;s<Array.from(r.values()).length;s++)t.indexOf(a[s].category)<0&&t.push(a[s].category);e.categoryCollection=t;break;case"dropDownSelectFormulas":for(var o=0;o<Array.from(r.values()).length;o++)e.selectCategory===a[o].category&&(e.formulaCollection[o]=Array.from(r.keys())[o]);break;case"getFormulaDescription":for(var l=0;l<Array.from(r.values()).length;l++)e.selectedList===Array.from(r.keys())[l]&&(e.description=a[l].description);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"refreshCalculate":e.isFormula&&(e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex,e.sheetIndex)),this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex,e.isRefreshing),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.sheetId);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.index});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":i=this.sheetInfo.length;for(var h=0;h<i;h++)if(this.sheetInfo[h].index===e.index){e.sheetName=this.sheetInfo[h].sheet,this.sheetInfo.splice(h,1);break}this.calculateInstance.unregisterGridAsSheet((e.index-1).toString(),e.index),this.calculateInstance.tokenCount=this.calculateInstance.tokenCount-1,this.sheetDeletion(e.sheetName,e.index,e.index);break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=Gr(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"refreshInsDelFormula":this.refreshInsDelFormula(e.insertArgs);break;case"refreshNamedRange":this.refreshNamedRange(e.insertArgs)}}},{key:"referenceError",value:function(){return this.calculateInstance.getErrorStrings()[Br.ref]}},{key:"getSheetInfo",value:function(){return this.sheetInfo}},{key:"addCustomFunction",value:function(e,t){this.calculateInstance.defineFunction(t,e)}},{key:"updateSheetInfo",value:function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach(function(t,i){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:i})})}},{key:"getUniqueRange",value:function(e){e.range=this.calculateInstance.uniqueRange}},{key:"removeUniquecol",value:function(){for(var e=this.parent.getActiveSheet().activeCell,t=0;t<this.calculateInstance.uniqueRange.length;t++)if(this.calculateInstance.uniqueRange[t].split(":")[0]===e){var i=Wn(this.calculateInstance.uniqueRange[t]);this.calculateInstance.uniqueRange.splice(t,1);for(var n=i[0];n<=i[2];n++)for(var r=i[1];r<=i[3];r++)Da(n,r,this.parent.getActiveSheet()).formula="",this.parent.updateCell({value:"",formula:""},Xn([n,r]))}}},{key:"sheetDeletion",value:function(e,t,i){var n,r,a=this.calculateInstance.getDependentCells(),s=[],o=null,l="";a.forEach(function(e,t){s.push(t)}),this.removeSheetTokenIndex(l,i);for(var h=0;h<s.length;h++)for(var c=this.calculateInstance.getDependentCells().get(s[h]),d=0;d<c.length;d++)o=this.calculateInstance.getFormulaInfoTable().get(c[d]),t=parseInt(c[d].split("!")[1],10)+1,!Object(f.Z)(o)&&t>-1&&((l=o.formulaText).toUpperCase().indexOf(e.toUpperCase())>-1&&(l=l.toUpperCase().split(e.toUpperCase()+this.calculateInstance.sheetToken).join(this.referenceError()),n=this.calculateInstance.rowIndex(c[d]),r=this.calculateInstance.colIndex(c[d]),this.updateDataContainer([n-1,r-1],{value:l,sheetId:t,visible:!1}),this.calculateInstance.refresh(o.getParsedFormula()))),e.split("Sheet")[1]===s[h].split("!")[1]&&(this.calculateInstance.getFormulaInfoTable().delete(s[h]),this.calculateInstance.clearFormulaDependentCells(s[h]))}},{key:"removeSheetTokenIndex",value:function(e,t){var i=this.calculateInstance.getSheetFamilyItem(this.calculateInstance.grid);return i.sheetNameToToken.delete(t.toString()),i.sheetNameToParentObject.delete(t.toString()),i.parentObjectToToken.delete(t.toString()),i.tokenToParentObject.delete("!"+(t-1).toString()+"!"),e}},{key:"renameUpdation",value:function(e,t){var i,n,r,a=this.calculateInstance.getDependentCells(),s=[],o="",l=[],h=!1;a.forEach(function(e,t){s.push(t)});for(var c=0;c<this.sheetInfo.length;c++)if(this.sheetInfo[c].index===t){this.sheetInfo[c].visibleName=e;break}for(var d=this.sheetInfo,u=0;u<s.length;u++)for(var p=this.calculateInstance.getDependentCells().get(s[u]),g=0;g<p.length;g++){o=this.calculateInstance.getFormulaInfoTable().get(p[g]).formulaText;for(var f=0;f<d.length;f++)if(d[f].visibleName!==d[f].sheet){var m=d[f].sheet.toUpperCase();o.toUpperCase().indexOf(m)>-1&&(o=o.toUpperCase().split(m).join(f+"/"),l.push(f),h=!0)}if(h){for(var v=0;v<l.length;v++)o=o.split(l[v].toString()+"/").join(d[l[v]].visibleName);i=this.calculateInstance.rowIndex(p[g]),n=this.calculateInstance.colIndex(p[g]),r=Ya(0,"Sheet"+(parseInt(p[g].split("!")[1],10)+1),this.sheetInfo),this.updateDataContainer([i-1,n-1],{value:o,sheetId:r,visible:!0})}}}},{key:"updateDataContainer",value:function(e,t){for(var i,n,r,a=e[0],s=e[1],o=this.parent.sheets.length,l=0;l<o;l++)if(this.parent.sheets[l].id===t.sheetId){i=this.parent.sheets[l].rows;break}Object(f.Z)(t)||(a in i?s in(n=i[a]).cells?((r=n.cells[s]).formula=t.value,r.value=t.visible?r.value:this.referenceError()):n.cells[s]=r={}:(n=i[a]={})[s]=r={})}},{key:"parseSheetRef",value:function(e){var t,i,n,r,a,s,o=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),l=0,h=this.parent.sheets.length,c=[];c.length=0;var d=this.getSheetInfo(),u='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(l=0;l<h;l++)if(d[l].sheet!==d[l].visibleName&&(t=new RegExp(d[l].visibleName.replace(o,"\\$&")+u,"gi"),r=l,e.match(t))){for(var p=l+1;p<h;p++)i=new RegExp(d[p].visibleName.replace(o,"\\$&")+u,"gi"),n=e.search(i),a=e.search(t),n>-1&&(n<a||n===a&&d[p].visibleName.length>d[l].visibleName.length)&&(s=new RegExp("Sheet","gi"),0!==d[p].visibleName.search(s)&&(t=i,r=p));e=e.replace(t,r+"/"),c.push(r)}for(l=0;l<c.length;)t=new RegExp(c[l]+"/"+u,"gi"),e=e.replace(t,d[c[l]].sheet),l++;return e}},{key:"registerSheet",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parent.sheets.length;t<i;)e=Ka(this.parent,t).id+"",this.calculateInstance.registerGridAsSheet(e,e,this.calcID),t++}},{key:"unRegisterSheet",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parent.sheets.length,n=arguments.length>2?arguments[2]:void 0;if(this.calculateInstance.tokenCount=0,n)this.calculateInstance.unregisterGridAsSheet(e,e,n);else for(;t<i;)e=Ka(this.parent,t).id+"",this.calculateInstance.unregisterGridAsSheet(e,e),t++}},{key:"refreshCalculate",value:function(e,t,i,n,r,a){var s=Object(f.Z)(r)?this.parent.getActiveSheet():Ka(this.parent,r),o=s.id+"";if(n){i=this.parseSheetRef(i);var l=new Yr(e+1,t+1,i);this.calculateInstance.valueChanged(o,l,!0,[s.usedRange.rowIndex,s.usedRange.colIndex],a);var h=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var c,d,u="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===h.length)for(var p=0;p<this.calculateInstance.randomValues.size;p++){c=this.calculateInstance.rowIndex(h[p]),d=this.calculateInstance.colIndex(h[p]),u=this.calculateInstance.randomValues.get(h[p]),o=(parseFloat(this.calculateInstance.getSheetToken(h[p]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var g=new Yr(c,d,u);this.calculateInstance.valueChanged(o,g,!0)}}}else{var m=this.calculateInstance.getSheetFamilyItem(o),v=Kn(t+1)+(e+1);m.isSheetMember&&!Object(f.Z)(m.parentObjectToToken)&&(v=m.parentObjectToToken.get(o)+v),this.calculateInstance.getFormulaInfoTable().has(v)&&(this.calculateInstance.getFormulaInfoTable().delete(v),this.calculateInstance.getDependentCells().has(v)&&this.calculateInstance.clearFormulaDependentCells(v)),this.calculateInstance.getComputedValue().clear(),this.calculateInstance.refresh(v),this.calculateInstance.refreshRandValues(v)}this.calculateInstance.cell="";var y=Da(e,t,this.parent.getActiveSheet());if(y&&i&&0===i.toString().toUpperCase().indexOf("=SUM(")){var b=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","invalid arguments"],C=i.toString().toUpperCase().replace("=SUM","").replace("(","").replace(")","").split(":")[0];if(wa(C)){var x=Wn(C),S=Da(x[0],x[1],this.parent.getActiveSheet());S&&S.value&&S.format&&b.indexOf(y.value)<0&&b.indexOf(S.value)<0&&(y.format=S.format)}}}},{key:"autoCorrectFormula",value:function(e,t,i,n){if(!Object(f.Z)(e)){var r;2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")"),0===e.indexOf("=")&&(e=e.slice(1),r=!0);var a=e.match(/</g),s=e.match(/>/g),o=e.match(/=/g);if(a){for(var l="",h=0;h<a.length;h++)l+=a[h];e=e.replace(l,"<")}if(s){for(var c="",d=0;d<s.length;d++)c+=s[d];e=e.replace(c,">")}if(o){for(var u="",p=0;p<o.length;p++)u+=o[p];e=e.split(u).join("=")}e=r?"="+e:e,(a||s||o)&&(Da(t,i,Object(f.Z)(n)?this.parent.getActiveSheet():Ka(this.parent,n)).formula=e)}return e}},{key:"initiateDefinedNames",value:function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var i=e[t],n=this.parseSheetRef(i.refersTo),r=Qn(n),a=!1,s=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if((r=(r=r.split("$").join("")).split("=").join("")).indexOf(":")>-1){var o=r.split(":");wa(o[0])&&wa(o[1])&&(a=!0)}else r.indexOf(":")<0&&wa(r)&&(a=!0);s&&(a=!1),a?this.addDefinedName(i,!0):(this.removeDefinedName(i.name,i.scope),t--),t++}}},{key:"addDefinedName",value:function(e,t,i){(void 0===i||i<-1)&&(i=this.parent.definedNames.length);var n,r=!0,a=e.name;if(e.refersTo.indexOf("!")<0){var s=es(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s,e.refersTo=s+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var o=e.refersTo,l=this.parseSheetRef(e.refersTo);return e.scope?(n=Wa(this.parent,e.scope))>-1&&(a=es(this.parent,n)+"!"+a):e.scope="",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?r=!1:(this.calculateInstance.addNamedRange(a,"="===l[0]?l.substr(1):l),"="!==l[0]&&(e.refersTo="="+o),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.splice(i,0,e)),r}},{key:"removeDefinedName",value:function(e,t){var i=!1,n=this.getIndexFromNameColl(e,t);if(n>-1){var r=e;if(t){var a=Wa(this.parent,t);a&&(r=es(this.parent,a)+"!"+e)}this.calculateInstance.removeNamedRange(r),this.parent.definedNames.splice(n,1),i=!0}return i}},{key:"checkIsNameExist",value:function(e,t){return this.parent.definedNames.some(function(i){return i.name===e&&(t?i.scope===t:""===i.scope)})}},{key:"getIndexFromNameColl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=-1;return this.parent.definedNames.filter(function(n,r){n.name===e&&n.scope===t&&(i=r)}),i}},{key:"toFixed",value:function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e}},{key:"aggregateComputation",value:function(e){var t,i,n=this.parent.getActiveSheet(),r=function(e){return e.selectedRange.split(" ")[0]}(n),a=Wn(r.split(":")[1]),s=["SUM","AVERAGE","MIN","MAX"],o=[];a[0]+1===n.rowCount&&a[1]+1===n.colCount&&(r="A1:".concat(Yn(n.usedRange.rowIndex,n.usedRange.colIndex)));var l=Wn(n.activeCell),h=n.rows[l[0]]&&n.rows[l[0]].cells?n.rows[l[0]].cells[l[1]]:{},c=h?h.format:"",d=this.calculateInstance.getCellCollection(r);for(t=0;t<d.length;t++)if(hr(this.calculateInstance.getValueFromArg(d[t]))){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(r),e.Count&&!e.countOnly){for(t=0;t<4;t++){var u={formattedText:i=this.toFixed(this.calculateInstance.getFunction(s[t])(r)),value:i,format:c,onLoad:!0};c&&(this.parent.notify("getFormattedCell",u),i=u.formattedText),o.push(i)}e.Sum=o[0],e.Avg=o[1],e.Min=o[2],e.Max=o[3]}}},{key:"clearFormula",value:function(e){this.parent.activeSheetIndex===e.sheetIdx&&(e.rowIdx="Row"===e.type?"insert"===e.status?e.rowIdx>=e.startIdx?e.rowIdx-e.count:e.rowIdx:e.rowIdx+e.count:e.rowIdx,e.colIdx="Column"===e.type?"insert"===e.status?e.colIdx>=e.startIdx?e.colIdx-e.count:e.colIdx:e.colIdx+e.count:e.colIdx);var t="!"+e.sheetIdx+"!"+Gr(-1===e.colIdx?e.colIdx+2:e.colIdx+1)+(-1===e.rowIdx?e.rowIdx+2:e.rowIdx+1);this.calculateInstance.getFormulaInfoTable().delete(t),this.calculateInstance.clearFormulaDependentCells(t)}},{key:"refreshFormula",value:function(e,t,i,n,r,a){var s,o,l,h,c,d,u,p=e,g=[],f=this.parent.getActiveSheet(),m=[],v=[];if(Sa(p)){if("delete"===i)for(h=1;h<=t;h++)m.push(r+h);for(v=this.parseFormula(p),h=0;h<v.length;h++)if(c=v[h].trim(),this.calculateInstance.isCellReference(c)){if((u=h&&v[h-1].trim())&&"!"===u[u.length-1]){if((u=u.replace(/['!]/g,""))!==f.name)continue}else if(0===parseInt(u,10)&&void 0===u[u.length-1]&&f.id-1!==a)continue;g=Wn(c),s="Column"===n?"insert"===i?g[3]+t:g[3]-t:"insert"===i?g[2]+t:g[2]-t,o="Column"===n?"insert"===i?g[1]+t:g[1]-t:"insert"===i?g[0]+t:g[0]-t,o="Column"===n?r>g[1]?g[1]:o:r>g[0]?g[0]:o,s="Column"===n?r>g[3]?g[3]:s:r>g[2]?g[2]:s,l=o>-1?"Column"===n?Xn([g[0],o,g[2],s]).split(":")[0]:Xn([o,g[1],s,g[3]]).split(":")[0]:"#REF!","delete"===i&&(d=parseInt(c.replace("Row"===n?/[A-Z]/g:/[0-9]/g,""),10),m.indexOf(d)>-1&&(l="#REF!")),v[h]=l}p="="+v.join("")}return p}},{key:"refreshDelete",value:function(e){for(var t,i,n,r,a,s,o,l,h,c,d,u=this,p=this.calculateInstance.getSheetFamilyItem(e.sheet.id.toString()),g=[],m=0;m<=e.sheet.usedRange.rowIndex;m++)for(var v=0;v<=e.sheet.usedRange.colIndex;v++)t=Kn(v+1)+(m+1),p.isSheetMember&&!Object(f.Z)(p.parentObjectToToken)&&(t=p.parentObjectToToken.get(e.sheet.id.toString())+t),this.calculateInstance.getDependentCells().has(t)&&[].slice.call(this.calculateInstance.getDependentCells().get(t)).forEach(function(e){u.calculateInstance.getFormulaInfoTable().has(e)&&u.calculateInstance.getFormulaInfoTable().delete(e),u.calculateInstance.clearFormulaDependentCells(e),-1===g.indexOf(e)&&g.push(e)});g.forEach(function(t){if(i=t.substring(0,t.lastIndexOf(u.calculateInstance.sheetToken)+1),p.tokenToParentObject.has(i)?void 0===(r=Za(u.parent,Number(p.tokenToParentObject.get(i))))&&(r=u.parent.activeSheetIndex):r=u.parent.activeSheetIndex,n=Ka(u.parent,r),a=Wn(t.substring(t.lastIndexOf(u.calculateInstance.sheetToken)+1)),"Row"===e.modelType){if(a[0]>=e.startIndex&&a[2]<=e.endIndex)return}else if(a[1]>=e.startIndex&&a[3]<=e.endIndex)return;if((o=Da(a[0],a[1],n)).formula&&Sa(o.formula)){l=u.parseFormula(o.formula,!0);for(var g=0;g<l.length;g++)h=l[g].trim(),u.calculateInstance.isCellReference(h)&&(s=Wn(h),"Row"===e.modelType?((c=s[0]-e.startIndex)>0&&(s[0]>e.endIndex?(c=e.endIndex-e.startIndex+1)>0&&(s[0]-=c):s[0]-=c),e.startIndex<=s[2]&&(s[2]-=e.endIndex<=s[2]?e.endIndex-e.startIndex+1:s[2]-e.startIndex+1),l[g]=s[2]<s[0]?u.calculateInstance.getErrorStrings()[Br.ref]:u.getAddress(s)):((c=s[1]-e.startIndex)>0&&(s[1]>e.endIndex?(c=e.endIndex-e.startIndex+1)>0&&(s[1]-=c):s[1]-=c),e.startIndex<=s[3]&&(s[3]-=e.endIndex<=s[3]?e.endIndex-e.startIndex+1:s[3]-e.startIndex+1),l[g]=s[3]<s[1]?u.calculateInstance.getErrorStrings()[Br.ref]:u.getAddress(s)));d="="+l.join(""),o.formula!==d&&(o.formula=d,o.value=null)}})}},{key:"getAddress",value:function(e){return e[0]===e[2]&&e[1]===e[3]?Yn(e[0],e[1]):Xn(e)}},{key:"refreshInsDelFormula",value:function(e){var t,i,n=this.parent.sheets.length;Object(f.Z)(e.activeSheetIndex)&&(e.activeSheetIndex=this.parent.activeSheetIndex);var r,a,s,o,l=this.parent.sheets[e.activeSheetIndex].name;if("delete"!==e.name)for(s=0;s<n;s++){t=e.model.length;for(var h=(r=[0,0,(i=this.parent.sheets[s]).usedRange.rowIndex,i.usedRange.colIndex])[2];h>=r[0];h--)if(!("Row"===e.modelType&&h>=e.startIndex&&h<=e.endIndex))for(var c=r[1];c<=r[3];c++)if(!("Column"===e.modelType&&h>=e.startIndex&&h<=e.endIndex)&&((a=Da(h,c,i))&&a.formula&&Sa(a.formula))){if(e.activeSheetIndex!==s&&!a.formula.includes(l))continue;this.clearFormula({rowIdx:h,colIdx:c,sheetIdx:s,count:t,status:e.name,type:e.modelType,startIdx:e.startIndex}),-1===(o=this.refreshFormula(a.formula,t,e.name,e.modelType,e.startIndex,s)).indexOf("UNIQUE")&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[h,c,h,c],value:o,sheetIndex:s})}}else this.refreshDelete(e)}},{key:"parseFormula",value:function(e,t){for(var i,n,r=0,a=[],s=[],o=(s=(s=this.markSpecialChar(e.replace("=",""),t)).split(t?/\(|\)|=|\^|>|<|,|\+|-|\*|\/|%|&/g:/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;r<o;)(i=s[r])?(1===i.length?a.push(this.isUniqueChar(i)?this.getUniqueCharVal(i):i):(n=i[0],i.indexOf("!")>0?(this.isUniqueChar(n)&&(a.push(this.getUniqueCharVal(n)),i=i.substr(1)),n=i.indexOf("!")+1,a.push(i.substr(0,n)),a.push(i.substr(n))):this.isUniqueChar(n)?(a.push(this.getUniqueCharVal(n)),a.push(i.substr(1))):a.push(i)),r++):r++;return a}},{key:"getUniqueCharVal",value:function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""}},{key:"isUniqueChar",value:function(e){var t=e.charCodeAt(e);return t>=129&&t<=142}},{key:"markSpecialChar",value:function(e,t){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),(e=(e=(e=(e=(e=(e=(e=t?e.replace(/,/g,","+this.uniqueCSeparator):e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)}},{key:"refreshNamedRange",value:function(e){var t=this;if(e.definedNames&&e.definedNames.length)e.definedNames.forEach(function(e){t.parent.removeDefinedName(e.name,e.scope),t.parent.addDefinedName(e)});else{var i=this.parent.definedNames.length;if(i)for(var n,r,a,s,o,l=Object.assign({},this.parent.definedNames),h=0;h<i;h++)if((r=(a=(s=l[h]).refersTo.split("!"))[0].split("=")[1])===e.sheet.name)if(n=Wn(a[1]),o=!1,"insert"===e.name)"Row"===e.modelType?(e.index<=n[0]&&(n[0]+=e.model.length,o=!0),e.index<=n[2]&&(n[2]+=e.model.length,o=!0)):"Column"===e.modelType&&(e.index<=n[1]&&(n[1]+=e.model.length,o=!0),e.index<=n[3]&&(n[3]+=e.model.length,o=!0)),this.updateDefinedNames(s,r,n,o);else if("Row"===e.modelType){var c=n[0]-e.startIndex;c>0&&(n[0]-=c,o=!0),e.startIndex<=n[2]&&(n[2]-=e.endIndex<=n[2]?e.deletedModel.length:n[2]-e.startIndex+1,o=!0),this.updateDefinedNames(s,r,n,o,[n[0],n[2]],e)}else if("Column"===e.modelType){var d=n[1]-e.startIndex;d>0&&(n[1]-=d,o=!0),e.startIndex<=n[3]&&(n[3]-=e.endIndex<=n[3]?e.deletedModel.length:n[3]-e.startIndex+1,o=!0),this.updateDefinedNames(s,r,n,o,[n[1],n[3]],e)}}}},{key:"updateDefinedNames",value:function(e,t,i,n,r,a){if(n){var s=this.parent.definedNames.indexOf(e);if(this.parent.removeDefinedName(e.name,e.scope),r){var o={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(o=new ya(this.parent,"definedNames",o,!0),a.definedNames?a.definedNames.push(o):a.definedNames=[o],r[1]<r[0])return}e.refersTo=t+"!"+Xn(i),this.parent.notify(pr,{action:"addDefinedName",definedName:e,isAdded:!1,index:s})}}}]),e}(),Kr=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("initiateSort",this.initiateSortHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("initiateSort",this.initiateSortHandler)}},{key:"initiateSortHandler",value:function(e){var t=this,i=e.args,n=new m.d,r=this.parent.getActiveSheet(),a=$n(Jn(i.range)),s=i.sortOptions||{sortDescriptors:{},containsHeader:!0},o=!1;if(e.promise=n.promise,a[0]>r.usedRange.rowIndex||a[1]>r.usedRange.colIndex)n.reject(this.parent.serviceLocator.getService(Ta).getConstant("SortOutOfRangeError"));else{var l=s.containsHeader;a[0]===a[2]&&(a=La(a[0],a[1],r),o=!0,Object(f.Z)(s.containsHeader)&&(l=typeof Da(a[0],a[1],r,null,!0).value!=typeof Da(a[0]+1,a[1],r,null,!0).value||!this.isSameStyle(Da(a[0],a[1],r,null,!0).style,Da(a[0]+1,a[1],r,null,!0).style))),!Object(f.Z)(i.sortOptions)&&!Object(f.Z)(i.sortOptions.containsHeader)||o||Object(f.Z)(Da(a[0],a[1],r))||Object(f.Z)(Da(a[0]+1,a[1],r))||(l=typeof Da(a[0],a[1],r).value!=typeof Da(a[0]+1,a[1],r).value);var h,c,d=a[0]=l?a[0]+1:a[0],u=Kn(Zn(r.activeCell)[1]+1),p=s.sortDescriptors,g=Xn(a);Na(this.parent,"".concat(r.name,"!").concat(g),!0).then(function(e){var o=new m.b(e),l=new m.h;if(Array.isArray(p)){p&&0!==p.length||(p=[{field:u}]);for(var f=p.length,v=f-1;v>-1;v--)if(p[f-1].field||(p[f-1].field=u),p[v].field){var y=p[v].sortComparer||t.sortComparer.bind(t,p[v],s.caseSensitive);l.sortBy(p[v].field,y)}}else{p||(p={field:u}),p.field||(p.field=u);var b=p.sortComparer||t.sortComparer.bind(t,p,s.caseSensitive);l.sortBy(p.field,b)}o.executeQuery(l).then(function(t){var s,o={};Array.prototype.forEach.call(t.result,function(t,i){if(t)for(h=a[1],c=a[3],d=parseInt(e[i].__rowIndex,10)-1;h<=c;h++)s=Kn(h+1),(o=t[s])&&o.formula&&(o.formula=Ea([d,h],[parseInt(t.__rowIndex,10)-1,h],r,o)),Ma(d,h,r,o)}),n.resolve({range:"".concat(r.name,"!").concat(g),sortOptions:i.sortOptions})})})}}},{key:"isSameStyle",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!0,n=Object.keys(e),r=0;r<n.length;r++){if(e[n[r]]!==t[n[r]]&&this.parent.cellStyle[n[r]]!==e[n[r]]){i=!1;break}i=!0}return i}},{key:"sortComparer",value:function(e,t,i,n){var r=e.order||"",a=m.c.fnSort(r),s={sensitivity:t?"case":"base"};if(i&&n&&("string"==typeof i.value||"string"==typeof n.value)){hr(i.value)&&(i.value=cr(i.value)),hr(n.value)&&(n.value=cr(n.value));var o=new Intl.Collator(this.parent.locale,s);return r&&"ascending"!==r.toLowerCase()?-1*o.compare(i.value,n.value):o.compare(i.value,n.value)}return null!==i&&!Object(f.Z)(i.value)||null!==n&&!Object(f.Z)(n.value)?null===i||Object(f.Z)(i.value)?1:null===n||Object(f.Z)(n.value)?-1:a(i?i.value:i,n?n.value:n):-1}},{key:"getModuleName",value:function(){return"workbookSort"}}]),e}(),Jr=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.filterRange=null,this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("initiateFilter",this.initiateFilterHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("initiateFilter",this.initiateFilterHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler))}},{key:"initiateFilterHandler",value:function(e){var t=this,i=e.args,n=new m.d,r=this.parent.getActiveSheet(),a=i.filterOptions||{};if(e.promise=n.promise,this.filterRange=i.range,a.datasource)this.setFilter(a.datasource,a.predicates),n.resolve({range:i.range,filterOptions:a});else{var s=$n(Jn(i.range));if(s[0]>r.usedRange.rowIndex||s[1]>r.usedRange.colIndex)return void n.reject("Select a cell or range inside the used range and try again.");s[0]===s[2]&&s[2]-s[0]==0&&(s[0]=0,s[1]=0,s[3]=r.usedRange.colIndex),s[2]=r.usedRange.rowIndex,s[0]=s[0]+1;var o=Xn(s);Na(this.parent,"".concat(r.name,"!").concat(o),!0,!0,null,null,null,null,!1).then(function(e){var i=new m.b(e);t.setFilter(i,a.predicates),n.resolve({range:o,filterOptions:a})})}}},{key:"setFilter",value:function(e,t){var i=this;if(e&&t){var n=e.dataSource.json,r=new m.h;t.length&&r.where(m.g.and(t));var a=e.executeLocal(r);n.forEach(function(e){if(e){var t=parseInt(e.__rowIndex,10);i.parent.hideRow(t-1,void 0,a.indexOf(e)<0),Object(f.Z)(i.parent.filteredRows)&&(i.parent.filteredRows={},i.parent.filteredRows.rowIdxColl=[],i.parent.filteredRows.sheetIdxColl=[]);var n=i.parent.filteredRows.rowIdxColl,r=i.parent.filteredRows.sheetIdxColl;if(a.indexOf(e)<0){if(n&&r)for(var s=0,o=r.length;s<o;s++)i.parent.activeSheetIndex===r[s]&&n[s]===t-1&&(n.splice(s,1),r.splice(s,1));n.push(t-1),r.push(i.parent.activeSheetIndex)}else if(n&&r)for(var l=0,h=r.length;l<h;l++)i.parent.activeSheetIndex===r[l]&&n[l]===t-1&&(n.splice(l,1),r.splice(l,1))}});var s=this.parent.getActiveSheet();(s.frozenColumns||s.frozenRows)&&this.parent.notify("dataRefresh",null)}}},{key:"clearAllFilterHandler",value:function(){if(this.filterRange){var e=Zn(this.filterRange),t=this.parent.getActiveSheet();this.parent.hideRow(e[0],t.usedRange.rowIndex,!1)}}},{key:"getModuleName",value:function(){return"workbookFilter"}}]),e}(),Qr=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"setImage",value:function(e){var t,i=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=e.range&&e.range.indexOf("!")>0?Wa(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,r=Wn(i),a=n?this.parent.sheets[n]:this.parent.getActiveSheet(),s=Da(r[0],r[1],a),o=e.options;if(s&&s.image){t=s.image;for(var l=0;l<o.length;l++)t.push(o[l])}Ma(r[0],r[1],a,{image:s&&s.image?t:o},!0)}},{key:"addEventListener",value:function(){this.parent.on("setImage",this.setImage,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("setImage",this.setImage)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"workbookImage"}}]),e}(),$r=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("setChart",this.setChartHandler,this),this.parent.on("refreshChart",this.refreshChartData,this),this.parent.on("deleteChartColl",this.deleteChartColl,this),this.parent.on("refreshChartSize",this.refreshChartSize,this),this.parent.on("focusChartBorder",this.focusChartBorder,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("setChart",this.setChartHandler),this.parent.off("refreshChart",this.refreshChartData),this.parent.off("deleteChartColl",this.deleteChartColl),this.parent.off("refreshChartSize",this.refreshChartSize),this.parent.off("focusChartBorder",this.focusChartBorder))}},{key:"setChartHandler",value:function(e){var t=0;e.isInitCell=!Object(f.Z)(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!Object(f.Z)(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!Object(f.Z)(e.isPaste)&&e.isPaste;var i=e.chart;if(i.length>0)for(;t<i.length;){if(!1===e.isCut&&document.getElementById(e.chart[t].id)&&(i[t]={range:i[t].range,id:"e_spreadsheet_chart_"+this.parent.chartCount,isSeriesInRows:i[t].isSeriesInRows,theme:i[t].theme,type:i[t].type},i[t].id="e_spreadsheet_chart_"+this.parent.chartCount,e.isIdAvailabe=!1),document.getElementById(e.chart[t].id))return;var n=!!Object(f.Z)(e.isIdAvailabe)||e.isIdAvailabe;if(i[t].theme=i[t].theme||"Material",i[t].type=i[t].type||"Line",i[t].isSeriesInRows=i[t].isSeriesInRows||!1,i[t].range=i[t].range||this.parent.getActiveSheet().selectedRange,i[t].range.indexOf("!")<0&&(i[t].range=this.parent.getActiveSheet().name+"!"+i[t].range),Object(f.Z)(i[t].id)&&(i[t].id="e_spreadsheet_chart_"+this.parent.chartCount,n=!1),i[t].height=i[t].height||290,i[t].width=i[t].width||480,this.parent.notify("initiateChart",{option:i[t],chartCount:this.parent.chartCount,isInitCell:e.isInitCell,isUndoRedo:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(i[t]),n||this.parent.chartCount++,!e.isInitCell||e.isPaste){var r=i[t].range&&i[t].range.indexOf("!")>0?Wa(this.parent,i[t].range.split("!")[0]):this.parent.activeSheetIndex,a=Wn(e.isPaste?e.range:i[t].range),s=r?this.parent.sheets[r]:this.parent.getActiveSheet(),o=Da(a[0],a[1],s);o&&o.chart?o.chart.push(i[t]):Ma(a[0],a[1],s,{chart:[i[t]]},!0)}t++}}},{key:"refreshChartData",value:function(e){for(var t,i=1,n=this.parent.sheets.length+1;i<n;){var r=this.parent.chartColl;if(t=r?r.length:0)for(;t--;){var a=this.parent.chartColl[t],s=Object(f.Z)(e.showHide)?Ia(Wn(a.range),e.rIdx,e.cIdx):this.inRowColumnRange(Wn(a.range),e.rIdx,e.showHide),o=a.range.indexOf("!")>-1?Wa(this.parent,Ga(a.range)):this.parent.activeSheetIndex;s&&o===this.parent.activeSheetIndex&&this.parent.notify("updateChart",{chart:a})}i++}}},{key:"inRowColumnRange",value:function(e,t,i){return"rows"===i?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]}},{key:"refreshChartSize",value:function(e){for(var t,i=1,n=this.parent.sheets.length+1;i<n;){var r=this.parent.chartColl;if(t=r?r.length:0)for(;t--;){var a=this.parent.chartColl[t];if(!Object(f.Z)(e.overlayEle.querySelector("#"+a.id))){var s=this.parent.element.querySelector("."+a.id),o=Object(f.N)(s,"chart");o&&(o.height=e.height,o.width=e.width)}}i++}}},{key:"focusChartBorder",value:function(e){for(var t=0;t<this.parent.chartColl.length;t++){var i=document.getElementById(e.id),n=document.getElementById(this.parent.chartColl[t].id);i&&n&&Object(f.D)(n,"."+i.classList[1])===i&&this.parent.notify("initiateChart",{option:this.parent.chartColl[t],chartCount:this.parent.chartCount,isRefresh:!0})}}},{key:"deleteChartColl",value:function(e){for(var t=0;t<this.parent.chartColl.length;t++){var i=document.getElementById(this.parent.chartColl[t].id),n=document.getElementById(e.id);n&&i&&Object(f.D)(i,"."+n.classList[1])===n&&this.parent.chartColl.splice(t,1)}}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"workbookChart"}}]),e}(),ea=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"format",value:function(e){var t,i=e.range;i&&"string"==typeof i&&i.indexOf("!")>-1?(i=i.split("!")[1],t=this.parent.sheets[Wa(this.parent,e.range.split("!")[0])]):t=this.parent.getActiveSheet(),void 0===i&&(i=t.selectedRange);var n="object"!=typeof i&&e.onActionUpdate,r={range:i,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(r.borderType=e.borderType);var a={};if(Object.assign(a,r.style,null,!0),n&&(this.parent.trigger("beforeCellFormat",r),this.parent.notify("actionBegin",{eventArgs:r,action:"format"}),r.cancel))e.cancel=!0;else{var s,o,l="object"==typeof r.range?r.range:$n(Wn(r.range));if(e.borderType&&(this.setTypedBorder(t,e.style.border,l,e.borderType,e.onActionUpdate),delete e.style.border),void 0!==r.style.borderTop){for(var h=l[1];h<=l[3];h++)this.checkAdjustantBorder(t,"borderBottom",l[0]-1,h),this.checkFullBorder(t,"borderBottom",l[0]-1,h),this.checkFullBorder(t,"borderTop",l[0],h),this.setCellBorder(t,{borderTop:r.style.borderTop},l[0],h,e.onActionUpdate,h===l[3]);delete r.style.borderTop}if(void 0!==r.style.borderBottom){for(var c=l[1];c<=l[3];c++)this.checkAdjustantBorder(t,"borderTop",l[2]+1,c),this.checkFullBorder(t,"borderTop",l[2]+1,c),this.checkFullBorder(t,"borderBottom",l[2],c),this.setCellBorder(t,{borderBottom:r.style.borderBottom},l[2],c,e.onActionUpdate,c===l[3]),this.setBottomBorderPriority(t,l[2],c);delete r.style.borderBottom}if(void 0!==r.style.borderLeft){for(var d=l[0];d<=l[2];d++)this.checkAdjustantBorder(t,"borderRight",d,l[1]-1),this.checkFullBorder(t,"borderRight",d,l[1]-1),this.checkFullBorder(t,"borderLeft",d,l[1]),this.setCellBorder(t,{borderLeft:r.style.borderLeft},d,l[1],e.onActionUpdate);delete r.style.borderLeft}if(void 0!==r.style.borderRight){for(var u=l[0];u<=l[2];u++)this.checkAdjustantBorder(t,"borderLeft",u,l[3]-1),this.checkFullBorder(t,"borderLeft",u,l[3]-1),this.checkFullBorder(t,"borderRight",u,l[3]),this.setCellBorder(t,{borderRight:r.style.borderRight},u,l[3],e.onActionUpdate);delete r.style.borderRight}if(Object.keys(e.style).length)for(var p=l[0];p<=l[2];p++)for(var g=l[1];g<=l[3];g++)void 0===o&&(void 0!==r.style.border?(s=r.style.border,r.style.border=void 0,o=!0):o=!1),o&&this.setFullBorder(t,s,l,p,g,e.onActionUpdate),this.setCellStyle(t,p,g,r.style),this.parent.getActiveSheet().id===t.id&&this.parent.notify(ur,{style:r.style,rowIdx:p,colIdx:g,lastCell:g===l[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate});o&&(r.style.border=s),this.parent.setUsedRange(l[2],l[3]),e.refreshRibbon&&this.parent.notify("activeCellChanged",null),n&&(r.style=a,r.range="".concat(t.name,"!").concat(i),this.parent.notify("actionComplete",{eventArgs:r,action:"format"}))}}},{key:"setBottomBorderPriority",value:function(e,t,i){if(cs(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,i]).borderTop&&(e.rows[t].cells[i].style.bottomPriority=!0)}}},{key:"setFullBorder",value:function(e,t,i,n,r,a){var s={};n===i[0]&&(this.checkAdjustantBorder(e,"borderBottom",n-1,r),this.checkFullBorder(e,"borderBottom",n-1,r)),r===i[1]&&(this.checkAdjustantBorder(e,"borderRight",n,r-1),this.checkFullBorder(e,"borderRight",n,r-1)),r===i[3]?(this.checkAdjustantBorder(e,"borderLeft",n,r+1),this.checkFullBorder(e,"borderLeft",n,r+1)):this.checkAdjustantBorder(e,"border",n,r+1),s.borderRight=t,s.borderTop=t,s.borderLeft=t,s.borderBottom=t,this.setCellBorder(e,s,n,r,a,r===i[3]),n===i[2]?(this.checkAdjustantBorder(e,"borderTop",n+1,r),this.checkFullBorder(e,"borderTop",n+1,r),this.setBottomBorderPriority(e,n,r)):this.checkAdjustantBorder(e,"border",n+1,r)}},{key:"checkAdjustantBorder",value:function(e,t,i,n){var r={};""!==this.parent.getCellStyleValue([t],[i,n])[t]&&(r[t]=void 0,this.setCellStyle(e,i,n,r))}},{key:"checkFullBorder",value:function(e,t,i,n){var r=this.parent.getCellStyleValue(["border"],[i,n]).border;if(""!==r){var a={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){e!==t&&(a[e]=r)}),this.setCellStyle(e,i,n,a)}}},{key:"textDecorationActionUpdate",value:function(e){var t=this.parent.getActiveSheet(),i={range:t.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",i),this.parent.notify("actionBegin",{eventArgs:i,action:"format"}),i.cancel)e.cancel=!0;else{var n,r=$n(Wn(t.selectedRange)),a=e.style.textDecoration,s=a,o=Wn(t.activeCell),l=this.parent.getCellStyleValue(["textDecoration"],o).textDecoration,h=!1;"underline"===l?s="underline"===a?"none":"underline line-through":"line-through"===l?s="line-through"===a?"none":"underline line-through":"underline line-through"===l&&(s="underline"===a?"line-through":"underline",h=!0),"none"===s&&(h=!0),this.format({style:{textDecoration:s},range:o,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var c=r[0];c<=r[2];c++)for(var d=r[1];d<=r[3];d++)if(c!==o[0]||d!==o[1]){if(n={},"none"===(l=this.parent.getCellStyleValue(["textDecoration"],[c,d]).textDecoration)){if(h)continue;n.textDecoration=a}else if("underline"===l||"line-through"===l)if(h){if(a!==l)continue;n.textDecoration="none"}else n.textDecoration=a!==l?"underline line-through":a;else if("underline line-through"===l){if(!h)continue;n.textDecoration="underline"===a?"line-through":"underline"}this.format({style:n,range:[c,d,c,d],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}i.range=t.name+"!"+i.range,this.parent.notify("actionComplete",{eventArgs:i,action:"format"})}}},{key:"setTypedBorder",value:function(e,t,i,n,r){var a;if("Outer"===n){for(var s=i[1];s<=i[3];s++)this.checkAdjustantBorder(e,"borderBottom",i[0]-1,s),this.checkFullBorder(e,"borderBottom",i[0]-1,s),this.setCellBorder(e,{borderTop:t},i[0],s,r,s===i[3]),this.checkAdjustantBorder(e,"borderTop",i[2]+1,s),this.checkFullBorder(e,"borderTop",i[2]+1,s),this.setCellBorder(e,{borderBottom:t},i[2],s,r,s===i[3],n),this.setBottomBorderPriority(e,i[2],s);for(var o=i[0];o<=i[2];o++)this.checkAdjustantBorder(e,"borderRight",o,i[1]-1),this.checkFullBorder(e,"borderRight",o,i[1]-1),this.setCellBorder(e,{borderLeft:t},o,i[1],r),this.checkAdjustantBorder(e,"borderLeft",o,i[3]+1),this.checkFullBorder(e,"borderLeft",o,i[3]+1),this.setCellBorder(e,{borderRight:t},o,i[3],r,null,n)}else if("Inner"===n)for(var l=i[0];l<=i[2];l++)for(var h=i[1];h<=i[3];h++){var c={};""!==(a=this.parent.getCellStyleValue(["border"],[l,h]).border)&&(c.border=void 0,h!==i[3]&&h!==i[1]&&l!==i[0]&&l!==i[2]||(l===i[0]&&(c.borderTop=a),l===i[2]&&(c.borderBottom=a),h===i[3]&&(c.borderRight=a),h===i[1]&&(c.borderLeft=a))),h!==i[3]&&(c.borderRight=t),l!==i[0]&&(c.borderTop=t),l!==i[2]&&(c.borderBottom=t),h!==i[1]&&(c.borderLeft=t),this.setCellBorder(e,c,l,h,r,h===i[3])}else if("Vertical"===n)for(var d=i[0];d<=i[2];d++)for(var u=i[1];u<=i[3];u++){var p={borderRight:t,borderLeft:t};u===i[1]&&(this.checkAdjustantBorder(e,"borderRight",d,u-1),this.checkFullBorder(e,"borderRight",d,u-1)),u===i[3]&&(this.checkAdjustantBorder(e,"borderLeft",d,u+1),this.checkFullBorder(e,"borderLeft",d,u+1)),this.setCellBorder(e,p,d,u,r)}else for(var g=i[0];g<=i[2];g++)for(var f=i[1];f<=i[3];f++){var m={borderTop:t,borderBottom:t};g===i[0]&&(this.checkAdjustantBorder(e,"borderBottom",g-1,f),this.checkFullBorder(e,"borderBottom",g-1,f)),this.setCellBorder(e,m,g,f,r,f===i[3]),g===i[2]&&(this.checkAdjustantBorder(e,"borderTop",g+1,f),this.checkFullBorder(e,"borderTop",g+1,f),this.setBottomBorderPriority(e,g,f))}}},{key:"setCellBorder",value:function(e,t,i,n,r,a,s){if(this.setCellStyle(e,i,n,t),this.parent.getActiveSheet().id===e.id){if("Outer"===s&&(t.borderBottom||t.borderRight)){var o={range:[i,n,i,n]};this.parent.notify(mr,o),i=o.range[0],n=o.range[1]}this.parent.notify(ur,{style:t,rowIdx:i,colIdx:n,onActionUpdate:r,first:"",lastCell:a,isHeightCheckNeeded:!0,manualUpdate:!0})}}},{key:"setCellStyle",value:function(e,t,i,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[i]||(e.rows[t].cells[i]={}),e.rows[t].cells[i].style||(e.rows[t].cells[i].style={}),Object.assign(e.rows[t].cells[i].style,n,null,!0)}},{key:"skipHiddenRows",value:function(e,t){return cs(e,++t)&&(t=this.skipHiddenRows(e,t)),t}},{key:"addEventListener",value:function(){this.parent.on(dr,this.format,this),this.parent.on("textDecorationUpdate",this.textDecorationActionUpdate,this),this.parent.on("clear",this.clearCellObj,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off(dr,this.format),this.parent.off("textDecorationUpdate",this.textDecorationActionUpdate),this.parent.off("clear",this.clearCellObj))}},{key:"clearCellObj",value:function(e){for(var t,i,n=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,r=e.range&&e.range.indexOf("!")>0?Wa(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,a=Ka(this.parent,r),s=Jn(n),o=s[0],l=s[2];o<=l;o++)for(t=s[1],i=s[3];t<=i;t++){var h=Da(o,t,a);if(h)switch(e.type){case"Clear Formats":delete h.format,delete h.rowSpan,delete h.style,delete h.wrap,delete h.colSpan;break;case"Clear Contents":h.hyperlink&&this.parent.notify("deleteHyperlink",{sheet:a,rowIdx:o,colIdx:t,preventRefresh:!0}),delete h.value,delete h.formula;break;case"Clear Hyperlinks":delete h.hyperlink;break;case"Clear All":Ma(o,t,a,{},!1)}}}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"workbookcellformat"}}]),e}(),ta=function(){function e(t){a(this,e),this.parent=t,this.localeObj=Object(f.T)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("workbookEditOperation",this.performEditOperation,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("workbookEditOperation",this.performEditOperation)}},{key:"getModuleName",value:function(){return"workbookEdit"}},{key:"performEditOperation",value:function(e){switch(e.action){case"updateCellValue":this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly)}}},{key:"checkDecimalPoint",value:function(e){if(Number(e)){var t=e.toString().indexOf(this.decimalSep)+1,i=e.toString().substr(t).length<=6;e=i?t<7?e:parseFloat(e).toFixed(0):t>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-t+2)}return e}},{key:"updateCellValue",value:function(e,t,i){var n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];void 0===i&&(i=this.parent.activeSheetIndex),n="string"==typeof e?Wn(e):e;var a=Ka(this.parent,i),s=Da(n[0],n[1],a,!0);if(s||(s=a.rows[n[0]].cells[n[1]]={}),r)t&&t.toString().indexOf(this.decimalSep)>-1&&(t=this.checkDecimalPoint(t)),s.value=t;else{var o=Sa(t);o="#SPILL!"===t||o;var l=!1;s.formula&&s.formula.indexOf("UNIQUE")>-1&&""===t&&(l=!0),o||l||(s.formula="",s.value=cr(t));var h={action:"refreshCalculate",value:t,rowIndex:n[0],colIndex:n[1],sheetIndex:i,isFormula:o};if("Text"!==br(s.format)){var c={value:t,rowIndex:n[0],colIndex:n[1],sheetIndex:i,updatedVal:""};this.parent.notify("checkDateFormat",c),!Object(f.Z)(c.updatedVal)&&c.updatedVal.length>0&&(s.value=c.updatedVal)}if("#SPILL!"===t)s.value=t;else{var d={cellIdx:n,isUnique:!1};this.parent.notify("checkUniqueRange",d),l||""===t||d.isUnique&&!(t.indexOf("UNIQUE")>-1)?t=s.value:this.parent.notify(pr,h),o&&(s.formula=h.value,t=s.value)}}this.parent.setUsedRange(n[0],n[1],a),this.parent.allowChart&&this.parent.notify("refreshChart",{cell:s,rIdx:n[0],cIdx:n[1],sheetIdx:i}),this.parent.allowConditionalFormat&&this.parent.notify("checkConditionalFormat",{rowIdx:n[0],colIdx:n[1],cell:s,isAction:!0})}}]),e}(),ia=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("setLinkModel",this.setLinkHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("setLinkModel",this.setLinkHandler)}},{key:"setLinkHandler",value:function(e){var t,i,n,r=e.hyperlink,a=e.cell,s=this.parent.getActiveSheet();if(a&&-1!==a.indexOf("!")){t=a.split("!");for(var o=this.parent.sheets,l=0;l<o.length;l++)o[l].name===t[0]&&(i=l);s=this.parent.sheets[i],a=t[1]}var h=Wn(a=a||this.parent.getActiveSheet().activeCell),c=h[0],d=h[1];s&&(Object(f.Z)(s.rows[c])&&(s.rows[c]={}),Object(f.Z)(s.rows[c].cells)&&(s.rows[c].cells=[]),Object(f.Z)(s.rows[c].cells[d])&&(s.rows[c].cells[d]={}),s.rows[c].cells[d].style?(s.rows[c].cells[d].style.textDecoration="underline",s.rows[c].cells[d].style.color="#00e"):s.rows[c].cells[d].style={textDecoration:"underline",color:"#00e"},"string"==typeof r?(0!==r.indexOf("http://")&&0!==r.indexOf("https://")&&0!==r.indexOf("ftp://")&&(n=r=0===r.toLowerCase().indexOf("www.")?"http://"+r:r),s.rows[c].cells[d].hyperlink=r):(0!==(n=r.address).indexOf("http://")&&0!==n.indexOf("https://")&&0!==n.indexOf("ftp://")&&(n=0===n.toLowerCase().indexOf("www.")?"http://"+n:n),s.rows[c].cells[d].hyperlink={address:n}))}},{key:"getModuleName",value:function(){return"workbookHyperlink"}}]),e}(),na=function(){function t(e){a(this,t),this.parent=e,this.addEventListener()}return o(t,[{key:"insertModel",value:function(t){var i=this;if("Column"===t.modelType){if("number"==typeof t.start)for(var n=0;n<=this.parent.getActiveSheet().usedRange.rowIndex+1;n++){var r={cellIdx:[n,t.start],isUnique:!1};if(this.parent.notify("checkUniqueRange",r),r.isUnique)return}}else if("Row"===t.modelType&&"number"==typeof t.start)for(var a=0;a<=this.parent.getActiveSheet().usedRange.colIndex+1;a++){var s={cellIdx:[t.start,a],isUnique:!1};if(this.parent.notify("checkUniqueRange",s),s.isUnique)return}if(t.model){var o,l,h,c,d=[];if("number"==typeof t.start){o=t.start,t.end=t.end||o,o>t.end&&(o=t.end,t.end=t.start);for(var u=o;u<=t.end;u++)d.push({})}else t.start?(o=t.start[0].index||0,d=t.start,h=!0):(o=0,d.push({}));if("Row"===t.modelType){var p;if(t.model=t.model,t.model.rows||(t.model.rows=[]),h&&t.model.usedRange.rowIndex>-1&&o>t.model.usedRange.rowIndex)for(var g=t.model.usedRange.rowIndex;g<o-1;g++)d.splice(0,0,{});o<this.parent.frozenRowCount(t.model)&&(this.parent.setSheetPropertyOnMute(t.model,"frozenRows",t.model.frozenRows+d.length),c=!0),(p=t.model.rows).splice.apply(p,[o,0].concat(e(d))),this.parent.setUsedRange(o>t.model.usedRange.rowIndex?o+(d.length-1):t.model.usedRange.rowIndex+d.length,t.model.usedRange.colIndex,t.model);for(var f=o+d.length,m=0;m<=t.model.usedRange.colIndex;m++)t.model.rows[f]&&t.model.rows[f].cells&&t.model.rows[f].cells[m]&&void 0!==t.model.rows[f].cells[m].rowSpan&&t.model.rows[f].cells[m].rowSpan<0&&void 0===t.model.rows[f].cells[m].colSpan&&this.parent.notify("insertMerge",{range:[f,m,f,m],insertCount:d.length,insertModel:"Row"})}else if("Column"===t.modelType){var v;t.model=t.model,t.model.columns||(t.model.columns=[]),(v=t.model.columns).splice.apply(v,[o,0].concat(e(d))),o<this.parent.frozenColCount(t.model)&&(this.parent.setSheetPropertyOnMute(t.model,"frozenColumns",t.model.frozenColumns+d.length),c=!0),this.parent.setUsedRange(t.model.usedRange.rowIndex,o>t.model.usedRange.colIndex?o+(d.length-1):t.model.usedRange.colIndex+d.length,t.model),t.model.rows||(t.model.rows=[]);var y=[];t.columnCellsModel||(t.columnCellsModel=[]);for(var b=0;b<d.length;b++)y.push(null);l=[];for(var C=0;C<=t.model.usedRange.rowIndex;C++){var x;t.model.rows[C]?t.model.rows[C].cells||(t.model.rows[C].cells=[]):t.model.rows[C]={cells:[]},o&&!t.model.rows[C].cells[o-1]&&(t.model.rows[C].cells[o-1]={}),(x=t.model.rows[C].cells).splice.apply(x,[o,0].concat(e(t.columnCellsModel[C]&&t.columnCellsModel[C].cells?t.columnCellsModel[C].cells:y)));var S=o+d.length;t.model.rows[C].cells[S]&&void 0!==t.model.rows[C].cells[S].colSpan&&t.model.rows[C].cells[S].colSpan<0&&void 0===t.model.rows[C].cells[S].rowSpan&&l.push({range:[C,S,C,S],insertCount:y.length,insertModel:"Column"})}l.forEach(function(e){i.parent.notify("insertMerge",e)})}else{if(void 0!==t.checkCount&&t.checkCount===this.parent.sheets.length)return;for(var w,k=d,I=0;I<k.length;I++)if(k[I].name)for(var O=0;O<this.parent.sheets.length;O++)if(k[I].name===this.parent.sheets[O].name){k.splice(I,1),I--;break}if(!k.length)return;delete d[0].index,this.parent.createSheet(o,d),t.activeSheetIndex?this.parent.setProperties({activeSheetIndex:t.activeSheetIndex},!0):!t.isAction&&t.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),d.forEach(function(e){h&&i.updateRangeModel(e.ranges),w=e.id,i.parent.notify(pr,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+w,index:w})})}var R={action:"refreshInsDelFormula",insertArgs:{model:d,startIndex:o,endIndex:o+d.length-1,modelType:t.modelType,name:"insert",activeSheetIndex:t.activeSheetIndex,sheetCount:this.parent.sheets.length,sheet:t.model}};"Sheet"!==t.modelType&&(this.parent.notify(pr,{action:"refreshNamedRange",insertArgs:{model:d,index:o,modelType:t.modelType,isAction:t.isAction,definedNames:t.definedNames,activeSheetIndex:t.activeSheetIndex,sheetCount:this.parent.sheets.length,name:"insert",sheet:t.model}}),this.parent.notify(pr,R),this.parent.notify("refreshClipboard",{start:o,end:o+d.length-1,modelType:t.modelType,model:t.model,isInsert:!0}),t.model!==this.parent.getActiveSheet())||this.parent.notify("insert",{model:d,index:o,modelType:t.modelType,isAction:t.isAction,sheet:t.model,activeSheetIndex:t.activeSheetIndex,sheetCount:this.parent.sheets.length,insertType:t.insertType,freezePane:c})}}},{key:"updateRangeModel",value:function(e){e.forEach(function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")})}},{key:"setInsertInfo",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Row",a=i=t+(i-1);e.ranges.forEach(function(e){e.info&&t<e.info[n]&&(e.info["insert".concat(r,"Range")]?e.info["insert".concat(r,"Range")].push([t,a]):e.info["insert".concat(r,"Range")]=[[t,a]],e.info[n]+=a-t+1)})}},{key:"addEventListener",value:function(){this.parent.on("insertModel",this.insertModel,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("insertModel",this.insertModel)}},{key:"getModuleName",value:function(){return"workbookinsert"}}]),t}(),ra=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"deleteModel",value:function(e){var t=this;if("Sheet"!==e.modelType||1!==this.parent.sheets.length){if("Column"===e.modelType){if("number"==typeof e.start)for(var i=0;i<=this.parent.getActiveSheet().usedRange.rowIndex+1;i++){var n={cellIdx:[i,e.start],isUnique:!1};if(this.parent.notify("checkUniqueRange",n),n.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(var r=0;r<=this.parent.getActiveSheet().usedRange.colIndex+1;r++){var a={cellIdx:[e.start,r],isUnique:!1};if(this.parent.notify("checkUniqueRange",a),a.isUnique)return}var s,o="".concat(e.modelType.toLowerCase(),"s");if(e.start=e.start,e.start>e.end){var l=e.start;e.start=e.end,e.end=l}var h,c,d=[],u=e.end-e.start+1,p={action:"refreshInsDelFormula",insertArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,name:"delete",activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,sheet:e.model}};if("Row"===e.modelType){if(this.parent.notify(pr,p),e.model=e.model,e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex),e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0);var g=this.parent.frozenRowCount(e.model);e.start<g&&(g=e.end<g?e.end-e.start+1:g-e.start,g=e.model.frozenRows-g,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",g),c=!0);var f,m,v=e.end+1;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(var y=0;y<=e.model.usedRange.colIndex;y++){if(e.model.rows[e.start].cells[y]&&void 0!==e.model.rows[e.start].cells[y].rowSpan&&e.model.rows[e.start].cells[y].rowSpan<0&&void 0===e.model.rows[e.start].cells[y].colSpan&&(m={range:[e.start,y,e.start,y]},this.parent.notify(mr,m),m.range=m.range,m.range[2]<=e.end&&((h=Da(m.range[0],y,e.model))&&h.rowSpan>1&&(h.rowSpan-(m.range[2]-e.start+1)>1?Ma(m.range[0],y,e.model,{colSpan:h.rowSpan-(m.range[2]-e.start+1)},!0):delete e.model.rows[m.range[0]].cells[y].rowSpan),m=null)),e.model.rows[v]&&e.model.rows[v].cells&&e.model.rows[v].cells[y]&&void 0!==e.model.rows[v].cells[y].rowSpan&&e.model.rows[v].cells[y].rowSpan<0&&void 0===e.model.rows[v].cells[y].colSpan&&(m||(m={range:[v,y,v,y]},this.parent.notify(mr,m)),f=new Object,m.range=m.range,Object.assign(f,Da(m.range[0],m.range[1],e.model)),f&&f.rowSpan&&(f.rowSpan>1||f.colSpan>1))){var b=[];b[1]=y,b[3]=f.colSpan>1?y+(f.colSpan-1):y,m.range=m.range,m.range[0]<e.start?(b[0]=b[2]=m.range[0],f.rowSpan-u>1&&(b[2]+=f.rowSpan-u-1)):(b[0]=b[2]=e.start,f.rowSpan-(e.end-m.range[0]+1)>1&&(b[2]+=f.rowSpan-(e.end-m.range[0]+1)-1)),d.push({range:b,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}m=null}}else if("Column"===e.modelType){if(this.parent.notify(pr,p),e.model=e.model,e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex),e.model.usedRange.colIndex-=u,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0);var C=this.parent.frozenColCount(e.model);e.start<C&&(C=e.end<C?e.end-e.start+1:C-e.start,C=e.model.frozenColumns-C,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",C),c=!0),s=[];for(var x,S,w=e.end+1,k=0;k<=e.model.usedRange.rowIndex;k++)if(s.push({}),e.model.rows[k]&&e.model.rows[k].cells){if(e.model.rows[k].cells[e.start]&&void 0!==e.model.rows[k].cells[e.start].colSpan&&e.model.rows[k].cells[e.start].colSpan<0&&void 0===e.model.rows[k].cells[e.start].rowSpan&&(S={range:[k,e.start,k,e.start]},this.parent.notify(mr,S),S.range=S.range,S.range[3]<=e.end)){var I=Da(k,S.range[1],e.model);I&&I.colSpan>1&&(I.colSpan-(S.range[3]-e.start+1)>1?Ma(k,S.range[1],e.model,{colSpan:I.colSpan-(S.range[3]-e.start+1)},!0):delete e.model.rows[k].cells[S.range[1]].colSpan),S=null}if(e.model.rows[k].cells[w]&&void 0!==e.model.rows[k].cells[w].colSpan&&e.model.rows[k].cells[w].colSpan<0&&void 0===e.model.rows[k].cells[w].rowSpan&&(S||(S={range:[k,w,k,w]},this.parent.notify(mr,S)),x=new Object,S.range=S.range,Object.assign(x,Da(S.range[0],S.range[1],e.model)),x&&x.colSpan&&(x.colSpan>1||x.rowSpan>1))){var O=[];O[0]=k,O[2]=x.rowSpan>1?k+(x.rowSpan-1):k,S.range=S.range,S.range[1]<e.start?(O[1]=O[3]=S.range[1],x.colSpan-u>1&&(O[3]+=x.colSpan-u-1)):(O[1]=O[3]=e.start,x.colSpan-(e.end-S.range[1]+1)>1&&(O[3]+=x.colSpan-(e.end-S.range[1]+1)-1)),d.push({range:O,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}s[k].cells=e.model.rows[k].cells.splice(e.start,u),S=null}}else if(e.end-e.start==this.parent.sheets.length-1)return;for(var R=[],A=e.start;A<=e.end;A++)"Sheet"===e.modelType&&this.parent.notify(pr,{action:"deleteSheetTab",sheetName:"",index:A+1}),e.model[o][e.start]||e.start<e.model[o].length?(R.push(e.model[o][e.start]||{}),e.model[o].splice(e.start,1)):R.push({}),A===e.start&&(R[0].index=e.start);d.forEach(function(e){t.parent.notify(fr,e)});var E={action:"refreshNamedRange",insertArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,isAction:e.isAction,deletedModel:R,deletedCellsModel:s,activeSheetIndex:this.parent.activeSheetIndex,name:"delete",sheet:e.model}};this.parent.notify("beforeDelete",e),"Sheet"!==e.modelType&&(this.parent.notify(pr,E),this.parent.notify("refreshClipboard",e),e.model!==this.parent.getActiveSheet())||this.parent.notify("delete",{startIndex:e.start,endIndex:e.end,modelType:e.modelType,definedNames:E.insertArgs.definedNames,isAction:e.isAction,deletedModel:R,deletedCellsModel:s,activeSheetIndex:this.parent.activeSheetIndex,freezePane:c,sheet:e.model})}}},{key:"setDeleteInfo",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Row",r=t-e+1,a=[];this.parent.getActiveSheet().ranges.forEach(function(s){s.info&&e<s.info[i]&&(s.info["delete".concat(n,"Range")]?s.info["delete".concat(n,"Range")].push([e,t]):s.info["delete".concat(n,"Range")]=[[e,t]],s.info[i]-=r,s.info["insert".concat(n,"Range")]&&(s.info["insert".concat(n,"Range")]=a))})}},{key:"addEventListener",value:function(){this.parent.on("deleteModel",this.deleteModel,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("deleteModel",this.deleteModel)}},{key:"getModuleName",value:function(){return"workbookdelete"}}]),e}(),aa=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("setValidation",this.addValidationHandler,this),this.parent.on("removeValidation",this.removeValidationHandler,this),this.parent.on("addHighlight",this.addHighlightHandler,this),this.parent.on("removeHighlight",this.removeHighlightHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("setValidation",this.addValidationHandler),this.parent.off("removeValidation",this.removeValidationHandler),this.parent.off("addHighlight",this.addHighlightHandler),this.parent.off("removeHighlight",this.removeHighlightHandler))}},{key:"addValidationHandler",value:function(e){this.ValidationHandler(e.rules,e.range,!1)}},{key:"removeValidationHandler",value:function(e){this.ValidationHandler(e.rules,e.range,!0)}},{key:"ValidationHandler",value:function(e,t,i){var n,r=t,a="";t.indexOf("!")>-1&&(r=t.split("!")[1],a=t.split("!")[0]);var s=Ka(this.parent,this.parent.getAddressInfo(a+"A1:A1").sheetIndex),o=!1,l=s.rowCount,h=r.split(":");r.match(/\D/g)&&!r.match(/[0-9]/g)?(h[0]+=1,h[1]+=l,r=h[0]+":"+h[1],o=!0):!r.match(/\D/g)&&r.match(/[0-9]/g)&&(h[0]="A"+h[0],h[1]=Yn(0,s.colCount-1).replace(/[0-9]/g,"")+h[1],r=h[0]+":"+h[1]),Object(f.Z)(a)||(t=a+r);var c=Wn(t=t||s.selectedRange);if(o)for(var d=c[1];d<=c[3];d++){var u=gs(s,d);i&&u&&u.validation?delete s.columns[d].validation:(Object(f.Z)(u)&&(s.columns[d]=gs(s,d)),s.columns[d].validation={operator:e.operator,type:e.type,value1:"List"===e.type&&e.value1.length>256?e.value1.substring(0,255):e.value1,value2:e.value2,inCellDropDown:e.inCellDropDown,ignoreBlank:e.ignoreBlank})}else for(var p=c[0];p<=c[2];p++){s.rows[p]||hs(s,p,{});for(var g=c[1];g<=c[3];g++)if(s.rows[p].cells&&s.rows[p].cells[g]||Ma(p,g,s,{}),n=s.rows[p].cells[g],i){if(n.validation){delete n.validation;var m=this.parent.getCellStyleValue(["backgroundColor","color"],[p,g]);this.parent.notify(ur,{style:m,rowIdx:p,colIdx:g})}}else n.validation={type:e.type,operator:e.operator,value1:"List"===e.type&&e.value1.length>256?e.value1.substring(0,255):e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown}}}},{key:"addHighlightHandler",value:function(e){this.InvalidDataHandler(e.range,!1,e.td,e.isclearFormat)}},{key:"removeHighlightHandler",value:function(e){this.InvalidDataHandler(e.range,!0)}},{key:"getRange",value:function(e){var t=Wn(e),i=this.parent.getActiveSheet(),n=i.colCount;return t[2]===i.rowCount-1&&0===t[0]?e=e.replace(/[0-9]/g,""):t[3]===n-1&&0===t[2]&&(e=e.replace(/\D/g,"")),e}},{key:"InvalidDataHandler",value:function(e,t,i,n){var r,a,s=this.parent.getActiveSheet(),o=(e=e||s.selectedRange)?Wn(e):[],l=!1;(e=this.getRange(e)).match(/\D/g)&&!e.match(/[0-9]/g)&&(l=!0);for(var h=e?o[0]:0,c=e?o[2]:s.rows.length;h<=c;h++)if(s.rows[h])for(var d=e?o[1]:0,u=e?o[3]:s.rows[h].cells.length;d<=u;d++){var p=void 0;if(s.rows[h].cells[d]){var g=gs(s,d);if((r=s.rows[h].cells[d])&&r.validation){if(p=r.validation,n&&!p.isHighlighted)return;t?p.isHighlighted&&(r.validation.isHighlighted=!1):r.validation.isHighlighted=!0}else if(g&&g.validation){if(p=g.validation,n&&!p.isHighlighted)return;t&&l?p.isHighlighted&&(g.validation.isHighlighted=!1):l&&(g.validation.isHighlighted=!0)}a=r.value?r.value:"";var f=[h,d],m=this.parent.activeSheetIndex;if(p&&this.parent.allowDataValidation){this.parent.notify("isValidation",{value:a,range:f,sheetIdx:m,isCell:!1});var v=this.parent.allowDataValidation;this.parent.allowDataValidation=!0,v||this.parent.notify("validationHighlight",{isRemoveHighlightedData:t,rowIdx:h,colIdx:d,td:i})}}}}},{key:"getModuleName",value:function(){return"workbookDataValidation"}}]),e}(),sa=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("findNext",this.findNext,this),this.parent.on("findPrevious",this.findPrevious,this),this.parent.on("replace",this.replace,this),this.parent.on("replaceAll",this.replaceAll,this),this.parent.on("count",this.totalCount,this),this.parent.on("findAllValues",this.findAllValues,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("findNext",this.findNext),this.parent.off("findPrevious",this.findPrevious),this.parent.off("replace",this.replace),this.parent.off("replaceAll",this.replaceAll),this.parent.off("count",this.totalCount),this.parent.off("findAllValues",this.findAllValues))}},{key:"findNext",value:function(e){var t,i,n,r=this.parent.sheets,a=r[this.parent.activeSheetIndex],s=Zn(a.activeCell),o=a.usedRange,l=o.colIndex,h=e.value.toString(),c=0,d=o.rowIndex,u=t=s[1],p=i=s[0];if(a.rows[i]&&a.rows[i].cells&&a.rows[i].cells[t]&&(a.rows[i].cells[t].format?n=this.parent.getDisplayText(a.rows[i].cells[t]).toString():a.rows[i].cells[t].value&&(n=a.rows[i].cells[t].value.toString())),n){var g=n.toLowerCase(),f=n.indexOf(e.value)>-1,m=g.indexOf(e.value.toString().toLowerCase())>-1;(h===n||h===g||f||m)&&("By Column"===e.searchBy?i++:t++,c++)}(s[0]>a.usedRange.rowIndex||s[1]>a.usedRange.colIndex)&&(s[0]>a.usedRange.rowIndex&&s[1]<=a.usedRange.colIndex?(i=0,t=s[1]):s[0]<=a.usedRange.rowIndex&&s[1]>a.usedRange.colIndex?(i=s[0],t=0):(i=0,t=0));var v={rowIndex:i,colIndex:t,usedRange:o,endRow:d,endColumn:l,startRow:p,mode:e.mode,loopCount:0,count:c,args:e,val:void 0,stringValue:h,sheetIndex:this.parent.activeSheetIndex,startColumn:u,sheets:r};"By Row"===e.searchBy&&this.findNxtRow(v),"By Column"===e.searchBy&&this.findNxtCol(v)}},{key:"findNxtRow",value:function(e){var t,i=e.sheets[e.sheetIndex],n=this.parent.sheets.length;t=i.usedRange;var r=Zn(i.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++);e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex++,n===e.sheetIndex&&(e.sheetIndex=0),a===e.sheetIndex&&0===e.count)return void this.parent.notify(gr,null);t=(i=e.sheets[e.sheetIndex]).usedRange,r=Zn(i.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=t.colIndex,e.endRow=t.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===r[0]&&0===r[1]){if(0===e.count)return void this.parent.notify(gr,null)}else(0!==r[0]&&0!==r[1]||0!==r[0]||0!==r[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=t.colIndex,e.endRow=r[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&t.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),i.rows[e.rowIndex]){for(var s=i.rows[e.rowIndex];e.colIndex<=e.endColumn;e.colIndex++)if(s&&s.cells&&s.cells[e.colIndex]&&this.nextCommon(e))return;if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&r[0]===e.rowIndex)return void this.parent.notify(gr,null)}}0!==e.count||this.parent.notify(gr,null)}},{key:"findNxtCol",value:function(e){var t,i=e.sheets[e.sheetIndex],n=Zn(i.activeCell),r=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++);e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,r===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(gr,null);i=e.sheets[e.sheetIndex],e.usedRange=i.usedRange,n=Zn(i.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===n[0]&&0===n[1]||n[1]>i.usedRange.rowIndex||n[0]>i.usedRange.colIndex){if(0===e.count)return void this.parent.notify(gr,null)}else(0!==n[1]||0!==n[0]||0!==n[1]&&0!==n[0])&&(e.startRow=0,e.startColumn=0,e.endRow=n[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++)if(i.rows[e.rowIndex]&&i.rows[e.rowIndex].cells&&i.rows[e.rowIndex].cells[e.colIndex]&&this.nextCommon(e))return;if(e.loopCount>0&&n[1]===e.colIndex)return void this.parent.notify(gr,null)}}0!==e.count||this.parent.notify(gr,null)}},{key:"nextCommon",value:function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var i=t.rows[e.rowIndex].cells[e.colIndex];if(i&&i.value){var n,r=t.rows[e.rowIndex].cells[e.colIndex];if(r)if(n=r.format?this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]):t.rows[e.rowIndex].cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(n===e.stringValue){var a=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:a}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var s=n.indexOf(e.args.value)>-1;if(n===e.stringValue||s){var o=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:o}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=n.toString().toLowerCase(),e.val===e.stringValue){var l=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:l}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=n.toString().toLowerCase();var h=e.val.indexOf(e.args.value.toString().toLowerCase())>-1,c=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||n===e.stringValue||h||n===e.stringValue||c){var d=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:d}),e.count++,!0}}}}return!1}},{key:"findPrevious",value:function(e){var t,i=this.parent.sheets,n=e.sheetIndex,r=i[n],a=Zn(r.activeCell),s=0,o=r.usedRange.rowIndex,l=r.usedRange.colIndex,h=e.value.toString(),c=a[1],d=a[0],u=c,p=d;if(r.rows[d]&&r.rows[d].cells[c]&&(r.rows[d].cells[c].format?t=this.parent.getDisplayText(r.rows[d].cells[c]).toString():r.rows[d].cells[c].value&&(t=r.rows[d].cells[c].value.toString())),t){var g=t.toLowerCase(),f=t.indexOf(e.value)>-1,m=g.indexOf(e.value.toString().toLowerCase())>-1;(h===t||h===g||f||m)&&("By Row"===e.searchBy&&c--,"By Column"===e.searchBy&&d--,s++)}(a[0]>r.usedRange.rowIndex||a[1]>r.usedRange.colIndex)&&(a[0]>r.usedRange.rowIndex&&a[1]<=r.usedRange.colIndex?(d=r.usedRange.rowIndex,c=a[1]):a[0]<=r.usedRange.rowIndex&&a[1]>r.usedRange.colIndex?(d=a[0],c=r.usedRange.colIndex):(d=r.usedRange.rowIndex,c=r.usedRange.colIndex));var v={rowIndex:d,colIndex:c,endRow:o,endColumn:l,startRow:p,loopCount:0,count:s,args:e,val:void 0,stringValue:h,sheets:i,sheetIndex:n,startColumn:u};"By Row"===e.searchBy&&this.findPreRow(v),"By Column"===e.searchBy&&this.findPreCol(v)}},{key:"findPreRow",value:function(e){var t,i=e.sheets[e.sheetIndex],n=this.parent.sheets.length,r=!1,a=Zn(i.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--);e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var s=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),s===e.sheetIndex&&0===e.count)return void this.parent.notify(gr,null);t=(i=e.sheets[e.sheetIndex]).usedRange,a=Zn(i.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}r=this.commonCondition(e,a)}if(!r){"Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=i.usedRange.rowIndex,e.colIndex=i.usedRange.colIndex);var o=i.rows[e.rowIndex];if(o){for(-1===e.colIndex&&(e.colIndex=i.usedRange.colIndex);e.colIndex>=0;e.colIndex--)if(o&&o.cells&&o.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&a[0]===e.rowIndex)return void this.parent.notify(gr,null)}}}r||0!==e.count||this.parent.notify(gr,null)}},{key:"findPreCol",value:function(e){for(var t,i=e.sheets[e.sheetIndex],n=this.parent.sheets.length,r=!1,a=Zn(i.activeCell);e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var s=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),s===e.sheetIndex&&0===e.count)return void this.parent.notify(gr,null);t=(i=e.sheets[e.sheetIndex]).usedRange,a=Zn(i.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}r=this.commonCondition(e,a)}if(!r){e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=i.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=i.usedRange.colIndex,e.rowIndex--);var o=i.rows[e.rowIndex];for(o&&i.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=i.usedRange.rowIndex);e.rowIndex>=0;e.rowIndex--){if(o&&o.cells&&o.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&a[1]===e.colIndex)return void this.parent.notify(gr,null)}}}r||0!==e.count||this.parent.notify(gr,null)}},{key:"commonCondition",value:function(e,t){var i,n=e.sheets[e.sheetIndex];return t[0]!==e.endRow&&t[1]!==e.endColumn||t[0]!==e.endRow||t[1]!==e.endColumn?(e.startColumn=n.usedRange.colIndex,e.startRow=n.usedRange.rowIndex,e.endColumn=0,e.endRow=t[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,i=!1):(t[0]===n.usedRange.rowIndex&&t[1]===n.usedRange.colIndex||t[0]>n.usedRange.rowIndex||t[1]>n.usedRange.colIndex)&&0!==t[0]&&0!==t[1]&&(this.parent.notify(gr,null),i=!0),i}},{key:"prevCommon",value:function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var i=t.rows[e.rowIndex].cells[e.colIndex];if(i&&i.value){var n,r=t.rows[e.rowIndex].cells[e.colIndex];if(r)if(n=r.format?this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex]):t.rows[e.rowIndex].cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(n===e.stringValue){var a=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:a}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var s=n.indexOf(e.args.value)>-1;if(n===e.stringValue||s){var o=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:o}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=n.toString().toLowerCase(),e.val===e.stringValue){var l=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:l}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=n.toString().toLowerCase();var h=e.val.indexOf(e.args.value.toString().toLowerCase())>-1,c=e.val.indexOf(e.args.value)>-1;if(n===e.stringValue||n===e.stringValue||h||e.val===e.stringValue||c){var d=t.name+"!"+Yn(e.rowIndex,e.colIndex);return this.parent.notify("gotoHandler",{address:d}),e.count++,!0}}}}return!1}},{key:"replace",value:function(e){if(this.parent.getActiveSheet().isProtected)this.parent.notify("editAlert",null);else{var t=this.parent.getActiveSheet(),i=Zn(t.activeCell),n=t.rows[i[0]].cells[i[1]].value.toString(),r=n.indexOf(e.value)>-1,a=n.toLowerCase().indexOf(e.value.toString().toLowerCase())>-1,s=n.toString().toLowerCase();n===e.value||r||s===e.value||a||(e.findOpt="next",this.findNext(e)),this.parent.getActiveSheet();var o,l=Zn(t.activeCell),h=t.activeCell,c=t.rows[l[0]].cells[l[1]],d=t.rows[l[0]].cells[l[1]].format,u=t.name+"!"+Yn(l[0],l[1]);o=d?this.parent.getDisplayText(t.rows[l[0]].cells[l[1]]).toString():t.rows[l[0]].cells[l[1]].value.toString(),this.parent.notify("findUndoRedo",{undoRedoOpt:"before",address:u,compareVal:o});var p=o.toLowerCase(),g=o.indexOf(e.value)>-1,f=p.indexOf(e.value)>-1;if(e.value===o||e.value===p)t.rows[l[0]].cells[l[1]].value=e.replaceValue,this.parent.updateCell(c,h),this.parent.notify("findUndoRedo",{address:u,compareVal:e.replaceValue,undoRedoOpt:"after"});else if(g){var m=o.replace(e.value,e.replaceValue);t.rows[l[0]].cells[l[1]].value=m,this.parent.updateCell(c,h),this.parent.notify("findUndoRedo",{address:u,compareVal:e.replaceValue,undoRedoOpt:"after"})}else if(f){var v=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),y=o.replace(v,e.replaceValue);t.rows[l[0]].cells[l[1]].value=y,this.parent.updateCell(c,h),this.parent.notify("findUndoRedo",{address:u,compareVal:e.replaceValue,undoRedoOpt:"after"})}}}},{key:"replaceAll",value:function(e){for(var t,i=0,n=this.parent.sheets[i],r=n.usedRange.rowIndex,a=0,s=0,o=n.usedRange.colIndex,l=0,h=[];s<=r;s++)if(l>o&&s===r&&"Workbook"===e.mode&&(i++,(n=this.parent.sheets[i])&&(l=0,s=0,o=n.usedRange.colIndex,r=n.usedRange.rowIndex)),n&&n.rows[s]){var c=n.rows[s];for(l===o+1&&(l=0);l<=o;l++){var d=n.rows[s].cells[l];if(c&&c.cells&&c.cells[l]&&c.cells[l].value){var u=n.rows[s].cells[l];if(u){var p=void 0;if(p=u.format?this.parent.getDisplayText(n.rows[s].cells[l]).toString():n.rows[s].cells[l].value.toString(),e.isCSen&&e.isEMatch)p===e.value&&(n.rows[s].cells[l].value=e.replaceValue,t=n.name+"!"+Yn(s,l),this.parent.updateCell(d,t),h.push(t),a++);else if(e.isCSen&&!e.isEMatch){var g=p.indexOf(e.value)>-1;if(p===e.value||g){var f=p.replace(e.value,e.replaceValue);n.rows[s].cells[l].value=f,t=n.name+"!"+Yn(s,l),this.parent.updateCell(d,t),h.push(t),a++}}else if(!e.isCSen&&e.isEMatch)p.toString().toLowerCase()===e.value&&(n.rows[s].cells[l].value=e.replaceValue,t=n.name+"!"+Yn(s,l),this.parent.updateCell(d,t),h.push(t),a++);else if(!e.isCSen&&!e.isEMatch){var m=p.toString().toLowerCase(),v=m.indexOf(e.value.toString().toLowerCase())>-1,y=m.indexOf(e.value)>-1;if(p===e.value||v||m===e.value||p===e.value||y){var b=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),C=p.replace(b,e.replaceValue);n.rows[s].cells[l].value=C,t=n.name+"!"+Yn(s,l),this.parent.updateCell(d,t),h.push(t),a++}}}}}}var x={undoRedoOpt:"beforeReplaceAll",Collection:h,replaceValue:e.value};this.parent.notify("findUndoRedo",x),x={undoRedoOpt:"afterReplaceAll",Collection:h,replaceValue:e.replaceValue},this.parent.notify("findUndoRedo",x),this.parent.notify("replaceAllDialog",{count:a,replaceValue:e.replaceValue})}},{key:"totalCount",value:function(e){for(var t=this.parent.sheets[e.sheetIndex],i=t.usedRange.rowIndex,n=0,r=0,a=t.usedRange.colIndex,s=0;r<=i;r++)if(t.rows[r]){var o=t.rows[r];for(s===a+1&&(s=0);s<=a;s++)if(o&&o.cells&&o.cells[s]&&o.cells[s].value){var l=t.rows[r].cells[s];if(l){var h=void 0;if(h=l.format?this.parent.getDisplayText(t.rows[r].cells[s]).toString():l.value.toString(),e.isCSen&&e.isEMatch)h===e.value&&n++;else if(e.isCSen&&!e.isEMatch){var c=h.indexOf(e.value)>-1;(h===e.value||c)&&n++}else if(!e.isCSen&&e.isEMatch)h.toString().toLowerCase()===e.value&&n++;else if(!e.isCSen&&!e.isEMatch){var d=h.toString().toLowerCase(),u=d.indexOf(e.value.toString().toLowerCase())>-1,p=d.indexOf(e.value)>-1;(d===e.value||h===e.value||u||h===e.value||p)&&n++}}}}var g=n;if((n=g-(this.requiredCount(e)-1))>g&&(n=g),0!==n){var f=Zn(t.activeCell),m=t.rows[f[0]]?this.parent.getDisplayText(t.rows[f[0]].cells[f[1]]).toString().toLowerCase():null;m&&-1===m.indexOf(e.value.toString().toLowerCase())&&(n-=1)}e.findCount=n+" of "+g}},{key:"requiredCount",value:function(e){for(var t=this.parent.sheets[this.parent.activeSheetIndex],i=Zn(t.activeCell),n=t.usedRange.rowIndex,r=0,a=i[0],s=t.usedRange.colIndex,o=i[1];a<=n;a++)if(t.rows[a]){var l=t.rows[a];for(o===s+1&&(o=0);o<=s;o++)if(l&&l.cells&&l.cells[o]&&l.cells[o].value&&t.rows[a].cells[o]){var h=void 0;if(h=t.rows[a].cells[o].format?this.parent.getDisplayText(t.rows[a].cells[o]).toString():t.rows[a].cells[o].value.toString(),e.isCSen&&!e.isEMatch){var c=h.indexOf(e.value)>-1;(h===e.value||c)&&r++}else if(e.isCSen&&e.isEMatch)h===e.value&&r++;else if(!e.isCSen&&e.isEMatch)h.toString().toLowerCase()===e.value&&r++;else if(!e.isCSen&&!e.isEMatch){var d=h.toString().toLowerCase(),u=e.value.toString().toLowerCase(),p=d.indexOf(u)>-1,g=d.indexOf(e.value)>-1;(h===e.value||d===u||p||d===e.value||g)&&r++}}}return r}},{key:"findAllValues",value:function(e){for(var t,i=e.sheetIndex,n=this.parent.sheets[i],r=n.usedRange.rowIndex,a=0,s=n.usedRange.colIndex,o=0,l=this.parent.sheets.length,h=e.sheetIndex;a<=r+1;a++){if(1!==h&&e.sheetIndex===l&&(i=1),a>r&&o>s&&"Workbook"===e.mode){if(h===++i)return;i>l-1&&(i=0),(n=this.parent.sheets[i])&&(a=0,o=0,s=n.usedRange.colIndex,r=n.usedRange.rowIndex)}if(!Object(f.Z)(n)&&n.rows[a]){var c=n.rows[a];for(o===s+2&&(o=0);o<=s+1;o++)if(c&&c.cells&&c.cells[o]){var d=n.rows[a].cells[o];if(d){var u=void 0;if(u=d.format?this.parent.getDisplayText(n.rows[a].cells[o]).toString():d.value.toString(),e.isCSen&&e.isEMatch)u===e.value&&(t=n.name+"!"+Yn(a,o),e.findCollection.push(t));else if(e.isCSen&&!e.isEMatch){var p=u.indexOf(e.value)>-1;(u===e.value||p)&&(t=n.name+"!"+Yn(a,o),e.findCollection.push(t))}else if(!e.isCSen&&e.isEMatch)u.toString().toLowerCase()===e.value&&(t=n.name+"!"+Yn(a,o),e.findCollection.push(t));else if(!e.isCSen&&!e.isEMatch){var g=u.toString().toLowerCase(),m=g.indexOf(e.value.toLowerCase())>-1;(g===e.value||u===e.value||m||u===e.value)&&(t=n.name+"!"+Yn(a,o),e.findCollection.push(t))}}}}}}},{key:"getModuleName",value:function(){return"workbookfindAndReplace"}}]),e}(),oa=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"protectsheetHandler",value:function(e){var t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"protectSettings",{selectCells:e.selectCells,formatCells:e.formatCells,formatColumns:e.formatColumns,formatRows:e.formatRows,insertLink:e.insertLink}),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"}),t.columns.forEach(function(e){e&&Object(f.cb)(e.isLocked)&&(e.isLocked=!0)})}},{key:"unprotectsheetHandler",value:function(e){var t=this.parent.getActiveSheet();e.sheet&&(t=this.parent.sheets[e.sheet]),t.protectSettings.formatCells=t.protectSettings.formatColumns=!1,t.protectSettings.formatRows=t.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(t,"isProtected",!1),this.parent.notify("protectSheet",t.protectSettings),this.parent.notify("updateToggleItem",{props:"Protect"})}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("protectsheetHandler",this.protectsheetHandler,this),this.parent.on("unprotectsheetHandler",this.unprotectsheetHandler,this),this.parent.on("setLockCells",this.lockCells,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("protectsheetHandler",this.protectsheetHandler),this.parent.off("setLockCells",this.lockCells),this.parent.off("protectsheetHandler",this.unprotectsheetHandler))}},{key:"lockCells",value:function(e){var t,i=this.parent.getActiveSheet(),n="object"==typeof(t=e?e.range:i.selectedRange)?t:$n(Wn(t));if(0===n[0]&&n[2]===i.rowCount-1)for(var r=n[1];r<=n[3];r++)fs(i,r,{isLocked:e.isLocked});for(var a=n[0];a<=n[2];a++)for(var s=n[1];s<=n[3];s++)this.parent.getActiveSheet().id===i.id&&this.parent.notify("applyLockCells",{rowIdx:a,colIdx:s,isLocked:e.isLocked})}},{key:"getModuleName",value:function(){return"workbookProtectSheet"}}]),e}(),la=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"merge",value:function(e){e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=Wn(e.range)),e.range=$n(e.range),e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify("activeCellChanged",null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"});var t=e.sheet||this.parent.getActiveSheet();this.parent.sheets.indexOf(t)===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{address:t.selectedRange,skipChecking:!0})}},{key:"mergeAll",value:function(e){var t,i,n,r=0;e.range=e.range;for(var a,s=e.sheet||this.parent.getActiveSheet(),o=e.range[0];o<=e.range[2];o++){i=0,e.isAction&&e.model.push({cells:[]});for(var l=e.range[1];l<=e.range[3];l++){if((t=Da(o,l,s))&&(t.value||t.formula)&&!n&&(n=t.formula||t.value),e.isAction&&e.merge&&(e.model[o-e.range[0]].cells[l-e.range[1]]={},Object(f.L)(e.model[o-e.range[0]].cells[l-e.range[1]],t,null,!0)),s.rows[o]&&s.rows[o].cells&&s.rows[o].cells[l]&&(delete s.rows[o].cells[l].rowSpan,delete s.rows[o].cells[l].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[o-e.range[0]]&&e.model[o-e.range[0]].cells[l-e.range[1]]&&e.model[o-e.range[0]].cells[l-e.range[1]]!=={}&&Ma(o,l,s,e.model[o-e.range[0]].cells[l-e.range[1]])),e.merge){if(t=new Object,o===e.range[0]&&l===e.range[1]){e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(t.rowSpan=e.range[2]-e.range[0]+1),Ma(e.range[0],e.range[1],s,t,!0);continue}o!==e.range[0]&&(t.rowSpan=-r),l!==e.range[1]&&(i++,t.colSpan=-i),s.rows[o]&&s.rows[o].cells&&s.rows[o].cells[l]&&(delete s.rows[o].cells[l].value,delete s.rows[o].cells[l].formula),a=Da(o,l,s)||{},Ma(o,l,s,Object.assign(t,a))}e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:o,colIdx:l})}r++}e.merge&&(t=this.getCellValue(e.range[0],e.range[1],n,s),Ma(e.range[0],e.range[1],s,t,!0),e.preventRefresh||this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[1]}))}},{key:"mergeHorizontally",value:function(e){var t,i;e.range=e.range;for(var n,r,a,s=e.sheet||this.parent.getActiveSheet(),o=e.range[0];o<=e.range[2];o++){t=0,e.isAction&&e.model.push({cells:[]});for(var l=e.range[1];l<=e.range[3];l++){if(a=Da(o,l,s),i=new Object,e.isAction&&(e.model[o-e.range[0]].cells[l-e.range[1]]={},Object.assign(e.model[o-e.range[0]].cells[l-e.range[1]],a)),l===e.range[1]){if(o===e.range[0])continue;r=o-1,s.rows[r]&&s.rows[r].cells&&s.rows[r].cells[l]&&delete s.rows[r].cells[l].rowSpan,i=this.getCellValue(r,l,n,s),e.range[3]-e.range[1]>0&&(i.colSpan=e.range[3]-e.range[1]+1),n=null,Ma(r,l,s,i,!0)}else a&&(a.value||a.formula)&&!n&&(n=a.formula||a.value),r=o,s.rows[r]&&s.rows[r].cells&&s.rows[r].cells[l]&&(delete s.rows[r].cells[l].rowSpan,delete s.rows[r].cells[l].value,delete s.rows[r].cells[l].formula),t++,i.colSpan=-t,Ma(r,l,s,i,!0);this.parent.notify("applyMerge",{rowIdx:r,colIdx:l})}}s.rows[e.range[2]]&&s.rows[e.range[2]].cells&&s.rows[e.range[2]].cells[e.range[1]]&&delete s.rows[e.range[2]].cells[e.range[1]].rowSpan,i=this.getCellValue(e.range[2],e.range[1],n,s),e.range[3]-e.range[1]>0&&(i.colSpan=e.range[3]-e.range[1]+1),Ma(e.range[2],e.range[1],s,i,!0),this.parent.notify("applyMerge",{rowIdx:e.range[2],colIdx:e.range[1]})}},{key:"getCellValue",value:function(e,t,i,n){var r=new Object,a=Da(e,t,n);return!i||a&&(a.value||a.formula)||(Sa(i)?r.formula=i:r.value=i),r}},{key:"mergeVertically",value:function(e){var t=0;e.range=e.range;for(var i,n,r,a,s=e.sheet||this.parent.getActiveSheet(),o=e.range[1];o<=e.range[3];o++)for(var l=e.range[0];l<=e.range[2];l++){if(a=Da(l,o,s),e.isAction&&(void 0===e.model[l-e.range[0]]&&(e.model[l-e.range[0]]={cells:[]}),e.model[l-e.range[0]].cells[o-e.range[1]]={},Object.assign(e.model[l-e.range[0]].cells[o-e.range[1]],a)),l===e.range[0]){if(t=0,o===e.range[1])continue;r=o-1,s.rows[l]&&s.rows[l].cells&&s.rows[l].cells[r]&&delete s.rows[l].cells[r].colSpan,i=this.getCellValue(l,r,n,s),e.range[2]-e.range[0]>0&&(i.rowSpan=e.range[2]-e.range[0]+1),n=null,Ma(l,r,s,i,!0)}else i=new Object,a&&(a.value||a.formula)&&!n&&(n=a.formula||a.value),t++,r=o,s.rows[l]&&s.rows[l].cells&&s.rows[l].cells[r]&&(delete s.rows[l].cells[r].colSpan,delete s.rows[l].cells[r].value,delete s.rows[l].cells[r].formula),i.rowSpan=-t,Ma(l,r,s,i,!0);this.parent.notify("applyMerge",{rowIdx:l,colIdx:r})}s.rows[e.range[0]]&&s.rows[e.range[0]].cells&&s.rows[e.range[0]].cells[e.range[3]]&&delete s.rows[e.range[0]].cells[e.range[3]].colSpan,i=this.getCellValue(e.range[0],e.range[1],n,s),e.range[2]-e.range[0]>0&&(i.rowSpan=e.range[2]-e.range[0]+1),Ma(e.range[0],e.range[3],s,i,!0),this.parent.notify("applyMerge",{rowIdx:e.range[0],colIdx:e.range[3]})}},{key:"activeCellRange",value:function(e){e.range=e.range;var t=this.parent.getActiveSheet(),i=Da(e.range[0],e.range[1],t);i&&(!Object(f.Z)(i.rowSpan)&&i.rowSpan<0&&(e.range[0]+=i.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!Object(f.Z)(i.colSpan)&&i.colSpan<0&&(e.range[1]+=i.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(i=Da(e.range[0],e.range[1],t))&&(i.rowSpan>1&&(e.range[0]+(i.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(i.rowSpan-1)),i.colSpan>1&&(e.range[1]+(i.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(i.colSpan-1))))}},{key:"mergedRange",value:function(e){"string"==typeof e.range&&(e.range=Wn(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)}},{key:"forward",value:function(e){e.range=e.range;var t,i,n,r,a=e.sheet||this.parent.getActiveSheet(),s=Da(e.range[0],e.range[1],a),o=t=e.range[0],l=i=e.range[1];if(s&&(!Object(f.Z)(s.rowSpan)&&s.rowSpan<0&&(o=t=e.range[0]+s.rowSpan),!Object(f.Z)(s.colSpan)&&s.colSpan<0&&(l=i=e.range[1]+s.colSpan),(s=Da(o,l,a))&&(s.rowSpan>1&&(t+=s.rowSpan-1,o+(s.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=o+(s.rowSpan-1))),s.colSpan>1&&(i+=s.colSpan-1,l+(s.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=l+(s.colSpan-1))))),e.range[0]=o,e.range[1]=l,e.range[0]===o&&e.range[1]===l&&e.range[2]===t&&e.range[3]===i&&(e.isActiveCell=!0),!e.skipChecking){for(var h=e.range[1];h<=e.range[3];h++)(s=Da(e.range[2],h,a))&&(o=e.range[2],l=h,!Object(f.Z)(s.colSpan)&&s.colSpan<0&&((l+=s.colSpan)<e.range[1]&&(e.range[1]=l)),!Object(f.Z)(s.rowSpan)&&s.rowSpan<0&&((o+=s.rowSpan)<e.range[0]&&(e.range[0]=o)),(s=Da(o,l,a))&&(s.colSpan>1&&l+(s.colSpan-1)>e.range[3]&&(e.range[3]=l,e.range[3]=l+(s.colSpan-1)),s.rowSpan>1&&o+(s.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(s.rowSpan-1))));for(var c=e.range[1];c<=e.range[3];c++)(s=Da(e.range[0],c,a))&&(r=c,n=e.range[0],!Object(f.Z)(s.colSpan)&&s.colSpan<0&&((r+=s.colSpan)<e.range[1]&&(e.range[1]=r)),!Object(f.Z)(s.rowSpan)&&s.rowSpan<0&&((n+=s.rowSpan)<e.range[0]&&(e.range[0]=n)));for(var d=e.range[0];d<=e.range[2];d++)(s=Da(d,e.range[3],a))&&(o=d,l=e.range[3],!Object(f.Z)(s.rowSpan)&&s.rowSpan<0&&((o+=s.rowSpan)<e.range[0]&&(e.range[0]=o)),!Object(f.Z)(s.colSpan)&&s.colSpan<0&&((l+=s.colSpan)<e.range[1]&&(e.range[1]=l)),(s=Da(o,l,a))&&(s.rowSpan>1&&o+(s.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(s.rowSpan-1)),s.colSpan>1&&l+(s.colSpan-1)>e.range[3]&&(e.range[3]=l,e.range[3]=l+(s.colSpan-1))))}}},{key:"forwardReverse",value:function(e){var t=this.parent.getActiveSheet();e.range=e.range;var i,n,r,a,s=e.range[1],o=Da(e.range[0],e.range[1],t),l=e.range[0];if(o&&(!Object(f.Z)(o.colSpan)&&o.colSpan<0&&(s+=o.colSpan,e.range[3]>=s&&(e.range[3]=s)),!Object(f.Z)(o.rowSpan)&&o.rowSpan<0&&((l+=o.rowSpan)<e.range[0]&&(e.range[0]=l)),(o=Da(l,s,t))&&(o.rowSpan>1&&l+(o.rowSpan-1)>=e.range[2]&&(e.range[2]=l+(o.rowSpan-1)),o.colSpan>1&&s+(o.colSpan-1)>=e.range[1]&&(e.range[1]=s+(o.colSpan-1)))),e.range[0]=l,!e.skipChecking){for(var h=e.range[3];h<=e.range[1];h++)(o=Da(e.range[2],h,t))&&(n=h,i=e.range[2],!Object(f.Z)(o.rowSpan)&&o.rowSpan<0&&((i+=o.rowSpan)<e.range[0]&&(e.range[0]=i)),!Object(f.Z)(o.colSpan)&&o.colSpan<0&&((n+=o.colSpan)<e.range[3]&&(e.range[3]=n)),(o=Da(i,n,t))&&(o.rowSpan>1&&i+(o.rowSpan-1)>e.range[2]&&(e.range[2]=i+(o.rowSpan-1)),o.colSpan>1&&n+(o.colSpan-1)>e.range[1]&&(e.range[1]=n+(o.colSpan-1))));for(var c=e.range[3];c<=e.range[1];c++)(o=Da(e.range[0],c,t))&&(n=c,r=e.range[0],!Object(f.Z)(o.rowSpan)&&o.rowSpan<0&&((r+=o.rowSpan)<e.range[0]&&(e.range[0]=r)),!Object(f.Z)(o.colSpan)&&o.colSpan<0&&(n+=o.colSpan),(o=Da(r,n,t))&&(o.rowSpan>1&&r+(o.rowSpan-1)>e.range[2]&&(e.range[2]=r+(o.rowSpan-1)),o.colSpan>1&&n+(o.colSpan-1)>e.range[1]&&(e.range[1]=n,e.range[1]=n+(o.colSpan-1))));for(var d=e.range[0];d<=e.range[2];d++)(o=Da(d,e.range[3],t))&&(r=d,a=e.range[3],!Object(f.Z)(o.rowSpan)&&o.rowSpan<0&&((r+=o.rowSpan)<e.range[0]&&(e.range[0]=r)),!Object(f.Z)(o.colSpan)&&o.colSpan<0&&((a+=o.colSpan)<e.range[3]&&(e.range[3]=a)),(o=Da(r,a,t))&&(o.rowSpan>1&&r+(o.rowSpan-1)>e.range[2]&&(e.range[2]=r,e.range[2]=r+(o.rowSpan-1)),o.colSpan>1&&a+(o.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(o.colSpan-1))))}}},{key:"reverse",value:function(e){e.range=e.range;var t=e.range[1],i=e.sheet||this.parent.getActiveSheet(),n=Da(e.range[0],e.range[1],i),r=e.range[0];n&&(!Object(f.Z)(n.colSpan)&&n.colSpan<0&&(t+=n.colSpan),!Object(f.Z)(n.rowSpan)&&n.rowSpan<0&&(r+=n.rowSpan),e.range[2]>=r&&(e.range[2]=r,e.isActiveCell=!0),e.range[3]>=t?(e.range[3]=t,e.range[2]===r&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(n=Da(r,t,i))&&(n.rowSpan>1&&r+(n.rowSpan-1)>=e.range[0]&&(e.range[0]=r,e.range[0]=r+(n.rowSpan-1)),n.colSpan>1&&t+(n.colSpan-1)>=e.range[1]&&(e.range[1]=t,e.range[1]=t+(n.colSpan-1))));var a,s,o=e.range[3];if(!e.skipChecking){for(var l=e.range[3];l<=e.range[1];l++)(n=Da(e.range[2],l,i))&&(o=l,r=e.range[2],!Object(f.Z)(n.rowSpan)&&n.rowSpan<0&&((r+=n.rowSpan)<e.range[2]&&(e.range[2]=r)),!Object(f.Z)(n.colSpan)&&n.colSpan<0&&((o+=n.colSpan)<e.range[3]&&(e.range[3]=o)),(n=Da(r,o,i))&&(n.rowSpan>1&&r+(n.rowSpan-1)>e.range[0]&&(e.range[0]=r,e.range[0]=r+(n.rowSpan-1)),n.colSpan>1&&o+(n.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(n.colSpan-1))));o=e.range[3];for(var h=e.range[3];h<=e.range[1];h++)(n=Da(e.range[0],h,i))&&(o=h,r=e.range[0],!Object(f.Z)(n.colSpan)&&n.colSpan<0&&(o+=n.colSpan),!Object(f.Z)(n.rowSpan)&&n.rowSpan<0&&(r+=n.rowSpan),(n=Da(r,o,i))&&(n.colSpan>1&&o+(n.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(n.colSpan-1)),n.rowSpan>1&&r+(n.rowSpan-1)>e.range[0]&&(e.range[0]=r,e.range[0]=r+(n.rowSpan-1))));for(var c=e.range[2];c<=e.range[0];c++)(n=Da(c,e.range[3],i))&&(s=c,a=e.range[3],!Object(f.Z)(n.rowSpan)&&n.rowSpan<0&&((s+=n.rowSpan)<e.range[2]&&(e.range[2]=s)),!Object(f.Z)(n.colSpan)&&n.colSpan<0&&((a+=n.colSpan)<e.range[3]&&(e.range[3]=a)),(n=Da(s,a,i))&&(n.rowSpan>1&&s+(n.rowSpan-1)>e.range[0]&&(e.range[0]=s,e.range[0]=s+(n.rowSpan-1)),n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(n.colSpan-1))))}}},{key:"reverseForward",value:function(e){e.range=e.range;var t=e.sheet||this.parent.getActiveSheet(),i=e.range[0],n=e.range[1],r=Da(e.range[0],e.range[1],t);if(r&&(!Object(f.Z)(r.rowSpan)&&r.rowSpan<0&&(i+=r.rowSpan,e.range[2]>=i&&(e.range[2]=i)),!Object(f.Z)(r.colSpan)&&r.colSpan<0&&(n+=r.colSpan),(r=Da(i,n,t))&&(r.rowSpan>1&&i+(r.rowSpan-1)>=e.range[0]&&(e.range[0]=i,e.range[0]=i+(r.rowSpan-1)),r.colSpan>1&&n+(r.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=n+(r.colSpan-1)))),!e.skipChecking){for(var a,s,o,l,h=e.range[3],c=e.range[1];c<=e.range[3];c++)(r=Da(e.range[2],c,t))&&(a=e.range[2],h=c,!Object(f.Z)(r.rowSpan)&&r.rowSpan<0&&((a+=r.rowSpan)<e.range[2]&&(e.range[2]=a)),!Object(f.Z)(r.colSpan)&&r.colSpan<0&&((h+=r.colSpan)<e.range[1]&&(e.range[1]=h)),(r=Da(a,h,t))&&(r.colSpan>1&&h+(r.colSpan-1)>e.range[3]&&(e.range[3]=h+(r.colSpan-1)),r.rowSpan>1&&r.rowSpan-1+a>e.range[0]&&(e.range[0]=r.rowSpan-1+a)));for(var d=e.range[1];d<=e.range[3];d++)(r=Da(e.range[0],d,t))&&(o=d,s=e.range[0],!Object(f.Z)(r.colSpan)&&r.colSpan<0&&((o+=r.colSpan)<e.range[1]&&(e.range[1]=o)),!Object(f.Z)(r.rowSpan)&&r.rowSpan<0&&(s+=r.rowSpan),(r=Da(s,o,t))&&r.rowSpan>1&&s+(r.rowSpan-1)>e.range[0]&&(e.range[0]=s+(r.rowSpan-1)));for(var u=e.range[2];u<=e.range[0];u++)(r=Da(u,e.range[3],t))&&(a=u,l=e.range[3],!Object(f.Z)(r.rowSpan)&&r.rowSpan<0&&((a+=r.rowSpan)<e.range[2]&&(e.range[2]=a)),!Object(f.Z)(r.colSpan)&&r.colSpan<0&&((l+=r.colSpan)<e.range[1]&&(e.range[1]=l)),(r=Da(a,l,t))&&(r.rowSpan>1&&r.rowSpan-1+a>e.range[0]&&(e.range[0]=r.rowSpan-1+a),r.colSpan>1&&r.colSpan-1+l>e.range[3]&&(e.range[3]=l,e.range[3]=r.colSpan-1+l)))}}},{key:"insertHandler",value:function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)}},{key:"pasteHandler",value:function(e){for(var t,i,n,r=this.parent.getActiveSheet(),a=Zn(r.activeCell),s=e.range[0],o=0;s<=e.range[2];s++,o++)for(var l=e.range[1],h=0;l<=e.range[3];l++,h++){if((t=Da(s,l,e.prevSheet)||{}).rowSpan>1&&(n=Da(a[0]+(t.rowSpan-1),a[1],r)||{},i=Da(a[0]+1,a[1],r)||{},void 0!==n.colSpan&&n.colSpan<0||void 0!==i.colSpan&&i.colSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0});if(t.colSpan>1&&(n=Da(a[0],a[1]+(t.colSpan-1),r)||{},i=Da(a[0],a[1]+1,r)||{},void 0!==n.rowSpan&&n.rowSpan<0||void 0!==i.rowSpan&&i.rowSpan<0))return e.cancel=!0,void this.parent.notify("applyMerge",{showDialog:!0})}}},{key:"addEventListener",value:function(){this.parent.on(fr,this.merge,this),this.parent.on("mergedRange",this.mergedRange,this),this.parent.on(mr,this.activeCellRange,this),this.parent.on("insertMerge",this.insertHandler,this),this.parent.on("pasteMerge",this.pasteHandler,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off(fr,this.merge),this.parent.off("mergedRange",this.mergedRange),this.parent.off(mr,this.activeCellRange),this.parent.off("insertMerge",this.insertHandler),this.parent.off("pasteMerge",this.pasteHandler))}},{key:"getModuleName",value:function(){return"workbookmerge"}}]),e}(),ha=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("setCFRule",this.setCFrulHandler,this),this.parent.on("clearCFRule",this.clearRules,this),this.parent.on("cFUndo",this.cFUndoHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("setCFRule",this.setCFrulHandler),this.parent.off("clearCFRule",this.clearRules),this.parent.off("cFUndo",this.cFUndoHandler))}},{key:"setCFrulHandler",value:function(e){var t=e.conditionalFormat,i=t.range,n=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(i).sheetIndex,r=Ka(this.parent,n),a=$n(Wn(i=i||r.selectedRange));if(t.range=Xn(a),r.conditionalFormats||this.parent.setSheetPropertyOnMute(r,"conditionalFormats",[]),r.conditionalFormats[r.conditionalFormats.length]=t,e.isUndoRedo&&n!==this.parent.activeSheetIndex)this.parent.notify("gotoHandler",{address:r.name+"!"+t.range});else for(var s=a[0];s<=a[2];s++){r.rows[s]||hs(r,s,{});for(var o=a[1];o<=a[3];o++)r.rows[s].cells&&r.rows[s].cells[o]||Ma(s,o,r,{}),n===this.parent.activeSheetIndex&&this.parent.notify("cFInitialCheck",{rowIdx:s,colIdx:o,cell:r.rows[s].cells[o],conditionalFormat:t,isAction:e.isAction})}}},{key:"clearRules",value:function(e){var t,i,n,r,a,s,o,l,h=!!Object(f.Z)(e.isPublic),c=[],d=[],u=!0,p=e.range,g=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(p).sheetIndex,m=Ka(this.parent,g),v=m.conditionalFormats,y=Wn(p);if(g===this.parent.activeSheetIndex)for(var b=y[0];b<=y[2];b++)for(var C=y[1];C<=y[3];C++)this.parent.notify("clearCF",{rIdx:b,cIdx:C});if(v){for(var x=v.length-1;x>=0;x--){var S=!1,w="",k=v[x],I=k.range.split(",");if(g===this.parent.activeSheetIndex&&(e.isClearCF||!e.isUndoRedo))for(var O=0;O<I.length;O++){var R=!1,A=Wn(I[O]);o=A[0],l=A[0],a=A[1],s=A[1],A[0]>=y[0]&&A[2]<=y[2]&&A[1]>=y[1]&&A[3]<=y[3]&&(R=!0);for(var E=A[0];E<=A[2];E++){for(var L=0,T=A[1];T<=A[3];T++)for(var j=y[0];j<=y[2];j++)for(var D=y[1];D<=y[3];D++)if(j===E&&D===T){var M=this.parent.getCellStyleValue(["backgroundColor","color"],[j,D]);this.parent.notify(ur,{style:M,rowIdx:j,colIdx:D,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0}),L+=1,S=!0,j===A[0]?D===A[3]?a===A[1]?s===D?s=D:a=D-1:a!==A[1]&&s+1===D?(s=A[1],a-=1):a!==A[1]&&s===A[1]&&(a=y[1]-1):D===A[1]?s===A[1]&&(s=D+1):a===A[1]&&s===A[1]?(a=D,s=D):s=a===A[1]&&s!==A[1]?D+1:D:D===A[1]?s===A[1]&&A[1]!==A[3]&&(s=D+1):D===A[3]?a===A[1]?s===D?s=D:a=D-1:a!==A[1]&&s===A[1]?a=y[1]-1:a!==A[1]&&s+1===D?(s=A[1],a=y[1]-1):l=j:a===A[1]&&s===A[1]?(a=D,s=D):s!==A[1]&&a!==A[1]?s=D:a!==A[1]&&s===A[1]?a=D:s=D+1}L>0&&!R?(u&&(t=o,i=l,n=a,r=s),a===A[1]&&s!==A[1]?s===A[3]?(o!==E&&(w=w+" "+Xn([o,n,i,A[3]])),a===A[1]&&s===A[3]&&(E===A[2]?A[1]===y[3]&&(w=w+" "+Xn([E,s,E,A[3]])):(y[2]===A[0]&&s!==A[3]&&(w=w+" "+Xn([E,s,E,A[3]])),o=E+1,l=E+1,s=A[1]))):r!==s?(w=w+" "+Xn([o,r,E-1,A[3]]),s===A[3]&&a===A[1]?(o=E+1,l=E+1,s=A[1]):(o=E,l=E),s===A[3]&&a!==A[1]&&(a=A[1])):n!==a?(w=w+" "+Xn([o,A[1],E-1,n]),o=E+1,l=E+1,a=A[1],s=A[1]):E===A[2]?w=w+" "+Xn([o,s,E,A[3]]):(l<E||a===A[1]&&s===A[3])&&(l=E):s===A[1]&&a!==A[1]?(r!==s&&(w=w+" "+Xn([o,r,E-1,A[3]]),o=E,l=E),n!==a&&(w=w+" "+Xn([o,n,E-1,A[3]]),o=E,l=E),E===A[2]?w=w+" "+Xn([o,s,E,a]):l=E):s!==A[1]&&a!==A[1]?E===A[2]&&A[2]===y[0]?A[0]===A[2]?w=(w=w+" "+Xn([o,A[1],l,a-1]))+" "+Xn([o,s+1,l,A[3]]):w=(w=(w=w+" "+Xn([o,A[1],l,A[3]]))+" "+Xn([A[2],A[1],A[2],a-1]))+" "+Xn([A[2],s+1,A[2],A[3]]):E===A[2]?w=(w=w+" "+Xn([o,A[1],E,a-1]))+" "+Xn([o,s+1,E,A[3]]):(n===A[1]&&r===A[1]&&(w=w+" "+Xn([o,n,l,A[3]]),o=E),l=E):a===A[1]&&s===A[1]&&(y[2]!==A[0]?(A[2]>=y[2]&&E>y[2]&&(w=w+" "+Xn([o,a,l,A[3]])),A[1]===A[3]&&E<=A[2]&&t!==A[2]&&E!==t&&(w=w+" "+Xn([o,a,l,A[3]])),A[1]===A[3]&&(o=E+1,l=E+1)):((E===A[2]||E===A[0]&&A[1]!==A[3])&&(w=w+" "+Xn([o,a,l,s])),o=E+1,l=E+1),E===A[2]&&A[0]!==A[2]&&A[1]!==A[3]&&(w=w+" "+Xn([E,a,E,s]))),u||(t=o,i=l<=A[2]?l:A[2],n=a,r=s<=A[3]?s:A[3]),u=!1):R||(u&&(t=o,i=l,n=a,r=s),a===A[1]&&s===A[1]&&(E===A[2]&&(w=w+" "+Xn([o,a,E,A[3]])),l=E),s!==A[1]&&a!==A[1]&&(w=(w=w+" "+Xn([o,A[1],E-1,a-1]))+" "+Xn([o,s+1,E-1,A[3]]),o=E,l=E,a=A[1],s=A[1]),s!==A[1]&&a===A[1]&&(w=w+" "+Xn([o,s,E-1,A[3]]),o=E,l=E,a=A[1],s=A[1]),a!==A[1]&&s===A[1]&&(w=w+" "+Xn([o,s,E-1,a]),o=E,l=E,a=A[1],s=A[1]),u||(t=o,i=l<=A[2]?l:A[2],n=a,r=s<=A[3]?s:A[3]),u=!1)}}if(""===w?(d.push(m.conditionalFormats[x].range),m.conditionalFormats.splice(x,1)):(d.push(m.conditionalFormats[x].range),m.conditionalFormats[x].range=w.trim().replace(" ",",")),S&&!h&&(k.range=w.trim().replace(" ",","),c.push(k)),e.isUndoRedo){this.parent.activeSheetIndex!==e.sheetIdx&&this.parent.notify("gotoHandler",{address:m.name+"!"+e.range});break}}h||this.parent.notify(Rr,{eventArgs:{cFormats:c,oldRange:d,selectedRange:p,sheetIdx:g},action:"clearCF"}),e.isclearFormat||this.parent.notify("addHighlight",{range:p,isclearFormat:!0})}}},{key:"cFUndoHandler",value:function(e){if(e.sheetIdx===this.parent.activeSheetIndex)for(var t=e.conditionalFormat,i=t.range.split(","),n=Ka(this.parent,e.sheetIdx),r=0;r<i.length;r++)for(var a=Wn(i[r]),s=a[0];s<=a[2];s++)for(var o=a[1];o<=a[3];o++)this.parent.notify("cFInitialCheck",{rowIdx:s,colIdx:o,cell:n.rows[s].cells[o],conditionalFormat:t,isAction:!0})}},{key:"getModuleName",value:function(){return"workbookConditionalFormatting"}}]),e}();function ca(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowDataValidation&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),t}var da,ua,pa,ga,fa,ma=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},va=(fa=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),ma([Object(f.t)("Calibri")],fa.prototype,"fontFamily",void 0),ma([Object(f.t)("bottom")],fa.prototype,"verticalAlign",void 0),ma([Object(f.t)("left")],fa.prototype,"textAlign",void 0),ma([Object(f.t)("0pt")],fa.prototype,"textIndent",void 0),ma([Object(f.t)("#000000")],fa.prototype,"color",void 0),ma([Object(f.t)("#ffffff")],fa.prototype,"backgroundColor",void 0),ma([Object(f.t)("normal")],fa.prototype,"fontWeight",void 0),ma([Object(f.t)("normal")],fa.prototype,"fontStyle",void 0),ma([Object(f.t)("11pt")],fa.prototype,"fontSize",void 0),ma([Object(f.t)("none")],fa.prototype,"textDecoration",void 0),ma([Object(f.t)("")],fa.prototype,"border",void 0),ma([Object(f.t)("")],fa.prototype,"borderTop",void 0),ma([Object(f.t)("")],fa.prototype,"borderBottom",void 0),ma([Object(f.t)("")],fa.prototype,"borderLeft",void 0),ma([Object(f.t)("")],fa.prototype,"borderRight",void 0),fa),ya=(ga=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),ma([Object(f.t)("")],ga.prototype,"name",void 0),ma([Object(f.t)("")],ga.prototype,"scope",void 0),ma([Object(f.t)("")],ga.prototype,"comment",void 0),ma([Object(f.t)("")],ga.prototype,"refersTo",void 0),ga),ba=(pa=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),ma([Object(f.t)(!1)],pa.prototype,"selectCells",void 0),ma([Object(f.t)(!1)],pa.prototype,"formatCells",void 0),ma([Object(f.t)(!1)],pa.prototype,"formatRows",void 0),ma([Object(f.t)(!1)],pa.prototype,"formatColumns",void 0),ma([Object(f.t)(!1)],pa.prototype,"insertLink",void 0),pa),Ca=(ua=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),ma([Object(f.t)("General")],ua.prototype,"format",void 0),ma([Object(f.g)({},va)],ua.prototype,"style",void 0),ma([Object(f.t)(!0)],ua.prototype,"isLocked",void 0),ua),xa=(da=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),ma([Object(f.t)("GreaterThan")],da.prototype,"type",void 0),ma([Object(f.g)({},Ca)],da.prototype,"format",void 0),ma([Object(f.t)("RedFT")],da.prototype,"cFColor",void 0),ma([Object(f.t)("")],da.prototype,"value",void 0),ma([Object(f.t)("")],da.prototype,"range",void 0),da);function Sa(e,t){return e&&"="===e[0]&&(e.length>1||t)}function wa(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var i=t.split(":");if(Aa(i[0])&&Aa(i[1]))return!0}else if(t.indexOf(":")<0&&Aa(t))return!0;return!1}function ka(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function Ia(e,t,i){return e&&t>=e[0]&&t<=e[2]&&i>=e[1]&&i<=e[3]}function Oa(e,t,i){var n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(i){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function Ra(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function Aa(e){for(var t=e,i=0,n=0,r=[89,71,69],a="",s=t.length,o=0;o<s;o++)ka(t[o])&&i++;var l=(a=t.substring(0,i)).length;if(l!==s&&l<4&&1!==s&&isNaN(parseInt(t,10))){for(;n<l;){if(!(a[n]&&a[n].charCodeAt(0)<r[n])){if(!a[n]&&n>0)break;return!1}n++}var h=parseFloat(t.substring(i,s));if(h>0&&h<1048577)return!0}return!1}function Ea(e,t,i,n){var r,a;if(t&&(r=(a=n||Da(t[0],t[1],i,!1,!0)).formula?a.formula.toUpperCase():""),r){0===r.indexOf("=")&&(r=r.slice(1));for(var s,o=["+","-","*","/",">=","<=","<>",">","<","=","%"],l=r=r.split("(").join(",").split(")").join(","),h=0;h<o.length;h++)s=l.split(o[h]),l=s.join(",");s=l.split(",");for(var c,d,u,p=[],g=0;g<s.length;g++)if(wa(s[g])){var f=Wn(s[g]),m=[e[0]-(t[0]-f[0]),e[1]-(t[1]-f[1]),e[0]-(t[0]-f[2]),e[1]-(t[1]-f[3])];m[0]<0||m[1]<0||m[2]<0||m[3]<0?c="#REF!":(c=Yn(m[0],m[1]),s[g].includes(":")&&(c+=":"+Yn(m[2],m[3])),c=wa(c)?c:"#REF!"),(d={})[s[g]]=c,s[g].includes(":")?p.splice(0,0,d):p.push(d)}r=a.formula;for(var v=0;v<p.length;v++)u=Object.keys(p[v])[0],r=r.replace(new RegExp(u,"gi"),p[v][u].toUpperCase());return r}return null}function La(e,t,i){for(var n,r,a,s,o,l,h=e,c=e,d=t,u=t,p=1;!s&&Da(e+p,t,i,null,!0).value?c=e+p:s=!0,!a&&Da(e-p,t,i,null,!0).value?h=e-p:a=!0,!a||!s;p++);for(var g=1;;g++){n=d,r=u;for(var f=h;f<=c;f++)if(!o&&Da(f,d-1,i,null,!0).value&&(d=n-1),!l&&Da(f,u+1,i,null,!0).value&&(u=r+1),f===c&&(d===n&&(o=!0),u===r&&(l=!0)),l&&o)return[h,d,c,u]}}var Ta="spreadsheetLocale",ja={SortOutOfRangeError:"Select a cell or range inside the used range and try again."};function Da(e,t,i,n,r){var a=ls(i,e);if(!a||!a.cells){if(!n)return r?{}:null;a?i.rows[e].cells=[]:i.rows[e]={cells:[]}}return i.rows[e].cells[t]||(r?{}:null)}function Ma(e,t,i,n,r){i.rows[e]?i.rows[e].cells||(i.rows[e].cells=[]):i.rows[e]={cells:[]},r&&i.rows[e].cells[t]?Object(f.L)(i.rows[e].cells[t],n,null,!0):i.rows[e].cells[t]=n}function Fa(e,t){var i={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},n={};return Object.keys(t?i:e).forEach(function(t){e[t]!==i[t]&&(n[t]=e[t])}),n}function Pa(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,n=i.getAddressInfo(e),r=n.indices,a=Ka(i,n.sheetIndex),s=r[0];s<=r[2];s++)for(var o=r[1];o<=r[3];o++)Ma(s,o,a,{wrap:t},!0);i.setProperties({sheets:i.sheets},!0),n.sheetIndex===i.activeSheetIndex&&i.notify("wrapText",{range:r,wrap:t,sheet:a})}function Na(e,t,i,n,r,a,s,o){var l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return new Promise(function(h,c){var d,u,p,g,f,m,v,y,b;h((p=new Map,g=t.indexOf("!")>-1?Wa(e,Ga(t)):e.activeSheetIndex,f=Ka(e,g),m=Jn(t),v=m[0],y=0,b={sheet:f,indexes:m,formulaCellRef:s,sheetIndex:o,promise:new Promise(function(e,t){e(void 0)})},e.notify("updateSheetFromDataSource",b),b.promise.then(function(){for(var t=e.frozenRowCount(f),s=e.frozenColCount(f);v<=m[2];){var o={};for(u=ls(f,v),d=m[1];d<=m[3];){if(i){if(l&&cs(f,v)&&!a){v++;continue}p instanceof Map&&(p=[]);var h=Kn(d+1);if(n)o[h]=u?Ba(e,v,d,g,f):"";else{var c=u?Da(v,d,f):null;(c&&(c.formula||c.value)||Object.keys(o).length)&&(o[h]=c)}m[3]<d+1&&Object.keys(o).length&&(o.__rowIndex=(v+1).toString()),p[y.toString()]=o}else{var b={cell:Da(v,d,f),address:Yn(v,d),rowIndex:v,colIndex:d};e.trigger("queryCellInfo",b);var C={};if(Object.assign(C,u?Da(v,d,f):null),C.colSpan>1&&C.rowSpan>1)for(var x=void 0,S=v,w=v+C.rowSpan;S<w;S++)for(var k=d,I=d+C.colSpan;k<I;k++)S===v&&k===d||(x=new Object,S!==v&&(x.rowSpan=v-S),k!==d&&(x.colSpan=d-k),f.rows[S]&&f.rows[S].cells&&f.rows[S].cells[k]&&(delete f.rows[S].cells[k].value,delete f.rows[S].cells[k].formula),Ma(S,k,f,x,!0));else if(C.colSpan>1)for(var O=d+1,R=d+C.colSpan;O<R;O++)Ma(v,O,f,{colSpan:d-O},!0),f.rows[v]&&f.rows[v].cells&&f.rows[v].cells[O]&&(delete f.rows[v].cells[O].value,delete f.rows[v].cells[O].formula);else if(C.rowSpan>1)for(var A=v+1,E=v+C.rowSpan;A<E;A++)Ma(A,d,f,{rowSpan:v-A},!0),f.rows[A]&&f.rows[A].cells&&f.rows[A].cells[d]&&(delete f.rows[A].cells[d].value,delete f.rows[A].cells[d].formula);if(!n&&cs(f,v)){v++;continue}if(!n&&ys(f,d)){d++;continue}if(!n&&r&&r.length){if(v>=t&&v<r[0]){v++;continue}if(d>=s&&d<r[1]){d++;continue}}if(C.style){var L={};Object.assign(L,C.style),C.style=L}p.set(b.address,C)}d++}v++,y++,i&&!Object.keys(o).length&&(y--,p.pop())}return p})))})}function Ba(e,t,i,n,r){var a=Da(t,i,r);if(a){if(a.format){var s={value:e.getDisplayText(a),rowIndex:t,colIndex:i,sheetIndex:n,dateObj:"",isDate:!1,isTime:!1};return e.notify("checkDateFormat",s),s.isDate?s.dateObj:a.value}return a.value}return""}function Ha(e,t,i){for(var n,r,a=0,s=e.length,o=0;o<s;o++){if(Object(f.Z)(e[o])||Object(f.cb)(e[o].index)||(r=a=e[o].index-o,delete e[o].index),a>0){for(n=0;a--;)t?(i.createSheet(o+n),n++):e.splice(o,0,null);o+=r,s+=r}t&&function(){e[o].id<1&&(e[o].id=Qa(i.sheets),e[o].properties&&(e[o].properties.id=e[o].id)),e[o].name||i.setSheetPropertyOnMute(e[o],"name","Sheet"+Ja(i));var t=0;e[o].rows.forEach(function(e){t=Math.max(t,e&&e.cells&&e.cells.length-1||0)}),i.setSheetPropertyOnMute(e[o],"usedRange",{rowIndex:e[o].rows.length?e[o].rows.length-1:0,colIndex:t})}()}}var _a,za,Va=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ua=(za=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"setProperties",value:function(e,t){var n=this;if(this.parentObj.isComplexArraySetter&&this.controlParent&&this.controlParent.isAngular)if(Object.keys(e).length){void 0===this.parentObj.currRangeIdx?this.parentObj.currRangeIdx=0:this.parentObj.currRangeIdx+=1;var a=this.parentObj.ranges[this.parentObj.currRangeIdx];a&&a.info&&(this.info=a.info),setTimeout(function(){void 0!==n.parentObj.currRangeIdx&&delete n.parentObj.currRangeIdx})}else if(this.controlParent.tagObjects[0].instance&&this.controlParent.tagObjects[0].instance.hasChanges&&!this.controlParent.tagObjects[0].instance.isInitChanges){var s=this.controlParent.sheets.indexOf(this.parentObj);if(void 0===this.parentObj.changedRangeIdx){for(var o,l=this.controlParent.tagObjects[0].instance.list[s].tagObjects,h=0;h<l.length;h++)if("ranges"===l[h].name){l[h].instance.list.forEach(function(e,t){e.hasChanges&&(o=t)});break}this.parentObj.changedRangeIdx=o}}r(p(i.prototype),"setProperties",this).call(this,e,t)}}]),i}(f.e),Va([Object(f.t)(null)],za.prototype,"dataSource",void 0),Va([Object(f.t)("A1")],za.prototype,"startCell",void 0),Va([Object(f.t)(null)],za.prototype,"query",void 0),Va([Object(f.t)(!0)],za.prototype,"showFieldAsHeader",void 0),Va([Object(f.t)("")],za.prototype,"template",void 0),Va([Object(f.t)("A1")],za.prototype,"address",void 0),za),qa=(_a=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Va([Object(f.t)(null)],_a.prototype,"rows",void 0),Va([Object(f.t)([])],_a.prototype,"columns",void 0),Va([Object(f.g)({},ba)],_a.prototype,"protectSettings",void 0),Va([Object(f.f)([],Ua)],_a.prototype,"ranges",void 0),Va([Object(f.f)([],xa)],_a.prototype,"conditionalFormats",void 0),Va([Object(f.t)(0)],_a.prototype,"index",void 0),Va([Object(f.t)("")],_a.prototype,"name",void 0),Va([Object(f.t)(100)],_a.prototype,"rowCount",void 0),Va([Object(f.t)(100)],_a.prototype,"colCount",void 0),Va([Object(f.t)("A1:A1")],_a.prototype,"selectedRange",void 0),Va([Object(f.t)("A1")],_a.prototype,"activeCell",void 0),Va([Object(f.t)({})],_a.prototype,"usedRange",void 0),Va([Object(f.t)("A1")],_a.prototype,"topLeftCell",void 0),Va([Object(f.t)(!0)],_a.prototype,"showHeaders",void 0),Va([Object(f.t)(!0)],_a.prototype,"showGridLines",void 0),Va([Object(f.t)(!1)],_a.prototype,"isProtected",void 0),Va([Object(f.t)("Visible")],_a.prototype,"state",void 0),Va([Object(f.t)(0)],_a.prototype,"frozenRows",void 0),Va([Object(f.t)(0)],_a.prototype,"frozenColumns",void 0),Va([Object(f.t)("A1")],_a.prototype,"paneTopLeftCell",void 0),_a);function Wa(e,t){for(var i,n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){i=n;break}return i}function Za(e,t){for(var i,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){i=n;break}return i}function Ga(e){return e.split("!")[0].replace(/\'/gi,"")}function Ya(e,t,i){for(var n=i.length,r=0;r<n;r++)if(i[r].sheet.toUpperCase()===t.toUpperCase())return i[r].index;return-1}function Xa(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;e.setSheetPropertyOnMute(i,"selectedRange",n?i.selectedRange+" "+t:t)}function Ka(e,t){return e.sheets[t]}function Ja(e){var t=[];e.sheets.forEach(function(e){t.push(e.name.toLowerCase())});for(var i=0;i<t.length;i++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function Qa(e){var t=0;return e.forEach(function(e){t=Math.max(e.id,t)}),t+1}function $a(e,t){var i=t||e.sheets;i.forEach(function(t){if(t.id=t.id||0,t.name=t.name||"",t.rowCount=Object(f.cb)(t.rowCount)?100:t.rowCount,t.colCount=Object(f.cb)(t.colCount)?100:t.colCount,t.topLeftCell=t.topLeftCell||"A1",t.activeCell=t.activeCell||"A1",t.selectedRange=t.selectedRange||"A1:A1",t.usedRange=t.usedRange||{rowIndex:0,colIndex:0},e.setSheetPropertyOnMute(t,"ranges",t.ranges?t.ranges:[]),e.setSheetPropertyOnMute(t,"rows",t.rows&&Object(f.L)([],t.rows,null,!0)||[]),e.setSheetPropertyOnMute(t,"columns",t.columns||[]),t.showHeaders=!!Object(f.cb)(t.showHeaders)||t.showHeaders,t.showGridLines=!!Object(f.cb)(t.showGridLines)||t.showGridLines,t.state=t.state||"Visible",t.maxHgts=[],t.protectSettings=t.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},t.isProtected=t.isProtected||!1,!t.paneTopLeftCell||"A1"===t.paneTopLeftCell){t.frozenRows=t.frozenRows?t.frozenRows:0,t.frozenColumns=t.frozenColumns?t.frozenColumns:0;var i=Zn(t.topLeftCell);e.setSheetPropertyOnMute(t,"paneTopLeftCell",Yn(t.frozenRows?i[0]+t.frozenRows:i[0],t.frozenColumns?i[1]+t.frozenColumns:i[1]))}var n;Ha(t.columns),(n=t.rows).forEach(function(e){e&&e.cells&&Ha(e.cells)}),Ha(n)}),Ha(i,!0,e)}function es(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.activeSheetIndex;return Ka(e,t).name}function ts(e,t,i,n){var r=!!i;i=i||[e.activeSheetIndex];var a={action:"moveSheet",position:t=function(e,t,i){for(var n=t;i?n>=0:n<e.length;i?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:i,cancel:!1};n&&e.trigger("actionBegin",a),a.cancel||(i.forEach(function(i,n){e.sheets.splice(t+n,0,e.sheets.splice(i+(t>i?-1*n:0),1)[0])}),e.setProperties({activeSheetIndex:t>i[0]?t-(i.length-1):t},!0),e.notify("moveOrDuplicateSheet",{refresh:r}),n&&(delete a.cancel,e.trigger("actionComplete",a)))}function is(e,t,i){var n={action:"duplicateSheet",sheetIndex:t=Object(f.cb)(t)?e.activeSheetIndex:t,cancel:!1};if(i&&e.trigger("actionBegin",n),!n.cancel){var r=Ka(e,t),a=Object(f.L)({},r.properties?r.properties:r,!0);a.id=Qa(e.sheets);var s=a.name;/^\(\d+\)$/.test("("+s.split(" (")[1])&&(s=s.split(" (")[0]);var o=[];e.sheets.forEach(function(e){o.push(e.name)});for(var l=2;;l++)if(-1===o.indexOf(s+" ("+l+")")){a.name=s+" ("+l+")";break}e.createSheet(t+1,[a]),e.notify(pr,{action:"addSheet",sheetName:"Sheet"+a.id,visibleName:a.name}),e.setProperties({activeSheetIndex:t+1},!0),e.notify("moveOrDuplicateSheet",{refresh:!0,isDuplicate:!0}),i&&(delete n.cancel,e.trigger("actionComplete",n))}}var ns,rs,as=function(){function e(){a(this,e),this.services={}}return o(e,[{key:"getService",value:function(e){if(Object(f.Z)(this.services[e]))throw"The service ".concat(e," is not registered");return this.services[e]}},{key:"register",value:function(e,t){Object(f.Z)(this.services[e])&&(this.services[e]=t)}}]),e}(),ss=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},os=(rs=ns=function(t){l(n,t);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).isEdit=!1,t.sheetNameCount=1,t.isOpen=!1,t.chartColl=[],t.chartCount=1,ns.Inject(Cr,jr,Tr,vr,ea,ta,Xr,Kr,ia,Jr,na,sa,aa,oa,la,ha,Qr,$r),t.commonCellStyle={},e&&e.cellStyle&&(t.commonCellStyle=e.cellStyle),"workbook"===t.getModuleName()&&(t.serviceLocator=new as,t.initWorkbookServices(),t.dataBind(),t.initEmptySheet()),t}return o(n,[{key:"preRender",value:function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=Fa(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()}},{key:"initWorkbookServices",value:function(){this.serviceLocator.register(Ta,new f.q(this.getModuleName(),ja,this.locale))}},{key:"render",value:function(){}},{key:"requiredModules",value:function(){return ca(this)}},{key:"getPersistData",value:function(){return this.addOnPersist([])}},{key:"cellFormat",value:function(e,t){var i=this.getActiveSheet();this.notify(dr,{style:e,range:t=t||i.selectedRange,refreshRibbon:t.indexOf(i.activeCell)>-1})}},{key:"lockCells",value:function(e,t){var i=this.getActiveSheet();this.notify("setLockCells",{range:e=e||i.selectedRange,isLocked:t})}},{key:"getCellStyleValue",value:function(e,t){var i=this,n=Da(t[0],t[1],this.getActiveSheet()),r={};return e.forEach(function(e){r[e]=i.cellStyle[e],n&&n.style&&n.style[e]&&(r[e]=n.style[e])}),r}},{key:"numberFormat",value:function(e,t){this.notify("applyNumber",{format:e,range:t})}},{key:"createSheet",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sheets.length,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{}];(t=this.sheets).splice.apply(t,[i,0].concat(e(n))),$a(this,n),this.notify("sheetCreated",{sheetIndex:i||0,sheets:n}),this.notify(pr,{action:"registerSheet",sheetIndex:i||0,sheetCount:i+n.length})}},{key:"removeSheet",value:function(e){this.sheets.splice(e,1)}},{key:"destroy",value:function(){this.notify("workbookDestroyed",null),r(p(n.prototype),"destroy",this).call(this)}},{key:"onPropertyChanged",value:function(e,t){for(var i=0,n=Object.keys(e);i<n.length;i++)switch(n[i]){case"cellStyle":Object(f.gb)(this.commonCellStyle,e.cellStyle);break;case"sheets":e.sheets===this.sheets?(this.notify(pr,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify("sheetsDestroyed",{}),$a(this),this.notify("sheetCreated",null),this.notify(pr,{action:"registerSheet"})):$a(this)}}},{key:"appendTo",value:function(e){r(p(n.prototype),"appendTo",this).call(this,e)}},{key:"hideRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getActiveSheet();if(!i||!n.frozenRows&&!n.frozenColumns)for(var r=e;r<=t;r++)hs(n,r,{hidden:i})}},{key:"hideColumn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getActiveSheet();if(!n.frozenRows&&!n.frozenColumns)for(var r=e;r<=t;r++)fs(n,r,{hidden:i})}},{key:"setBorder",value:function(e,t,i){this.notify(dr,{style:e,borderType:i,range:t||this.getActiveSheet().selectedRange})}},{key:"insertRow",value:function(e,t,i){this.notify("insertModel",{model:this.getSheetModel(i),start:e,end:t,modelType:"Row"})}},{key:"insertColumn",value:function(e,t,i){this.notify("insertModel",{model:this.getSheetModel(i),start:e,end:t,modelType:"Column"})}},{key:"insertSheet",value:function(e,t){this.notify("insertModel",{model:this,start:e,end:t,modelType:"Sheet"})}},{key:"delete",value:function(e,t,i,n){var r;if(e=e||0,i&&"Sheet"!==i){if(!(r=this.getSheetModel(n)))return}else r=this;this.notify("deleteModel",{model:r,start:e,end:Object(f.Z)(t)?e:t,modelType:i||"Sheet"})}},{key:"moveSheet",value:function(e,t){ts(this,e,t)}},{key:"duplicateSheet",value:function(e){is(this,e)}},{key:"getSheetModel",value:function(e){if(Object(f.Z)(e))return this.getActiveSheet();var t="string"==typeof e?Wa(this,e):e;return Object(f.Z)(t)||t>=this.sheets.length?null:this.sheets[t]}},{key:"merge",value:function(e,t){var i,n;e?n=Ka(this,i=this.getAddressInfo(e).sheetIndex):e=(n=this.getActiveSheet()).selectedRange,this.notify(fr,{merge:!0,range:e,type:t||"All",sheet:n,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==i})}},{key:"computeExpression",value:function(e){var t={action:"computeExpression",formula:e};return this.notify(pr,t),t.calcValue}},{key:"initEmptySheet",value:function(){this.sheets.length?$a(this):this.createSheet()}},{key:"getActiveSheet",value:function(){return this.sheets[this.activeSheetIndex]}},{key:"skipHiddenSheets",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++i)),i===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e}},{key:"setUsedRange",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getActiveSheet();e>i.usedRange.rowIndex&&(i.usedRange.rowIndex=e,i===this.getActiveSheet()&&this.notify("updateUsedRange",{index:e,update:"row"})),t>i.usedRange.colIndex&&(i.usedRange.colIndex=t,i===this.getActiveSheet()&&this.notify("updateUsedRange",{index:t,update:"col"}))}},{key:"getData",value:function(e){return Na(this,e)}},{key:"getModuleName",value:function(){return"workbook"}},{key:"getValueRowCol",value:function(e,t,i,n,r){var a={action:"getSheetInfo",sheetInfo:[]};if(this.notify(pr,a),-1===Ya(0,"Sheet"+e,a.sheetInfo)){var s={action:"getReferenceError",refError:""};return this.notify(pr,s),s.refError}var o=Za(this,e),l=Ka(this,o),h=Da(t-1,i-1,l);if(n&&n.includes("!")&&!h&&l.ranges&&l.ranges.length){var c;if(this.formulaRefCell&&this.formulaRefCell===n)return h&&h.value;if(l.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(c=!0)}),c){if(this.formulaRefCell=n,o=Za(this,Number(n.substring(n.lastIndexOf(",")+1,n.length))),Object(f.Z)(o))return h&&h.value;n=n.substring(n.lastIndexOf("!")+1,n.lastIndexOf(",")),Na(this,"".concat(l.name,"!A1:").concat(Yn(t-1,i-1)),null,null,null,null,n,o)}}else h&&h.formula&&(r||Object(f.Z)(h.value))&&-1===h.formula.indexOf("UNIQUE")&&this.notify("calculateFormula",{cell:h,rowIdx:t-1,colIdx:i-1,sheetIndex:o});return h&&h.value}},{key:"setValueRowCol",value:function(e,t,i,n){this.notify("workbookEditOperation",{action:"updateCellValue",address:[i-1,n-1],value:t,sheetIndex:Za(this,e),isValueOnly:!0})}},{key:"open",value:function(e){this.notify("workbookOpen",e)}},{key:"openFromJson",value:function(e){this.isOpen=!0;var t="object"==typeof e.file?JSON.stringify(e.file):e.file;this.notify("workbookOpen",{jsonObject:t})}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.allowSave){var t=Object.assign({},{url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1});this.trigger("beforeSave",t),this.notify(Ar,{eventArgs:t,action:"beforeSave"}),t.cancel||this.notify("beginSave",{saveSettings:t,isFullPost:t.isFullPost,needBlobData:t.needBlobData,customParams:t.customParams})}}},{key:"saveAsJson",value:function(){var e=this;return new Promise(function(t){e.on("onSave",function(i){i.cancel=!0,e.off("onSave"),t({jsonObject:{Workbook:i.jsonObject}}),e.notify("saveCompleted",i)}),e.save()})}},{key:"addHyperlink",value:function(e,t){this.notify("setLinkModel",{hyperlink:e,cell:t})}},{key:"findHandler",value:function(e){"next"===e.findOpt?this.notify("findNext",e):"prev"===e.findOpt&&this.notify("findPrevious",e)}},{key:"replaceHandler",value:function(e){this.notify("replace"===e.replaceBy?"replace":"replaceAll",e)}},{key:"protectSheet",value:function(e,t){this.notify("protectsheetHandler",t)}},{key:"unprotectSheet",value:function(e){this.notify("unprotectsheetHandler",{sheet:e})}},{key:"sort",value:function(e,t){if(!this.allowSorting)return Promise.reject();var i={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify("initiateSort",i),i.promise}},{key:"addDataValidation",value:function(e,t){var i={range:t=t||this.getActiveSheet().selectedRange,type:e.type,operator:e.operator,value1:e.value1,value2:e.value2,ignoreBlank:e.ignoreBlank,inCellDropDown:e.inCellDropDown,cancel:!1};this.notify(Ar,{eventArgs:i,action:"validation"}),i.cancel||(t=i.range,e.type=i.type,e.operator=i.operator,e.value1=i.value1,e.value2=i.value2,e.ignoreBlank=i.ignoreBlank,e.inCellDropDown=i.inCellDropDown,this.notify("setValidation",{rules:e,range:t}),delete i.cancel,this.notify(Rr,{eventArgs:i,action:"validation"}))}},{key:"removeDataValidation",value:function(e){this.notify("removeValidation",{range:e})}},{key:"addInvalidHighlight",value:function(e){this.notify("addHighlight",{range:e})}},{key:"removeInvalidHighlight",value:function(e){this.notify("removeHighlight",{range:e})}},{key:"conditionalFormat",value:function(e){e.range=e.range||this.getActiveSheet().selectedRange,this.notify("setCFRule",{conditionalFormat:e})}},{key:"clearConditionalFormat",value:function(e){e=e||this.getActiveSheet().selectedRange,this.notify("clearCFRule",{range:e})}},{key:"updateCell",value:function(e,t){var i,n=Jn(t);t.includes("!")?void 0===(i=Wa(this,t.split("!")[0]))&&(i=this.activeSheetIndex):i=this.activeSheetIndex,Ma(n[0],n[1],this.sheets[i],e,!0),(e.value||""===e.value)&&this.notify("workbookEditOperation",{action:"updateCellValue",address:n,value:e.value,sheetIndex:i}),this.notify("updateView",{indexes:n,sheetIndex:i})}},{key:"getRowData",value:function(e,t){Object(f.Z)(e)&&(e=0),Object(f.Z)(t)&&(t=this.activeSheetIndex);var i={sheetIdx:t,startIndex:e,modelType:"Row",isDataRequest:!0};return this.notify("dataChanged",i),i.data}},{key:"wrap",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Pa(e,t,this)}},{key:"addDefinedName",value:function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(pr,t),t.isAdded}},{key:"removeDefinedName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(pr,i),i.isRemoved}},{key:"clearRange",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!function(e,t,i,n){for(var r,a,s,o=Ka(e,i),l=Jn(t),h=l[0],c=l[2];h<=c;h++)for(r=l[1],a=l[3];r<=a;r++){var d={cellIdx:[h,r],isUnique:!1,uniqueRange:""};e.notify("checkUniqueRange",d);var u=!1;if(""!==d.uniqueRange){var p=Jn(d.uniqueRange);u="#SPILL!"===Da(p[0],p[1],o).value}if(!d.isUnique||u){var g=Da(h,r,o);s=g&&g.value,e.notify("cFDelete",{rowIdx:h,colIdx:r}),!Object(f.Z)(g)&&n&&(delete g.value,Object(f.Z)(g.formula)||delete g.formula,Object(f.Z)(g.hyperlink)||delete g.hyperlink),Object(f.Z)(s)||""===s||e.notify(pr,{action:"refreshCalculate",rowIndex:h,colIndex:r})}}}(this,e||this.getActiveSheet().selectedRange,Object(f.Z)(t)?this.activeSheetIndex:t,i)}},{key:"insertImage",value:function(e,t){this.notify("setImage",{options:e,range:t||this.getActiveSheet().selectedRange})}},{key:"insertChart",value:function(e){this.notify("setChart",{chart:e})}},{key:"deleteChart",value:function(e){this.notify("deleteChart",{id:e})}},{key:"filter",value:function(e,t){if(!this.allowFiltering)return Promise.reject();var i={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify("initiateFilter",i),i.promise}},{key:"clearFilter",value:function(){this.notify("clearAllFilter",null)}},{key:"addCustomFunction",value:function(e,t){t=t||("string"==typeof e?e:e.name.replace("bound ","")),this.notify(pr,{action:"addCustomFunction",functionHandler:e,functionName:t})}},{key:"clear",value:function(e){this.notify("clear",e)}},{key:"getDisplayText",value:function(e){if(!e)return"";if(e.format&&!Object(f.Z)(e.value)){var t={formattedText:e.value,value:e.value,format:e.format,onLoad:!0};return this.notify("getFormattedCell",t),t.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value||"number"==typeof e.value?e.value.toString():""}},{key:"freezePanes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,n=this.getSheetModel(i);n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.name===this.getActiveSheet().name&&this.notify("dataRefresh",null))}},{key:"Unfreeze",value:function(e){this.freezePanes(0,0,e)}},{key:"updateTopLeftCell",value:function(e,t,i,n){n||(n=this.getActiveSheet());var r=Zn(n.topLeftCell);n.frozenRows||n.frozenColumns?(Object(f.Z)(e)&&(e=n.frozenRows?0:r[0]),Object(f.Z)(t)&&(t=n.frozenColumns?0:r[1]),e+=this.frozenRowCount(n),t+=this.frozenColCount(n),i&&("row"===i?e=Zn(n.paneTopLeftCell)[0]:t=Zn(n.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",Yn(e,t)),n.frozenRows&&(e=r[0]),n.frozenColumns&&(t=r[1])):(Object(f.Z)(e)&&(e=r[0]),Object(f.Z)(t)&&(t=r[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",Yn(e,t))),this.setSheetPropertyOnMute(n,"topLeftCell",Yn(e,t))}},{key:"getAddressInfo",value:function(e){return function(e,t){return{sheetIndex:t.indexOf("!")>-1?Wa(e,Ga(t)):e.activeSheetIndex,indices:Jn(t)}}(this,e)}},{key:"setSheetPropertyOnMute",value:function(e,t,i){this.isProtectedOnChange=!0,e[t]=i,this.isProtectedOnChange=!1}},{key:"frozenRowCount",value:function(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:Zn(e.topLeftCell)[0]+e.frozenRows:0}},{key:"frozenColCount",value:function(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:Zn(e.topLeftCell)[1]+e.frozenColumns:0}}]),n}(f.h),ss([Object(f.f)([],qa)],rs.prototype,"sheets",void 0),ss([Object(f.t)(0)],rs.prototype,"activeSheetIndex",void 0),ss([Object(f.t)("100%")],rs.prototype,"height",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowFindAndReplace",void 0),ss([Object(f.t)()],rs.prototype,"filterCollection",void 0),ss([Object(f.t)()],rs.prototype,"sortCollection",void 0),ss([Object(f.t)("100%")],rs.prototype,"width",void 0),ss([Object(f.t)(!0)],rs.prototype,"showRibbon",void 0),ss([Object(f.t)(!0)],rs.prototype,"showFormulaBar",void 0),ss([Object(f.t)(!0)],rs.prototype,"showSheetTabs",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowEditing",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowOpen",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowSave",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowSorting",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowFiltering",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowNumberFormatting",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowCellFormatting",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowHyperlink",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowInsert",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowDelete",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowMerge",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowDataValidation",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowImage",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowChart",void 0),ss([Object(f.t)(!0)],rs.prototype,"allowConditionalFormat",void 0),ss([Object(f.g)({},va)],rs.prototype,"cellStyle",void 0),ss([Object(f.t)("")],rs.prototype,"openUrl",void 0),ss([Object(f.t)("")],rs.prototype,"saveUrl",void 0),ss([Object(f.t)("")],rs.prototype,"password",void 0),ss([Object(f.t)(!1)],rs.prototype,"isProtected",void 0),ss([Object(f.f)([],ya)],rs.prototype,"definedNames",void 0),ss([Object(f.k)()],rs.prototype,"beforeOpen",void 0),ss([Object(f.k)()],rs.prototype,"openFailure",void 0),ss([Object(f.k)()],rs.prototype,"beforeSave",void 0),ss([Object(f.k)()],rs.prototype,"saveComplete",void 0),ss([Object(f.k)()],rs.prototype,"beforeCellFormat",void 0),ss([Object(f.k)()],rs.prototype,"queryCellInfo",void 0),rs=ns=ss([f.r],rs));function ls(e,t){return e.rows[t]}function hs(e,t,i){e.rows[t]||(e.rows[t]={}),Object.keys(i).forEach(function(n){e.rows[t][n]=i[n]})}function cs(e,t){return e.rows[t]&&e.rows[t].hidden}function ds(e,t,i){var n;if(e&&e.rows&&e.rows[t]){if(e.rows[t].hidden)return 0;n=void 0===e.rows[t].height?20:e.rows[t].height}else n=20;if(i&&window.devicePixelRatio%1>0){var r=n*window.devicePixelRatio%1;return n+(r?(r>.5?1-r:-1*r)/window.devicePixelRatio:0)}return n}function us(e,t,i){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=i)}function ps(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3?arguments[3]:void 0,a=0;t>n&&(i=t,t=n,n=i);for(var s=t;s<=n;s++)a+=ds(e,s,r);return a}function gs(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function fs(e,t,i){var n=gs(e,t);Object.keys(i).forEach(function(e){n[e]=i[e]})}function ms(e,t,i,n){var r;if(e&&e.columns&&e.columns[t]){if(!i&&e.columns[t].hidden)return 0;r=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else r=64;if(n&&window.devicePixelRatio%1>0){var a=r*window.devicePixelRatio%1;return r+(a?(a>.5?1-a:-1*a)/window.devicePixelRatio:0)}return r}function vs(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,n=arguments.length>3?arguments[3]:void 0,r=0;if(t>i){var a=t;t=i,i=a}for(var s=t;s<=i;s++)r+=ms(e,s,null,n);return r}function ys(e,t){return e.columns[t]&&e.columns[t].hidden}function bs(e){requestAnimationFrame(function(){e()})}function Cs(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function xs(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}var Ss=null;function ws(){if(null!==Ss)return Ss;var e,t=document.createElement("div");return t.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(t),e=t.offsetWidth-t.clientWidth|0,document.body.removeChild(t),Ss=e}var ks=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"];function Is(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ks;return Os(e,"previous",t)+Os(e,"next",t)}function Os(e,t,i){for(var n=e[t+"ElementSibling"],r=0;n;)i.some(function(e){return n.classList.contains(e)})&&(r+=n.offsetHeight),n=n[t+"ElementSibling"];return r}function Rs(e,t,i){if(e.scrollSettings.enableVirtualization){var n,r=e.viewport.topIndex,a=e.viewport.leftIndex,s=r+e.viewport.rowCount+2*e.getThreshold("row"),o=a+e.viewport.colCount+2*e.getThreshold("col"),l=e.getActiveSheet();if(l.frozenRows||l.frozenColumns)return e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]);if(n=r<=t[0]&&s>=t[2]&&a<=t[1]&&o>=t[3])return!0;if(i){if(t[0]<r&&t[2]<r||t[0]>s&&t[2]>s)return!1;if(t[0]<r&&t[2]>r&&(t[0]=r,n=!0),t[2]>s&&(t[2]=s,n=!0),t[1]<a&&t[3]<a||t[1]>o&&t[3]>o)return!1;t[1]<a&&t[3]>a&&(t[1]=a,n=!0),t[3]>o&&(t[3]=o,n=!0)}return n}return!0}function As(e,t,i,n,r,a,s){var o,l=0,h=0;for(o=0;o<t[0];o++)i&&i-1<t[0]&&o<i||(l+=ds(e,o,!0));for(o=0;o<t[1];o++)n&&n-1<t[1]&&o<n||(h+=ms(e,o,null,!0));return i&&t[0]<i&&(e.showHeaders&&(l+=30),r&&(l-=r)),n&&t[1]<n&&(e.showHeaders&&(h+=s||30),a&&(h-=a)),{top:l,left:h}}function Es(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"e-selection",r=e.getActiveSheet();if(r.frozenRows||r.frozenColumns){var a,s=e.frozenRowCount(r),o=e.frozenColCount(r);if("e-active-cell"===n){if(i[0]<s||i[1]<o){t.style.display="none";var l=(a=i[0]<s&&i[1]<o?e.getSelectAllContent():i[0]<s?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+n);l||(l=t.cloneNode(!0),a.appendChild(l)),Ts(t=l,i,r,e.enableRtl,s,o,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth)}else Ts(t,i,r,e.enableRtl,s,o);t.style.display&&(t.style.display=""),Ls(e.getSelectAllContent(),a,!0),Ls(e.getColumnHeaderContent(),a,!0),Ls(e.getRowHeaderContent(),a,!0)}else{var h=$n(i);if(h[0]<s||h[1]<o){t.classList.add("e-hide");var c,d=[];h[0]<s&&h[1]<o?h[2]<s&&h[3]<o?(d.push(i),Ls(e.getColumnHeaderContent(),a,!1),Ls(e.getRowHeaderContent(),a,!1)):h[2]>s-1?h[3]<o?(Ls(e.getColumnHeaderContent(),a,!1),d.push([h[0],h[1],s-1,h[3]]),d.push([s,h[1],h[2],h[3]])):(d.push([h[0],h[1],s-1,o-1]),d.push([s,h[1],h[2],o-1]),d.push([h[0],o,s-1,h[3]]),d.push([s,o,h[2],h[3]])):h[2]<s?(d.push([h[0],h[1],h[2],o-1]),d.push([h[0],o,h[2],h[3]]),Ls(e.getRowHeaderContent(),a,!1)):(d.push([s,h[1],h[2],o-1]),d.push([h[0],h[1],s-1,o-1]),d.push([s,o,h[2],h[3]]),d.push([h[0],o,s-1,h[3]])):h[0]<s?h[2]<s?d.push(i):(d.push([h[0],h[1],s-1,h[3]]),d.push([s,h[1],h[2],h[3]]),Ls(e.getSelectAllContent(),a,!1),Ls(e.getRowHeaderContent(),a,!1)):h[3]<o?d.push(i):(d.push([h[0],h[1],h[2],o-1]),d.push([h[0],o,h[2],h[3]]),Ls(e.getSelectAllContent(),a,!1),Ls(e.getColumnHeaderContent(),a,!1)),d.forEach(function(i){var l;a=i[2]<s&&i[3]<o?e.getSelectAllContent():i[2]<s?e.getColumnHeaderContent():i[3]<o?e.getRowHeaderContent():e.getMainContent(),"e-copy-indicator"===n||"e-range-indicator"===n?(l=t.cloneNode(!0),a.appendChild(l),s&&(i[2]+1===s&&d.forEach(function(e){e!==i&&((c=l.getElementsByClassName("e-bottom")[0])&&e[0]===s&&Object(f.J)(c))}),i[0]===s&&a.parentElement.classList.contains("e-main-panel")&&d.forEach(function(e){e!==i&&((c=l.getElementsByClassName("e-top")[0])&&e[2]+1===s&&Object(f.J)(c))})),o&&(i[3]+1===o&&d.forEach(function(e){e!==i&&((c=l.getElementsByClassName("e-right")[0])&&e[1]===o&&Object(f.J)(c))}),i[1]===o&&(a.classList.contains("e-sheet-content")||a.classList.contains("e-column-header"))&&d.forEach(function(e){e!==i&&((c=l.getElementsByClassName("e-left")[0])&&e[3]+1===o&&Object(f.J)(c))}))):(l=a.querySelector("."+n))||(l=t.cloneNode(!0),a.appendChild(l)),Ts(l,i,r,e.enableRtl,s,o,!1,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth),l.classList.contains("e-hide")&&l.classList.remove("e-hide")})}else Ls(e.getSelectAllContent(),null,!1),Ls(e.getColumnHeaderContent(),null,!1),Ls(e.getRowHeaderContent(),null,!1),Ts(t,i,r,e.enableRtl,s,o),"e-range-indicator"!==n&&e.getMainContent().querySelector("."+n)||e.getMainContent().appendChild(t)}}else Ts(t,i,r,e.enableRtl,0,0),t&&!e.getMainContent().querySelector("."+n)&&e.getMainContent().appendChild(t)}function Ls(e,t,i){var n;i?e!==t&&((n=e.querySelector(".e-active-cell"))&&Object(f.J)(n)):(n=e.querySelector(".e-selection"))&&Object(f.J)(n)}function Ts(e,t,i,n,r,a,s,o,l,h){var c,d=$n(t),u=As(i,d,r,a,o,l,h),p=[ro(i,0,!0),ro(i,0,!0,"columns")],g=ps(i,t[0],t[2],!0),m=vs(i,t[1],t[3],!0),v={top:(d[0]===p[0]?u.top:u.top-Vs(1))+"px",height:g&&g+(d[0]===p[0]?0:Vs(1))+"px",width:m&&m+(d[1]===p[1]?0:Vs(1))+(s&&a&&d[1]<a&&d[3]>=a?1:0)+"px"};v[n?"right":"left"]=(d[1]===p[1]?u.left:u.left-1)+"px",e&&(c=[{element:e,attrs:v}],requestAnimationFrame(function(){c.forEach(function(e){Object(f.rb)(e.element,e.attrs)})}))}function js(){return f.d.isPointer?"pointerdown":"mousedown touchstart"}function Ds(){return f.d.isPointer?"pointermove":"mousemove touchmove"}function Ms(){return f.d.isPointer?"pointerup":"mouseup touchend"}function Fs(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function Ps(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function Ns(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function Bs(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function Hs(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function _s(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function zs(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function Vs(e,t){if(window.devicePixelRatio%1>0){var i=e*window.devicePixelRatio%1;return e+(i?(i>.5||t?1-i:-1*i)/window.devicePixelRatio:0)}return e}var Us={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"};function qs(e,t){Object.keys(t).forEach(function(i){e&&e.setAttribute(Us[i],t[i])})}function Ws(e,t,i,n,r){var a,s,o,l,h,c,d,u,p,g=r.getActiveSheet(),f=r.frozenRowCount(g),m=r.frozenColCount(g);if(n){var v=e<m?r.getSelectAllContent():r.getColumnHeaderContent();a=v.getElementsByTagName("th")[t],s=v.getElementsByTagName("col")[t],o=(e<m?r.getRowHeaderContent():r.getMainContent()).getElementsByTagName("col")[t]}else{var y;if(a=s=f||m?r.getRow(e,null,m-1):r.getRow(e,r.getRowHeaderTable()),s.style.height=parseInt(i,10)>0?Vs(parseInt(i,10))+"px":"2px",(o=r.getRow(e,null,m)).style.height=parseInt(i,10)>0?Vs(parseInt(i,10))+"px":"0px",g.showHeaders){var b=r.getRowHeaderContent().getElementsByClassName("e-row"),C=[];C[0]=b[t].getElementsByTagName("td")[0].cloneNode(!0),y=Gs(r.getRowHeaderTable(),C,!1,r)+1}for(var x=r.getMainContent().getElementsByClassName("e-row"),S=[],w=0;w<x[t].getElementsByTagName("td").length;w++)S[w]=x[t].getElementsByTagName("td")[w].cloneNode(!0);var k=Gs(r.getContentTable(),S,!1,r)+1,I=y>=k?y:k;parseInt(o.style.height,10)<I||a&&a.classList.contains("e-reach-fntsize")&&parseInt(o.style.height,10)===I?(g.showHeaders&&(a.classList.add("e-reach-fntsize"),s.style.lineHeight=parseInt(i,10)>=4?parseInt(i,10)-4+"px":parseInt(i,10)>0?parseInt(i,10)-1+"px":"0px"),o.style.lineHeight=parseInt(i,10)>0?parseInt(i,10)-1+"px":"0px"):(s&&s.style.removeProperty("line-height"),o.style.removeProperty("line-height"),a&&a.classList.contains("e-reach-fntsize")&&a.classList.remove("e-reach-fntsize"))}if(c=o.previousElementSibling,p=o.nextElementSibling,c&&(g.showHeaders&&(l=a.previousElementSibling,h=s.previousElementSibling),c=o.previousElementSibling),p&&(g.showHeaders&&(d=a.nextElementSibling,u=s.nextElementSibling),p=o.nextElementSibling),parseInt(i,10)<=0&&!o.classList.contains("e-zero")&&!o.classList.contains("e-zero-start")){if(c&&p)if(n?(g.showHeaders&&(s.style.width="2px"),o.style.width="0px"):(g.showHeaders&&(s.style.height="2px"),o.style.height="0px"),c.classList.contains("e-zero-start")?(g.showHeaders&&a.classList.add("e-zero-start"),o.classList.add("e-zero-start")):(g.showHeaders&&a.classList.add("e-zero"),o.classList.add("e-zero")),!d||d.classList.contains("e-zero")||d.classList.contains("e-zero-last")||(g.showHeaders&&a.classList.add("e-zero-last"),o.classList.add("e-zero-last")),c.classList.contains("e-zero-last")&&(g.showHeaders&&l.classList.remove("e-zero-last"),c.classList.remove("e-zero-last")),g.showHeaders&&l.classList.contains("e-zero")?(a.classList.contains("e-zero-end"),Zs(h,-2,n)):g.showHeaders&&Zs(h,-1,n),g.showHeaders&&l.classList.contains("e-zero-start")&&Zs(s,-1,n),g.showHeaders&&d.classList.contains("e-zero"))if(a.classList.contains("e-zero-start"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(u.style.height,10)&&!n||0!==parseInt(u.style.width,10)&&n){n?(s.style.width=parseInt(s.style.width,10)-1+"px",u.style.width=parseInt(u.style.width,10)-1+"px"):(s.style.height=parseInt(s.style.height,10)-1+"px",u.style.height=parseInt(u.style.height,10)-1+"px"),d.classList.remove("e-zero"),d.classList.add("e-zero-start");break}var O=void 0;d.classList.remove("e-zero"),d.classList.add("e-zero-start"),n?(O=parseInt(d.getAttribute("aria-colindex"),10)-1,d=r.getColHeaderTable().getElementsByTagName("th")[O+1],u=r.getColHeaderTable().getElementsByTagName("col")[O+1]):(O=parseInt(d.getAttribute("aria-rowindex"),10)-1,d=r.getRowHeaderTable().getElementsByTagName("tr")[O+1],u=r.getRowHeaderTable().getElementsByTagName("tr")[O+1])}else Zs(s,-2,n);else g.showHeaders&&(d.classList.contains("e-zero-end")?n?s.style.width="0px":s.style.height="0px":Zs(u,-1,n));else if(c)n?(g.showHeaders&&(s.style.width="1px"),o.style.width="0px"):(g.showHeaders&&(s.style.height="1px"),o.style.height="0px"),g.showHeaders&&a.classList.add("e-zero-end"),o.classList.add("e-zero-end"),g.showHeaders&&a.classList.add("e-zero-last"),o.classList.add("e-zero-last"),g.showHeaders&&l.classList.contains("e-zero")?Zs(h,-2,n):Zs(h,-1,n);else if(d)if(a.classList.add("e-zero-start"),o.classList.add("e-zero-start"),d.classList.contains("e-zero")||(a.classList.add("e-zero-last"),o.classList.add("e-zero-last")),n?(s.style.width="1px",o.style.width="0px"):(s.style.height="1px",o.style.height="0px"),g.showHeaders&&d.classList.contains("e-zero"))for(;d;){if(d.classList.contains("e-zero")&&0!==parseInt(u.style.width,10)&&n||0!==parseInt(u.style.height,10)&&!n){n?(u.style.width=parseInt(u.style.width,10)-1+"px",s.style.width=parseInt(s.style.width,10)-1+"px"):(u.style.height=parseInt(u.style.height,10)-1+"px",s.style.height=parseInt(s.style.height,10)-1+"px"),d.classList.add("e-zero-start"),d.classList.remove("e-zero");break}var R=void 0;d.classList.add("e-zero-start"),d.classList.remove("e-zero"),n?(R=parseInt(d.getAttribute("aria-colindex"),10)-1,u=r.getColHeaderTable().getElementsByTagName("col")[R+1],d=r.getColHeaderTable().getElementsByTagName("th")[R+1]):(R=parseInt(d.getAttribute("aria-rowindex"),10)-1,u=r.getRowHeaderTable().getElementsByTagName("tr")[R+1],d=r.getRowHeaderTable().getElementsByTagName("tr")[R+1])}else g.showHeaders&&Zs(u,-1,n)}else if(parseInt(i,10)>0){var A=Vs(parseInt(i,10))+"px";n?(s.style.width=A,o.style.width=A):(s.style.height=A,o.style.height=A),g.showHeaders&&l&&d?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(h.style.width=parseInt(h.style.width,10)+2+"px",s.style.width=parseInt(s.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+2+"px",s.style.height=parseInt(s.style.height,10)-1+"px"):Zs(s,-1,n):a.classList.contains("e-zero")?Zs(h,1,n):a.classList.contains("e-zero-start")&&(n?(h.style.width=parseInt(h.style.width,10)+1+"px",s.style.width=parseInt(s.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+1+"px",s.style.height=parseInt(s.style.height,10)-1+"px")),d.classList.contains("e-zero")?Zs(s,-1,n):(a.classList.contains("e-zero")||a.classList.contains("e-zero-start"))&&Zs(u,1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),a.classList.contains("e-zero-last")&&a.classList.remove("e-zero-last"),o.classList.contains("e-zero-last")&&o.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),c.classList.add("e-zero-last"))):g.showHeaders&&l?(l.classList.contains("e-zero")?a.classList.contains("e-zero")?n?(s.style.width=parseInt(s.style.width,10)-1+"px",h.style.width=parseInt(h.style.width,10)+2+"px"):(s.style.height=parseInt(s.style.height,10)-1+"px",h.style.height=parseInt(h.style.height,10)+2+"px"):Zs(s,-1,n):a.classList.contains("e-zero")?Zs(h,1,n):Zs(s,-1,n),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),a.classList.contains("e-zero-end")&&a.classList.remove("e-zero-end"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-end")&&o.classList.remove("e-zero-end")):g.showHeaders&&d&&(d.classList.contains("e-zero")?Zs(s,-1,n):a.classList.contains("e-zero-start")&&(Zs(u,1,n),a.classList.remove("e-zero-start")),a.classList.contains("e-zero")&&a.classList.remove("e-zero"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),a.classList.contains("e-zero-start")&&a.classList.remove("e-zero-start"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"))}}function Zs(e,t,i){i?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function Gs(e,t,i,n,r,a){var s,o,l=n.createElement("div",{className:n.element.className,styles:"display: block"}),h=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),c=n.createElement("tr");i?t.forEach(function(e){var t=c.cloneNode();t.appendChild(e),h.appendChild(t)}):(t.forEach(function(e){c.appendChild(e.cloneNode(!0))}),h.appendChild(c)),l.appendChild(h),document.body.appendChild(l);var d=h.getBoundingClientRect().width,u=h.getBoundingClientRect().height;return a?(s=i&&parseInt(r,10)>d?d:parseInt(r,10),o=!i&&parseInt(r,10)>u?u:parseInt(r,10)):(o=u,s=d),document.body.removeChild(l),i?Math.ceil(s):Math.ceil(o)}function Ys(e,t,i,n){var r,a,s,o,l,h,c=e.eventArgs;switch(e.action){case"sorting":s={args:{range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},promise:new Promise(function(e,t){e(void 0)})},t.notify("initiateSort",s),s.promise.then(function(e){t.serviceLocator.getService("cell").refreshRange(Jn(e.range))});break;case"cellSave":o=e.eventArgs,l=c.formula?i?{value:o.formula}:{formula:o.formula}:{value:o.value},t.updateCell(l,o.address);break;case"cellDelete":t.clearRange(e.eventArgs.address,null,!0),t.serviceLocator.getService("cell").refreshRange(Wn(e.eventArgs.address));break;case"format":if("CellFormat"===c.requestType)if(c.style&&c.style.border&&!Object(f.Z)(c.borderType)){var d={};Object.assign(d,c.style,null,!0),c.style.border=void 0,t.cellFormat(c.style,c.range),c.style.border=d.border,t.setBorder(c.style,c.range,c.borderType),c.style=d}else t.cellFormat(c.style,c.range);else t.numberFormat(c.format,c.range);break;case"clipboard":if(c.copiedInfo.isCut&&!i)return;(c.copiedInfo.isCut?t.cut(c.copiedRange):t.copy(c.copiedRange)).then(function(){t.paste(c.pastedRange,c.type)});break;case"gridLines":t.setSheetPropertyOnMute(t.sheets[c.sheetIdx],"showGridLines",c.isShow);break;case"headers":t.setSheetPropertyOnMute(t.sheets[c.sheetIdx],"showHeaders",c.isShow);break;case"resize":case"resizeToFit":c.isCol?void 0===c.hide?t.setColWidth(c.width,c.index,c.sheetIdx):t.hideColumn(c.index,c.index,c.hide):void 0===c.hide?t.setRowHeight(c.height,c.index,c.sheetIdx+1):t.hideRow(c.index,c.index,c.hide);break;case"renameSheet":t.setSheetPropertyOnMute(t.sheets[c.index-1],"name",c.value);break;case"removeSheet":t.notify("removeSheetTab",{index:c.index,isAction:!0,count:c.sheetCount,clicked:!0});break;case"wrap":Pa(e.eventArgs.address,e.eventArgs.wrap,t);break;case"hideShow":c.isCol?t.hideColumn(c.startIndex,c.endIndex,c.hide):t.hideRow(c.startIndex,c.endIndex,c.hide);break;case"replace":t.updateCell({value:c.compareVal},c.address);break;case"filter":t.notify("initiateFilterUI",!1===i?{predicates:c.previousPredicates,range:c.range,sIdx:c.index,isCut:!0,isUndoRedo:!0}:{predicates:c.predicates,range:c.range,sIdx:c.index,isCut:!0,isUndoRedo:!0});break;case"insert":!1===i?t.delete(e.eventArgs.index,e.eventArgs.index+(e.eventArgs.model.length-1),e.eventArgs.modelType,e.eventArgs.sheet.name):t.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?t:e.eventArgs.sheet,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,isAction:!1,checkCount:e.eventArgs.sheetCount,activeSheetIndex:e.eventArgs.activeSheetIndex});break;case"delete":!1===i?t.notify("insertModel",{model:"Sheet"===e.eventArgs.modelType?t:e.eventArgs.sheet,start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,isAction:!1,columnCellsModel:e.eventArgs.deletedCellsModel,definedNames:e.eventArgs.definedNames}):t.delete(e.eventArgs.startIndex,e.eventArgs.endIndex,e.eventArgs.modelType,e.eventArgs.sheet.name);break;case"validation":i?t.notify("setValidation",{rules:{type:c.type,operator:c.operator,value1:c.value1,value2:c.value2,ignoreBlank:c.ignoreBlank,inCellDropDown:c.inCellDropDown},range:c.range}):t.notify("removeValidation",{range:c.range});break;case"merge":e.eventArgs.isAction=!1,h=[];for(var u=0,p=c.model.length;u<p;u++){h.push({cells:[]});for(var g=0,m=c.model[u].cells.length;g<m;g++)h[u].cells[g]={},Object.assign(h[u].cells[g],c.model[u].cells[g])}t.notify(fr,e.eventArgs),c.model=h;break;case"clear":t.notify("clearViewer",{options:e.eventArgs,isPublic:!0});break;case"conditionalFormat":if(i)t.notify("setCFRule",{conditionalFormat:{type:c.type,cFColor:c.cFColor,value:c.value,range:c.range},sheetIdx:c.sheetIdx,isUndoRedo:!0});else{t.notify("clearCFRule",{range:c.range,sheetIdx:c.sheetIdx,isUndoRedo:!0});for(var v=0;v<n.length;v++)"conditionalFormat"===n[v].action&&t.notify("cFUndo",{conditionalFormat:{type:n[v].eventArgs.type,cFColor:n[v].eventArgs.cFColor,value:n[v].eventArgs.value,range:n[v].eventArgs.range},sheetIdx:n[v].eventArgs.sheetIdx})}break;case"clearCF":i?t.notify("clearCFRule",{range:c.selectedRange,sheetIdx:c.sheetIdx,isClearCF:!0,isUndoRedo:!0}):t.notify("clearCells",{conditionalFormats:c.cFormats,oldRange:c.oldRange,selectedRange:c.selectedRange});break;case"insertImage":i?t.notify("createImageElement",{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0}):t.notify("deleteImage",{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range});break;case"imageRefresh":a=document.getElementById(e.eventArgs.id),i?(e.eventArgs.isUndoRedo=!0,t.notify("refreshImgCellObj",e.eventArgs)):t.notify("refreshImgCellObj",{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}),a.style.height=i?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",a.style.width=i?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",a.style.top=i?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",a.style.left=i?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px";break;case"insertChart":i?t.notify("setChart",{chart:[{type:c.type,theme:c.theme,isSeriesInRows:c.isSeriesInRows,range:c.range,id:c.id,height:c.height,width:c.width}],isInitCell:c.isInitCell,isUndoRedo:!1,range:c.posRange}):t.notify("deleteChart",{id:c.id,isUndoRedo:!0});break;case"deleteChart":i?t.notify("deleteChart",{id:c.id}):t.notify("setChart",{chart:[{type:c.type,theme:c.theme,isSeriesInRows:c.isSeriesInRows,range:c.range,id:c.id,height:c.height,width:c.width,top:c.top,left:c.left}],isInitCell:c.isInitCell,isUndoRedo:!1,range:c.posRange});break;case"chartRefresh":(r=document.getElementById(e.eventArgs.id))&&(r.style.height=i?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",r.style.width=i?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",r.style.top=i?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",r.style.left=i?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px"),i?(e.eventArgs.isUndoRedo=!0,t.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r})):t.notify("refreshChartSize",{height:r.style.height,width:r.style.width,overlayEle:r})}}function Xs(e,t,i,n){for(var r,a=e.sheets[n].ranges,s=0,o=a.length;s<o;s++)if(a[s].template&&((r=Wn(a[s].address.length?a[s].address:a[s].startCell))[0]<=t&&r[1]<=i&&r[2]>=t&&r[3]>=i))return!0;return!1}function Ks(e,t,i,n,r,a){var s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=ds(t,n,!0),l=e.frozenColCount(t),h=Vs(i);(r=r||(t.frozenRows?e.getRow(n,null,l):e.getRow(n)))&&(r.style.height="".concat(h,"px")),(a=a||(t.frozenColumns?e.getRow(n,null,l-1):e.getRow(n,e.getRowHeaderTable())))&&(a.style.height="".concat(h,"px")),us(t,n,i),e.setProperties({sheets:e.sheets},!0),s&&e.notify("rowHeightChanged",{rowIdx:n,threshold:h-o})}function Js(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=t&&t.fontSize||e.cellStyle.fontSize,r=(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*function(e){var t=1.24;return e&&("Arial Black"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}(t)*i;return Math.ceil(r%1>.9?r+1:r)}function Qs(e,t,i){t||(t=i);var n=document.createElement("canvas").getContext("2d");return n.font=(t.fontStyle||i.fontStyle)+" "+(t.fontWeight||i.fontWeight)+" "+(t.fontSize||i.fontSize)+" "+(t.fontFamily||i.fontFamily),Vs(n.measureText(e).width,!0)}function $s(e,t,i,n){var r,a=0,s=e.toString().split(" "),o=Qs(" ",i,n),l=0;return s.forEach(function(e){var h=0,c=0;r=Qs(e,i,n),s[s.length-1]!==e&&(r+=o),(a+r)/t>=1?(a&&l++,r/t>=1?(e.split("").forEach(function(e){c=Qs(e,i,n),(h+=c)>t&&(l++,h=c)}),a=h+o):a=r):a+=r}),a&&(l+=Math.ceil((a-o)/t)),l}function eo(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;return vs(e,i,n,!0)-Vs(4+function(e,t,i){var n=0,r=Da(e,t,i,null,!0),a=Da(e,t+1,i,null,!0);return r.style&&(r.style.border?n=(0===t?2:1)*parseFloat(r.style.border.split("px")[0]):(0===t&&r.style.borderLeft&&(n=parseFloat(r.style.borderLeft.split("px")[0])),r.style.borderRight&&(n+=parseFloat(r.style.borderRight.split("px")[0])))),r.style&&(r.style.border||r.style.borderRight)||!a.style||!a.style.borderLeft||(n+=parseFloat(a.style.borderLeft.split("px")[0])),n}(t,i,e))}function to(e,t,i,n,r,a){return Js(e,r,a)+(function(e,t,i){var n=0,r=Da(e,t,i,null,!0),a=Da(e+1,t,i,null,!0);return r.style&&(r.style.border?n=(0===e?2:1)*parseFloat(r.style.border.split("px")[0]):(0===e&&r.style.borderTop&&(n=parseFloat(r.style.borderTop.split("px")[0])),r.style.borderBottom&&(n+=parseFloat(r.style.borderBottom.split("px")[0])))),r.style&&(r.style.border||r.style.borderBottom)||!a.style||!a.style.borderTop||(n+=parseFloat(a.style.borderTop.split("px")[0])),n}(t,i,n)||1)}function io(e,t,i,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][i]=n}function no(e,t){var i=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach(function(e){n[e]>i&&(i=n[e])}),i}function ro(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rows";return t<0&&(t=-1),e[n][t]&&e[n][t].hidden&&(i?t++:t--,t=ro(e,t,i,n)),t}function ao(e){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(f.d.isIE){var t=window.scrollX,i=window.scrollY;e.focus(),window.scrollTo(t,i)}else e.focus({preventScroll:!0})}function so(e,t){for(var i,n=e.getActiveSheet(),r=Object(f.Z)(t)?$n(Wn(n.selectedRange)):t,a=r[0];a<=r[2];a++)for(var s=r[1];s<=r[3];s++)if(Ra(Da(a,s,n),gs(n,s))){i=!0;break}return i}var oo,lo,ho,co=function(){function e(t){a(this,e),this.parent=t,this.init(),this.addEventListener()}return o(e,[{key:"init",value:function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))}},{key:"addEventListener",value:function(){var e=this.getClipboardEle();this.parent.on("cut",this.cut,this),this.parent.on("copy",this.copy,this),this.parent.on(Ir,this.paste,this),this.parent.on("clearCopy",this.clearCopiedInfo,this),this.parent.on("tabSwitch",this.tabSwitchHandler,this),this.parent.on(kr,this.cMenuBeforeOpenHandler,this),this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("contentLoaded",this.initCopyIndicator,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),this.parent.on("refreshClipboard",this.refreshOnInsertDelete,this),f.l.add(e,"cut",this.cut,this),f.l.add(e,"copy",this.copy,this),f.l.add(e,"paste",this.paste,this)}},{key:"removeEventListener",value:function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off("cut",this.cut),this.parent.off("copy",this.copy),this.parent.off(Ir,this.paste),this.parent.off("clearCopy",this.clearCopiedInfo),this.parent.off("tabSwitch",this.tabSwitchHandler),this.parent.off(kr,this.cMenuBeforeOpenHandler),this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("contentLoaded",this.initCopyIndicator),this.parent.off("rowHeightChanged",this.rowHeightChanged),this.parent.off("refreshClipboard",this.refreshOnInsertDelete)),f.l.remove(e,"cut",this.cut),f.l.remove(e,"copy",this.copy),f.l.remove(e,"paste",this.paste)}},{key:"ribbonClickHandler",value:function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({isAction:!0});break;case t+"_copy":this.copy({isAction:!0})}ao(this.parent.element)}},{key:"tabSwitchHandler",value:function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()}},{key:"cMenuBeforeOpenHandler",value:function(e){var t=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(kl),n=[],r=[],a=[],s=[],o=Zn(t.activeCell),l=Da(o[0],o[1],t),h=t.isProtected&&Ra(l,gs(t,o[1]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target||(this.parent.enableContextMenuItems([i.getConstant("Paste"),i.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!h)),this.parent.enableContextMenuItems([i.getConstant("Cut")],!h)),"Content"===e.target&&h&&this.parent.enableContextMenuItems([i.getConstant("Cut"),i.getConstant("Filter"),i.getConstant("Sort")],!1),"Content"===e.target&&h&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([i.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&t.isProtected&&(a=[i.getConstant("DeleteColumn"),i.getConstant("DeleteColumns"),i.getConstant("InsertColumn"),i.getConstant("InsertColumns")],s=[i.getConstant("HideColumn"),i.getConstant("HideColumns"),i.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(a,!1),this.parent.enableContextMenuItems(s,!!t.protectSettings.formatColumns)),"RowHeader"===e.target&&t.isProtected&&(n=[i.getConstant("DeleteRow"),i.getConstant("DeleteRows"),i.getConstant("InsertRow"),i.getConstant("InsertRows")],r=[i.getConstant("HideRow"),i.getConstant("HideRows"),i.getConstant("UnHideRows")],this.parent.enableContextMenuItems(n,!1),this.parent.enableContextMenuItems(r,!!t.protectSettings.formatRows))}},{key:"rowHeightChanged",value:function(e){if(this.copiedInfo&&this.copiedInfo.range[0]>e.rowIdx){var t=this.parent.element.getElementsByClassName("e-copy-indicator")[0];t&&(t.style.top="".concat(parseInt(t.style.top,10)+e.threshold,"px"))}}},{key:"cut",value:function(e){this.setCopiedInfo(e,!0)}},{key:"copy",value:function(e){this.setCopiedInfo(e,!1)}},{key:"paste",value:function(e){if(!(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dialog").length>0)){var t;e.isAction=!0;var i,n=e&&e.clipboardData||window.clipboardData,r=this.getCopiedIdx(),a=Object.assign({isExternal:n},this.copiedInfo);if(n||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){var s=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,o=Ka(this.parent,s),l=$n(e&&e.range||Wn(o.selectedRange)),h=n&&this.getExternalCells(e);if(!e.isInternal&&h&&h.internal&&(n=!1,!this.copiedInfo))return;if(n&&!h.length)return;var c=0;if(h)for(var d=0;d<h.length;d++)c=h[d].cells.length>c?h[d].cells.length:c;var u=l[0],p=n?[0,0,h.length-1,c-1]:$n(this.copiedShapeInfo?Wn(o.selectedRange):this.copiedInfo.range),g=(l[2]-l[0]+1)%(p[2]-p[0]+1)==0&&(l[3]-l[1]+1)%(p[3]-p[1]+1)==0;t=g?l:[l[0],l[1]].concat([l[0]+p[2]-p[0],l[1]+p[3]-p[1]||l[1]]);var m,v,y,b={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:Xn(p),pastedRange:Xn(t),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.parent.notify(Ar,{eventArgs:b,action:"clipboard"}),b.cancel)return;var C=[],x=Ka(this.parent,n?s:r),S=tr(p)&&this.isRangeMerged(l,o);u=(l=Wn(b.pastedRange))[0];var w={range:p=n?[0,0,h.length-1,c-1]:$n(this.copiedShapeInfo?Wn(o.selectedRange):this.copiedInfo.range),prevSheet:x,cancel:!1};if(t=(g=(l[2]-l[0]+1)%(p[2]-p[0]+1)==0&&(l[3]-l[1]+1)%(p[3]-p[1]+1)==0&&!S)?l:[l[0],l[1]].concat([l[0]+p[2]-p[0],l[1]+p[3]-p[1]||l[1]]),this.parent.getActiveSheet().isProtected&&so(this.parent,t))return void this.parent.notify("editAlert",null);if(this.copiedShapeInfo&&!this.copiedInfo){var k=this.copiedShapeInfo.pictureElem;k.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify("setChart",{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||o.selectedRange,isIdAvailabe:!1})):this.parent.notify("createImageElement",{options:{src:k.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?k.id:""},range:Xn([u,l[1],u,l[1]]),isPublic:!1,isUndoRedo:!0});var I=Da(u,l[1],o);if(I&&!Object(f.Z)(I.image)){var O=I.image?I.image.length-1:0,R={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:es(this.parent)+"!"+Xn([u,l[1],u,l[1]]),pastedPictureElement:document.getElementById(I.image[O].id)};this.parent.notify(Rr,{eventArgs:R,action:"clipboard"})}}else{if(this.parent.notify("pasteMerge",w),w.cancel)return;for(var A=b.type?b.type:e.type,E=[],L=this.isInRange(p,l,r),T=0===l[1]&&l[3]===o.colCount-1,j=p[0],D=0;j<=p[2];j++,D++){L&&(E[l[0]+D]={cells:[]});for(var M=p[1],F=0;M<=p[3];M++,F++){if(L&&(E[l[0]+D].cells[l[1]+F]=Da(l[0]+D,l[1]+F,x)),(m=n?h[j].cells[M]:Object(f.L)({},L&&E[j]&&E[j].cells[M]?E[j].cells[M]:Da(j,M,x),null,!0))&&e&&e.type||A){switch(A){case"Formats":m={format:m.format,style:m.style};break;case"Values":(m={value:m.value}).value&&m.value.toString().indexOf("\n")>-1&&this.parent.getCell(l[0],l[1]).classList.add("e-alt-unwrap")}v=["Formats","Values"].indexOf(e.type)>-1}if(!this.parent.scrollSettings.isFinite&&(p[2]-p[0]>1048575-l[0]||p[3]-p[1]>16383-l[1])||this.parent.scrollSettings.isFinite&&(p[2]-p[0]>o.rowCount-1-l[0]||p[3]-p[1]>o.colCount-1-l[1]))return void this.showDialog();var P=this.getConditionalFormats(j,M,x);if(g)for(var N=l[0];N<=l[2];N+=p[2]-p[0]+1){var B=!1;if(!a.isCut&&this.parent.filteredRows&&this.parent.filteredRows.rowIdxColl&&this.parent.filteredRows.sheetIdxColl)for(var H=0,_=this.parent.filteredRows.sheetIdxColl.length;H<_;H++)if(this.parent.filteredRows.sheetIdxColl[H]===s&&this.parent.filteredRows.rowIdxColl[H]===N+D){B=!0;break}if(!B)for(var z=l[1];z<=l[3];z+=p[3]-p[1]+1){if(y=Da(N+D,z+F,o)||{},!n&&(void 0!==y.colSpan||void 0!==y.rowSpan)){if(T)continue;var V={range:(w={range:[N+D,z+F,N+D,z+F]}).range,merge:!1,isAction:!1,type:"All"};C.push(V),this.parent.activeSheetIndex===o.index&&this.parent.notify(fr,V)}var U=z+F;if(m=Object(f.L)({},m||{},null,!0),!v){var q=Ea([N+D,U],[j,M],x);Object(f.Z)(q)||(m.formula=q)}this.setConditionalFormats(P,N+D,U,o),this.parent.getActiveSheet().isProtected&&m&&(Object(f.Z)(m.isLocked)||!0===m.isLocked)&&(m.isLocked=y.isLocked),this.setCell(N+D,U,o,m,v,!1,!!P.length||z===l[3],n);var W=this.parent.activeSheetIndex,Z=this.parent.getCell(N+D,U),G=Yn(N+D,U),Y={address:this.parent.sheets[W].name+"!"+G,requestType:"paste",value:Da(N+D,U,o)?Da(N+D,U,o).value:"",oldValue:y.value,element:Z,displayText:this.parent.getDisplayText(m)};this.parent.trigger("cellSave",Y)}}else!n&&Xs(this.parent,j,M,r)||(S?this.setCell(u,l[1]+F,o,{value:m.value},!0,!1,M===p[3]):this.setCell(u,l[1]+F,o,m,v,!1,M===p[3]));if(!n&&this.copiedInfo.isCut&&(!Ia(l,j,M)||r!==this.parent.activeSheetIndex)){var X=Da(j,M,x);X&&(X.isLocked||Object(f.Z)(X.isLocked)?X=null:!1===X.isLocked&&(X=this.parent.getActiveSheet().isProtected?{isLocked:!1}:null)),this.setCell(j,M,x,X,!1,!0,M===p[3])}}u++}if(this.parent.notify("refreshRibbonIcons",null),this.parent.setUsedRange(t[2],t[3]),s===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{address:Xn(t)}),!n&&this.copiedInfo.isCut&&(i=this.copiedInfo.isCut,r===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(p),this.clearCopiedInfo()),(n||L)&&this.copiedInfo&&this.clearCopiedInfo(),(n||e&&e.isAction)&&ao(this.parent.element),e.isAction){var K=a&&a.sId?Za(this.parent,a.sId):this.parent.activeSheetIndex,J={requestType:"paste",copiedInfo:a,mergeCollection:C,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:this.parent.sheets[K].name+"!"+Xn(a&&a.range?a.range:Wn(this.parent.sheets[K].selectedRange)),pastedRange:es(this.parent)+"!"+Xn(t),type:A||"All"};this.parent.notify(Rr,{eventArgs:J,action:"clipboard"})}if(i){this.updateFilter(a,t),io(x,p[0],p[1],this.parent.getCell(p[0],p[1]).offsetHeight);var Q=no(x,p[0]);Ks(this.parent,x,Q,p[0])}var $=Ka(this.parent,r);if(!n&&p[0]===p[2]&&p[3]-p[1]==$.colCount-1){for(var ee=$.rows[p[0]].height,te=l[0];te<=l[2];te++)Ks(this.parent,this.parent.getActiveSheet(),ee,te);i&&Ks(this.parent,$,20,p[0])}}}else this.getClipboardEle().select()}}},{key:"getConditionalFormats",value:function(e,t,i){var n=[];if(i.conditionalFormats)for(var r=0;r<i.conditionalFormats.length;r++)Ia(Wn(i.conditionalFormats[r].range),e,t)&&n.push(Object(f.L)({},i.conditionalFormats[r]));return n}},{key:"setConditionalFormats",value:function(e,t,i,n){for(var r=0;r<e.length;r++)n.conditionalFormats.push(Object(f.L)({},e[r].properties||e[r],{range:Xn([t,i])}))}},{key:"isRangeMerged",value:function(e,t){var i=Da(e[0],e[1],t);if(i&&(i.colSpan>1||i.rowSpan>1)){var n={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(mr,n),n.range[0]===e[0]&&n.range[1]===e[1]&&n.range[2]===e[2]&&n.range[3]===e[3]}return!1}},{key:"updateFilter",value:function(e,t){var i,n;this.parent.notify("getFilteredCollection",null);for(var r=0;r<this.parent.sheets.length;r++)if(this.parent.filterCollection&&this.parent.filterCollection[r]&&this.parent.filterCollection[r].sheetIndex===Za(this.parent,e.sId)){var a=e.range,s=Wn(this.parent.filterCollection[r].filterRange);a=$n(a),s[0]===a[0]&&s[2]===a[2]&&s[1]===a[1]&&s[3]===a[3]&&(i=!0,n=[Math.abs(a[0]-s[0]),Math.abs(a[1]-s[1]),Math.abs(a[2]-s[2]),Math.abs(a[3]-s[3])])}var o=this.parent.getCell(e.range[0],e.range[1]),l=(o=o?o.querySelector(".e-filter-icon")?o:this.parent.getCell(e.range[2],e.range[3]):o)?o.querySelector(".e-sortasc-filter"):o,h=o?o.querySelector(".e-sortdesc-filter"):o;if(i)for(var c=0;c<this.parent.filterCollection.length;c++){var d=this.parent.filterCollection[c],u=e&&e.sId?Za(this.parent,e.sId):this.parent.activeSheetIndex;if(d.sheetIndex===u&&this.parent.notify("initiateFilterUI",{predicates:null,range:d.filterRange,sIdx:u,isCut:!0}),d.sheetIndex===u&&u===this.parent.activeSheetIndex&&(n=[t[0]+n[0],t[1]+n[1],Math.abs(t[2]-n[2]),Math.abs(t[3]-n[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:Xn(n),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var p=this.parent.getCell(t[0],t[1]);l&&p&&p.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),h&&p&&p.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}}},{key:"isInRange",value:function(e,t,i){var n=this.parent.activeSheetIndex;return Ia(e,t[0],t[1])&&i===n||Ia(e,t[2],t[3])&&i===n}},{key:"setCell",value:function(e,t,i,n,r,a,s,o){var l=i?Za(this.parent,i.id):null;if(Ma(e,t,i,n,r),n&&n.formula&&this.parent.notify(pr,{action:"refreshCalculate",value:a?"":n.formula,rowIndex:e,colIndex:t,sheetIndex:this.parent.activeSheetIndex,isFormula:!0}),n&&!n.formula&&this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e,t,e,t],value:n.value,sheetIndex:l}),i.name===this.parent.getActiveSheet().name&&this.parent.serviceLocator.getService("cell").refresh(e,t,s),n&&n.style&&o){var h=to(this.parent,e,t,i,n.style||this.parent.cellStyle,n.wrap?$s(this.parent.getDisplayText(n),eo(i,e,t),n.style,this.parent.cellStyle):1);(h=Math.round(h))<20&&(h=20),io(i,e,t,h);var c=ps(i,e),d=no(i,e);d>c&&Ks(this.parent,i,d,e)}}},{key:"getCopiedIdx",value:function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1}},{key:"setCopiedInfo",value:function(e,t){var i=this;if(!this.parent.isEdit){var n=new m.d;e.promise=n.promise;var r,a=this.parent.getActiveSheet();if(e&&e.range){var s={range:e.range};this.parent.notify("mergedRange",s),r=s.range}else r=Wn(a.selectedRange);var o={sheet:a,indexes:[0,0,a.rowCount-1,a.colCount-1],promise:new Promise(function(e,t){e(void 0)})},l=document.getElementsByClassName("e-ss-overlay-active"),h=l.length;!a.isLocalData||e&&e.clipboardData||0!==r[0]||r[2]!==a.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",o)),o.promise.then(function(){if(h>0){var s={clientY:l[0].offsetTop,isImage:!0};i.parent.notify("getRowIdxFromClientY",s);var o={clientX:l[0].offsetLeft,isImage:!0};i.parent.notify("getColIdxFromClientX",o),i.copiedShapeInfo={sId:e&&e.sId?e.sId:a.id,sheetIdx:a.index,isCut:t,pictureElem:l[0],copiedRange:Xn([s.clientY,o.clientX,s.clientY,o.clientX]),height:l[0].offsetHeight,width:l[0].offsetWidth,chartInfo:i.getChartElemInfo(l[0])},i.hidePaste(!0),t&&(l[0].classList.contains("e-datavisualization-chart")?i.parent.deleteChart(i.copiedShapeInfo.chartInfo.id):i.parent.notify("deleteImage",{id:i.copiedShapeInfo.pictureElem.id,sheetIdx:i.copiedShapeInfo.sId,range:i.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(i.copiedInfo&&i.clearCopiedInfo(),i.copiedInfo={range:r,sId:e&&e.sId?e.sId:a.id,isCut:t},i.hidePaste(!0),i.initCopyIndicator(),f.d.isIE||i.getClipboardEle().select(),e&&e.isAction&&document.execCommand(t?"cut":"copy"),i.parent.hideSpinner());f.d.isIE&&i.setExternalCells(e),n.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e),ao(this.parent.element))}}},{key:"getChartElemInfo",value:function(e){var t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var i=e.getElementsByClassName("e-control")[0].id,n=0;n<t.length;n++)if(t[n].id===i)return t[n];return null}},{key:"clearCopiedInfo",value:function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())}},{key:"removeIndicator",value:function(e){if(e){var t=e.querySelector(".e-copy-indicator");t&&Object(f.J)(t)}}},{key:"initCopyIndicator",value:function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),Es(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}}},{key:"showDialog",value:function(){var e=this;this.parent.serviceLocator.getService(Il).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(kl).getConstant("PasteAlert"),beforeOpen:function(t){var i={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0)}})}},{key:"hidePaste",value:function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify("enableToolbarItems",[{items:[this.parent.element.id+"_paste"],enable:e||!1}])}},{key:"setExternalCells",value:function(e){for(var t,i="",n=this.copiedInfo.range,r=this.parent.getActiveSheet(),a='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>',s=n[0];s<=n[2];s++){a+="<tr>";for(var o=n[1];o<=n[3];o++){if(t=Da(s,o,r),a+='<td style="white-space:'+(t&&t.wrap?"normal":"nowrap")+';vertical-align:bottom;"',t&&t.format&&"General"!==t.format&&(a+=t.format.includes('"')?" number-format='"+t.format+"'":' number-format="'+t.format+'"'),t&&t.style&&Object.keys(t.style).forEach(function(e){var i=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":i?e.replace(i[0],"-"+i[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?t.style[e].slice(0,7):t.style[e])+";"}),t&&!Object(f.Z)(t.value)){var l={formattedText:t.value,value:t.value,format:t.format,onLoad:!0};t.format&&"General"!==t.format&&(a+=t.value.toString().includes('"')?" cell-value='"+t.value+"'":' cell-value="'+t.value+'"',this.parent.notify("getFormattedCell",l)),a+=">",a+=l.formattedText,i+=l.formattedText,a+="</td>"}else a+="></td>";i+=o===n[3]?"":"\t"}a+="</tr>",i+=s===n[2]?"":"\n"}a+="</tbody></table></body></html>",f.d.isIE?window.clipboardData.setData("text",i):(e.clipboardData.setData("text/html",a),e.clipboardData.setData("text/plain",i),e.preventDefault())}},{key:"getExternalCells",value:function(e){var t,i,n,r=this,a=[],s=[],o=this.parent.createElement("span");if(f.d.isIE?i=window.clipboardData.getData("text"):(t=e.clipboardData.getData("text/html"),i=e.clipboardData.getData("text/plain"),o.innerHTML=t),o.querySelector("table"))if(o.querySelector(".e-spreadsheet")&&this.copiedInfo)a={internal:!0};else{var l,h=0;[].slice.call(o.querySelectorAll("tr")).forEach(function(e){a[h]||(a[h]={cells:[]}),s=a[h].cells,l=0,[].slice.call(e.querySelectorAll("td")).forEach(function(e){if(s[l]&&(l=r.getNewIndex(s,l)),s[l]={},n=r.getStyle(e,o),e.textContent=e.textContent.replace(/(\r\n|\n|\r)/gm,""),e.textContent=e.textContent.replace(/\s+/g," "),n.whiteSpace&&(s[l].wrap=!0,delete n.whiteSpace),Object.keys(n).length&&(n.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){n[e]=n.border}),delete n.border),s[l].style=n),e.textContent&&(s[l].value=cr(e.textContent.trim())),e.getAttribute("number-format")&&(s[l].format=e.getAttribute("number-format"),s[l].value&&e.getAttribute("cell-value")&&(s[l].value=cr(e.getAttribute("cell-value").trim()))),e.getAttribute("colspan")&&parseInt(e.getAttribute("colspan"),10)>1&&(s[l].colSpan=parseInt(e.getAttribute("colspan"),10)),e.getAttribute("rowspan")&&parseInt(e.getAttribute("rowspan"),10)>1&&(s[l].rowSpan=parseInt(e.getAttribute("rowspan"),10)),s[l].colSpan>1&&s[l].rowSpan>1)for(var t,i=h,c=h+s[l].rowSpan;i<c;i++)for(var d=l,u=l+s[l].colSpan;d<u;d++)i===h&&d===l||(t=s[l].style?{style:Object(f.L)({},s[l].style)}:{},i!==h&&(t.rowSpan=h-i),d!==l&&(t.colSpan=l-d),a[i]||(a[i]={cells:[]}),a[i].cells[d]=t);else if(s[l].colSpan>1)for(var p=l+1,g=l+s[l].colSpan;p<g;p++)s[p]={colSpan:l-p,style:Object(f.L)({},n)};else if(s[l].rowSpan>1)for(var m=h+1,v=h+s[l].rowSpan;m<v;m++)a[m]||(a[m]={cells:[]}),a[m].cells[l]={rowSpan:h-m,style:Object(f.L)({},n)};l++}),h++})}else if(i){var c,d;t&&(c=[].slice.call(o.children)),i.split("\n").forEach(function(e,i){n=null,t&&((d=c.filter(function(t){return t.textContent&&t.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===e.trim()})[0])&&(n=r.getStyle(d,o),c.splice(c.indexOf(d),1))),e.trim().split("\t").forEach(function(e,t){(e||n)&&(s[t]={},n&&(n.whiteSpace?(s[t].wrap=!0,delete n.whiteSpace,Object.keys(n).length&&(s[t].style=n)):s[t].style=n),e&&(Sa(e)?s[t].formula=e:s[t].value=cr(e.trim())))}),a.push({cells:s}),s=[]})}return setTimeout(function(){r.getClipboardEle().innerHTML=""},0),a}},{key:"getNewIndex",value:function(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t}},{key:"getStyle",value:function(e,t){var i=[],n={},r=Object.keys(this.parent.commonCellStyle);if(t.querySelector("style")&&e.classList.length&&t.querySelector("style").innerHTML.indexOf(e.classList[0])>-1){var a=t.querySelector("style").innerHTML.split(e.classList[0]);i.push(a[a.length-1].split("{")[1].split("}")[0])}var s=[].slice.call(e.querySelectorAll("*"));if(s.unshift(e),s.forEach(function(e){e.getAttribute("style")&&i.push(e.getAttribute("style")),"B"===e.tagName&&i.push("font-weight:bold")}),r.length&&t.querySelector("style")){var o=t.querySelector("style").innerHTML.includes("td")?t.querySelector("style").innerHTML.split("td")[1]:t.querySelector("style").innerHTML;o=o.includes("{")?o.split("{")[1].split("}")[0]:o.split("}")[0];for(var l=0;l<r.length;l++){var h=r[l],c=h.match(/[A-Z]/);c&&(h=h.replace(c[0],"-"+c[0].toLowerCase())),o.indexOf(h)>-1&&(n[r[l]]=o.split(h+":")[1].split(";")[0])}}return i.forEach(function(e){e.split(";").forEach(function(e){var t=e.split(":")[0].trim();if(["font-family","vertical-align","text-align","text-indent","color","background","font-weight","font-style","font-size","text-decoration","border-bottom","border-top","border-right","border-left","border","white-space"].indexOf(t)>-1){var i=(t="background"===t?"backgroundColor":t).match(/-[a-z]/),r=e.split(":")[1];n[i?t.replace(i[0],i[0].charAt(1).toUpperCase()):t]="font-weight"===t&&-1===["bold","normal"].indexOf(r)?r>"599"?"bold":"normal":r}})}),e.innerHTML.indexOf("<s>")>-1&&(n.textDecoration="line-through"),this.defaultCellStyle(n)}},{key:"defaultCellStyle",value:function(e){var t=e.fontSize?e.fontSize.trim():null;return e.textDecoration&&["underline","line-through","underline line-through","none"].indexOf(e.textDecoration.trim())<0&&(e.textDecoration="none"),e.textAlign&&["left","center","right"].indexOf(e.textAlign.trim())<0&&(e.textAlign="left"),e.verticalAlign&&["bottom","middle","top"].indexOf(e.verticalAlign.trim())<0&&(e.verticalAlign="bottom"),t&&(t=t.indexOf("px")>-1?.75*parseFloat(t)+"pt":t,e.fontSize=Math.round(parseFloat(t))+"pt"),e}},{key:"refreshOnInsertDelete",value:function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){var i=e.end-e.start+1;t[1]+=i,t[3]+=i}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){var n=e.end-e.start+1;t[0]+=n,t[2]+=n}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}}},{key:"performAction",value:function(){this.copiedInfo.isCut?this.parent.cut(Xn(this.copiedInfo.range)):this.parent.copy(Xn(this.copiedInfo.range))}},{key:"getClipboardEle",value:function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]}},{key:"getModuleName",value:function(){return"clipboard"}},{key:"destroy",value:function(){this.removeEventListener();var e=this.getClipboardEle();Object(f.J)(e),this.parent=null}}]),e}(),uo=function(){function e(t){a(this,e),this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&"],this.formulaBarCurStartPos=null,this.curEndPos=null,this.curStartPos=null,this.selectionStart=null,this.selectionEnd=null,this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null,this.editorElem=null}},{key:"addEventListener",value:function(){f.l.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on(Sr,this.keyUpHandler,this),this.parent.on(wr,this.keyDownHandler,this),this.parent.on(xr,this.performEditOperation,this),this.parent.on("initiateCur",this.initiateCurPosition,this),this.parent.on("editValue",this.updateFormulaBarValue,this),this.parent.on("addressHandle",this.addressHandler,this),this.parent.on("initiateEdit",this.initiateRefSelection,this),this.parent.on("forRefSelRender",this.refSelectionRender,this),this.parent.on("checkUniqueRange",this.checkUniqueRange,this),this.parent.on("reApplyFormula",this.reApplyFormula,this)}},{key:"removeEventListener",value:function(){f.l.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off(Sr,this.keyUpHandler),this.parent.off(wr,this.keyDownHandler),this.parent.off(xr,this.performEditOperation),this.parent.off("initiateCur",this.initiateCurPosition),this.parent.off("editValue",this.updateFormulaBarValue),this.parent.off("addressHandle",this.addressHandler),this.parent.off("initiateEdit",this.initiateRefSelection),this.parent.off("forRefSelRender",this.refSelectionRender),this.parent.off("checkUniqueRange",this.checkUniqueRange),this.parent.off("reApplyFormula",this.reApplyFormula))}},{key:"getModuleName",value:function(){return"edit"}},{key:"performEditOperation",value:function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var t={isEdit:!1};this.parent.notify("isFormulaBarEdit",t),t.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}}},{key:"keyUpHandler",value:function(e){if(this.isEdit){var t=this.getEditElement(this.parent.getActiveSheet());if(e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&this.refreshEditor(t.textContent,this.isCellEdit),Sa(this.editCellData.value,!0)&&(!e||16!==e.keyCode)&&(this.updateFormulaReference(t),this.endFormulaRef)){var i=this.getCurPosition();i.end&&this.validCharacters.indexOf(this.editCellData.value[i.end-1])>-1&&(this.endFormulaRef=!1)}}}},{key:"updateFormulaReference",value:function(e){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex})}},{key:"keyDownHandler",value:function(e){var t=e.target,i=e.keyCode,n=this.parent.getActiveSheet(),r=Zn(n.activeCell),a=Da(r[0],r[1],n)||{};if(!Object(f.D)(e.target,".e-findtool-dlg")&&!Object(f.D)(e.target,".e-validationerror-dlg")&&!Object(f.D)(e.target,".e-hyperlink-dlg"))if(n.isProtected&&!Object(f.D)(e.target,".e-sheet-rename")&&Ra(a,gs(n,r[1]))){if((i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET||i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER||i===this.keyCodes.DELETE||i===this.keyCodes.BACKSPACE||i===this.keyCodes.SPACE||i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD||i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND||i>=219&&i<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&i===this.keyCodes.F2)&&67!==i&&89!==i&&90!==i){if(n.protectSettings.insertLink&&75===i)return;this.parent.element.querySelector(".e-editAlert-dlg")||e.ctrlKey||70===e.keyCode||t.parentElement.classList.contains("e-unprotectpwd-content")||t.parentElement.classList.contains("e-password-content")||this.parent.notify("editAlert",null)}}else if(this.isEdit){var s=this.getEditElement(n),o=Sa(this.editCellData.value,!0);if((this.isCellEdit||o&&this.editCellData.value!==s.textContent&&16!==e.keyCode)&&(r[1]<this.parent.frozenColCount(n)&&(!n.frozenRows||r[0]>=this.parent.frozenRowCount(n))&&s&&"auto"!==s.style.height&&Qs(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)&&(s.style.height="auto"),Qs(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)-5&&(s.style.height="auto"),r[0]<this.parent.frozenRowCount(n)&&s&&!s.style.overflow&&Qs(s.textContent,a.style,this.parent.cellStyle)>parseInt(s.style.maxWidth,10)&&(s.style.overflow="auto"),this.refreshEditor(s.textContent,this.isCellEdit)),!e.altKey)switch(i){case this.keyCodes.ENTER:if(f.d.isWindows&&e.preventDefault(),this.isAltEnter){var l=s.textContent;l&&l.indexOf("\n")>-1&&(Pa(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(s.textContent,this.isCellEdit),this.isAltEnter=!1)}if(o){var h=this.parent.element.querySelector(".e-formularef-indicator");h&&h.parentElement.removeChild(h),this.editCellData.sheetIndex===n.id-1||this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e)}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(!this.isEdit&&(t.classList.contains("e-spreadsheet")||Object(f.D)(t,".e-sheet-panel"))){var c=i>=this.keyCodes.FIRSTALPHABET&&i<=this.keyCodes.LASTALPHABET,d=i>=this.keyCodes.FIRSTNUMBER&&i<=this.keyCodes.LASTNUMBER,u=i>=this.keyCodes.FIRSTNUMPAD&&i<=this.keyCodes.LASTNUMPAD,p=i>=this.keyCodes.SYMBOLSETONESTART&&i<=this.keyCodes.SYMBOLSETONEEND;p||(p=i>=this.keyCodes.SYMBOLSETTWOSTART&&i<=this.keyCodes.SYMBOLSETTWOEND);var g=i===this.keyCodes.FIREFOXEQUALPLUS||i===this.keyCodes.FIREFOXMINUS,m=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&i===this.keyCodes.F2,v=i===this.keyCodes.BACKSPACE;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&i===this.keyCodes.SPACE||c||d||u||p||"mozilla"===f.d.info.name&&g)||m||v){m&&(this.isNewValueEdit=!1);var y=document.getElementsByClassName("e-ss-overlay-active");y.length>0?i===this.keyCodes.DELETE&&this.parent.notify("deleteImage",{id:y[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.startEdit(null,null,!0,!0)}i===this.keyCodes.DELETE&&(n.isProtected&&so(this.parent)?this.parent.notify("editAlert",null):(this.editingHandler("delete"),this.parent.notify("activeCellChanged",null)))}}},{key:"renderEditor",value:function(){if(!this.editorElem||!Object(f.ob)("#"+this.parent.element.id+"_edit",this.parent.element)){var e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit"});e.contentEditable="true",e.spellcheck=!1,this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove(),this.parent.element.querySelector(".e-sheet-content").appendChild(e),this.editorElem=e}this.parent.notify("formulaOperation",{action:"renderAutoComplete"})}},{key:"refreshEditor",value:function(e,t,i,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e;var a=this.getEditElement(this.parent.getActiveSheet());i&&(a.textContent=e),t&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:e}),r&&this.editCellData.value===a.textContent&&this.triggerEvent("cellEditing")&&this.cancelEdit()}},{key:"startEdit",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var r=this.parent.getActiveSheet(),a=Zn(r.activeCell),s=Da(a[0],a[1],r,!1,!0);if(Xs(this.parent,a[0],a[1],this.parent.activeSheetIndex)){var o=this.parent.getCell(a[0],a[1]),l=!1,h=o.innerHTML;if(o&&h.indexOf("<")>-1&&h.indexOf(">")>-1&&h.indexOf("input")>-1&&(l=!0),l)return}this.updateEditCellDetail(e,t),this.initiateEditor(i),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify("clearCopy",null),this.parent.notify("enableToolbarItems",[{enable:!1}]),s.formula&&!n&&this.parent.notify("initiateFormulaReference",{range:s.formula,formulaSheetIdx:this.editCellData.sheetIndex})}},{key:"setCursorPosition",value:function(){var e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){var i=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),i.removeAllRanges(),i.addRange(n)}e.focus()}},{key:"hasFormulaSuggSelected",value:function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0}},{key:"editingHandler",value:function(e){var t,i=document.getElementsByClassName("e-ss-overlay-active"),n=i.length;switch(e){case"delete":if(n>0)i[0].classList.contains("e-datavisualization-chart")?this.parent.notify("deleteChart",{id:i[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify("deleteImage",{id:i[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var r=this.parent.getActiveSheet(),a=r.selectedRange,s=Jn(a);a=Xn(s=s[0]>s[2]?$n(s):s),this.parent.notify(Ar,{action:"cellDelete",eventArgs:{address:r.name+"!"+a}}),this.parent.clearRange(a,null,!0),this.parent.serviceLocator.getService("cell").refreshRange(s),this.parent.notify("selectionComplete",{}),this.parent.notify(Rr,{action:"cellDelete",eventArgs:{address:r.name+"!"+a}});var o={cellIdx:s,isUnique:!1};if(this.checkUniqueRange(o),o.isUnique){var l=Wn(this.uniqueColl),h=Da(l[0],l[1],this.parent.getActiveSheet());h&&(t=h.value.indexOf("#SPILL!")>-1)}if(o.isUnique&&this.uniqueColl.split(":")[0]===a.split(":")[0])this.updateUniqueRange(""),this.parent.notify("removeUniquecol",null),this.uniqueColl="";else if(o.isUnique){var c=Wn(this.uniqueColl);if("#SPILL!"===Da(c[0],c[1],r).value){for(var d=!1,u=c[0];u<=c[2];u++)for(var p=c[1];p<=c[3];p++){var g=Da(u,p,r);u===c[0]&&p===c[1]?d=!1:Object(f.Z)(g.value)||""===g.value||(d=!0)}d||this.reApplyFormula()}}this.parent.notify(Rr,o.isUnique?{action:"cellDelete",eventArgs:{address:r.name+"!"+a,isSpill:t}}:{action:"cellDelete",eventArgs:{address:r.name+"!"+a}})}}}},{key:"getCurPosition",value:function(){var e={},t=window.getSelection();if(this.editorElem.textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){var i=e.start;e.start=e.end,e.end=i}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")&&this.editorElem.textContent===this.editCellData.value){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];e.start=n.selectionStart,e.end=n.selectionEnd}return e}},{key:"mouseDownHandler",value:function(e){if(!Object(f.D)(e.target,".e-findtool-dlg")&&this.isEdit){var t=this.getCurPosition();t.start&&(this.curStartPos=this.selectionStart=t.start),t.end&&(this.curEndPos=this.selectionEnd=t.end);var i=e.target,n=this.parent.getActiveSheet(),r=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=i.classList.contains("e-spreadsheet-edit");var a=Sa(this.editCellData.value,!0),s=this.getEditElement(n);if(i.classList.contains("e-cell")||i.classList.contains("e-header-cell")||i.classList.contains("e-selectall")||Object(f.D)(i,".e-toolbar-item.e-active")||Object(f.D)(i,".e-table")){if(this.isAltEnter){var o=s.textContent;o&&o.indexOf("\n")>-1&&(this.isAltEnter=!1,Pa(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(s.textContent,this.isCellEdit))}if(!a||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{var l=this.selectionEnd,h=Zn(n.activeCell),c=Da(h[0],h[1],n);if(this.selectionStart!==this.selectionEnd&&this.editCellData.value===s.textContent&&-1!==this.validCharacters.indexOf(s.textContent.substring(this.selectionStart-1,this.selectionStart))&&wa(s.textContent.substring(this.selectionStart,this.selectionEnd))&&s.textContent.indexOf(":")!==this.selectionEnd&&(this.editCellData.value=s.textContent.substring(0,this.selectionStart)+s.textContent.substring(this.selectionEnd,s.textContent.length)),this.editCellData.value===s.textContent&&s.textContent.indexOf("(")!==s.textContent.length-1&&-1!==s.textContent.indexOf("(")&&this.selectionStart===this.selectionEnd)if(this.editCellData.sheetIndex!==n.id-1){var d=this.parent.element.querySelector(".e-formula-bar");if(","!==s.textContent.substring(d.selectionEnd-1,d.selectionEnd)&&!e.shiftKey)return r&&r.parentElement.removeChild(r),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(s.textContent.substring(l-1,l)))return r&&r.parentElement.removeChild(r),void this.endEdit(!1,e);if(!c)return;if((a=!!c.formula&&(Sa(Da(h[0],h[1],n).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){var u=this.selectionEnd;this.editCellData.value.length===u?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||hr(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(r&&r.parentElement.removeChild(r),this.endEdit(!1,e)):this.editCellData.value===s.textContent&&(-1===this.validCharacters.indexOf((this.editCellData.value+n.selectedRange).substring(u-1,u))||-1===this.validCharacters.indexOf(s.textContent.substring(u-1,u))||")"!==s.textContent.substring(u,u+1)&&-1===this.validCharacters.indexOf(s.textContent.substring(u,u+1)))&&(r&&r.parentElement.removeChild(r),this.endEdit(!1,e))}}}else if(a&&this.editCellData.value===s.textContent&&s.textContent.indexOf("(")!==s.textContent.length-1&&!this.isCellEdit&&-1===this.validCharacters.indexOf(this.editCellData.value.substring(this.selectionStart-1,this.selectionStart))&&this.editCellData.sheetIndex===n.id-1){var p=window.getSelection().focusOffset;if(-1===this.validCharacters.indexOf(s.textContent.substring(p-1,p)))return r&&r.parentElement.removeChild(r),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}}}},{key:"dblClickHandler",value:function(e){var t=e.target,i=this.parent.getActiveSheet(),n=Zn(i.activeCell),r=Da(n[0],n[1],i)||{};if(!Object(f.D)(t,".e-datavisualization-chart"))if(i.isProtected&&Ra(r,gs(i,n[1])))(t.classList.contains("e-active-cell")||t.classList.contains("e-cell"))&&this.parent.notify("editAlert",null);else if(t.className.indexOf("e-ss-overlay")<0&&(t.classList.contains("e-active-cell")||t.classList.contains("e-cell")||Object(f.D)(t,".e-sheet-content")||t.classList.contains("e-table")))if(this.isEdit)if(Sa(this.editCellData.value)){var a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===a&&this.endEdit()}else t.className.indexOf("e-spreadsheet-edit")<0&&this.endEdit();else this.isNewValueEdit=!1,this.startEdit()}},{key:"updateEditCellDetail",value:function(e,t){var i,n;if(i=Object(f.Z)(this.editCellData.sheetIndex)?e&&e.split("!").length>1?Wa(this.parent,Ga(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?Sa(this.editCellData.value,!0)&&(n=Ka(this.parent,i),this.isNewValueEdit=!1):(n=Ka(this.parent,i),e=e?Qn(e):n.activeCell),e){var r=Wn(e),a=r[0],s=r[1],o=this.parent.getCell(a,s),l=As(n,r,this.parent.frozenRowCount(n),this.parent.frozenColCount(n),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:es(this.parent,i)+"!"+e,rowIndex:a,colIndex:s,sheetIndex:i,element:o,value:t||"",position:l}}}},{key:"initiateEditor",value:function(e){var t=this;this.parent.getData(this.editCellData.fullAddr).then(function(i){i.forEach(function(i){var n={cell:i,value:i?i.value:""};t.parent.notify("getFormattedBarText",n);var r=i?n.value:"";i&&i.formula&&(r=i.formula),t.editCellData.oldValue=r,t.editCellData.value?r=t.editCellData.value:t.editCellData.value=r,t.isNewValueEdit?r="":t.isNewValueEdit=!0,Object(f.cb)(r)||t.refreshEditor(r,!1,!0,!1,!1),e&&t.setCursorPosition(),t.triggerEvent("cellEdit")&&t.cancelEdit(!0,!1)})})}},{key:"positionEditor",value:function(e){var t,i=this.editCellData.element,n={isEdit:!1};if(this.parent.notify("isFormulaBarEdit",n),n.isEdit&&Object(f.Z)(i)&&(i=t=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=t),i){i.classList.add("e-ss-edited");var r=this.parent.getActiveSheet(),a=Da(this.editCellData.rowIndex,this.editCellData.colIndex,r,!1,!0),s=this.editCellData.position.left+1,o=this.editCellData.position.top+1,l={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(mr,l);var h,c,d,u,p=ps(r,l.range[0],l.range[2])-3,g=vs(r,l.range[1],l.range[3])-3,m=this.parent.element.getElementsByClassName("e-main-panel")[0],v=this.parent.frozenColCount(r),y=this.parent.frozenRowCount(r);this.editCellData.colIndex<v?(h=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-i.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<y?"2"===this.parent.getRowHeaderContent().style.zIndex&&(c="3"):Qs(a.value,a.style,this.parent.cellStyle)>h&&(u=!0)):h=m.offsetWidth-s-28-this.parent.sheetModule.getRowHeaderWidth(r),this.editCellData.rowIndex<y&&(d=!0);var b="display:block;top:"+o+"px;"+(this.parent.enableRtl?"right:":"left:")+s+"px;min-width:"+g+"px;max-width:"+(a&&a.wrap?g:h)+"px;height:"+(!d&&(a&&a.wrap||i&&e||u)?"auto;":p+"px;")+(a&&a.wrap?"width:"+g+"px;":"")+"min-height:"+p+"px;"+(c?"z-index: "+c+";":"")+(d&&(a&&!a.wrap||i&&e)&&(Qs(a.value,a.style,this.parent.cellStyle)>h||i&&e)?"overflow: auto;":"");b+=i.style.cssText;var C=this.getEditElement(r,!0);C.setAttribute("style",b),Qs(C.textContent,a.style,this.parent.cellStyle)>h&&(C.style.height="auto"),this.parent.element.querySelector(".e-active-cell").style.height=p+4+"px",i.classList.contains("e-right-align")?C.classList.add("e-right-align"):i.classList.contains("e-center-align")&&C.classList.add("e-center-align")}}},{key:"updateEditedValue",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.editCellData.oldValue,i=this.editCellData.value,n=t?t.toString().toUpperCase():"",r=!0,a=this.editCellData.addr,s=Wn(this.parent.getActiveSheet().activeCell),o=this.parent.getActiveSheet(),l=Da(s[0],s[1],o),h=gs(o,s[1]);t&&t.toString().indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify("removeUniquecol",null);var c={cellIdx:s,isUnique:!1};this.checkUniqueRange(c);var d=c.isUnique;if(d&&""!==t&&""===this.editCellData.value){var u=Wn(this.uniqueColl);if(-1===Da(u[0],u[1],o).value.indexOf("#SPILL!"))return r}if(this.parent.notify("setActionData",{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&(l&&l.validation||h&&h.validation)){var p,g=this.getEditElement(o).innerText,m=!0,v=this.parent.activeSheetIndex;p="string"==typeof a?Wn(a):a,this.parent.notify("isValidation",{value:g,range:p,sheetIdx:v,isCell:m}),r=this.parent.allowDataValidation,this.editCellData.value=r?g:this.editCellData.value,this.parent.allowDataValidation=!0}if((t!==this.editCellData.value||n.indexOf("=RAND()")>-1||n.indexOf("RAND()")>-1||n.indexOf("=RANDBETWEEN(")>-1||n.indexOf("RANDBETWEEN(")>-1)&&r){var y=this.parent.getActiveSheet(),b=Wn(y.activeCell);this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value});var C=Da(b[0],b[1],y,!0),x=this.getRefreshNodeArgs(C,b[0],b[1]);if(this.editCellData.value=x.value,C&&C.formula&&(this.editCellData.formula=C.formula),C&&C.wrap&&this.parent.notify("wrapText",{range:b,wrap:!0,sheet:y}),e&&this.parent.refreshNode(this.editCellData.element,x),d){var S=Wn(this.uniqueColl);if(Da(S[0],S[1],y).value.indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==t&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&t!==this.editCellData.formula){for(var w=!1,k=S[0];k<=S[2];k++)for(var I=S[1];I<=S[3];I++){var O=Da(k,I,y);k===S[0]&&I===S[1]?w=!1:Object(f.Z)(O.value)||""===O.value||(w=!0)}w||this.reApplyFormula()}else this.updateUniqueRange(i)}}return r}},{key:"checkUniqueRange",value:function(e){var t={range:[]};this.parent.notify("getUniqueRange",t);for(var i=t.range,n=0;n<i.length;n++)for(var r=Wn(i[n]),a=r[0];a<=r[2];a++)for(var s=r[1];s<=r[3];s++)if(e.cellIdx[0]===a&&e.cellIdx[1]===s){e.isUnique=!0,this.uniqueCell=!0,this.uniqueColl=i[n],e.uniqueRange=i[n];break}}},{key:"updateUniqueRange",value:function(e){var t=Wn(this.uniqueColl),i=!1;"#SPILL!"!==Da(t[0],t[1],this.parent.getActiveSheet()).value&&(i=!0);for(var n=t[0];n<=t[2];n++)for(var r=t[1];r<=t[3];r++)i&&(n===t[0]&&r===t[1]?this.parent.updateCell({value:"#SPILL!"},Xn([n,r])):Xn([n,r]).split(":")[0]===this.editCellData.addr?this.parent.updateCell({value:e},Xn([n,r])):this.parent.updateCell({value:""},Xn([n,r])))}},{key:"reApplyFormula",value:function(){var e=Wn(this.uniqueColl),t=Da(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCell({value:""},Xn([e[0],e[1]]));for(var i=this.parent.sheets,n=t.formula,r=0;r<i.length;r++)n.indexOf(i[r].name)>-1&&(n=n.replace(i[r].name,"!"+r));this.parent.computeExpression(n),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")}},{key:"refreshDependentCellValue",value:function(e,t,i){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===i||this.uniqueCell)){var n=this.parent.getCell(e,t);if(n){var r=Ka(this.parent,i),a=Da(e,t,r),s=Wn(r.activeCell);s[0]===e&&s[1]===t&&(this.uniqueActCell=a.value);var o=this.getRefreshNodeArgs(a,e,t);this.parent.refreshNode(n,o)}}}},{key:"getRefreshNodeArgs",value:function(e,t,i){var n={value:(e=e||{}).value,format:e&&e.format?e.format:"",onLoad:!0,rowIdx:t,colIdx:i,formattedText:"",isRightAlign:!1,type:"General",cell:e};return this.parent.notify("getFormattedCell",n),n.formattedText=this.parent.allowNumberFormatting?n.formattedText:n.value,{isRightAlign:n.isRightAlign,result:n.formattedText,type:n.type,value:n.value,curSymbol:n.curSymbol}}},{key:"endEdit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,i=Zn(this.parent.getActiveSheet().activeCell),n=this.parent.getCell(i[0],i[1]),r="";this.editCellData.element&&this.editCellData.element.children[0]&&"e-cf-databar"===this.editCellData.element.children[0].className&&(r=n.children[0].querySelector(".e-databar-value").style.fontSize),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1),this.triggerEvent("beforeCellSave")?t.preventDefault():(this.updateEditedValue()?(this.triggerEvent("cellSave",t),this.resetEditState(),this.focusElement()):t&&t.preventDefault(),""!==r&&(n.children[0].querySelector(".e-databar-value").style.fontSize=r),this.parent.showSheetTabs&&!this.parent.isProtected&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"))}},{key:"cancelEdit",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave",i),this.resetEditState(),this.focusElement()}},{key:"focusElement",value:function(){ao(this.parent.element),this.parent.notify("enableToolbarItems",[{enable:!0}])}},{key:"triggerEvent",value:function(e,t){var i=Da(this.editCellData.rowIndex,this.editCellData.colIndex,this.parent.getActiveSheet()),n={element:this.editCellData.element,value:i?i.value:this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(i)};if(n.address){var r={cellIdx:Wn(n.address),isUnique:!1};this.checkUniqueRange(r),r.isUnique&&(n.isSpill=this.isSpill)}return n.value!==n.oldValue&&("cellSave"===e&&(this.editCellData.formula&&(n.formula=this.editCellData.formula),n.originalEvent=t,this.parent.notify(Rr,{eventArgs:n,action:"cellSave"})),"cellSave"!==e&&(n.cancel=!1)),this.parent.trigger(e,n),n.cancel}},{key:"altEnter",value:function(){this.positionEditor(!0);var e,t=window.getSelection(),i=t.anchorNode,n=document.createRange();0===(e=3===i.nodeType?t.anchorOffset:i.textContent.length)&&i.textContent.length>0&&(e=i.textContent.length);var r=i.textContent,a=r.slice(0,e),s=r.slice(e)||" ";i.textContent=a+"\n"+s,n=document.createRange(),3===i.nodeType?(n.setStart(i,e+1),n.setEnd(i,e+1)):1===i.nodeType&&(n.setStart(i.firstChild,e+1),n.setEnd(i.firstChild,e+1)),t.removeAllRanges(),t.addRange(n)}},{key:"resetEditState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t=this.getEditElement(this.parent.getActiveSheet());Sa(t.textContent)&&this.parent.notify("clearCellRef",null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",t===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):Object(f.J)(t))}this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify("formulaOperation",{action:"endEdit"})}},{key:"refSelectionRender",value:function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&Sa(e.textContent)&&this.parent.notify("initiateFormulaReference",{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})}},{key:"initiateRefSelection",value:function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),t=this.parent.element.querySelector(".e-formula-bar").value;this.parent.getActiveSheet().name===e&&Sa(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify("initiateFormulaReference",{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).innerHTML=t,this.initiateCurPosition()):this.initiateCurPosition()}},{key:"addressHandler",value:function(e){var t=window.getSelection();if(this.selectionStart=t.anchorOffset,this.selectionEnd=t.focusOffset,this.selectionStart>this.selectionEnd){var i=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=i}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];this.selectionStart=n.selectionStart,this.selectionEnd=n.selectionEnd}var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,r);var a=e.range,s=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),o=this.editCellData.sheetIndex,l=this.getEditElement(this.parent.getActiveSheet());if(this.parent.getActiveSheet().name!==s&&(a="'"+this.parent.getActiveSheet().name+"'!"+a),e.isSelect)this.parent.notify("initiateFormulaReference",{range:r.editedValue+a,formulaSheetIdx:o});else{var h=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));if(this.parent.getActiveSheet().name===h){var c=r.editedValue;this.selectionStart!==this.selectionEnd?(this.formulaBarCurStartPos=this.selectionStart,this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+a.length,l.textContent=c.substring(0,this.selectionStart)+a+c.substring(this.selectionStart)):c.indexOf(")")===c.length-1&&this.selectionEnd===c.length?(l.textContent=c.substring(0,c.length-1)+a+c.substring(c.length-1),this.curEndPos=l.textContent.length-1):c.indexOf(")")!==c.length-1?(l.textContent=c+a,this.curEndPos=l.textContent.length):l.textContent!==c?(l.textContent=c.substring(0,this.curStartPos)+a+c.substring(this.curStartPos),this.curEndPos=this.curStartPos+a.length):this.selectionStart!==this.selectionEnd||-1===this.validCharacters.indexOf(c.substring(this.selectionStart-1,this.selectionEnd))||-1===this.validCharacters.indexOf(c.substring(this.selectionStart,this.selectionEnd+1))&&")"!==c.substring(this.selectionStart,this.selectionEnd+1)||(l.textContent=c.substring(0,this.selectionStart)+a+c.substring(this.selectionEnd),this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+a.length,this.formulaBarCurStartPos=this.curStartPos)}}}},{key:"updateFormulaBarValue",value:function(){var e=window.getSelection(),t=this.editCellData.value,i=this.parent.getActiveSheet().selectedRange;i=tr(Jn(i))?i.split(":")[0]:i;var n=this.parent.element.querySelector(".e-formula-bar");if(t&&Sa(t,!0)){var r=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==r&&(i="'"+this.parent.getActiveSheet().name+"'!"+i),Object(f.Z)(this.formulaBarCurStartPos)?t.indexOf(")")===t.length-1&&e.focusOffset===t.length?n.value=t.substring(0,t.length-1)+i+t.substring(t.length-1):t.indexOf(")")!==t.length-1?n.value=t+i:n.value!==t&&(n.value=t.substring(0,this.curStartPos)+i+t.substring(this.curStartPos)):n.value=t.substring(0,this.formulaBarCurStartPos)+i+t.substring(this.formulaBarCurStartPos),this.curEndPos=this.curStartPos+i.length}}},{key:"setFormulaBarCurPosition",value:function(e,t,i){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,i))}},{key:"initiateCurPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isCellEdit:!1},t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var i=this.getCurPosition();this.endFormulaRef||i.start!==i.end||(this.updateFormulaReference(t),i.end&&-1===this.validCharacters.indexOf(this.editCellData.value[i.end-1])&&(this.endFormulaRef=!0))}else{var n=t.innerText,r=window.getSelection();if(r&&r.focusNode&&r.focusNode.classList&&r.focusNode.classList.contains("e-formula-bar-panel")){var a=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(a,this.curEndPos,this.curEndPos)}else{if(n){var s=document.createRange();n.indexOf(")"),s.setStart(t.childNodes[0],this.curEndPos),s.setEnd(t.childNodes[0],this.curEndPos),r.removeAllRanges(),r.addRange(s)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){var o=this.parent.element.querySelector(".e-formula-bar");if(o.value){var l=o.value.length;o.value.indexOf(")")===l-1?this.setFormulaBarCurPosition(o,l-1,l-1):this.setFormulaBarCurPosition(o,l,l)}}}}}},{key:"getEditElement",value:function(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){var i,n=this.parent.frozenRowCount(e),r=this.parent.frozenColCount(e),a=Zn(e.activeCell);if(a[0]<n&&a[1]<r)i=this.parent.getSelectAllContent();else if(a[0]<n)i=this.parent.getColumnHeaderContent();else{if(!(a[1]<r))return this.editorElem;i=this.parent.getRowHeaderContent()}var s=i.getElementsByClassName("e-spreadsheet-edit")[0];return!s&&t&&(s=i.appendChild(this.editorElem.cloneNode())),s}return this.editorElem}}]),e}(),po=function(){function e(t){a(this,e),this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=t,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return o(e,[{key:"addEventListener",value:function(){this.parent.on("contentLoaded",this.init,this),this.parent.on("mouseDown",this.mouseDownHandler,this),this.parent.on("virtualContentLoaded",this.virtualContentLoadedHandler,this),this.parent.on("cellNavigate",this.cellNavigateHandler,this),this.parent.on("selectRange",this.selectRange,this),this.parent.on("rowHeightChanged",this.rowHeightChanged,this),this.parent.on("colWidthChanged",this.colWidthChanged,this),this.parent.on("protectSelection",this.protectHandler,this),this.parent.on("initiateFormulaReference",this.initiateFormulaSelection,this),this.parent.on("clearCellRef",this.clearBorder,this),this.parent.on("getRowIdxFromClientY",this.getRowIdxFromClientY,this),this.parent.on("getColIdxFromClientX",this.getColIdxFromClientX,this),this.parent.on("focusBorder",this.chartBorderHandler,this),this.parent.on("selectionStatus",this.isTouchSelectionStarted,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.init),this.parent.off("mouseDown",this.mouseDownHandler),this.parent.off("virtualContentLoaded",this.virtualContentLoadedHandler),this.parent.off("cellNavigate",this.cellNavigateHandler),this.parent.off("selectRange",this.selectRange),this.parent.off("rowHeightChanged",this.rowHeightChanged),this.parent.off("colWidthChanged",this.colWidthChanged),this.parent.off("protectSelection",this.protectHandler),this.parent.off("initiateFormulaReference",this.initiateFormulaSelection),this.parent.off("clearCellRef",this.clearBorder),this.parent.off("getRowIdxFromClientY",this.getRowIdxFromClientY),this.parent.off("getColIdxFromClientX",this.getColIdxFromClientX),this.parent.off("focusBorder",this.chartBorderHandler),this.parent.off("selectionStatus",this.isTouchSelectionStarted))}},{key:"isTouchSelectionStarted",value:function(e){e.touchSelectionStarted=this.touchSelectionStarted}},{key:"rowHeightChanged",value:function(e){var t=this;bs(function(){var i=t.getActiveCell(),n=t.parent.getActiveSheet();if(i){var r=Zn(n.activeCell);if(n.frozenRows||n.frozenColumns){var a={range:[r[0],r[1],r[0],r[1]]};t.parent.notify(mr,a),Es(t.parent,i,a.range,"e-active-cell")}else r[0]===e.rowIdx?i.style.height="".concat(parseFloat(i.style.height)+e.threshold,"px"):r[0]>e.rowIdx&&(i.style.top="".concat(parseFloat(i.style.top)+e.threshold,"px"))}if(i=t.getSelectionElement()){var s=Wn(n.selectedRange),o=$n(s),l={range:o,isActiveCell:!1,skipChecking:!0};if(t.parent.notify("mergedRange",l),l.isActiveCell||o[0]===o[2]&&o[1]===o[3])return;if(n.frozenRows||n.frozenColumns)return void Es(t.parent,i,s);var h=o[0],c=o[2];h<=e.rowIdx&&c>=e.rowIdx&&i?i.style.height="".concat(parseFloat(i.style.height)+e.threshold,"px"):h>e.rowIdx&&i&&(i.style.top="".concat(parseFloat(i.style.top)+e.threshold,"px"))}})}},{key:"colWidthChanged",value:function(e){var t=this;bs(function(){var i=t.parent.getActiveSheet(),n=t.getActiveCell();if(n){var r=Zn(t.parent.getActiveSheet().activeCell);if(i.frozenRows||i.frozenColumns){var a={range:[r[0],r[1],r[0],r[1]]};t.parent.notify(mr,a),Es(t.parent,n,a.range,"e-active-cell")}else r[1]===e.colIdx?n.style.width="".concat(parseFloat(n.style.width)+e.threshold,"px"):r[1]>e.colIdx&&(n.style.left="".concat(parseFloat(n.style.left)+e.threshold,"px"))}n=t.getSelectionElement();var s=Wn(t.parent.getActiveSheet().selectedRange),o=$n(s),l={range:o,isActiveCell:!1,skipChecking:!0};if(t.parent.notify("mergedRange",l),!(l.isActiveCell||o[0]===o[2]&&o[1]===o[3]))if(i.frozenRows||i.frozenColumns)Es(t.parent,n,s);else{var h=o[1];h<=e.colIdx&&o[3]>=e.colIdx&&n?n.style.width="".concat(parseFloat(n.style.width)+e.threshold,"px"):h>e.colIdx&&n&&(n.style.left="".concat(parseFloat(n.style.left)+e.threshold,"px"))}})}},{key:"selectRange",value:function(e){e.address="Single"===this.parent.selectionSettings.mode?Xn(Zn(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking)}},{key:"init",value:function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),t=$n(Wn(e.selectedRange)),i=Zn(e.activeCell);this.selectMultiRange(e.selectedRange,!0,t[0]<=i[0]&&t[2]>=i[0]&&t[1]<=i[1]&&t[3]>=i[1])}},{key:"selectMultiRange",value:function(e,t,i,n){var r=this,a=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(a=Wa(this.parent,Ga(e)),e=e.split("!")[1]),this.parent.activeSheetIndex===a?e.split(" ").forEach(function(e,a){r.selectRangeByIdx(Wn(e),{type:"mousedown",ctrlKey:0!==a},null,i,t,n)}):Xa(this.parent,e,this.parent.sheets[a])}},{key:"createSelectionElement",value:function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)}},{key:"mouseDownHandler",value:function(e){if(!(Object(f.D)(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,t);var i=Sa(t.editedValue,!0);if(!this.parent.isEdit||i){var n=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else n&&n.classList.remove("e-ss-overlay-active");if(Object(f.D)(e.target,".e-datavisualization-chart"))return;if(this.parent.getActiveSheet().isProtected&&!this.parent.getActiveSheet().protectSettings.selectCells)return;if(!Object(f.D)(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var r,a,s=this.parent.getActiveSheet(),o=this.parent.selectionSettings.mode,l=this.getRowIdxFromClientY({clientY:zs(e),target:e.target}),h=this.getColIdxFromClientX({clientX:_s(e),target:e.target}),c=Zn(s.activeCell);if(s.showHeaders){var d=e.target;if(s.frozenColumns||s.frozenRows){var u=this.parent.getSelectAllContent().querySelector("thead");a=u?(this.parent.getColumnHeaderContent().contains(d)||u.contains(d))&&d.classList.contains("e-header-cell"):this.parent.getColumnHeaderContent().contains(d)&&d.classList.contains("e-header-cell"),r=(u=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(d)||u.contains(d))&&d.classList.contains("e-header-cell"):this.parent.getRowHeaderContent().contains(d)&&d.classList.contains("e-header-cell")}else r=this.parent.getRowHeaderContent().contains(e.target),a=this.parent.getColumnHeaderContent().contains(e.target)}if(3===e.which&&this.isSelected(l,h))return;if("Multiple"===o&&(!Ns(e)&&(!Fs(e)||Fs(e)&&c[0]===l&&c[1]===h)||a||r)?(document.addEventListener(Ds().split(" ")[0],this.mouseMoveEvt),f.d.isPointer||document.addEventListener(Ds().split(" ")[1],this.mouseMoveEvt,{passive:!1}),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,Ns(e)||f.l.add(document,Ms(),this.mouseUpHandler,this),Fs(e)&&!a&&!r)return void(this.touchEvt=e);var p=Wn(s.topLeftCell);r?(this.isRowSelected=!0,e.shiftKey&&"Single"!==o||(this.startCell=[l,0]),this.selectRangeByIdx([this.startCell[0],s.frozenColumns?p[1]:0,l,s.colCount-1],e)):a?(this.isColSelected=!0,e.shiftKey&&"Single"!==o||(this.startCell=[0,h]),this.selectRangeByIdx([s.frozenRows?p[0]:0,this.startCell[1],s.rowCount-1,h],e)):Object(f.D)(e.target,".e-select-all-cell")?(this.startCell=[s.frozenRows?p[0]:0,s.frozenColumns?p[1]:0],this.selectRangeByIdx([].concat(this.startCell,[s.rowCount-1,s.colCount-1]),e)):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==o||(this.startCell=[l,h]),this.selectRangeByIdx([].concat(this.startCell?this.startCell:Zn(s.activeCell),[l,h]),e)),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(i&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){var g=this.parent.getActiveSheet().selectedRange;g=tr(Jn(g))?g.split(":")[0]:g,this.parent.notify("addressHandle",{range:g,isSelect:!1})}}}},{key:"mouseMoveHandler",value:function(e){var t=this,i=this.parent.getActiveSheet();Ps(e)&&e.preventDefault();var n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,n);var r=Sa(n.editedValue,!0),a=this.parent.getMainContent().parentElement,s=this.parent.element.getElementsByClassName("e-scroller")[0],o=a.getBoundingClientRect(),l=this.parent.frozenColCount(i),h=o.left+this.parent.sheetModule.getRowHeaderWidth(i),c=o.top,d=o.right,u=o.bottom,p=_s(e),g=zs(e),m=this.isRowSelected?i.colCount-1:this.getColIdxFromClientX({clientX:Math.min(p,d),target:e.target}),v=this.isColSelected?i.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(g,u),target:e.target}),y=Wn(i.selectedRange),b={range:[v,m,v,m]};if(this.parent.notify(mr,b),b.range[2]!==y[2]||b.range[3]!==y[3]){var C,x,S=this.parent.frozenRowCount(i),w=g>u&&v<i.rowCount,k=g<c&&v>=0&&!this.isColSelected&&!!a.scrollTop,I=p>d&&m<i.colCount,O=p<h&&m>=0&&!this.isRowSelected&&!!s.scrollLeft;if(this.clearInterval(),r||this.isColSelected||this.isRowSelected||(y=Zn(i.activeCell)),w||k||I||O)(k||O)&&(C=v,x=m),this.scrollInterval=setInterval(function(){if((w||k)&&!t.isColSelected){if((v=t.getRowIdxFromClientY({clientY:w?u:c}))>=i.rowCount)return void t.clearInterval();a.scrollTop+=(w?1:-1)*ds(i,v)}if((I||O)&&!t.isRowSelected){if((m=t.getColIdxFromClientX({clientX:I?d:h}))>=i.colCount)return void t.clearInterval();s.scrollLeft+=(I?1:-1)*ms(i,m)}if(k&&!a.scrollTop||O&&!s.scrollLeft)return t.selectRangeByIdx([].concat(y[0],y[1],[C,x]),e),void t.clearInterval();t.selectRangeByIdx([].concat(y[0],y[1],[v,m]),e)},100);else{var R=[].concat(y[0],y[1],[v,m]);S&&R[0]<S&&R[2]>=S&&a.scrollTop&&(a.scrollTop=0,R[2]=S),l&&R[1]<l&&R[3]>=l&&s.scrollLeft&&(s.scrollLeft=0,R[3]=l),this.selectRangeByIdx(R,e)}if(r&&this.parent.isEdit&&!Object(f.D)(e.target,"#"+this.parent.element.id+"_edit")){var A=this.parent.getActiveSheet().selectedRange;this.parent.notify("addressHandle",{range:A,isSelect:!1})}}}},{key:"mouseUpHandler",value:function(e){var t=this.getRowIdxFromClientY({clientY:zs(e),target:e.target}),i=this.getColIdxFromClientX({clientX:_s(e),target:e.target});this.clearInterval(),!Ns(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:zs(this.touchEvt),target:e.target})!==t||this.getColIdxFromClientX({clientX:_s(this.touchEvt),target:e.target})!==i||this.mouseDownHandler(e),this.parent.trigger("select",{range:this.parent.getActiveSheet().selectedRange}),document.removeEventListener(Ds().split(" ")[0],this.mouseMoveEvt),f.d.isPointer||document.removeEventListener(Ds().split(" ")[1],this.mouseMoveEvt),f.l.remove(document,Ms(),this.mouseUpHandler),this.parent.notify("mouseUpAfterSelection",e);var n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,n),(Sa(n.editedValue)||n.editedValue&&0===n.editedValue.toString().indexOf("="))&&this.parent.isEdit&&this.parent.notify("initiateCur",{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})}},{key:"isSelected",value:function(e,t){var i=$n(Wn(this.parent.getActiveSheet().selectedRange));return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}},{key:"virtualContentLoadedHandler",value:function(e){var t,i,n=this,r=this.parent.getActiveSheet(),a=Wn(r.selectedRange);r.selectedRange.split(" ").forEach(function(s,o){a=Wn(s),i=0===a[1]&&a[3]===e.prevRowColCnt.colCount-1,(t=0===a[0]&&a[2]===e.prevRowColCnt.rowCount-1)&&i?n.selectRangeByIdx([0,0,r.rowCount-1,r.colCount-1],null,!0,null,null,null,o):t?n.selectRangeByIdx([0,a[1],r.rowCount-1,a[3]],null,!0,null,null,null,o):i?n.selectRangeByIdx([a[0],0,a[2],r.colCount-1],null,!0,null,null,null,o):(a=Wn(s),n.highlightHdr(a,0!==o,a[0]>=n.parent.viewport.topIndex||a[2]>=n.parent.viewport.topIndex,a[1]>=n.parent.viewport.leftIndex||a[3]>=n.parent.viewport.leftIndex))})}},{key:"clearInterval",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){clearInterval(this.scrollInterval),this.scrollInterval=null})},{key:"getScrollLeft",value:function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0}},{key:"cellNavigateHandler",value:function(e){var t=this.parent.getActiveSheet();t.isProtected&&!t.protectSettings.selectCells||this.selectRangeByIdx(e.range.concat(e.range))}},{key:"getColIdxFromClientX",value:function(e){var t=0,i=this.parent.getActiveSheet(),n=0;if(e.isImage)n=e.clientX;else{var r=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();n=this.parent.enableRtl?r.right-this.parent.sheetModule.getRowHeaderWidth(i,!0)-1-e.clientX:e.clientX-(r.left+this.parent.sheetModule.getRowHeaderWidth(i,!0)+1),n+=this.parent.viewport.beforeFreezeWidth,e.target&&(Object(f.D)(e.target,".e-row-header")||Object(f.D)(e.target,".e-selectall-container"))&&!this.isScrollableArea(e.clientX,e.target,!0)||(n+=this.getScrollLeft())}for(var a=0;;a++)if(n<(t+=ms(i,a,null,!0))||this.parent.scrollSettings.isFinite&&a===i.colCount-1)return e.isImage||(e.size=n),e.clientX=a,a}},{key:"isScrollableArea",value:function(e,t,i){return!!t.classList.contains("e-table")&&(i?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)}},{key:"getRowIdxFromClientY",value:function(e){var t=0,i=this.parent.getActiveSheet(),n=0;if(e.isImage)n=e.clientY;else{var r=document.getElementById(this.parent.element.id+"_sheet");n=e.clientY+this.parent.viewport.beforeFreezeHeight-(r.getBoundingClientRect().top+(i.showHeaders?31:0)),e.target&&Object(f.D)(e.target,".e-header-panel")&&!this.isScrollableArea(e.clientY,e.target)||(n+=this.parent.getMainContent().parentElement.scrollTop)}for(var a=0;;a++)if(n<(t+=ds(i,a,!0))||this.parent.scrollSettings.isFinite&&a===i.rowCount-1)return e.isImage||(e.size=n),e.clientY=a,a}},{key:"initFormulaReferenceIndicator",value:function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),Es(this.parent,t,e,"e-formularef-indicator")}}},{key:"selectRangeByIdx",value:function(e,t,i,n,r,a,s){if(!(t&&t.target&&Object(f.D)(t.target,"#"+this.parent.element.id+"_edit"))){var o={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(xr,o);var l,h=Sa(o.editedValue,!0)&&!o.endFormulaRef,c=t&&t.ctrlKey&&function(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}(t),d=this.getSelectionElement(t,s),u=this.parent.getActiveSheet(),p=this.parent.element.querySelector(".e-formularef-indicator"),g={range:[].slice.call(e),isActiveCell:!1,skipChecking:a},m=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");this.isColSelected||this.isRowSelected||this.parent.notify("mergedRange",g),e!==g.range&&(l=!0);var v={range:Xn(e=g.range),cancel:!1};if(this.parent.trigger("beforeSelect",v),!v.cancel){if(h&&p&&p.parentElement.removeChild(p),!tr(e)&&!g.isActiveCell||c)if(h&&this.parent.isEdit)t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:Xn(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{d&&d.classList.remove("e-hide");var y=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);l&&y&&(y.left={idx:0,size:0}),Es(this.parent,d,e)}else d&&(d.classList.contains("e-multi-range")||d.classList.add("e-hide"),(u.frozenRows||u.frozenColumns)&&(Ls(this.parent.getSelectAllContent(),null,!1),Ls(this.parent.getColumnHeaderContent(),null,!1),Ls(this.parent.getRowHeaderContent(),null,!1))),u.frozenColumns||u.frozenRows||!d||Es(this.parent,d,e),h&&t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify("addressHandle",{range:Xn(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e));var b={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(xr,b);var C=Xn(e);if(t&&t.ctrlKey&&(Bs(t)||Hs(t)))C=u.selectedRange.slice(0,u.selectedRange.lastIndexOf(" "))+" "+C;else if(s>-1){var x=u.selectedRange.split(" ");x[s]=C,C=x.join(" ")}h&&r||Xa(this.parent,C,u,c),this.UpdateRowColSelected(e),this.highlightHdr(e,t&&t.ctrlKey),i||t&&("mousemove"===t.type||Ps(t))||(h?b.sheetIndex===this.parent.getActiveSheet().id-1&&r?this.updateActiveCell((n=!0)?Wn(u.activeCell):e,r):this.parent.isEdit||this.updateActiveCell(n?Wn(u.activeCell):e,r):this.updateActiveCell(n?Wn(u.activeCell):e,r)),Object(f.Z)(t)&&(t={type:"mousedown"}),h&&r||this.parent.notify("selectionComplete",t),this.parent.notify("showAggregate",{}),this.parent.notify("refreshImgElem",{}),m&&this.parent.notify("removeDesignChart",{}),this.parent.notify("clearChartBorder",{})}}}},{key:"UpdateRowColSelected",value:function(e){var t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1}},{key:"updateActiveCell",value:function(e,t){var i,n,r,a=this.parent.getActiveSheet(),s=Wn(a.topLeftCell);this.isColSelected?(i=s[0],n=e[1],this.isRowSelected&&(n=s[1])):(i=e[0],n=e[1],this.isRowSelected&&(n=s[1]));var o={range:[i,n,i,n]};if(this.parent.notify(mr,o),e!==o.range&&(r=!0),a.activeCell!==Yn((e=o.range)[0],e[1])||t){if(this.parent.setSheetPropertyOnMute(a,"activeCell",Yn(e[0],e[1])),a.isProtected){var l=this.parent.element.querySelector(".e-formula-bar"),h=Ra(Da(e[0],e[1],a),gs(a,e[1]));h&&l&&!l.disabled?l.disabled=!0:!h&&l&&l.disabled&&(l.disabled=!1)}if(this.getActiveCell()){var c=this.getOffset(e[2],e[3]);r&&(c.left={idx:0,size:0}),Es(this.parent,this.getActiveCell(),e,"e-active-cell")}this.parent.notify("activeCellChanged",null)}else Es(this.parent,this.getActiveCell(),e,"e-active-cell")}},{key:"getOffset",value:function(e,t){var i={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(i.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(i.top=this.parent.scrollModule.offset.top)),i}},{key:"getSelectionElement",value:function(e,t){if(e&&e.ctrlKey){if(Hs(e)||Bs(e))return this.parent.getMainContent().querySelector(".e-selection:last-child");var i=this.parent.element.getElementsByClassName("e-selection")[0];i.classList.remove("e-hide");var n=i.cloneNode();return n.classList.add("e-multi-range"),this.parent.getMainContent().appendChild(n)}return t>-1?this.parent.getMainContent().getElementsByClassName("e-selection")[t]:([].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(function(e){Object(f.kb)(e)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0])}},{key:"getActiveCell",value:function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]}},{key:"getSheetElement",value:function(){return document.getElementById(this.parent.element.id+"_sheet")}},{key:"highlightHdr",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.parent.getActiveSheet().showHeaders){var r=this.parent.getActiveSheet(),a=[],s=[],o=$n(e);o=this.getHdrIndexes(o);var l=this.parent.element.getElementsByClassName("e-select-all-cell")[0];if(t||(Object(f.lb)(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),Object(f.lb)(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight")),l&&Object(f.lb)([l],["e-prev-highlight-right","e-prev-highlight-bottom"]),i){var h,c,d=this.parent.frozenRowCount(r),u=this.parent.getSelectAllContent().querySelector("tbody");u&&(h=[].slice.call(u.querySelectorAll(".e-header-cell")));for(var p=[].slice.call(this.parent.getRowHeaderContent().querySelectorAll(".e-header-cell")),g=Zn(r.topLeftCell)[0],m=o[0];m<o[2]+1;m++)(c=m<d?h[m-g]:p[m-d])&&a.push(c)}if(n){var v,y,b=this.parent.frozenColCount(r),C=this.parent.getSelectAllContent().querySelector("thead");C&&(v=[].slice.call(C.querySelectorAll(".e-header-cell")));for(var x=[].slice.call(this.parent.getColumnHeaderContent().querySelectorAll("th")),S=Zn(r.topLeftCell)[1],w=o[1];w<o[3]+1;w++)(y=w<b?v[w-S]:x[w-b])&&s.push(y)}r.isProtected&&!r.protectSettings.selectCells?Object(f.lb)([].concat(a,s),"e-highlight"):Object(f.w)([].concat(a,s),"e-highlight"),a.length&&a[0].parentElement.previousElementSibling&&a[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),s.length&&s[0].previousElementSibling&&s[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(r.isProtected&&!r.protectSettings.selectCells?document.getElementById("".concat(this.parent.element.id,"_select_all")).classList.remove("e-highlight"):document.getElementById("".concat(this.parent.element.id,"_select_all")).classList.add("e-highlight")),l&&(0===o[0]&&l.classList.add("e-prev-highlight-bottom"),0===o[1]&&l.classList.add("e-prev-highlight-right"))}}},{key:"protectHandler",value:function(){var e=Wn(this.parent.getActiveSheet().selectedRange),t=$n(e),i=Zn(this.parent.getActiveSheet().activeCell);this.selectRangeByIdx(e,null,null,t[0]<=i[0]&&t[2]>=i[0]&&t[1]<=i[1]&&t[3]>=i[1])}},{key:"getHdrIndexes",value:function(e){if(this.parent.scrollSettings.enableVirtualization){var t=[],i=this.parent.hiddenCount(this.parent.viewport.topIndex,e[0]),n=this.parent.hiddenCount(this.parent.viewport.leftIndex,e[1],"columns");return t[0]=this.isColSelected?e[0]:e[0]-this.parent.viewport.topIndex<0?0:e[0]-i-this.parent.viewport.topIndex,t[1]=this.isRowSelected?e[1]:e[1]-this.parent.viewport.leftIndex<0?0:e[1]-n-this.parent.viewport.leftIndex,t[2]=this.isColSelected?this.parent.viewport.rowCount+2*this.parent.getThreshold("row"):e[2]-this.parent.hiddenCount(e[0],e[2])-i-this.parent.viewport.topIndex,t[3]=this.isRowSelected?this.parent.viewport.colCount+2*this.parent.getThreshold("col"):e[3]-this.parent.hiddenCount(e[1],e[3],"columns")-n-this.parent.viewport.leftIndex,t}return e}},{key:"initiateFormulaSelection",value:function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)}},{key:"processFormulaEditRange",value:function(e,t){var i,n=t,r=0,a=this.parseFormula(e),s=a.length,o=0,l=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var h=this.parent.getActiveSheet().id-1;r<s&&(i=a[r],!(this.invalidOperators.indexOf(i)>-1));){if(wa(i.toUpperCase())){if(i=i.replace(/\$/g,""),r>0&&a[r-1].indexOf("!")===a[r-1].length-1){var c=a[r-1].split("!");n=Wa(this.parent,c[0].substring(1,c[0].length-1))}":"===a[r+1]&&(a[++r+1]&&wa(a[r+1].toUpperCase())&&(i=i+":"+a[r+1],r++)),h===n&&this.updateFormulaEditRange(i,o,l),n=t,o++}r++}}},{key:"updateFormulaEditRange",value:function(e,t,i){var n=Wn(e);this.formulaRange[t]=e,this.dStartCell={rowIndex:n[0],colIndex:n[1]},this.dEndCell={rowIndex:n[2],colIndex:n[3]},this.focusBorder(this.dStartCell,this.dEndCell,i[t%6])}},{key:"chartBorderHandler",value:function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)}},{key:"focusBorder",value:function(e,t,i,n){n=!Object(f.Z)(n)&&n;var r=$n([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),a=this.parent.getActiveSheet();if(a.frozenRows||a.frozenColumns){var s=this.parent.createElement("div",{className:n?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return s.appendChild(this.parent.createElement("div",{className:"e-top"})),s.appendChild(this.parent.createElement("div",{className:"e-bottom"})),s.appendChild(this.parent.createElement("div",{className:"e-left"})),s.appendChild(this.parent.createElement("div",{className:"e-right"})),void Es(this.parent,s,r,"e-range-indicator")}var o=r[0],l=r[1],h=r[2],c=r[3];o&&this.getEleFromRange([o-1,l,o-1,c]).forEach(function(e){e&&(e.classList.add(i[1]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([o,c,h,c]).forEach(function(e){e&&(e.classList.add(i[0]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([h,l,h,c]).forEach(function(e){e&&(e.classList.add(i[1]),n||e.classList.add("e-formularef-selection"))}),l&&this.getEleFromRange([o,l-1,h,l-1]).forEach(function(e){e&&(e.classList.add(i[0]),n||e.classList.add("e-formularef-selection"))})}},{key:"getEleFromRange",value:function(e){var t,i,n,r,a=e[0],s=e[1],o=e[2],l=e[3],h=[],c=[];if(a>o&&(n=a,a=o,o=n),s>l&&(n=s,s=l,l=n),this.parent.scrollSettings.enableVirtualization)for(t=a;t<=o;t++)if((i=t)>-1){var d=this.parent.getRow(i,null);d&&(r=d.getElementsByClassName("e-cell"),h=l===s?[r[l]]:this.getRowCells(r,s,l+1),this.merge(c,h))}return c}},{key:"getRowCells",value:function(e,t,i){for(var n=[];t<i;t++)e[t]&&n.push(e[t]);return n}},{key:"merge",value:function(e,t){e&&t&&Array.prototype.push.apply(e,t)}},{key:"clearBorder",value:function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(function(e){Object(f.J)(e)});else for(var t=this.parent.element.getElementsByClassName("e-formularef-selection"),i=0;i<t.length;i++)for(var n=t[i],r=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"],a=0;a<r.length;a++)n.classList.remove(r[a])}},{key:"parseFormula",value:function(e){for(var t,i,n=0,r=[],a=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),s=a.length;n<s;)if(t=a[n]){if(1===t.length)r.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t);else if(i=t[0],t.indexOf("!")>0){this.isUniqueChar(i)&&(r.push(this.getUniqueCharVal(i)),t=t.substr(1));var o=t.indexOf("!")+1;r.push(t.substr(0,o)),r.push(t.substr(o))}else this.isUniqueChar(i)?(r.push(this.getUniqueCharVal(i)),r.push(t.substr(1))):r.push(t);n++}else n++;return r}},{key:"isUniqueChar",value:function(e){var t=e.charCodeAt(e.charAt[0]);return t>=129&&t<=142}},{key:"getUniqueCharVal",value:function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""}},{key:"markSpecialChar",value:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)}},{key:"getModuleName",value:function(){return"selection"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}}]),e}(),go=function(){function e(t){a(this,e),this.clientX=0,this.parent=t,this.addEventListener(),this.initProps()}return o(e,[{key:"onContentScroll",value:function(e){var t,i,n=this.parent.getMainContent().parentElement,r=e.scrollLeft,a=e.scrollTop||n.scrollTop,s=r&&this.parent.enableRtl?this.initScrollValue-r:r;if(!Object(f.Z)(r)&&this.prevScroll.scrollLeft!==s){var o=s>this.prevScroll.scrollLeft;i=this.offset.left.size,this.offset.left=this.getColOffset(s,o,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=r,this.parent.getMainContent().scrollLeft=r,e.scrollLeft=r),t={cur:this.offset.left,prev:{idx:this.leftIndex,size:i},increase:o,preventScroll:e.preventScroll},this.updateTopLeftCell(o),this.parent.notify("horizontalScroll",t),this.parent.scrollSettings.enableVirtualization||!o||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=t.prev.idx,this.prevScroll.scrollLeft=s}if(this.prevScroll.scrollTop!==a){var l=a>this.prevScroll.scrollTop;i=this.offset.top.size,this.offset.top=this.getRowOffset(a,l),t={cur:this.offset.top,prev:{idx:this.topIndex,size:i},increase:l,preventScroll:e.preventScroll},this.updateTopLeftCell(l),this.parent.notify("verticalScroll",t),this.parent.scrollSettings.enableVirtualization||!l||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=t.prev.idx,this.prevScroll.scrollTop=a}var h={isEdit:!1};this.parent.notify("isFormulaBarEdit",h),h.isEdit&&this.parent.element.querySelector(".e-formula-bar").focus()}},{key:"updateNonVirtualRows",value:function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},"".concat(Yn(e.rowCount,0),":").concat(Yn(e.rowCount+t-1,e.colCount-1))),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)}},{key:"updateNonVirtualCols",value:function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},"".concat(Yn(0,e.colCount),":").concat(Yn(e.rowCount-1,e.colCount+t-1))),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)}},{key:"updateTopLeftCell",value:function(e){var t=this.parent.getActiveSheet(),i=this.offset.top.idx,n=this.offset.left.idx;e||(i=ro(t,i,!0),n=ro(t,n,!0,"columns")),this.parent.updateTopLeftCell(i,n)}},{key:"getRowOffset",value:function(e,t){var i=this.offset.top.size,n=this.parent.getActiveSheet(),r=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,a=this.parent.frozenRowCount(n),s=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);r<s;)if(t){if(i+=ds(n,r-1+a,!0),Math.abs(Math.round(i)-e)<=1)return{idx:r,size:i};if(Math.round(i)>e)return{idx:r-1,size:i-ds(n,r-1+a,!0)};r++}else{if(0===i)return{idx:0,size:0};if((i-=ds(n,r+a,!0))<0&&(i=0),Math.abs(Math.round(i)-e)<=1)return{idx:r,size:i};if(Math.round(i)<e)return i+=ds(n,r+a,!0),Math.round(i)>e?{idx:r,size:i-ds(n,r+a,!0)<0?0:i-ds(n,r+a,!0)}:{idx:r+1,size:i};r--}return{idx:this.offset.top.idx,size:this.offset.top.size}}},{key:"getColOffset",value:function(e,t,i){var n=this.offset.left.size,r=this.parent.getActiveSheet(),a=t?this.offset.left.idx+1:this.offset.left.idx-1,s=this.parent.frozenColCount(r),o=this.parent.scrollSettings.isFinite?r.colCount:1/0;for(e=Math.round(e);a<o;)if(t){if(n+=ms(r,a-1+s,i,!0),Math.round(n)===e)return{idx:a,size:n};if(Math.round(n)>e)return{idx:a-1,size:n-ms(r,a-1+s,i,!0)};a++}else{if(0===n)return{idx:0,size:0};if(n-=ms(r,a+s,i,!0),Math.round(n)===e)return{idx:a,size:n};if(Math.round(n)<e)return n+=ms(r,a+s,i,!0),Math.round(n)>e?{idx:a,size:n-ms(r,a+s,i,!0)}:{idx:a+1,size:n};a--}return{idx:this.offset.left.idx,size:this.offset.left.size}}},{key:"contentLoaded",value:function(e){if(!this.parent.scrollSettings.enableVirtualization){var t=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:t}),this.parent.getScrollElement().appendChild(t)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)}},{key:"updateNonVirualScrollWidth",value:function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width)+"px"}},{key:"onHeaderWheel",value:function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX}},{key:"onContentWheel",value:function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)}},{key:"scrollHandler",value:function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})}},{key:"updateScroll",value:function(e){Object(f.Z)(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left}},{key:"setScrollEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{set:!0};e.set?(f.l.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),f.l.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),f.l.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),f.l.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),f.l.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),f.l.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)):(f.l.remove(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll),f.l.remove(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel),f.l.remove(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel),f.l.remove(this.parent.getMainContent(),"wheel",this.onContentWheel),f.l.remove(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel),f.l.remove(this.parent.getScrollElement(),"scroll",this.scrollHandler))}},{key:"initProps",value:function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}}},{key:"setPadding",value:function(){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var e=ws();if(e>0){var t=this.parent.getColumnHeaderContent(),i=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};t.parentElement.style[i.margin]=e+"px",t.style[i.border]="1px"}}},{key:"setClientX",value:function(e){if("mousedown"!==e.type&&"mouse"!==e.pointerType){var t={touchSelectionStarted:!1};if(this.parent.notify("selectionStatus",t),!t.touchSelectionStarted){this.clientX=this.getPointX(e);var i=document.getElementById(this.parent.element.id+"_sheet");f.l.add(i,f.d.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),f.l.add(i,f.d.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}}},{key:"getPointX",value:function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX}},{key:"onTouchScroll",value:function(e){if("mouse"!==e.pointerType){var t=this.getPointX(e),i=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(i>10||i<-10)&&n.scrollLeft+i>=0&&(e.preventDefault(),this.clientX=t,bs(function(){n.scrollLeft+=i}))}}},{key:"pointerUpHandler",value:function(){var e=document.getElementById(this.parent.element.id+"_sheet");f.l.remove(e,f.d.isPointer?"pointermove":"touchmove",this.onTouchScroll),f.l.remove(e,f.d.isPointer?"pointerup":"touchend",this.pointerUpHandler)}},{key:"addEventListener",value:function(){this.parent.on("contentLoaded",this.contentLoaded,this),this.parent.on("onContentScroll",this.onContentScroll,this),this.parent.on("updateScroll",this.updateScroll,this),this.parent.on("deInitProperties",this.initProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this),this.parent.on("setScrollEvent",this.setScrollEvent,this),this.parent.on("mouseDown",this.setClientX,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on("virtualContentLoaded",this.updateNonVirualScrollWidth,this),this.parent.on("colWidthChanged",this.updateNonVirualScrollWidth,this))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.off("contentLoaded",this.contentLoaded),this.parent.off("onContentScroll",this.onContentScroll),this.parent.off("updateScroll",this.updateScroll),this.parent.off("deInitProperties",this.initProps),this.parent.off("spreadsheetDestroyed",this.destroy),this.parent.off("setScrollEvent",this.setScrollEvent),this.parent.off("mouseDown",this.setClientX),this.parent.scrollSettings.enableVirtualization||(this.parent.off("virtualContentLoaded",this.updateNonVirualScrollWidth),this.parent.off("colWidthChanged",this.updateNonVirualScrollWidth))}}]),e}(),fo=function(){function e(t){a(this,e),this.scroll=[],this.parent=t,this.addEventListener()}return o(e,[{key:"createVirtualElement",value:function(e){var t=this.parent.getActiveSheet(),i=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(i.querySelector(".e-table")),i.appendChild(this.content);var n,r=i.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),a=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var s=this.parent.viewport.bottomIndex;t.rowCount>s+1||t.usedRange.rowIndex>s?(!this.parent.scrollSettings.isFinite&&t.rowCount<=t.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(t,"rowCount",t.usedRange.rowIndex+1),this.setScrollCount(t.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"rowCount",s+1),this.scroll[this.parent.activeSheetIndex].rowCount=t.rowCount);var o=this.parent.frozenRowCount(t),l=Zn(t.topLeftCell);e.top&&(a=e.top,t.frozenRows&&(a+=ps(t,l[0],o-1,!0)),o=Zn(t.paneTopLeftCell)[0]),a+=ps(t,o,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),s=this.parent.viewport.rightIndex;var h=0,c=this.parent.frozenColCount(t);e.left?(h=e.left,c&&(h+=vs(t,l[1],c-1,!0)),o=Zn(t.paneTopLeftCell)[1]):o=c,t.colCount>s+1||t.usedRange.colIndex>s?(!this.parent.scrollSettings.isFinite&&t.colCount<=t.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(t,"colCount",t.usedRange.colIndex+1),h+=vs(t,o,s,!0),this.setScrollCount(t.colCount,"col"),n=h+vs(t,s+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"colCount",s+1),h+=vs(t,o,t.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=t.colCount,n=h),Object(f.Z)(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),Object(f.Z)(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(h=vs(t,this.parent.viewport.leftIndex+c,s,!0)),Object(f.Z)(this.translateX)&&(this.translateX=0),Object(f.Z)(this.translateY)&&(this.translateY=0),i=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.rowHeader);var d=i.appendChild(r.cloneNode());this.rowHeader.style.transform="translate(0px, ".concat(this.translateY,"px)"),i=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(i.querySelector(".e-table")),i.appendChild(this.colHeader);var u=i.appendChild(r.cloneNode());this.colHeader.style.width="".concat(h,"px"),d.style.height="".concat(a,"px"),u.style.width="".concat(n,"px"),this.colHeader.style.transform="translate(".concat(this.translateX,"px, 0px)"),this.content.style.transform="translate(".concat(this.translateX,"px, ").concat(this.translateY,"px)"),this.content.style.width="".concat(h,"px"),r.style.height="".concat(a,"px"),r.style.width="".concat(n,"px"),this.parent.allowScrolling&&this.parent.getScrollElement().appendChild(u.cloneNode(!0))}},{key:"initScroll",value:function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++}},{key:"setScrollCount",value:function(e,t){var i=this.parent.activeSheetIndex;this.scroll[i][t+"Count"]||(this.scroll[i][t+"Count"]=e)}},{key:"getRowAddress",value:function(e){var t=this.parent.getActiveSheet();return Xn([e[0],t.frozenColumns?Zn(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])}},{key:"getColAddress",value:function(e){var t=this.parent.getActiveSheet();return Xn([t.frozenRows?Zn(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])}},{key:"updateScrollCount",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=this.parent.getActiveSheet(),r=e+this.parent.viewport[t+"Count"]+1+i,a=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(r<a){if(n[t+"Count"]===a)return;r=a}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",r)}},{key:"onVerticalScroll",value:function(e){var t=e.cur.idx,i=e.cur.size,n=e.prev.idx,r=Math.abs(t-n),a=this.parent.getThreshold("row");if(r>Math.round(a/2)){var s,o,l,h=this.parent.getActiveSheet();if(t<=a&&!e.increase){if(this.translateY&&n>a){this.translateY=0;var c=this.parent.frozenColCount(h),d=this.parent.frozenRowCount(h);if(this.parent.viewport.topIndex=n-(a-d),!e.preventScroll){var u=c?Zn(h.topLeftCell)[1]:this.parent.viewport.leftIndex,p=c?[d,this.parent.viewport.leftIndex+c]:[];if(r<this.parent.viewport.rowCount+a){o=this.parent.viewport.topIndex-1,s=this.parent.skipHidden(d,o)[0],this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(s-d,!0);var g=this.hiddenCount(s,o),f=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-s+1-g),e.increase);this.parent.viewport.bottomIndex-=o-s+1-g+this.hiddenCount(f,this.parent.viewport.bottomIndex),this.parent.renderModule.refreshUI({colIndex:u,rowIndex:s,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:p},this.getRowAddress([s,this.parent.renderModule.skipHiddenIdx(o,!1)]))}else{var m=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:u,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:p,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=m),this.translate({refresh:"Row"})}ao(this.parent.element)}}this.updateScrollCount(a,"row")}if(n<a&&(r=Math.abs(t-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===h.rowCount-1){var v=this.parent.viewport.topIndex+a;if(t>(v+=this.hiddenCount(this.parent.viewport.topIndex,v)))return void(e.prev.idx=t);r=v-t}if(t>a){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-a,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);var y=this.parent.frozenRowCount(h);if(e.preventScroll)this.setThresholdHeight(i,a,y);else{var b=this.parent.frozenColCount(h),C=b?Zn(h.topLeftCell)[1]:this.parent.viewport.leftIndex,x=[];if(h.frozenColumns&&(x=[y,this.parent.viewport.leftIndex+b]),r<this.parent.viewport.rowCount+a)if(e.increase){if(s=this.parent.viewport.bottomIndex+1,o=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),(o-=this.hiddenCount(l,this.parent.viewport.topIndex-1))<=this.parent.viewport.bottomIndex)return this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.topIndex,e.increase),void this.setThresholdHeight(i,a,y);var S=this.parent.skipHidden(s,o),w=this.checkLastIdx(S[1],"row");s=S[0],o=w.index,this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.topIndex-w.diff,e.increase),this.setThresholdHeight(i,a+w.diff,y),this.parent.viewport.bottomIndex=o,this.parent.renderModule.refreshUI({colIndex:C,rowIndex:s,direction:"first",refresh:"RowPart",frozenIndexes:x},this.getRowAddress([s,o]))}else{o=(s=this.parent.viewport.topIndex+y)+r-1;var k=this.hiddenCount(s,o),I=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.bottomIndex-(o-s-k),e.increase);this.parent.viewport.bottomIndex-=r-k+this.hiddenCount(I,this.parent.viewport.bottomIndex),s=this.parent.skipHidden(s,o)[0],this.parent.viewport.topIndex=this.parent.renderModule.skipHiddenIdx(s-y,!0),this.setThresholdHeight(i,a,y),this.parent.renderModule.refreshUI({colIndex:C,rowIndex:s,direction:"last",refresh:"RowPart",frozenIndexes:x},this.getRowAddress([s,o]))}else l=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:C,refresh:"Row",frozenIndexes:x,skipTranslate:!0}),b&&(this.parent.viewport.leftIndex=l),this.setThresholdHeight(i,a,y),this.translate({refresh:"Row"});this.updateScrollCount(t,"row",a),this.focusSheet()}}e.prev.idx=t}}},{key:"hiddenCount",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rows",n=0,r=this.parent.getActiveSheet(),a=e;a<=t;a++)r[i][a]&&r[i][a].hidden&&n++;return n}},{key:"checkLastIdx",value:function(e,t){var i=0;if(this.parent.scrollSettings.isFinite){var n=this.parent.getActiveSheet()[t+"Count"]-1;e>n&&(i=e-n,e=n)}return{index:e,diff:i}}},{key:"onHorizontalScroll",value:function(e){var t=e.cur.idx,i=e.cur.size,n=e.prev.idx,r=Math.abs(t-n),a=this.parent.getThreshold("col");if(r>Math.round(a/2)){var s,o,l,h=this.parent.getActiveSheet();if(t<=a&&!e.increase){if(this.translateX&&n>a){var c=this.parent.frozenColCount(h),d=this.parent.frozenRowCount(h);if(this.translateX=0,this.parent.viewport.leftIndex=n-(a-c),!e.preventScroll){var u=d?Zn(h.topLeftCell)[0]:this.parent.viewport.topIndex,p=d?[this.parent.viewport.topIndex+d,c]:[];if(r<this.parent.viewport.colCount+a){o=this.parent.viewport.leftIndex-1,s=this.parent.skipHidden(c,o,"columns")[0],this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(s-c,!0);var g=this.hiddenCount(s,o,"columns"),f=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.rightIndex-(o-s+1-g),e.increase,"columns");this.parent.viewport.rightIndex-=o-s+1-g+this.hiddenCount(f,this.parent.viewport.rightIndex,"columns"),this.parent.renderModule.refreshUI({rowIndex:u,colIndex:s,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:p},this.getColAddress([s,this.parent.renderModule.skipHiddenIdx(o,!1,"columns")]))}else{var m=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:u,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:p,skipTranslate:!0}),d&&(this.parent.viewport.topIndex=m),this.translate({refresh:"Column"})}ao(this.parent.element)}}this.updateScrollCount(a,"col")}if(n<a&&(r=Math.abs(t-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===h.colCount-1){var v=this.parent.viewport.leftIndex+a;if(t>(v+=this.hiddenCount(this.parent.viewport.leftIndex,v)))return void(e.prev.idx=t);r=v-t}if(t>a){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-a,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);var y=this.parent.frozenColCount(h);if(e.preventScroll)this.setThresholdWidth(i,a,y);else{var b=this.parent.frozenRowCount(h),C=b?Zn(h.topLeftCell)[0]:this.parent.viewport.topIndex,x=[];if(b&&(x=[b+this.parent.viewport.topIndex,y]),r<this.parent.viewport.colCount+a)if(e.increase){if(s=this.parent.viewport.rightIndex+1,o=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),(o-=this.hiddenCount(l,this.parent.viewport.leftIndex-1,"columns"))<=this.parent.viewport.rightIndex)return this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.leftIndex,e.increase,"columns"),void this.setThresholdWidth(i,a,y);var S=this.parent.skipHidden(s,o,"columns"),w=this.checkLastIdx(S[1],"col");s=S[0],o=w.index,this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.leftIndex-w.diff,e.increase,"columns"),this.setThresholdWidth(i,a,y),this.parent.viewport.rightIndex=o,this.parent.renderModule.refreshUI({rowIndex:C,colIndex:s,direction:"first",refresh:"ColumnPart",frozenIndexes:x},this.getColAddress([s,o]))}else{o=(s=this.parent.viewport.leftIndex+y)+r-1;var k=this.hiddenCount(s,o,"columns"),I=this.parent.renderModule.skipHiddenIdx(this.parent.viewport.rightIndex-(o-s-k),e.increase,"columns");this.parent.viewport.rightIndex-=r-k+this.hiddenCount(I,this.parent.viewport.rightIndex,"columns"),s=this.parent.skipHidden(s,o,"columns")[0],this.parent.viewport.leftIndex=this.parent.renderModule.skipHiddenIdx(s-y,!0,"columns",h),this.setThresholdWidth(i,a,y),this.parent.renderModule.refreshUI({rowIndex:C,colIndex:s,direction:"last",refresh:"ColumnPart",frozenIndexes:x},this.getColAddress([s,o]))}else l=this.parent.viewport.topIndex,this.parent.renderModule.refreshUI({rowIndex:C,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:x,skipTranslate:!0}),b&&(this.parent.viewport.topIndex=l),this.setThresholdWidth(i,a,y),this.translate({refresh:"Column"});this.updateScrollCount(t,"col",a),this.focusSheet()}}e.prev.idx=t}}},{key:"focusSheet",value:function(){document.activeElement.classList.contains("e-text-findNext-short")&&Object(f.D)(document.activeElement,"#"+this.parent.element.id)||ao(this.parent.element)}},{key:"setThresholdHeight",value:function(e,t,i){for(var n=0,r=this.parent.getActiveSheet(),a=this.parent.viewport.topIndex+i,s=a+t;a<s;a++)n+=ds(r,a,!0);this.translateY=e-n}},{key:"setThresholdWidth",value:function(e,t,i){for(var n=0,r=this.parent.getActiveSheet(),a=this.parent.viewport.leftIndex+i,s=a+t;a<s;a++)n+=ms(r,a,null,!0);this.translateX=e-n}},{key:"translate",value:function(e){if(!e.skipTranslate){var t=this.parent.enableRtl?-this.translateX:this.translateX;"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate(".concat(t,"px, ").concat(this.translateY,"px)"),this.rowHeader.style.transform="translate(0px, ".concat(this.translateY,"px)")),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform="translate(".concat(t,"px, ").concat(this.translateY,"px)"),this.colHeader.style.transform="translate(".concat(t,"px, 0px)"))}}},{key:"updateColumnWidth",value:function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.parent.getActiveSheet(),i=vs(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=i+"px",this.content.style.width=i+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var n=this.parent.element.querySelector(".e-scroller .e-virtualtrack"),r=parseInt(n.style.width,10),a=i+this.translateX+this.parent.viewport.beforeFreezeWidth;if(a>r)n.style.width=r+(a-r)+"px";else{var s=r-a,o=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];r-s<parseInt(o.style.width,10)&&(n.style.width=o.style.width)}}}else if(!this.parent.scrollSettings.isFinite){var l=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0],h=parseInt(l.style.height,10),c=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(c>h)l.style.height=h+(c-h)+"px";else{var d=h-c,u=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];h-d<parseInt(u.style.height,10)&&(l.style.height=u.style.height)}}}},{key:"updateUsedRange",value:function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var i=this.getVTrackHeight("height"),n=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?n+=ps(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n-=ps(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),n<i)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,i,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index>this.scroll[this.parent.activeSheetIndex].colCount){var r=this.getVTrackHeight("width");r+=vs(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0),this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,r,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}}},{key:"getVTrackHeight",value:function(e){var t=this.content.nextElementSibling.style[e];if(t.includes("e+")){var i=(t=t.split("px")[0]).split("e+");return Number(i[0])*Math.pow(10,Number(i[1]))}return parseFloat(t)}},{key:"updateVTrackHeight",value:function(e){e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height")}},{key:"updateVTrackWidth",value:function(e){if(e.colIdx>=this.parent.viewport.leftIndex&&e.colIdx<=this.parent.viewport.rightIndex){var t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseFloat(t.style.width)+e.threshold+"px";var i=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";var n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var r=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];r.style.width=parseFloat(r.style.width)+e.threshold+"px"}}},{key:"updateVTrack",value:function(e,t,i){e.nextElementSibling.style[i]="".concat(t,"px"),this.content.nextElementSibling.style[i]="".concat(t,"px")}},{key:"deInitProps",value:function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null}},{key:"updateScrollProps",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sheetIndex:0,sheets:this.parent.sheets};0===this.scroll.length?this.initScroll():t.sheets.forEach(function(){e.scroll.splice(t.sheetIndex,0,{rowCount:0,colCount:0})})}},{key:"sliceScrollProps",value:function(e){Object(f.Z)(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)}},{key:"addEventListener",value:function(){this.parent.on("beforeContentLoaded",this.createVirtualElement,this),this.parent.on("beforeVirtualContentLoaded",this.translate,this),this.parent.on("virtualContentLoaded",this.updateColumnWidth,this),this.parent.on("updateTableWidth",this.updateColumnWidth,this),this.parent.on("verticalScroll",this.onVerticalScroll,this),this.parent.on("horizontalScroll",this.onHorizontalScroll,this),this.parent.on("updateUsedRange",this.updateUsedRange,this),this.parent.on("rowHeightChanged",this.updateVTrackHeight,this),this.parent.on("colWidthChanged",this.updateVTrackWidth,this),this.parent.on("deInitProperties",this.deInitProps,this),this.parent.on("sheetsDestroyed",this.sliceScrollProps,this),this.parent.on("sheetCreated",this.updateScrollProps,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null}},{key:"removeEventListener",value:function(){this.parent.off("beforeContentLoaded",this.createVirtualElement),this.parent.off("beforeVirtualContentLoaded",this.translate),this.parent.off("virtualContentLoaded",this.updateColumnWidth),this.parent.off("updateTableWidth",this.updateColumnWidth),this.parent.off("verticalScroll",this.onVerticalScroll),this.parent.off("horizontalScroll",this.onHorizontalScroll),this.parent.off("updateUsedRange",this.updateUsedRange),this.parent.off("rowHeightChanged",this.updateVTrackHeight),this.parent.off("colWidthChanged",this.updateVTrackWidth),this.parent.off("sheetsDestroyed",this.sliceScrollProps),this.parent.off("sheetCreated",this.updateScrollProps),this.parent.off("spreadsheetDestroyed",this.destroy)}}]),e}(),mo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on(wr,this.keyDownHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off(wr,this.keyDownHandler)}},{key:"keyDownHandler",value:function(e){if(!this.parent.isEdit&&(document.activeElement.classList.contains("e-spreadsheet")||Object(f.D)(document.activeElement,".e-sheet"))&&!Object(f.D)(e.target,".e-name-box")){var t,i=this.parent.enableRtl,n=this.parent.getActiveSheet(),r={e:e,isFilterCell:!1},a=Zn(this.parent.getActiveSheet().activeCell);if([9,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.shiftKey&&this.shiftSelection(e),e.shiftKey||!e.altKey||38!==e.keyCode&&40!==e.keyCode||this.parent.notify("filterCellKeyDown",r),!e.shiftKey&&(!i&&37===e.keyCode||i&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(a[1]>0)a[1]-=1,t=!0;else{var s=this.parent.getMainContent();0===a[1]&&s.scrollLeft&&!i&&(s.scrollLeft=0)}else if(e.shiftKey&&13===e.keyCode){if(!this.parent.element.querySelector(".e-find-toolbar"))if(a[0]>0)a[0]-=1,t=!0;else{var o=this.parent.getMainContent().parentElement;0===a[0]&&o.scrollTop&&(o.scrollTop=0)}}else if(r.isFilterCell||e.shiftKey||38!==e.keyCode){if(!e.shiftKey&&(!i&&39===e.keyCode||i&&37===e.keyCode)||9===e.keyCode){var l=Da(a[0],a[1],n);l&&l.colSpan>1&&(a[1]+=l.colSpan-1),a[1]<n.colCount-1&&(a[1]+=1,t=!0)}else if(!r.isFilterCell&&!e.shiftKey&&40===e.keyCode||13===e.keyCode){var h=Da(a[0],a[1],n);h&&h.rowSpan>1&&(a[0]+=h.rowSpan-1),a[0]<n.rowCount-1&&(a[0]+=1,t=!0)}}else if(a[0]>0)a[0]-=1,t=!0;else{var c=this.parent.getMainContent().parentElement;0===a[0]&&c.scrollTop&&(c.scrollTop=0)}if(t){for(;cs(this.parent.getActiveSheet(),a[0]);)40===e.keyCode&&(a[0]=a[0]+1),38===e.keyCode&&(a[0]=a[0]-1);this.scrollNavigation(a,!1),this.parent.setSheetPropertyOnMute(n,"activeCell",Xn(a)),this.parent.notify("cellNavigate",{range:a})}}e.target.classList.contains("e-sheet-rename")&&(32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify("renameSheet",e))}},{key:"shiftSelection",value:function(e){var t=this.parent.getActiveSheet(),i=Wn(t.selectedRange),n=$n(i),r=!0;if(38===e.keyCode){for(var a=n[1];a<=n[3];a++){var s=Da(i[2],a,this.parent.getActiveSheet());if(!Object(f.Z)(s)&&s.rowSpan&&s.rowSpan<0){i[2]=i[2]-(Math.abs(s.rowSpan)+1),r=!1;break}}r&&(i[2]=i[2]-1),i[2]<0&&(i[2]=0)}if(40===e.keyCode){for(var o=n[1];o<=n[3];o++){var l=Da(i[2],o,this.parent.getActiveSheet());if(!Object(f.Z)(l)&&l.rowSpan&&l.rowSpan>0){i[2]=i[2]+Math.abs(l.rowSpan),r=!1;break}}r&&(i[2]=i[2]+1)}if(39===e.keyCode){for(var h=n[0];h<=n[2];h++){var c=Da(h,i[3],this.parent.getActiveSheet());if(!Object(f.Z)(c)&&c.colSpan&&c.colSpan>0){i[3]=i[3]+Math.abs(c.colSpan),r=!1;break}}r&&(i[3]=i[3]+1)}if(37===e.keyCode){for(var d=n[0];d<=n[2];d++){var u=Da(d,i[3],this.parent.getActiveSheet());if(!Object(f.Z)(u)&&u.colSpan&&u.colSpan<0){i[3]=i[3]-(Math.abs(u.colSpan)+1),r=!1;break}}r&&(i[3]=i[3]-1),i[3]<0&&(i[3]=0)}if(e.shiftKey&&e.ctrlKey&&!this.parent.scrollSettings.enableVirtualization){var p=[t.usedRange.rowIndex,t.usedRange.colIndex];37===e.keyCode&&(i[3]=i[3]<=p[1]?0:p[1]),38===e.keyCode&&(i[2]=i[2]<=p[0]?0:p[0]),39===e.keyCode&&(i[3]=i[3]<=p[1]?p[1]:this.parent.getActiveSheet().colCount),40===e.keyCode&&(i[2]=i[2]<=p[0]?p[0]:this.parent.getActiveSheet().rowCount)}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){for(;cs(this.parent.getActiveSheet(),i[2]);)40===e.keyCode&&(i[2]=i[2]+1),38===e.keyCode&&(i[2]=i[2]-1);this.parent.selectRange(Xn(i)),this.scrollNavigation([i[2],i[3]],!1)}}},{key:"scrollNavigation",value:function(e,t){if(this.parent.allowScrolling){var i=this.parent.enableRtl?-1:1,n=this.parent.getMainContent().parentElement,r=this.parent.getScrollElement(),a=this.parent.getActiveSheet(),s=$n(Wn(a.selectedRange)),o=Zn(a.topLeftCell),l=this.parent.frozenRowCount(a),h=this.parent.frozenColCount(a),c=Zn(a.paneTopLeftCell),d=e[0]<l?o[0]:c[0],u=e[1]<h?o[1]:c[1],p=this.parent.scrollModule.offset.left.size,g=this.parent.scrollModule.offset.top.size;if(l&&e[0]!==s[2]&&n.scrollTop){if(e[0]===l)return void(n.scrollTop=0);e[0]===l-1&&(n.scrollTop=0)}if(h&&e[1]!==s[3]&&r.scrollLeft){if(e[1]===h)return void(r.scrollLeft=0);e[1]===h-1&&(r.scrollLeft=0)}this.getBottomIdx(d)<=e[0]||t?n.scrollTop=g+ds(a,c[0],!0):d>e[0]&&(n.scrollTop=g-Math.ceil(ds(a,e[0],!0))),this.getRightIdx(u)<=e[1]||t?r.scrollLeft=p+ms(a,c[1],null,!0)*i:u>e[1]&&(r.scrollLeft=p-ms(a,e[1],null,!0)*i)}}},{key:"getBottomIdx",value:function(e){for(var t=0,i=this.parent.getActiveSheet(),n=(i.frozenRows?this.parent.viewport.height-this.parent.sheetModule.getColHeaderHeight(i,!0):this.parent.viewport.height)-17||20,r=e;;r++)if((t+=ds(i,r,!0))>=n)return r}},{key:"getRightIdx",value:function(e){for(var t=0,i=this.parent.getActiveSheet(),n=this.parent.getMainContent().parentElement.offsetWidth-this.parent.sheetModule.getRowHeaderWidth(i),r=e;;r++)if((t+=ms(i,r,null,!0))>=n-17)return r}},{key:"getModuleName",value:function(){return"keyboardNavigation"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}}]),e}(),vo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on(wr,this.keyDownHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off(wr,this.keyDownHandler)}},{key:"keyDownHandler",value:function(e){if(e.ctrlKey||e.metaKey){if(Object(f.D)(e.target,".e-find-dlg")||([79,83].indexOf(e.keyCode)>-1?e.preventDefault():65!==e.keyCode||this.parent.isEdit||e.preventDefault()),79===e.keyCode)Object(f.ob)("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.save();else if(67===e.keyCode)this.parent.notify("copy",{promise:Promise});else if(75===e.keyCode){var t,i=Zn(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[i[0]];e.preventDefault(),Object(f.Z)(n)||(t=n.cells[i[1]]),Object(f.Z)(t)&&Ma(i[0],i[1],this.parent.getActiveSheet(),t,!1),this.parent.notify(t&&t.hyperlink?"editHyperlink":"initiateHyperlink",null)}else 90===e.keyCode?this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!0})):89===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify("performUndoRedo",{isUndo:!1})));var r,a=this.parent.sheets[this.parent.getActiveSheet().id-1];if(a){var s=Zn(a.activeCell),o=Da(s[0],s[1],a);r=a.isProtected&&Ra(o,gs(a,s[1]))}if(70===e.keyCode&&(e.preventDefault(),this.parent.notify("ribbonFind",null)),!(r&&a.isProtected&&86!==e.keyCode||70===e.keyCode)){if(71===e.keyCode)e.preventDefault(),this.parent.notify(Er,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(Lr,null);else if(88===e.keyCode)this.parent.notify("cut",{promise:Promise});else if(86===e.keyCode)this.parent.notify(Ir,{isAction:!0});else if(66===e.keyCode){e.preventDefault();var l=this.parent.getCellStyleValue(["fontWeight"],Zn(this.parent.getActiveSheet().activeCell)).fontWeight;l="bold"===l?"normal":"bold",this.parent.notify(dr,{style:{fontWeight:l},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){e.preventDefault();var h=this.parent.getCellStyleValue(["fontStyle"],Zn(this.parent.getActiveSheet().activeCell)).fontStyle;h="italic"===h?"normal":"italic",this.parent.notify(dr,{style:{fontStyle:h},onActionUpdate:!0,refreshRibbon:!0})}else 85===e.keyCode?(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"underline"},refreshRibbon:!0})):53===e.keyCode&&(e.preventDefault(),this.parent.notify("textDecorationUpdate",{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.applyFilter()))}}27===e.keyCode&&this.parent.notify("clearCopy",null)}},{key:"getModuleName",value:function(){return"keyboardShortcut"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}}]),e}(),yo=function(){function e(t){a(this,e),this.checkHeight=!1,this.parent=t,this.row=t.createElement("tr",{className:"e-row"}),this.parent.on("initialLoad",this.addEventListener,this)}return o(e,[{key:"applyCellFormat",value:function(e){var t=Object.keys(e.style),i=this.parent.getActiveSheet();if(!(e.lastCell&&no(i,e.rowIdx)<=20)||t.length){var n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(this.updateMergeBorder(e,i),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var r={};Object.keys(e.style).forEach(function(t){r[t]=e.style[t]}),void 0!==r.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,i),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,i),delete r.border),void 0!==r.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,i),delete r.borderTop),void 0!==r.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,i),delete r.borderLeft),Object.keys(r).length&&(void 0!==r.borderBottom&&this.setThickBorderHeight(r.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,r))}else{void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style),n.firstElementChild&&n.firstElementChild.classList.contains("e-wrap-content")&&Object.assign(n.firstElementChild.style,e.style);var a=Da(e.rowIdx,e.colIdx,i);a&&(a.rowSpan||a.colSpan)&&n.offsetHeight>0&&Js(this.parent,a.style||this.parent.cellStyle)>n.offsetHeight&&Ks(this.parent,i,n.offsetHeight,e.rowIdx)}if(e.isHeightCheckNeeded&&(!i.rows[e.rowIdx]||!i.rows[e.rowIdx].customHeight))if(e.manualUpdate)this.checkHeight||(this.checkHeight=this.isHeightCheckNeeded(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate);else{var s=Da(e.rowIdx,e.colIdx,i);if(s&&s.wrap||!this.isHeightCheckNeeded(e.style)||io(i,e.rowIdx,e.colIdx,to(this.parent,e.rowIdx,e.colIdx,i,e.style)),e.lastCell){var o=no(i,e.rowIdx);o>20&&o>ds(i,e.rowIdx)&&Ks(this.parent,i,o,e.rowIdx,e.row,e.hRow,this.parent.scrollSettings.isFinite)}}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}}},{key:"updateRowHeight",value:function(e,t,i,n){if(this.checkHeight){var r,a=0,s=this.parent.getActiveSheet(),o=Da(e,t,s,null,!0),l=this.parent.getCell(e,t);if(o&&!o.rowSpan&&!o.colSpan){if(a=to(this.parent,e,t,s,o.style||this.parent.cellStyle,o.wrap?$s(this.parent.getDisplayText(o),eo(s,e,t),o.style,this.parent.cellStyle):1),!Object(f.Z)(o.value)&&o.value.toString().indexOf("\n")>-1){var h,c=o.value.split("\n"),d=0,u=c.length;for(h=0;h<u;h++){var p=$s(c[h],eo(s,e,t),o.style,this.parent.cellStyle);0===p&&(p=1),d+=p}a=to(this.parent,e,t,s,o.style||this.parent.cellStyle,d)}if(a<20&&(a=20),l&&l.children[0]&&"e-cf-databar"===l.children[0].className&&(l.children[0].style.height="100%",l.children[0].firstElementChild.nextElementSibling.style.height="100%"),io(s,e,t,a),i){this.checkHeight=!1;var g=s.frozenRows?this.parent.getRow(e,null,s.frozenColumns):this.parent.getRow(e);if(!g)return;var m=ds(s,e);r=no(s,e),(n?r!==m:r>m)&&Ks(this.parent,s,r,e,g,null,!0)}}}}},{key:"updateMergeBorder",value:function(e,t){var i=Da(e.rowIdx,e.colIdx,t,null,!0),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(mr,n),i.rowSpan>1&&!e.style.borderBottom){var r=Da(n.range[2],n.range[1],t,null,!0);r.style&&r.style.borderBottom&&(e.style.borderBottom=r.style.borderBottom)}if(i.colSpan>1&&!e.style.borderRight){var a=Da(n.range[0],n.range[3],t,null,!0);a.style&&a.style.borderRight&&(e.style.borderRight=a.style.borderRight)}}},{key:"isHeightCheckNeeded",value:function(e,t){var i=Object.keys(e);return(t?i.indexOf("fontSize")>-1:i.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||i.indexOf("fontFamily")>-1||i.indexOf("borderTop")>-1||i.indexOf("borderBottom")>-1}},{key:"setLeftBorder",value:function(e,t,i,n,r,a,s,o){if(!s||!s.includes("Column")){var l=this.parent.getCell(i,n-1,r);if(l){var h=Da(i,n-1,o,!1,!0);if(h.rowSpan&&1!==h.rowSpan||h.colSpan&&1!==h.colSpan){var c={range:[i,n-1,i,n-1]};if(this.parent.notify(mr,c),(h=Da(c.range[0],c.range[1],o,!1,!0)).style&&h.style.borderRight&&"none"!==h.style.borderRight)return;if((h=Da(c.range[0],c.range[3],o,null,!0)).style&&h.style.borderRight&&"none"!==h.style.borderRight)return;t.style.borderLeft=e}else a&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}}},{key:"setTopBorder",value:function(e,t,i,n,r,a,s,o,l,h,c){if(!o||!o.includes("Row")){var d=this.parent.getCell(i-1,n,r);if(d){var u=Da(i-1,n,c,!1,!0);if(u.rowSpan&&1!==u.rowSpan||u.colSpan&&1!==u.colSpan){var p={range:[i-1,n,i-1,n]};if(this.parent.notify(mr,p),(u=Da(p.range[0],p.range[1],c,!1,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;if((u=Da(p.range[2],p.range[1],c,null,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;t.style.borderTop=e}else{if(cs(c,i-1)){var g=[Number(d.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],g).bottomPriority)return}s&&""!==e&&c.topLeftCell.includes("".concat(i+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,i-1,n,d,r,a,s,l,h),d.style.borderBottom="none"===e?d.style.borderBottom:e}}else t.style.borderTop=e}}},{key:"setThickBorderHeight",value:function(e,t,i,n,r,a,s,o,l){var h=e?this.getBorderSize(e):1,c=this.parent.getActiveSheet();if(h>2&&(!c.rows[t]||!c.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,i,o,s);else{var d=ds(c,t),u=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,i]),1,3));u>d&&(Ks(this.parent,c,u,t,r,a,!1),this.parent.notify("rowHeightChanged",{rowIdx:t,threshold:u-20}))}!s||!o&&this.checkHeight||!(h<3)||c.rows[t]&&c.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,i,o,s))}},{key:"getBorderSize",value:function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)?parseInt(t,10):1}},{key:"clearObj",value:function(e){var t,i,n=e.options,r=n.range?n.range.indexOf("!")>0?n.range.split("!")[1]:n.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,a=n.range&&n.range.indexOf("!")>0?Wa(this.parent,n.range.split("!")[0]):this.parent.activeSheetIndex,s=Wn(r),o=this.parent.sheets[a],l=s[0],h=s[2],c={range:r,type:n.type,requestType:"clear",sheetIndex:a};if(e.isPublic||this.parent.notify(Ar,{action:"beforeClear",eventArgs:c}),"Clear Formats"===n.type||"Clear All"===n.type)for(this.parent.notify("clearCFRule",{range:r,isPublic:!1,isclearFormat:!0});l<=h;l++)for(t=s[1],i=s[3];t<=i;t++){var d=Da(l,t,o),u=this.parent.getCell(l,t);d&&(d.wrap&&this.parent.notify("wrapText",{range:[l,t,l,t],wrap:!1,sheet:o}),d.hyperlink&&(Object(f.lb)(u.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===n.type&&this.parent.removeHyperlink(Xn([l,t,l,t]))))}"Clear Hyperlinks"!==n.type?(this.parent.notify("clear",{range:o.name+"!"+r,type:n.type}),this.parent.serviceLocator.getService("cell").refreshRange(Wn(r)),e.isPublic||(c={range:o.name+"!"+r,type:n.type,sheetIndex:a},this.parent.notify("actionComplete",{eventArgs:c,action:"clear"})),this.parent.notify("addHighlight",{range:r,isclearFormat:!0}),this.parent.notify("selectRange",{address:r})):this.parent.removeHyperlink(r)}},{key:"addEventListener",value:function(){this.parent.on(ur,this.applyCellFormat,this),this.parent.on("clearViewer",this.clearObj,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("initialLoad",this.addEventListener),this.parent.off(ur,this.applyCellFormat),this.parent.off("clearViewer",this.clearObj))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null,this.row=null,this.checkHeight=null}},{key:"getModuleName",value:function(){return"cellformat"}}]),e}(),bo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("contentLoaded",this.wireEvents,this),this.parent.on(Or,this.autoFit,this),this.parent.on("setAutoFit",this.setAutoFitHandler,this)}},{key:"autoFit",value:function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],i=e.startIndex;i<=e.endIndex;i++)this.trgtEle=e.isRow?this.parent.getRow(i,t):this.parent.getCell(null,i,t),this.setAutofit(i,!e.isRow)}},{key:"wireEvents",value:function(){var e=this.parent.getRowHeaderContent(),t=this.parent.element.getElementsByClassName("e-header-panel")[0];f.l.add(t,"dblclick",this.dblClickHandler,this),f.l.add(e,"dblclick",this.dblClickHandler,this),f.l.add(t,"mousedown",this.mouseDownHandler,this),f.l.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,t)}},{key:"wireResizeCursorEvent",value:function(e,t){f.l.add(e,"mousemove",this.setTarget,this),f.l.add(t,"mousemove",this.setTarget,this)}},{key:"unWireResizeCursorEvent",value:function(){f.l.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget),f.l.remove(this.parent.element.getElementsByClassName("e-header-panel")[0],"mousemove",this.setTarget)}},{key:"unwireEvents",value:function(){f.l.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),f.l.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),f.l.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),f.l.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("contentLoaded",this.wireEvents),this.parent.off(Or,this.autoFit),this.parent.off("setAutoFit",this.setAutoFitHandler))}},{key:"mouseMoveHandler",value:function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],i=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];(t||i)&&(this.isMouseMoved=!0,t?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):i&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(i.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px"))}},{key:"mouseDownHandler",value:function(e){if(Object(f.D)(e.target,".e-header-cell")){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var t=this.trgtEle.offsetHeight,i=e.offsetY;(t>=10&&i<5||t-2<8&&i<Math.ceil((i-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var n=this.trgtEle,r=n.classList.contains("e-colresize")?"e-colresize-handler":n.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(n,r),this.unWireResizeCursorEvent(),f.l.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),f.l.add(document,"mouseup",this.mouseUpHandler,this)}}},{key:"mouseUpHandler",value:function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],i=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeOn(e),this.isMouseMoved=null;var n=t||i;n&&(document.getElementById(this.parent.element.id+"_sheet").removeChild(n),this.updateCursor()),f.l.remove(document,"mouseup",this.mouseUpHandler),f.l.remove(this.parent.element,"mousemove",this.mouseMoveHandler),this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),this.parent.element.getElementsByClassName("e-header-panel")[0])}},{key:"dblClickHandler",value:function(e){if(Object(f.D)(e.target,".e-header-cell"))if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){var t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,i="".concat(ms(this.parent.getActiveSheet(),t),"px");this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(t-1):this.setAutofit(t,!0,i)}else if(this.trgtEle.classList.contains("e-rowresize")){var n=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,r="".concat(ds(this.parent.getActiveSheet(),n),"px");this.setAutofit(n,!1,r)}}},{key:"setTarget",value:function(e){if(Object(f.D)(e.target,".e-header-cell")){var t,i,n,r,a=e.target,s=this.parent.getActiveSheet();if(s.isProtected&&(!s.protectSettings.formatColumns||!s.protectSettings.formatRows)){if(!s.protectSettings.formatRows&&!s.protectSettings.formatColumns)return;if(s.protectSettings.formatRows&&Object(f.D)(a,".e-colhdr-table"))return;if(s.protectSettings.formatColumns&&Object(f.D)(a,".e-rowhdr-table"))return}if(Object(f.D)(a,".e-header-row")){n=e.offsetX,i=a.offsetWidth,r="e-colresize";var o=this.getColPrevSibling(a);o&&!o.classList.contains("e-select-all-cell")?t=o:Number(a.getAttribute("aria-colindex"))>1&&(t=a)}else if(Object(f.D)(a,".e-row")){n=e.offsetY,i=a.offsetHeight,r="e-rowresize";var l=this.getRowPrevSibling(a);l?t=l.firstElementChild:Number(a.parentElement.getAttribute("aria-rowindex"))>1&&(t=a)}if(i-2<8&&n!==Math.ceil((i-2)/2))n<Math.ceil((i-2)/2)?(a.classList.add(r),t.classList.add(r)):n>Math.ceil((i-2)/2)&&a.classList.add(r);else if(i-5<n&&n<=i&&i>=10)a.classList.add(r);else if(n<5&&t&&i>=10)a.classList.add(r),t.classList.add(r);else for(var h=this.parent.element.getElementsByClassName(r),c=0;c<h.length;c++)h[c].classList.remove(r)}}},{key:"getColPrevSibling",value:function(e){var t=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(t&&Object(f.D)(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)}},{key:"getRowPrevSibling",value:function(e){var t=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(t&&Object(f.D)(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)}},{key:"updateTarget",value:function(e,t){if(Object(f.D)(t,".e-header-row")){if(t.offsetWidth<10&&e.offsetX<Math.ceil((t.offsetWidth-2)/2)||e.offsetX<5&&t.offsetWidth>=10&&t.classList.contains("e-colresize")){var i=this.parent.getActiveSheet(),n=Number(this.trgtEle.getAttribute("aria-colindex"))-2,r=this.getColPrevSibling(t);r&&!ys(i,n)?this.trgtEle=r:n>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(t.offsetHeight<10&&e.offsetY<Math.ceil((t.offsetHeight-2)/2)||e.offsetY<5&&t.offsetHeight>=10&&t.classList.contains("e-rowresize")){var a=this.parent.getActiveSheet(),s=Number(t.parentElement.getAttribute("aria-rowindex"))-2,o=this.getRowPrevSibling(t);if(o||cs(a,s))if("dblclick"===e.type&&cs(a,s)){var l,h=$n(Wn(a.selectedRange));l=s<=h[2]&&s>h[0]?{startIndex:h[0],endIndex:h[2],hide:!1,autoFit:!0}:{startIndex:s,endIndex:s,hide:!1,autoFit:!0},this.parent.notify("hideShow",l)}else cs(a,s)||(this.trgtEle=o.getElementsByClassName("e-header-cell")[0])}}},{key:"setAutoFitHandler",value:function(e){this.setAutofit(e.idx,e.isCol)}},{key:"setAutofit",value:function(e,t,i){var n=0,r=this.parent.getActiveSheet(),a=this.parent.getMainContent(),s="".concat(t?ms(this.parent.getActiveSheet(),e):ds(this.parent.getActiveSheet(),e),"px"),o=[],l=a.getElementsByClassName("e-content-table")[0];this.parent.getActiveSheet().showHeaders&&(t?this.parent.getColHeaderTable():this.parent.getRowHeaderTable()).getElementsByTagName("tr");var h=!1,c=0;if(t){for(var d=r.rows.length,u=0;u<d;u++)if(r.rows[u]&&r.rows[u].cells&&r.rows[u].cells[e]){Da(u,e,r).wrap&&(h=!0,c++);var p=this.parent.createElement("td",{className:"e-cell"});if(p.textContent=this.parent.getDisplayText(r.rows[u].cells[e]),r.rows[u].cells[e].style){var g=r.rows[u].cells[e].style;g.fontFamily&&(p.style.fontFamily=g.fontFamily),g.fontSize&&(p.style.fontSize=g.fontSize)}o[n]=p,n++}}else for(var f=r.rows[e]&&r.rows[e].cells?r.rows[e].cells.length:0,m=0;m<f;m++)if(r.rows[e]&&r.rows[e].cells[m]){Da(e,m,r).wrap&&(h=!0,c++);var v=this.parent.createElement("td");if(v.textContent=this.parent.getDisplayText(r.rows[e].cells[m]),r.rows[e].cells[m].style){var y=r.rows[e].cells[m].style;y.fontFamily&&(v.style.fontFamily=y.fontFamily),y.fontSize&&(v.style.fontSize=y.fontSize)}o[n]=v,n++}if(0===c){var b=Gs(l,o,t,this.parent,i,h);t&&(b=this.getFloatingElementWidth(b,e));var C=0===b?parseInt(s,10):b,x=parseInt(s,10)>C?-(parseInt(s,10)-C):C-parseInt(s,10);if(t)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)gs(r,e).width=C>0?C:0,this.resizeStart(e,this.parent.getViewportIndex(e,!0),C+"px",t,!0,i),this.parent.notify("colWidthChanged",{threshold:x,colIdx:e});else{var S,w=ms(r,e);S=C>0?-(w-C):-w,this.parent.notify("colWidthChanged",{threshold:S,colIdx:e}),gs(r,e).width=C>0?C:0}else if(!t)if(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex)us(r,e,(C=C>20?C:20)>0?C:0),hs(r,e,{customHeight:!1}),this.resizeStart(e,this.parent.getViewportIndex(e),C+"px",t,!0,i),this.parent.notify("rowHeightChanged",{threshold:x,rowIdx:e});else{var k,I=ds(r,e);k=C>0?-(I-C):-I,this.parent.notify("rowHeightChanged",{threshold:k,rowIdx:e}),us(r,e,C>0?C:0)}}}},{key:"createResizeHandler",value:function(e,t){var i=this.parent.createElement("div",{className:t}),n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(i.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",i.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",i.style.top="0px"):e.classList.contains("e-rowresize")&&(i.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",i.style.left="0px",i.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(i),this.updateCursor()}},{key:"setColWidth",value:function(e,t,i,n){var r=this.parent.getActiveSheet(),a=Vs(i)-n;if(a<0&&n<-a&&(a=-n),i>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,i),void this.parent.notify(Rr,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:"".concat(n,"px"),hide:!1},action:"resize"});this.resizeStart(e,t,"".concat(i,"px"),!0,!1,"".concat(n,"px")),fs(r,e,{width:i,customWidth:!0}),this.parent.notify("colWidthChanged",{threshold:a,colIdx:e})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.parent.notify(Rr,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:"".concat(n,"px"),hide:!0},action:"resize"}))}},{key:"showHiddenColumns",value:function(e,t){var i,n,r,a=this.parent.getActiveSheet(),s=Wn(a.selectedRange);if(e>=s[1]&&e<=s[3]&&s[2]===a.rowCount-1&&Zn(a.activeCell)[0]===Zn(a.topLeftCell)[0]?(i=s[1],n=s[3],r=this.parent.getMainContent().querySelector("colgroup")):i=n=e,void 0!==t)for(var o=i;o<=n;o++)fs(a,o,{width:t,customWidth:!0}),o>=this.parent.viewport.leftIndex&&o<=this.parent.viewport.rightIndex&&!ys(a,o)&&(r.children[this.parent.getViewportIndex(o,!0)].style.width="".concat(t,"px"));this.trgtEle.classList.remove("e-unhide-column"),this.parent.hideColumn(i,n,!1),void 0===t&&this.autoFit({isRow:!1,startIndex:i,endIndex:n})}},{key:"setRowHeight",value:function(e,t,i,n){var r=this.parent.getActiveSheet(),a=this.parent.frozenColCount(r),s=parseInt(this.parent.getRow(e,null,a).style.height,10),o=i,l=Vs(parseInt(o,10))-s;l<0&&s<-l&&(l=-s),this.resizeStart(e,t,o,!1,!1,n),hs(r,e,{height:parseInt(o,10)>0?parseInt(o,10):0,customHeight:!0}),this.parent.notify("rowHeightChanged",{threshold:l,rowIdx:e,isCustomHgt:!0})}},{key:"resizeOn",value:function(e){var t,i,n=this,r=this.parent.getActiveSheet(),a=Wn(r.activeCell),s=Da(a[0],a[1],r);if(this.trgtEle.classList.contains("e-rowresize")){var o=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&cs(r,o)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var l={startIndex:o,endIndex:o,hide:!1,skipAppend:!0};this.parent.notify("hideShow",l);var h=this.parent.getRowHeaderTable().tBodies[0],c=this.parent.getContentTable().tBodies[0];l.hdrRow.style.display="none",l.row.style.display="none",h.insertBefore(l.hdrRow,h.children[l.insertIdx]),c.insertBefore(l.row,c.children[l.insertIdx]),this.trgtEle=l.hdrRow.firstElementChild,l.hdrRow.nextElementSibling.classList.remove("e-hide-end"),l.mergeCollection.forEach(function(e){n.parent.notify(fr,e)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&cs(r,o)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}i=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(i);var d=this.parent.frozenColCount(r),u=this.parent.getRow(i,null,d).style.height,p=e.clientY-this.event.clientY+parseInt(u,10);if(p<=0)return this.parent.hideRow(i),hs(r,i,{height:0,customHeight:!0}),void this.parent.notify(Rr,{eventArgs:{index:i,height:"0px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:u},action:"resize"});if(this.setRowHeight(i,t,"".concat(p,"px"),u),s&&s.rowSpan){var g=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.height=g.offsetHeight+"px"}if("none"===this.trgtEle.parentElement.style.display){var f=this.parent.getActiveSheet(),m=$n(Wn(f.selectedRange));if(i<=m[2]&&i>m[0]){var v;p=ds(f,i);for(var y=m[0];y<=m[2];y++)y!==i&&(u="".concat(ds(f,y),"px"),hs(f,y,{customHeight:!0,height:p}),cs(f,y)?v||(v=y):(this.parent.getRow(y).style.height="".concat(p,"px"),f.showHeaders&&(this.parent.getRow(y,this.parent.getRowHeaderTable()).style.height="".concat(p,"px"))),this.parent.notify(Rr,{eventArgs:{index:y,height:"".concat(p,"px"),isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:u},action:"resize"}));this.parent.hideRow(m[0],i-1,!1),t+=Math.abs(i-v)}else 0===t||cs(f,i-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(f.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){var b;if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,this.trgtEle.classList.contains("e-unhide-column")?(t-=1,b=0):b=ms(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),e.clientX-this.event.clientX+b,b),s&&s.colSpan){var C=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.width=C.offsetWidth+"px"}}}},{key:"resizeStart",value:function(e,t,i,n,r,a){var s,o;Ws(e,t,i,n,this.parent),n?(s={index:e,width:i,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldWidth:a},o=a!==i):(s={index:e,height:i,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldHeight:a},o=a!==i),o&&this.parent.notify(Rr,{eventArgs:s,action:r?"resizeToFit":"resize"})}},{key:"updateCursor",value:function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")}},{key:"getFloatingElementWidth",value:function(e,t){var i=e,n={filterRange:[],hasFilter:!1};return this.parent.notify("getFilterRange",n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(i=e+22),i}},{key:"destroy",value:function(){this.unwireEvents(),this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"resize"}}]),e}(),Co=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"refreshClients",value:function(e){Ys(e,this.parent)}},{key:"addEventListener",value:function(){this.parent.on("collaborativeUpdate",this.refreshClients,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("collaborativeUpdate",this.refreshClients)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"collaborativeEditing"}}]),e}(),xo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"hideShow",value:function(e){var t=this.parent.getActiveSheet();if(!t.frozenRows&&!t.frozenColumns){if(e.startIndex>e.endIndex){var i=e.startIndex;e.startIndex=e.endIndex,e.endIndex=i}e.actionUpdate&&this.parent.notify(Ar,{eventArgs:e,action:"hideShow"}),e.isCol?this.hideCol(e):this.hideRow(e),e.actionUpdate&&this.parent.notify(Rr,{eventArgs:e,action:"hideShow"})}}},{key:"hideRow",value:function(e){var t,i,n,r,a=this,s=this.parent.getActiveSheet(),o=0;if(e.hide){for(var l,h,c,d=e.startIndex;d<=e.endIndex;d++)if(!cs(s,d))if(void 0===i&&(s.showHeaders&&(h=this.parent.getRowHeaderTable()),l=this.parent.getContentTable(),i=this.parent.getViewportIndex(d),o=0),hs(s,d,{hidden:!0}),this.refreshChart(d,"rows"),c=l&&l.rows[i]){if(!r)for(var u=0;u<=s.usedRange.colIndex;u++)if(((t=Da(d,u,s)||{}).colSpan||t.rowSpan)&&(e.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){r=!0;break}if(r)continue;if(s.showHeaders&&Object(f.J)(h.rows[i]),Object(f.J)(c),o++,(c=l.rows[i])&&d===e.endIndex)for(var p=void 0,g=(n=ro(s,d+1,!0))!==ro(s,0,!0)&&n===(this.parent.viewport.topIndex>=e.startIndex?e.endIndex+1:this.parent.viewport.topIndex)?"Row":"",m=this.parent.viewport.leftIndex;m<=this.parent.viewport.rightIndex;m++){var v=this.parent.getCellStyleValue(["borderTop"],[n,m]).borderTop;""!==v&&(p=c.cells[m],this.parent.notify(ur,{onActionUpdate:!1,rowIdx:n,colIdx:m,style:{borderTop:v},row:c,pRow:c.previousElementSibling,first:g,cell:p}))}}else d<=this.parent.viewport.bottomIndex?o++:o--;if(r&&(e.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return this.parent.selectRange(s.selectedRange),void this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});if(!o)return;if(this.parent.selectRange(s.selectedRange),this.parent.scrollSettings.enableVirtualization){var y=e.startIndex,b=e.startIndex;this.parent.viewport.topIndex>=e.startIndex&&(this.parent.viewport.topIndex=e.endIndex+1),e.startIndex=this.parent.viewport.bottomIndex+1,e.endIndex=e.startIndex+o-1;var C=this.parent.skipHidden(e.startIndex,e.endIndex);e.startIndex=C[0],e.endIndex=C[1],this.parent.viewport.bottomIndex=e.endIndex,o>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?(y=y<1?b+1:y-1,this.parent.updateTopLeftCell(y,null),this.parent.renderModule.refreshSheet()):this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"",refresh:"RowPart"},"".concat(Yn(e.startIndex,this.parent.viewport.leftIndex),":").concat(Yn(e.endIndex,this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"))))}s.showHeaders&&(0===i?h.rows[0]&&h.rows[0].classList.add("e-hide-end"):(h&&h.rows[i-1]&&h.rows[i-1].classList.add("e-hide-start"),h&&h.rows[i]&&h.rows[i].classList.add("e-hide-end")))}else{for(var x,S,w,k,I,O,R,A,E,L=e.startIndex-1,T=[],j=e.startIndex,D=e.endIndex;j<=D;j++)if(cs(s,j))if(void 0===E)if(j>this.parent.viewport.bottomIndex){if(hs(s,j,{hidden:!1}),void 0===A)return}else{void 0===A&&(A=j),hs(s,j,{hidden:!1}),this.refreshChart(j,"rows"),void 0===i&&(x=document.createDocumentFragment(),S=document.createDocumentFragment(),I=this.parent.serviceLocator.getService("row"),s.showHeaders&&this.parent.getRowHeaderTable()&&(O=this.parent.getRowHeaderTable().tBodies[0]),R=this.parent.getContentTable()?this.parent.getContentTable().tBodies[0]:this.parent.getContentTable(),j<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex=j),i=0===j?0:this.parent.getViewportIndex(j)),L++,s.showHeaders&&(w=I.refresh(j,null,null,!0),x.appendChild(w),O&&O.childElementCount&&Object(f.J)(O.lastElementChild)),k=S.appendChild(I.refresh(j,k,w)),R&&R.childElementCount&&Object(f.J)(R.lastElementChild);for(var M=this.parent.viewport.leftIndex;M<=this.parent.viewport.rightIndex;M++)if(void 0!==(t=Da(j,M,s)||{}).rowSpan){var F={range:[j,M,j,M],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(mr,F),T.length&&F.range[1]===T[T.length-1].range[1]||T.push(F)}}else D=j;else{if(e.startIndex===e.endIndex)return;void 0===i?L++:E=j}if(this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),o=this.parent.hiddenCount(this.parent.viewport.topIndex,e.startIndex)+this.parent.hiddenCount(e.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=o,e.insertIdx=i,e.row=S.querySelector(".e-row"),e.mergeCollection=T,s.showHeaders&&(e.hdrRow=x.querySelector(".e-row"),0!==i&&!cs(s,L-1)&&O.children[i-1]&&O.children[i-1].classList.remove("e-hide-start"),0!==e.startIndex&&cs(s,e.startIndex-1)&&e.hdrRow.classList.add("e-hide-end"),cs(s,L+1)?x.lastElementChild.classList.add("e-hide-start"):O.children[i]&&O.children[i].classList.remove("e-hide-end")),k&&R&&R.children[i]){n=ro(s,L+1,!0);for(var P=this.parent.viewport.leftIndex;P<=this.parent.viewport.rightIndex;P++){var N=this.parent.getCellStyleValue(["borderTop"],[n,P]).borderTop;if(""!==N){this.parent.notify(ur,{onActionUpdate:!1,rowIdx:n,colIdx:P,style:{borderTop:N},pRow:k,cell:R.children[i].children[P],first:""});var B=ro(s,A-1,!1);B>-1?!R.children[i-1]||this.parent.getCellStyleValue(["borderBottom"],[B,P]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[A,P]).borderTop||(R.children[i-1].children[P].style.borderBottom=""):R.children[i].children[P].style.borderTop=""}}}if(e.skipAppend)return;Math.abs(L-A)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet():(s.showHeaders&&O&&O.insertBefore(x,O.children[i]),R&&R.insertBefore(S,R.children[i]),this.parent.selectRange(s.selectedRange),e.autoFit&&s.showHeaders&&this.parent.notify(Or,{startIndex:e.startIndex,endIndex:e.endIndex,isRow:!0}),T.forEach(function(e){a.parent.notify(fr,e)}),void 0!==E&&E!==e.endIndex&&(e.startIndex=E,this.hideRow(e)))}}},{key:"hideCol",value:function(e){for(var t,i=this,n=this.parent.getActiveSheet(),r=[],a=[],s=Zn(n.topLeftCell),o=e.startIndex;o<=e.endIndex;o++)(e.hide?!ys(n,o):ys(n,o))&&(fs(n,o,{hidden:e.hide}),this.refreshChart(o,"columns"),this.parent.scrollSettings.enableVirtualization&&(o<this.parent.viewport.leftIndex||o>this.parent.viewport.rightIndex)?o<this.parent.viewport.leftIndex&&a.push(o):(r.push(o),e.hide&&s[1]===o&&(t=!0)));if(a.length||r.length)if(e.hide){if(!r.length)return;if((r.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization)&&this.removeCell(n,r),this.parent.scrollSettings.enableVirtualization){if(r[0]===this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex=ro(n,r[r.length-1]+1,!0,"columns")),t){var l=0;if(r.slice(0,r.indexOf(s[1])).forEach(function(e){l+=ms(n,e,!0)}),l){this.parent.notify("setScrollEvent",{set:!1});var h=this.parent.getMainContent();h.scrollLeft-=l,this.parent.notify("onContentScroll",{scrollLeft:h.scrollLeft,preventScroll:!0,skipHidden:!0}),bs(function(){return i.parent.notify("setScrollEvent",{set:!0})})}}if(this.parent.scrollSettings.isFinite){var c=ro(n,n.colCount-1,!1,"columns"),d=this.parent.viewport.leftIndex,u=this.parent.viewport.rightIndex;if(u+r.length>=c){var p=ro(n,d-(u+r.length-c),!1,"columns");return p>-1&&(this.parent.viewport.leftIndex=p,this.parent.viewport.leftIndex-=this.parent.hiddenCount(u,c)),this.parent.viewport.rightIndex=c,d!==this.parent.viewport.leftIndex||u!==this.parent.viewport.rightIndex?this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===ro(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}):this.parent.notify("updateTableWidth",{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(n.selectedRange)}}if(r.length<=this.parent.getThreshold("col")){var g=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+r.length,"columns");this.parent.viewport.rightIndex=g[1],this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:g[0],direction:"",refresh:"ColumnPart"},"".concat(Xn([this.parent.viewport.topIndex,g[0],this.parent.viewport.bottomIndex,g[1]])))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===ro(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})}this.parent.selectRange(n.selectedRange)}else{if(a.length){if(a.sort(function(e,t){return e-t}),this.parent.scrollSettings.enableVirtualization&&a[0]<this.parent.getThreshold("col")){var f=Zn(n.topLeftCell)[0]+1;this.parent.setSheetPropertyOnMute(n,"topLeftCell","A".concat(f)),this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column"}),this.parent.selectRange(n.selectedRange)}else this.parent.goTo(Yn(this.parent.viewport.topIndex,a[0]));return}r.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization?(this.appendCell(n,r),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:{rowCount:n.rowCount,colCount:n.colCount}})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===ro(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(n.selectedRange)}}},{key:"removeCell",value:function(e,t){var i,n,r,a,s,o,l=this,h=0,c=this.parent.getViewportIndex(t[0],!0)+1;this.parent.scrollSettings.enableVirtualization?(i=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(i=0,n=e.rowCount-1);var d,u=this.parent.getContentTable(),p=u.getElementsByTagName("colgroup")[0];if(e.showHeaders){var g=this.parent.getColHeaderTable();s=g.getElementsByTagName("colgroup")[0],r=g.rows[0]}for(var m=t.length-1;i<=n;)cs(e,i)?i++:(a=u.rows[h],t.forEach(function(n,u){if(Object(f.J)(a.cells[c]),0===h&&(e.showHeaders&&(Object(f.J)(r.cells[c]),Object(f.J)(s.children[c])),Object(f.J)(p.children[c])),0===u&&(void 0!==(o=Da(i,n,e)||{}).colSpan&&(void 0===o.rowSpan||o.colSpan>1)&&l.parent.notify("hiddenMerge",{rowIdx:i,colIdx:n,model:"col",start:t[0],end:t[m]})),u===m){d=ro(e,n+1,!0,"columns");var g=l.parent.getCellStyleValue(["borderLeft"],[h,d]).borderLeft;""!==g&&l.parent.notify(ur,{onActionUpdate:!1,rowIdx:h,colIdx:d,style:{borderLeft:g},row:a,first:""}),void 0!==(o=Da(i,n,e)||{}).colSpan&&(void 0===o.rowSpan||o.colSpan>1)&&l.parent.notify("hiddenMerge",{rowIdx:i,colIdx:n,model:"col",start:t[0],end:t[m],isEnd:!0})}}),i++,h++);c-1>-1&&e.showHeaders&&r.cells[c-1]&&r.cells[c-1].classList.add("e-hide-start"),e.showHeaders&&r.cells[c]&&r.cells[c].classList.add("e-hide-end")}},{key:"appendCell",value:function(e,t){var i,n,r,a,s,o,l=this,h=0;this.parent.scrollSettings.enableVirtualization?(i=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(i=0,n=e.rowCount-1);var c=this.parent.getContentTable(),d=this.parent.getColHeaderTable(),u=c.getElementsByTagName("colgroup")[0];e.showHeaders&&(s=d.getElementsByTagName("colgroup")[0],r=d.rows[0]);var p,g=this.parent.serviceLocator.getService("cell");t.sort(function(e,t){return e-t});for(var m,v,y=[],b=[],C=t.length-1;i<=n;)cs(e,i)?i++:(a=c.rows[h],t.forEach(function(n,c){if(0===h&&(b[c]=l.parent.getViewportIndex(n,!0),u.children[b[c]]?(u.insertBefore(l.parent.sheetModule.updateCol(e,n),u.children[b[c]]),e.showHeaders&&(v=r.cells[b[c]],0===c&&t[c]&&!ys(e,t[c]-1)&&v.previousElementSibling.classList.remove("e-hide-start"),r.insertBefore(g.renderColHeader(n),v),c===C&&v.classList.remove("e-hide-end"))):(u.appendChild(l.parent.sheetModule.updateCol(e,n)),e.showHeaders&&r.appendChild(g.renderColHeader(n))),Object(f.J)(u.lastChild),e.showHeaders&&(Object(f.J)(r.lastChild),c===C&&(Object(f.J)(s),d.insertBefore(u.cloneNode(!0),d.tHead[0])))),Object(f.J)(a.lastChild),v=a.cells[b[c]],m=g.render({rowIdx:i,colIdx:n,cell:Da(i,n,e),address:Yn(i,n),lastCell:n===C,isHeightCheckNeeded:!0,first:n!==ro(e,0,!0,"columns")&&n===l.parent.viewport.leftIndex?"Column":"",checkNextBorder:c===C?"Column":""}),v?a.insertBefore(m,v):a.appendChild(m),0===c&&m.previousSibling&&""!==l.parent.getCellStyleValue(["borderLeft"],[h,ro(e,t[t.length-1]+1,!0,"columns")]).borderLeft&&((o=ro(e,t[0]-1,!1,"columns"))>-1&&!l.parent.getCellStyleValue(["borderRight"],[h,o]).borderRight&&!l.parent.getCellStyleValue(["borderLeft"],[h,t[0]]).borderLeft&&(m.previousSibling.style.borderRight="")),void 0!==(p=Da(h,n,e)||{}).colSpan&&(void 0===p.rowSpan||p.colSpan>1)){var x={range:[h,n,h,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};l.parent.notify(mr,x),y.length&&x.range[1]===y[y.length-1].range[1]||y.push(x)}}),i++,h++);y.forEach(function(e){l.parent.notify(fr,e)}),this.parent.viewport.rightIndex=ro(e,this.parent.viewport.rightIndex-t.length,!1,"columns")}},{key:"refreshChart",value:function(e,t){this.parent.notify("refreshChart",{rIdx:e,showHide:t})}},{key:"addEventListener",value:function(){this.parent.on("hideShow",this.hideShow,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.off("hideShow",this.hideShow),this.parent.off("spreadsheetDestroyed",this.destroy)}}]),e}(),So=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("initiateHyperlink",this.initiateHyperlinkHandler,this),this.parent.on("editHyperlink",this.editHyperlinkHandler,this),this.parent.on("openHyperlink",this.openHyperlinkHandler,this),this.parent.on("click",this.hyperlinkClickHandler,this),this.parent.on("createHyperlinkElement",this.createHyperlinkElementHandler,this),this.parent.on(Sr,this.keyUpHandler,this),this.parent.on("deleteHyperlink",this.removeHyperlink,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("initiateHyperlink",this.initiateHyperlinkHandler),this.parent.off("editHyperlink",this.editHyperlinkHandler),this.parent.off("openHyperlink",this.openHyperlinkHandler),this.parent.off("click",this.hyperlinkClickHandler),this.parent.off("createHyperlinkElement",this.createHyperlinkElementHandler),this.parent.off(Sr,this.keyUpHandler),this.parent.off("deleteHyperlink",this.removeHyperlink))}},{key:"getModuleName",value:function(){return"spreadsheetHyperlink"}},{key:"keyUpHandler",value:function(e){var t=e.target;if(Object(f.D)(t,".e-document")){var i=document.querySelector(".e-hyp-text"),n=this.parent.element.querySelector(".e-hyperlink-alert-span"),r=(Object(f.D)(t,".e-hyperlink-dlg")||Object(f.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;i&&i.value&&(wa(i.value.toUpperCase())?n&&(n.remove(),r.removeAttribute("disabled")):(this.showDialog(),r.setAttribute("disabled","true")))}if(t.classList.contains("e-text")&&Object(f.D)(t,".e-cont")&&Object(f.D)(t,".e-webpage")&&Object(f.D)(t,".e-webpage").getElementsByClassName("e-cont")[1]===t.parentElement){var a=(Object(f.D)(t,".e-hyperlink-dlg")||Object(f.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?a.removeAttribute("disabled"):Object(f.D)(t,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||a.setAttribute("disabled","true")}}},{key:"initiateHyperlinkHandler",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.getActiveSheet();if(!i.isProtected||i.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n=this.parent.serviceLocator.getService(Il);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:t.getConstant("InsertLink"),beforeOpen:function(t){var i={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0),n.dialogInstance.content=e.hyperlinkContent(),n.dialogInstance.dataBind(),ao(e.parent.element)},open:function(){setTimeout(function(){ao(n.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},buttons:[{buttonModel:{content:t.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(),n.hide()}}]})}}else this.parent.notify("editAlert",null)}},{key:"dlgClickHandler",value:function(){var e,t,i=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(i)if(i.querySelector(".e-webpage"))e=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,t=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value,this.parent.insertHyperlink({address:t},this.parent.getActiveSheet().activeCell,e,!1);else{e=i.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,t=i.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var n=i.getElementsByClassName("e-cont")[2];if(n.getElementsByClassName("e-list-item")[0].querySelector(".e-active"))t=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+t.toUpperCase(),this.parent.insertHyperlink({address:t},this.parent.getActiveSheet().activeCell,e,!1);else if(n.querySelector(".e-active"))for(var r=i.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,a=0;a<this.parent.definedNames.length;a++)this.parent.definedNames[a].name===r&&this.parent.insertHyperlink({address:this.parent.definedNames[a].name},this.parent.getActiveSheet().activeCell,e,!1)}}},{key:"showDialog",value:function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)}},{key:"editHyperlinkHandler",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.serviceLocator.getService(Il);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:t.getConstant("EditLink"),beforeOpen:function(t){var n={dialogName:"EditLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.hyperEditContent(),i.dialogInstance.dataBind(),ao(e.parent.element)},open:function(){setTimeout(function(){i.dialogInstance.element.querySelector(".e-webpage")?ao(i.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):ao(i.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:t.getConstant("Update"),isPrimary:!0},click:function(){e.dlgClickHandler(),i.hide()}}]})}},{key:"openHyperlinkHandler",value:function(){var e=Zn(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)}},{key:"hlOpenHandler",value:function(e){var t=this;if(e.classList.contains("e-hyperlink")){var i,n=["",""],r=!0;e.style.color="#551A8B",Object(f.D)(e,".e-cell")&&(Object(f.D)(e,".e-cell").style.color="#551A8B");var a,s=this.parent.getActiveSheet(),o=parseInt(e.parentElement.getAttribute("aria-colindex"),10)-1,l=parseInt(e.parentElement.parentElement.getAttribute("aria-rowindex"),10)-1,h=s.rows[l].cells[o].hyperlink,c={hyperlink:h,cell:this.parent.getActiveSheet().activeCell,target:"_blank",cancel:!1};if(this.parent.trigger("beforeHyperlinkClick",c),c.cancel)return;var d={hyperlink:h=c.hyperlink,cell:this.parent.getActiveSheet().activeCell};"string"==typeof h&&(a=h),"object"==typeof h&&(a=h.address);var u=a;if(-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")){if(!Object(f.Z)(a)){if(this.parent.definedNames)for(var p=0;p<this.parent.definedNames.length;p++)if(this.parent.definedNames[p].name===a){a=(a=this.parent.definedNames[p].refersTo).slice(1);break}var g,m;-1!==a.indexOf("!")?-1!==(n=a.split("!"))[0].indexOf(" ")&&(n[0]=n[0].slice(1,n[0].length-1)):(n[0]=this.parent.getActiveSheet().name,n[1]=a);for(var v=0;v<this.parent.sheets.length;v++)this.parent.sheets[v].name===n[0]&&(g=v);if(s=this.parent.sheets[g],-1!==n[1].indexOf(":")){var y=n[1].indexOf(":"),b=n[1].substr(0,y),C=n[1].substr(y+1,n[1].length);b=b.replace("$",""),(C=C.replace("$","")).match(/\D/g)&&!C.match(/[0-9]/g)&&b.match(/\D/g)&&!b.match(/[0-9]/g)?(b+="1",C+=s.rowCount,n[1]=b+":"+C):!C.match(/\D/g)&&C.match(/[0-9]/g)&&!b.match(/\D/g)&&b.match(/[0-9]/g)&&(i=[parseInt(b,10)-1,0,parseInt(C,10)-1,s.colCount-1],r=!1)}var x=this.parent.definedNames;if(!Object(f.Z)(x))for(var S=0;S<x.length;S++)if(x[S].name===u){m=!0;break}if(wa(n[1])||m){if(i=r?Wn(n[1]):i,this.parent.scrollSettings.enableVirtualization&&(i[0]=i[0]>=this.parent.viewport.topIndex?i[0]-this.parent.viewport.topIndex:i[0],i[1]=i[1]>=this.parent.viewport.leftIndex?i[1]-this.parent.viewport.leftIndex:i[1]),!Object(f.Z)(s)){var w=Xn(i);if(s===this.parent.getActiveSheet())bs(function(){t.parent.goTo(w)});else{if(w.indexOf(":")>=0){var k=w.split(":");w=k[0]===k[1]?k[0]:w}bs(function(){t.parent.goTo(t.parent.sheets[g].name+"!"+w)})}}}else this.showInvalidHyperlinkDialog()}}else this.isValidUrl(a)?window.open(a,c.target):this.showInvalidHyperlinkDialog();this.parent.trigger("afterHyperlinkClick",d)}}},{key:"isValidUrl",value:function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}},{key:"showInvalidHyperlinkDialog",value:function(){var e=this.parent.serviceLocator.getService(Il),t=this.parent.serviceLocator.getService(kl);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)}},{key:"hyperlinkClickHandler",value:function(e){var t=e.target;if(Object(f.D)(t,".e-link-dialog")&&Object(f.D)(t,".e-toolbar-item")){var i=Object(f.D)(t,".e-hyperlink-dlg")||Object(f.D)(t,".e-edithyperlink-dlg"),n=i.getElementsByClassName("e-footer-content")[0].firstChild,r=i.querySelector(".e-document"),a=i.querySelector(".e-webpage"),s=a?a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:r.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,o=r?r.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:s;if(Object(f.D)(t,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var l=r.querySelectorAll(".e-cont")[2].querySelector(".e-active");r.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=s,Object(f.D)(l,".e-list-item").classList.contains("e-level-2")&&n.hasAttribute("disabled")?n.removeAttribute("disabled"):Object(f.D)(l,".e-list-item").classList.contains("e-level-1")&&!n.hasAttribute("disabled")&&n.setAttribute("disabled","true")}else{var h=!a.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=o,h&&!n.hasAttribute("disabled")?n.setAttribute("disabled","true"):!h&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")}}if(Object(f.D)(t,".e-list-item")&&t.classList.contains("e-fullrow")){var c=this.parent.element.getElementsByClassName("e-link-dialog")[0].getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0].getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0],d=(Object(f.D)(t,".e-hyperlink-dlg")||Object(f.D)(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;Object(f.D)(t,".e-list-item").classList.contains("e-level-2")?("defName"===Object(f.D)(t,".e-list-item").getAttribute("data-uid")?c.classList.contains("e-disabled")||c.hasAttribute("readonly")||(c.setAttribute("readonly","true"),c.classList.add("e-disabled"),c.setAttribute("disabled","true")):"sheet"===Object(f.D)(t,".e-list-item").getAttribute("data-uid")&&c.classList.contains("e-disabled")&&c.hasAttribute("readonly")&&(c.removeAttribute("readonly"),c.classList.remove("e-disabled"),c.removeAttribute("disabled")),d.hasAttribute("disabled")&&d.removeAttribute("disabled")):Object(f.D)(t,".e-list-item").classList.contains("e-level-1")&&d.setAttribute("disabled","true")}else this.hlOpenHandler(t)}},{key:"createHyperlinkElementHandler",value:function(e){var t=e.cell,i=e.td,n=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"});if(n.style.color="#00e",Object(f.Z)(t.hyperlink))i.querySelector("a")&&t.hyperlink&&"string"==typeof t.hyperlink&&i.querySelector("a").setAttribute("href",t.hyperlink);else{var r=t.hyperlink;"string"==typeof r?(-1===r.indexOf("http://")&&-1===r.indexOf("https://")&&-1===r.indexOf("ftp://")&&-1!==r.indexOf("www.")&&(r="http://"+r),0===r.indexOf("http://")||0===r.indexOf("https://")||0===r.indexOf("ftp://")?(n.setAttribute("href",r),n.setAttribute("target","_blank")):(r.includes("=")||r.includes("!"))&&n.setAttribute("ref",r),n.innerText=""!==i.innerText?i.innerText:r,i.textContent="",i.innerText="",i.appendChild(n)):"object"==typeof r&&(0===r.address.indexOf("http://")||0===r.address.indexOf("https://")||0===r.address.indexOf("ftp://")?(n.setAttribute("href",r.address),n.setAttribute("target","_blank")):(r.address.includes("=")||r.address.includes("!"))&&n.setAttribute("ref",r.address),"Accounting"===br(t.format)?n.innerHTML=i.innerHTML:n.innerText=""!==i.innerText?i.innerText:r.address,i.textContent="",i.innerText="",i.appendChild(n))}}},{key:"hyperEditContent",value:function(){var e=!0,t=this.hyperlinkContent(),i=Wn(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[i[0]].cells[i[1]];this.parent.scrollSettings.enableVirtualization&&(i[0]=i[0]-this.parent.viewport.topIndex,i[1]=i[1]-this.parent.viewport.leftIndex);var r,a=this.parent.getDisplayText(n),s=n.hyperlink;"string"==typeof s?(r=s,a=a||r,-1===r.indexOf("http://")&&-1===r.indexOf("https://")&&-1===r.indexOf("ftp://")&&(e=!1)):"object"==typeof s&&(r=s.address,a=a||r,-1===r.indexOf("http://")&&-1===r.indexOf("https://")&&-1===r.indexOf("ftp://")&&(e=!1));for(var o=0,l=0,h=this.parent.definedNames,c=this.parent.sheets,d=0,u=h.length;d<u;d++)h[d].name===r&&o++;for(var p=0,g=c.length;p<g;p++)r.includes(c[p].name)&&l++;0===o&&0===l&&(e=!0);var f=t.querySelector(".e-content");if(e){var m=f.querySelector(".e-webpage");m.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",a),"string"==typeof s?m.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",s):m.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",s.address)}else{var v,y,b=f.querySelector(".e-document");if(b.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",a),this.parent.definedNames)for(var C=0;C<this.parent.definedNames.length;C++)if(this.parent.definedNames[C].name===r){v=!0;break}if(v){var x=b.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];x.setAttribute("readonly","true"),x.classList.add("e-disabled"),x.setAttribute("disabled","true");for(var S=b.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1],w=0;w<S.getElementsByTagName("li").length;w++)S.getElementsByTagName("li")[w].innerText===r&&S.getElementsByTagName("li")[w].classList.add("e-active")}else{r&&-1!==r.indexOf("!")&&(y=r.split("!"));var k=y[0];b.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",y[1]);for(var I=b.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],O=0;O<I.getElementsByTagName("li").length;O++)if(I.getElementsByTagName("li")[O].innerText===k){if(I.getElementsByTagName("li")[O].classList.contains("e-active"))break;I.getElementsByTagName("li")[O].classList.add("e-active")}else I.getElementsByTagName("li")[O].classList.contains("e-active")&&I.getElementsByTagName("li")[O].classList.remove("e-active")}}return t}},{key:"hyperlinkContent",value:function(){var e,t,i=this.parent.serviceLocator.getService(kl),n=0,r=0,a=!0,s=!0,o=Wn(this.parent.getActiveSheet().activeCell),l=this.parent.getActiveSheet(),h=Da(o[0],o[1],l),c=!0;if(h){c=!!(h.value&&"string"==typeof h.value&&null!==h.value.match("[A-Za-z]+")||""===h.value||Object(f.Z)(h.value));var d=h.hyperlink;if("string"==typeof d){var u=d;-1===u.indexOf("http://")&&-1===u.indexOf("https://")&&-1===u.indexOf("ftp://")&&(t=d,a=!1)}else if("object"==typeof d){var p=d.address;-1===p.indexOf("http://")&&-1===p.indexOf("https://")&&-1===p.indexOf("ftp://")&&(t=d.address,a=!1)}if(t){for(var g=0,m=0,y=this.parent.definedNames,b=this.parent.sheets,C=0,x=b.length;C<x;C++)t.includes(b[C].name)&&m++;for(var S=0,w=y.length;S<w;S++)y[S].name===t&&g++;0===g&&0===m&&(a=!0)}if(r=a?0:1,this.parent.definedNames)for(var k=0;k<this.parent.definedNames.length;k++)if(this.parent.definedNames[k].name===t){e=!0,s=!1;break}}var I=this.parent.createElement("div",{className:"e-link-dialog"}),O=this.parent.createElement("div",{className:"e-webpage"}),R=this.parent.createElement("div",{className:"e-document"});new v.g({selectedItem:r,items:[{header:{text:i.getConstant("WebPage")},content:O},{header:{text:i.getConstant("ThisDocument")},content:R}]}).appendTo(I),a?I.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):I.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");var A=this.parent.createElement("div",{className:"e-cont"}),E=this.parent.createElement("div",{className:"e-cont"}),L=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("DisplayText")}),T=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("Url")}),j=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(j.classList.add("e-disabled"),j.setAttribute("readonly","true"),j.setAttribute("disabled","true")),h&&Object(f.Z)(h.hyperlink)&&j.setAttribute("value",this.parent.getDisplayText(h));var D=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});j.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),D.setAttribute("placeholder",i.getConstant("EnterTheUrl")),A.appendChild(j),A.insertBefore(L,j),E.appendChild(D),E.insertBefore(T,D),O.appendChild(E),O.insertBefore(A,E);for(var M=[],F=[],P=this.parent.sheets;n<this.parent.sheets.length;n++){var N=this.parent.sheets[n].name;"Visible"===this.parent.sheets[n].state&&(P[n]===this.parent.getActiveSheet()?M.push({nodeId:"sheet",nodeText:-1!==N.indexOf(" ")?"'"+N+"'":N,selected:!0}):M.push({nodeId:"sheet",nodeText:-1!==N.indexOf(" ")?"'"+N+"'":N}))}for(n=0;n<this.parent.definedNames.length;n++)F.push({nodeId:"defName",nodeText:this.parent.definedNames[n].name});var B=[{nodeId:"01",nodeText:i.getConstant("CellReference"),expanded:s,nodeChild:M},{nodeId:"02",nodeText:i.getConstant("DefinedNames"),expanded:e,nodeChild:F}],H=new v.i({fields:{dataSource:B,id:"nodeId",text:"nodeText",child:"nodeChild"}}),_=this.parent.createElement("div",{className:"e-cont"}),z=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("CellReference")}),V=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});V.setAttribute("value","A1"),_.appendChild(V),_.insertBefore(z,V);var U=this.parent.createElement("div",{className:"e-cont"}),q=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("DisplayText")}),W=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(W.classList.add("e-disabled"),W.setAttribute("readonly","true"),W.setAttribute("disabled","true")),h&&Object(f.Z)(h.hyperlink)&&W.setAttribute("value",this.parent.getDisplayText(h)),W.setAttribute("placeholder",i.getConstant("EnterTheTextToDisplay")),U.appendChild(W),U.insertBefore(q,W);var Z=this.parent.createElement("div",{className:"e-cont"}),G=this.parent.createElement("div",{className:"e-header",innerHTML:i.getConstant("Sheet")}),Y=this.parent.createElement("div",{className:"e-refcont"});return Z.appendChild(Y),Z.insertBefore(G,Y),R.appendChild(_),R.insertBefore(U,_),H.appendTo(Y),R.appendChild(Z),I}},{key:"removeHyperlink",value:function(e){var t=Da(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&(t.value="string"==typeof t.hyperlink?t.value?t.value:t.hyperlink:t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify("refreshRibbonIcons",null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refreshRange([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx])))}}]),e}(),wo=function(){function e(t){a(this,e),this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=t,this.addEventListener()}return o(e,[{key:"setActionData",value:function(e){var t,i,n=this.parent.getActiveSheet(),r=[],a=e.args,s=a.eventArgs,o={};switch(a.action){case"format":t=Wn(a.eventArgs.range);break;case"clipboard":o=s.copiedInfo,t=Wn(Qn(s.pastedRange)),o&&o.isCut&&(r=this.getCellDetails(o.range,Ka(this.parent,Za(this.parent,o.sId))));break;case"beforeSort":(t=Wn(a.eventArgs.range))[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[2]=n.usedRange.rowIndex,t[3]=n.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":t=Wn(s.address);break;case"beforeWrap":case"beforeReplace":t=this.parent.getAddressInfo(s.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":t=Wn(s.range)}i=this.getCellDetails(t,n),this.beforeActionData={cellDetails:i,cutCellDetails:r}}},{key:"getBeforeActionData",value:function(e){e.beforeDetails=this.beforeActionData}},{key:"performUndoRedo",value:function(e){var t=e.isUndo?this.undoCollection.pop():this.redoCollection.pop();if(this.isUndo=e.isUndo,t){switch(t.action){case"cellSave":case"format":case"sorting":case"wrap":case"cellDelete":t=this.performOperation(t);break;case"clipboard":t=this.undoForClipboard(t);break;case"resize":t=this.undoForResize(t);break;case"hideShow":t.eventArgs.hide=!t.eventArgs.hide,Ys(t,this.parent);break;case"replace":t=this.performOperation(t);break;case"insert":case"filter":case"delete":case"validation":Ys(t,this.parent,!e.isUndo);break;case"merge":t.eventArgs.merge=!t.eventArgs.merge,Ys(t,this.parent);break;case"clear":t=this.performOperation(t);break;case"conditionalFormat":Ys(t,this.parent,!e.isUndo,this.undoCollection);break;case"clearCF":case"insertImage":case"imageRefresh":Ys(t,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":Ys(t,this.parent,!e.isUndo)}e.isUndo?this.redoCollection.push(t):this.undoCollection.push(t),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons();var i=Object.assign({},t.eventArgs);i.requestType=e.isUndo?"undo":"redo",delete i.beforeActionData,e.isPublic||(this.parent.notify("triggerDataChange",Object(f.L)({isUndo:e.isUndo},t,null,!0)),this.parent.notify(Rr,{eventArgs:i,action:"undoRedo"})),this.parent.notify("refreshRibbonIcons",null)}}},{key:"updateUndoRedoCollection",value:function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var i=e.args.action;if(-1!==t.indexOf(i)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===i||"sorting"===i||"format"===i||"cellSave"===i||"wrap"===i||"replace"===i||"validation"===i||"clear"===i||"conditionalFormat"===i||"clearCF"===i||"insertImage"===i||"imageRefresh"===i||"insertChart"===i||"chartRefresh"===i||"filter"===i||"cellDelete"===i){var r={beforeDetails:{cellDetails:[]}};this.parent.notify("getBeforeActionData",r),n.beforeActionData=r.beforeDetails}if("clipboard"===i&&n.copiedInfo.isExternal){var a=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(a.indices,Ka(this.parent,a.sheetIndex))}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}}},{key:"clearUndoRedoCollection",value:function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()}},{key:"updateUndoRedoIcons",value:function(){var e=this.parent.serviceLocator.getService(kl);this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify("enableToolbarItems",[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])}},{key:"undoForClipboard",value:function(e){var t,i=this,n=e.eventArgs,r=n.pastedRange.split("!"),a=Wn(r[1]),s=Wa(this.parent,r[0]),o=Ka(this.parent,s),l=n.copiedInfo,h=n.beforeActionData,c=this.checkRefreshNeeded(s);if("imagePaste"===e.eventArgs.requestType){var d=n.copiedShapeInfo;this.isUndo?(t=d.pictureElem,d.isCut?(this.parent.notify("deleteImage",{id:t.id,sheetIdx:n.pasteSheetIndex+1}),this.parent.notify("createImageElement",{options:{src:t.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:d.height,width:d.width,imageId:t.id},range:d.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify("deleteImage",{id:n.pastedPictureElement.id,sheetIdx:n.pasteSheetIndex+1})):d.isCut?(t=d.pictureElem,this.parent.notify("deleteImage",{id:t.id,sheetIdx:d.sId}),this.parent.notify("createImageElement",{options:{src:t.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:d.height,width:d.width,imageId:t.id},range:d.pastedRange,isPublic:!1,isUndoRedo:!0})):(t=n.pastedPictureElement,this.parent.notify("createImageElement",{options:{src:t.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:t.offsetHeight,width:t.offsetWidth,imageId:t.id},range:d.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{if(this.isUndo){if(l.isCut){this.updateCellDetails(h.cutCellDetails,Ka(this.parent,Za(this.parent,l.sId)),$n(l.range),c),this.parent.notify("getFilteredCollection",null);for(var u=0;u<this.parent.sheets.length;u++){var p=Za(this.parent,l.sId);if(this.parent.filterCollection&&this.parent.filterCollection[u]&&this.parent.filterCollection[u].sheetIndex===n.pasteSheetIndex){var g=this.parent.filterCollection[u],f=Wn(g.filterRange),m=$n(a);if(f[0]>=m[0]&&f[2]<=m[2]){this.parent.notify("initiateFilterUI",{predicates:null,range:g.filterRange,sIdx:n.pasteSheetIndex,isCut:!0});var v=[Math.abs(m[0]-f[0]),Math.abs(m[1]-f[1]),Math.abs(m[2]-f[2]),Math.abs(m[3]-f[3])],y=$n(l.range);v=[y[0]+v[0],y[1]+v[1],Math.abs(y[2]-v[2]),Math.abs(y[3]-v[3])],this.parent.notify("initiateFilterUI",{predicates:null,range:Xn(v),sIdx:p,isCut:!0})}}}}h&&this.updateCellDetails(h.cellDetails,o,a,c),io(o,a[0],a[1],20);var b=no(o,a[0]);Ks(this.parent,o,b,a[0]),n.mergeCollection.forEach(function(e){e.merge=!e.merge,i.parent.notify(fr,e),e.merge=!e.merge})}else if(l.isExternal){var C=this.parent.getAddressInfo(n.pastedRange);this.updateCellDetails(l.cellDetails,Ka(this.parent,C.sheetIndex),C.indices,!0)}else Ys(e,this.parent,l.isCut);c&&this.parent.notify("selectRange",{address:r[1]})}return e}},{key:"undoForResize",value:function(e){var t=e.eventArgs;if(void 0===t.hide)if(t.isCol){var i=t.oldWidth;t.oldWidth=t.width,t.width=i}else{var n=t.oldHeight;t.oldHeight=t.height,t.height=n}else t.hide=!t.hide;Ys(e,this.parent);var r=this.parent.getActiveSheet(),a=Wn(r.activeCell),s=Da(a[0],a[1],r);if(s&&s.rowSpan){var o=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.height=o.offsetHeight+"px"}else if(s&&s.colSpan){var l=this.parent.getCell(a[0],a[1]);this.parent.element.querySelector(".e-active-cell").style.width=l.offsetWidth+"px"}return e}},{key:"performOperation",value:function(e){var t=e.eventArgs,i="cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action?t.address.split("!"):t.range.split("!"),n=Wn(i[1]),r=n,a=Wa(this.parent,i[0]),s=Ka(this.parent,a),o=t.beforeActionData,l=this.checkRefreshNeeded(a),h={cellIdx:[n[0],n[1]],isUnique:!1,uniqueRange:""};if(this.parent.notify("checkUniqueRange",h),this.isUndo){if(h.isUnique&&t.formula&&t.formula.indexOf("UNIQUE")>-1){var c=Wn(h.uniqueRange);if("#SPILL!"!==Da(c[0],c[1],this.parent.getActiveSheet()).value)for(var d=c[0];d<=c[2];d++)for(var u=c[1];u<=c[3];u++)d===c[0]&&u===c[1]&&(u+=1),this.parent.updateCell({value:""},Xn([d,u]))}if(this.updateCellDetails(o.cellDetails,s,n,l,e),h.isUnique&&"cellDelete"===e.action&&t.isSpill){for(var p=Wn(h.uniqueRange),g=Da(p[0],p[1],this.parent.getActiveSheet()),m=p[0];m<=p[2];m++)for(var v=p[1];v<=p[3];v++)for(var y=n[0];y<=n[2];y++)for(var b=n[1];b<=n[3];b++)m===y&&v===b||this.parent.updateCell({value:""},Yn(m,v));g.value="#SPILL!",this.parent.updateCell(g,Yn(p[0],p[1]))}if(!t.isSpill&&""!==h.uniqueRange){for(var C=Wn(h.uniqueRange),x=C[0];x<=C[2];x++)for(var S=C[1];S<=C[3];S++)x===C[0]&&S===C[1]&&(S+=1),this.parent.updateCell({value:""},Xn([x,S]));this.parent.notify("reApplyFormula",null)}}else{var w=e.eventArgs,k=Wn(s.activeCell),I=this.parent.getCellStyleValue(["textDecoration"],k).textDecoration;if(w&&w.style&&w.style.textDecoration){var O,R=w.style.textDecoration,A=R,E=!1;"underline"===I?A="underline"===R?"none":"underline line-through":"line-through"===I?A="line-through"===R?"none":"underline line-through":"underline line-through"===I&&(A="underline"===R?"line-through":"underline",E=!0),"none"===A&&(E=!0),w.style.textDecoration=A,e.eventArgs=w,this.parent.notify(dr,{style:{textDecoration:A},range:k,refreshRibbon:!0,onActionUpdate:!0});for(var L=r[0];L<=r[2];L++)for(var T=r[1];T<=r[3];T++)if(L!==k[0]||T!==k[1]){if(O={},"none"===(I=this.parent.getCellStyleValue(["textDecoration"],[L,T]).textDecoration)){if(E)continue;O.textDecoration=R}else if("underline"===I||"line-through"===I)if(E){if(R!==I)continue;O.textDecoration="none"}else O.textDecoration=R!==I?"underline line-through":R;else if("underline line-through"===I){if(!E)continue;O.textDecoration="underline"===R?"line-through":"underline"}this.parent.notify(dr,{style:{textDecoration:O.textDecoration},range:[L,T,L,T],refreshRibbon:!0,onActionUpdate:!0})}w.style.textDecoration=R,e.eventArgs=w}else{if(!Object(f.Z)(t.oldValue)&&t.oldValue!==t.value&&h.isUnique){var j=Wn(h.uniqueRange);if("#SPILL!"!==Da(j[0],j[1],this.parent.getActiveSheet()).value)for(var D=j[0];D<=j[2];D++)for(var M=j[1];M<=j[3];M++)D===j[0]&&M===j[1]&&(this.parent.updateCell({value:"#SPILL!"},Xn([j[0],j[1]])),M+=1),this.parent.updateCell({value:""},Xn([D,M]))}if(Ys(e,this.parent,!0),h.isUnique&&"cellDelete"===e.action&&t.isSpill){for(var F=Wn(h.uniqueRange),P=!1,N=F[0];N<=F[1];N++)for(var B=F[1];B<=F[3];B++)N===F[0]&&B===F[1]&&B++,Da(N,B,s)&&!Object(f.Z)(Da(N,B,s).value)&&""!==Da(N,B,s).value&&(P=!0);if(!P){var H=Da(F[0],F[1],this.parent.getActiveSheet());H.value="",this.parent.updateCell(H,Yn(F[0],F[1])),this.parent.notify("reApplyFormula",null)}}}}return l&&this.parent.notify("selectRange",{address:i[1]}),e}},{key:"getCellDetails",value:function(e,t){for(var i,n=[],r=(e=$n(e))[0];r<=e[2];r++)for(var a=e[1];a<=e[3];a++)i=Da(r,a,t),n.push({rowIndex:r,colIndex:a,format:i?i.format:null,isLocked:i?i.isLocked:null,style:i&&i.style?Object.assign({},i.style):null,value:i?i.value:"",formula:i?i.formula:"",wrap:i&&i.wrap,rowSpan:i&&i.rowSpan,colSpan:i&&i.colSpan,hyperlink:i&&i.hyperlink,image:i&&i.image&&i.chart});return n}},{key:"updateCellDetails",value:function(e,t,i,n,r){for(var a,s=e.length,o=0;o<s;o++)Ma(e[o].rowIndex,e[o].colIndex,t,{value:e[o].value,format:e[o].format,isLocked:e[o].isLocked,style:e[o].style&&Object.assign({},e[o].style),formula:e[o].formula,wrap:e[o].wrap,rowSpan:e[o].rowSpan,colSpan:e[o].colSpan,hyperlink:e[o].hyperlink}),this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:[e[o].rowIndex,e[o].colIndex,e[o].rowIndex,e[o].colIndex],value:e[o].formula?e[o].formula:e[o].value}),r&&"wrap"===r.action&&r.eventArgs.wrap&&this.parent.notify("wrapText",{range:[e[o].rowIndex,e[o].colIndex,e[o].rowIndex,e[o].colIndex],wrap:!1,sheet:t}),r&&e[o].hyperlink&&"clear"===r.action&&(r.eventArgs.range=t.name+"!"+Xn([e[o].rowIndex,e[o].colIndex,e[o].rowIndex,e[o].colIndex]),a=this.parent.getCell(e[o].rowIndex,e[o].colIndex),"Clear All"===r.eventArgs.type||"Clear Hyperlinks"===r.eventArgs.type?this.parent.addHyperlink(e[o].hyperlink,r.eventArgs.range):"Clear Formats"===r.eventArgs.type&&Object(f.w)(a.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"));n&&this.parent.serviceLocator.getService("cell").refreshRange(i)}},{key:"checkRefreshNeeded",value:function(e){var t=!0;return e!==this.parent.activeSheetIndex&&(this.parent.activeSheetIndex=e,this.parent.dataBind(),t=!1),t}},{key:"addEventListener",value:function(){this.parent.on("performUndoRedo",this.performUndoRedo,this),this.parent.on("updateUndoRedoCollection",this.updateUndoRedoCollection,this),this.parent.on("setActionData",this.setActionData,this),this.parent.on("getBeforeActionData",this.getBeforeActionData,this),this.parent.on("clearUndoRedoCollection",this.clearUndoRedoCollection,this),this.parent.on("setUndoRedo",this.updateUndoRedoIcons,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("performUndoRedo",this.performUndoRedo),this.parent.off("updateUndoRedoCollection",this.updateUndoRedoCollection),this.parent.off("setActionData",this.setActionData),this.parent.off("getBeforeActionData",this.getBeforeActionData),this.parent.off("clearUndoRedoCollection",this.clearUndoRedoCollection),this.parent.off("setUndoRedo",this.updateUndoRedoIcons))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"undoredo"}}]),e}(),ko=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("ribboClick",this.ribbonClickHandler,this),this.parent.on("wrapText",this.wrapTextHandler,this),this.parent.on("rowHeightChanged",this.rowHeightChangedHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("ribboClick",this.ribbonClickHandler),this.parent.off("wrapText",this.wrapTextHandler),this.parent.off("rowHeightChanged",this.rowHeightChangedHandler))}},{key:"wrapTextHandler",value:function(e){if(Rs(this.parent,e.range,!0))for(var t,i,n,r,a,s,o=e.range[0];o<=e.range[2];o++){a=0,r=ls(e.sheet,o).customHeight||e.isCustomHgt;for(var l=e.range[1];l<=e.range[3];l++)if(!((i=Da(o,l,e.sheet,null,!0)).rowSpan<0||i.colSpan<0)){var h=i.rowSpan>1||i.colSpan>1;if((t=e.initial?e.td:this.parent.getCell(o,l))&&(e.wrap?t.classList.add(wl):t.classList.remove(wl),(r||h)&&(0===t.children.length||!t.querySelector(".e-wrap-content")))){var c=t.style.cssText;c&&(c=c.split(";").filter(function(e){return!e.includes("border")}).join(";")),t.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:t.innerHTML,styles:c}).outerHTML}if(f.d.isIE&&t.classList.add("e-ie-wrap"),!r&&!h){n=eo(e.sheet,o,l,i.colSpan>1?l+i.colSpan-1:l);var d=this.parent.getDisplayText(i).toString();if(d.indexOf("\n")<0){var u=this.parent.element.querySelector(".e-spreadsheet-edit");u&&u.textContent.indexOf("\n")>-1&&(d=u.textContent)}if(d)if(e.wrap){var p=void 0;t&&t.classList.contains("e-alt-unwrap")&&t.classList.remove("e-alt-unwrap");var g=void 0,m=0;if(d.indexOf("\n")>-1){var v=d.split("\n"),y=v.length;for(g=0;g<y;g++)0===(p=$s(v[g],n,i.style,this.parent.cellStyle))&&(p=1),m+=p;p=m}else p=$s(d,n,i.style,this.parent.cellStyle);if(s=to(this.parent,o,l,e.sheet,i.style||this.parent.cellStyle,p),a=Math.max(a,s),i.rowSpan>1){var b=ps(e.sheet,o,o+(i.rowSpan-1));if(b>=a)return;s=a=ds(e.sheet,o)+(a-b)}io(e.sheet,o,l,s)}else d.indexOf("\n")>-1&&t.classList.add("e-alt-unwrap"),s=to(this.parent,o,l,e.sheet,i.style||this.parent.cellStyle,1),io(e.sheet,o,l,s),a=Math.max(no(e.sheet,o),20);else e.wrap&&d||(io(e.sheet,o,l,20),a=Math.max(no(e.sheet,o),20));l===e.range[3]&&(e.wrap&&a>20&&no(e.sheet,o)<=a||(!e.wrap||!d)&&no(e.sheet,o)<ds(e.sheet,o)&&ds(e.sheet,o)>20)&&Ks(this.parent,e.sheet,a,o,e.row,e.hRow)}}}}},{key:"ribbonClickHandler",value:function(e){var t,i=Object(f.D)(e.originalEvent.target,".e-btn");if(i&&i.id===this.parent.element.id+"_wrap"){var n=i.classList.contains("e-active"),r=(t=this.parent.getActiveSheet()).name+"!"+t.selectedRange,a={address:r,wrap:n,cancel:!1};this.parent.notify(Ar,{action:"beforeWrap",eventArgs:a}),a.cancel||(Pa(this.parent.getActiveSheet().selectedRange,n,this.parent),this.parent.notify(Rr,{action:"wrap",eventArgs:{address:r,wrap:n}}))}}},{key:"rowHeightChangedHandler",value:function(e){if(e.isCustomHgt)for(var t=this.parent.getActiveSheet(),i=this.parent.viewport.leftIndex,n=i+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),r=i;r<n;r++){var a=Da(e.rowIdx,r,t);if(a&&a.wrap){var s=this.parent.getCell(e.rowIdx,r),o=s.style.cssText;0!==s.children.length&&s.querySelector(".e-wrap-content")||(s.innerHTML=this.parent.createElement("span",{className:"e-wrap-content",innerHTML:s.innerHTML,styles:o}).outerHTML)}}}},{key:"getModuleName",value:function(){return"wrapText"}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}}]),e}(),Io=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"insert",value:function(e){var t;switch(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(Ar,{eventArgs:e,action:"insert"}),this.parent.notify("beforeInsert",e),e.modelType){case"Sheet":this.parent.notify("insertSheetTab",{startIdx:e.index,endIdx:e.index+(e.model.length-1),preventUpdate:!t}),this.parent.renderModule.refreshSheet(),ao(this.parent.element);break;case"Row":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.bottomIndex){if(this.parent.scrollSettings.enableVirtualization){if(e.freezePane){this.parent.renderModule.refreshSheet();break}e.index<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===ro(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:e.index,colIndex:0,refresh:"Row"});this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}break;case"Column":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.rightIndex){if(e.freezePane){this.parent.renderModule.refreshSheet();break}this.parent.scrollSettings.enableVirtualization?(e.index<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex+=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===ro(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:e.index,refresh:"Column"}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}}this.refreshImgElement(e.model.length,this.parent.activeSheetIndex,e.modelType,e.index),t&&this.parent.notify(Rr,{eventArgs:e,action:"insert"})}},{key:"refreshImgElement",value:function(e,t,i,n){for(var r,a=this.parent.sheets[t],s=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],o=0;o<=s[2];o++)for(var l=s[1];l<=s[3];l++)(r=Da(o,l,a))&&r.image&&r.image.length>0&&("Row"===i&&o>=n||"Column"===i&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:i,count:e,status:"insert"})}},{key:"addEventListener",value:function(){this.parent.on("insert",this.insert,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("insert",this.insert)}},{key:"getModuleName",value:function(){return"insert"}}]),e}(),Oo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"delete",value:function(e){var t;if(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(Ar,{eventArgs:e,action:"delete"}),"Sheet"===e.modelType){var i=e.activeSheetIndex>=e.startIndex&&e.activeSheetIndex<=e.endIndex;i&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(e.startIndex<this.parent.sheets.length?e.startIndex:e.startIndex?e.startIndex-1:0)},!0),this.parent.notify("refreshSheetTabs",null),i&&this.parent.renderModule.refreshSheet(),ao(this.parent.element)}else"Row"===e.modelType?(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.bottomIndex)&&(e.freezePane?this.parent.renderModule.refreshSheet():this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===ro(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:this.parent.viewport.leftIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:e.startIndex,colIndex:0}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange))):(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.rightIndex)&&(e.freezePane?this.parent.renderModule.refreshSheet():this.parent.scrollSettings.enableVirtualization?(e.startIndex<this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex-=e.model.length),this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===ro(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,refresh:"Column",colIndex:this.parent.viewport.leftIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:e.startIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)));this.refreshImgElement(e.deletedModel.length,this.parent.activeSheetIndex,e.modelType,e.startIndex),t&&this.parent.notify(Rr,{eventArgs:e,action:"delete"})}},{key:"refreshImgElement",value:function(e,t,i,n){for(var r,a=this.parent.sheets[t],s=[0,0,a.usedRange.rowIndex,a.usedRange.colIndex],o=0;o<=s[2];o++)for(var l=s[1];l<=s[3];l++)(r=Da(o,l,a))&&r.image&&r.image.length>0&&("Row"===i&&o>=n||"Column"===i&&l>=n)&&this.parent.notify("refreshImagePosition",{rowIdx:o,colIdx:l,sheetIdx:t,type:i,count:e,status:"delete"})}},{key:"addEventListener",value:function(){this.parent.on("delete",this.delete,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("delete",this.delete)}},{key:"getModuleName",value:function(){return"delete"}}]),e}(),Ro=function(){function e(t){a(this,e),this.data=[],this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener();var e=Object(f.ob)("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null}},{key:"addEventListener",value:function(){f.l.add(this.parent.element,"dblclick",this.listOpen,this),f.l.add(document,"mousedown",this.mouseDownHandler,this),this.parent.on("initiatedatavalidation",this.initiateDataValidationHandler,this),this.parent.on("invalidData",this.invalidDataHandler,this),this.parent.on("isValidation",this.checkDataValidation,this),this.parent.on("activeCellChanged",this.listHandler,this),this.parent.on(Sr,this.keyUpHandler,this),this.parent.on("removeDataValidation",this.removeValidationHandler,this),this.parent.on("validationHighlight",this.InvalidElementHandler,this)}},{key:"removeEventListener",value:function(){f.l.remove(this.parent.element,"dblclick",this.listOpen),f.l.remove(document,"mousedown",this.mouseDownHandler),this.parent.isDestroyed||(this.parent.off("initiatedatavalidation",this.initiateDataValidationHandler),this.parent.off("invalidData",this.invalidDataHandler),this.parent.off("isValidation",this.checkDataValidation),this.parent.off("activeCellChanged",this.listHandler),this.parent.off(Sr,this.keyUpHandler),this.parent.off("removeDataValidation",this.removeValidationHandler),this.parent.off("validationHighlight",this.InvalidElementHandler))}},{key:"removeValidationHandler",value:function(e){var t=this.getRange(this.parent.getActiveSheet().selectedRange);this.parent.removeDataValidation(t)}},{key:"mouseDownHandler",value:function(e){var t=e.target,i=Object(f.D)(t,".e-ddl");i&&i.getAttribute("id")===this.parent.element.id+"listValid_popup"&&this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:t.innerText})}},{key:"keyUpHandler",value:function(e){var t=e.target,i=this.parent.element.querySelector(".e-datavalidation-dlg");if(Object(f.D)(t,".e-values")&&i&&13!==e.keyCode){var n=i.querySelector(".e-values"),r=n.querySelector(".e-dlg-error"),a=i.querySelector(".e-footer-content").querySelector(".e-primary");a.hasAttribute("disabled")&&a.removeAttribute("disabled"),r&&n.removeChild(r)}}},{key:"listOpen",value:function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.listObj.showPopup()}},{key:"invalidDataHandler",value:function(e){e.isRemoveHighlight?this.parent.removeInvalidHighlight():this.parent.addInvalidHighlight()}},{key:"listHandler",value:function(){var e=this;if(this.parent.allowDataValidation){var t,i=this.parent.getActiveSheet(),n=Zn(i.activeCell),r=Da(n[0],n[1],i),a=gs(i,n[1]),s=this.parent.getCell(n[0],n[1]);if(!s)return;if(document.getElementsByClassName("e-validation-list")[0]&&(Object(f.kb)(document.getElementsByClassName("e-validation-list")[0]),this.data=[]),r&&r.validation?t=r.validation:a&&a.validation&&(t=a.validation),t&&"List"===t.type&&(t.ignoreBlank=!!Object(f.Z)(t.ignoreBlank)||t.ignoreBlank,t.inCellDropDown=!!Object(f.Z)(t.inCellDropDown)||t.inCellDropDown,t.inCellDropDown)){var o=this.parent.createElement("div",{className:"e-validation-list"}),l=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});o.appendChild(l),t.inCellDropDown||(o.style.display="none"),s.insertBefore(o,s.firstChild);var h=this.updateDataSource(r,t);this.listObj=new C.d({index:this.setDropDownListIndex(h,r,t),dataSource:h,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:function(){return e.listValueChange(e.listObj.text)},open:function(t){if(t.popup.offsetX=4-(s.offsetWidth-20),t.popup.offsetY=-13,t.popup.element.style.width=s.offsetWidth-1+"px",f.d.isDevice&&e.parent.scrollModule){var n=e.parent.scrollModule.offset,r=e.parent.viewport;t.popup.offsetY+=r.topIndex?n.top.size-ps(i,r.topIndex+1,n.top.idx,!0):0,t.popup.offsetX+=r.leftIndex?n.left.size-vs(i,r.leftIndex+1,n.left.idx,!0):0,t.popup.refresh()}}}),this.listObj.appendTo("#"+this.parent.element.id+"listValid")}r&&r.validation&&(r.validation=t)}}},{key:"setDropDownListIndex",value:function(e,t,i){if(t&&t.value)for(var n=0,r=e.length;n<r;n++)if(e[n].text===t.value.toString())return n;return null}},{key:"updateDataSource",value:function(e,t){var i=this;this.data=[];var n=0,r=t.value1;if(-1!==r.indexOf("=")){var a,s=r.indexOf("!")>-1?Ka(this.parent,Wa(this.parent,r.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),o=r.indexOf("!")>-1?r.split("!")[1]:r.split("=")[1],l=this.parent.getActiveSheet();if(s.name!==l.name){var h,c=Wn(l.selectedRange);s.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(h=!0)}),h&&(this.parent.showSpinner(),Na(this.parent,"".concat(s.name,"!").concat(o)).then(function(){if(i.parent.hideSpinner(),l.name===i.parent.getActiveSheet().name){var n=Wn(i.parent.getActiveSheet().selectedRange);n[0]===c[0]&&n[1]===c[1]&&(i.listObj.dataSource=i.updateDataSource(e,t),i.listObj.dataBind())}}))}var d=o.split(":");if(d[0].match(/[a-z]+$/gi)&&d[1].match(/[a-z]+$/gi)||d[0].match(/^[0-9]/g)&&d[1].match(/^[0-9]/g)){var u=this.parent.getIndexes(o);a=u.isCol?[0,u.startIdx,s.usedRange.rowIndex,u.startIdx]:[u.startIdx,0,u.startIdx,s.usedRange.colIndex]}else a=Wn(o);for(var p=a[0];p<=a[2];p++){s.rows[p]||hs(s,p,{});for(var g=a[1];g<=a[3];g++){s.rows[p].cells||Ma(p,g,s,{}),n+=1;var f=this.parent.getDisplayText(e=s.rows[p].cells[g])||"";t.ignoreBlank&&""===f||this.data.push({text:f,id:"list-"+n})}}}else for(var m=r.split(","),v=0;v<m.length;v++)n+=1,this.data.push({text:m[v],id:"list-"+n});return this.data}},{key:"listValueChange",value:function(e){var t=this.parent.getActiveSheet(),i=Jn(t.activeCell),n=Object.assign({},Da(i[0],i[1],t));t.isProtected&&Ra(n,gs(t,i[1]))?this.parent.notify("editAlert",null):(this.parent.notify("workbookEditOperation",{action:"updateCellValue",address:t.activeCell,value:e}),this.parent.serviceLocator.getService("cell").refreshRange(i),this.parent.trigger("cellSave",{value:e,oldValue:n&&n.value,address:t.name+"!"+t.activeCell,displayText:this.parent.getDisplayText(Da(i[0],i[1],t))}))}},{key:"getRange",value:function(e){var t=this.parent.getActiveSheet(),i=Wn(e),n=t.colCount;return i[2]===t.rowCount-1&&0===i[0]?e=e.replace(/[0-9]/g,""):i[3]===n-1&&0===i[2]&&(e=e.replace(/\D/g,"")),e}},{key:"initiateDataValidationHandler",value:function(){var e,t,i,n,r,a=this,s=this.parent.serviceLocator.getService(kl),o=!0,l=!0,h=!0,c=this.parent.getActiveSheet(),d=c.selectedRange,u=Wn(d);d=this.getRange(d);for(var p=u[0];p<=u[2];p++)if(c.rows[p])for(var g=u[1];g<=u[3];g++)c.rows[p].cells&&c.rows[p].cells[g]&&((r=c.rows[p].cells[g]).validation&&(h=!1,e=r.validation.type,t=r.validation.operator,i=r.validation.value1,n=r.validation.value2,o=Object(f.Z)(r.validation.ignoreBlank)?o:r.validation.ignoreBlank,l=Object(f.Z)(r.validation.inCellDropDown)?l:r.validation.inCellDropDown));if(!this.parent.element.querySelector(".e-datavalidation-dlg")){var m=this.parent.serviceLocator.getService(Il);m.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:s.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(r){var s={dialogName:"ValidationDialog",element:r.element,target:r.target,cancel:r.cancel};a.parent.trigger("dialogBeforeOpen",s),s.cancel&&(r.cancel=!0),m.dialogInstance.content=a.dataValidationContent(h,e,t,i,n,o,l,d),m.dialogInstance.dataBind(),ao(a.parent.element)},buttons:[{buttonModel:{content:s.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){m.dialogInstance.content=a.dataValidationContent(!0,e,t,i,n,o,l,d),m.dialogInstance.dataBind(),ao(a.parent.element)}},{buttonModel:{content:s.getConstant("APPLY"),isPrimary:!0},click:function(){a.dlgClickHandler(m)}}]}),m.dialogInstance.refresh()}}},{key:"dataValidationContent",value:function(e,t,i,n,r,a,s,o){var l=this,h=this.parent.serviceLocator.getService(kl),c=e?"0":n,d=e?"0":r,u=this.parent.createElement("div",{className:"e-validation-dlg"}),p=this.parent.createElement("div",{className:"e-cellrange"}),g=this.parent.createElement("div",{className:"e-allowdata"}),f=this.parent.createElement("div",{className:"e-values"}),m=this.parent.createElement("div",{className:"e-ignoreblank"});u.appendChild(p),u.appendChild(g),u.appendChild(f),u.appendChild(m);var v=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("CellRange")}),x=this.parent.createElement("input",{className:"e-input",attrs:{value:o}});p.appendChild(v),p.appendChild(x);var S=this.parent.createElement("div",{className:"e-allow"}),w=this.parent.createElement("div",{className:"e-data"});g.appendChild(S),g.appendChild(w);var k=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Allow")});this.typeData=[{text:h.getConstant("WholeNumber"),id:"type-1"},{text:h.getConstant("Decimal"),id:"type-2"},{text:h.getConstant("Date"),id:"type-3"},{text:h.getConstant("Time"),id:"type-4"},{text:h.getConstant("TextLength"),id:"type-5"},{text:h.getConstant("List"),id:"type-6"}],this.operatorData=[{text:h.getConstant("Between"),id:"operator-1"},{text:h.getConstant("NotBetween"),id:"operator-2"},{text:h.getConstant("EqualTo"),id:"operator-3"},{text:h.getConstant("NotEqualTo"),id:"operator-4"},{text:h.getConstant("Greaterthan"),id:"operator-5"},{text:h.getConstant("Lessthan"),id:"operator-6"},{text:h.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:h.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var I=this.parent.createElement("input",{className:"e-select"}),O=0;if(!e)for(var R=0;R<this.typeData.length;R++)if(t===this.typeData[R].text.replace(" ","")){O=R;break}if(e||"List"!==t){var A=0,E=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Data")}),L=this.parent.createElement("input",{className:"e-select"});if(!e)for(var T=0;T<this.operatorData.length;T++)if(i===this.FormattedValue(this.operatorData[T].text)){A=T;break}w.appendChild(E),w.appendChild(L),this.dataList=new C.d({dataSource:this.operatorData,index:A,popupHeight:"200px",change:function(){l.userInput(D,l.dataList)}}),this.dataList.appendTo(L)}else{var j=this.parent.createElement("input",{className:"e-checkbox"});w.appendChild(j),new b.b({label:h.getConstant("InCellDropDown"),checked:s}).appendTo(j)}S.appendChild(k),S.appendChild(I);var D=new C.d({dataSource:this.typeData,index:O,popupHeight:"200px",change:function(){l.userInput(D,l.dataList)}});if(D.appendTo(I),e||"List"!==D.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){var M=this.parent.createElement("div",{className:"e-minimum"}),F=this.parent.createElement("div",{className:"e-maximum"});f.appendChild(M),f.appendChild(F);var P=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Minimum")}),N=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Maximum")}),B=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:c}}),H=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:d}});M.appendChild(P),M.appendChild(B),F.appendChild(N),F.appendChild(H),new y.e({value:0}).appendTo("#minvalue"),new y.e({value:0}).appendTo("#maxvalue")}else if(e&&" List"!==t){var _=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Value")}),z=this.parent.createElement("input",{className:"e-input",attrs:{value:c}});f.appendChild(_),f.appendChild(z)}else{var V=this.parent.createElement("span",{className:"e-header",innerHTML:h.getConstant("Sources")}),U=this.parent.createElement("input",{className:"e-input",attrs:{value:c}});f.appendChild(V),f.appendChild(U)}var q=a,W=this.parent.createElement("input",{className:"e-checkbox"});return m.appendChild(W),new b.b({label:h.getConstant("IgnoreBlank"),checked:q}).appendTo(W),u}},{key:"userInput",value:function(e,t){for(var i=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=i.querySelector(".e-allowdata"),r=i.querySelector(".e-values"),a=this.parent.serviceLocator.getService(kl),s=n.querySelector(".e-data");r.lastChild;)r.removeChild(r.lastChild);if("List"===e.value){for(;s.lastChild;)s.removeChild(s.lastChild);var o=this.parent.createElement("input",{className:"e-checkbox"});s.appendChild(o),new b.b({label:a.getConstant("InCellDropDown"),checked:!0}).appendTo(o)}else if(s.getElementsByClassName("e-checkbox-wrapper")[0]){for(;s.lastChild;)s.removeChild(s.lastChild);var l=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),h=this.parent.createElement("input",{className:"e-select"});s.appendChild(l),s.appendChild(h),t.appendTo(h)}if("List"===e.value||"Between"!==t.value&&"Not between"!==t.value){var c=a.getConstant("List"===e.value?"Sources":"Value"),d=this.parent.createElement("span",{className:"e-header",innerHTML:c}),u=this.parent.createElement("input","List"===e.value?{className:"e-input",attrs:{placeholder:"Enter value"}}:{className:"e-input",attrs:{value:"0"}});r.appendChild(d),r.appendChild(u)}else{var p=this.parent.createElement("div",{className:"e-minimum"}),g=this.parent.createElement("div",{className:"e-maximum"});r.appendChild(p),r.appendChild(g);var f=this.parent.createElement("span",{className:"e-header",innerHTML:a.getConstant("Minimum")}),m=this.parent.createElement("span",{className:"e-header",innerHTML:a.getConstant("Maximum")}),v=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),C=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new y.e({value:0}).appendTo("min"),new y.e({value:0}).appendTo("max"),p.appendChild(f),p.appendChild(v),g.appendChild(m),g.appendChild(C)}}},{key:"dlgClickHandler",value:function(e){var t,i,n=this.parent.serviceLocator.getService(kl),r=!0,a=this.parent.element.querySelector(".e-datavalidation-dlg"),s=a.querySelector(".e-footer-content"),o=a.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],l=o.getElementsByClassName("e-allowdata")[0],h=l.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],c=l.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],d=o.getElementsByClassName("e-values")[0],u=d.getElementsByTagName("input")[0].value,p=d.getElementsByTagName("input")[1]?d.getElementsByTagName("input")[1].value:"",g="true"===o.querySelector(".e-ignoreblank").querySelector(".e-checkbox-wrapper").getAttribute("aria-checked"),f=l.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!l.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,m=o.querySelector(".e-cellrange").getElementsByTagName("input")[0].value,v=h.value;c&&(i=c.value,i=this.FormattedValue(i)),v&&(v=v.replace(" ",""));var y=[],b=[];if(""!==u&&b.push(u),""!==p&&b.push(p),"List"===v)if(-1!==u.indexOf("=")){if(-1!==u.indexOf(":")){var C=u.indexOf("!")>-1?u.split("!")[1]:u.split("=")[1],x=!(u.indexOf("!")>-1)||Wa(this.parent,u.split("=")[1].split("!")[0])>-1;y=C.split(":");var S=!!C.match(/[a-z]/gi)&&y[0].replace(/[0-9]/g,"")===y[1].replace(/[0-9]/g,""),w=!!C.match(/\d/g)&&y[0].replace(/\D/g,"")===y[1].replace(/\D/g,"");(r=!(!x||!S&&!w))||(t=n.getConstant("DialogError"))}}else u.length>256&&(r=!1,t=n.getConstant("ListLengthError"));if("List"!==v||r){var k=this.parent.getActiveSheet(),I=this.isDialogValidator(b,v,i);if(t=I.errorMsg,r=I.isValidate){var O=Zn(this.parent.getActiveSheet().activeCell);if(k&&k.rows[O[0]]&&k.rows[O[0]].cells[O[1]]&&k.rows[O[0]].cells[O[1]].validation&&"List"===k.rows[O[0]].cells[O[1]].validation.type){var R=this.parent.getMainContent().getElementsByTagName("tr")[O[0]].getElementsByClassName("e-cell")[O[1]];R&&R.getElementsByClassName("e-validation-list")[0]&&(R.removeChild(R.getElementsByClassName("e-validation-list")[0]),this.listObj.destroy())}this.parent.addDataValidation({type:v,operator:i,value1:u,value2:p,ignoreBlank:g,inCellDropDown:f},m),"List"===v&&r&&this.listHandler(),document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide())}}if(!r){var A=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:t});d.appendChild(A),s.querySelector(".e-primary").setAttribute("disabled","true")}}},{key:"FormattedValue",value:function(e){switch(e){case"Between":e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo";break;default:e="Between"}return e}},{key:"isDialogValidator",value:function(e,t,i){var n,r=this.parent.serviceLocator.getService(kl),a=0;if("List"===t?!(e.length>0):"Between"===i||"NotBetween"===i?2!==e.length:!(e.length>0))n={isValidate:!1,errorMsg:r.getConstant("EmptyError")};else{for(var s=0;s<e.length&&(n=this.formatValidation(e[s],t)).isValidate;s++)a+=1;n.isValidate=a===e.length}return{isValidate:n.isValidate,errorMsg:n.errorMsg}}},{key:"isValidationHandler",value:function(e){var t,i,n=this.parent.serviceLocator.getService(kl);e.value=e.value?e.value:"";var r,a=e.value,s=this.parent.sheets[e.sheetIdx],o=Da(e.range[0],e.range[1],s),l=gs(s,e.range[1]);if(o&&o.validation?r=o.validation:l&&l.validation&&(r=l.validation),r){var h=e.value,c=r.value1,d=r.value2,u=r.operator||"Between",p=r.type||"WholeNumber",g=!!Object(f.Z)(r.ignoreBlank)||r.ignoreBlank,m=this.formatValidation(e.value,p);if(t=m.isValidate,i=m.errorMsg,t){if(t=!1,"Date"===p||"Time"===p){e.value=e.value.slice(e.value.indexOf(" ")+1,e.value.length);for(var v=0;v<=3;v++){e.value=0===v?e.value:1===v?r.value1:r.value2;var y={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify("checkDateFormat",y);var b=y.updatedVal;0==v&&""==b?h=e.value:0==v?h=b:1==v?c=b:d=b}}else"TextLength"===r.type&&(h=e.value.toString().length.toString());if("List"===p)if(-1!==c.indexOf("="))for(var C=0;C<this.data.length;C++)e.value.toString()===this.data[C].text&&(t=!0);else for(var x=c.split(","),S=0;S<x.length;S++)e.value.toString()===x[S]&&(t=!0);else switch("Decimal"===p||"Time"===p?(h=parseFloat(h.toString()),c=parseFloat(c.toString()),d=d?parseFloat(d.toString()):null):(h=parseInt(h.toString(),10),c=parseInt(c.toString(),10),d=d?parseInt(d.toString(),10):null),u){case"EqualTo":t=h===c||!(!g||""!==a);break;case"NotEqualTo":t=h!==c||!(!g||""!==a);break;case"Between":t=h>=c&&h<=d||!(!g||""!==a);break;case"NotBetween":t=!(h>=c&&h<=d);break;case"GreaterThan":t=h>c||!(!g||""!==a);break;case"LessThan":t=h<c||!(!g||""!==a);break;case"GreaterThanOrEqualTo":t=h>=c||!(!g||""!==a);break;case"LessThanOrEqualTo":t=h<=c||!(!g||""!==a)}}}if(i=n.getConstant("ValidationError"),t){var w=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);this.parent.notify(ur,{style:w,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})}return{isValidate:t,errorMsg:i}}},{key:"checkDataValidation",value:function(e){var t=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx});!t.isValidate&&e.isCell&&this.validationErrorHandler(t.errorMsg),this.parent.allowDataValidation=t.isValidate}},{key:"formatValidation",value:function(e,t){var i,n,r=this.parent.element.getElementsByClassName("e-sheet-panel")[0],a=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),s=this.parent.createElement("input",{id:"e-validation",innerHTML:e});switch(s.setAttribute("name","validation"),s.setAttribute("type","text"),s.setAttribute("value",e),a.appendChild(s),r.appendChild(a),t){case"Date":n={rules:{validation:{date:!0}},customPlacement:function(e,t){i=t.innerText}};break;case"Decimal":n={rules:{validation:{number:!0}},customPlacement:function(e,t){i=t.innerText}};break;case"WholeNumber":n={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){i=t.innerText}}}var o=new y.b("#formId",n).validate();return r.removeChild(r.getElementsByClassName("form-horizontal")[0]),{isValidate:o,errorMsg:i}}},{key:"InvalidElementHandler",value:function(e){var t=e.rowIdx,i=e.colIdx,n=e.isRemoveHighlightedData;if(n){if(n){var r=this.parent.getCellStyleValue(["backgroundColor","color"],[t,i]);this.parent.notify(ur,{style:r,rowIdx:t,colIdx:i,cell:e.td})}}else this.parent.notify(ur,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:t,colIdx:i,cell:e.td})}},{key:"validationErrorHandler",value:function(e){var t=this,i=document.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(kl);if(!this.parent.element.querySelector(".e-validationerror-dlg")){var r=this.parent.serviceLocator.getService(Il),a={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(n){var a={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",a),a.cancel&&(t.errorDlgHandler(r,"Cancel"),n.cancel=!0),i.focus(),r.dialogInstance.content=a.content,r.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(r,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(r,"Cancel")}}]};r.show(a,!1)}}},{key:"errorDlgHandler",value:function(e,t){if("Retry"===t){var i=document.getElementsByClassName("e-spreadsheet-edit")[0];if(e.hide(),i.innerText){var n=document.createRange();n.setStart(i.childNodes[0],0),n.setEnd(i.childNodes[0],i.innerText.length);var r=window.getSelection();r.removeAllRanges(),r.addRange(n),this.listObj&&this.listObj.showPopup()}}else{var a=Zn(this.parent.getActiveSheet().activeCell),s=Da(a[0],a[1],this.parent.getActiveSheet()),o=s?this.parent.getDisplayText(s):"";this.parent.notify(xr,{action:"cancelEdit",value:o,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}}},{key:"getModuleName",value:function(){return"dataValidation"}}]),e}(),Ao=function(){function e(t){a(this,e),this.password="",this.parent=t,this.init()}return o(e,[{key:"init",value:function(){this.addEventListener()}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("applyProtect",this.protect,this),this.parent.on("protectSheet",this.protectSheetHandler,this),this.parent.on("editAlert",this.editProtectedAlert,this),this.parent.on("applyLockCells",this.lockCellsHandler,this),this.parent.on("protectWorkbook",this.protectWorkbook,this),this.parent.on(Sr,this.KeyUpHandler,this),this.parent.on("unProtectWorkbook",this.unProtectWorkbook,this),this.parent.on("getPassWord",this.getPassWord,this),this.parent.on("importProtectWorkbook",this.importProtectWorkbook,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("applyProtect",this.protect),this.parent.off("protectSheet",this.protectSheetHandler),this.parent.off("editAlert",this.editProtectedAlert),this.parent.off("applyLockCells",this.lockCellsHandler),this.parent.off("protectWorkbook",this.protectWorkbook),this.parent.off(Sr,this.KeyUpHandler),this.parent.off("unProtectWorkbook",this.unProtectWorkbook),this.parent.off("getPassWord",this.getPassWord),this.parent.off("importProtectWorkbook",this.importProtectWorkbook))}},{key:"protect",value:function(e){this.parent.notify("clearCopy",null),e.isActive?(this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1),this.parent.notify("updateToggleItem",{props:"Protect"}),this.parent.notify("protectSheet",{isActive:e.isActive}),this.parent.notify("protectSelection",null)):this.createDialogue()}},{key:"createDialogue",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=[{text:t.getConstant("SelectCells"),id:"1"},{text:t.getConstant("FormatCells"),id:"2"},{text:t.getConstant("FormatRows"),id:"3"},{text:t.getConstant("FormatColumns"),id:"4"},{text:t.getConstant("InsertLinks"),id:"5"}];this.optionList=new x.b({width:"250px",dataSource:i,showCheckBox:!0,select:this.dialogOpen.bind(this)});var n=this.parent.createElement("div",{className:"e-protect-content",innerHTML:t.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var r=new b.b({checked:!0,label:t.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),a=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),s=this.parent.createElement("div",{className:"e-header-content",innerHTML:t.getConstant("ProtectSheet")}),o=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:s.outerHTML,content:o.outerHTML+n.outerHTML+a.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(t){var i={dialogName:"ProtectSheetDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0),ao(e.parent.element)},open:function(){e.okBtnFocus()},beforeClose:function(){var t=document.getElementById(e.parent.element.id+"_protect_check");f.l.remove(t,"focus",e.okBtnFocus),f.l.remove(r.element,"click",e.checkBoxClickHandler),ao(e.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:t.getConstant("Ok"),isPrimary:!0}}]}),r.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"}]),f.l.add(r.element,"click",this.checkBoxClickHandler,this)}},{key:"okBtnFocus",value:function(){var e=this;document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",function(){e.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()})}},{key:"checkBoxClickHandler",value:function(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())}},{key:"dialogOpen",value:function(){this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()}},{key:"selectOption",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.optionList.getSelectedItems();this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!0);var i={selectCells:t.text.indexOf(e.getConstant("SelectCells"))>-1,formatCells:t.text.indexOf(e.getConstant("FormatCells"))>-1,formatRows:t.text.indexOf(e.getConstant("FormatRows"))>-1,formatColumns:t.text.indexOf(e.getConstant("FormatColumns"))>-1,insertLink:t.text.indexOf(e.getConstant("InsertLinks"))>-1};this.parent.protectSheet(null,i),this.parent.notify("protectSelection",null),this.parent.notify("clearUndoRedoCollection",null),this.dialog.hide()}},{key:"protectSheetHandler",value:function(){var e=this.parent.getActiveSheet(),t=this.parent.element.id,i=[t+"_undo",t+"_redo",t+"_cut",t+"_copy",t+"_paste",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_merge_cells",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],n=[t+"_cut",t+"_copy",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],r=[t+"_insert_function"],a=[t+"_hyperlink",t+"_",t+"_chart"],s=[t+"_"],o=[t+"_find"],l=[t+"_datavalidation"],h=[t+"_chart"],c=document.getElementById(this.parent.element.id+"_sheet_panel");c&&(e.isProtected&&e.protectSettings.selectCells?c.classList.remove("e-protected"):c.classList.add("e-protected"),e.isProtected||c.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify("protectCellFormat",{disableHomeBtnId:i,enableHomeBtnId:n,enableFrmlaBtnId:r,enableInsertBtnId:a,findBtnId:o,dataValidationBtnId:l,imageBtnId:s,chartBtnId:h}),this.parent.notify("enableFormulaInput",null),e.isProtected&&this.parent.notify("updateToggleItem",{props:"Protect"})}},{key:"editProtectedAlert",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(t){var i={dialogName:"EditAlertDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0,bs(function(){return e.dialog.destroyDialog()})),ao(e.parent.element)},close:function(){return ao(e.parent.element)}})}},{key:"lockCellsHandler",value:function(e){var t=this.parent.getActiveSheet();Ma(e.rowIdx,e.colIdx,t,{isLocked:!!e.isLocked&&e.isLocked},!0)}},{key:"protectWorkbook",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.serviceLocator.getService(Il);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:t.getConstant("ProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"ProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.passwordProtectContent(),i.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(i)}}]})}},{key:"passwordProtectContent",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("div",{className:"e-password-dialog"}),i=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),r=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Password")}),a=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ConfirmPassword")}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return s.setAttribute("placeholder",e.getConstant("EnterThePassword")),o.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),i.appendChild(s),i.insertBefore(r,s),n.appendChild(o),n.insertBefore(a,o),t.appendChild(n),t.insertBefore(i,n),t}},{key:"KeyUpHandler",value:function(e){var t=e.target;if(t.classList.contains("e-text")&&Object(f.D)(t,".e-password-content")&&Object(f.D)(t,".e-password-dialog")&&Object(f.D)(t,".e-password-dialog").getElementsByClassName("e-password-content")[1]===t.parentElement){var i=Object(f.D)(t,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?i.removeAttribute("disabled"):i.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&Object(f.D)(t,".e-unprotectpwd-content")&&Object(f.D)(t,".e-unprotectpwd-dialog")&&Object(f.D)(t,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===t.parentElement){var n=Object(f.D)(t,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&Object(f.D)(t,".e-importprotectpwd-content")&&Object(f.D)(t,".e-importprotectpwd-dialog")&&Object(f.D)(t,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===t.parentElement){var r=Object(f.D)(t,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?r.removeAttribute("disabled"):r.setAttribute("disabled","true")}}},{key:"alertMessage",value:function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),i=this.parent.element.querySelector(".e-importprotectpwd-alert-span");e&&e.remove(),t&&t.remove(),i&&i.remove()}},{key:"dlgClickHandler",value:function(e){var t=this.parent.serviceLocator.getService(kl),i=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),r=this.parent.createElement("span",{className:"e-pwd-alert-span"});i.value===n.value?(this.parent.password=i.value,this.parent.isProtected=!0,e.hide(),this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify("updateToggleItem",{props:"Protectworkbook"})):""===i.value?r.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?r.textContent=t.getConstant("ConfirmPasswordAlertMsg"):i.value!==n.value&&(r.textContent=t.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(r)}},{key:"unProtectWorkbook",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.serviceLocator.getService(Il);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:t.getConstant("UnProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"UnProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.unProtectPasswordContent(),i.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(i)}}]})}},{key:"unProtectPasswordContent",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),i=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),r=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return i.appendChild(r),i.insertBefore(n,r),t.appendChild(i),t}},{key:"unprotectdlgOkClick",value:function(e){var t=this.parent.serviceLocator.getService(kl),i=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===i.value)e.hide(),this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.notify("updateToggleItem",{props:"Protectworkbook"});else{var n=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span",innerHTML:t.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)}}},{key:"getPassWord",value:function(e){e.passWord=this.password}},{key:"importProtectWorkbook",value:function(e){var t=this,i=this.parent.serviceLocator.getService(kl),n=this.parent.serviceLocator.getService(Il);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:i.getConstant("UnProtectWorkbook"),beforeOpen:function(i){var r={dialogName:"ImportProtectWorkbook",element:i.element,target:i.target,cancel:i.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(i.cancel=!0),n.dialogInstance.content=t.importProtectPasswordContent(e),n.dialogInstance.dataBind(),t.parent.element.focus()},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){t.alertMessage(),t.importOkClick(e)}}]})}},{key:"importProtectPasswordContent",value:function(e){var t=this.parent.serviceLocator.getService(kl),i=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),r=this.parent.createElement("span",{className:"e-header",innerHTML:'"'+e.file.name+'" '+t.getConstant("IsProtected")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(r),n.appendChild(a),i.appendChild(n),i}},{key:"importOkClick",value:function(e){var t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value,this.parent.open({file:e.file,password:t.value})}},{key:"getModuleName",value:function(){return"protectSheet"}}]),e}(),Eo=function(){function e(t){a(this,e),this.shortValue="",this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on(Lr,this.renderFindDlg,this),this.parent.on(Er,this.renderGotoDlg,this),this.parent.on("gotoHandler",this.gotoHandler,this),this.parent.on("findHandler",this.findHandler,this),this.parent.on("replaceHandler",this.replaceHandler,this),this.parent.on(gr,this.showDialog,this),this.parent.on("replaceAllDialog",this.replaceAllDialog,this),this.parent.on("findUndoRedo",this.findUndoRedo,this),this.parent.on("findKeyUp",this.findKeyUp,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off(Lr,this.renderFindDlg),this.parent.off(Er,this.renderGotoDlg),this.parent.off("gotoHandler",this.gotoHandler),this.parent.off("findHandler",this.findHandler),this.parent.off("replaceHandler",this.replaceHandler),this.parent.off(gr,this.showDialog),this.parent.off("replaceAllDialog",this.replaceAllDialog),this.parent.off("findUndoRedo",this.findUndoRedo),this.parent.off("findKeyUp",this.findKeyUp))}},{key:"findUndoRedo",value:function(e){var t={address:e.address,compareVal:e.compareVal,cancel:!1};"before"===e.undoRedoOpt?this.parent.notify(Ar,{action:"beforeReplace",eventArgs:t}):"after"===e.undoRedoOpt?t.cancel||this.parent.notify(Rr,{action:"replace",eventArgs:{address:e.address,compareVal:e.compareVal}}):"beforeReplaceAll"===e.undoRedoOpt?t.cancel||this.parent.notify(Ar,{action:"beforeReplaceAll",eventArgs:{replaceValue:e.replaceValue,addressCollection:e.Collection}}):"afterReplaceAll"!==e.undoRedoOpt||t.cancel||this.parent.notify(Rr,{action:"replaceAll",eventArgs:{replaceValue:e.replaceValue,addressCollection:e.Collection}})}},{key:"renderFindDlg",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.serviceLocator.getService(Il);if(Object(f.Z)(this.parent.element.querySelector(".e-find-dlg"))){var n={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:t.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:function(t){var n={dialogName:"FindAndReplaceDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.findandreplaceContent(),i.dialogInstance.dataBind(),ao(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(t){e.dialogMessage(),e.findDlgClick(t&&13===t.keyCode?"next":"prev")}},{buttonModel:{content:t.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("next")}},{buttonModel:{content:t.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replace")}},{buttonModel:{content:t.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replaceAll")}}],open:function(){if(e.parent.element.querySelector(".e-text-findNext").value){var t=e.parent.element.querySelector(".e-btn-findPrevious");Object(f.N)(t,"btn").disabled=!1,Object(f.N)(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}},close:function(){i.hide()}};i.show(n,!1)}else i.hide()}},{key:"dialogMessage",value:function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()}},{key:"renderGotoDlg",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.parent.serviceLocator.getService(Il);if(Object(f.Z)(this.parent.element.querySelector(".e-find-dlg"))){var n={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:t.getConstant("GotoHeader"),beforeOpen:function(t){var n={dialogName:"GoToDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.GotoContent(),i.dialogInstance.dataBind(),ao(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()}}],close:function(){i.hide()},open:function(){e.textFocus()}};i.show(n,!1)}else i.hide()}},{key:"textFocus",value:function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()})}},{key:"findDlgClick",value:function(e){"prev"===e||"next"===e?this.findHandler({findOption:e}):this.replaceHandler({findDlgArgs:e})}},{key:"findHandler",value:function(e){var t=this.parent.element.querySelector(".e-text-findNext");t||((t=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert());var i=t.value;if(""!==t.value){var n,r=this.parent.activeSheetIndex,a=this.parent.element.querySelector(".e-findnreplace-checkcase");n=!!a&&Object(f.N)(a,"checkbox").checked;var s,o=this.parent.element.querySelector(".e-findnreplace-checkmatch");s=!!o&&Object(f.N)(o,"checkbox").checked;var l,h=this.parent.element.querySelector(".e-findnreplace-searchby");l=h?Object(f.N)(h,"dropdownlist").value.toString():"By Row";var c,d=this.parent.element.querySelector(".e-findnreplace-searchwithin");c=d?Object(f.N)(d,"dropdownlist").value.toString():"Sheet";var u={value:i,sheetIndex:r,findOpt:e.findOption,mode:c,isCSen:n,isEMatch:s,searchBy:l,isAction:!0};"next"===e.findOption||"prev"===e.findOption?this.parent.find(u):"count"===e.countArgs.countOpt&&(this.parent.notify("count",u),e.countArgs.findCount=u.findCount)}}},{key:"replaceHandler",value:function(e){var t=this.parent.activeSheetIndex,i=this.parent.element.querySelector(".e-text-findNext"),n=this.parent.element.querySelector(".e-text-replaceInp"),r=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=Object(f.N)(r,"checkbox"),s=this.parent.element.querySelector(".e-findnreplace-checkmatch"),o=Object(f.N)(s,"checkbox"),l=this.parent.element.querySelector(".e-findnreplace-searchby"),h=Object(f.N)(l,"dropdownlist"),c=this.parent.element.querySelector(".e-findnreplace-searchwithin"),d=Object(f.N)(c,"dropdownlist"),u={value:i.value,mode:d.value.toString(),isCSen:a.checked,isEMatch:o.checked,searchBy:h.value.toString(),findOpt:"next",replaceValue:n.value,replaceBy:e.findDlgArgs?e.findDlgArgs:e.replaceMode,sheetIndex:t};this.parent.replace(u)}},{key:"gotoHandler",value:function(e){if(e)this.parent.goTo(e.address);else{var t=this.parent.element.querySelector(".e-text-goto").value,i=t.split("");if(""===t||isNaN(parseInt(i[1],10)))return void this.gotoAlert();var n=t.toString().toUpperCase();this.parent.goTo(n)}}},{key:"gotoAlert",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)}},{key:"showDialog",value:function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)}},{key:"replaceAllDialog",value:function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.serviceLocator.getService(kl),i=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+t.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(i)}},{key:"findKeyUp",value:function(e){if(e.target.classList.contains("e-text-findNext")){var t=this.parent.element.querySelector(".e-text-findNext").value;if(Object(f.Z)(t)||""===t)Object(f.N)(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,Object(f.N)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var i=this.parent.element.querySelector(".e-btn-findPrevious");Object(f.N)(i,"btn").disabled=!1,Object(f.N)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var n=this.parent.element.querySelector(".e-text-findNext").value,r=this.parent.element.querySelector(".e-text-replaceInp").value;Object(f.Z)(n)||Object(f.Z)(r)||""===n||""===r?(Object(f.N)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,Object(f.N)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):!1===this.parent.getActiveSheet().isProtected&&(Object(f.N)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,Object(f.N)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)}},{key:"findandreplaceContent",value:function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),i=this.parent.createElement("div",{className:"e-findCheck"}),n=this.parent.serviceLocator.getService(kl);e.appendChild(t);var r=this.parent.createElement("div",{className:"e-cont"}),a=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("FindWhat")}),s=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});r.appendChild(s),r.insertBefore(a,s),t.appendChild(r);var o=new y.g({width:"70%"});o.createElement=this.parent.createElement,o.appendTo(s);var l=this.parent.createElement("div",{className:"e-cont"}),h=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("ReplaceWith")}),c=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});l.appendChild(c),l.insertBefore(h,c),t.appendChild(l);var d=new y.g({width:"70%"});d.createElement=this.parent.createElement,d.appendTo(c);var u=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],p=new C.d({dataSource:u,cssClass:"e-searchby",fields:{value:"Id",text:"Within"},width:"50%",index:0}),g=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:n.getConstant("SearchBy")}}),f=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchWithin")});t.appendChild(f),t.appendChild(g),p.createElement=this.parent.createElement,p.appendTo(g);var m=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],v=new C.d({dataSource:m,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),x=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:n.getConstant("SearchBy")}}),S=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchBy")});t.appendChild(S),t.appendChild(x),v.createElement=this.parent.createElement,v.appendTo(x);var w=new b.b({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),k=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});i.appendChild(k),w.createElement=this.parent.createElement,w.appendTo(k);var I=new b.b({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),O=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return i.appendChild(O),I.createElement=this.parent.createElement,I.appendTo(O),t.appendChild(i),e}},{key:"GotoContent",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.parent.createElement("div",{className:"e-link-dialog"}),i=this.parent.createElement("div",{className:"e-goto"});t.appendChild(i);var n=this.parent.createElement("div",{className:"e-cont"}),r=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),a=new y.g({placeholder:e.getConstant("EntercellAddress")}),s=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(s),n.insertBefore(r,s),i.appendChild(n),a.createElement=this.parent.createElement,a.appendTo(s),t}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"findAndReplace"}}]),e}(),Lo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"merge",value:function(e){var t=this;e.showDialog?this.parent.serviceLocator.getService(Il).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(kl).getConstant("PasteMergeAlert"),beforeOpen:function(e){var i={dialogName:"MergeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),ao(t.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)}},{key:"hideHandler",value:function(e){var t=this.parent.getActiveSheet(),i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(mr,i),i.range=i.range;var n=Da(i.range[0],i.range[1],t)||{},r="row"===e.model?i.range[0]:i.range[1],a=r+((n["".concat(e.model,"Span")]||1)-1);if(!(!e.isEnd&&(e.start===r||ys(t,r))||e.isEnd&&e.start>r&&!ys(t,r))&&n["".concat(e.model,"Span")]>1&&a>=e.start)if("row"===e.model?cs(t,r):ys(t,r)){if(e.end<a&&(a-e.end>1||n.rowSpan>1)){var s=this.parent.getCell(e.rowIdx,e.end+1);if(s&&(a-e.end>1&&(s.colSpan=a-e.end),s.style.display=""),n.rowSpan>1){var o=n.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(n.rowSpan-1));o>1&&(s.rowSpan=o)}}}else this.merge({rowIdx:i.range[0],colIdx:i.range[1]})}},{key:"checkPrevMerge",value:function(e){var t,i,n,r=this.parent.getActiveSheet();e.isRow?e.rowIdx-1>-1&&cs(r,e.rowIdx-1)&&(void 0===(t=Da(e.rowIdx-1,e.colIdx,r)||{}).rowSpan&&void 0===t.colSpan||!(void 0===t.colSpan||t.colSpan>1||e.colIdx-1>-1&&ys(r,e.colIdx-1))||(i={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(mr,i),i.range=i.range,cs(r,i.range[0])&&i.range[2]>=e.rowIdx&&((t=Da(i.range[0],i.range[1],r)||{}).rowSpan>1&&((n=i.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(i.range[2]-e.rowIdx)))>1&&(e.td.rowSpan=n,e.td.style.display=""),t.colSpan>1&&!(e.colIdx-1>-1&&ys(r,e.colIdx-1))&&((n=t.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display="")))))):e.colIdx-1>-1&&ys(r,e.colIdx-1)&&(void 0===(t=Da(e.rowIdx,e.colIdx-1,r)||{}).colSpan&&void 0===t.rowSpan||!(void 0===t.rowSpan||t.rowSpan>1||e.rowIdx-1>-1&&cs(r,e.rowIdx-1))||(i={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(mr,i),i.range=i.range,ys(r,i.range[1])&&i.range[3]>=e.colIdx&&((t=Da(i.range[0],i.range[1],r)||{}).colSpan>1&&((n=i.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""),t.rowSpan>1&&!(e.rowIdx-1>-1&&cs(r,e.rowIdx-1))&&((n=t.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(t.rowSpan-1)))>1&&(e.td.rowSpan=n,e.td.style.display=""))))))}},{key:"checkMerge",value:function(e){var t=this.parent.getActiveSheet(),i=Da(e.rowIdx,e.colIdx,t)||{};if(e.isRow){if(void 0===i.colSpan||ys(t,e.colIdx-1)){var n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(n.range=n.range,this.parent.notify(mr,n),ys(t,e.colIdx-1)&&!ys(t,n.range[1])||e.isFreezePane&&n.range[0]<this.parent.frozenRowCount(t))return void(e.insideFreezePane=n.range[0]<this.parent.frozenRowCount(t));i=Da(n.range[0],n.range[1],t);var r=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,n.range[2]);r>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.rowSpan=r,e.td.style.display="")}}else if(void 0===i.rowSpan||cs(t,e.rowIdx-1)){var a={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(a.range=a.range,this.parent.notify(mr,a),cs(t,e.rowIdx-1)&&!cs(t,a.range[0])||e.isFreezePane&&a.range[1]<this.parent.frozenColCount(t))return void(e.insideFreezePane=a.range[1]<this.parent.frozenColCount(t));i=Da(a.range[0],a.range[1],t);var s=a.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,a.range[3],"columns");s>1&&(this.merge({rowIdx:a.range[0],colIdx:a.range[1],element:e.td}),e.td.colSpan=s,e.td.style.display="")}}},{key:"addEventListener",value:function(){this.parent.on("applyMerge",this.merge,this),this.parent.on("hiddenMerge",this.hideHandler,this),this.parent.on("checkPrevMerge",this.checkPrevMerge,this),this.parent.on("checkMerge",this.checkMerge,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("applyMerge",this.merge),this.parent.off("hiddenMerge",this.hideHandler),this.parent.off("checkPrevMerge",this.checkPrevMerge),this.parent.off("checkMerge",this.checkMerge))}},{key:"getModuleName",value:function(){return"merge"}}]),e}(),To=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener()}},{key:"addEventListener",value:function(){this.parent.on("cFRender",this.cFInitialRender,this),this.parent.on("cFInitialCheck",this.cFInitialCheckHandler,this),this.parent.on("checkConditionalFormat",this.checkConditionalFormatHandler,this),this.parent.on("initiateConditionalFormat",this.initiateCFHandler,this),this.parent.on("setCF",this.setCFHandler,this),this.parent.on("cFDelete",this.cFDeleteHandler,this),this.parent.on("clearCF",this.clearCFHandler,this),this.parent.on("clearCells",this.addClearCFHandler,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("cFRender",this.cFInitialRender),this.parent.off("cFInitialCheck",this.cFInitialCheckHandler),this.parent.off("checkConditionalFormat",this.checkConditionalFormatHandler),this.parent.off("initiateConditionalFormat",this.initiateCFHandler),this.parent.off("setCF",this.setCFHandler),this.parent.off("cFDelete",this.cFDeleteHandler),this.parent.off("clearCF",this.clearCFHandler))}},{key:"setCF",value:function(e){e.range=e.range||this.parent.getActiveSheet().selectedRange;var t={range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:this.parent.activeSheetIndex,cancel:!1};this.parent.notify(Ar,{eventArgs:t,action:"conditionalFormat"}),t.cancel||(e.type=t.type,e.cFColor=t.cFColor,e.value=t.value,e.range=t.range,this.parent.notify("setCFRule",{conditionalFormat:e,isAction:!0}),delete t.cancel,this.parent.notify(Rr,{eventArgs:t,action:"conditionalFormat"}))}},{key:"addClearCFHandler",value:function(e){for(var t=this.parent.getActiveSheet(),i=e.conditionalFormats,n=e.oldRange,r=e.selectedRange,a=t.conditionalFormats,s=i.length-1;s>=0;s--){for(var o=!1,l=0;l<a.length;l++)if(a[l].type===i[s].type&&a[l].range===i[s].range){o=!0,a[l].range=n[s],t.conditionalFormats[l].range=n[s];for(var h=Wn(r),c=n[s].split(","),d=0;d<c.length;d++)for(var u=Wn(c[d]),p=u[0];p<=u[2];p++)for(var g=u[1];g<=u[3];g++)for(var f=h[0];f<=h[2];f++)for(var m=h[1];m<=h[3];m++)if(f===p&&m===g){var v=this.parent.getCell(p,g),y=t.rows[p]&&t.rows[p].cells[g]?t.rows[p].cells[g]:null;y&&this.cFInitialCheckHandler({rowIdx:p,colIdx:g,cell:y,td:v,conditionalFormat:a[l]})}}if(!o){var b=i[s];b.range=n[s],this.parent.notify("setCFRule",{conditionalFormat:b})}}}},{key:"cFDeleteHandler",value:function(e){var t=this.parent.getCell(e.rowIdx,e.colIdx);t&&(t.querySelector(".e-cf-databar")&&t.removeChild(t.querySelector(".e-cf-databar")),t.querySelector(".e-iconsetspan")&&t.removeChild(t.querySelector(".e-iconsetspan")))}},{key:"clearCFHandler",value:function(e){var t=this.parent.getActiveSheet(),i=this.parent.getCell(e.rIdx,e.cIdx),n=Da(e.rIdx,e.cIdx,t);if(i){if(i.classList.remove("e-redft"),i.classList.remove("e-yellowft"),i.classList.remove("e-greenft"),i.classList.remove("e-redf"),i.classList.remove("e-redt"),i.classList.remove("e-iconset"),i.style){if(i.style.backgroundColor){i.style.backgroundColor="";var r=this.parent.getCellStyleValue(["backgroundColor"],[e.rIdx,e.cIdx]);this.parent.notify(ur,{style:r,rowIdx:e.rIdx,colIdx:e.cIdx})}if(i.style.color){i.style.color="";var a=this.parent.getCellStyleValue(["color"],[e.rIdx,e.cIdx]);this.parent.notify(ur,{style:a,rowIdx:e.rIdx,colIdx:e.cIdx})}}i.querySelector(".e-cf-databar")&&(i.removeChild(i.querySelector(".e-cf-databar")),i.textContent=this.parent.getDisplayText(n)),i.querySelector(".e-iconsetspan")&&(i.removeChild(i.querySelector(".e-iconsetspan")),i.textContent=this.parent.getDisplayText(n))}}},{key:"setCFHandler",value:function(e){("cf_databars"===e.action||"cf_colorscales"===e.action||"cf_iconsets"===e.action)&&this.setCF({type:e.id})}},{key:"initiateCFHandler",value:function(e){var t=this,i=this.parent.serviceLocator.getService(kl),n=this.parent.serviceLocator.getService(Il);n.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){n.dialogInstance.content=t.cFDlgContent(e.action),n.dialogInstance.dataBind(),ao(t.parent.element)},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){n.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0].disabled||(t.dlgClickHandler(e.action),n.hide())}}]}),n.dialogInstance.refresh()}},{key:"dlgClickHandler",value:function(e){var t="",i="",n=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),r=n.querySelector(".e-cfmain");if(r){var a=r.getElementsByTagName("input")[0];a&&a.parentElement.classList.contains("e-cfmain")&&(t=r.getElementsByTagName("input")[0].value),i=r.getElementsByTagName("input")[1]?n.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:"";var s=Object(f.S)(this.parent.locale,"");t=t.split(s).join("").split(",").join(""),i=i.split(s).join("").split(",").join("")}var o=this.getCFColor(n.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),l="Duplicate Values..."===e?n.querySelector(".e-cfmain").getElementsByTagName("input")[0].value:this.getType(e);this.setCF(""!==t&&""!==i?{type:l,cFColor:o,value:t+","+i}:""!==t?{type:l,cFColor:o,value:t}:{type:l,cFColor:o,value:i})}},{key:"getType",value:function(e){var t=this.parent.serviceLocator.getService(kl),i="";switch(e){case t.getConstant("GreaterThan")+"...":i="GreaterThan";break;case t.getConstant("LessThan")+"...":i="LessThan";break;case t.getConstant("Between")+"...":i="Between";break;case t.getConstant("CFEqualTo")+"...":i="EqualTo";break;case t.getConstant("TextThatContains")+"...":i="ContainsText";break;case t.getConstant("ADateOccuring")+"...":i="DateOccur";break;case t.getConstant("Top10Items")+"...":i="Top10Items";break;case t.getConstant("Bottom10Items")+"...":i="Bottom10Items";break;case t.getConstant("Top10")+" %...":i="Top10Percentage";break;case t.getConstant("Bottom10")+" %...":i="Bottom10Percentage";break;case t.getConstant("AboveAverage")+"...":i="AboveAverage";break;case t.getConstant("BelowAverage")+"...":i="BelowAverage"}return i}},{key:"getCFColor",value:function(e){var t=this.parent.serviceLocator.getService(kl),i="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):i="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):i="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):i="GreenFT";break;case t.getConstant("RedFill"):i="RedF";break;case t.getConstant("RedText"):i="RedT"}return i}},{key:"cFDlgContent",value:function(e){var t,i=this.getDlgText(e),n=this.parent.serviceLocator.getService(kl),r=this.parent.createElement("div",{className:"e-cf-dlg"}),a=this.parent.createElement("div",{className:"e-cfmain"}),s=this.parent.createElement("div",{className:"e-cfsub"}),o=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:i}),l=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text"}}),h=this.parent.createElement("input",{className:"e-select"}),c=this.parent.createElement("span",{className:"e-header",innerHTML:n.getConstant("With")}),d=this.parent.createElement("input",{className:"e-select"});if(r.appendChild(a),r.appendChild(s),a.appendChild(o),e!==n.getConstant("DuplicateValues")+"..."){if(e!==n.getConstant("AboveAverage")+"..."&&e!==n.getConstant("BelowAverage")+"..."){a.appendChild(l),t=!0;var u=e===n.getConstant("Top10")+" %..."||e===n.getConstant("Bottom10")+" %...";(e===n.getConstant("Top10Items")+"..."||e===n.getConstant("Bottom10Items")+"..."||u)&&(l.maxLength=u?3:4,new y.e({value:10,min:1,max:u?100:1e3,format:"###"}).appendTo(l))}}else{a.appendChild(h);var p=[{text:n.getConstant("Duplicate"),id:"duplicate"},{text:n.getConstant("Unique"),id:"unique"}];new C.d({dataSource:p,index:0,popupHeight:"200px"}).appendTo(h)}if(e===n.getConstant("Between")+"..."){var g=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:n.getConstant("And")}),f=this.parent.createElement("input",{className:"e-input e-between"});a.appendChild(g),a.appendChild(f),f.addEventListener("input",this.validateCfInput.bind(this))}t&&(this.validateCfInput({target:l}),l.addEventListener("input",this.validateCfInput.bind(this))),s.appendChild(c),s.appendChild(d);var m=[{text:n.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:n.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:n.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:n.getConstant("RedFill"),id:"redf"},{text:n.getConstant("RedText"),id:"redt"}];return new C.d({dataSource:m,index:0,popupHeight:"200px"}).appendTo(d),r}},{key:"validateCfInput",value:function(e){var t=this.parent.serviceLocator.getService(Il),i=e.target.value,n=t.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0];i&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(i=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!i.trim()}},{key:"checkCellHandler",value:function(e,t,i){for(var n=!1,r=i.range.trim().split(","),a=0;a<r.length;a++){var s=r[a],o=Wn(s=s.indexOf(":")>-1?s:s+":"+s);if(e>=o[0]&&e<=o[2]&&t>=o[1]&&t<=o[3]){n=!0;break}}return n}},{key:"getDlgText",value:function(e){var t=this.parent.serviceLocator.getService(kl),i="";switch(e){case t.getConstant("GreaterThan")+"...":i=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":i=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":i=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":i=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":i=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":i=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":i=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":i=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":i=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":i=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":i=t.getConstant("FormatCellsBelow")}return i}},{key:"cFInitialRender",value:function(e){var t=this.parent.getActiveSheet().conditionalFormats;if(t)for(var i=0;i<t.length;i++){this.checkCellHandler(e.rowIdx,e.colIdx,t[i])&&this.cFInitialCheckHandler({rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,conditionalFormat:t[i]})}}},{key:"triggetConditionalFormatEvent",value:function(e,t){t&&(e.conditionalFormat.value||"AboveAverage"===e.conditionalFormat.type||"BelowAverage"===e.conditionalFormat.type||"Duplicate"===e.conditionalFormat.type)&&this.parent.trigger("beforeConditionalFormat",e)}},{key:"cFInitialCheckHandler",value:function(e){var t,i,n=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],r=e.cell.value||"",a=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(a){var s=e.conditionalFormat;if(s.type=s.type||"GreaterThan",s.cFColor=s.cFColor||s.format?s.cFColor:"RedFT",i=this.cFRCheck(s,r,a,e.rowIdx,e.colIdx,!0),this.triggetConditionalFormatEvent({conditionalFormat:s,cell:e.cell,element:a,address:Yn(e.rowIdx,e.colIdx),apply:i},e.isAction),i){for(var o=0;o<n.length;o++)if(a.classList.contains(n[o])){a.classList.remove(n[o]);break}s.format&&s.format.style&&(t=s.format.style);var l={};s.cFColor?(a.classList.add("e-"+s.cFColor.toLowerCase()),l=this.setFormat(l,s)):l=t,l.backgroundColor&&a.style.setProperty("background-color",l.backgroundColor),l.color&&a.style.setProperty("color",l.color),l.fontWeight&&a.style.setProperty("font-weight",l.fontWeight),l.fontStyle&&a.style.setProperty("font-style",l.fontStyle),l.textDecoration&&a.style.setProperty("text-decoration",l.textDecoration)}}}},{key:"checkConditionalFormatHandler",value:function(e){var t,i=!1,n=!1,r=this.parent.getActiveSheet(),a=e.cell,s=e.td||this.parent.getCell(e.rowIdx,e.colIdx),o=r.conditionalFormats,l=a?Object(f.Z)(a.value)?"":a.value:"",h=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"];if(o&&!(o.length<1))for(var c=o.length-1;c>=0;c--){for(var d=o[c].range.trim().split(","),u=0;u<d.length;u++){var p=d[u];if(t=Wn(p=p.indexOf(":")>-1?p:p+":"+p),e.rowIdx>=t[0]&&e.colIdx>=t[1]&&e.rowIdx<=t[2]&&e.colIdx<=t[3]){n=!0;break}}if(n){if("GreaterThanLessThanEqualToBetweenContainsTextDateOccur".includes(r.conditionalFormats[c].type)){var g=Da(e.rowIdx,e.colIdx,r)&&Da(e.rowIdx,e.colIdx,r).value?Da(e.rowIdx,e.colIdx,r).value:"";i=(!Object(f.Z)(g)||""!==g)&&this.cFRCheck(r.conditionalFormats[c],g,s),this.setColor(s,e.rowIdx,e.colIdx,c,i,e.isAction)}else if("Top10ItemsBottom10ItemsTop10%Bottom10%AboveAverageBelowAverageDuplicateUnique".includes(r.conditionalFormats[c].type))for(var m=0;m<d.length;m++)for(var v=d[m],y=(t=Wn(v=v.indexOf(":")>-1?v:v+":"+v))[0];y<=t[2];y++){r.rows[y]||hs(r,y,{});for(var b=t[1];b<=t[3];b++){r.rows[y].cells&&r.rows[y].cells[b]||Ma(y,b,r,{});var C=Da(y,b,r)&&Da(y,b,r).value?Da(y,b,r).value:"";i=this.cFRCheck(r.conditionalFormats[c],C,s,y,b,!1),s=this.parent.getCell(y,b),this.setColor(s,y,b,c,i,e.isAction)}}else if("BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleColorScaleGYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScaleThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(r.conditionalFormats[c].type)){for(var x=0;x<h.length;x++)s.classList.contains(h[x])&&s.classList.remove(h[x]);i=this.cFRCheck(r.conditionalFormats[c],l,s,e.rowIdx,e.colIdx,!1)}n=!1}if(i)break}}},{key:"setColor",value:function(e,t,i,n,r,a){var s=this.parent.getActiveSheet(),o=s.conditionalFormats;this.triggetConditionalFormatEvent({conditionalFormat:o[n],cell:Da(t,i,s),element:e,address:Yn(t,i),apply:r},a);var l=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],h=!1;if(o[n].cFColor)e&&e.classList.contains("e-"+o[n].cFColor.toLowerCase())&&(h=!0);else if(o[n].format.style.backgroundColor&&e.style.backgroundColor){var c=this.hexToRgb(o[n].format.style.backgroundColor);"rgb("+c.r+", "+c.g+", "+c.b+")"===e.style.backgroundColor&&(h=!0)}if(r){if(h)for(var d=0;d<l.length;d++)if(e.classList.contains(l[d])){e.classList.remove(l[d]);break}var u={};o[n].cFColor?(e.classList.add("e-"+o[n].cFColor.toLowerCase()),u=this.setFormat(u,o[n])):u=o[n].format.style,this.parent.notify(ur,{style:u,rowIdx:t,colIdx:i,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0})}else{if(h){for(var p=0;p<l.length;p++)if(e.classList.contains(l[p])){e.classList.remove(l[p]);break}e.removeAttribute("style")}var g=Da(t,i,this.parent.getActiveSheet(),null,!0),m=Object(f.L)({},this.parent.commonCellStyle,g.style);this.parent.notify(ur,{style:m,rowIdx:t,colIdx:i})}}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"cFRCheck",value:function(e,t,i,n,r,a){var s="",o="",l=t.toString();if(e.value){var h=e.value.split(",").filter(function(e){return!!e.trim()});if(h.length>1)if(h[0].split("(").length>1){for(var c="",d=0;d<h.length;d++)(c+=h[d]+",").split("(").length===c.split(")").length&&""===s&&(s=c.substring(0,c.length-1),c="");o=c.substring(0,c.length-1)}else{s=h[0];for(var u=1;u<h.length;u++)o+=u+1===h.length?h[u]:h[u]+","}else s=1===h.length?h[0]:e.value}var p=!1,g=e.type;"BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleDataBar".includes(g)&&(g="DataBar"),"GYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScale".includes(g)&&(g="ColorScale"),"ThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(g)&&(g="IconSet");var f={};switch(g){case"GreaterThan":p=this.isGreaterThanLessThan(e,l,s,!0);break;case"LessThan":p=this.isGreaterThanLessThan(e,l,s,!1);break;case"Between":p=this.isBetWeen(e,l,s,o);break;case"EqualTo":p=this.isEqualTo(e,l,s);break;case"ContainsText":p=this.isContainsText(l,s);break;case"DateOccur":f={value:s,rowIndex:0,colIndex:0,sheetIndex:0,updatedVal:""},this.parent.notify("checkDateFormat",f),l===f.updatedVal&&(p=!0);break;case"Unique":case"Duplicate":p=this.isDuplicateUnique(l,e);break;case"Top10Items":p=this.isTopBottomTenValue(l,s,e,!0);break;case"Bottom10Items":p=this.isTopBottomTenValue(l,s,e,!1);break;case"Top10Percentage":p=this.isTopBottomTenPercentage(l,s,e,!0);break;case"Bottom10Percentage":p=this.isTopBottomTenPercentage(l,s,e,!1);break;case"AboveAverage":p=this.isAboveBelowAverage(l,s,e,!0);break;case"BelowAverage":p=this.isAboveBelowAverage(l,s,e,!1);break;case"DataBar":case"ColorScale":case"IconSet":this.isDataBarColorScalesIconSets(g,l,e,i,n,r,a)}return p}},{key:"isDataBarColorScalesIconSets",value:function(e,t,i,n,r,a,s){var o=this.parent.getActiveSheet();if(s)"DataBar"===e?this.applyDataBars(t,i,n,r,a):"ColorScale"===e?this.applyColorScale(t,i,n,r,a):this.applyIconSet(t,i,n,r,a);else{n=null;for(var l=i.range.split(","),h=0;h<l.length;h++)for(var c=Wn(l[h]),d=c[0];d<=c[2];d++)for(var u=c[1];u<=c[3];u++)if(Da(d,u,o)){var p=Da(d,u,o).value;n=this.parent.getCell(d,u),"DataBar"===e?this.applyDataBars(p,i,n,d,u):"ColorScale"===e?this.applyColorScale(p,i,n,d,u):this.applyIconSet(p,i,n,d,u)}}}},{key:"applyIconSet",value:function(e,t,i,n,r){var a=parseInt(e,10),s=this.getIconList(t.type).split(","),o=[],l=this.parent.getActiveSheet(),h=l.rows[n]&&l.rows[n].cells[r]?l.rows[n].cells[r]:null;if(h){for(var c=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[r],d=t.range.split(","),u=0;u<d.length;u++){var p=Wn(d[u]);o=this.getNumericArray(p,o)}var g,m=(o=o.sort(function(e,t){return e-t}))[0],v=o[o.length-1];if(3===s.length){var y=m+.33*(v-m);g="e-"+(a>=m+.67*(v-m)?s[0].trim():a>=y?s[1].trim():s[2].trim())}else if(4===s.length){var b=m+.25*(v-m),C=m+.5*(v-m);g="e-"+(a>=m+.75*(v-m)?s[0].trim():a>=C?s[1].trim():a>=b?s[2].trim():s[3].trim())}else if(5===s.length){var x=m+.2*(v-m),S=m+.4*(v-m),w=m+.6*(v-m);g="e-"+(a>=m+.8*(v-m)?s[0].trim():a>=w?s[1].trim():a>=S?s[2].trim():a>=x?s[3].trim():s[4].trim())}if(!Object(f.Z)(h)){var k=this.parent.createElement("span",{className:"e-icon"});k.classList.add("e-iconsetspan"),k.classList.add(g),this.applyIconSetIcon({rowIndex:n,colIndex:r},k,c)}}}},{key:"applyIconSetIcon",value:function(e,t,i){var n=this.parent.getActiveSheet(),r=Da(e.rowIndex,e.colIndex,n).value,a=i;a.classList.contains("e-iconset")&&a.querySelector(".e-iconsetspan")&&a.removeChild(a.querySelector(".e-iconsetspan")),hr(r)&&(a.insertBefore(t,a.childNodes[0]),a.classList.add("e-iconset"))}},{key:"getIconList",value:function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"}},{key:"applyColorScale",value:function(e,t,i,n,r){var a,s=this.parent.getActiveSheet(),o=parseInt(e,10),l=[],h=this.getColor(t.type),c=s.rows[n]&&s.rows[n].cells[r]?s.rows[n].cells[r]:null;if(c){for(var d=t.range.split(","),u=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[r],p=0;p<d.length;p++){var g=Wn(d[p]);l=this.getNumericArray(g,l)}l=l.sort(function(e,t){return e-t}).reverse();for(var m=0;m<l.length;m++)if(l[m]===o){a=m;break}var v=0===a?h[0]:a===l.length-1?h[h.length-1]:3===l.length&&1===a?h[1]:this.getGradient(a,h[0],h[1],h[2],l.length);if(!Object(f.Z)(c)){var y={};Object(f.Z)(a)?(y=this.parent.getCellStyleValue(["backgroundColor"],[n,r]),u.style.backgroundColor=y.backgroundColor):(y={backgroundColor:v},u.style.backgroundColor=v)}}}},{key:"applyDataBars",value:function(e,t,i,n,r){var a,s,o=this.parent.getActiveSheet(),l={},h={},c=t.type,d=o.rows[n].cells&&o.rows[n].cells[r]?o.rows[n].cells[r]:null;if(d){for(var u,p=[],g=this.parent.getMainContent().getElementsByClassName("e-row")[n],m=i||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[r],v=g&&g.style?parseInt(g.style.height,10):20,y=[],b=[],C=0,x=parseInt(e,10),S=t.range.split(","),w=0;w<S.length;w++){var k=Wn(S[w]);p=this.getNumericArray(k,p)}for(var I=0;I<p.length;I++)for(var O=0;O<p.length;O++)p[O]>0?y.push(p[O]):b.push(p[O]);if(c="BlueDataBar"===c?"B":"GreenDataBar"===c?"G":"RedDataBar"===c?"R":"OrangeDataBar"===c?"O":"LightBlueDataBar"===c?"LB":"PurpleDataBar"===c?"P":"",a=this.getColor(c)[0],s=this.getColor("R")[0],y=y.sort(function(e,t){return e-t}).reverse(),(b=b.sort(function(e,t){return e-t})).length&&y.length)u=y[0]+Math.abs(b[0]),C=Math.abs(b[0]/u*100);else{if(!b.length&&!y.length)return;u=b.length?b[0]:y[0]}if(m&&(Object(f.Z)(x)||""===e)&&m.getElementsByClassName("e-cf-databar")[0]&&m.removeChild(m.getElementsByClassName("e-cf-databar")[0]),hr(x)){var R,A=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),E=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),L=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),T=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"});l=E.style,h=L.style,A.appendChild(T),A.insertBefore(L,T),A.insertBefore(E,L),m.querySelector(".e-iconsetspan")&&(R=m.querySelector(".e-iconsetspan")),m.textContent="",m.appendChild(A),R&&m.insertBefore(R,m.firstElementChild),T.innerHTML=this.parent.getDisplayText(d),A.style.height=v-1+"px",T.style.fontSize="11pt",b.length?y.length?x>-1?(l.width=C+"%",l.height=v-3+"px",l.backgroundColor="transparent",l.left="0px",h.width=Math.ceil(Math.abs(x/u*100))+"%",h.height=v-3+"px",h.backgroundColor=c=a,h.left=C+"%"):x<0&&(l.width=Math.ceil(Math.abs(x/u*100))+"%",l.height=v-3+"px",l.backgroundColor=s,l.width===C+"%"?l.left="0px":l.right=100-C+"%"):(h.width=Math.ceil(Math.abs(x/u*100))+"%",h.height=v-3+"px",h.backgroundColor=c=s,h.left="0px"):(h.width=Math.ceil(Math.abs(x/u*100))+"%",h.height=v-3+"px",h.backgroundColor=c=a,h.left="0px")}}}},{key:"getNumericArray",value:function(e,t){for(var i=this.parent.getActiveSheet(),n=e[0];n<=e[2];n++)for(var r=e[1];r<=e[3];r++){var a=Da(n,r,i)&&Da(n,r,i).value?Da(n,r,i).value:"";if(Object(f.Z)(a)||hr(a)||lr(a)){var s=parseInt(a,10);Object(f.Z)(a)||""===a||t.push(s)}}return t}},{key:"getColor",value:function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),i=[],n=0;n<t.length;n++)switch(t[n]){case"G":i.push("#63be7b");break;case"Y":i.push("#ffeb84");break;case"R":i.push("#f8696b");break;case"W":i.push("#ffffff");break;case"B":i.push("#5a8ac6");break;case"O":i.push("#ffb628");break;case"LB":i.push("#008aef");break;case"P":i.push("#d6007b")}return i}},{key:"getGradient",value:function(e,t,i,n,r){if(Object(f.Z)(n))return this.getLinear(t,i,e/r);var a=r/2;return e>=a?this.getLinear(i,n,Math.abs((e-a)/a)):this.getLinear(t,i,e/a)}},{key:"getLinear",value:function(e,t,i){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],i)+this.byteLinear(e[3]+e[4],t[3]+t[4],i)+this.byteLinear(e[5]+e[6],t[5]+t[6],i)}},{key:"byteLinear",value:function(e,t,i){var n=parseInt(e,16)*(1-i)+parseInt(t,16)*i|0;return Math.abs(n).toString(16)}},{key:"isGreaterThanLessThan",value:function(e,t,i,n){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=!1;if(hr(t))if(hr(i))a=n?parseFloat(t)>parseFloat(i.replace(r,"")):parseFloat(t)<parseFloat(i.replace(r,""));else{var s={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),s.isDate||s.isTime?(a=n?t>s.updatedVal:t<s.updatedVal,e.value=s.updatedVal.toString()):a=n?t.toLowerCase()>i.toLowerCase():t.toLowerCase()<i.toLowerCase()}else""!==t||0===Number(i)||n||(a=!0);return a}},{key:"isBetWeen",value:function(e,t,i,n){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=!1;if(i=i.replace(r,""),n=n.replace(r,""),hr(t))if(hr(i))a=parseFloat(t)>=parseFloat(i)&&parseFloat(t)<=parseFloat(n);else if(i&&n){var s={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1},o={value:n,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",s),this.parent.notify("checkDateFormat",o),(s.isDate||s.isTime)&&(o.isDate||o.isTime)?(a=t>=s.updatedVal&&t<=o.updatedVal,e.value=s.updatedVal.toString()+","+o.updatedVal.toString()):a=t.toLowerCase()>=i.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return a}},{key:"isEqualTo",value:function(e,t,i){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g),r=!1;if(hr(t))if(hr(i))r=parseFloat(t)===parseFloat(i.replace(n,""));else{var a={value:i,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify("checkDateFormat",a),a.isTime||a.isDate?(r=t===a.updatedVal,e.value=a.updatedVal.toString()):r=t.toLowerCase()===i.toLowerCase()}return r}},{key:"isContainsText",value:function(e,t){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g),n=!1;return Object(f.Z)(e)||!e.length?n=!1:hr(t.replace(i,""))?(t=t.replace(i,""),lr(e)&&(e=or(e).toString()),n=e.indexOf(t)>-1):lr(t)?(lr(e)&&(e=or(e).toString()),n=e.indexOf(or(t).toString())>-1):n=e.toLowerCase().indexOf(t.toLowerCase())>-1,n}},{key:"isTopBottomTenValue",value:function(e,t,i,n){var r=this.parent.getActiveSheet(),a=new RegExp(/[^.-a-zA-Z 0-9]+/g),s=parseInt(e,10),o=parseInt(t,10),l=!1;if(hr(t)){hr(e)?(s=parseFloat(e),o=parseFloat(t.replace(a,""))):lr(e)&&(s=or(e),o=parseFloat(t));for(var h,c=[],d=i.range.split(","),u=0;u<d.length;u++)for(var p=Wn(d[u]),g=p[0];g<=p[2];g++)for(var f=p[1];f<=p[3];f++)(h=Da(g,f,r)&&Da(g,f,r).value?Da(g,f,r).value:"")&&hr(h)&&(h=parseFloat(h),c.push(h));l=(c=(c=n?c.sort(function(e,t){return e-t}).reverse():c.sort(function(e,t){return e-t})).slice(0,o)).indexOf(s)>-1}return l}},{key:"isTopBottomTenPercentage",value:function(e,t,i,n){var r=this.parent.getActiveSheet(),a=new RegExp(/[^.-a-zA-Z 0-9]+/g),s=parseInt(e,10),o=parseInt(t,10),l=!1;if(hr(t)){hr(e)?(s=parseFloat(e),o=parseFloat(t.replace(a,""))):lr(e)&&(s=or(e),o=parseFloat(t));for(var h,c,d=[],u=0,p=i.range.split(","),g=0;g<p.length;g++)for(var f=Wn(p[g]),m=f[0];m<=f[2];m++)for(var v=f[1];v<=f[3];v++)(h=Da(m,v,r)&&Da(m,v,r).value?Da(m,v,r).value:"")&&hr(h)&&(h=parseFloat(h),d.push(h)),u++;c=o/(100/u),c=Math.ceil(c),l=(d=(d=n?d.sort(function(e,t){return e-t}).reverse():d.sort(function(e,t){return e-t})).slice(0,c||1)).indexOf(s)>-1}return l}},{key:"isAboveBelowAverage",value:function(e,t,i,n){for(var r,a=this.parent.getActiveSheet(),s=parseFloat(e),o=i.range.split(","),l=[],h=0,c=0;c<o.length;c++)for(var d=Wn(o[c]),u=d[0];u<=d[2];u++)for(var p=d[1];p<=d[3];p++)(r=Da(u,p,a)&&Da(u,p,a).value?Da(u,p,a).value:"")&&hr(r)&&(r=parseFloat(r),l.push(r));for(var g=0;g<l.length;g++)h+=l[g];return h/=l.length,n?s>h:s<h}},{key:"isDuplicateUnique",value:function(e,t){var i,n=t.type,r=0,a=this.parent.getActiveSheet(),s=e,o=t.range.split(",");if(Object(f.Z)(s)||""===s)return!1;for(var l=0;l<o.length;l++)for(var h=Wn(o[l]),c=h[0];c<=h[2];c++)for(var d=h[1];d<=h[3];d++)if((i=Da(c,d,a)&&Da(c,d,a).value?Da(c,d,a).value.toString():"")&&""!==i&&2===(r=s.toLowerCase()===i.toLowerCase()?r+1:r))return"Duplicate"===n;return"Duplicate"!==n}},{key:"setFormat",value:function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e}},{key:"getModuleName",value:function(){return"conditionalFormatting"}}]),e}(),jo=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Do=(ho=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),jo([Object(f.t)("")],ho.prototype,"text",void 0),jo([Object(f.t)("")],ho.prototype,"iconCss",void 0),jo([Object(f.t)("left")],ho.prototype,"iconPosition",void 0),ho),Mo=(lo=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),jo([Object(f.g)({},Do)],lo.prototype,"header",void 0),jo([Object(f.f)([],v.c)],lo.prototype,"content",void 0),jo([Object(f.t)("")],lo.prototype,"cssClass",void 0),jo([Object(f.t)(!1)],lo.prototype,"disabled",void 0),lo),Fo=(oo=function(e){l(i,e);var t=c(i);function i(e,n){return a(this,i),t.call(this,e)}return o(i,[{key:"preRender",value:function(){}},{key:"render",value:function(){this.element.id||(this.element.id=Object(f.W)("ribbon")),this.renderRibbon()}},{key:"destroy",value:function(){var e=this.element.querySelector(".e-drop-icon");if(e&&e.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var t=document.getElementById("".concat(this.element.id,"_menu"));t&&Object(f.N)(t,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,r(p(i.prototype),"destroy",this).call(this)}},{key:"getTabItems",value:function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(function(i){t.push({header:i.header,content:e.toolbarObj.element})}),t}},{key:"initMenu",value:function(e){var t=this,i=this.createElement("ul",{id:"".concat(this.element.id,"_menu")});this.element.appendChild(i);var n=new v.d({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(i){i.parentItem.text===e[0].text&&(n.showItemOnClick=!1),t.trigger("beforeOpen",i)},select:function(e){t.trigger("fileMenuItemSelect",e)},beforeClose:function(i){"mouseover"!==i.event.type||Object(f.D)(i.event.target,".e-menu-popup")?(t.trigger("beforeClose",i),i.parentItem&&i.parentItem.text!==e[0].text||requestAnimationFrame(function(){return n.setProperties({showItemOnClick:!0},!0)})):i.cancel=!0},beforeItemRender:function(e){t.trigger("beforeFileMenuItemRender",e)}});return n.createElement=this.createElement,n.appendTo(i),i.parentElement}},{key:"renderRibbon",value:function(){var e=this,t=this.createElement("div"),i=this.createElement("div");this.toolbarObj=new v.h({items:this.items[this.selectedTab].content,clicked:function(t){return e.trigger("clicked",t)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(i),this.tabObj=new v.g({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(t){if(e.menuItems.length&&0===t.selectingIndex)t.cancel=!0;else{if(t.selectingIndex===e.getIndex(e.selectedTab))return;var i;e.updateToolbar(e.getIndex(t.selectingIndex,!0)),e.toolbarObj.dataBind(),e.element.classList.contains("e-collapsed")&&f.l.remove(t.selectedItem,"click",e.ribbonExpandCollapse),e.menuItems.length?((i=Object.assign({},t)).selectingIndex-=1,i.selectedIndex-=1):i=t,e.trigger("selecting",i)}},selected:function(t){t.selectedIndex!==e.getIndex(e.selectedTab)&&(e.setProperties({selectedTab:e.getIndex(t.selectedIndex,!0)},!0),e.element.classList.contains("e-collapsed")&&(e.element.classList.remove("e-collapsed"),e.trigger("expandCollapse",{element:e.toolbarObj.element,expanded:!0})))},created:function(){e.toolbarObj.refreshOverflow()}}),this.element.appendChild(t),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(t);var n=this.createElement("span",{className:"e-drop-icon e-icons"});n.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(n)}},{key:"ribbonExpandCollapse",value:function(e){var t,i={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(t=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),t.classList.add("e-active"),f.l.remove(t,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",i)):(t=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),i.expanded=!1,t.classList.remove("e-active"),f.l.add(t,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",i))}},{key:"getIndex",value:function(e,t){return this.menuItems.length?t?e-1:e+1:e}},{key:"updateToolbar",value:function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()}},{key:"enableMenuItems",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.menuItems.length&&Object(f.N)(document.getElementById("".concat(this.element.id,"_menu")),"menu").enableItems(e,t,i)}},{key:"hideMenuItems",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if(this.menuItems.length){var n=Object(f.N)(document.getElementById("".concat(this.element.id,"_menu")),"menu");t?n.hideItems(e,i):n.showItems(e,i)}}},{key:"addMenuItems",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;if(this.menuItems.length){var r=Object(f.N)(document.getElementById("".concat(this.element.id,"_menu")),"menu");i?r.insertAfter(e.reverse(),t,n):r.insertBefore(e,t,n)}}},{key:"hideTabs",value:function(e){var t,i,n,r,a=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(s||(r=this.isAllHidden()),e.forEach(function(e){(t=a.getTabIndex(e,-1))>-1&&(s?a.items[t].cssClass.includes(" e-hide")||(a.items[t].cssClass="".concat(a.items[t].cssClass," e-hide"),a.tabObj.items[a.getIndex(t)].cssClass=a.items[t].cssClass,void 0===i&&t===a.selectedTab&&(i=!0),n=!0):a.items[t].cssClass.includes(" e-hide")&&(a.items[t].cssClass=a.items[t].cssClass.replace(" e-hide",""),a.tabObj.items[a.getIndex(t)].cssClass=a.items[t].cssClass,void 0===i&&t===a.selectedTab&&(i=!0),n=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),s&&(r=this.isAllHidden())&&(i=!1),!s&&r&&(i=!i),n&&r&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),i)for(var o=0;o<this.items.length;o++)if(!this.items[o].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(o),this.tabObj.dataBind();break}}},{key:"isAllHidden",value:function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e}},{key:"enableTabs",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.forEach(function(e){var n=t.getTabIndex(e,-1);n>-1&&(t.items[n].disabled=!i,n=t.getIndex(n),t.tabObj.enableTab(n,i))}),this.setProperties({items:this.items},!0)}},{key:"addTabs",value:function(e,t){var i=this,n=this.getTabIndex(t);e.forEach(function(e){e=new Mo(i.items[0],"items",e,!0),i.items.splice(n,0,e),i.tabObj.addTab([{header:e.header,content:i.toolbarObj.element}],i.getIndex(n)),n++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)}},{key:"getTabIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.items.length;if(e)for(var i=0;i<this.items.length;i++)if(this.items[i].header.text===e){t=i;break}return t}},{key:"addToolbarItems",value:function(e,t,i){var n=this,r=this.getTabIndex(e);Object(f.Z)(i)&&(i=this.items[r].content.length),t.forEach(function(e){e=new v.c(n.items[r].content[0],"content",e,!0),n.items[r].content.splice(i,0,e),i++}),this.setProperties({items:this.items},!0),r===this.selectedTab&&t.length&&this.updateToolbar(r)}},{key:"enableItems",value:function(e,t,i){if(void 0===i&&(i=!0),t){var n=this.getTabIndex(e,-1);if(n<0)return;for(var r=0;r<t.length;r++){if("string"==typeof t[r])for(var a=0;a<this.items[n].content.length;a++)if(this.items[n].content[a].id===t[r]){t[r]=a;break}if("string"==typeof t[r])return;this.items[n].content[t[r]].disabled=!i,n!==this.selectedTab&&this.setProperties({items:this.items},!0)}n===this.selectedTab&&this.updateToolbar(n)}else this.toolbarObj.disable(!i)}},{key:"hideToolbarItems",value:function(e,t){for(var i,n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=0;a<this.items.length;a++)if(this.items[a].header.text===e){i=a,t.forEach(function(e){n.items[i].content[e]&&(r?n.items[i].content[e].cssClass.includes(" e-hide")||(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass+" e-hide"):n.items[i].content[e].cssClass.includes(" e-hide")&&(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==i&&i===this.selectedTab&&this.updateToolbar(i)}},{key:"getModuleName",value:function(){return"ribbon"}},{key:"getPersistData",value:function(){return this.addOnPersist([])}},{key:"onPropertyChanged",value:function(e,t){for(var i=0,n=Object.keys(e);i<n.length;i++)switch(n[i]){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}}}]),i}(f.h),jo([Object(f.t)("")],oo.prototype,"cssClass",void 0),jo([Object(f.t)(!0)],oo.prototype,"menuType",void 0),jo([Object(f.f)([],v.e)],oo.prototype,"menuItems",void 0),jo([Object(f.t)(0)],oo.prototype,"selectedTab",void 0),jo([Object(f.f)([],Mo)],oo.prototype,"items",void 0),jo([Object(f.k)()],oo.prototype,"selecting",void 0),jo([Object(f.k)()],oo.prototype,"fileMenuItemSelect",void 0),jo([Object(f.k)()],oo.prototype,"beforeFileMenuItemRender",void 0),jo([Object(f.k)()],oo.prototype,"beforeOpen",void 0),jo([Object(f.k)()],oo.prototype,"beforeClose",void 0),jo([Object(f.k)()],oo.prototype,"selectFormat",void 0),jo([Object(f.k)()],oo.prototype,"clicked",void 0),jo([Object(f.k)()],oo.prototype,"created",void 0),jo([Object(f.k)()],oo.prototype,"expandCollapse",void 0),oo=jo([f.r],oo)),Po=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"render",value:function(){var e=this,t=this.parent.element.id,i=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new y.a({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Rl,enableOpacity:!1,beforeClose:function(){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(e.fontColorPicker,t)},change:function(t){var i={style:{color:e.fontColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(dr,i),i.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(i.style.color,e.fontColorPicker.element),ao(e.parent.element)},created:function(){return e.wireFocusEvent(e.fontColorPicker.element,"#000000")}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(i),this.fontColorPicker.appendTo(i),i.parentElement.id="".concat(t,"_font_color_picker"),Object(f.w)([i.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),i=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new y.a({value:"#ffff00ff",mode:"Palette",presetColors:Al,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(t){return e.beforeModeSwitch(e.filColorPicker,t)},change:function(t){var i={style:{backgroundColor:e.filColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(dr,i),i.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(i.style.backgroundColor,e.filColorPicker.element),ao(e.parent.element)},created:function(){return e.wireFocusEvent(e.filColorPicker.element,"#ffff00")}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(i),this.filColorPicker.appendTo(i),i.parentElement.id="".concat(t,"_fill_color_picker"),Object(f.w)([i.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])}},{key:"updateSelectedColor",value:function(e,t){t.nextElementSibling.querySelector(".e-selected-color").style.borderBottomColor=e}},{key:"wireFocusEvent",value:function(e,t){var i=this;this.updateSelectedColor(t,e),(e=e.parentElement.querySelector(".e-split-colorpicker")).addEventListener("focus",function(){ao(i.parent.element)})}},{key:"openHandler",value:function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(kl).getConstant("MoreColors")}},{key:"beforeCloseHandler",value:function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0)}},{key:"beforeModeSwitch",value:function(e,t){var i=this.parent.serviceLocator.getService(kl);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=i.getConstant("Apply"),t.element.querySelector(".e-cancel").title=i.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=i.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=i.getConstant("MoreColors"))}},{key:"destroy",value:function(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)}},{key:"addEventListener",value:function(){this.parent.on("beforeRibbonCreate",this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}},{key:"removeEventListener",value:function(){this.parent.off("beforeRibbonCreate",this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on("spreadsheetDestroyed",this.destroy,this)}}]),e}(),No=function(){function e(t){a(this,e),this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.preTabIdx=1,this.chartThemeIndex=5,this.parent=t,this.addEventListener(),new Po(t)}return o(e,[{key:"getModuleName",value:function(){return"ribbon"}},{key:"initRibbon",value:function(e){this.parent.showRibbon||!this.ribbon?(this.parent.notify("beforeRibbonCreate",{}),this.parent.isMobileView()?this.createMobileView():this.createRibbon(e)):this.destroy()}},{key:"getRibbonMenuItems",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:"".concat(t,"_File"),items:[{text:e.getConstant("New"),id:"".concat(t,"_New"),iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:"".concat(t,"_Open"),iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:"".concat(t,"_Save_As"),items:[{text:e.getConstant("ExcelXlsx"),id:"".concat(t,"_Xlsx"),iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:"".concat(t,"_Xls"),iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:"".concat(t,"_Csv"),iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:"".concat(t,"_Pdf"),iconCss:"e-pdf e-icons"}]}]}]}},{key:"getRibbonItems",value:function(){var e=this,t=this.parent.element.id,i=this.parent.serviceLocator.getService(kl),n=[{header:{text:i.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:"".concat(i.getConstant("Undo")," (Ctrl+Z)"),id:t+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:"".concat(i.getConstant("Redo")," (Ctrl+Y)"),id:t+"_redo",disabled:!0},{type:"Separator",id:t+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:"".concat(i.getConstant("Cut")," (Ctrl+X)"),id:t+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:"".concat(i.getConstant("Copy")," (Ctrl+C)"),id:t+"_copy"},{tooltipText:"".concat(i.getConstant("Paste")," (Ctrl+V)"),template:this.getPasteBtn(t),id:t+"_paste",disabled:!0},{type:"Separator",id:t+"_separator_2"},{template:this.getNumFormatDDB(t),tooltipText:i.getConstant("NumberFormat"),id:t+"_number_format"},{type:"Separator",id:t+"_separator_3"},{template:this.getFontNameDDB(t),tooltipText:i.getConstant("Font"),id:t+"_font_name"},{type:"Separator",id:t+"_separator_4"},{template:this.getFontSizeDDB(t),tooltipText:i.getConstant("FontSize"),id:t+"_font_size"},{type:"Separator",id:t+"_separator_5"},{template:this.getBtn(t,"bold"),tooltipText:"".concat(i.getConstant("Bold")," (Ctrl+B)"),id:t+"_bold"},{template:this.getBtn(t,"italic"),tooltipText:"".concat(i.getConstant("Italic")," (Ctrl+I)"),id:t+"_italic"},{template:this.getBtn(t,"line-through"),tooltipText:"".concat(i.getConstant("Strikethrough")," (Ctrl+5)"),id:t+"_line-through"},{template:this.getBtn(t,"underline"),tooltipText:"".concat(i.getConstant("Underline")," (Ctrl+U)"),id:t+"_underline"},{template:document.getElementById("".concat(t,"_font_color_picker")),tooltipText:i.getConstant("TextColor"),id:t+"_font_color_picker"},{type:"Separator",id:t+"_separator_6"},{template:document.getElementById("".concat(t,"_fill_color_picker")),tooltipText:i.getConstant("FillColor"),id:t+"_fill_color_picker"},{template:this.getBordersDBB(t),tooltipText:i.getConstant("Borders"),id:t+"_borders"},{template:this.getMergeSplitBtn(t),tooltipText:i.getConstant("MergeCells"),id:t+"_merge_cells",disabled:!0},{type:"Separator",id:t+"_separator_7"},{template:this.getTextAlignDDB(t),tooltipText:i.getConstant("HorizontalAlignment"),id:t+"_text_align"},{template:this.getVerticalAlignDDB(t),tooltipText:i.getConstant("VerticalAlignment"),id:t+"_vertical_align"},{template:this.getBtn(t,"wrap",!1),tooltipText:"".concat(i.getConstant("WrapText")),id:t+"_wrap"}]},{header:{text:i.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:i.getConstant("Link"),id:t+"_hyperlink",tooltipText:i.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:i.getConstant("Image"),id:t+"_",tooltipText:i.getConstant("Image"),click:function(){Object(f.ob)("#"+t+"_imageUpload",e.parent.element).click()}}]},{header:{text:i.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:i.getConstant("InsertFunction"),text:i.getConstant("InsertFunction"),id:t+"_insert_function"}]},{header:{text:i.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:i.getConstant("ProtectSheet"),id:t+"_protect",tooltipText:i.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:i.getConstant("ProtectWorkbook"),id:t+"_protectworkbook",tooltipText:i.getConstant("ProtectWorkbook")},{type:"Separator",id:t+"_separator_8"},{template:this.datavalidationDDB(t),tooltipText:i.getConstant("DataValidation"),id:t+"_datavalidation"}]},{header:{text:i.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:t+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:t+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:t+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:t+"_separator_13"},{prefixIcon:"e-freeze-pane",text:i.getConstant("FreezePanes"),id:t+"_freezepanes",tooltipText:i.getConstant("FreezePanes")},{prefixIcon:"e-freeze-row",text:i.getConstant("FreezeRows"),id:t+"_freezerows",tooltipText:i.getConstant("FreezeRows")},{prefixIcon:"e-freeze-column",text:i.getConstant("FreezeColumns"),id:t+"_freezecolumns",tooltipText:i.getConstant("FreezeColumns")}]}];return this.parent.allowConditionalFormat&&n.find(function(e){return e.header&&e.header.text===i.getConstant("Home")}).content.push({type:"Separator",id:t+"_separator_10"},{template:this.getCFDBB(t),tooltipText:i.getConstant("ConditionalFormatting"),id:t+"_conditionalformatting"}),this.parent.allowChart&&n.find(function(e){return e.header&&e.header.text===i.getConstant("Insert")}).content.push({type:"Separator",id:t+"_separator_11"},{template:this.getChartDDB(t,!0),text:i.getConstant("Chart"),tooltipText:i.getConstant("Chart"),id:t+"_chart"}),this.parent.allowCellFormatting&&n.find(function(e){return e.header&&e.header.text===i.getConstant("Home")}).content.push({type:"Separator",id:t+"_separator_12"},{template:this.getClearDDB(t),tooltipText:i.getConstant("Clear"),id:t+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&n.find(function(e){return e.header&&e.header.text===i.getConstant("Home")}).content.push({template:this.getSortFilterDDB(t),tooltipText:i.getConstant("SortAndFilter"),id:t+"_sorting"}),this.parent.allowFindAndReplace&&n.find(function(e){return e.header&&e.header.text===i.getConstant("Home")}).content.push({template:this.getFindDDb(t),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:i.getConstant("FindReplaceTooltip"),id:t+"_find"}),n}},{key:"getPasteBtn",value:function(e){var t=this,i=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste"})),n=this.parent.serviceLocator.getService(kl);return this.pasteSplitBtn=new S.c({iconCss:"e-icons e-paste-icon",items:[{text:n.getConstant("All"),id:"All"},{text:n.getConstant("Values"),id:"Values"},{text:n.getConstant("Formats"),id:"Formats"}],select:function(e){t.parent.notify(Ir,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){t.parent.notify(Ir,{isAction:!0,isInternal:!0})},close:function(){ao(t.parent.element)}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(i),i.parentElement}},{key:"getHyperlinkDlg",value:function(){var e,t=Wn(this.parent.getActiveSheet().activeCell),i=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]];Object(f.Z)(i)||(e=i.cells[t[1]]),Object(f.Z)(e)&&Ma(t[0],t[1],this.parent.getActiveSheet(),e,!1),this.parent.notify(e&&e.hyperlink?"editHyperlink":"initiateHyperlink",null)}},{key:"passwordProtectDlg",value:function(){this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify("protectWorkbook",null)}},{key:"getLocaleText",value:function(e,t){var i,n=this.parent.serviceLocator.getService(kl);return this.parent.getActiveSheet()["show"+e]?(t&&document.getElementById(this.parent.element.id+"_sheet").classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant("Hide"+e)):(t&&document.getElementById(this.parent.element.id+"_sheet").classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant("Show"+e)),i}},{key:"getLocaleProtectText",value:function(e,t){var i,n=this.parent.serviceLocator.getService(kl);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant("Protect"+e)),i}},{key:"getLocaleProtectWorkbook",value:function(e,t){var i,n=this.parent.serviceLocator.getService(kl);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),i=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),i=n.getConstant(e)),i}},{key:"insertDesignChart",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl),i=this.ribbon.items.length-1;if(this.preTabIdx=this.ribbon.selectedTab,this.parent.allowChart&&this.ribbon.items[i]&&this.ribbon.items[i].header.text!==t.getConstant("ChartDesign")){var n=this.parent.element.id,r=[{header:{text:t.getConstant("ChartDesign")},content:[{template:this.getAddChartEleDBB(n),tooltipText:t.getConstant("AddChartElement"),id:n+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:t.getConstant("SwitchRowColumn"),tooltipText:t.getConstant("SwitchRowColumn"),id:n+"switch_row_column_chart",click:function(){e.parent.notify("chartDesignTab",{switchRowColumn:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(n),tooltipText:t.getConstant("ChartTheme"),id:n+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(n,!1),tooltipText:t.getConstant("ChartType"),id:n+"_chart_type"}]}];this.parent.addRibbonTabs(r),i=this.ribbon.items.length,this.ribbon.tabObj.select(i)}}},{key:"removeDesignChart",value:function(){var e=this.parent.serviceLocator.getService(kl),t=this.ribbon.items.length-1;this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)}},{key:"createRibbon",value:function(e){var t=this.parent.createElement("div",{id:"".concat(this.parent.element.id,"_ribbon")});if(this.ribbon=new Fo({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e&&e.uiUpdate){var i=this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel");this.parent.element.insertBefore(t,i)}else this.parent.element.appendChild(t);this.ribbon.appendTo(t)}},{key:"tabSelecting",value:function(e){e.selectingIndex!==this.ribbon.selectedTab&&(this.refreshRibbonContent(e.selectingIndex),this.parent.notify("tabSwitch",{activeTab:e.selectingIndex}))}},{key:"beforeRenderHandler",value:function(e){var t=this.parent.serviceLocator.getService(kl);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")}},{key:"getChartThemeDDB",value:function(e){var t=this,i=this.parent.createElement("button",{id:e+"_chart_theme"});return i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Material"})),this.chartThemeDDB=new S.b({items:this.getChartThemeDdbItems(),content:"",select:function(e){return t.chartThemeDDBSelect(e)},close:function(){return t.parent.element.focus()},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.chartThemeDDB.createElement=this.parent.createElement,this.chartThemeDDB.appendTo(i),i}},{key:"getNumFormatDDB",value:function(e){var t=this,i=this.parent.createElement("button",{id:e+"_number_format"});return i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new S.b({items:this.getNumFormatDdbItems(e),content:"",select:function(e){return t.numDDBSelect(e)},open:function(e){return t.numDDBOpen(e)},beforeItemRender:function(e){return t.previewNumFormat(e)},close:function(){return ao(t.parent.element)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(i),i}},{key:"getFontSizeDDB",value:function(e){var t=this;return this.fontSizeDdb=new S.b({cssClass:"e-font-size-ddb",content:"11",items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var i={style:{fontSize:"".concat(e.item.text,"pt")},onActionUpdate:!0};t.parent.notify(dr,i),i.cancel||(t.fontSizeDdb.content=i.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind())},close:function(){return ao(t.parent.element)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size"})),this.fontSizeDdb.element}},{key:"getChartDDB",value:function(e,t){var i=this,n=this.parent.serviceLocator.getService(kl);this.chartMenu=new v.d({cssClass:t?"e-chart-menu":"e-chart-type-menu",items:[{iconCss:"e-icons e-column",text:n.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:n.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:n.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:n.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:n.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:n.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===n.getConstant("Column")?(e.element.firstChild.appendChild(r),e.element.parentElement.classList.add("e-column-chart")):e.parentItem.text===n.getConstant("Bar")?(e.element.firstChild.appendChild(g),e.element.parentElement.classList.add("e-bar-chart")):e.parentItem.text===n.getConstant("Area")?(e.element.firstChild.appendChild(R),e.element.parentElement.classList.add("e-area-chart")):e.parentItem.text===n.getConstant("Line")?(e.element.firstChild.appendChild(D),e.element.parentElement.classList.add("e-line-chart")):e.parentItem.text===n.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(H),e.element.parentElement.classList.add("e-pie-doughnut-chart")):e.parentItem.text===n.getConstant("Radar")?(e.element.firstChild.appendChild(q),e.element.parentElement.classList.add("e-radar-chart")):e.parentItem.text===n.getConstant("Scatter")&&(e.element.firstChild.appendChild(X),e.element.parentElement.classList.add("e-scatter-chart"))},select:this.chartSelected.bind(this)}),this.chartMenu.createElement=this.parent.createElement;var r=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),a=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:n.getConstant("Column")}),s=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),o=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});r.appendChild(a),r.appendChild(s);var l=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),h=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),c=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),d=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),u=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),p=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});l.title=n.getConstant("ClusteredColumn"),h.title=n.getConstant("StackedColumn"),c.title=n.getConstant("StackedColumn100"),p.title=n.getConstant("OrangeDataBar"),u.title=n.getConstant("LightblueDataBar"),d.title=n.getConstant("PurpleDataBar"),s.appendChild(l),s.appendChild(h),s.appendChild(c),o.appendChild(d),o.appendChild(u),o.appendChild(p);var g=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),m=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:n.getConstant("Bar")}),y=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),b=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});g.appendChild(m),g.appendChild(y);var C=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),x=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),w=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),k=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),I=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),O=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});C.title=n.getConstant("ClusteredBar"),x.title=n.getConstant("StackedBar"),w.title=n.getConstant("StackedBar100"),O.title=n.getConstant("OrangeDataBar"),I.title=n.getConstant("LightblueDataBar"),k.title=n.getConstant("PurpleDataBar"),y.appendChild(C),y.appendChild(x),y.appendChild(w),b.appendChild(k),b.appendChild(I),b.appendChild(O);var R=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),A=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:n.getConstant("Area")}),E=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});R.appendChild(A),R.appendChild(E);var L=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),T=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),j=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});L.title=n.getConstant("Area"),T.title=n.getConstant("StackedArea"),j.title=n.getConstant("StackedArea100"),E.appendChild(L),E.appendChild(T),E.appendChild(j);var D=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),M=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:n.getConstant("Line")}),F=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});D.appendChild(M),D.appendChild(F);var P=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),N=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),B=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});P.title=n.getConstant("Line"),N.title=n.getConstant("StackedLine"),B.title=n.getConstant("StackedLine100"),F.appendChild(P),F.appendChild(N),F.appendChild(B);var H=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),_=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:n.getConstant("Pie")}),z=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});H.appendChild(_),H.appendChild(z);var V=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),U=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});V.title=n.getConstant("Pie"),U.title=n.getConstant("Doughnut"),z.appendChild(V),z.appendChild(U);var q=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),W=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),Z=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});q.appendChild(W),q.appendChild(Z);var G=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),Y=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});G.title=n.getConstant("BlueDataBar"),Y.title=n.getConstant("GreenDataBar"),Z.appendChild(G),Z.appendChild(Y);var X=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),K=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:n.getConstant("Scatter")}),J=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});X.appendChild(K),X.appendChild(J);var Q=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});Q.title=n.getConstant("Scatter"),J.appendChild(Q);var $=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+(t?"_chart_menu":"_chart_type_menu"),styles:"display: none;"}));this.chartMenu.appendTo($),$.classList.add("e-ul");var ee,te=t?"e-chart-ddb":"e-chart-type-ddb",ie=t?e+"_chart-btn":e+"_chart-type-btn";return this.chartDdb=new S.b({iconCss:"e-icons "+(t?"e-chart-icon":"e-chart-type-icon"),cssClass:te,target:this.chartMenu.element.parentElement,created:function(){i.chartMenu.element.style.display=""},beforeClose:function(e){e.event&&Object(f.D)(e.event.target,"."+te)&&Object(f.D)(e.event.target,"."+te).id!==ie&&(e.cancel=!0)},close:function(){return ao(i.parent.element)}}),this.chartDdb.createElement=this.parent.createElement,t?(ee=this.parent.createElement("button",{id:ie})).appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:n.getConstant("Chart")})):(ee=this.parent.createElement("button",{id:ie})).appendChild(this.parent.createElement("span",{id:e+"_chart_type",innerHTML:n.getConstant("ChartType")})),this.chartDdb.appendTo(ee),this.chartDdb.element}},{key:"getAddChartEleDBB",value:function(e){var t=this,i=this.parent.serviceLocator.getService(kl);this.addChartMenu=new v.d({cssClass:"e-addchart-menu",title:i.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:i.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:i.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:i.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:i.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:i.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:i.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:i.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:i.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:i.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",text:i.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:i.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:i.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:i.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:i.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:i.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:i.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:i.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:i.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:i.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:i.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:i.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:i.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:i.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:i.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:i.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:i.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this)});var n=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_add_chart_menu",styles:"display: none;"}));this.addChartMenu.appendTo(n),n.classList.add("e-ul"),this.addChartDdb=new S.b({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:this.addChartMenu.element.parentElement,created:function(){t.addChartMenu.element.style.display=""},beforeClose:function(t){t.event&&Object(f.D)(t.event.target,".e-addchart-ddb")&&Object(f.D)(t.event.target,".e-addchart-ddb").id!==e+"_addchart"&&(t.cancel=!0)},close:function(){return t.parent.element.focus()}}),this.addChartDdb.createElement=this.parent.createElement;var r=this.parent.createElement("button",{id:e+"_addchart"});return r.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:i.getConstant("AddChartElement")})),this.addChartDdb.appendTo(r),this.addChartDdb.element}},{key:"getCFDBB",value:function(e){var t=this,i=this.parent.serviceLocator.getService(kl);this.cFMenu=new v.d({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:i.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan",text:i.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan",text:i.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between",text:i.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto",text:i.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textthatcontains",text:i.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring",text:i.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues",text:i.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:i.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items",text:i.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10",text:i.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items",text:i.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10",text:i.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage",text:i.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage",text:i.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:i.getConstant("DataBars"),items:[{id:"cf_databars"}]},{iconCss:"e-icons e-colorscales",text:i.getConstant("ColorScales"),items:[{id:"cf_colorscales"}]},{iconCss:"e-icons e-iconsets",text:i.getConstant("IconSets"),items:[{id:"cf_iconsets"}]},{iconCss:"e-icons e-clearrules",text:i.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:i.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:i.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===i.getConstant("DataBars")?(e.element.firstChild.appendChild(n),e.element.parentElement.classList.add("e-databars")):e.parentItem.text===i.getConstant("ColorScales")?(e.element.firstChild.appendChild(u),e.element.parentElement.classList.add("e-colorscales")):e.parentItem.text===i.getConstant("IconSets")&&(e.element.firstChild.appendChild(L),e.element.parentElement.classList.add("e-iconsets"))},select:this.cFSelected.bind(this)});var n=this.parent.createElement("div",{id:"db",className:"e-db"}),r=this.parent.createElement("div",{id:"db1",className:"e-db1"}),a=this.parent.createElement("div",{id:"db2",className:"e-db2"});n.appendChild(r),n.appendChild(a);var s=this.parent.createElement("span",{id:"BlueDataBar",className:"e-bdatabar e-databar-icon"}),o=this.parent.createElement("span",{id:"GreenDataBar",className:"e-gdatabar e-databar-icon"}),l=this.parent.createElement("span",{id:"RedDataBar",className:"e-rdatabar e-databar-icon"}),h=this.parent.createElement("span",{id:"OrangeDataBar",className:"e-odatabar e-databar-icon"}),c=this.parent.createElement("span",{id:"LightBlueDataBar",className:"e-lbdatabar e-databar-icon"}),d=this.parent.createElement("span",{id:"PurpleDataBar",className:"e-pdatabar e-databar-icon"});s.title=i.getConstant("BlueDataBar"),o.title=i.getConstant("GreenDataBar"),l.title=i.getConstant("RedDataBar"),h.title=i.getConstant("OrangeDataBar"),c.title=i.getConstant("LightblueDataBar"),d.title=i.getConstant("PurpleDataBar"),r.appendChild(s),r.appendChild(o),r.appendChild(l),a.appendChild(h),a.appendChild(c),a.appendChild(d),this.cFMenu.createElement=this.parent.createElement;var u=this.parent.createElement("div",{id:"db",className:"e-cs"}),p=this.parent.createElement("div",{id:"cs1",className:"e-cs1"}),g=this.parent.createElement("div",{id:"cs2",className:"e-cs2"}),f=this.parent.createElement("div",{id:"cs3",className:"e-cs3"});u.appendChild(p),u.appendChild(g),u.appendChild(f);var m=this.parent.createElement("span",{id:"GYRColorScale",className:"e-gyr e-colorscale-icon"}),y=this.parent.createElement("span",{id:"RYGColorScale",className:"e-ryg e-colorscale-icon"}),b=this.parent.createElement("span",{id:"GWRColorScale",className:"e-gwr e-colorscale-icon"}),C=this.parent.createElement("span",{id:"RWGColorScale",className:"e-rwg e-colorscale-icon"}),x=this.parent.createElement("span",{id:"BWRColorScale",className:"e-bwr e-colorscale-icon"}),w=this.parent.createElement("span",{id:"RWBColorScale",className:"e-rwb e-colorscale-icon"}),k=this.parent.createElement("span",{id:"WRColorScale",className:"e-wr e-colorscale-icon"}),I=this.parent.createElement("span",{id:"RWColorScale",className:"e-rw e-colorscale-icon"}),O=this.parent.createElement("span",{id:"GWColorScale",className:"e-gw e-colorscale-icon"}),R=this.parent.createElement("span",{id:"WGColorScale",className:"e-wg e-colorscale-icon"}),A=this.parent.createElement("span",{id:"GYColorScale",className:"e-gy e-colorscale-icon"}),E=this.parent.createElement("span",{id:"YGColorScale",className:"e-yg e-colorscale-icon"});m.title=i.getConstant("GYRColorScale"),y.title=i.getConstant("RYGColorScale"),b.title=i.getConstant("GWRColorScale"),C.title=i.getConstant("RWGColorScale"),x.title=i.getConstant("BWRColorScale"),w.title=i.getConstant("RWBColorScale"),k.title=i.getConstant("WRColorScale"),I.title=i.getConstant("RWColorScale"),O.title=i.getConstant("GWColorScale"),R.title=i.getConstant("WGColorScale"),A.title=i.getConstant("GYColorScale"),E.title=i.getConstant("YGColorScale"),p.appendChild(m),p.appendChild(y),p.appendChild(b),p.appendChild(C),g.appendChild(x),g.appendChild(w),g.appendChild(k),g.appendChild(I),f.appendChild(O),f.appendChild(R),f.appendChild(A),f.appendChild(E);var L=this.parent.createElement("div",{id:"is",className:"e-is"}),T=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),j=this.parent.createElement("div",{id:"is2",className:"e-is2"}),D=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),M=this.parent.createElement("div",{id:"is4",className:"e-is4"}),F=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),P=this.parent.createElement("div",{id:"is6",className:"e-is6"}),N=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),B=this.parent.createElement("div",{id:"is8",className:"e-is8"});T.title=i.getConstant("GYColorScale"),j.title=i.getConstant("YGColorScale"),D.title=i.getConstant("GYColorScale"),M.title=i.getConstant("YGColorScale"),F.title=i.getConstant("GYColorScale"),P.title=i.getConstant("YGColorScale"),N.title=i.getConstant("GYColorScale"),B.title=i.getConstant("YGColorScale"),L.appendChild(T),L.appendChild(j),L.appendChild(D),L.appendChild(M),L.appendChild(F),L.appendChild(P),L.appendChild(N),L.appendChild(B);var H=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),_=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),z=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),V=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),U=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),q=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),W=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});H.title=i.getConstant("ThreeArrowsColor"),_.title=i.getConstant("ThreeArrowsGray"),z.title=i.getConstant("ThreeTriangles"),V.title=i.getConstant("FourArrowsColor"),U.title=i.getConstant("FourArrowsGray"),q.title=i.getConstant("FiveArrowsColor"),W.title=i.getConstant("FiveArrowsGray"),j.appendChild(H),j.appendChild(_),j.appendChild(z),j.appendChild(V),j.appendChild(U),j.appendChild(q),j.appendChild(W);var Z=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),G=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),Y=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),X=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),K=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});Z.title=i.getConstant("ThreeTrafficLights1"),G.title=i.getConstant("ThreeTrafficLights2"),Y.title=i.getConstant("ThreeSigns"),X.title=i.getConstant("FourTrafficLights"),K.title=i.getConstant("RedToBlack"),M.appendChild(Z),M.appendChild(G),M.appendChild(Y),M.appendChild(X),M.appendChild(K);var J=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),Q=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),$=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});J.title=i.getConstant("ThreeSymbols1"),Q.title=i.getConstant("ThreeSymbols2"),$.title=i.getConstant("ThreeFlags"),P.appendChild(J),P.appendChild(Q),P.appendChild($);var ee=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),te=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),ie=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),ne=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),re=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});ee.title=i.getConstant("ThreeStars"),te.title=i.getConstant("FourRatings"),ie.title=i.getConstant("FiveQuarters"),ne.title=i.getConstant("FiveRatings"),re.title=i.getConstant("FiveBoxes"),B.appendChild(ee),B.appendChild(te),B.appendChild(ie),B.appendChild(ne),B.appendChild(re),H.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),H.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),H.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),_.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),_.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),_.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),z.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),z.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),z.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),q.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),W.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),W.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),W.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),W.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),W.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),G.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),G.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),G.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),Y.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),Y.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),X.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),X.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),X.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),X.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),K.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),K.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),K.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),K.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),J.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),J.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),J.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),$.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),$.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),$.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),ee.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),ee.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),ee.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),te.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),te.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),te.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),te.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),ie.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),ne.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan"));var ae=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_cf_menu",styles:"display: none;"}));return this.cFMenu.appendTo(ae),ae.classList.add("e-ul"),this.cFDdb=new S.b({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:this.cFMenu.element.parentElement,created:function(){t.cFMenu.element.style.display=""},close:function(){return ao(t.parent.element)}}),this.cFDdb.createElement=this.parent.createElement,this.cFDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting"})),this.cFDdb.element}},{key:"createElement",value:function(e,t){return this.parent.createElement(e,{className:t})}},{key:"getBordersDBB",value:function(e){var t,i=this,n=this.parent.serviceLocator.getService(kl);this.bordersMenu=new v.d({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:n.getConstant("TopBorders")},{iconCss:"e-icons e-left-borders",text:n.getConstant("LeftBorders")},{iconCss:"e-icons e-right-borders",text:n.getConstant("RightBorders")},{iconCss:"e-icons e-bottom-borders",text:n.getConstant("BottomBorders")},{iconCss:"e-icons e-all-borders",text:n.getConstant("AllBorders")},{iconCss:"e-icons e-horizontal-borders",text:n.getConstant("HorizontalBorders")},{iconCss:"e-icons e-vertical-borders",text:n.getConstant("VerticalBorders")},{iconCss:"e-icons e-outside-borders",text:n.getConstant("OutsideBorders")},{iconCss:"e-icons e-inside-borders",text:n.getConstant("InsideBorders")},{iconCss:"e-icons e-no-borders",text:n.getConstant("NoBorders")},{separator:!0},{text:n.getConstant("BorderColor"),items:[{id:"".concat(e,"_border_colors")}]},{text:n.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:"".concat(e,"_1px")},{id:"".concat(e,"_2px")},{id:"".concat(e,"_3px")},{id:"".concat(e,"_dashed")},{id:"".concat(e,"_dotted")},{id:"".concat(e,"_double")}]}],orientation:"Vertical",beforeOpen:function(e){"Border Color"===e.parentItem.text?(i.colorPicker.refresh(),t=i.colorPicker.element.parentElement,e.element.firstElementChild.appendChild(t),t.style.display="inline-block",e.element.parentElement.classList.add("e-border-color")):e.element.classList.add("e-border-style")},beforeClose:function(e){"Border Color"===e.parentItem.text&&(!Object(f.D)(e.event.target,".e-border-colorpicker")||Object(f.D)(e.event.target,".e-apply")||Object(f.D)(e.event.target,".e-cancel")?(i.colorPicker=Object(f.N)(i.cPickerEle,"colorpicker"),"Picker"===i.colorPicker.mode&&(i.colorPicker.mode="Palette",i.colorPicker.dataBind()),t.style.display="",i.parent.element.appendChild(t)):e.cancel=!0)},onOpen:function(e){"Border Color"===e.parentItem.text&&(e.element.parentElement.style.overflow="visible")},select:this.borderSelected.bind(this)}),this.bordersMenu.createElement=this.parent.createElement;var r=this.parent.element.appendChild(this.parent.createElement("ul",{id:e+"_borders_menu",styles:"display: none;"}));return this.bordersMenu.appendTo(r),r.classList.add("e-ul"),this.cPickerEle=this.parent.createElement("input",{id:"".concat(e,"_cell_border_color"),attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new y.a({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:function(e){var t=i.border.split(" ");t[2]=e.currentValue.hex,i.border=t.join(" ")},created:function(){t=i.colorPicker.element.parentElement}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle),this.bordersDdb=new S.b({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:this.bordersMenu.element.parentElement,created:function(){i.bordersMenu.element.style.display=""},beforeOpen:function(e){return i.tBarDdbBeforeOpen(e.element.firstElementChild,i.bordersMenu.items,1)},beforeClose:function(e){e.event&&Object(f.D)(e.event.target,".e-borders-menu")&&(e.cancel=!0)},close:function(){return ao(i.parent.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders"})),this.bordersDdb.element}},{key:"chartSelected",value:function(e){var t=!Object(f.Z)(Object(f.D)(e.element,".e-chart-menu")),i=e.element.id;"column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)&&this.parent.notify("insertChart",{action:i,id:e.event.target.id,isChart:t})}},{key:"addChartEleSelected",value:function(e){this.parent.notify("chartDesignTab",{addChartEle:e.element.id})}},{key:"cFSelected",value:function(e){var t=e.element.id;if("cf_greaterthancf_lessthancf_betweencf_eqaultocf_textthatcontainscf_adateoccuringcf_duplicatevaluescf_top10itemscf_top10cf_bottom10itemscf_bottom10cf_aboveaveragecf_belowaverage".includes(t))this.parent.notify("initiateConditionalFormat",{action:e.item.text});else if("cf_databarscf_colorscales".includes(t))this.parent.notify("setCF",{action:t,id:e.event.target.id});else if("cf_iconsets"===e.element.id){var i=e.event.target;this.parent.notify("setCF",{action:t,id:""===i.id?i.parentElement.id:i.id})}if("cf_cr_cells"===t)this.parent.notify("clearCFRule",{range:this.parent.getActiveSheet().selectedRange,isPublic:!1});else if("cf_cr_sheet"===t){var n=this.parent.getActiveSheet(),r=Xn([0,0,n.rowCount-1,n.colCount-1]);this.parent.conditionalFormat=null,this.parent.notify("clearCFRule",{range:r,isPublic:!1})}}},{key:"borderSelected",value:function(e){if(!e.item.items.length&&e.item.id!=="".concat(this.parent.element.id,"_border_colors")){if(!e.item.text){var t=this.parent.element.id,i=this.border.split(" "),n="solid"===i[1]?"".concat(t,"_").concat(i[0]):"".concat(t,"_").concat(i[1]);if(n===e.item.id)return;return e.item.id==="".concat(t,"_1px")||e.item.id==="".concat(t,"_2px")||e.item.id==="".concat(t,"_3px")?(i[0]=e.item.id.split("".concat(t,"_"))[1],i[1]="solid"):(i[1]=e.item.id.split("".concat(t,"_"))[1],i[0]="double"===i[1]?"3px":"1px"),this.border=i.join(" "),this.bordersMenu.items[12].items.forEach(function(t){t.id===n&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")}),void this.bordersMenu.setProperties({items:this.bordersMenu.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.text){case"Top Borders":this.parent.notify(dr,{style:{borderTop:this.border},onActionUpdate:!0});break;case"Left Borders":this.parent.notify(dr,{style:{borderLeft:this.border},onActionUpdate:!0});break;case"Right Borders":this.parent.notify(dr,{style:{borderRight:this.border},onActionUpdate:!0});break;case"Bottom Borders":this.parent.notify(dr,{style:{borderBottom:this.border},onActionUpdate:!0});break;case"All Borders":this.parent.notify(dr,{style:{border:this.border},onActionUpdate:!0});break;case"Horizontal Borders":this.parent.notify(dr,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case"Vertical Borders":this.parent.notify(dr,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case"Outside Borders":this.parent.notify(dr,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case"Inside Borders":this.parent.notify(dr,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case"No Borders":this.parent.notify(dr,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}}},{key:"getFontNameDDB",value:function(e){var t=this,i=this.parent.createElement("button",{id:e+"_font_name"});return i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new S.b({cssClass:"e-font-family",items:this.getFontFamilyItems(),select:function(e){var i={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(dr,i),i.cancel||t.refreshFontNameSelection(i.style.fontFamily)},close:function(){return ao(t.parent.element)},beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(i),i}},{key:"getBtn",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=new b.a({iconCss:"e-icons e-".concat(t,"-icon"),isToggle:!0});return n.createElement=this.parent.createElement,n.appendTo(this.parent.createElement("button",{id:"".concat(e,"_").concat(t)})),i&&n.element.addEventListener("click",this.toggleBtnClicked.bind(this)),n.element}},{key:"datavalidationDDB",value:function(e){var t,i=this,n=this.parent.serviceLocator.getService(kl);return this.datavalidationDdb=new S.b({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",items:[{text:n.getConstant("DataValidation")},{text:n.getConstant("HighlightInvalidData")},{text:n.getConstant("ClearHighlight")},{text:n.getConstant("ClearValidation")}],beforeOpen:function(e){i.refreshSelected(i.datavalidationDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case n.getConstant("DataValidation"):i.parent.notify("initiatedatavalidation",null);break;case n.getConstant("HighlightInvalidData"):i.parent.notify("invalidData",{isRemoveHighlight:!1});break;case n.getConstant("ClearHighlight"):i.parent.notify("invalidData",{isRemoveHighlight:!0});break;case n.getConstant("ClearValidation"):i.parent.notify("removeDataValidation",null);break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",i.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}}})}},close:function(){return ao(i.parent.element)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation"})),this.datavalidationDdb.element}},{key:"getTextAlignDDB",value:function(e){var t=this;return this.textAlignDdb=new S.b({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss")},select:function(e){var i={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(dr,i),i.cancel||(t.textAlignDdb.iconCss="e-icons e-".concat(i.style.textAlign,"-icon"),t.textAlignDdb.dataBind())},close:function(){return ao(t.parent.element)}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align"})),this.textAlignDdb.element}},{key:"getVerticalAlignDDB",value:function(e){var t=this;return this.verticalAlignDdb=new S.b({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss")},select:function(e){var i={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(dr,i),i.cancel||(t.verticalAlignDdb.iconCss="e-icons e-".concat(i.style.verticalAlign,"-icon"),t.verticalAlignDdb.dataBind())},close:function(){return ao(t.parent.element)}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align"})),this.verticalAlignDdb.element}},{key:"getMergeSplitBtn",value:function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge"}));var i=this.parent.serviceLocator.getService(kl);return this.mergeSplitBtn=new S.c({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",items:[{text:i.getConstant("MergeAll"),id:"".concat(e,"_merge_all")},{text:i.getConstant("MergeHorizontally"),id:"".concat(e,"_merge_horizontally")},{text:i.getConstant("MergeVertically"),id:"".concat(e,"_merge_vertically")},{separator:!0,id:"".concat(e,"_merge_separator")},{text:i.getConstant("Unmerge"),id:"".concat(e,"_unmerge")}],select:this.mergeSelectHandler.bind(this),close:function(){return ao(t.parent.element)},click:function(e){e.element.classList.contains("e-active")?(t.toggleActiveState(!1),t.unMerge()):(t.toggleActiveState(!0),t.merge("".concat(t.parent.element.id,"_merge_all")))},created:function(){t.mergeSplitBtn.element.title=i.getConstant("MergeCells"),t.mergeSplitBtn.element.nextElementSibling.title=i.getConstant("SelectMergeType")}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement}},{key:"mergeSelectHandler",value:function(e){e.item.id==="".concat(this.parent.element.id,"_unmerge")?this.unMerge():this.merge(e.item.id)}},{key:"unMerge",value:function(){this.parent.showSpinner(),this.parent.notify(fr,{merge:!1,range:this.parent.getActiveSheet().selectedRange,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()}},{key:"merge",value:function(e){for(var t,i,n=this,r=this.parent.getActiveSheet(),a=Wn(r.selectedRange),s=a[0];s<=a[2];s++)for(var o=a[1];o<=a[3];o++)s===a[0]&&o===a[1]&&e.includes("merge_all")||s===a[0]&&e.includes("merge_vertically")||o===a[1]&&e.includes("_merge_horizontally")||((t=Da(s,o,r)||{}).value||t.formula)&&(i=!0);if(i){var l=this.parent.serviceLocator.getService(Il);l.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(kl).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),ao(n.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(kl).getConstant("Ok"),isPrimary:!0},click:function(){l.hide(),n.performMerge(e)}}]})}else this.performMerge(e)}},{key:"performMerge",value:function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case"".concat(t,"_merge_all"):this.parent.notify(fr,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case"".concat(t,"_merge_horizontally"):this.parent.notify(fr,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case"".concat(t,"_merge_vertically"):this.parent.notify(fr,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()}},{key:"getSortFilterDDB",value:function(e){var t,i=this,n=this.parent.serviceLocator.getService(kl);return this.sortingDdb=new S.b({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:n.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:n.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:n.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:n.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:n.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:n.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],beforeItemRender:function(t){var n={isFiltered:!1,isClearAll:!0};if(i.parent.notify("getFilteredColumn",n),t.item.id===e+"_clearfilter"||t.item.id===e+"_reapplyfilter")n.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled");else if(t.item.id===e+"_applyfilter"){var r=i.parent.getActiveSheet();(r.frozenColumns||r.frozenRows)&&t.element.classList.add("e-disabled")}},beforeOpen:function(e){i.refreshSelected(i.sortingDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case n.getConstant("Filter"):i.parent.applyFilter();break;case n.getConstant("ClearAllFilter"):i.parent.clearFilter();break;case n.getConstant("ReapplyFilter"):i.parent.notify("reapplyFilter",null);break;case n.getConstant("CustomSort")+"...":i.parent.notify("initiateCustomSort",null);break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",i.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}}})}},close:function(){return ao(i.parent.element)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting"})),this.sortingDdb.element}},{key:"getFindDDb",value:function(e){var t=this,i=this.parent.createElement("button",{id:e+"_findbtn"});return this.findDdb=new b.a({cssClass:"e-spreadsheet-find-ddb e-caret-hide",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(i),i.onclick=function(){t.findToolDlg()},this.findDdb.element}},{key:"findToolDlg",value:function(){var e,t=this;if(Object(f.Z)(this.parent.element.querySelector(".e-findtool-dlg"))){var i,n=this.parent.createElement("div",{className:"e-input-group"}),r=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text",value:this.findValue}}),a=this.parent.serviceLocator.getService(kl);r.setAttribute("placeholder",a.getConstant("FindValue"));var s=this.parent.createElement("span",{className:"e-input-group-icon"});r.onkeyup=function(){e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),s.textContent=e.findCount;var n=document.querySelector(".e-text-findNext-short").value,r=document.querySelector(".e-findRib-next"),a=document.querySelector(".e-findRib-prev");Object(f.Z)(n)||""===n||"0 of 0"===e.findCount?(i.enableItems(r,!1),i.enableItems(a,!1),s.textContent="0 of 0"):Object(f.Z)(n)&&"0 of 0"===e.findCount||(i.enableItems(r,!0),i.enableItems(a,!0))},r.onkeydown=function(i){e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),t.findOnKeyDown(i,e.findCount)},n.appendChild(r),n.appendChild(s),i=new v.h({clicked:function(i){"e-findRib-next"===i.item.cssClass?(t.parent.notify("findHandler",{findOption:"next"}),e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),s.textContent=e.findCount):"e-findRib-prev"===i.item.cssClass?(t.parent.notify("findHandler",{findOption:"prev"}),e={countOpt:"count",findCount:""},t.parent.notify("findHandler",{countArgs:e}),s.textContent=e.findCount):"e-findRib-more"===i.item.cssClass&&(t.parent.notify(Lr,null),t.findDialog.hide())},width:"auto",height:"auto",items:[{type:"Input",template:n},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}],cssClass:"e-find-toolObj"});var o=this.parent.createElement("div",{className:"e-find-toolbar"}),l=this.parent.createElement("div",{className:"e-dlg-div"});this.findDialog=new w.a({isModal:!1,showCloseIcon:!1,cssClass:"e-findtool-dlg",content:o,visible:!1,allowDragging:!0,target:this.parent.element.querySelector(".e-sheet"),beforeOpen:function(){f.l.add(document,"click",t.closeDialog,t)},open:function(){t.textFocus(i.element)},beforeClose:function(){t.findValue=t.parent.element.querySelector(".e-text-findNext-short").value,i.destroy();var e=document.querySelector(".e-find-toolbar");e&&f.l.remove(e,"focus",t.textFocus),f.l.remove(document,"click",t.closeDialog),ao(t.parent.element)},created:function(){i.createElement=t.parent.createElement,i.appendTo(o),t.findDialog.width=getComputedStyle(document.querySelector(".e-findtool-dlg")).width;var e=t.parent.element.querySelector(".e-main-panel").getBoundingClientRect(),n=t.findDialog.width.toString();t.findDialog.position={X:e.width-parseInt(n,10)-(t.parent.allowScrolling?ws():0),Y:t.parent.getActiveSheet().showHeaders?31:0},t.findDialog.dataBind(),t.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(l)}else Object(f.Z)(this.parent.element.querySelector(".e-findtool-dlg"))||(this.findDialog.hide(),Object(f.J)(this.parent.element.querySelector(".e-findtool-dlg")),this.findDialog=null,ao(this.parent.element))}},{key:"findOnKeyDown",value:function(e,t){document.querySelector(".e-text-findNext-short").value&&"0 of 0"!==t&&(e.shiftKey?13===e.keyCode&&this.parent.notify("findHandler",{findOption:"prev"}):13===e.keyCode&&this.parent.notify("findHandler",{findOption:"next"}))}},{key:"closeDialog",value:function(e){if((Object(f.D)(e.target,".e-findRib-close")||!Object(f.D)(e.target,".e-spreadsheet"))&&!Object(f.Z)(this.findDialog)){this.findDialog.hide();var t=this.parent.element.querySelector(".e-findtool-dlg");t&&Object(f.J)(t),this.findDialog=null}}},{key:"textFocus",value:function(e){document.querySelector(".e-find-toolbar").addEventListener("focus",function(){var e=document.querySelector(".e-text-findNext-short");e.focus(),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)})}},{key:"getClearDDB",value:function(e){var t=this,i=this.parent.serviceLocator.getService(kl);return this.clearDdb=new S.b({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:i.getConstant("ClearAll")},{text:i.getConstant("ClearFormats")},{text:i.getConstant("ClearContents")},{text:i.getConstant("ClearHyperlinks")}],select:function(e){t.parent.notify("clearViewer",{options:{type:e.item.text}})},close:function(){return ao(t.parent.element)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear"})),this.clearDdb.element}},{key:"ribbonCreated",value:function(){this.ribbon.element.querySelector(".e-drop-icon").title=this.parent.serviceLocator.getService(kl).getConstant("CollapseToolbar")}},{key:"alignItemRender",value:function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];t=t[0].toUpperCase()+t.slice(1,t.length),e.element.title=this.parent.serviceLocator.getService(kl).getConstant("Align"+t)}},{key:"toggleBtnClicked",value:function(e){var t,i,n,r,a,s=Object(f.D)(e.target,".e-btn"),o=this.parent.element.id,l=dr;switch(s.id){case"".concat(o,"_bold"):i={fontWeight:"normal"},n={fontWeight:"bold"},a="fontWeight";break;case"".concat(o,"_italic"):i={fontStyle:"normal"},n={fontStyle:"italic"},a="fontStyle";break;case"".concat(o,"_line-through"):l="textDecorationUpdate",n=i={textDecoration:"line-through"},a="textDecoration";break;case"".concat(o,"_underline"):l="textDecorationUpdate",n=i={textDecoration:"underline"},a="textDecoration"}s.classList.contains("e-active")?(t=n[a],r={style:n,onActionUpdate:!0},this.parent.notify(l,r),r.cancel&&s.classList.remove("e-active")):(t=i[a],r={style:i,onActionUpdate:!0},this.parent.notify(l,r),r.cancel&&s.classList.add("e-active")),r.cancel||t===r.style[a]||this.refreshToggleBtn(Zn(this.parent.getActiveSheet().activeCell)),ao(this.parent.element)}},{key:"getCellStyleValue",value:function(e,t){var i=Da(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[e];return i&&i.style&&i.style[e]&&(n=i.style[e]),n}},{key:"refreshSelected",value:function(e,t,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i,r=0;r<e.items.length;r++)if(e.items[r][n]===e[i]){t.children[r].classList.add("e-selected");break}}},{key:"expandCollapseHandler",value:function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),i=this.parent.serviceLocator.getService(kl);t.title=i.getConstant(e.expanded?"CollapseToolbar":"ExpandToolbar"),this.parent.setPanelSize()}},{key:"getChartThemeDdbItems",value:function(){var e=this.parent.serviceLocator.getService(kl);return[{id:"Material",text:e.getConstant("Material")},{id:"Fabric",text:e.getConstant("Fabric")},{id:"Bootstrap",text:e.getConstant("Bootstrap")},{id:"HighContrastLight",text:e.getConstant("HighContrastLight")},{id:"MaterialDark",text:e.getConstant("MaterialDark")},{id:"FabricDark",text:e.getConstant("FabricDark")},{id:"HighContrast",text:e.getConstant("HighContrast")},{id:"BootstrapDark",text:e.getConstant("BootstrapDark")},{id:"Bootstrap4",text:e.getConstant("Bootstrap4")}]}},{key:"getNumFormatDdbItems",value:function(e){var t=this.parent.serviceLocator.getService(kl);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")}]}},{key:"getFontFamilyItems",value:function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]}},{key:"numDDBSelect",value:function(e){var t={format:yr(e.item.id.split(this.parent.element.id+"_")[1]),range:this.parent.getActiveSheet().selectedRange,cancel:!1,requestType:"NumberFormat"},i={range:this.parent.getActiveSheet().name+"!"+t.range,format:t.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",t),this.parent.notify(Ar,{eventArgs:t,action:"format"}),t.cancel||(this.parent.notify("applyNumber",t),this.parent.notify("selectionComplete",{type:"mousedown"}),this.refreshNumFormatSelection(e.item.text),this.parent.notify(Rr,{eventArgs:i,action:"format"}))}},{key:"chartThemeDDBSelect",value:function(e){this.parent.notify("selectionComplete",{type:"mousedown"}),this.refreshChartThemeSelection(e.item.id),this.parent.notify("chartDesignTab",{chartTheme:e.item.id})}},{key:"tBarDdbBeforeOpen",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.parent.viewport.height,r=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-i)+2*parseInt(getComputedStyle(e).paddingTop,10);if(i){var a=getComputedStyle(e.querySelector(".e-separator"));r+=i*(parseInt(a.borderBottomWidth,10)+2*parseInt(a.marginTop,10))}r>n?(e.style.height="".concat(n,"px"),e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY="")}},{key:"numDDBOpen",value:function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),i=0,n=t.length;i<n;i++)this.numPopupWidth<t[i].offsetWidth&&(this.numPopupWidth=t[i].offsetWidth);var r=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width="".concat(r,"px")}},{key:"previewNumFormat",value:function(e){var t=Zn(this.parent.getActiveSheet().activeCell),i=Da(t[0],t[1],this.parent.getActiveSheet()),n={type:e.item.text,formattedText:"",value:i&&i.value?i.value:"",format:yr(e.item.id.split(this.parent.element.id+"_")[1]),sheetIndex:this.parent.activeSheetIndex,onLoad:!0},r=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="",this.parent.notify("getFormattedCell",n);var a=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:n.formattedText.toString()});r.appendChild(a),e.element.appendChild(r)}},{key:"refreshRibbonContent",value:function(e){if(this.ribbon){Object(f.Z)(e)&&(e=this.ribbon.selectedTab);var t=this.parent.serviceLocator.getService(kl),i=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case t.getConstant("Home"):this.refreshHomeTabContent(Zn(i.activeCell));break;case t.getConstant("Insert"):case t.getConstant("Formulas"):break;case t.getConstant("Data"):this.refreshDataTabContent(e);break;case t.getConstant("View"):this.refreshViewTabContent(e)}}}},{key:"refreshHomeTabContent",value:function(e){Object(f.Z)(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=Object(f.N)(document.getElementById(this.parent.element.id+"_number_format"),S.b));var t=this.parent.getActiveSheet(),i=Zn(this.parent.getActiveSheet().activeCell),n=this.parent.serviceLocator.getService(kl),r=Da(i[0],i[1],this.parent.getActiveSheet())||{},a=br(r.format?r.format:"General");if(this.numFormatDDB&&(t.isProtected&&!t.protectSettings.formatCells?(a="General",this.refreshNumFormatSelection(a)):this.refreshNumFormatSelection(n.getConstant(a))),this.fontNameDdb&&this.refreshFontNameSelection(t.isProtected&&!t.protectSettings.formatCells?"Calibri":this.getCellStyleValue("fontFamily",e)),this.fontSizeDdb){var s=this.getCellStyleValue("fontSize",e);t.isProtected&&!t.protectSettings.formatCells?this.fontSizeDdb.content="11":(s=s.includes("pt")?s.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=s,this.fontSizeDdb.dataBind())}if(this.textAlignDdb){var o=this.getCellStyleValue("textAlign",e);if(t.isProtected&&!t.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0===r.value||"left"!==o||"Accounting"!==a&&!hr(r.value)||(o="right");var l="e-icons e-".concat(o.toLowerCase(),"-icon");l!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=l,this.textAlignDdb.dataBind())}}if(this.verticalAlignDdb){var h="e-icons e-".concat(this.getCellStyleValue("verticalAlign",e).toLowerCase(),"-icon");t.isProtected&&!t.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":h!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=h,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!t.isProtected&&(r.rowSpan>1||r.colSpan>1))this.enableToolbarItems([{tab:n.getConstant("Home"),items:["".concat(this.parent.element.id,"_merge_cells")],enable:!0}]),this.toggleActiveState(!0);else{var c=Wn(t.selectedRange);this.enableToolbarItems([{tab:n.getConstant("Home"),items:["".concat(this.parent.element.id,"_merge_cells")],enable:c[0]!==c[2]||c[1]!==c[3]}]),this.toggleActiveState(!1)}}},{key:"toggleActiveState",value:function(e){var t=this.parent.serviceLocator.getService(kl);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))}},{key:"refreshToggleBtn",value:function(e){var t,i,n,r=this,a=this.parent.getActiveSheet(),s=this.parent.element.id,o=Da(e[0],e[1],a),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach(function(h,c){(t=document.getElementById("".concat(s,"_").concat(h)))&&(a.isProtected&&!a.protectSettings.formatCells?t.classList.remove("e-active"):"wrap"===h?n=o&&o.wrap:(i=r.getCellStyleValue(l[c],e).toLowerCase(),n=i.indexOf(h)>-1),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))})}},{key:"refreshFontNameSelection",value:function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss="")}},{key:"refreshNumFormatSelection",value:function(e){for(var t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0)}},{key:"refreshChartThemeSelection",value:function(e){if(e!==this.chartThemeDDB.items[this.chartThemeIndex].text){this.chartThemeDDB.element.firstElementChild.textContent=this.getChartThemeText(e);for(var t=0;t<this.chartThemeDDB.items.length;t++)if(this.chartThemeDDB.items[t].id===e){this.chartThemeDDB.items[t].iconCss="e-icons e-selected-icon",this.chartThemeDDB.items[this.chartThemeIndex].iconCss="",this.chartThemeDDB.setProperties({items:this.chartThemeDDB.items},!0),this.chartThemeIndex=t;break}}}},{key:"getChartThemeText",value:function(e){var t=this.parent.serviceLocator.getService(kl),i="";switch(e){case"Material":i=t.getConstant("Material");break;case"Fabric":i=t.getConstant("Fabric");break;case"Bootstrap":i=t.getConstant("Bootstrap");break;case"HighContrastLight":i=t.getConstant("HighContrastLight");break;case"MaterialDark":i=t.getConstant("MaterialDark");break;case"FabricDark":i=t.getConstant("FabricDark");break;case"HighContrast":i=t.getConstant("HighContrast");break;case"BootstrapDark":i=t.getConstant("BootstrapDark");break;case"Bootstrap4":i=t.getConstant("Bootstrap4")}return i}},{key:"fileMenuItemSelect",value:function(e){var t=this,i=Object(f.L)({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",i);var n,r=this.parent.element.id;if(!i.cancel)switch(e.item.id){case"".concat(r,"_Open"):Object(f.ob)("#"+r+"_fileUpload",this.parent.element).click();break;case"".concat(r,"_Xlsx"):case"".concat(r,"_Xls"):case"".concat(r,"_Csv"):case"".concat(r,"_Pdf"):this.parent.save({saveType:e.item.id.split("".concat(r,"_"))[1]});break;case"".concat(r,"_New"):(n=this.parent.serviceLocator.getService(Il)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(kl).getConstant("DestroyAlert"),beforeOpen:function(e){var i={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),ao(t.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(kl).getConstant("Ok"),isPrimary:!0},click:function(){t.parent.sheets.length=0,t.parent.createSheet(),n.hide(),t.parent.activeSheetIndex=t.parent.sheets.length-1,t.parent.notify("refreshSheetTabs",{}),t.parent.notify("sheetsDestroyed",{}),t.parent.renderModule.refreshSheet()}}]})}}},{key:"toolbarClicked",value:function(e){if("spreadsheet_find"!==e.item.id){var t,i,n,r,a,s=this.parent.element.id,o=this.parent.getActiveSheet();switch(e.item.id){case s+"_headers":if(t={isShow:!o.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Rr,{eventArgs:t,action:"headers"}),t.cancel)return;this.parent.setSheetPropertyOnMute(o,"showHeaders",!o.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab}),ao(this.parent.element);break;case s+"_gridlines":if(i={isShow:!o.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(Rr,{eventArgs:i,action:"gridLines"}),i.cancel)return;this.parent.setSheetPropertyOnMute(o,"showGridLines",!o.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab}),ao(this.parent.element);break;case s+"_protect":this.parent.setSheetPropertyOnMute(o,"isProtected",!o.isProtected),n=!o.isProtected,this.parent.notify("applyProtect",{isActive:n,id:s+"_protect"});break;case s+"_undo":this.parent.notify("performUndoRedo",{isUndo:!0});break;case s+"_redo":this.parent.notify("performUndoRedo",{isUndo:!1});break;case s+"_freezepanes":r=Zn(o.topLeftCell),a=o.frozenRows||o.frozenColumns?r:Zn(o.activeCell),this.parent.notify("freeze",{row:a[0]-r[0],column:a[1]-r[1],isAction:!0});break;case s+"_freezerows":this.parent.notify("freeze",{row:o.frozenRows?0:Zn(o.activeCell)[0]-Zn(o.topLeftCell)[0],column:o.frozenColumns,isAction:!0});break;case s+"_freezecolumns":this.parent.notify("freeze",{row:o.frozenRows,column:o.frozenColumns?0:Zn(o.activeCell)[1]-Zn(o.topLeftCell)[1],isAction:!0});break;case s+"_protectworkbook":this.parent.password.length>0?this.parent.notify("unProtectWorkbook",null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify("protectWorkbook",null)}this.parent.notify("ribboClick",e)}}},{key:"toggleRibbonItems",value:function(e){var t="",i=this.parent.serviceLocator.getService(kl).getConstant("View"),n=this.parent.serviceLocator.getService(kl).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if(Object(f.Z)(e.activeTab))for(var r=0,a=this.ribbon.items.length;r<a;r++)if(this.ribbon.items[r].header.text===i){e.activeTab=r;break}for(var s,o=this.getLocaleText(e.props,"GridLines"===e.props),l="".concat(this.parent.element.id,"_").concat(e.props.toLowerCase()),h=this.ribbon.items[e.activeTab].content.length;s<h;s++)"Separator"!==this.ribbon.items[e.activeTab].content[s].type&&this.ribbon.items[e.activeTab].content[s].id===l&&(this.ribbon.items[e.activeTab].content[s].text=o,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(e.props.toLowerCase(),o)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if(Object(f.Z)(e.activeTab))for(var c=0,d=this.ribbon.items.length;c<d;c++)if(this.ribbon.items[c].header.text===n){e.activeTab=c;break}var u="".concat(this.parent.element.id,"_").concat(e.props.toLowerCase());if(u===this.parent.element.id+"_protect"){var p,g=this.ribbon.items[this.ribbon.selectedTab].content.length;for(p=0;p<g&&this.ribbon.items[this.ribbon.selectedTab].content[p].id!==this.parent.element.id+"_protect";p++);t=this.getLocaleProtectText("Sheet",!0)}else if(u===this.parent.element.id+"_protectworkbook"){var m,v=this.ribbon.items[this.ribbon.selectedTab].content.length;for(m=0;m<v&&this.ribbon.items[this.ribbon.selectedTab].content[m].id!==this.parent.element.id+"_protectworkbook";m++);this.parent.isProtected||this.parent.password.length>0?t=this.getLocaleProtectWorkbook("UnProtectWorkbook"):this.parent.isProtected||(t=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(var y,b=this.ribbon.items[e.activeTab].content.length;y<b;y++)"Separator"!==this.ribbon.items[e.activeTab].content[y].type&&this.ribbon.items[e.activeTab].content[y].id===u&&(this.ribbon.items[e.activeTab].content[y].text=t,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&this.updateToggleText(e.props.toLowerCase(),t)}}},{key:"enableFileMenuItems",value:function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)}},{key:"hideRibbonTabs",value:function(e){this.ribbon.hideTabs(e.tabs,e.hide)}},{key:"addRibbonTabs",value:function(e){this.ribbon.addTabs(e.items,e.insertBefore),Object(f.ob)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(Object(f.pb)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])}},{key:"updateToggleText",value:function(e,t){var i=this;bs(function(){var n=Object(f.ob)("#".concat(i.parent.element.id,"_").concat(e," .e-tbar-btn-text"),i.ribbon.element);n&&(n.textContent=t)}),"headers"===e&&this.findDialog&&(this.findDialog.position.Y=this.parent.getActiveSheet().showHeaders?31:0,this.findDialog.dataBind())}},{key:"refreshViewTabContent",value:function(e){for(var t=this.parent.element.id,i=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(kl),r=0;r<this.ribbon.items[e].content.length;r++)"Separator"!==this.ribbon.items[e].content[r].type&&(this.ribbon.items[e].content[r].id==="".concat(t,"_headers")&&this.updateViewTabContent(e,"Headers",r),this.ribbon.items[e].content[r].id==="".concat(t,"_gridlines")&&this.updateViewTabContent(e,"GridLines",r),this.ribbon.items[e].content[r].id==="".concat(t,"_freezepanes")&&(i.frozenRows||i.frozenColumns?this.ribbon.items[e].content[r].text===n.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",r,e)):this.ribbon.items[e].content[r].text===n.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",r,e))),this.ribbon.items[e].content[r].id==="".concat(t,"_freezerows")&&(i.frozenRows?this.ribbon.items[e].content[r].text===n.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",r,e)):this.ribbon.items[e].content[r].text===n.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",r,e))),this.ribbon.items[e].content[r].id==="".concat(t,"_freezecolumns")&&(i.frozenColumns?this.ribbon.items[e].content[r].text===n.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",r,e)):this.ribbon.items[e].content[r].text===n.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",r,e))))}},{key:"updateViewTabContent",value:function(e,t,i){var n=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(kl);n["show"+t]?this.ribbon.items[e].content[i].text===r.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,i,e)):this.ribbon.items[e].content[i].text===r.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,i,e))}},{key:"updateRibbonItemText",value:function(e,t,i,n){var r=this.parent.serviceLocator.getService(kl).getConstant(e+t);return this.ribbon.items[n].content[i].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0),r}},{key:"refreshDataTabContent",value:function(e){for(var t,i=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id==="".concat(i,"_protect")){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}this.ribbon.items[e].content[n].id==="".concat(i,"_protectworkbook")&&this.updateDataTabContent(e,"Workbook",n)}}},{key:"updateDataTabContent",value:function(e,t,i){var n=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(kl);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[i].text===r.getConstant("Protect"+t)&&(this.ribbon.items[e].content[i].cssClass="e-active",this.updateProtectBtn("Unprotect",t,i,e)):this.updateProtectBtn("Protect",t,i,e);else if("Workbook"===t){var a=this.parent.serviceLocator.getService(kl);this.parent.isProtected?this.ribbon.items[e].content[i].text===a.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("UnProtect",t,i,e)):this.ribbon.items[e].content[i].text===a.getConstant("UnProtect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,i,e))}}},{key:"updateProtectBtn",value:function(e,t,i,n){var r=this.parent.serviceLocator.getService(kl).getConstant(e+t);this.ribbon.items[n].content[i].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",r)}},{key:"updateProtectWorkbookBtn",value:function(e,t,i,n){var r=this.parent.serviceLocator.getService(kl).getConstant(e);this.ribbon.items[n].content[i].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",r)}},{key:"addToolbarItems",value:function(e){this.ribbon.addToolbarItems(e.tab,e.items,e.index)}},{key:"enableToolbarItems",value:function(e){var t=this;e.forEach(function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable)})}},{key:"createMobileView",value:function(){var e=this,t=this.parent.element.id,i=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");i.appendChild(n);var r=new v.h({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(i){switch(i.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new v.d({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});r.createElement=this.parent.createElement,r.appendTo(i),this.parent.element.insertBefore(i,this.parent.element.firstElementChild),this.renderMobileToolbar()}},{key:"renderMobileToolbar",value:function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),i=this.parent.createElement("div"),n=this.parent.createElement("button");t.appendChild(i),t.appendChild(n),t.style.display="block",this.parent.element.appendChild(t);var r=new S.b({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],select:function(t){t.item.text!==r.content&&(a.element.style.display="none",r.content=t.item.text,r.dataBind(),a.items=e.ribbon.items[r.items.indexOf(t.item)+1].content,a.width="calc(100% - ".concat(n.getBoundingClientRect().width,"px)"),a.element.style.display="",a.dataBind(),a.items[0].text=t.item.text,a.dataBind())},open:function(e){var t=e.element.parentElement,i=t.getBoundingClientRect(),n=Object(w.d)(r.element,"right","bottom");t.style.left=n.left-i.width+"px",t.style.top=n.top-i.height+"px";for(var a=0;a<r.items.length;a++)if(r.content===r.items[a].text){e.element.children[a].classList.add("e-selected");break}},close:function(){return ao(e.parent.element)}});r.createElement=this.parent.createElement,r.appendTo(n);var a=new v.h({width:"calc(100% - ".concat(n.getBoundingClientRect().width,"px)"),items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});a.createElement=this.parent.createElement,a.appendTo(i),t.style.display=""}},{key:"fileMenuBeforeOpen",value:function(e){var t,i=this,n=this.parent.serviceLocator.getService(kl),r=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(e,n){t=i.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",t.appendChild(i.parent.createElement("span",{className:"e-extension",innerHTML:r[n]})),e.appendChild(t)}),this.parent.trigger("fileMenuBeforeOpen",e)}},{key:"enableRibbonTabs",value:function(e){this.ribbon.enableTabs(e.tabs,e.enable)}},{key:"fileMenuBeforeClose",value:function(e){this.parent.trigger("fileMenuBeforeClose",e)}},{key:"hideFileMenuItems",value:function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)}},{key:"addFileMenuItems",value:function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)}},{key:"hideToolbarItems",value:function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)}},{key:"protectSheetHandler",value:function(e){var t=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(kl);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.enableToolbarItems([{tab:i.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]),this.parent.notify("setUndoRedo",null)):this.enableToolbarItems([{tab:i.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),this.enableToolbarItems(t.isProtected&&t.protectSettings.insertLink||!t.isProtected?[{tab:i.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]:[{tab:i.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),this.enableToolbarItems(t.isProtected&&t.protectSettings.selectCells||!t.isProtected?[{tab:i.getConstant("Home"),items:e.findBtnId,enable:!0}]:[{tab:i.getConstant("Home"),items:e.findBtnId,enable:!1}]);var n,r=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<r&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===i.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=i.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=i.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:i.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===i.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=i.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===i.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=i.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:i.getConstant("Data"),items:e.dataValidationBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.imageBtnId,enable:!0}]),this.enableToolbarItems([{tab:i.getConstant("Insert"),items:e.chartBtnId,enable:!0}]))}},{key:"updateMergeItem",value:function(e){if("mousemove"===e.type||"pointermove"===e.type||e.shiftKey&&"mousedown"===e.type){var t=Wn(this.parent.getActiveSheet().selectedRange);t[1]===t[3]&&t[0]===t[2]||this.parent.getActiveSheet().isProtected||(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(kl).getConstant("Home"),items:["".concat(this.parent.element.id,"_merge_cells")],enable:!0}]),this.toggleActiveState(!1))}}},{key:"addEventListener",value:function(){this.parent.on("ribbon",this.initRibbon,this),this.parent.on("enableToolbarItems",this.enableToolbarItems,this),this.parent.on("activeCellChanged",this.refreshRibbonContent,this),this.parent.on("updateToggleItem",this.toggleRibbonItems,this),this.parent.on("enableFileMenuItems",this.enableFileMenuItems,this),this.parent.on("hideRibbonTabs",this.hideRibbonTabs,this),this.parent.on("addRibbonTabs",this.addRibbonTabs,this),this.parent.on("addToolbarItems",this.addToolbarItems,this),this.parent.on("hideFileMenuItems",this.hideFileMenuItems,this),this.parent.on("addFileMenuItems",this.addFileMenuItems,this),this.parent.on("hideToolbarItems",this.hideToolbarItems,this),this.parent.on("enableRibbonTabs",this.enableRibbonTabs,this),this.parent.on("protectCellFormat",this.protectSheetHandler,this),this.parent.on("selectionComplete",this.updateMergeItem,this),this.parent.on("refreshRibbonIcons",this.refreshRibbonContent,this),this.parent.on("insertDesignChart",this.insertDesignChart,this),this.parent.on("removeDesignChart",this.removeDesignChart,this),this.parent.on("ribbonFind",this.findToolDlg,this)}},{key:"destroy",value:function(){var e=this.parent.element,t=this.ribbon.element,i=this.cPickerEle,n=e.id;["bold","italic","line-through","underline"].forEach(function(t){!function(e,t){if(e){var i=Object(f.N)(e,t);i&&i.destroy()}}(Object(f.ob)("#".concat(n,"_").concat(t),e),b.a)}),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.bordersMenu.destroy(),this.bordersMenu=null,this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.chartDdb.destroy(),this.chartDdb=null,this.chartMenu.destroy(),this.chartMenu=null,this.cFDdb.destroy(),this.cFDdb=null,this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),t&&Object(f.J)(t),this.ribbon=null,i&&Object(f.J)(i),this.cPickerEle=null,this.findDialog&&this.findDialog.destroy(),this.removeEventListener()}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("ribbon",this.initRibbon),this.parent.off("enableToolbarItems",this.enableToolbarItems),this.parent.off("activeCellChanged",this.refreshRibbonContent),this.parent.off("updateToggleItem",this.toggleRibbonItems),this.parent.off("enableFileMenuItems",this.enableFileMenuItems),this.parent.off("hideRibbonTabs",this.hideRibbonTabs),this.parent.off("addRibbonTabs",this.addRibbonTabs),this.parent.off("addToolbarItems",this.addToolbarItems),this.parent.off("hideFileMenuItems",this.hideFileMenuItems),this.parent.off("addFileMenuItems",this.addFileMenuItems),this.parent.off("hideToolbarItems",this.hideToolbarItems),this.parent.off("enableRibbonTabs",this.enableRibbonTabs),this.parent.off("protectCellFormat",this.protectSheetHandler),this.parent.off("selectionComplete",this.updateMergeItem),this.parent.off("refreshRibbonIcons",this.refreshRibbonContent),this.parent.off("insertDesignChart",this.insertDesignChart),this.parent.off("removeDesignChart",this.removeDesignChart),this.parent.on("ribbonFind",this.findToolDlg,this))}}]),e}(),Bo=function(){function e(t){a(this,e),this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=t,this.addEventListener()}return o(e,[{key:"getModuleName",value:function(){return"formulaBar"}},{key:"createFormulaBar",value:function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var t=this.parent.serviceLocator.getService(kl),i=this.parent.element.id,n=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var r=this.parent.createElement("input",{id:i+"_name_box",attrs:{type:"text"}});n.appendChild(r),this.comboBoxInstance=new C.c({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(r),this.comboBoxInstance.element.parentElement.title=t.getConstant("NameBox")}n.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:t.getConstant("InsertFunction")}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=Object(f.nb)(n,{selector:".e-insert-function"}),n.appendChild(this.parent.createElement("div",{className:"e-separator"}));var a=n.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:i+"_formula_input",attrs:{title:t.getConstant("FormulaBar"),spellcheck:"false"}}));a.rows=1,this.parent.isMobileView()?(a.placeholder=t.getConstant("MobileFormulaBarPlaceHolder"),f.l.add(a,"focus",this.textAreaFocusIn,this),f.l.add(a,"blur",this.textAreaFocusOut,this)):n.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:t.getConstant("ExpandFormulaBar")}})),e&&e.uiUpdate?this.parent.element.insertBefore(n,document.getElementById(i+"_sheet_panel")):this.parent.element.appendChild(n)}else this.destroy()}},{key:"textAreaFocusIn",value:function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit"});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)}},{key:"textAreaFocusOut",value:function(){var e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),Object(f.J)(e.querySelector(".e-formula-submit"))}},{key:"keyDownHandler",value:function(e){var t=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if((Sa(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&16===e.keyCode)return;t.classList.contains("e-formula-bar")&&this.parent.notify(xr,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},{key:"keyUpHandler",value:function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,i),i.editedValue!==t.value&&16!==e.keyCode&&this.parent.notify(xr,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}}},{key:"nameBoxBeforeOpen",value:function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()}},{key:"nameBoxBlur",value:function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())}},{key:"nameBoxSelect",value:function(e){if(e.isInteracted){var t=e.itemData.refersTo.substr(1),i=Wa(this.parent,Ga(t));if(void 0===i)return;var n=Qn(t),r=Ka(this.parent,i);if(-1!==n.indexOf(":")){var a=n.indexOf(":"),s=n.substr(0,a),o=n.substr(a+1,n.length);s=s.replace("$",""),(o=o.replace("$","")).match(/\D/g)&&!o.match(/[0-9]/g)&&s.match(/\D/g)&&!s.match(/[0-9]/g)?n=(s+="1")+":"+(o+=r.rowCount):!o.match(/\D/g)&&o.match(/[0-9]/g)&&!s.match(/\D/g)&&s.match(/[0-9]/g)&&(n=(s=Yn(parseInt(s,10)-1,0))+":"+(o=Yn(parseInt(o,10)-1,r.colCount-1)))}i===this.parent.activeSheetIndex?(this.parent.selectRange(n),ao(this.parent.element)):(Xa(this.parent,n,r),this.parent.activeSheetIndex=i)}}},{key:"formulaBarUpdateHandler",value:function(e){var t,i=this,n=this.parent.getActiveSheet().selectedRange.split(":"),r={action:"getElement",element:null};this.parent.notify(xr,r);var a=this.parent.element.querySelector(".e-formula-bar"),s=new f.n;if("mousemove"===e.type||"pointermove"===e.type){var o=Wn(n[0]),l=Wn(n[1]);t="".concat(Math.abs(o[0]-l[0])+1,"R x ").concat(Math.abs(o[1]-l[1])+1,"C"),this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify("editValue",null):r.element&&(a.value=r.element.textContent))}else t=n[0],this.parent.getData("".concat(es(this.parent),"!").concat(t)).then(function(n){var o,l="";n.forEach(function(n){var h=n&&n.format?br(n.format):"General";n&&(Object(f.Z)(n.value)||("Invalid Date"===(o=sr(Number(n.value))).toString()||"ShortDate"!==h&&"LongDate"!==h?"Invalid Date"!==o.toString()&&"Time"===h?(Number(n.value)>=1&&(l=s.formatDate(o,{type:"dateTime",skeleton:"yMd"})+" "),l+=s.formatDate(o,{type:"dateTime",skeleton:"hms"})):l=n.value:l=s.formatDate(o,{type:"date",skeleton:"yMd"})),n.formula&&(l=n.formula));var c={action:"getCurrentEditValue",editedValue:""};i.parent.notify(xr,c);var d=c.editedValue&&0===c.editedValue.toString().indexOf("=")||Sa(c.editedValue),u=document.getElementById(i.parent.element.id+"_formula_input"),p=Wn(t),g=i.parent.getCell(p[0],p[1]);u.value=!n||n.formula||!g||n.validation&&"List"===n.validation.type||"Time"===h&&l?l:g.textContent,Object(f.Z)(l)||d||i.parent.notify(xr,{action:"refreshEditor",value:u.value,refreshEditorElem:!0}),i.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?i.parent.notify("editValue",null):r.element&&(a.value=r.element.textContent))})});this.updateComboBoxValue(t)}},{key:"UpdateValueAfterMouseUp",value:function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])}},{key:"updateComboBoxValue",value:function(e){var t=this.parent.getActiveSheet(),i={action:"getNameFromRange",range:es(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify("formulaOperation",i),i.definedName&&(e=i.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}}},{key:"disabletextarea",value:function(){this.getFormulaBar().disabled=!!this.parent.getActiveSheet().isProtected}},{key:"formulaBarScrollEdit",value:function(){var e=Wn(this.parent.getActiveSheet().selectedRange),t=Zn(this.parent.getActiveSheet().topLeftCell);e[0]<t[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(xr,{action:"startEdit",refreshCurPos:!1})}},{key:"formulaBarClickHandler",value:function(e){var t=this,i=e.target,n=this.parent.getActiveSheet(),r=n.isProtected,a=Zn(n.activeCell),s=Ra(Da(a[0],a[1],n),gs(n,a[1]));if(i.classList.contains("e-drop-icon")&&Object(f.D)(i,".e-formula-bar-panel"))this.toggleFormulaBar(i);else if(i.classList.contains("e-formula-bar"))this.parent.isEdit||r&&(!r||s)?r&&s&&this.parent.notify("editAlert",null):this.formulaBarScrollEdit();else if(i.parentElement&&i.parentElement.classList.contains("e-name-box"))if(i.classList.contains("e-ddl-icon")){var o={action:"getNames",names:[]};this.parent.notify("formulaOperation",o),this.comboBoxInstance.dataSource=o.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!Object(f.Z)(i.offsetParent)&&(i.offsetParent.classList.contains("e-insert-function")||i.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===i.offsetParent.id||this.parent.element.id+"_insert_function"===i.id||i.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===i.parentElement.id)){if(r)return void this.parent.notify("editAlert",null);var l=!this.parent.isEdit,h={action:"getCurrentEditValue",editedValue:""};if(!l){var c={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify("formulaOperation",c),l=c.isFormulaEdit,this.parent.notify(xr,h)}if(l||""===h.editedValue){""===h.editedValue&&this.parent.notify(xr,{action:"refreshEditor",value:"="});var d=this.parent.serviceLocator.getService(kl),u=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),p=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:d.getConstant("PickACategory")}),g=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),m=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),v=this.parent.createElement("div",{className:"e-description-content",innerHTML:d.getConstant("Description")}),y=this.parent.createElement("div",{className:"e-header-content",innerHTML:d.getConstant("InsertFunction")}),b={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(pr,b),this.categoryCollection=b.categoryCollection,this.categoryList=new C.d({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var S={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,S),this.formulaCollection=S.formulaCollection,this.formulaList=new x.b({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:y.outerHTML,content:p.outerHTML+g.outerHTML+m.outerHTML+v.outerHTML+u.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(e){var i={dialogName:"InsertFunctionDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),ao(t.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:d.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),f.l.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this)}}}},{key:"toggleFormulaBar",value:function(e){var t=e.parentElement,i=this.parent.serviceLocator.getService(kl);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=i.getConstant("ExpandFormulaBar")):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=i.getConstant("CollapseFormulaBar")),this.parent.setPanelSize()}},{key:"dialogOpen",value:function(){this.focusOkButton()}},{key:"dialogClose",value:function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(xr,e),"="===e.editedValue.toString().trim()&&this.parent.notify(xr,{action:"refreshEditor",value:""})}},{key:"dialogBeforeClose",value:function(){f.l.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementById("_dialog-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")}},{key:"selectFormula",value:function(e,t){var i=t.formulaList.getSelectedItems().text,n=Ka(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(xr,{action:"refreshEditor",value:i+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(xr,{action:"startEdit",value:"="+i+"(",address:n.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+i+"("})),e.hide()}},{key:"listSelected",value:function(){this.updateFormulaDescription()}},{key:"updateFormulaList",value:function(){this.activeListFormula(),this.updateFormulaDescription()}},{key:"dropDownSelect",value:function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(pr,t),this.formulaCollection=t.formulaCollection;else{var i={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(pr,i),this.formulaCollection=i.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()}},{key:"focusOkButton",value:function(){document.getElementById("_dialog-content").nextElementSibling.firstElementChild.focus()}},{key:"activeListFormula",value:function(){var e=document.getElementById(this.parent.element.id+"_formula_list");this.formulaList.selectItem(e.children[0].children[0].firstElementChild)}},{key:"updateFormulaDescription",value:function(){var e=this.formulaList.getSelectedItems().text;this.parent.notify(pr,{action:"getFormulaDescription",description:"",selectedList:e}),this.focusOkButton(),e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,document.getElementById(this.parent.element.id+"_description_content").innerHTML=this.parent.serviceLocator.getService(kl).getConstant(e)}},{key:"formulaClickHandler",value:function(e){var t=e.target,i=Ka(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(xr,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(xr,{action:"startEdit",value:"="+t.innerText+"(",address:i.activeCell}),this.parent.notify("formulaBarOperation",{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())}},{key:"addEventListener",value:function(){this.parent.on("formulaBar",this.createFormulaBar,this),this.parent.on("click",this.formulaBarClickHandler,this),this.parent.on(wr,this.keyDownHandler,this),this.parent.on(Sr,this.keyUpHandler,this),this.parent.on("selectionComplete",this.formulaBarUpdateHandler,this),this.parent.on("mouseUpAfterSelection",this.UpdateValueAfterMouseUp,this),this.parent.on("formulaBarOperation",this.editOperationHandler,this),this.parent.on("enableFormulaInput",this.disabletextarea,this),this.parent.on("isFormulaBarEdit",this.isFormulaBarEdit,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&Object(f.J)(e)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("formulaBar",this.createFormulaBar),this.parent.off("click",this.formulaBarClickHandler),this.parent.off(wr,this.keyDownHandler),this.parent.off(Sr,this.keyUpHandler),this.parent.off("selectionComplete",this.formulaBarUpdateHandler),this.parent.off("mouseUpAfterSelection",this.UpdateValueAfterMouseUp),this.parent.off("formulaBarOperation",this.editOperationHandler),this.parent.off("enableFormulaInput",this.disabletextarea),this.parent.off("isFormulaBarEdit",this.isFormulaBarEdit))}},{key:"editOperationHandler",value:function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=Object(f.cb)(e.value)?"":e.value;break;case"getElement":e.element=this.getFormulaBar()}}},{key:"isFormulaBarEdit",value:function(e){e.isEdit=!(!this.parent.isEdit||!this.isGoto)}},{key:"getFormulaBar",value:function(){return Object(f.ob)("#"+this.parent.element.id+"_formula_input",this.parent.element)}}]),e}(),Ho=function(){function e(t){a(this,e),this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},this.parent=t,this.addEventListener()}return o(e,[{key:"getModuleName",value:function(){return"formula"}},{key:"destroy",value:function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("formulaOperation",this.performFormulaOperation,this),this.parent.on(Sr,this.keyUpHandler,this),this.parent.on(wr,this.keyDownHandler,this),this.parent.on("click",this.formulaClick,this),this.parent.on("refreshFormulaDatasource",this.refreshFormulaDatasource,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("formulaOperation",this.performFormulaOperation),this.parent.off(Sr,this.keyUpHandler),this.parent.off(wr,this.keyDownHandler),this.parent.off("click",this.formulaClick),this.parent.off("refreshFormulaDatasource",this.refreshFormulaDatasource))}},{key:"performFormulaOperation",value:function(e){var t=this,i=e.action,n=this.parent.serviceLocator.getService(kl);switch(i){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=es(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":this.parent.serviceLocator.getService(Il).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:n.getConstant("CircularReference"),beforeOpen:function(e){var i={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}}),e.argValue="0"}}},{key:"renderAutoComplete",value:function(){if(!Object(f.ob)("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var t={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,t);var i={dataSource:t.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new C.a(i,e),this.autocompleteInstance.createElement=this.parent.createElement}}},{key:"onSuggestionOpen",value:function(e){var t=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(e,t){setTimeout(function(){e()},100)}).then(function(){t.triggerKeyDownEvent(t.keyCodes.DOWN)})}},{key:"onSuggestionClose",value:function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1}},{key:"onSelect",value:function(e){var t="="+e.itemData.value+"(";if(this.isSubFormula){var i=this.getEditingValue(),n=i.lastIndexOf(this.getArgumentSeparator());n>-1?t=i.slice(0,n+1):(n=i.lastIndexOf("("))>-1&&(t=i.slice(0,n+1)),t+=e.itemData.value+"("}if(this.parent.notify(xr,{action:"refreshEditor",value:t,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var r=Object(f.ob)("#"+this.parent.element.id+"_ac_popup");r&&Object(f.J)(r),this.isPopupOpened=!1}}},{key:"onSuggestionComplete",value:function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())}},{key:"refreshFormulaDatasource",value:function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(pr,e),this.autocompleteInstance.dataSource=e.formulaCollection}},{key:"keyUpHandler",value:function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=Sa(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==this.keyCodes.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()}},{key:"keyDownHandler",value:function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case this.keyCodes.UP:case this.keyCodes.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case this.keyCodes.TAB:e.preventDefault(),this.triggerKeyDownEvent(this.keyCodes.ENTER)}}else{var i=e.target;if(i.id===this.parent.element.id+"_name_box")switch(t){case this.keyCodes.ENTER:this.addDefinedName({name:i.value}),ao(this.parent.element);break;case this.keyCodes.ESC:ao(this.parent.element)}}}},{key:"formulaClick",value:function(e){this.parent.isEdit&&(this.isFormulaBar=e.target.classList.contains("e-formula-bar"))}},{key:"refreshFormulaSuggestion",value:function(e,t){if(t.length>0){var i=this.autocompleteInstance.element,n=this.isPopupOpened;this.isNavigationKey(e.keyCode)||(i.value=t,i.dispatchEvent(new Event("input")),i.dispatchEvent(new Event("keyup")),n&&this.triggerKeyDownEvent(this.keyCodes.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())}},{key:"endEdit",value:function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=Object(f.ob)("#"+this.parent.element.id+"_ac_popup");e&&Object(f.J)(e),this.isPopupOpened=!1}}},{key:"hidePopUp",value:function(){this.autocompleteInstance.hidePopup()}},{key:"getSuggestionKeyFromFormula",value:function(e){var t="";if(e=e.substr(1)){var i=e.lastIndexOf("("),n=(e=e.substr(i+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=i>-1):(t=n[n.length-1],this.isSubFormula=!0);var r=t.match(/\w/);(!r||r&&0!==r.index)&&(t="")}return t}},{key:"getRelateToElem",value:function(){var e={action:"getElement"};return this.parent.notify(this.isFormulaBar?"formulaBarOperation":xr,e),e.element}},{key:"getEditingValue",value:function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(xr,e),e.editedValue}},{key:"isNavigationKey",value:function(e){return e===this.keyCodes.UP||e===this.keyCodes.DOWN||e===this.keyCodes.LEFT||e===this.keyCodes.RIGHT}},{key:"triggerKeyDownEvent",value:function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var i=new Event("keydown");i.keyCode=e,i.which=e,i.altKey=!1,i.shiftKey=!1,i.ctrlKey=!1,t.dispatchEvent(i)}},{key:"getArgumentSeparator",value:function(){if(this.argumentSeparator)return this.argumentSeparator;var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(pr,e),this.argumentSeparator=e.argumentSeparator,e.argumentSeparator}},{key:"getNames",value:function(e){return this.parent.definedNames.filter(function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e})}},{key:"getNameFromRange",value:function(e){var t=e.slice(0,e.indexOf(":")),i=e.slice(e.indexOf("!")+1).split(":"),n=i.length>1&&i[0]===i[1],r=this.parent.definedNames.filter(function(i){return!(!n||i.refersTo!=="="+t)||i.refersTo==="="+e});return r&&r[0]}},{key:"addDefinedName",value:function(e){var t=this,i=e.name,n=!1;if(i&&wa(i.toUpperCase()))return this.parent.goTo(i),n;if(!e.refersTo){var r=Ka(this.parent,this.parent.activeSheetIndex),a=es(this.parent);a=-1!==a.indexOf(" ")?"'"+a+"'":a;var s=r.selectedRange;if(!Object(f.Z)(s)){var o=s.indexOf(":"),l=s.substr(0,o),h=s.substr(o+1,s.length);parseInt(h.replace(/\D/g,""),10)===r.rowCount&&1===parseInt(l.replace(/\D/g,""),10)?(h=h.replace(/[0-9]/g,""),s="$"+(l=l.replace(/[0-9]/g,""))+":$"+h):Zn(h)[1]===r.colCount-1&&0===Zn(l)[1]?(h=h.replace(/\D/g,""),s="$"+(l=l.replace(/\D/g,""))+":$"+h):s=l===h?l:s}e.refersTo=a+"!"+s,e.scope="Workbook"}if(i.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(i)){var c={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(pr,c),n=c.isAdded,c.isAdded||this.parent.serviceLocator.getService(Il).show({content:this.parent.serviceLocator.getService(kl).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var i={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(Il).show({content:this.parent.serviceLocator.getService(kl).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var i={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}});return n}}]),e}(),_o=function(){function e(t){a(this,e),this.aggregateContent="",this.isSelectCancel=!1,this.selaggregateCnt="Sum",this.parent=t,this.addEventListener()}return o(e,[{key:"getModuleName",value:function(){return"sheetTabs"}},{key:"createSheetTabs",value:function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var t=this.parent.serviceLocator.getService(kl),i=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),n=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:t.getConstant("AddSheet")}});n.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),n.addEventListener("click",this.addSheetTab.bind(this)),n.disabled=!this.parent.allowInsert,i.appendChild(n),this.addBtnRipple=Object(f.nb)(i,{selector:".e-add-sheet-tab"});var r=this.parent.createElement("button",{attrs:{title:t.getConstant("ListAllSheets")}});i.appendChild(r),this.parent.element.appendChild(i);var a=this.getSheetTabItems();this.dropDownInstance=new S.b({iconCss:"e-icons",items:a.ddbItems,beforeItemRender:function(t){var i=e.parent.sheets[e.dropDownInstance.items.indexOf(t.item)];"Hidden"===i.state?t.element.classList.add("e-hide"):"VeryHidden"===i.state&&(t.element.style.display="none")},select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element)},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return ao(e.parent.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(r);var s=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new v.g({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:a.tabItems,scrollStep:250,selecting:function(t){var i={currentSheetIndex:t.selectingIndex,previousSheetIndex:t.selectedIndex,cancel:!1};e.isSelectCancel||e.parent.notify(Ar,{eventArgs:i,action:"gotoSheet"}),e.isSelectCancel=i.cancel},selected:function(t){if(t.selectedIndex!==t.previousIndex){if(e.parent.notify("removeDesignChart",{}),e.parent.isEdit){var i=window.getSelection(),n={action:"getCurrentEditValue",editedValue:""};e.parent.notify(xr,n);var r=!!n.editedValue&&Sa(n.editedValue,!0);!r&&i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")&&(r=Sa(e.parent.element.querySelector(".e-formula-bar").value,!0)),r||e.parent.endEdit()}if(e.isSelectCancel)e.tabInstance.selectedItem=t.previousIndex,e.tabInstance.dataBind(),ao(e.parent.element);else{e.parent.activeSheetIndex=t.selectedIndex,e.parent.dataBind(),e.updateDropDownItems(t.selectedIndex,t.previousIndex),ao(e.parent.element),e.parent.notify(Rr,{eventArgs:{previousSheetIndex:t.previousIndex,currentSheetIndex:t.selectedIndex},action:"gotoSheet"});var a={action:"registerGridInCalc",sheetID:(t.selectedIndex+1).toString()};e.parent.notify(pr,a)}}},created:function(){var t=e.tabInstance.element.querySelector(".e-toolbar-items");t.classList.add("e-sheet-tabs-items"),f.l.add(t,"dblclick",e.renameSheetTab,e)}}),i.appendChild(s),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(s),f.l.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var o=a.tabItems.length,l=0;l<o;l++){var h=es(this.parent,l);this.parent.notify(pr,{action:"addSheet",sheetName:"Sheet"+(l+1),index:l+1,visibleName:h})}this.parent.notify(pr,{action:"initiateDefinedNames"}),this.parent.notify("protectSheet",null)}else this.destroy()}},{key:"updateDropDownItems",value:function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)}},{key:"beforeOpenHandler",value:function(e,t){var i=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>i&&(t.style.height="".concat(i,"px"),t.style.overflowY="auto"),t.parentElement.style.visibility="hidden"}},{key:"openHandler",value:function(e,t,i){var n,r=t.parentElement;if(-1===Object(w.k)(r).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:r.getBoundingClientRect().height;var a=Object(w.d)(e.element,i,"top");"right"===i&&(a.left-=r.getBoundingClientRect().width),r.style.left="".concat(a.left,"px"),r.style.top=a.top-n+"px"}r.style.visibility=""}},{key:"getSheetTabItems",value:function(){var e,t=this,i=[],n=[];return this.parent.sheets.forEach(function(r,a){e=es(t.parent,a),i.push({header:{text:e},visible:"Visible"===r.state}),n.push({text:e,iconCss:a===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:i,ddbItems:n}}},{key:"refreshSheetTab",value:function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()}},{key:"addSheetTab",value:function(){this.parent.notify(xr,{action:"getCurrentEditValue",editedValue:""}),this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),ao(this.parent.element)}},{key:"insertSheetTab",value:function(e){this.parent.notify("removeDesignChart",{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var i=this.parent.sheets[t].name;this.dropDownInstance.items.splice(t,0,{text:i}),this.tabInstance.addTab([{header:{text:i},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx})}},{key:"updateSheetTab",value:function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.parent.setSheetPropertyOnMute(this.parent.sheets[e.idx],"state","Visible"),this.tabInstance.hideTab(e.idx,!1)}this.tabInstance.selectedItem=e.idx,this.tabInstance.dataBind(),this.parent.notify("protectSheet",null)}},{key:"switchSheetTab",value:function(e){var t=Object(f.D)(e.event.target,".e-toolbar-item");if(t){for(var i=t.querySelector(".e-tab-text").textContent,n=0,r=this.tabInstance.items.length;n<r;n++)if(this.tabInstance.items[n].header.text===i){this.parent.activeSheetIndex!==n&&this.updateSheetTab({idx:n});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id==="".concat(this.parent.element.id,"_cmenu_insert_sheet")&&(1===this.skipHiddenSheets()&&(e.element.children[1].classList.add("e-disabled"),e.element.children[4].classList.add("e-disabled")),this.parent.allowInsert||e.element.children[0].classList.add("e-disabled"),this.parent.allowDelete||e.element.children[1].classList.add("e-disabled")),(this.parent.password.length>0||this.parent.isProtected)&&(e.element.children[0].classList.add("e-disabled"),e.element.children[1].classList.add("e-disabled"),e.element.children[2].classList.add("e-disabled"),e.element.children[3].classList.add("e-disabled"))}}},{key:"skipHiddenSheets",value:function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach(function(t){"Visible"!==t.state&&--e}),e}},{key:"renameSheetTab",value:function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var t=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,i={eventArgs:{name:t,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",i),i.cancel)return;var n=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: ".concat(e.getBoundingClientRect().width,"px"),attrs:{type:"text",name:"Rename",required:"",value:t,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(n),f.l.add(document,"mousedown touchstart",this.renameInputFocusOut,this),f.l.add(n,"input",this.updateWidth,this),n.focus(),n.setSelectionRange(0,t.length),f.l.remove(Object(f.D)(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}}},{key:"updateWidth",value:function(e){var t=e.target,i=t.value.length,n=t.value.split(" ");if(n.length){var r=n.length-1;i-=r,i+=.5*r}t.style.width="".concat(i,"ch")}},{key:"renameInputFocusOut",value:function(e){var t=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!t.classList.contains("e-sheet-rename")&&!Object(f.D)(t,".e-dlg-container")){if(t=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(t),void ao(this.parent.element);var i=t.value,n=this.parent.serviceLocator.getService(kl);if(i){var r=this.tabInstance.selectedItem;if(i.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(t,n.getConstant("SheetRenameInvalidAlert"));else{if(this.tabInstance.items[r].header.text!==i)for(var a=0,s=this.parent.sheets.length;a<s;a++)if(a!==this.parent.activeSheetIndex&&this.parent.sheets[a].name.toLowerCase()===i.toLowerCase())return void this.showRenameDialog(t,n.getConstant("SheetRenameAlreadyExistsAlert"));var o=this.removeRenameInput(t);this.tabInstance.items[r].header.text!==i&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[r],"name",i),this.updateSheetName({value:i,idx:r,items:o})),("keydown"===e.type||Object(f.D)(e.target,".e-spreadsheet"))&&ao(this.parent.element)}}else this.showRenameDialog(t,n.getConstant("SheetRenameEmptyAlert"));var l=this.parent.getActiveSheet().id;this.parent.notify(pr,{action:"renameUpdation",value:i,sheetId:l}),this.parent.notify(Rr,{eventArgs:{index:l,value:i},action:"renameSheet"})}}},{key:"updateSheetName",value:function(e){this.tabInstance.items[e.idx].header.text=e.value,this.dropDownInstance.items[e.idx].text=e.value,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.value.indexOf("  ")>-1?(this.tabInstance.setProperties({items:this.tabInstance.items},!0),e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=e.value):(e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent=e.value,this.tabInstance.dataBind())}},{key:"hideSheet",value:function(){this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"state","Hidden"),this.tabInstance.hideTab(this.parent.activeSheetIndex)}},{key:"removeRenameInput",value:function(e){var t=e.parentElement.querySelector(".e-tab-text"),i=Object(f.D)(e,".e-toolbar-items");return f.l.add(i,"dblclick",this.renameSheetTab,this),f.l.remove(document,"mousedown touchstart",this.renameInputFocusOut),f.l.remove(e,"input",this.updateWidth),Object(f.kb)(e),t.style.display="",i}},{key:"showRenameDialog",value:function(e,t){var i=this;this.parent.serviceLocator.getService(Il).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(t){var n={dialogName:"SheetRenameDialog",element:t.element,target:t.target,cancel:t.cancel};i.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})}},{key:"focusRenameInput",value:function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()}},{key:"removeSheetTab",value:function(e){var t=this;if(!e.count||e.count!==this.parent.sheets.length){var i=this.parent.serviceLocator.getService(kl);if(this.skipHiddenSheets()>1){var n=e.sheetName?Ka(this.parent,Wa(this.parent,e.sheetName)):this.parent.getActiveSheet(),r=e.index||Wa(this.parent,n.name),a={index:r,sheetCount:this.parent.sheets.length,sheetName:n.name};if(n.rows&&n.rows.length&&(1!==n.rows.length||n.rows[0].cells&&n.rows[0].cells.length)){var s=this.parent.serviceLocator.getService(Il);e.clicked?this.forceDelete(r):s.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:i.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var i={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),ao(t.parent.element)},buttons:[{buttonModel:{content:i.getConstant("Ok"),isPrimary:!0},click:function(){s.hide(),t.forceDelete(r),t.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(a.sheetCount=t.parent.sheets.length,t.parent.notify(Rr,{eventArgs:a,action:"removeSheet"}))}}]})}else this.parent.notify(pr,{action:"deleteSheetTab",sheetName:"",index:r+1}),this.destroySheet(r),this.parent.notify("clearUndoRedoCollection",null),e&&!e.isAction&&(a.sheetCount=this.parent.sheets.length,this.parent.notify(Rr,{eventArgs:a,action:"removeSheet"}))}else this.parent.serviceLocator.getService(Il).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:i.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var i={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0),ao(t.parent.element)}})}}},{key:"forceDelete",value:function(e){var t={action:"deleteSheetTab",sheetName:"",index:e+1};this.parent.notify("removeDesignChart",{}),this.parent.notify(pr,t),this.destroySheet(e)}},{key:"destroySheet",value:function(e){var t=e||this.parent.activeSheetIndex;this.parent.removeSheet(t),this.parent.notify("sheetsDestroyed",{sheetIndex:t}),this.dropDownInstance.items.splice(t,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(t);var i=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=i,this.parent.setProperties({activeSheetIndex:i},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=i,this.tabInstance.dataBind(),this.updateDropDownItems(i),this.parent.notify("protectSheet",null),ao(this.parent.element)}},{key:"showAggregate",value:function(){var e=this;if(!tr(Wn(this.parent.getActiveSheet().selectedRange))){var t={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify("aggregateComputation",t),t.Count>1){this.aggregateContent=t.countOnly?"Count":this.selaggregateCnt,t.countOnly&&(this.aggregateContent="Count",delete t.Sum,delete t.Avg,delete t.Min,delete t.Max);var i=t.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete t.countOnly;var n=this.aggregateContent,r="".concat(n,": ").concat(t[n]);if(this.aggregateDropDown)this.updateAggregateContent(r,t);else{var a=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate"});document.getElementById("".concat(this.parent.element.id,"_sheet_tab_panel")).appendChild(a),this.aggregateDropDown=new S.b({content:r,items:this.getAggregateItems(t),select:function(i){e.parent.notify("aggregateComputation",t),e.updateAggregateContent(i.item.text,{Count:t.Count,Sum:t.Sum,Avg:t.Avg,Min:t.Min,Max:t.Max},!0)},beforeOpen:function(t){return e.beforeOpenHandler(e.aggregateDropDown,t.element)},open:function(t){return e.openHandler(e.aggregateDropDown,t.element,"right")},close:function(){return ao(e.parent.element)},cssClass:i}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(a)}}else this.removeAggregate()}}},{key:"getAggregateItems",value:function(e){var t,i,n=this,r=[];return Object.keys(e).forEach(function(a){"aggregateComputation"!==e[a]&&(t="".concat(a,": ").concat(e[a]),i=a===n.aggregateContent?"e-selected-icon e-icons":"",r.push({text:t,iconCss:i}))}),r}},{key:"updateAggregateContent",value:function(e,t,i){this.aggregateContent=e.split(": ")[0],i&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)}},{key:"removeAggregate",value:function(){Object(f.Z)(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),Object(f.kb)(this.aggregateDropDown.element),this.aggregateDropDown=null)}},{key:"addEventListener",value:function(){this.parent.on("sheetTabs",this.createSheetTabs,this),this.parent.on("refreshSheetTabs",this.refreshSheetTab,this),this.parent.on("insertSheetTab",this.insertSheetTab,this),this.parent.on("removeSheetTab",this.removeSheetTab,this),this.parent.on("renameSheetTab",this.renameSheetTab,this),this.parent.on(kr,this.switchSheetTab,this),this.parent.on("activeSheetChanged",this.updateSheetTab,this),this.parent.on("renameSheet",this.renameInputFocusOut,this),this.parent.on("activeCellChanged",this.removeAggregate,this),this.parent.on("verticalScroll",this.focusRenameInput,this),this.parent.on("horizontalScroll",this.focusRenameInput,this),this.parent.on("sheetNameUpdate",this.updateSheetName,this),this.parent.on("hideSheet",this.hideSheet,this),this.parent.on("showAggregate",this.showAggregate,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,f.l.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&Object(f.kb)(e),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("sheetTabs",this.createSheetTabs),this.parent.off("refreshSheetTabs",this.refreshSheetTab),this.parent.off("insertSheetTab",this.insertSheetTab),this.parent.off("removeSheetTab",this.removeSheetTab),this.parent.off("renameSheetTab",this.renameSheetTab),this.parent.off(kr,this.switchSheetTab),this.parent.off("activeSheetChanged",this.updateSheetTab),this.parent.off("renameSheet",this.renameInputFocusOut),this.parent.off("activeCellChanged",this.removeAggregate),this.parent.off("verticalScroll",this.focusRenameInput),this.parent.off("horizontalScroll",this.focusRenameInput),this.parent.off("sheetNameUpdate",this.updateSheetName),this.parent.off("hideSheet",this.hideSheet),this.parent.off("showAggregate",this.showAggregate))}}]),e}(),zo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener(),this.renderFileUpload()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("openSuccess",this.openSuccess,this),this.parent.on("openFailure",this.openFailed,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("openSuccess",this.openSuccess),this.parent.off("openFailure",this.openFailed))}},{key:"renderFileUpload",value:function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"}},{key:"fileSelect",value:function(e){var t=e.target.files[0];t&&t.length<1||(this.parent.open({file:t}),document.getElementById(this.parent.element.id+"_fileUpload").value="")}},{key:"openSuccess",value:function(e){var t=this,i=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword"];if(i.indexOf(e.data)>-1)if(i[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify("importProtectWorkbook",e.eventArgs);else{if(i[3]!==e.data)return this.parent.serviceLocator.getService(Il).hide(),this.parent.serviceLocator.getService(Il).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",beforeOpen:function(e){var i={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}}),void this.parent.hideSpinner();var n=this.parent.serviceLocator.getService(kl),r=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span",innerHTML:n.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(r)}else this.parent.serviceLocator.getService(Il).hide(),this.parent.showSpinner();this.parent.element&&(this.parent.trigger("openComplete",{response:e}),this.parent.notify(Rr,{response:e,action:"import"}),this.parent.renderModule.refreshSheet(!0),this.parent.notify("refreshSheetTabs",this),this.parent.hideSpinner())}},{key:"openFailed",value:function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"open"}}]),e}(),Vo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("beginSave",this.initiateSave,this),this.parent.on("saveCompleted",this.saveCompleted,this),this.parent.on("saveError",this.showErrorDialog,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("beginSave",this.initiateSave),this.parent.off("saveCompleted",this.saveCompleted),this.parent.off("saveError",this.showErrorDialog))}},{key:"getModuleName",value:function(){return"save"}},{key:"initiateSave",value:function(){this.parent.showSpinner()}},{key:"saveCompleted",value:function(){this.parent.hideSpinner()}},{key:"showErrorDialog",value:function(e){var t=this;this.parent.serviceLocator.getService(Il).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return ao(t.parent.element)}})}}]),e}(),Uo=function(){function e(t){a(this,e),this.parent=t,this.init()}return o(e,[{key:"init",value:function(){this.initContextMenu(),this.addEventListener()}},{key:"initContextMenu",value:function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new v.b({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this)},e)}},{key:"beforeCloseHandler",value:function(e){this.parent.trigger("contextMenuBeforeClose",e)}},{key:"selectHandler",value:function(e){var t=Object(f.L)({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",t);var i,n,r,a,s=this.parent.element.id+"_cmenu";if(!t.cancel)switch(e.item.id){case s+"_cut":this.parent.notify("cut",{isAction:!0,promise:Promise});break;case s+"_copy":this.parent.notify("copy",{isAction:!0,promise:Promise});break;case s+"_paste":this.parent.notify(Ir,{isAction:!0,isInternal:!0});break;case s+"_pastevalues":this.parent.notify(Ir,{type:"Values",isAction:!0,isInternal:!0});break;case s+"_pasteformats":this.parent.notify(Ir,{type:"Formats",isAction:!0,isInternal:!0});break;case s+"_rename":this.parent.notify("renameSheetTab",{});break;case s+"_delete_sheet":this.parent.notify("removeSheetTab",{});break;case s+"_insert_sheet":this.parent.notify("insertModel",{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0});break;case s+"_hide_sheet":this.parent.notify("hideSheet",null);break;case s+"_duplicate":is(this.parent,void 0,!0);break;case s+"_move_right":ts(this.parent,this.parent.activeSheetIndex+1,null,!0);break;case s+"_move_left":ts(this.parent,this.parent.activeSheetIndex-1,null,!0);break;case s+"_ascending":this.parent.notify("applySort",null);break;case s+"_descending":this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case s+"_customsort":this.parent.notify("initiateCustomSort",null);break;case s+"_filtercellvalue":this.parent.notify("filterByCellValue",null);break;case s+"_clearfilter":i=Kn(Zn(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify("clearFilter",{field:i});break;case s+"_reapplyfilter":this.parent.notify("reapplyFilter",null);break;case s+"_hide_row":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:a[0],endIndex:a[2],hide:!0,isCol:!1,actionUpdate:!0}),ao(this.parent.element);break;case s+"_unhide_row":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:a[0],endIndex:a[2],hide:!1,isCol:!1,actionUpdate:!0}),ao(this.parent.element);break;case s+"_hide_column":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:a[1],endIndex:a[3],hide:!0,isCol:!0,actionUpdate:!0}),ao(this.parent.element);break;case s+"_unhide_column":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("hideShow",{startIndex:a[1],endIndex:a[3],hide:!1,isCol:!0,actionUpdate:!0}),ao(this.parent.element);break;case s+"_insert_row_above":case s+"_delete_row":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("".concat(e.item.id.substr(s.length+1,6),"Model"),{model:this.parent.getActiveSheet(),start:a[0],end:a[2],modelType:"Row",isAction:!0,insertType:"above"}),ao(this.parent.element);break;case s+"_insert_row_below":a=$n(Wn(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:a[2]+1,end:a[2]+1+(a[2]-a[0]),modelType:"Row",isAction:!0,insertType:"below"}),ao(this.parent.element);break;case s+"_insert_column_before":case s+"_delete_column":a=Wn(this.parent.getActiveSheet().selectedRange),this.parent.notify("".concat(e.item.id.substr(s.length+1,6),"Model"),{model:this.parent.getActiveSheet(),start:a[1],end:a[3],modelType:"Column",isAction:!0}),ao(this.parent.element);break;case s+"_insert_column_after":a=$n(Wn(this.parent.getActiveSheet().selectedRange)),this.parent.notify("insertModel",{model:this.parent.getActiveSheet(),start:a[3]+1,end:a[3]+1+(a[3]-a[1]),modelType:"Column",isAction:!0}),ao(this.parent.element);break;case s+"_hyperlink":this.parent.notify("initiateHyperlink",null);break;case s+"_editHyperlink":this.parent.notify("editHyperlink",null);break;case s+"_openHyperlink":this.parent.notify("openHyperlink",null);break;case s+"_removeHyperlink":this.parent.removeHyperlink(this.parent.getActiveSheet().selectedRange);break;case s+"_protect":n=this.parent.getActiveSheet(),this.parent.setSheetPropertyOnMute(n,"isProtected",!n.isProtected),r=!n.isProtected,this.parent.notify("applyProtect",{isActive:r})}}},{key:"getInsertModel",value:function(e,t){for(var i=[],n=e;n<=t;n++)i.push(n===e?{index:n}:{});return i}},{key:"beforeOpenHandler",value:function(e){var t,i=e.event.target,n=this.getTarget(i);if(e.element.classList.contains("e-contextmenu")){var r=this.parent.getActiveSheet();if(e.event.target&&(i.classList.contains("e-rowresize")||i.classList.contains("e-colresize"))){var a=Wn(r.selectedRange);if(!(i.classList.contains("e-rowresize")?0===a[1]&&a[3]===r.colCount-1:0===a[0]&&a[2]===r.rowCount-1))return void(e.cancel=!0);t=(i.classList.contains("e-rowresize")?this.parent.hiddenCount(a[0],a[2])!==Math.abs(a[2]-a[0])+1:this.parent.hiddenCount(a[1],a[3],"columns")!==Math.abs(a[3]-a[1])+1)?this.getDataSource(n):this.getDataSource(n,i)}else{if("Content"===n){var s=Wn(r.selectedRange),o=0===s[1]&&s[3]===r.colCount-1,l=0===s[0]&&s[2]===r.rowCount-1;n=o&&l?"SelectAll":o?"RowHeader":l?"ColumnHeader":"Content"}t=this.getDataSource(n)}this.contextMenuInstance.items=t,this.contextMenuInstance.dataBind()}else t=e.items;if("ColumnHeader"===n||"RowHeader"===n){if(e.element&&e.element.childElementCount>0){var h=e.element.querySelector("ColumnHeader"===n?"#"+this.parent.element.id+"_cmenu_insert_column":"#"+this.parent.element.id+"_cmenu_insert_row"),c=e.element.querySelector("ColumnHeader"===n?"#"+this.parent.element.id+"_cmenu_delete_column":"#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&h.classList.contains("e-disabled")?h.classList.remove("e-disabled"):this.parent.allowInsert||h.classList.contains("e-disabled")||h.classList.add("e-disabled"),this.parent.allowDelete&&c.classList.contains("e-disabled")?c.classList.remove("e-disabled"):this.parent.allowDelete||c.classList.contains("e-disabled")||c.classList.add("e-disabled")}}else if("Footer"===n){var d=Wa(this.parent,i.textContent);0===d&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),d===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(kr,Object(f.L)(e,{target:n,items:t}))}},{key:"getTarget",value:function(e){return Object(f.D)(e,".e-sheet-content")?"Content":Object(f.D)(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":Object(f.D)(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":Object(f.D)(e,".e-sheet-tabs-items")?"Footer":Object(f.D)(e,".e-selectall-container")?e.classList.contains("e-header-cell")?Object(f.D)(e,".e-header-row")?"ColumnHeader":"RowHeader":Object(f.D)(e,".e-select-all-cell")?"SelectAll":"Content":""}},{key:"getDataSource",value:function(e,t){var i=this.parent.serviceLocator.getService(kl),n=[],r=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,i,r),n.push({separator:!0}),this.setFilterItems(n,r),this.setSortItems(n,r),n.push({separator:!0}),this.setHyperLink(n,r);else if("RowHeader"===e){this.setClipboardData(n,i,r);var a=this.parent.getActiveSheet(),s=Wn(a.selectedRange);this.setInsertDeleteItems(n,i,"Row",r,[s[0],s[2]],["Above","Below"]),a.frozenRows||a.frozenColumns||t&&t.parentElement&&t.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(n,i,"Row",r,[s[0],s[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,i,r);var o=this.parent.getActiveSheet(),l=Wn(o.selectedRange);this.setInsertDeleteItems(n,i,"Column",r,[l[1],l[3]],["Before","After"]),o.frozenRows||o.frozenColumns||t&&t.classList.value.includes("e-hide")||this.setHideShowItems(n,i,"Column",r,[l[1],l[3]])}else"SelectAll"===e?(this.setClipboardData(n,i,r),this.setFilterItems(n,r),this.setSortItems(n,r)):"Footer"===e&&(n.push({text:i.getConstant("Insert"),id:r+"_insert_sheet"}),n.push({text:i.getConstant("Delete"),iconCss:"e-icons e-delete",id:r+"_delete_sheet"}),n.push({text:i.getConstant("DuplicateSheet"),id:r+"_duplicate"}),n.push({text:i.getConstant("Rename"),id:r+"_rename"}),n.push({text:i.getConstant("Hide"),id:r+"_hide_sheet"}),this.setProtectSheetItems(n,r),n.push({text:i.getConstant("MoveRight"),id:r+"_move_right"}),n.push({text:i.getConstant("MoveLeft"),id:r+"_move_left"}));return n}},{key:"setProtectSheetItems",value:function(e,t){var i=this.parent.serviceLocator.getService(kl);this.parent.getActiveSheet().isProtected?e.push({text:i.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:i.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})}},{key:"setFilterItems",value:function(e,t){if(this.parent.allowFiltering){var i=this.parent.serviceLocator.getService(kl),n={clearFilterText:null,isFiltered:!1};this.parent.notify("getFilteredColumn",n),e.push({text:i.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:i.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:i.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}}},{key:"setSortItems",value:function(e,t){var i=this.parent.serviceLocator.getService(kl);this.parent.allowSorting&&e.push({text:i.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:i.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:i.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:i.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})}},{key:"setHyperLink",value:function(e,t){var i=this.parent.getActiveSheet();if(this.parent.allowHyperlink){var n=this.parent.serviceLocator.getService(kl);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||i.isProtected&&!i.protectSettings.insertLink?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:t+"_hyperlink"}):e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:t+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:t+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:t+"_removeHyperlink"})}}},{key:"setClipboardData",value:function(e,t,i){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:i+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:i+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:i+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:i+"_pastespecial",items:[{text:t.getConstant("Values"),id:i+"_pastevalues"},{text:t.getConstant("Formats"),id:i+"_pasteformats"}]}))}},{key:"setInsertDeleteItems",value:function(e,t,i,n,r,a){e.push({separator:!0}),["Insert","Delete"].forEach(function(s){e.push(r[0]===r[1]?{text:t.getConstant("".concat(s).concat(i)),id:n+"_".concat(s.toLowerCase(),"_").concat(i.toLowerCase())}:{text:t.getConstant("".concat(s).concat(i,"s")),id:n+"_".concat(s.toLowerCase(),"_").concat(i.toLowerCase())}),"Insert"===s&&(e[e.length-1].items=[],a.forEach(function(i){e[e.length-1].items.push({text:t.getConstant(i),id:"".concat(e[e.length-1].id,"_").concat(i.toLowerCase())})}))})}},{key:"setHideShowItems",value:function(e,t,i,n,r){if(r[0]===r[1])e.push({text:t.getConstant("Hide".concat(i)),id:n+"_hide_".concat(i.toLowerCase())});else{var a=r[0];r[0]=r[0]>r[1]?r[1]:r[0],r[1]=r[1]>a?r[1]:a,e.push({text:t.getConstant("Hide".concat(i,"s")),id:n+"_hide_".concat(i.toLowerCase())})}this.parent.hiddenCount(r[0],r[1],"".concat(i.toLowerCase(),"s"))&&e.push({text:t.getConstant("UnHide".concat(i,"s")),id:n+"_unhide_".concat(i.toLowerCase())})}},{key:"addEventListener",value:function(){this.parent.on("addContextMenuItems",this.addItemsHandler,this),this.parent.on("removeContextMenuItems",this.removeItemsHandler,this),this.parent.on("enableContextMenuItems",this.enableItemsHandler,this)}},{key:"addItemsHandler",value:function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)}},{key:"removeItemsHandler",value:function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)}},{key:"enableItemsHandler",value:function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("addContextMenuItems",this.addItemsHandler),this.parent.off("removeContextMenuItems",this.removeItemsHandler),this.parent.off("enableContextMenuItems",this.enableItemsHandler))}},{key:"getModuleName",value:function(){return"contextMenu"}},{key:"destroy",value:function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&Object(f.J)(e),this.parent=null}}]),e}(),qo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"refreshCellElement",value:function(e){var t=this.parent.getCell(e.rowIndex,e.colIndex);Object(f.Z)(t)||this.parent.refreshNode(t,e)}},{key:"addEventListener",value:function(){this.parent.on("refreshCellElem",this.refreshCellElement,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||this.parent.off("refreshCellElem",this.refreshCellElement)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"numberFormat"}}]),e}(),Wo=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("applySort",this.applySortHandler,this),this.parent.on("sortComplete",this.sortCompleteHandler,this),this.parent.on("initiateCustomSort",this.initiateCustomSortHandler,this),this.parent.on("sortImport",this.sortImport,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("applySort",this.applySortHandler),this.parent.off("sortComplete",this.sortCompleteHandler),this.parent.off("initiateCustomSort",this.initiateCustomSortHandler),this.parent.off("sortImport",this.sortImport))}},{key:"getModuleName",value:function(){return"sort"}},{key:"isValidSortRange",value:function(){var e=this.parent.getActiveSheet(),t=$n(Jn(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)}},{key:"sortImport",value:function(e){for(var t,i=this.parent.sortCollection,n=this.parent.getActiveSheet().usedRange.rowIndex-1,r=e?e.sheetIdx:this.parent.activeSheetIndex,a=0;a<i.length;a++)if(i[a].sheetIndex===r)for(var s=0;s<n;s++)if((t=this.parent.getCell(s,i[a].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===i[a].order||"OnTop"===i[a].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))}},{key:"sortRangeAlertHandler",value:function(e){var t=this;this.parent.serviceLocator.getService(Il).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(e){var i={dialogName:"SortRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()}},{key:"initiateCustomSortHandler",value:function(){var e=this,t=this.parent.serviceLocator.getService(kl);if(this.isValidSortRange()){var i=this.parent.serviceLocator.getService(Il);i.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:t.getConstant("CustomSort"),beforeOpen:function(t){var n={dialogName:"CustomSortDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),i.dialogInstance.content=e.customSortContent(),i.dialogInstance.dataBind(),ao(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){var t=i.dialogInstance.content,n=t.getElementsByClassName("e-list-sort e-listview e-lib")[0],r=Object(f.N)(n,"listview").dataSource;e.clearError();var a=t.getElementsByClassName("e-sort-error")[0];if(a.style.display="block",!e.validateError(r,t,a)){i.hide();var s=t.getElementsByClassName("e-sort-checkheader")[0],o=Object(f.N)(s,"checkbox"),l=Object(f.N)(t.getElementsByClassName("e-sort-checkcase")[0],"checkbox");e.applySortHandler({sortOptions:{sortDescriptors:r,containsHeader:o.checked,caseSensitive:l.checked}})}}}]})}else this.sortRangeAlertHandler({error:t.getConstant("SortOutOfRangeError")})}},{key:"validateError",value:function(e,t,i){var n=this.parent.serviceLocator.getService(kl);if(e.some(function(e){return""===e.field.toString()}))return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),function(e){var t=!Object(f.N)(e,"dropdownlist").value;return t&&e.parentElement.classList.add("e-error"),t}),i.innerText=n.getConstant("SortEmptyFieldError"),!0;var r=new Set,a="",s=e.some(function(e){return a=e.field.toString(),r.size===r.add(e.field).size}),o="";if(s){var l=0;return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),function(e){var t=Object(f.N)(e,"dropdownlist");return t.value===a&&(e.parentElement.classList.add("e-error"),o=t.text,l++),2===l}),i.innerHTML="<strong>"+o+"</strong>"+n.getConstant("SortDuplicateFieldError"),!0}return!1}},{key:"customSortContent",value:function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),t=this.getFields(),i=Object(f.W)("customSort"),n=this.getCustomListview(i);this.setHeaderTab(e,n,t);var r=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(r);var a=this.parent.createElement("div",{className:"e-list-sort",styles:""});r.appendChild(a),n.createElement=this.parent.createElement,n.appendTo(a),this.renderListItem(i,n,!0,t);var s=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(s),e}},{key:"getFields",value:function(){var e=this.parent.getActiveSheet(),t=$n(Jn(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var i={filterRange:[],hasFilter:!1};this.parent.notify("getFilterRange",i),i.hasFilter&&i.filterRange&&(t[0]=i.filterRange[0])}for(var n,r=[];t[1]<=t[3];t[1]++){var a=Da(t[0],t[1],e);if(a&&a.value){var s={formattedText:a.value,value:a.value,format:a.format,onLoad:!0};a.format&&this.parent.notify("getFormattedCell",s),n=s.formattedText}else n="Column "+Kn(t[1]+1);r.push({text:n,value:"Column "+Kn(t[1]+1)})}return r}},{key:"setHeaderTab",value:function(e,t,i){var n=this,r=this.parent.serviceLocator.getService(kl),a=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(a);var s=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:r.getConstant("AddColumn")}),o=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");o.insertBefore(s,o.firstElementChild),s.addEventListener("click",function(){if(t){var e=Object(f.W)("customSort");t.addItem([{id:e,text:r.getConstant("ThenBy"),field:"",order:"ascending"}]),n.renderListItem(e,t,l.checked,i,!0)}});var l=new b.b({label:r.getConstant("ContainsHeader"),checked:!0,change:function(t){var n=t.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(e){var t=Object(f.N)(e,"dropdownlist");t.dataSource=null,t.dataSource=i,t.fields=n,t.dataBind()})},cssClass:"e-sort-headercheckbox"}),h=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});a.appendChild(h),l.createElement=this.parent.createElement,l.appendTo(h);var c=new b.b({label:r.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),d=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});a.appendChild(d),c.createElement=this.parent.createElement,c.appendTo(d)}},{key:"getCustomListview",value:function(e){var t=[{id:e,text:this.parent.serviceLocator.getService(kl).getConstant("SortBy"),field:"",order:"ascending"}];return Object(f.K)(!1),new x.b({dataSource:t,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})}},{key:"deleteHandler",value:function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&t.removeItem(e)})}},{key:"renderListItem",value:function(e,t,i,n,r){var a=this,s=this.parent.serviceLocator.getService(kl),o=t.element.querySelector("li[data-uid="+e+"]"),l=i?{text:"text",value:"value"}:{text:"value"},h=o.getElementsByClassName("e-sort-field")[0],c=new C.d({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:l,placeholder:s.getConstant("SelectAColumn"),change:function(i){i.value&&(Array.prototype.some.call(t.dataSource,function(t){return t.id===e&&(t.field=i.value.toString().replace("Column ","")),t.id===e}),a.clearError())}});c.createElement=this.parent.createElement,c.appendTo(h),r||(c.index=0);var d=o.getElementsByClassName("e-sort-order")[0],u="ascending"===d.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),p=new b.d({label:s.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:u,cssClass:"e-sort-radiobutton",change:function(i){a.setRadioBtnValue(t,e,i.value)}}),g=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});d.appendChild(g),p.createElement=this.parent.createElement,p.appendTo(g);var f=new b.d({label:s.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!u,cssClass:"e-sort-radiobutton",change:function(i){a.setRadioBtnValue(t,e,i.value)}}),m=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});d.appendChild(m),f.createElement=this.parent.createElement,f.appendTo(m),this.deleteHandler(o,t)}},{key:"setRadioBtnValue",value:function(e,t,i){i&&Array.prototype.some.call(e.dataSource,function(e){return e.id===t&&(e.order=i),e.id===t})}},{key:"clearError",value:function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(e){e.classList.remove("e-error")}))}},{key:"applySortHandler",value:function(e){var t=this,i=this.parent.getActiveSheet(),n={range:e&&e.range||i.selectedRange,sortOptions:e&&e.sortOptions||{sortDescriptors:{}},cancel:!1};if(this.parent.trigger("beforeSort",n),!n.cancel){this.parent.notify(Ar,{eventArgs:n,action:"beforeSort"}),this.parent.showSpinner();var r=$n(Jn(n.range)),a={filterRange:[],hasFilter:!1};r[0]===r[2]&&r[2]-r[0]==0&&(this.parent.notify("getFilterRange",a),a.hasFilter&&Ia(a.filterRange,r[0],r[1])&&(r[0]=a.filterRange[0],r[1]=0,r[2]=i.usedRange.rowIndex,r[3]=i.usedRange.colIndex,n.sortOptions.containsHeader=!0)),this.parent.sort(n.sortOptions,Xn(r)).then(function(e){return t.parent.trigger("sortComplete",e),t.parent.notify(Rr,{eventArgs:e,action:"sorting"}),Promise.resolve(e)}).catch(function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)})}}},{key:"sortCompleteHandler",value:function(e){for(var t=Jn(e.range),i=t[0];i<=t[2];i++)for(var n=t[1];n<=t[3];n++)this.parent.notify(pr,{action:"refreshCalculate",rowIndex:i,colIndex:n});this.parent.serviceLocator.getService("cell").refreshRange(t,!0),this.parent.hideSpinner()}}]),e}(),Zo=function(){function e(t){a(this,e),this.parent=t,this.filterCollection=new Map,this.filterRange=new Map,this.addEventListener()}return o(e,[{key:"destroy",value:function(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("filterRangeAlert",this.filterRangeAlertHandler,this),this.parent.on("initiateFilterUI",this.initiateFilterUIHandler,this),this.parent.on("mouseDown",this.filterMouseDownHandler,this),this.parent.on("renderFilterCell",this.renderFilterCellHandler,this),this.parent.on("clearAllFilter",this.clearAllFilterHandler,this),this.parent.on(k.P,this.beforeFilterMenuOpenHandler,this),this.parent.on(k.U,this.closeDialog,this),this.parent.on("reapplyFilter",this.reapplyFilterHandler,this),this.parent.on("filterByCellValue",this.filterByCellValueHandler,this),this.parent.on("clearFilter",this.clearFilterHandler,this),this.parent.on("getFilteredColumn",this.getFilteredColumnHandler,this),this.parent.on(kr,this.cMenuBeforeOpenHandler,this),this.parent.on(k.T,this.filterCboxValueHandler,this),this.parent.on("getFilterRange",this.getFilterRangeHandler,this),this.parent.on("filterCellKeyDown",this.filterCellKeyDownHandler,this),this.parent.on("getFilteredCollection",this.getFilteredCollection,this),this.parent.on("contentLoaded",this.updateFilter,this),this.parent.on("updateFilter",this.updateFilter,this),this.parent.on("beforeInsert",this.beforeInsertHandler,this),this.parent.on("beforeDelete",this.beforeDeleteHandler,this),this.parent.on("sheetsDestroyed",this.deleteSheetHandler,this),this.parent.on("clear",this.clearHanlder,this),this.parent.on(k.W,this.filterDialogCreatedHandler,this),this.parent.on(k.V,this.removeFilterClass,this)}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("filterRangeAlert",this.filterRangeAlertHandler),this.parent.off("initiateFilterUI",this.initiateFilterUIHandler),this.parent.off("mouseDown",this.filterMouseDownHandler),this.parent.off("renderFilterCell",this.renderFilterCellHandler),this.parent.off("clearAllFilter",this.clearAllFilterHandler),this.parent.off(k.P,this.beforeFilterMenuOpenHandler),this.parent.off(k.U,this.closeDialog),this.parent.off("reapplyFilter",this.reapplyFilterHandler),this.parent.off("filterByCellValue",this.filterByCellValueHandler),this.parent.off("clearFilter",this.clearFilterHandler),this.parent.off("getFilteredColumn",this.getFilteredColumnHandler),this.parent.off(kr,this.cMenuBeforeOpenHandler),this.parent.on(k.T,this.filterCboxValueHandler),this.parent.off("getFilterRange",this.getFilterRangeHandler),this.parent.off("filterCellKeyDown",this.filterCellKeyDownHandler),this.parent.off("getFilteredCollection",this.getFilteredCollection),this.parent.off("contentLoaded",this.updateFilter),this.parent.off("updateFilter",this.updateFilter),this.parent.off("beforeInsert",this.beforeInsertHandler),this.parent.off("beforeDelete",this.beforeDeleteHandler),this.parent.off("sheetsDestroyed",this.deleteSheetHandler),this.parent.off("clear",this.clearHanlder),this.parent.off(k.W,this.filterDialogCreatedHandler),this.parent.off(k.V,this.removeFilterClass))}},{key:"getModuleName",value:function(){return"filter"}},{key:"isInValidFilterRange",value:function(e,t){var i=$n(Jn(t||e.selectedRange));return i[0]>e.usedRange.rowIndex||i[1]>e.usedRange.colIndex}},{key:"filterRangeAlertHandler",value:function(e){var t=this;this.parent.serviceLocator.getService(Il).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var i={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()}},{key:"beforeFilterMenuOpenHandler",value:function(e){var t=this.parent.serviceLocator.getService(kl);e.element.classList.add("e-spreadsheet-contextmenu");var i=e.element.querySelector("ul");this.addMenuItem(i,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(i,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(i)}},{key:"addMenuItem",value:function(e,t,i,n){var r=this.parent.createElement("li",{className:i+" e-menu-item"});r.innerHTML=t,r.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),r.firstChild),e.insertBefore(r,e.firstChild)}},{key:"initiateFilterUIHandler",value:function(e){var t=this,i=e?e.predicates:null,n=e.sIdx;if(n||0===n||(n=this.parent.activeSheetIndex),!(this.filterRange.size>0&&this.filterRange.has(n))||(this.removeFilter(n,e.isCut),i)){var r=Ka(this.parent,n);if(this.isInValidFilterRange(r,e.range)){var a=this.parent.serviceLocator.getService(kl);this.filterRangeAlertHandler({error:a.getConstant("FilterOutOfRangeError")})}else{var s=r.selectedRange,o=Wn(s);o[0]===o[2]&&o[1]===o[3]&&(s=Xn(o=La(o[0],o[1],r)));var l={range:e.range?e.range:s,filterOptions:{predicates:e.predicates},cancel:!1};if(e.isCut||this.parent.notify(Ar,{action:"filter",eventArgs:l}),this.processRange(r,n,e.range?e.range:s),i){var h=this.filterRange.get(n).slice();h[0]=h[0]+1,h[2]=r.usedRange.rowIndex,Na(this.parent,"".concat(r.name,"!").concat(Xn(h)),!0,!0).then(function(n){t.filterSuccessHandler(new m.b(n),{action:"filtering",filterCollection:i,field:i[0]?i[0].field:null,sIdx:e.sIdx,isUndoRedo:e.isUndoRedo}),t.refreshFilterRange(null,!1,e.sIdx)})}e.isCut||this.parent.notify(Rr,{action:"filter",eventArgs:l})}}}},{key:"processRange",value:function(e,t,i){var n=$n(Jn(i||e.selectedRange));n[0]===n[2]&&n[1]===n[3]&&(n[0]=0,n[1]=0,n[2]=e.usedRange.rowIndex,n[3]=e.usedRange.colIndex),this.filterRange.set(t,n),this.filterCollection.set(t,[]),this.refreshFilterRange(n,!1,t)}},{key:"removeFilter",value:function(e,t){var i=this.filterRange.get(e).slice(),n=Xn(i),r={range:n,cancel:!1};if(this.parent.notify(Ar,{action:"filter",eventArgs:r}),!r.cancel){if(this.filterCollection.get(e).length&&this.parent.clearFilter(),this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(i,!0,e),this.parent.filterCollection)for(var a,s=0,o=0,l=this.parent.filterCollection.length;o<l;o++)(a=this.parent.filterCollection[s]).sheetIndex===e&&a.filterRange===n?this.parent.filterCollection.splice(s,1):s++;t||this.parent.notify(Rr,{action:"filter",eventArgs:r})}}},{key:"filterByCellValueHandler",value:function(){var e=this,t=this.parent.activeSheetIndex,i=this.parent.getActiveSheet();if(this.isInValidFilterRange(i)){var n=this.parent.serviceLocator.getService(kl);this.filterRangeAlertHandler({error:n.getConstant("FilterOutOfRangeError")})}else{var r=Zn(i.activeCell);this.isFilterRange(t,r[0],r[1])||this.processRange(i,t);var a=this.filterRange.get(t).slice();a[0]=a[0]+1,a[2]=i.usedRange.rowIndex;var s=Kn(r[1]+1),o=this.getColumnType(i,r[1]+1,a),l=[{field:s,operator:"date"===o||"datetime"===o||"boolean"===o?"equal":"contains",value:Da(r[0],r[1],i).value,matchCase:!1,type:o}];Na(this.parent,"".concat(i.name,"!").concat(Xn(a)),!0,!0).then(function(t){e.filterSuccessHandler(new m.b(t),{action:"filtering",filterCollection:l,field:s})})}}},{key:"renderFilterCellHandler",value:function(e){var t=e.sIdx;if(t||0===t||(t=this.parent.activeSheetIndex),this.filterRange.has(t)&&this.isFilterCell(t,e.rowIndex,e.colIndex)){if(!e.td)return;if(Kn(e.colIndex+1),e.td.querySelector(".e-filter-btn")){var i=e.td.querySelector(".e-filter-iconbtn");Object(f.N)(i,"btn").iconCss="e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,t)}else{var n=this.parent.createElement("div",{className:"e-filter-btn"}),r=new b.a({iconCss:"e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,t),cssClass:"e-filter-iconbtn"});e.td.insertBefore(n,e.td.firstChild),r.createElement=this.parent.createElement,r.appendTo(n)}}this.parent.sortCollection&&this.parent.notify("sortImport",{sheetIdx:t})}},{key:"getFilterSortClassName",value:function(e,t){for(var i=Kn(e+1),n="",r=this.filterCollection.get(t),a=this.parent.sortCollection,s=0;s<r.length;s++)if(r[s].field===i){n=" e-filtered";break}if(a)for(var o=0;o<a.length;o++)if(a[o].sheetIndex===t&&a[o].columnIndex===e){n+="Ascending"===a[o].order?" e-sortasc-filter":" e-sortdesc-filter";break}return n}},{key:"refreshFilterRange",value:function(e,t,i){var n=i;n||0===n||(n=this.parent.activeSheetIndex);for(var r=e||this.filterRange.get(n).slice(),a=r[1];a<=r[3];a++){var s=this.parent.getCell(r[0],a);if(t){if(s&&s.hasChildNodes()){var o=s.querySelector(".e-filter-btn");o&&s.removeChild(o)}}else this.renderFilterCellHandler({td:s,rowIndex:r[0],colIndex:a,sIdx:n})}this.parent.sortCollection&&this.parent.notify("sortImport",null)}},{key:"isFilterCell",value:function(e,t,i){var n=this.filterRange.get(e);return n&&n[0]===t&&n[1]<=i&&n[3]>=i}},{key:"isFilterRange",value:function(e,t,i){var n=this.filterRange.get(e);return n&&n[0]<=t&&n[2]>=t&&n[1]<=i&&n[3]>=i}},{key:"getFilteredColumnHandler",value:function(e){var t=this.parent.activeSheetIndex,i=this.parent.serviceLocator.getService(kl);if(e.clearFilterText=i.getConstant("ClearFilter"),this.filterRange.has(t)){var n=this.filterCollection.get(t);if(e.isClearAll)return void(e.isFiltered=n&&n.length>0);var r=this.filterRange.get(t).slice(),a=this.parent.getActiveSheet(),s=Zn(a.activeCell);if(this.isFilterRange(t,s[0],s[1])){e.field=Kn(s[1]+1);var o=Da(r[0],s[1],a),l=this.parent.getDisplayText(o);e.clearFilterText=i.getConstant("ClearFilterFrom")+'"'+(l?l.toString():"Column "+e.field)+'"',n.some(function(t){return e.isFiltered=t.field===e.field,e.isFiltered})}}}},{key:"cMenuBeforeOpenHandler",value:function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var i={isFiltered:!1};this.getFilteredColumnHandler(i),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!i.isFiltered,!0)}}},{key:"closeDialog",value:function(){var e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){var t=Object(f.N)(e,"dialog");f.l.remove(e,js(),this.filterMouseDownHandler),t&&t.hide(),this.removeFilterClass()}}},{key:"removeFilterClass",value:function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")}},{key:"isPopupOpened",value:function(){var e=document.querySelector(".e-filter-popup");return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display}},{key:"filterCellKeyDownHandler",value:function(e){var t=this.parent.activeSheetIndex,i=this.parent.getActiveSheet(),n=Zn(i.activeCell);if(this.isFilterCell(t,n[0],n[1])){e.isFilterCell=!0;var r=As(i,n),a=this.parent.getCell(n[0],n[1]);this.isPopupOpened()&&this.closeDialog(),this.openDialog(a,r.left,a?a.getBoundingClientRect().bottom:r.top)}else e.isFilterCell=!1}},{key:"filterMouseDownHandler",value:function(e){if(!f.d.isDevice||"mousedown"!==e.type){var t=e.target;if(t.classList.contains("e-filter-icon")){if(this.isPopupOpened())return void this.closeDialog();this.openDialog(t,e.x,t.getBoundingClientRect().bottom)}else this.isPopupOpened()&&(t.classList.contains("e-searchinput")||t.classList.contains("e-searchclear")||!t.offsetParent||t.offsetParent.classList.contains("e-filter-popup")?this.selectSortItemHandler(t):this.closeDialog())}}},{key:"openDialog",value:function(e,t,i){var n=this,r=Object(k.bb)(e,"e-cell"),a=parseInt(r.getAttribute("aria-colindex"),10),s=Kn(a);this.parent.showSpinner();var o=this.parent.activeSheetIndex,l=this.filterRange.get(o).slice(),h=this.parent.getActiveSheet(),c=Da(l[0],a-1,h),d=this.parent.getDisplayText(c);l[0]=l[0]+1,l[2]=h.usedRange.rowIndex,Na(this.parent,"".concat(h.name,"!").concat(Xn(l)),!0,!0,null,!0).then(function(r){var c;r.some(function(e,t){return e&&(c=new m.b(r.slice(t))),!!e});var u=n.parent.element.getBoundingClientRect();t-=u.left,i-=u.top,n.parent.element.style.position="relative",n.parent.element.classList.add("e-filter-open");var p={type:n.getColumnType(h,a,l),field:s,displayName:d||"Column "+s,dataSource:c,height:n.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:n.filterCollection.get(o),column:{field:s,filter:{}},handler:n.filterSuccessHandler.bind(n,new m.b(r)),target:e,position:{X:t,Y:i},localeObj:n.parent.serviceLocator.getService(kl)};new k.m(n.parent,n.getLocalizedCustomOperators()).openDialog(p);var g=document.querySelector(".e-filter-popup"),v=n.parent.element.getBoundingClientRect(),y=e.getBoundingClientRect();if(g){var b=y.right-g.offsetWidth;g.style.left=b<1?(b+g.offsetWidth-v.left).toString()+"px":(b-v.left).toString()+"px"}if(g&&g.id.includes(n.parent.element.id)){f.l.add(g,js(),n.filterMouseDownHandler,n),g.style.top="0px",g.style.visibility="hidden",g.classList.contains("e-hide")&&g.classList.remove("e-hide");var C=g.getBoundingClientRect().height;C<400&&(C=400);var x=u.height-i;g.style.top=(C>x?i-Math.abs(C-x):i)+"px",g.style.visibility=""}n.parent.hideSpinner()})}},{key:"filterDialogCreatedHandler",value:function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")}},{key:"filterCboxValueHandler",value:function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var i=Zn(t+e.data.dataObj.__rowIndex),n=Da(i[0],i[1],this.parent.getActiveSheet());n&&n.format&&(e.value=this.parent.getDisplayText(n))}}}},{key:"selectSortItemHandler",value:function(e){var t=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if(t){var i=this.parent.getActiveSheet(),n=this.parent.activeSheetIndex,r=this.filterRange.get(n).slice();r[0]=r[0]+1,r[2]=i.usedRange.rowIndex,this.parent.notify("applySort",{sortOptions:{sortDescriptors:{order:t}},range:Xn(r)});var a=Jn(i.activeCell);this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var s=0;s<this.parent.sortCollection.length;s++)this.parent.sortCollection[s]&&this.parent.sortCollection[s].sheetIndex===n&&this.parent.sortCollection.splice(s,1);this.parent.sortCollection.push({sortRange:Xn(r),columnIndex:a[1],order:t,sheetIndex:n}),this.refreshFilterRange(),this.closeDialog()}}},{key:"filterSuccessHandler",value:function(e,t){var i=t.sIdx;i||0===i||(i=this.parent.activeSheetIndex);for(var n=[].slice.call(this.filterCollection.get(i)),r=this.filterCollection.get(i),a=new m.b(r),s=new m.h,o=a.executeLocal(s.where("field","equal",t.field)),l=0;l<o.length;l++){for(var h=-1,c=0;c<r.length;c++)if(r[c].field===o[l].field){h=c;break}-1!==h&&r.splice(h,1)}if("filtering"===t.action&&(r=r.concat(t.filterCollection)).length)for(var d=0;d<r.length;d++)t.field=r[d].field;this.filterCollection.set(i,r);var u={datasource:e,predicates:this.getPredicates(i)};this.filterRange.get(i)[2]=Ka(this.parent,i).usedRange.rowIndex,this.applyFilter(u,Xn(this.filterRange.get(i)),i,n,t.isUndoRedo)}},{key:"applyFilter",value:function(e,t,i,n,r){var a=this,s={range:t,predicates:[].slice.call(this.filterCollection.get(i)),previousPredicates:n,cancel:!1};this.parent.notify(Ar,{action:"filter",eventArgs:s}),s.cancel||(this.parent.showSpinner(),this.parent.filter(e,t).then(function(e){return a.refreshFilterRange(),a.parent.notify("getFilteredCollection",null),a.parent.hideSpinner(),delete s.cancel,r||a.parent.notify(Rr,{action:"filter",eventArgs:s}),Promise.resolve(e)}).catch(function(e){return a.filterRangeAlertHandler({error:e}),Promise.reject(e)}))}},{key:"getPredicates",value:function(e){for(var t=[],i=k.d.getPredicate(this.filterCollection.get(e)),n=0,r=Object.keys(i);n<r.length;n++){var a=r[n];t.push(i[a])}return t}},{key:"getColumnType",value:function(e,t,i){for(var n=0,r=0,a=0,s=i[0];s<=e.usedRange.rowIndex;s++){var o=Da(s,t-1,e);if(o)if(o.format)switch(br(o.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":n++;break;case"shortdate":case"longdate":a++;break;case"time":n++;break;default:r++}else"string"==typeof o.value?r++:n++;else r++}return n>r&&n>a&&n>0?"number":r>n&&r>a&&r>0?"string":a>n&&a>r&&a>0?"date":"datetime"}},{key:"clearAllFilterHandler",value:function(){if(this.filterRange.has(this.parent.activeSheetIndex)){this.filterCollection.set(this.parent.activeSheetIndex,[]);for(var e=this.parent.filterCollection,t=0;t<e.length;t++)if(e[t].sheetIndex===this.parent.activeSheetIndex){e.splice(t,1);break}this.refreshFilterRange()}}},{key:"clearFilterHandler",value:function(e){this.filterSuccessHandler(null,{action:"clear-filter",filterCollection:[],field:e.field})}},{key:"reapplyFilterHandler",value:function(){var e=this.parent.activeSheetIndex;this.filterRange.has(e)&&this.applyFilter({predicates:this.getPredicates(e)},Xn(this.filterRange.get(e)),e)}},{key:"getFilterRangeHandler",value:function(e){var t=e.sheetIdx;this.filterRange&&this.filterRange.has(t)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(t)):(e.hasFilter=!1,e.filterRange=null)}},{key:"getLocalizedCustomOperators",value:function(){var e=this.parent.serviceLocator.getService(kl),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}}},{key:"getFilteredCollection",value:function(){for(var e,t=this.parent.sheets.length,i=[],n=0;n<t;n++){var r={sheetIdx:n,filterRange:void 0,hasFilter:void 0};if(this.getFilterRangeHandler(r),r.hasFilter){for(var a=[],s=[],o=[],l=[],h=[],c=this.filterCollection.get(r.sheetIdx),d=0;d<c.length;d++)if(c[d].field&&c[d].operator){var u=Zn(c[d].field+"1")[1];a.push(u),s.push(c[d].operator),o.push(Object(f.Z)(c[d].value)?"":c[d].value),l.push(c[d].type),h.push(c[d].predicate)}var p=Xn(r.filterRange);e={sheetIndex:r.sheetIdx,filterRange:p,hasFilter:r.hasFilter,column:a,criteria:s,value:o,dataType:l,predicates:h},i.push(e)}}e&&(this.parent.filterCollection=i)}},{key:"updateFilter",value:function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var t=0;t<this.parent.filterCollection.length;t++){var i=this.parent.filterCollection[t],n=i.sheetIndex;0===t&&(n=0);var r=[];if(i.column)for(var a=0;a<i.column.length;a++){var s={field:Yn(0,i.column[a]).charAt(0),operator:this.getFilterOperator(i.criteria[a]),value:i.value[a].toString().split("*").join(""),predicate:i.predicates&&i.predicates[a]};r.push(s)}for(var o=0;o<r.length-1;o++)r[o].field===r[o+1].field&&(r[o].predicate||(r[o].predicate="or"),r[o+1].predicate||(r[o+1].predicate="or"));this.parent.notify("initiateFilterUI",{predicates:r!==[]?r:null,range:i.filterRange,sIdx:n})}this.parent.sortCollection&&this.parent.notify("sortImport",null)}}},{key:"getFilterOperator",value:function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal"}return e}},{key:"beforeInsertHandler",value:function(e){if("Column"===e.modelType){var i=Object(f.cb)(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(i)){var n=this.filterRange.get(i);(this.isFilterCell(i,n[0],e.index)||e.index<n[1])&&(n[3]+=e.model.length,e.index<=n[1]&&(n[1]+=e.model.length),this.filterCollection.get(i).forEach(function(t){var i=Gn(t.field);e.index<=i&&(t.field=Kn(i+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){t.sheetIndex===i&&e.index<=t.columnIndex&&(t.columnIndex+=e.model.length)}),this.getFilteredCollection())}}else if("Sheet"===e.modelType){var r,a=!1,s=t(Array.from(this.filterRange.keys()).sort().reverse());try{for(s.s();!(r=s.n()).done;){var o=r.value;e.index<=o&&(a=!0,this.filterRange.set(o+e.model.length,this.filterRange.get(o)),this.filterRange.delete(o),this.filterCollection.set(o+e.model.length,this.filterCollection.get(o)),this.filterCollection.delete(o))}}catch(l){s.e(l)}finally{s.f()}this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){e.index<=t.sheetIndex&&(t.sheetIndex+=e.model.length)}),a&&this.getFilteredCollection()}}},{key:"beforeDeleteHandler",value:function(e){if("Column"===e.modelType){var t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var i=!0,n=this.filterRange.get(t);if(e.start>=n[1]&&e.end<=n[3]?n[3]-=e.end-e.start+1:e.start<n[1]&&e.end<n[1]?(n[1]-=e.end-e.start+1,n[3]-=e.end-e.start+1):e.start<n[1]&&e.end>n[1]&&e.end<n[3]?(n[1]=e.start,n[3]-=e.end-e.start+1):i=!1,i){for(var r,a=this.filterCollection.get(t),s=a.length-1;s>=0;s--){var o=Gn(a[s].field);e.end<o?a[s].field=Kn(o-(e.end-e.start+1)+1):e.start<=o&&e.end>=o&&(r=!0)}var l=this.parent.sortCollection;if(l)for(var h=0;h<l.length;h++)if(l[h].sheetIndex===t){if(e.end<l[h].columnIndex){l[h].columnIndex=l[h].columnIndex-(e.end-e.start+1);break}if(e.start<=l[h].columnIndex&&e.end>=l[h].columnIndex){l.splice(h,1);break}}r&&this.parent.clearFilter(),this.getFilteredCollection()}}}}},{key:"deleteSheetHandler",value:function(e){if(!Object(f.cb)(e.sheetIndex)){var i,n,r=t(Array.from(this.filterRange.keys()).sort().reverse());try{for(r.s();!(n=r.n()).done;){var a=n.value;i=!0,e.sheetIndex===a?(this.filterRange.delete(a),this.filterCollection.delete(a)):e.sheetIndex<a?(this.filterRange.set(a-1,this.filterRange.get(a)),this.filterRange.delete(a),this.filterCollection.set(a-1,this.filterCollection.get(a)),this.filterCollection.delete(a)):i=!1}}catch(l){r.e(l)}finally{r.f()}var s=this.parent.sortCollection;if(s)for(var o=s.length-1;o>=0;o--)e.sheetIndex===s[o].sheetIndex?s.splice(o,1):e.sheetIndex<s[o].sheetIndex&&(s[o].sheetIndex-=1);i&&this.getFilteredCollection()}}},{key:"clearHanlder",value:function(e){var t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){var i=this.filterRange.get(t.sheetIndex).slice();Ia(t.indices,i[0],i[1])&&Ia(t.indices,i[0],i[3])&&this.removeFilter(t.sheetIndex)}}}]),e}(),Go=function(){function e(t){a(this,e),this.pictureCount=1,this.parent=t,this.addEventListener(),this.renderImageUpload()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("insertImage",this.insertImage,this),this.parent.on("refreshImgElem",this.refreshImgElem,this),this.parent.on("refreshImgCellObj",this.refreshImgCellObj,this),this.parent.on("createImageElement",this.createImageElement,this),this.parent.on("deleteImage",this.deleteImage,this),this.parent.on("refreshImagePosition",this.refreshInsDelImagePosition,this)}},{key:"renderImageUpload",value:function(){var e=this.parent.element.id+"_imageUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.imageSelect.bind(this),t.style.display="none"}},{key:"imageSelect",value:function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var i={file:t};0===i.file.type.indexOf("image")?this.insertImage(i):this.parent.serviceLocator.getService(Il).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),document.getElementById(this.parent.element.id+"_imageUpload").value=""}}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("insertImage",this.insertImage),this.parent.off("refreshImgCellObj",this.refreshImgCellObj),this.parent.off("createImageElement",this.createImageElement),this.parent.off("deleteImage",this.deleteImage),this.parent.off("refreshImagePosition",this.refreshInsDelImagePosition))}},{key:"insertImage",value:function(e,t){var i=this;this.binaryStringVal(e).then(function(e){return i.createImageElement({options:{src:e},range:t,isPublic:!0})})}},{key:"binaryStringVal",value:function(e){return new Promise(function(t,i){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return i(e)}})}},{key:"createImageElement",value:function(e){var t=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?Wa(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,n=this.parent.serviceLocator.getService(Ol),r=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,a=Wn(t),s=i?this.parent.sheets[i]:this.parent.getActiveSheet();if(!document.getElementById(r)){var o={requestType:"beforeInsertImage",range:s.name+"!"+t,imageData:e.options.src,sheetIndex:i};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:o,action:"beforeInsertImage"}),!o.cancel){var l=n.insertOverlayElement(r,t,i);l.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(l.style.height=e.options.height+"px",l.style.width=e.options.width+"px",l.style.top=e.options.top+"px",l.style.left=e.options.left+"px"),(s.frozenRows||s.frozenColumns)&&n.adjustFreezePaneSize(e.options,l,t),e.options.imageId||this.pictureCount++;var h={src:e.options.src,id:r,height:parseFloat(l.style.height.replace("px","")),width:parseFloat(l.style.width.replace("px","")),top:s.frozenRows||s.frozenColumns?a[0]?ps(s,0,a[0]-1):0:parseFloat(l.style.top.replace("px","")),left:s.frozenRows||s.frozenColumns?a[1]?vs(s,0,a[1]-1):0:parseFloat(l.style.left.replace("px",""))};this.parent.setUsedRange(a[0],a[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify("setImage",{options:[h],range:s.name+"!"+t});var c=Da(a[0],a[1],s);c.image[c.image.length-1].id||(c.image[c.image.length-1].id=h.id),o={requestType:"insertImage",range:s.name+"!"+t,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:r,sheetIndex:i},!e.isUndoRedo&&e.isPublic&&this.parent.notify("actionComplete",{eventArgs:o,action:"insertImage"})}}}},{key:"refreshImgElem",value:function(){var e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&Object(f.lb)([e],"e-ss-overlay-active")}},{key:"refreshInsDelImagePosition",value:function(e){for(var t,i,n,r=e.count,a=Da(e.rowIdx,e.colIdx,this.parent.sheets[e.sheetIdx]),s=a.image.length,o=0;o<s;o++)t=document.getElementById(a.image[o].id),i="Row"===e.type?"insert"===e.status?a.image[o].top+20*r:a.image[o].top-20*r:a.image[o].top,n="Column"===e.type?"insert"===e.status?a.image[o].left+64*r:a.image[o].left-64*r:a.image[o].left,a.image[o].top=i,a.image[o].left=n,t.style.top=i+"px",t.style.left=n+"px"}},{key:"refreshImgCellObj",value:function(e){var t,i,n=this.parent.getActiveSheet(),r=Da(e.prevRowIdx,e.prevColIdx,n),a=Da(e.currentRowIdx,e.currentColIdx,n),s=r?r.image:[],o=s&&s.length?s.length:0;if(r&&r.image&&s.length>0){for(var l=0;l<o;l++)s[l]&&s[l].id===e.id&&((t=s[l]).height=e.currentHeight,t.width=e.currentWidth,t.top=e.currentTop,t.left=e.currentLeft,s.splice(l,1));a&&a.image&&(i=a.image,t&&i.push(t)),Ma(e.currentRowIdx,e.currentColIdx,n,i?{image:i}:{image:[t]},!0),"imageRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex},action:"imageRefresh"})}}},{key:"deleteImage",value:function(e){var t,i,n=this.parent.getActiveSheet(),r=document.getElementById(e.id);if(r){var a,s;if(n.frozenRows||n.frozenColumns){var o=r.getBoundingClientRect();a={clientY:o.top},s={clientX:o.left},o.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(a.target=this.parent.getColumnHeaderContent()),o.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(s.target=this.parent.getRowHeaderTable())}else a={clientY:r.offsetTop,isImage:!0},s={clientX:r.offsetLeft,isImage:!0};this.parent.notify("getRowIdxFromClientY",a),this.parent.notify("getColIdxFromClientX",s),document.getElementById(e.id).remove(),t=a.clientY,i=s.clientX,n=this.parent.sheets[this.parent.activeSheetIndex]}else{var l=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,h=e.range&&e.range.indexOf("!")>0?Wa(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,c=Wn(l);t=c[0],i=c[1],n=this.parent.sheets[h]}for(var d=Da(t,i,n).image,u=d.length,p=0;p<u;p++)d[p].id===e.id&&d.splice(p,1);Ma(t,i,n,{image:d},!0)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"getModuleName",value:function(){return"spreadsheetImage"}}]),e}();kn.Inject(function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e){var i,n,r,a=this.getSideBySideInfo(e),s=Math.max(e.yAxis.visibleRange.min,0),o=t(e.points);try{for(o.s();!(r=o.n()).done;){var l=r.value;l.symbolLocations=[],l.regions=[],l.visible&&xt(e.points[l.index-1],l,e.points[l.index+1],e)&&(i=this.getRectangle(l.xValue+a.start,l.yValue,l.xValue+a.end,s,e),(n=this.triggerEvent(e,l,"Indicator"===e.category?l.color:e.interior,{width:e.border.width,color:e.border.color})).cancel||(this.updateSymbolLocation(l,i,e),this.drawRectangle(e,l,i,n)))}}catch(h){o.e(h)}finally{o.f()}this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.animate(e)}},{key:"getModuleName",value:function(){return"ColumnSeries"}},{key:"destroy",value:function(){}}]),n}(Rn),function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e,i,n,r){var a,s,o,l="",h=null,c="M",d=e.chart&&"PolarRadar"===e.chart.chartAreaType,u=e.emptyPointSettings&&"Drop"===e.emptyPointSettings.mode,p=d?Lt:Qt,g="TrendLine"===e.category?e.points:this.enableComplexProperty(e),f=t(g);try{for(f.s();!(o=f.n()).done;){var m=o.value;m.regions=[],m.symbolLocations=[],m.visible&&xt(g[m.index-1],m,g[m.index+1],e)?(l+=this.getLineDirection(h,m,e,r,p,c),c=h?"L":c,h=m,this.storePointLocation(m,e,r,p)):(h=u?h:null,c=u?c:"M")}}catch(b){f.e(b)}finally{f.f()}if(d&&e.isClosed){var v=this.getFirstLastVisiblePoint(g);s=p(v.last.xValue,v.last.yValue,i,n,r,e),a=p(v.first.xValue,v.first.yValue,i,n,r,e),l=l.concat(c+" "+s.x+" "+s.y+" L "+a.x+" "+a.y)}var y=new U("Indicator"===e.category?e.chart.element.id+"_Indicator_"+e.index+"_"+e.name:"TrendLine"===e.category?e.chart.element.id+"_Series_"+e.sourceIndex+"_TrendLine_"+e.index:e.chart.element.id+"_Series_"+(void 0===e.index?e.category:e.index),"none",e.width,e.interior,e.opacity,e.dashArray,l);this.appendLinePath(y,e,""),this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.doProgressiveAnimation(e,e.animation)}},{key:"getModuleName",value:function(){return"LineSeries"}},{key:"destroy",value:function(){}}]),n}(On),function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e){var i,n,r,a=Math.max(e.yAxis.visibleRange.min,0),s=this.getSideBySideInfo(e),o=t(e.points);try{for(o.s();!(r=o.n()).done;){var l=r.value;l.symbolLocations=[],l.regions=[],l.visible&&xt(e.points[l.index-1],l,e.points[l.index+1],e)&&(i=this.getRectangle(l.xValue+s.start,l.yValue,l.xValue+s.end,a,e),(n=this.triggerEvent(e,l,e.interior,{width:e.border.width,color:e.border.color})).cancel||(this.updateSymbolLocation(l,i,e),this.drawRectangle(e,l,i,n)))}}catch(h){o.e(h)}finally{o.f()}this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.animate(e)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"BarSeries"}}]),n}(Rn),function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"render",value:function(e,t,i,n){var r,a=null,s="",o=e.chart&&"PolarRadar"===e.chart.chartAreaType,l=Math.max(e.yAxis.visibleRange.min,0);o&&(l=this.getFirstLastVisiblePoint(e.points).first.yValue);for(var h,c=e.emptyPointSettings&&"Drop"===e.emptyPointSettings.mode,d=e.border?e.border.width:0,u=e.border?e.border.color:"transparent",p="PolarRadar"===e.chart.chartAreaType?Lt:Qt,g=this.enableComplexProperty(e),f=0;f<g.length;f++)r=(h=g[f]).xValue,h.symbolLocations=[],h.regions=[],h.visible&&xt(g[f-1],h,g[f+1],e)&&(s+=this.getAreaPathDirection(r,l,e,n,p,a,"M"),a=a||new Ii(r,l),s+=this.getAreaPathDirection(r,h.yValue,e,n,p,null,"L"),g[f+1]&&!g[f+1].visible&&(!o||o&&this.withinYRange(g[f+1],i))&&!c&&(s+=this.getAreaEmptyDirection({x:r,y:l},a,e,n,p),a=null),this.storePointLocation(h,e,n,p));if(o&&""!==s){var m="",v=this.chart;m+=this.getAreaPathDirection(0,l,e,n,p,null,"L"),(t.isInversed||i.isInversed)&&(s+="Polar"===e.type?v.polarSeriesModule.getPolarIsInversedPath(t,m):v.radarSeriesModule.getRadarIsInversedPath(t,m)),s=s.concat(s+" Z")}this.appendLinePath(new U(e.chart.element.id+"_Series_"+e.index,e.interior,d,u,e.opacity,e.dashArray,e.points.length>1&&""!==s?s+this.getAreaPathDirection(e.points[e.points.length-1].xValue,"PolarRadar"===e.chart.chartAreaType?e.points[e.points.length-1].yValue:l,e,n,p,null,"L"):""),e,""),this.renderMarker(e)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"AreaSeries"}},{key:"doAnimation",value:function(e){this.doLinearAnimation(e,e.animation)}}]),i}(An),function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e){e.isRectSeries=!0;var i,n,r,a=this.getSideBySideInfo(e),s=e.stackedValues,o=gt(e),l=t(o);try{for(l.s();!(r=l.n()).done;){var h=r.value;h.symbolLocations=[],h.regions=[],h.visible&&xt(o[h.index-1],h,o[h.index+1],e)&&(i=this.getRectangle(h.xValue+a.start,s.endValues[h.index],h.xValue+a.end,s.startValues[h.index],e),(n=this.triggerEvent(e,h,e.interior,{width:e.border.width,color:e.border.color})).cancel||(this.drawRectangle(e,h,i,n),this.updateSymbolLocation(h,i,e)))}}catch(c){l.e(c)}finally{l.f()}this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.animate(e)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"StackingColumnSeries"}}]),n}(Rn),function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return o(i,[{key:"render",value:function(e,t,i,n){for(var r,a,s="PolarRadar"===e.chart.chartAreaType?Lt:Qt,o="",l=this.enableComplexProperty(e),h=l.length,c=e.stackedValues,d=0;d<h;d++)l[d].regions=[],l[d].symbolLocations=[],l[d].visible&&xt(l[d-1],l[d],l[d+1],e)?(r=s(l[d].xValue,c.endValues[d],t,i,n,e),o=o.concat((d?"L":"M")+" "+r.x+" "+r.y+" "),l[d].symbolLocations.push(s(l[d].xValue,c.endValues[d],t,i,n,e)),l[d].regions.push(new L(l[d].symbolLocations[0].x-e.marker.width,l[d].symbolLocations[0].y-e.marker.height,2*e.marker.width,2*e.marker.height))):"Drop"!==e.emptyPointSettings.mode&&l[d+1]&&l[d+1].visible&&(r=s(l[d+1].xValue,c.endValues[d+1],t,i,n,e),o=o.concat("M "+r.x+" "+r.y+" "));"PolarRadar"===e.chart.chartAreaType&&l.length>1&&(o+="L "+(a=s((r={y:c.endValues[0],x:e.points[0].xValue}).x,r.y,t,i,n,e)).x+" "+a.y+" ");var u=new U(e.chart.element.id+"_Series_"+e.index,"none",e.width,e.interior,e.opacity,e.dashArray,o);this.appendLinePath(u,e,""),this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.doLinearAnimation(e,e.animation)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"StackingLineSeries"}}]),i}(On),function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e){var i,n,r,a=this.getSideBySideInfo(e),s=e.stackedValues,o=t(e.points);try{for(o.s();!(r=o.n()).done;){var l=r.value;l.symbolLocations=[],l.regions=[],l.visible&&xt(e.points[l.index-1],l,e.points[l.index+1],e)&&(i=this.getRectangle(l.xValue+a.start,s.endValues[l.index],l.xValue+a.end,s.startValues[l.index],e),(n=this.triggerEvent(e,l,e.interior,{width:e.border.width,color:e.border.color})).cancel||(this.drawRectangle(e,l,i,n),this.updateSymbolLocation(l,i,e)))}}catch(h){o.e(h)}finally{o.f()}this.renderMarker(e)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"StackingBarSeries"}},{key:"doAnimation",value:function(e){this.animate(e)}}]),n}(Rn),function(){function e(){a(this,e)}return o(e,[{key:"render",value:function(e,i,n,r){e.isRectSeries=!1;var a,s,o,l=e.marker,h=this.enableComplexProperty(e),c="PolarRadar"===e.chart.chartAreaType?Lt:Qt,d=e.chart.redraw,u=t(h);try{for(u.s();!(o=u.n()).done;){var p=o.value;s=d&&p.symbolLocations?p.symbolLocations[0]:null,p.symbolLocations=[],p.regions=[],p.visible&&xt(h[p.index-1],p,h[p.index+1],e)&&(a={cancel:!1,name:"pointRender",series:e,point:p,fill:e.setPointColor(p,e.interior),border:e.setBorderColor(p,{width:e.border.width,color:e.border.color}),height:l.height,width:l.width,shape:l.shape},e.chart.trigger("pointRender",a),a.cancel?p.marker={visible:!0}:(p.symbolLocations.push(c(p.xValue,p.yValue,i,n,r,e)),p.color=a.fill,this.refresh(e,p,a,s)))}}catch(g){u.e(g)}finally{u.f()}}},{key:"enableComplexProperty",value:function(e){var i,n,r=[],a=[],s=e.yAxis.visibleRange,o=e.xAxis.visibleRange,l=e.clipRect,h=e.points,c=Math.abs(s.delta/l.height),d=Math.abs(o.delta/l.width),u=h[0]&&h[0].y>c?0:c,p=h[0]&&h[0].x>d?0:d,g=0,m=0,v=t(h);try{for(v.s();!(n=v.n()).done;){var y=n.value;y.symbolLocations=[],g=y.yValue?y.yValue:s.min,m=y.xValue?y.xValue:o.min,(Math.abs(u-g)>=c||Math.abs(p-m)>=d)&&(a.push(y),u=g,p=m)}}catch(C){v.e(C)}finally{v.f()}for(var b=0;b<a.length;b++)i=a[b],Object(f.Z)(i.x)||""===i.x||r.push(i);return r}},{key:"refresh",value:function(e,t,i,n){var r,a,s=e.chart,o=e.marker,l=i.point.marker.imageUrl||o.imageUrl,h=new U(s.element.id+"_Series_"+e.index+"_Point_"+t.index,i.fill,i.border.width,i.border.color,e.opacity,null);s.redraw&&Zt(h.id)&&(r="Circle"===i.shape?"c":"",a=Zt(h.id).getAttribute("d")),$t(!1,e.seriesElement,Wt(t.symbolLocations[0],i.shape,new E(i.width,i.height),l,h,(t.x.toString(),t.yValue.toString()),e.chart.svgRenderer,e.clipRect),s.redraw,!0,r+"x",r+"y",n,a),t.regions.push(new L(t.symbolLocations[0].x-o.width,t.symbolLocations[0].y-o.height,2*o.width,2*o.height)),t.marker={border:i.border,fill:i.fill,height:i.height,visible:!0,width:i.width,shape:i.shape,imageUrl:l}}},{key:"doAnimation",value:function(e){var i,n=e.animation.duration,r=e.animation.delay,a=e.seriesElement.childNodes,s=1,o=t(e.points);try{for(o.s();!(i=o.n()).done;){var l=i.value;l.symbolLocations.length&&a[s]&&(Nt(a[s],r,n,e,l.index,l.symbolLocations[0],!1),s++)}}catch(h){o.e(h)}finally{o.f()}}},{key:"getModuleName",value:function(){return"ScatterSeries"}},{key:"destroy",value:function(){}}]),e}()),kn.Inject(function(e){l(n,e);var i=c(n);function n(){return a(this,n),i.apply(this,arguments)}return o(n,[{key:"render",value:function(e,t,i,n){var r,a,s="PolarRadar"===e.chart.chartAreaType,o=s?Lt:Qt,l="",h=this.enableComplexProperty(e),c=h.length,d=e.stackedValues,u=s?Math.max(e.yAxis.visibleRange.min,d.endValues[0]):Math.max(e.yAxis.visibleRange.min,d.startValues[0]),p=0;c>0&&(r=o(h[0].xValue,u,t,i,n,e),l=l.concat("M "+r.x+" "+r.y+" "));for(var g=e.chart&&"PolarRadar"===e.chart.chartAreaType,f=0;f<c;f++)if(h[f].symbolLocations=[],h[f].regions=[],h[f].visible&&xt(h[f-1],h[f],h[f+1],e))r=o(h[f].xValue,d.endValues[f],t,i,n,e),l=l.concat("L "+r.x+" "+r.y+" "),h[f].symbolLocations.push(o(h[f].xValue,d.endValues[f],t,i,n,e)),h[f].regions.push(new L(h[f].symbolLocations[0].x-e.marker.width,h[f].symbolLocations[0].y-e.marker.height,2*e.marker.width,2*e.marker.height));else if(!g&&"Drop"!==e.emptyPointSettings.mode){for(var m=f-1;m>=p;m--)a=o(h[m].xValue,d.startValues[m],t,i,n,e),l=l.concat("L "+a.x+" "+a.y+" ");h[f+1]&&h[f+1].visible&&(!g||g&&this.withinYRange(h[f+1],i))&&(r=o(h[f+1].xValue,d.startValues[f+1],t,i,n,e),l=l.concat("M "+r.x+" "+r.y+" ")),p=f+1}if("PolarRadar"===e.chart.chartAreaType&&h.length>1){var v=this.getFirstLastVisiblePoint(e.points),y=this.chart;l+="L "+(a=o((r={x:v.first.xValue,y:d.endValues[v.first.index]}).x,r.y,t,i,n,e)).x+" "+a.y+" ",1===this.chart.visible&&(t.isInversed||i.isInversed)&&(this.chart.enableAnimation=!1,l="Polar"===e.type?y.polarSeriesModule.getPolarIsInversedPath(t,l):y.radarSeriesModule.getRadarIsInversedPath(t,l))}if(!g||g&&e.index!==this.getFirstSeriesIndex(e.chart.visibleSeries))for(var b=c-1;b>=p;b--)if(!g||h[b].visible){var C=this.getPreviousSeries(e);"Drop"===C.emptyPointSettings.mode&&C.points[b].isEmpty||(a=o(h[b].xValue,d.startValues[b],t,i,n,e),d.startValues[b]===d.endValues[b]&&(a.y=Math.floor(a.y)),l=l.concat((b===c-1&&s?"M":"L")+" "+a.x+" "+a.y+" "))}var x=new U(e.chart.element.id+"_Series_"+e.index,e.interior,e.border.width,e.border.color,e.opacity,e.dashArray,l);this.appendLinePath(x,e,""),this.renderMarker(e)}},{key:"doAnimation",value:function(e){this.doLinearAnimation(e,e.animation)}},{key:"destroy",value:function(){}},{key:"getModuleName",value:function(){return"StackingAreaSeries"}},{key:"getPreviousSeries",value:function(e){for(var t=e.chart.visibleSeries,i=0,n=t.length;i<n;i++)if(e.index===t[i].index&&0!==i)return t[i-1];return t[0]}},{key:"getFirstSeriesIndex",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;if(r.visible)return r.index}}catch(a){n.e(a)}finally{n.f()}return 0}}]),n}(On),function(e){l(i,e);var t=c(i);function i(e){return a(this,i),t.call(this,e)}return o(i,[{key:"calculateRangeAndInterval",value:function(e,t){this.calculateRange(t),this.getActualRange(t,e),this.applyRangePadding(t,e),this.calculateVisibleLabels(t)}},{key:"getActualRange",value:function(e,t){this.initializeDoubleRange(e),e.actualRange={},e.actualRange.interval=e.interval?Math.ceil(e.interval):Math.max(1,Math.floor(e.doubleRange.delta/Ut(t,e))),e.actualRange.min=e.doubleRange.start,e.actualRange.max=e.doubleRange.end,e.actualRange.delta=e.doubleRange.delta}},{key:"applyRangePadding",value:function(e,t){var i="BetweenTicks"===e.labelPlacement&&"PolarRadar"!==this.chart.chartAreaType?.5:0;i>0?(e.actualRange.min-=i,e.actualRange.max+=i):e.actualRange.max+=e.actualRange.max?0:.5,e.doubleRange=new qe(e.actualRange.min,e.actualRange.max),e.actualRange.delta=e.doubleRange.delta,this.calculateVisibleRange(t,e)}},{key:"calculateVisibleLabels",value:function(e){e.visibleLabels=[];var t,i,n=Math.ceil(e.visibleRange.min);for((e.zoomFactor<1||e.zoomPosition>0)&&(n=e.visibleRange.min-e.visibleRange.min%e.visibleRange.interval),e.startLabel=e.labels[Math.round(e.visibleRange.min)],e.endLabel=e.labels[Math.floor(e.visibleRange.max)];n<=e.visibleRange.max;n+=e.visibleRange.interval)t=Object(f.L)({},Object(f.X)("properties",e.labelStyle),null,!0),bt(n,e.visibleRange)&&e.labels.length>0&&(i=Math.round(n),_t(this.chart,i,e.labels[i]?e.labels[i].toString():i.toString(),t,e));e.getMaxLabelWidth&&e.getMaxLabelWidth(this.chart)}},{key:"getModuleName",value:function(){return"Category"}},{key:"destroy",value:function(){}}]),i}(In),function(e){l(n,e);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).library=u(t),t.addEventListener(),t}return o(n,[{key:"addEventListener",value:function(){this.chart.isDestroyed||(this.chart.on(f.d.touchMoveEvent,this.mouseMove,this),this.chart.on("click",this.click,this),this.chart.on(f.d.touchEndEvent,this.mouseEnd,this))}},{key:"removeEventListener",value:function(){this.chart.isDestroyed||(this.chart.off(f.d.touchMoveEvent,this.mouseMove),this.chart.off("click",this.click),this.chart.off(f.d.touchEndEvent,this.mouseEnd))}},{key:"mouseMove",value:function(e){this.chart.legendSettings.visible&&!this.chart.isTouch&&(this.move(e),this.chart.highlightModule&&"None"!==this.chart.highlightMode&&this.click(e))}},{key:"mouseEnd",value:function(e){this.chart.legendSettings.visible&&this.chart.isTouch&&this.move(e)}},{key:"getLegendOptions",value:function(e,i){var n,r,a=this;this.legendCollections=[];var s=[];e.length>1&&(this.legend.mode="Series");var o,l=t(e);try{for(l.s();!(o=l.n()).done;){var h=o.value;if("Series"===this.legend.mode)"Indicator"!==h.category&&(n="PolarRadar"===i.chartAreaType?h.drawType:h.type,r=h.pointColorMapping&&h.points.length>0&&h.points[0].interior?h.points[0].interior:h.interior,this.legendCollections.push(new mn(h.name,r,h.legendShape,"TrendLine"===h.category?this.chart.series[h.sourceIndex].trendlines[h.index].visible:h.visible,n,h.legendImageUrl,h.marker.shape,h.marker.visible)));else if("Point"===this.legend.mode){var c,d=t(h.points);try{var u=function(){var e=c.value;n="PolarRadar"===i.chartAreaType?h.drawType:h.type,r=e.interior?e.interior:h.interior,0===a.legendCollections.filter(function(t){return t.text===e.x.toString()}).length&&a.legendCollections.push(new mn(e.x.toString(),r,h.legendShape,"TrendLine"===h.category?a.chart.series[h.sourceIndex].trendlines[h.index].visible:e.visible,n,"",h.marker.shape,h.marker.visible))};for(d.s();!(c=d.n()).done;)u()}catch(S){d.e(S)}finally{d.f()}}else if("Range"===this.legend.mode){var p,g=t(h.points);try{for(g.s();!(p=g.n()).done;){var f=p.value;n="PolarRadar"===i.chartAreaType?h.drawType:h.type,r=f.interior?f.interior:h.interior;var m="Others";if(s.indexOf(r)<0&&(s.push(r),i.rangeColorSettings.length>=1&&1===i.rangeColorSettings[0].colors.length)){var v,y=t(i.rangeColorSettings);try{for(y.s();!(v=y.n()).done;){var b=v.value;b.colors[0]===r&&(m=b.label)}}catch(S){y.e(S)}finally{y.f()}this.legendCollections.push(new mn(m,r,h.legendShape,"TrendLine"===h.category?this.chart.series[h.sourceIndex].trendlines[h.index].visible:f.visible,n,"",h.marker.shape,h.marker.visible))}}}catch(S){g.e(S)}finally{g.f()}}else if(0===this.legendCollections.length&&i.rangeColorSettings.length>0){var C=i.rangeColorSettings[0].start.toString(),x=i.rangeColorSettings[i.rangeColorSettings.length-1].end.toString();this.legendCollections.push(new mn(C,h.interior,"Rectangle",!0,n,"",h.marker.shape,h.marker.visible)),this.legendCollections.push(new mn(x,h.interior,"Rectangle",!0,n,"",h.marker.shape,h.marker.visible))}}}catch(S){l.e(S)}finally{l.f()}}},{key:"getLegendBounds",value:function(e,i,n){this.calculateLegendTitle(n,i),this.isTitle=!!n.title;var r=n.padding,a=n.titlePosition,s=0,o=0,l=this.arrowWidth,h=this.isVertical&&!n.enablePages?this.arrowHeight:0,c=this.isTitle&&"Top"===a?this.legendTitleSize.height+this.fivePixel:0;c=this.isTitle&&this.isVertical&&"Top"!==a?this.legendTitleSize.height+this.fivePixel:c,this.isVertical?o=n.width?0:e.width/100*5:s=n.height?0:e.height/100*5,i.height+=s,i.width+=o;var d,u=n.shapeWidth,p=n.shapePadding,g=0,f=0,m=0,v=0,y=0,b=0;this.maxItemHeight=Math.max(R("MeasureText",n.textStyle).height,n.shapeHeight);var C,x=!1,S=t(this.legendCollections);try{for(S.s();!(C=S.n()).done;){var w=C.value;Ze.test(w.text)&&(w.text=bi(w.text,Ze)),Ge.test(w.text)&&(w.text=bi(w.text,Ge)),d={fill:w.fill,text:w.text,shape:w.shape,markerShape:w.markerShape,name:"legendRender",cancel:!1},this.chart.trigger("legendRender",d),w.render=!d.cancel,w.text=d.text,w.fill=d.fill,w.shape=d.shape,w.markerShape=d.markerShape,w.textSize=R(w.text,n.textStyle),w.render&&(x=!0,f+=m=u+p+w.textSize.width+r,n.enablePages||this.isVertical||(b=this.isTitle&&"Top"!==a?this.legendTitleSize.width+this.fivePixel:0,b+=l),(i.width<r+f+b||this.isVertical)&&(g=Math.max(g,f+r+b-(this.isVertical?0:m)),0===y&&m!==f&&(y=1),f=this.isVertical?0:m,v=++y*(this.maxItemHeight+r)+r+c+h))}}catch(k){S.e(k)}finally{S.f()}v=Math.max(v,this.maxItemHeight+r+r+c),this.isPaging=i.height<v,this.isPaging&&!n.enablePages&&(v=this.isVertical?v:this.maxItemHeight+r+r+("Top"===a?c:0)),this.totalPages=y,this.isPaging||this.isVertical||(f+=this.isTitle&&"Top"!==a?this.fivePixel+this.legendTitleSize.width+this.fivePixel:0),x?this.setBounds(Math.max(f+r,g),v,n,i):this.setBounds(0,0,n,i)}},{key:"getRenderPoint",value:function(e,t,i,n,r,a,s){var o=this.legend.padding,l=n.location.x+i+n.textSize.width;l+(e.textSize.width+i)>r.x+r.width+this.legend.shapeWidth/2||this.isVertical?(e.location.x=t.x,e.location.y=a===s?n.location.y:n.location.y+this.maxItemHeight+o):(e.location.x=a===s?n.location.x:l,e.location.y=n.location.y),e.text=ci(+(this.legendBounds.x+this.legendBounds.width-(e.location.x+i-this.legend.shapeWidth/2)).toFixed(4),e.text,this.legend.textStyle)}},{key:"LegendClick",value:function(e,i){var n=this.chart,r=n.visibleSeries["Series"===n.legendSettings.mode?e:0],a=this.legendCollections[e];if("Series"===n.legendSettings.mode){var s={legendText:a.text,legendShape:a.shape,chart:n.isBlazor?{}:n,series:r,points:r.points,name:"legendClick",cancel:!1};this.chart.trigger("legendClick",s),r.legendShape=s.legendShape,null!==r.fill&&(n.visibleSeries[e].interior=r.fill),n.legendSettings.toggleVisibility?("TrendLine"===r.category?n.series[r.sourceIndex].trendlines[r.index].visible=!n.series[r.sourceIndex].trendlines[r.index].visible:(r.chart.isProtectedOnChange=!0,this.changeSeriesVisiblity(r,r.visible)),a.visible="TrendLine"===r.category?n.series[r.sourceIndex].trendlines[r.index].visible:r.visible,this.refreshLegendToggle(n,r)):n.selectionModule?n.selectionModule.legendSelection(n,e,i):n.highlightModule&&n.highlightModule.legendSelection(n,e,i),r.chart.isProtectedOnChange=!1}else if("Point"===n.legendSettings.mode){var o=r.points[e];this.chart.trigger("legendClick",{legendText:a.text,legendShape:a.shape,chart:n.isBlazor?{}:n,series:r,points:[o],name:"legendClick",cancel:!1}),n.legendSettings.toggleVisibility&&(o.visible=!o.visible,this.legendCollections[e].visible=o.visible,this.refreshLegendToggle(n,r))}else if("Range"===n.legendSettings.mode){var l,h=[],c=this.legendCollections[e],d=t(r.points);try{for(d.s();!(l=d.n()).done;){var u=l.value;c.fill===(u.interior||r.interior)&&h.push(u)}}catch(m){d.e(m)}finally{d.f()}if(this.chart.trigger("legendClick",{legendText:a.text,legendShape:a.shape,chart:n.isBlazor?{}:n,series:r,points:h,name:"legendClick",cancel:!1}),n.legendSettings.toggleVisibility){c.visible=!c.visible;var p,g=t(h);try{for(g.s();!(p=g.n()).done;){var f=p.value;f.visible=!f.visible}}catch(m){g.e(m)}finally{g.f()}this.refreshLegendToggle(n,r)}}}},{key:"refreshLegendToggle",value:function(e,t){var i=[];if(e.selectionModule&&(i=Object(f.L)([],e.selectionModule.selectedDataIndexes,null,!0)),e.svgObject.childNodes.length>0&&!e.enableAnimation&&!e.enableCanvas){for(;e.svgObject.lastChild;)e.svgObject.removeChild(e.svgObject.lastChild);Object(f.kb)(e.svgObject)}e.animateSeries=!1,e.redraw=e.enableAnimation,e.rotatedDataLabelCollections=[],ft(M(e.element.id+"_Secondary_Element").querySelectorAll(".ejSVGTooltip")[0]),Ci(e),this.redrawSeriesElements(t,e),e.removeSvg(),e.refreshAxis(),t.refreshAxisLabel(),this.refreshSeries(e.visibleSeries),e.markerRender.removeHighlightedMarker(),e.refreshBound(),e.trigger("loaded",{chart:e}),i.length>0&&(e.selectionModule.selectedDataIndexes=i,e.selectionModule.redrawSelection(e,e.selectionMode)),e.highlightModule&&"None"!==e.highlightMode&&e.highlightModule.redrawSelection(e,e.highlightMode),e.redraw=!1}},{key:"changeSeriesVisiblity",value:function(e,t){e.visible=!t,this.isSecondaryAxis(e.xAxis)&&(e.xAxis.internalVisibility=e.xAxis.series.some(function(e){return e.visible})),this.isSecondaryAxis(e.yAxis)&&(e.yAxis.internalVisibility=e.yAxis.series.some(function(e){return e.visible}))}},{key:"isSecondaryAxis",value:function(e){return this.chart.axes.indexOf(e)>-1}},{key:"redrawSeriesElements",value:function(e,t){if(!t.redraw)return null;ft(t.element.id+"_Series_"+(void 0===e.index?e.category:e.index)+"_DataLabelCollections")}},{key:"refreshSeries",value:function(e){var i,n=t(e);try{for(n.s();!(i=n.n()).done;){i.value.position=void 0}}catch(r){n.e(r)}finally{n.f()}}},{key:"click",value:function(e){var t=this;if(this.chart.legendSettings.visible){for(var i,n,r=this.chart.mouseX,a=this.chart.mouseY,s=e.target.id,o=0,l=[this.legendID+"_text_",this.legendID+"_shape_marker_",this.legendID+"_shape_"];o<l.length;o++){var h=l[o];if(s.indexOf(h)>-1){n=parseInt(s.split(h)[1],10),this.LegendClick(n,e);break}}s.indexOf(this.legendID+"_pageup")>-1?this.changePage(e,!0):s.indexOf(this.legendID+"_pagedown")>-1&&this.changePage(e,!1),this.chart.enableCanvas&&this.pagingRegions.length&&this.checkWithinBounds(r,a),(i=this.legendRegions.filter(function(e){return jt(r,a+(t.isPaging?(t.currentPageNumber-1)*t.translatePage(null,1,2):0),e.rect)})).length&&this.chart.enableCanvas&&this.LegendClick(i[0].index,e)}}},{key:"checkWithinBounds",value:function(e,t){var i=this.chart.renderer,n=this.legendBounds,r=this.chart.legendSettings.border.width,a=new L(n.x,n.y,n.width,n.height);return a.x=a.x-r/2,a.y=a.y-r/2,a.width=a.width+r,a.height=a.height+r,jt(e,t,this.pagingRegions[0])?(--this.currentPageNumber>0?(this.legendRegions=[],i.clearRect(a),i.canvasClip(new Si("legendClipPath","transparent",{width:0,color:""},null,a)),this.renderLegend(this.chart,this.legend,n),i.canvasRestore()):++this.currentPageNumber,null):jt(e,t,this.pagingRegions[1])?(++this.currentPageNumber>0&&this.currentPageNumber<=this.totalNoOfPages?(this.legendRegions=[],i.clearRect(a),i.canvasClip(new Si("legendClipPath","transpaent",{width:0,color:""},null,a)),this.renderLegend(this.chart,this.legend,n),i.canvasRestore()):--this.currentPageNumber,null):void 0}},{key:"getModuleName",value:function(){return"Legend"}},{key:"destroy",value:function(){this.removeEventListener()}}]),n}(fn),w.c,function(){function e(t){a(this,e),this.errorHeight=0,this.chart=t}return o(e,[{key:"initPrivateVariables",value:function(e,t){var i="",n="",r=e.chart.renderer,a=void 0===e.index?e.category:e.index;"Cartesian"===e.chart.chartAreaType&&(i="translate("+e.clipRect.x+","+e.clipRect.y+")",n="url(#"+this.chart.element.id+"_ChartSeriesClipRect_"+a+")"),t.dataLabel.visible&&(e.shapeElement=r.createGroup({id:this.chart.element.id+"ShapeGroup"+a,transform:i,"clip-path":"url(#"+this.chart.element.id+"_ChartSeriesClipRect_"+a+")"}),e.textElement=r.createGroup({id:this.chart.element.id+"TextGroup"+a,transform:i,"clip-path":n})),this.markerHeight="Scatter"===e.type||t.visible?t.height/2:0,this.commonId=this.chart.element.id+"_Series_"+a+"_Point_",this.calculateErrorHeight(e,e.marker.dataLabel.position),this.chartBackground="transparent"===this.chart.chartArea.background?this.chart.background||this.chart.themeStyle.background:this.chart.chartArea.background}},{key:"calculateErrorHeight",value:function(e,t){if(!e.errorBar.visible)return null;if(e.errorBar.visible&&"PolarRadar"!==this.chart.chartAreaType){var i=e.errorBar.direction,n=this.chart.errorBarModule.positiveHeight,r=this.chart.errorBarModule.negativeHeight;this.isRectSeries(e)?("Top"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Minus"===i?r:0),"Outer"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Plus"===i?n:0)):("Top"!==t&&"Outer"!==t&&"Auto"!==t||(this.errorHeight="Both"!==i&&"Plus"!==i||e.chart.isTransposed?0:n),"Bottom"!==t&&"Auto"!==t||(this.errorHeight="Both"===i||"Minus"===i?r:0))}else this.errorHeight=0}},{key:"isRectSeries",value:function(e){return e.isRectSeries||"RangeArea"===e.type||"SplineRangeArea"===e.type}},{key:"render",value:function(e,i,n){var r;this.initPrivateVariables(e,e.marker);var a,s,o,l,h,c,d,u={x:0,y:0};this.inverted=i.requireInvertedAxis,this.yAxisInversed=e.yAxis.isInversed;for(var p,g,m,v=i.redraw,y=!1,b=[],C=i.element.id+"_Series_"+(void 0===e.index?e.category:e.index)+"_DataLabelCollections",x=Object(f.G)("div",{id:C}),S=gt(e),w=0;w<S.length;w++){if(p=S[w],!n.showZero&&(0!==p.y||0===p.y&&"Zero"===e.emptyPointSettings.mode))return null;this.margin=n.margin;var k=void 0,I=void 0,O=void 0,A=void 0,E=void 0,T=[],j=!0,M=e.clipRect,F=void 0;y=!1,c=d=n.angle,l={width:n.border.width,color:n.border.color};var P=Object(f.L)({},Object(f.X)("properties",n.font),null,!0);if(p.symbolLocations.length&&p.symbolLocations[0]||"BoxAndWhisker"===e.type&&p.regions.length){k=(T=ei(p,e,i)).length;for(var N=0;N<k;N++)if(o={cancel:!1,name:"textRender",series:e,point:p,text:T[N],border:l,color:n.fill,template:n.template,font:P,location:u,textSize:R(T[N],n.font)},i.trigger("textRender",o),!o.cancel)if(this.fontBackground=o.color,this.isDataLabelShape(o),this.markerHeight="Bubble"===e.type?p.regions[0].height/2:this.markerHeight,null!==o.template)this.createDataLabelTemplate(x,e,n,p,o,N,v);else{if(h=R(o.text,n.font),r=this.calculateTextPosition(p,e,h,n,N),"PolarRadar"===i.chartAreaType){var B,H=t(i.chartAxisLayoutPanel.visibleAxisLabelRect);try{for(H.s();!(B=H.n()).done;){var _=B.value;if(ni(new L(r.x,r.y,r.width,r.height),_)){j=!1;break}}}catch(q){H.e(q)}finally{H.f()}}var z=new L(r.x+M.x,r.y+M.y,r.width,r.height);if(n.enableRotation){if(b=Ot(this.getRectanglePoints(r),g=r.x+r.width/2,m=r.y+r.height/2,c),!(y=this.isDataLabelOverlapWithChartBound(b,i,M))){this.chart.rotatedDataLabelCollections.push(b);for(var V=this.chart.rotatedDataLabelCollections.length-1,U=V;U>=0;U--)if(this.chart.rotatedDataLabelCollections[V]&&this.chart.rotatedDataLabelCollections[U-1]&&Rt(this.chart.rotatedDataLabelCollections[V],this.chart.rotatedDataLabelCollections[U-1])){y=!0,this.chart.rotatedDataLabelCollections[V]=null;break}}}else y=ii(r,i.dataLabelCollections,M);y&&"None"!==n.labelIntersectAction||!j||(i.dataLabelCollections.push(z),this.isShape&&(F=i.renderer.drawRectangle(new Si(this.commonId+p.index+"_TextShape_"+N,o.color,o.border,n.opacity,r,n.rx,n.ry),new Int32Array([M.x,M.y])),e.shapeElement&&e.shapeElement.appendChild(F)),a=oi(li(this.fontBackground)),s=Math.round((299*a.r+587*a.g+114*a.b)/1e3),I=r.x+this.margin.left+h.width/2+u.x,O=r.y+this.margin.top+3*h.height/4+u.y,u={x:0,y:0},0!==c&&n.enableRotation?(A=g,E=m,d=c>360?c-360:c<-360?c+360:c):(d=0,A=r.x,E=r.y),pi(i.renderer,new D(this.commonId+p.index+"_Text_"+N,I,O,"middle",o.text,"rotate("+d+","+A+","+E+")","auto",d),o.font,o.font.color||(s>=128||"Hilo"===e.type?"black":"white"),e.textElement,!1,v,!0,!1,e.chart.duration,e.clipRect,0,null,i.enableCanvas))}}}x.childElementCount&&(i.enableCanvas?Zt(i.element.id+"_Secondary_Element").appendChild(x):$t(i.enableCanvas,Zt(i.element.id+"_Secondary_Element"),x,i.redraw,!1,"x","y",null,"",!1,!1,null,i.duration))}},{key:"getRectanglePoints",value:function(e){return[new Ii(e.x,e.y),new Ii(e.x+e.width,e.y),new Ii(e.x+e.width,e.y+e.height),new Ii(e.x,e.y+e.height)]}},{key:"isDataLabelOverlapWithChartBound",value:function(e,t,i){for(var n=0;n<e.length;n++)if(!jt(e[n].x+i.x,e[n].y+i.y,t.initialClipRect))return!0;return!1}},{key:"createDataLabelTemplate",value:function(e,t,i,n,r,a,s){this.margin={left:0,right:0,bottom:0,top:0};var o=t.clipRect,l=Xt(Object(f.G)("div",{id:this.chart.element.id+"_Series_"+(void 0===t.index?t.category:t.index)+"_DataLabel_"+n.index+(a?"_"+a:""),styles:"position: absolute;background-color:"+r.color+";"+Kt(i.font)+";border:"+r.border.width+"px solid "+r.border.color+";"}),n.index,r.template,this.chart,n,t,this.chart.element.id+"_DataLabel",a);this.calculateTemplateLabelSize(e,l,n,t,i,a,o,s)}},{key:"calculateTemplateLabelSize",value:function(e,t,i,n,r,a,s,o,l){var h=Jt(t,o,l),c=this.calculateTextPosition(i,n,{width:h.width,height:h.height},r,a),d=!1;l&&(d=0===h.width||0===h.height),t.style.left=("PolarRadar"===this.chart.chartAreaType?0:n.clipRect.x)+c.x-0+"px",t.style.top=("PolarRadar"===this.chart.chartAreaType?0:n.clipRect.y)+c.y+0+"px";var u=oi(li(this.fontBackground)),p=n.chart.requireInvertedAxis?n.xAxis:n.yAxis,g=n.chart.requireInvertedAxis?n.yAxis:n.xAxis;t.style.color=r.font.color||(Math.round((299*u.r+587*u.g+114*u.b)/1e3)>=128?"black":"white"),t.childElementCount&&!d&&(!ii(c,this.chart.dataLabelCollections,s)||"None"===r.labelIntersectAction)&&("XY"!==n.seriesType||void 0===i.yValue||bt(i.yValue,n.yAxis.visibleRange)||n.type.indexOf("Stacking")>-1||n.type.indexOf("100")>-1&&bt(n.stackedValues.endValues[i.index],n.yAxis.visibleRange))&&bt(i.xValue,n.xAxis.visibleRange)&&parseFloat(t.style.top)>=p.rect.y&&parseFloat(t.style.left)>=g.rect.x&&parseFloat(t.style.top)<=p.rect.y+p.rect.height&&parseFloat(t.style.left)<=g.rect.x+g.rect.width&&(this.chart.dataLabelCollections.push(new L(c.x+s.x,c.y+s.y,c.width,c.height)),$t(this.chart.enableCanvas,e,t,o,!0,"left","top"),n.animation.enable&&this.chart.animateSeries&&!this.chart.enableCanvas?this.doDataLabelAnimation(n,t):this.chart.enableCanvas&&e.appendChild(t))}},{key:"calculateTextPosition",value:function(e,t,i,n,r){var a,s=r>1&&"Candle"===t.type?e.regions[1]:e.regions[0];r>1&&"HiloOpenClose"===t.type&&(s=2===r?e.regions[1]:e.regions[2]),a=this.getLabelLocation(e,t,i,r);var o=t.clipRect;if(this.chart.requireInvertedAxis&&this.isRectSeries(t)&&"BoxAndWhisker"!==t.type){this.locationY=a.y;var l=i.width+this.borderWidth+this.margin.left+this.margin.right-5;a.x="Auto"===n.position?a.x:this.calculateAlignment(l,a.x,n.alignment,e.yValue<0),a.x=this.calculateRectPosition(a.x,s,e.yValue<0!==this.yAxisInversed,n.position,t,i,r,e)}else{this.locationX=a.x;var h=i.height+2*this.borderWidth+this.markerHeight+this.margin.bottom+this.margin.top+5;a.y="Auto"===n.position?a.y:this.calculateAlignment(h,a.y,n.alignment,!!this.isRectSeries(t)&&e.yValue<0),a.y=this.isRectSeries(t)&&"BoxAndWhisker"!==t.type?this.calculateRectPosition(a.y,s,e.yValue<0!==this.yAxisInversed,n.position,t,i,r,e):this.calculatePathPosition(a.y,n.position,t,e,i,r),this.isRectSeries(t)&&"PolarRadar"===this.chart.chartAreaType&&(a=this.calculatePolarRectPosition(a,n.position,t,e,i,r,n.alignment,h))}var c=ri(a,i,this.margin);return!0===n.enableRotation&&0!==n.angle||c.y>o.y+o.height||c.x>o.x+o.width||c.x+c.width<0||c.y+c.height<0||(c.x=c.x<0?5:c.x,c.y=c.y<0&&"None"!==n.labelIntersectAction?5:c.y,c.x-=c.x+c.width>o.x+o.width?c.x+c.width-(o.x+o.width)+5:0,c.y-=c.y+c.height>o.y+o.height?c.y+c.height-(o.y+o.height)+5:0,this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground),c}},{key:"calculatePolarRectPosition",value:function(e,t,i,n,r,a,s,o){var l,h=this.chart.availableSize.width,c="Center"===s?0:"Far"===s?1:-1,d=n.regionData.startAngle-.5*Math.PI+(n.regionData.endAngle-n.regionData.startAngle)/2;return l=0===a?n.regionData.radius<n.regionData.innerRadius?n.regionData.innerRadius:n.regionData.radius:n.regionData.radius>n.regionData.innerRadius?n.regionData.innerRadius:n.regionData.radius,this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground,i.drawType.indexOf("Stacking")>-1?t="Outer"===t?"Top":t:i.drawType.indexOf("Range")>-1&&(t="Outer"===t||"Top"===t?t:"Auto"),"Outer"===t?l=0===a?l+10+this.markerHeight:l-10-this.markerHeight:"Middle"===t?(l=l/2+5,"StackingColumn"===i.drawType&&(l=n.regionData.innerRadius+(n.regionData.radius-n.regionData.innerRadius)/2+5-r.height/2)):"Top"===t?l=0===a?l-10-this.markerHeight:l+10+this.markerHeight:"Bottom"===t?(l=10,l+="StackingColumn"===i.drawType?n.regionData.innerRadius+this.markerHeight:0):l=0===a?l>=i.chart.radius?l-5:"StackingColumn"===i.drawType?l-10:l+10:l>=i.chart.radius?l+5:l-10,l+=o*c,e.x=i.clipRect.width/2+i.clipRect.x+l*Math.cos(d),"StackingColumn"===i.drawType?e.x=e.x<h/2?e.x+r.width/2:e.x>h/2?e.x-r.width/2:e.x:"Column"===i.drawType&&(e.x=e.x<h/2?e.x-r.width/2:e.x>h/2?e.x+r.width/2:e.x),e.y=i.clipRect.height/2+i.clipRect.y+l*Math.sin(d),e}},{key:"getLabelLocation",value:function(e,t,i,n){var r=new Ii(0,0),a="Candle"===t.type&&n>1?e.regions[1]:e.regions[0];"HiloOpenClose"===t.type&&(a=2===n?e.regions[1]:e.regions[2]);var s=t.xAxis,o=t.yAxis,l=t.chart.requireInvertedAxis;if("BoxAndWhisker"===t.type){switch(this.markerHeight=0,n){case 0:r=Qt(e.xValue,e.median,s,o,l);break;case 1:r=Qt(e.xValue,e.maximum,s,o,l);break;case 2:r=Qt(e.xValue,e.minimum,s,o,l);break;case 3:r=Qt(e.xValue,e.upperQuartile,s,o,l);break;case 4:r=Qt(e.xValue,e.lowerQuartile,s,o,l);break;default:r=Qt(e.xValue,e.outliers[n-5],s,o,l),this.markerHeight=t.marker.height/2}l?r.y=e.regions[0].y+e.regions[0].height/2:r.x=e.regions[0].x+e.regions[0].width/2}else r=0===n||1===n?new Ii(e.symbolLocations[0].x,e.symbolLocations[0].y):2!==n&&3!==n||"Candle"!==t.type?l?{x:a.x+a.width/2,y:a.y}:{x:a.x+a.width,y:a.y+a.height/2}:new Ii(e.symbolLocations[1].x,e.symbolLocations[1].y);return n>1&&"HiloOpenClose"===t.type&&(t.chart.requireInvertedAxis?r.y=a.y+a.height/2+2*(2===n?1:-1):r.x=a.x+a.width/2+2*(2===n?1:-1)),r}},{key:"calculateRectPosition",value:function(e,t,i,n,r,a,s,o){if("PolarRadar"===r.chart.chartAreaType)return null;var l=this.margin,h=this.borderWidth+(this.inverted?a.width:a.height)/2+5;switch("StackingColumn100"===r.type||"StackingBar100"===r.type?n="Outer"===n?"Top":n:r.type.indexOf("Range")>-1?n="Outer"===n||"Top"===n?n:"Auto":"Waterfall"===r.type&&(n="Auto"===n?"Middle":n),n){case"Bottom":e=this.inverted?i?e+t.width-h-l.left:e-t.width+h+l.right:i?e-t.height+h+l.top:e+t.height-h-l.bottom;break;case"Middle":e=e=this.inverted?i?e+t.width/2:e-t.width/2:i?e-t.height/2:e+t.height/2;break;case"Auto":e=this.calculateRectActualPosition(e,t,i,r,a,s,o);break;default:h+=this.errorHeight,e=this.calculateTopAndOuterPosition(e,t,n,r,s,h,i)}this.fontBackground=(this.inverted?e<t.x||e>t.x+t.width:e<t.y||e>t.y+t.height)?"transparent"===this.fontBackground?this.chartBackground:this.fontBackground:"transparent"===this.fontBackground?o.color||r.interior:this.fontBackground;var c=r.chart.series.length;if("Outer"===n&&r.type.indexOf("Stacking")>-1&&c-1>r.index)for(var d,u,p=r.index+1;p<c;p++)if(u=(d=r.chart.series[p]).points[o.index],d.type.indexOf("Stacking")>-1&&-1===d.type.indexOf("100")){this.fontBackground=u&&(u.yValue<0&&o.yValue<0||u.yValue>0&&o.yValue>0)?u?u.color:d.interior:this.fontBackground;break}return e}},{key:"calculatePathPosition",value:function(e,t,i,n,r,a){switch(i.type.indexOf("Area")>-1&&"RangeArea"!==i.type&&"SplineRangeArea"!==i.type&&this.yAxisInversed&&"Auto"!==i.marker.dataLabel.position&&(t="Top"===t?"Bottom":"Bottom"===t?"Top":t),this.fontBackground="transparent"===this.fontBackground?this.chartBackground:this.fontBackground,t){case"Top":case"Outer":e=e-this.markerHeight-this.borderWidth-r.height/2-this.margin.bottom-5-this.errorHeight;break;case"Bottom":e=e+this.markerHeight+this.borderWidth+r.height/2+this.margin.top+5+this.errorHeight;break;case"Auto":e=this.calculatePathActualPosition(e,this.markerHeight,i,n,r,a)}return e}},{key:"isDataLabelShape",value:function(e){this.isShape="transparent"!==e.color||e.border.width>0,this.borderWidth=e.border.width,this.isShape||(this.margin={left:0,right:0,bottom:0,top:0})}},{key:"calculateRectActualPosition",value:function(e,t,i,n,r,a,s){for(var o,l,h=!0,c=0,d=this.chart.dataLabelCollections,u=-1!==n.type.indexOf("Range")||"Hilo"===n.type?2:4;h&&c<u;){var p=this.getPosition(c);n.type.indexOf("Stacking")>-1&&"Outer"===p&&(p="Top",c++),o=this.calculateRectPosition(e,t,i,p,n,r,a,s),this.inverted?h=(l=ri(new Ii(o,this.locationY),r,this.margin)).x<0||ii(l,d,n.clipRect)||l.x+l.width>n.clipRect.width:h=(l=ri(new Ii(this.locationX,o),r,this.margin)).y<0||ii(l,d,n.clipRect)||l.y>n.clipRect.height,c++}return o}},{key:"calculateAlignment",value:function(e,t,i,n){switch(i){case"Far":t=this.inverted?n?t-e:t+e:n?t+e:t-e;break;case"Near":t=this.inverted?n?t+e:t-e:n?t-e:t+e;break;case"Center":t=t}return t}},{key:"calculateTopAndOuterPosition",value:function(e,t,i,n,r,a,s){var o,l=this.margin;switch(n.type){case"RangeColumn":case"RangeArea":case"SplineRangeArea":case"Hilo":o=0===r&&!this.yAxisInversed||1===r&&this.yAxisInversed,e=this.updateLabelLocation(i,e,a,l,t,o);break;case"Candle":o=(0===r||2===r)&&!this.yAxisInversed||(1===r||3===r)&&this.yAxisInversed,e=this.updateLabelLocation(i,e,a,l,t,o,r>1);break;case"HiloOpenClose":r<=1?(o=0===r&&!this.yAxisInversed||1===r&&this.yAxisInversed,e=this.updateLabelLocation(i,e,a,l,t,o)):e=this.yAxisInversed?this.inverted?e-a-l.right:e+a+l.top:this.inverted?e+a+l.left:e-a-l.bottom;break;default:e=s&&"Top"===i||!s&&"Outer"===i?this.inverted?e+a+l.left+this.markerHeight:e-a-l.bottom-this.markerHeight:this.inverted?e-a-l.right-this.markerHeight:e+a+l.top+this.markerHeight}return e}},{key:"updateLabelLocation",value:function(e,t,i,n,r,a){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this.inverted?a?"Outer"!==e||s?t-i-n.right-this.markerHeight:t+i+n.left+this.markerHeight:"Outer"!==e||s?t-r.width+i+n.left+this.markerHeight:t-r.width-i-n.right-this.markerHeight:a?"Outer"!==e||s?t+i+n.top+this.markerHeight:t-i-n.bottom-this.markerHeight:"Outer"!==e||s?t+r.height-i-n.bottom-this.markerHeight:t+r.height+i+n.top+this.markerHeight}},{key:"calculatePathActualPosition",value:function(e,t,i,n,r,a){var s,o,l,h,c,d=i.points,u=n.index,p=d[u].yValue,g=d.length-1>u?d[u+1]:null,f=u>0?d[u-1]:null,m=!0,v=this.chart.dataLabelCollections;if("Bubble"===i.type)s="Top";else if(i.type.indexOf("Step")>-1)s="Top",u&&(s=f&&f.visible&&p>f.yValue===this.yAxisInversed&&p!==f.yValue?"Bottom":"Top");else if("BoxAndWhisker"===i.type)1===a||3===a||a>4?s=i.yAxis.isInversed?"Bottom":"Top":2===a||4===a?s=i.yAxis.isInversed?"Top":"Bottom":(m=!1,s="Middle",o=this.calculatePathPosition(e,s,i,n,r,a));else if(0===u)s=!g||!g.visible||p>g.yValue||p<g.yValue&&this.yAxisInversed?"Top":"Bottom";else if(u===d.length-1)s=!f||!f.visible||p>f.yValue||p<f.yValue&&this.yAxisInversed?"Top":"Bottom";else if(g.visible||f&&f.visible)if(g.visible&&f){var y=(g.yValue-f.yValue)/2,b=y*u+(g.yValue-y*(u+1));s=this.yAxisInversed?b<p?"Bottom":"Top":b<p?"Top":"Bottom"}else s=g.yValue>p||f&&f.yValue>p?"Bottom":"Top";else s="Top";for(h="Bottom"===s,c=["Outer","Top","Bottom","Middle","Auto"].indexOf(s);m&&c<4;)o=this.calculatePathPosition(e,this.getPosition(c),i,n,r,a),m=(l=ri(new Ii(this.locationX,o),r,this.margin)).y<0||ii(l,v,i.clipRect)||l.y+l.height>i.clipRect.height,c=h?c-1:c+1,h=!1;return o}},{key:"doDataLabelAnimation",value:function(e,t){for(var i,n,r=e.shapeElement.childNodes,a=e.textElement.childNodes,s=e.animation.delay+e.animation.duration,o=e.chart.animated?e.chart.duration:200,l=t?1:a.length,h=0;h<l;h++)n=a[h],t?(t.style.visibility="hidden",qt(t,s,o,"ZoomIn")):(i=new Ii(+n.getAttribute("x")+ +n.getAttribute("width")/2,+n.getAttribute("y")+ +n.getAttribute("height")/2),Nt(n,s,o,e,null,i,!0),r[h]&&(n=r[h],i=new Ii(+n.getAttribute("x")+ +n.getAttribute("width")/2,+n.getAttribute("y")+ +n.getAttribute("height")/2),Nt(n,s,o,e,null,i,!0)))}},{key:"getPosition",value:function(e){return["Outer","Top","Bottom","Middle","Auto"][e]}},{key:"getModuleName",value:function(){return"DataLabel"}},{key:"destroy",value:function(){}}]),e}()),qn.Inject(Vn,function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this,e)).accumulation=e,n.addEventListener(),n}return o(i,[{key:"addEventListener",value:function(){this.accumulation.isDestroyed||(this.accumulation.on(f.d.isPointer?"pointerleave":"mouseleave",this.mouseLeaveHandler,this),this.accumulation.on(f.d.touchMoveEvent,this.mouseMoveHandler,this),this.accumulation.on(f.d.touchEndEvent,this.mouseUpHandler,this))}},{key:"mouseLeaveHandler",value:function(e){this.removeTooltip(this.accumulation.tooltip.fadeOutDuration)}},{key:"mouseUpHandler",value:function(e){var t=this.accumulation;t.tooltip.enable&&t.isTouch&&jt(t.mouseX,t.mouseY,t.initialClipRect)&&(this.tooltip(e),this.removeTooltip(2e3))}},{key:"mouseMoveHandler",value:function(e){var t=this.accumulation;t.tooltip.enable&&jt(t.mouseX,t.mouseY,t.initialClipRect)&&this.tooltip(e)}},{key:"tooltip",value:function(e){var t=this.getElement(this.element.id+"_tooltip_svg"),i=t&&parseInt(t.getAttribute("opacity"),10)>0,n=this.getTooltipElement(i);this.renderSeriesTooltip(e,this.accumulation,!i,n)}},{key:"renderSeriesTooltip",value:function(e,t,i,n){var r=this.getPieData(e,t,t.mouseX,t.mouseY);if(this.currentPoints=[],!r.point||this.previousPoints[0]&&this.previousPoints[0].point===r.point)!r.point&&this.isRemove&&(this.removeTooltip(this.accumulation.tooltip.fadeOutDuration),this.isRemove=!1);else{if(this.previousPoints[0]&&r.point.index===this.previousPoints[0].point.index&&r.series.index===this.previousPoints[0].series.index)return null;this.pushData(r,i,n,!1)&&this.triggerTooltipRender(r,i,this.getTooltipText(r,t.tooltip),this.findHeader(r))}}},{key:"triggerTooltipRender",value:function(e,t,i,n){var r=this,a={cancel:!1,name:"tooltipRender",text:i,point:e.point,textStyle:this.textStyle,series:this.accumulation.isBlazor?{}:e.series,headerText:n,data:{pointX:e.point.x,pointY:e.point.y,seriesIndex:e.series.index,pointIndex:e.point.index,pointText:e.point.text,seriesName:e.series.name}},s=function(i){i.cancel?(r.removeHighlight(),Object(f.kb)(r.getElement(r.element.id+"_tooltip"))):(r.formattedText=r.formattedText.concat(i.text),r.text=r.formattedText,r.headerText=i.headerText,r.createTooltip(r.chart,t,e.point.symbolLocation,e.series.clipRect,e.point,["Circle"],0,r.chart.initialClipRect,null,e.point,r.accumulation.tooltip.template?i.template:"")),r.isRemove=!0};s.bind(this,e),this.chart.trigger("tooltipRender",a,s)}},{key:"getPieData",value:function(e,t,i,n){var r=Tt(e.target.id,!0);if(!isNaN(r.series)){var a=r.series,s=r.point;if(!(Object(f.Z)(a)||isNaN(a)||Object(f.Z)(s)||isNaN(s))){var o=this.getSeriesFromIndex(a,t.visibleSeries);if(o.enableTooltip)return new Ei(o.points[s],o)}}return new Ei(null,null)}},{key:"getSeriesFromIndex",value:function(e,t){return t[0]}},{key:"getTooltipText",value:function(e,t){var i=this.accumulation.useGroupingSeparator?"${point.x} : <b>${point.separatorY}</b>":"${point.x} : <b>${point.y}</b>";return i=t.format?t.format:i,this.parseTemplate(e.point,e.series,i)}},{key:"findHeader",value:function(e){return""===this.header?"":(this.header=this.parseTemplate(e.point,e.series,this.header),""!==this.header.replace(/<b>/g,"").replace(/<\/b>/g,"").trim()?this.header:"")}},{key:"parseTemplate",value:function(e,t,i){for(var n,r,a=0,s=Object.keys(e);a<s.length;a++){var o=s[a];n=new RegExp("${point."+o+"}","gm"),i=i.replace(n.source,e[o])}for(var l=0,h=Object.keys(Object.getPrototypeOf(t));l<h.length;l++){var c=h[l];n=new RegExp("${series."+c+"}","gm"),r=t[c],i=i.replace(n.source,r)}return i}},{key:"getModuleName",value:function(){return"AccumulationTooltip"}},{key:"destroy",value:function(e){}}]),i}(En),function(e){l(n,e);var i=c(n);function n(e){var t;if(a(this,n),(t=i.call(this,e)).rightSideRenderingPoints=[],t.leftSideRenderingPoints=[],t.id=e.element.id+"_datalabel_Series_",e.title){var r=R(e.title,e.titleStyle);t.titleRect=new L(e.availableSize.width/2-r.width/2,e.margin.top,r.width,r.height)}return d(t)}return o(n,[{key:"getDataLabelPosition",value:function(e,t,i,n){var r=this.isCircular()?this.isVariousRadius()?this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],e):this.accumulation.pieSeriesModule.labelRadius:this.getLabelDistance(e,t);this.getLabelRegion(e,t.position,i,r,this.marginValue),e.labelAngle=e.midAngle,e.labelPosition=t.position,this.accumulation.enableSmartLabels&&this.getSmartLabel(e,t,i,n)}},{key:"getLabelRegion",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=a||e.midAngle,o=kt(s,n,this.isCircular()?this.center:this.getLabelLocation(e,t));o.y="Inside"===t?o.y-i.height/2:o.y,o.x="Inside"===t?o.x-i.width/2:o.x,e.labelRegion=new L(o.x,o.y,i.width+2*r,i.height+2*r),"Outside"===t&&(e.labelRegion.y-=e.labelRegion.height/2,s>=90&&s<=270?e.labelRegion.x-=e.labelRegion.width+10:e.labelRegion.x+=10)}},{key:"getSmartLabel",value:function(e,t,i,n){var r=this.isCircular(),a=r?this.radius:this.getLabelDistance(e,t);a+=di(r?t.connectorStyle.length||"4%":"0px",a);var s,o,l=this.findPreviousPoint(n,e.index,e.labelPosition);if("Inside"===t.position?(e.labelRegion.height-=4,e.labelRegion.width-=4,(l&&l.labelRegion&&(ni(e.labelRegion,l.labelRegion)||this.isOverlapping(e,n))||!r&&!((s=e.region).x<=(o=e.labelRegion).x&&s.x+s.width>=o.x+o.width&&s.y<=o.y&&s.height+s.y>=o.y+o.height))&&(e.labelPosition="Outside",r||(a=this.getLabelDistance(e,t)),this.getLabelRegion(e,e.labelPosition,i,a,this.marginValue),(l=this.findPreviousPoint(n,e.index,e.labelPosition))&&(ni(e.labelRegion,l.labelRegion)||this.isConnectorLineOverlapping(e,l))&&this.setOuterSmartLabel(l,e,t.border.width,a,i,this.marginValue))):l&&l.labelRegion&&(ni(e.labelRegion,l.labelRegion)||this.isOverlapping(e,n)||this.isConnectorLineOverlapping(e,l))&&this.setOuterSmartLabel(l,e,t.border.width,a,i,this.marginValue),this.isOverlapping(e,n)&&("Pyramid"===this.accumulation.type||"Funnel"===this.accumulation.type)){var h=e.midAngle||0,c=r?this.radius:this.getLabelDistance(e,t),d=kt(h,-c,this.isCircular()?this.center:this.getLabelLocation(e,"OutsideLeft"));e.labelRegion=new L(d.x,d.y,i.width+2*this.marginValue,i.height+2*this.marginValue),e.labelRegion.y-=e.labelRegion.height/2,e.labelRegion.x=e.labelRegion.x-10-e.labelRegion.width,l&&l.labelRegion&&(ni(e.labelRegion,l.labelRegion)||this.isOverlapping(e,n)||this.isConnectorLineOverlapping(e,l))&&this.setOuterSmartLabel(l,e,t.border.width,c,i,this.marginValue)}}},{key:"move",value:function(e,i,n,r){var a=this;if(e.target.textContent.indexOf("...")>-1){var s=e.target.id.split(this.id);if(2===s.length){var o=parseInt(s[1].split("_text_")[0],10),l=parseInt(s[1].split("_text_")[1],10);if(!isNaN(o)&&!isNaN(l)){r&&ft(this.accumulation.element.id+"_EJ2_Datalabel_Tooltip");var h=function(e,i){var n,r=t(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(e===a.index)return a}}catch(s){r.e(s)}finally{r.f()}return i[0]}(o,this.accumulation.visibleSeries).points[l];vt(h.text||h.y.toString(),i,n,this.areaRect.width,this.accumulation.element.id+"_EJ2_Datalabel_Tooltip",Zt(this.accumulation.element.id+"_Secondary_Element"))}}}else ft(this.accumulation.element.id+"_EJ2_Datalabel_Tooltip");r&&(clearTimeout(this.clearTooltip),this.clearTooltip=+setTimeout(function(){ft(a.accumulation.element.id+"_EJ2_Datalabel_Tooltip")},1e3))}},{key:"findPreviousPoint",value:function(e,t,i){for(var n=e[0],r=t-1;r>=0;r--)if((n=e[r]).visible&&n.labelVisible&&n.labelRegion&&n.labelPosition===i)return n;return null}},{key:"isOverlapping",value:function(e,t){for(var i=e.index-1;i>=0;i--)if(t[i].visible&&t[i].labelVisible&&t[i].labelRegion&&e.labelRegion&&e.labelVisible&&ni(e.labelRegion,t[i].labelRegion))return!0;return!1}},{key:"textTrimming",value:function(e,t,i,n){if(ni(e.labelRegion,t)){var r=e.labelRegion.width;"Right"===n?r=t.x-e.labelRegion.x:"Left"===n?(r=e.labelRegion.x-(t.x+t.width))<0&&(r+=e.labelRegion.width,e.labelRegion.x=t.x+t.width):"InsideRight"===n?r=t.x+t.width-e.labelRegion.x:"InsideLeft"===n?(r=e.labelRegion.x+e.labelRegion.width-t.x)<e.labelRegion.width&&(e.labelRegion.x=t.x):this.setPointVisibileFalse(e),e.labelVisible&&e.labelRegion&&(r<e.labelRegion.width&&(e.label=ci(r-2*this.marginValue,e.label,i),e.labelRegion.width=r),3===e.label.length&&e.label.indexOf("...")>-1&&this.setPointVisibileFalse(e))}}},{key:"setPointVisibileFalse",value:function(e){e.labelVisible=!1,e.labelRegion=null}},{key:"setPointVisibleTrue",value:function(e){e.labelVisible=!0}},{key:"setOuterSmartLabel",value:function(e,t,i,n,r,a){if(this.isCircular()){var s=this.getOverlappedAngle(e.labelRegion,t.labelRegion,t.midAngle,2*i);for(this.getLabelRegion(t,"Outside",r,n,a,s),s>t.endAngle&&(s=t.midAngle),t.labelAngle=s;t.labelVisible&&(ni(e.labelRegion,t.labelRegion)||s<=e.labelAngle||this.isConnectorLineOverlapping(t,e))&&!(s>t.endAngle);)t.labelAngle=s,this.getLabelRegion(t,"Outside",r,n,a,s),s+=.1}else this.setSmartLabelForSegments(t,e)}},{key:"setSmartLabelForSegments",value:function(e,t){var i=e.labelRegion,n="Funnel"===this.accumulation.type?t.labelRegion.y-(i.y+i.height):e.labelRegion.y-(t.labelRegion.y+t.labelRegion.height);n<0&&(e.labelRegion.y+="Funnel"===this.accumulation.type?n:-n)}},{key:"isConnectorLineOverlapping",value:function(e,t){var i;!this.isCircular()&&e.labelRegion.x<e.region.x&&(i="outsideLeft");var n=this.getLabelLocation(e,i),r=new Ii(0,0);this.getEdgeOfLabel(e.labelRegion,e.labelAngle,r,0,e);var a=this.getLabelLocation(t),s=new Ii(0,0);return this.getEdgeOfLabel(t.labelRegion,t.labelAngle,s,0,e),this.isLineRectangleIntersect(n,r,e.labelRegion)||this.isLineRectangleIntersect(n,r,t.labelRegion)||this.isLineRectangleIntersect(a,s,e.labelRegion)}},{key:"isLineRectangleIntersect",value:function(e,t,i){var n=[new Ii(Math.round(i.x),Math.round(i.y)),new Ii(Math.round(i.x+i.width),Math.round(i.y)),new Ii(Math.round(i.x+i.width),Math.round(i.y+i.height)),new Ii(Math.round(i.x),Math.round(i.y+i.height))];e.x=Math.round(e.x),e.y=Math.round(e.y),t.x=Math.round(t.x),t.y=Math.round(t.y);for(var r=0;r<n.length;r++)if(this.isLinesIntersect(e,t,n[r],n[(r+1)%n.length]))return!0;return!1}},{key:"isLinesIntersect",value:function(e,t,i,n){var r=t.y-e.y,a=e.x-t.x,s=r*e.x+a*e.y,o=n.y-i.y,l=i.x-n.x,h=o*i.x+l*i.y,c=r*l-o*a;if(0!==c){var d=(l*s-a*h)/c,u=(r*h-o*s)/c,p=Math.min(e.x,t.x)<=d&&d<=Math.max(e.x,t.x);return p=(p=(p=p&&Math.min(e.y,t.y)<=u&&u<=Math.max(e.y,t.y))&&Math.min(i.x,n.x)<=d&&d<=Math.max(i.x,n.x))&&Math.min(i.y,n.y)<=u&&u<=Math.max(i.y,n.y)}return!1}},{key:"getOverlappedAngle",value:function(e,t,i,n){var r=e.x;return i>=90&&i<=270?(t.y=e.y-(n+t.height/2),r=e.x+e.width):t.y=e.y+e.height+n,function(e,t){var i=Math.atan2(t.y-e.y,t.x-e.x);return(i=i<0?6.283+i:i)*(180/Math.PI)}(this.center,new Ii(r,t.y))}},{key:"getConnectorPath",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i.connectorStyle,a=this.isCircular()?this.isVariousRadius()?this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],t):this.labelRadius:this.getLabelDistance(t,i),s=this.getConnectorStartPoint(t,r),o=this.accumulation.enableSmartLabels?t.midAngle:n||t.midAngle,l=new Ii(0,0),h=this.getEdgeOfLabel(e,o,l,r.width,t);if("Curve"===r.type){if(this.isCircular()){var c=a-(this.isVariousRadius()?di(t.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius);return t.isLabelUpdated?l=this.getPerpendicularDistance(s,t):(l=kt(o,a-c/2,this.center),"Outside"===t.labelPosition&&"Inside"===i.position&&(l=kt(o,a-1.25*c,this.center))),"M "+s.x+" "+s.y+" Q "+l.x+" "+l.y+" "+h.x+" "+h.y}return this.getPolyLinePath(s,h)}return"M "+s.x+" "+s.y+" L "+l.x+" "+l.y+" L "+h.x+" "+h.y}},{key:"getPolyLinePath",value:function(e,t){var i=[e,t];if(e.y===t.y)return"M "+e.x+" "+e.y+" L "+t.x+" "+t.y;for(var n="M",r=0;r<=16;r++){var a=this.getBezierPoint(r/16,i,0,2);n+=a.x+","+a.y,16!==r&&(n+=" L")}return n}},{key:"getBezierPoint",value:function(e,t,i,n){if(1===n)return t[i];var r=this.getBezierPoint(e,t,i,n-1),a=this.getBezierPoint(e,t,i+1,n-1);return{x:(1-e)*r.x+e*a.x,y:(1-e)*r.y+e*a.y}}},{key:"getEdgeOfLabel",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,a=new Ii(e.x,e.y);return t>=90&&t<=270?(a.x+=e.width+n/2,a.y+=e.height/2,i.x=a.x+10,i.y=a.y):r&&r.region&&r.region.x>r.labelRegion.x?(a.x+=2*n+e.width,a.y+=e.height/2,i.x=a.x+10,i.y=a.y):(a.x-=n/2,a.y+=e.height/2,i.x=a.x-10,i.y=a.y),a}},{key:"getLabelDistance",value:function(e,t){if(e.labelPosition&&t.position!==e.labelPosition||t.connectorStyle.length){var i=di(t.connectorStyle.length||"70px",this.accumulation.initialClipRect.width);if(i<this.accumulation.initialClipRect.width)return i}var n,r=(this.accumulation.initialClipRect.width-this.accumulation.visibleSeries[0].triangleSize.width)/2;switch(e.labelPosition||t.position){case"Inside":return 0;case"Outside":return n=e.symbolLocation.x+e.labelOffset.x,this.accumulation.initialClipRect.width-n-r}}},{key:"getLabelLocation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Outside";if("Pie"!==this.accumulation.type){var i={x:e.symbolLocation.x,y:e.symbolLocation.y-e.labelOffset.y};switch(t="OutsideLeft"===t?"OutsideLeft":e.labelPosition||t){case"Inside":i.y=e.region.y+e.region.height/2;break;case"Outside":i.x+=e.labelOffset.x;break;case"OutsideLeft":i.x-=e.labelOffset.x}return i}return kt(e.midAngle,this.isVariousRadius()?di(e.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius,this.center)}},{key:"getConnectorStartPoint",value:function(e,t){var i;return!this.isCircular()&&e.region.x>e.labelRegion.x&&(i="OutsideLeft"),this.isCircular()?kt(e.midAngle,(this.isVariousRadius()?di(e.sliceRadius,this.accumulation.pieSeriesModule.seriesRadius):this.radius)-t.width,this.center):this.getLabelLocation(e,i)}},{key:"findAreaRect",value:function(){this.areaRect=new L(0,0,this.accumulation.availableSize.width,this.accumulation.availableSize.height);var e=this.accumulation.margin;wt(this.areaRect,new Oi(e.left,e.right,e.top,e.bottom))}},{key:"renderDataLabel",value:function(e,t,i,n,r,a,s){var o=this.accumulation.element.id+"_datalabel_Series_"+r+"_",l=this.accumulation.renderer.createGroup({id:o+"g_"+e.index});e.label=e.originalText||e.y.toString();var h={width:t.border.width,color:t.border.color},c=Object(f.L)({},Object(f.X)("properties",t.font),null,!0),d={cancel:!1,name:"textRender",series:this.accumulation.visibleSeries[0],point:e,text:e.label,border:h,color:t.fill,template:t.template,font:c};this.accumulation.trigger("textRender",d),e.argsData=d;var u=null!==d.template;e.labelVisible=!d.cancel,e.text=e.label=d.text,Number(e.label)&&(e.label=this.accumulation.intl.formatNumber(+e.label,{useGrouping:this.accumulation.useGroupingSeparator})),this.marginValue=d.border.width?5+d.border.width:1;var p=Object(f.G)("div",{id:this.accumulation.element.id+"_Series_0_DataLabel_"+e.index,styles:"position: absolute;background-color:"+d.color+";"+Kt(t.font)+";border:"+d.border.width+"px solid "+d.border.color+";"});this.calculateLabelSize(u,p,e,n,d,l,o,t,s)}},{key:"calculateLabelSize",value:function(e,t,i,n,r,a,s,o,l,h,c){var d=e?c?{width:h.width,height:h.height}:this.getTemplateSize(t,i,r,l,e,n,a,s,o):R(i.label,o.font);d.height+=4,d.width+=4,i.textSize=d,i.templateElement=t,this.getDataLabelPosition(i,o,d,n),i.labelRegion&&this.correctLabelRegion(i.labelRegion,i.textSize)}},{key:"drawDataLabels",value:function(e,i,n,r,a){var s,o,l=e.leftSidePoints.concat(e.rightSidePoints);l.sort(function(e,t){return e.index-t.index}),"Pie"===e.type&&this.accumulation.enableSmartLabels&&this.extendedLabelsCalculation();var h,c=t(l);try{for(c.s();!(h=c.n()).done;){var d=h.value;if(!Object(f.Z)(d.argsData)&&!Object(f.Z)(d.y)){this.finalizeDatalabels(d,l,i);var u=this.accumulation.element.id+"_datalabel_Series_0_",p=this.accumulation.renderer.createGroup({id:u+"g_"+d.index}),g=void 0,m=void 0;if(d.visible&&d.labelVisible){if(s=o=i.angle,d.argsData.template)this.setTemplateStyle(d.templateElement,d,r,i.font.color,d.color,a);else{g=new Ii(d.labelRegion.x+this.marginValue,d.labelRegion.y+3*d.textSize.height/4+this.marginValue);var v=(m=Zt(u+"shape_"+d.index))?new Ii(+m.getAttribute("x"),+m.getAttribute("y")):null;$t(!1,p,this.accumulation.renderer.drawRectangle(new Si(u+"shape_"+d.index,d.argsData.color,d.argsData.border,1,d.labelRegion,i.rx,i.ry)),a,!0,"x","y",v,null,!1,!1,null,this.accumulation.duration);var y=d.textSize.width,b=d.textSize.height,C=void 0;0!==s&&i.enableRotation?C="rotate("+(o="Outside"===d.labelPosition?0:d.midAngle>=90&&d.midAngle<=270?d.midAngle+180:d.midAngle)+","+(g.x+y/2)+","+(g.y-b/4)+")":C="rotate("+(o=s?s>360?s-360:s<-360?s+360:s:0)+","+(g.x+y/2)+","+g.y+")",d.transform=C,pi(this.accumulation.renderer,new D(u+"text_"+d.index,g.x,g.y,"start",d.label,C,"auto",o),d.argsData.font,d.argsData.font.color||this.getSaturatedColor(d,d.argsData.color),p,!1,a,!0,!1,this.accumulation.duration),m=null}if(this.accumulation.accumulationLegendModule&&("Outside"===i.position||this.accumulation.enableSmartLabels)&&this.accumulation.visibleSeries[0].findMaxBounds(this.accumulation.visibleSeries[0].labelBound,d.labelRegion),"Outside"===d.labelPosition){var x=Zt(u+"connector_"+d.index),S=x?x.getAttribute("d"):"";$t(!1,p,this.accumulation.renderer.drawPath(new U(u+"connector_"+d.index,"transparent",i.connectorStyle.width,i.connectorStyle.color||d.color,1,i.connectorStyle.dashArray,this.getConnectorPath(Object(f.L)({},d.labelRegion,null,!0),d,i,d.labelAngle))),a,!0,null,null,null,S,!1,!1,null,this.accumulation.duration)}$t(!1,n,p,a)}}}}catch(w){c.e(w)}finally{c.f()}}},{key:"finalizeDatalabels",value:function(e,t,i){if((this.isOverlapping(e,t)||this.titleRect&&e.labelRegion&&ni(e.labelRegion,this.titleRect))&&this.isCircular()&&"Outside"===e.labelPosition&&this.setPointVisibileFalse(e),this.accumulation.accumulationLegendModule&&e.labelVisible&&e.labelRegion){var n=this.accumulation.accumulationLegendModule.legendBounds,r=this.accumulation.legendSettings.border.width/2;this.textTrimming(e,new L(n.x-r,n.y-r,n.width+2*r,n.height+2*r),i.font,this.accumulation.accumulationLegendModule.position)}if(e.labelVisible&&e.labelRegion){var a=this.isCircular()?e.labelRegion.x>=this.center.x?"InsideRight":"InsideLeft":e.labelRegion.x>=e.region.x?"InsideRight":"InsideLeft";this.textTrimming(e,this.areaRect,i.font,a)}e.labelVisible&&e.labelRegion&&(e.labelRegion.y+e.labelRegion.height>this.areaRect.y+this.areaRect.height||e.labelRegion.y<this.areaRect.y||e.labelRegion.x<this.areaRect.x||e.labelRegion.x+e.labelRegion.width>this.areaRect.x+this.areaRect.width)&&this.setPointVisibileFalse(e)}},{key:"getTemplateSize",value:function(e,t,i,n,r,a,s,o,l){var h=Jt(e=Xt(e,t.index,i.template,this.accumulation,t,this.accumulation.visibleSeries[0],this.accumulation.element.id+"_DataLabel",0,i,r,a,s,o,l,n),n);return{width:h.width,height:h.height}}},{key:"setTemplateStyle",value:function(e,t,i,n,r,a){if(e.style.left=t.labelRegion.x+"px",e.style.top=t.labelRegion.y+"px",e.style.color=n||this.getSaturatedColor(t,r),this.accumulation.isBlazor){var s=this.isCircular()?t.labelRegion.x>=this.center.x?"InsideRight":"InsideLeft":t.labelRegion.x>=t.region.x?"InsideRight":"InsideLeft";e.style.transform="InsideRight"===s?"translate(0%, -50%)":"translate(-100%, -50%)"}e.childElementCount&&($t(!1,i,e,a,!0,"left","top"),this.doTemplateAnimation(this.accumulation,e))}},{key:"getSaturatedColor",value:function(e,t){var i,n=oi(li(i="transparent"===(i=this.marginValue>=1?"transparent"===t?this.getLabelBackground(e):t:this.getLabelBackground(e))?window.getComputedStyle(document.body,null).backgroundColor:i));return Math.round((299*n.r+587*n.g+114*n.b)/1e3)>=128?"black":"white"}},{key:"doTemplateAnimation",value:function(e,t){var i=e.visibleSeries[0],n=i.animation.delay+i.animation.duration;i.animation.enable&&e.animateSeries&&(t.style.visibility="hidden",qt(t,n,200,"ZoomIn"))}},{key:"getLabelBackground",value:function(e){return"Outside"===e.labelPosition?this.accumulation.background||this.accumulation.themeStyle.background:e.color}},{key:"correctLabelRegion",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;e.height-=i,e.width-=i,e.x+=i/2,e.y+=i/2,t.height-=i,t.width-=i}},{key:"getModuleName",value:function(){return"AccumulationDataLabel"}},{key:"destroy",value:function(){}},{key:"extendedLabelsCalculation",value:function(){var e=this,t=this.accumulation.series[0];t.rightSidePoints.forEach(function(t,i,n){t.initialLabelRegion=t.labelRegion,t.isLabelUpdated=0,e.skipPoints(t,n,i)}),t.leftSidePoints.forEach(function(t,i,n){t.initialLabelRegion=t.labelRegion,t.isLabelUpdated=0,e.skipPoints(t,n,i)}),this.arrangeLeftSidePoints(t),this.isIncreaseAngle=!1,this.arrangeRightSidePoints(t)}},{key:"arrangeRightSidePoints",value:function(e){var t,i,n,r,a=e.rightSidePoints.filter(function(e){return e.labelVisible&&"Outside"===e.labelPosition});this.rightSideRenderingPoints=a;var s,o=a[a.length-1];o&&o.labelAngle>90&&o.labelAngle<270&&(this.isIncreaseAngle=!0,this.changeLabelAngle(o,89));for(var l=a.length-1;l>=0;l--)if(r=a[l],s=a[l+1],this.isOverlapWithNext(r,a,l)&&r.labelVisible||!(r.labelAngle<=90||r.labelAngle>=270))if(n=o.labelAngle+10,i=!0,t?this.isIncreaseAngle=!1:n>90&&n<270&&s.isLabelUpdated&&(this.isIncreaseAngle=!0),this.isIncreaseAngle)for(var h=l+1;h>0;h--)this.decreaseAngle(a[h],a[h-1],e,!0);else for(var c=l+1;c<a.length;c++)this.increaseAngle(a[c-1],a[c],e,!0);else i&&s&&!s.isLabelUpdated&&(t=!0)}},{key:"arrangeLeftSidePoints",value:function(e){var t,i,n,r,a=this,s=e.leftSidePoints.filter(function(e){return e.labelVisible&&"Outside"===e.labelPosition});this.leftSideRenderingPoints=s;for(var o=0;o<s.length;o++)if(i=s[o],t=s[o-1],this.isOverlapWithPrevious(i,s,o)&&i.labelVisible||!(i.labelAngle<270))if(n=!0,r&&(this.isIncreaseAngle=!1),this.isIncreaseAngle)for(var l=o;l<s.length;l++)this.increaseAngle(s[l-1],s[l],e,!1);else for(var h=o;h>0;h--)this.decreaseAngle(s[h],s[h-1],e,!1),s.filter(function(e,t){e.isLabelUpdated&&s[t].labelAngle-10<100&&(a.isIncreaseAngle=!0)});else n&&t&&t.isLabelUpdated&&(r=!0)}},{key:"decreaseAngle",value:function(e,t,i,n){if(Object(f.Z)(e)||Object(f.Z)(t))return null;var r=1;if(n)for(;ni(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&!(t.labelRegion.height+t.labelRegion.y<e.labelRegion.y);){var a=t.midAngle-r;if(a<0&&(a=360+a),a<=270&&a>=90){a=270,this.isIncreaseAngle=!0;break}this.changeLabelAngle(t,a),r++}else for(e.labelAngle>270&&(this.changeLabelAngle(e,270),t.labelAngle=270);ni(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&e.labelRegion.y+e.labelRegion.height>t.labelRegion.y;){var s=t.midAngle-r;if(!(s<=270&&s>=90)){s=90,this.isIncreaseAngle=!0;break}if(this.changeLabelAngle(t,s),ni(e.labelRegion,t.labelRegion)&&!i.leftSidePoints.indexOf(t)&&s-1<90&&s-1>270){this.changeLabelAngle(e,e.labelAngle+1),this.arrangeLeftSidePoints(i);break}r++}}},{key:"increaseAngle",value:function(e,t,i,n){if(Object(f.Z)(e)||Object(f.Z)(t))return null;var r=1;if(n)for(;ni(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&!(e.labelRegion.y+e.labelRegion.height<t.labelRegion.y);){var a=t.midAngle+r;if(a<270&&a>90){a=90,this.isIncreaseAngle=!0;break}if(this.changeLabelAngle(t,a),ni(e.labelRegion,t.labelRegion)&&a+1>90&&a+1<270&&this.rightSideRenderingPoints.indexOf(t)===this.rightSideRenderingPoints.length-1){this.changeLabelAngle(e,e.labelAngle-1),t.labelRegion=t.initialLabelRegion,this.arrangeRightSidePoints(i);break}r++}else for(;ni(e.labelRegion,t.labelRegion)||!this.isVariousRadius()&&e.labelRegion.y<t.labelRegion.y+t.labelRegion.height;){var s=t.midAngle+r;if(!(s<270&&s>90)){s=270,this.isIncreaseAngle=!1;break}this.changeLabelAngle(t,s),r++}}},{key:"changeLabelAngle",value:function(e,t){var i,n=this.accumulation.series[0].dataLabel;this.isVariousRadius()&&(i=this.accumulation.pieSeriesModule.getLabelRadius(this.accumulation.visibleSeries[0],e));var r="Outside"===e.labelPosition&&this.accumulation.enableSmartLabels&&"Inside"===n.position?this.radius+di(n.connectorStyle.length||"4%",this.accumulation.pieSeriesModule.size/2):this.isVariousRadius()?i:this.accumulation.pieSeriesModule.labelRadius+10,a=this.isVariousRadius()?i:r;this.getLabelRegion(e,"Outside",e.textSize,a,this.marginValue,t),e.isLabelUpdated=1,e.labelAngle=t}},{key:"isOverlapWithPrevious",value:function(e,t,i){for(var n=0;n<i;n++)if(n!==t.indexOf(e)&&t[n].visible&&t[n].labelVisible&&t[n].labelRegion&&e.labelRegion&&e.labelVisible&&ni(e.labelRegion,t[n].labelRegion))return!0;return!1}},{key:"isOverlapWithNext",value:function(e,t,i){for(var n=i;n<t.length;n++)if(n!==t.indexOf(e)&&t[n].visible&&t[n].labelVisible&&t[n].labelRegion&&e.labelRegion&&e.labelVisible&&ni(e.labelRegion,t[n].labelRegion))return!0;return!1}},{key:"skipPoints",value:function(e,t,i){if(i>0&&(e.midAngle<285&&e.midAngle>255||e.midAngle<105&&e.midAngle>75)){var n=t[i-1],r=e.endAngle%360-e.startAngle%360;n.endAngle%360-n.startAngle%360<=r&&r<5&&n.labelVisible&&this.setPointVisibleTrue(e)}else if(i>1&&(e.midAngle<300&&e.midAngle>240||e.midAngle<120&&e.midAngle>60)){var a=t[i-1],s=t[i-2],o=a.endAngle%360-a.startAngle%360,l=s.endAngle%360-s.startAngle%360;e.endAngle%360-e.startAngle%360<3&&o<3&&l<3&&a.labelVisible&&e.labelVisible&&this.setPointVisibleTrue(e)}}},{key:"getPerpendicularDistance",value:function(e,t){var i=10+10*Math.sin(t.midAngle*Math.PI/360);return t.midAngle>270&&t.midAngle<360?new Ii(e.x+i*Math.cos((360-t.midAngle)*Math.PI/180),e.y-i*Math.sin((360-t.midAngle)*Math.PI/180)):t.midAngle>0&&t.midAngle<90?new Ii(e.x+i*Math.cos(t.midAngle*Math.PI/180),e.y+i*Math.sin(t.midAngle*Math.PI/180)):t.midAngle>0&&t.midAngle<90?new Ii(e.x-i*Math.cos((t.midAngle-90)*Math.PI/180),e.y+i*Math.sin((t.midAngle-90)*Math.PI/180)):new Ii(e.x-i*Math.cos((t.midAngle-180)*Math.PI/180),e.y-i*Math.sin((t.midAngle-180)*Math.PI/180))}}]),n}(zn),function(e){l(n,e);var i=c(n);function n(e){var t;return a(this,n),(t=i.call(this,e)).library=u(t),t.titleRect=new L(0,e.margin.top,0,0),t}return o(n,[{key:"getLegendOptions",value:function(e,i){this.legendCollections=[];for(var n=0;n<1;n++){var r=i[n].type;"Pie"!==r&&"Doughnut"!==r||(r="0"!==i[n].innerRadius&&"0%"!==i[n].innerRadius?"Doughnut":"Pie");var a,s=t(i[n].points);try{for(s.s();!(a=s.n()).done;){var o=a.value;Object(f.Z)(o.x)||Object(f.Z)(o.y)||this.legendCollections.push(new mn(o.x.toString(),o.color,i[n].legendShape,o.visible,r,o.legendImageUrl,null,null,o.index,i[n].index))}}catch(l){s.e(l)}finally{s.f()}}}},{key:"getLegendBounds",value:function(e,i,n){this.calculateLegendTitle(n,i),this.isTitle=!!n.title;var r=0,a=0,s=n.padding,o=n.titlePosition,l=0,h=this.arrowWidth,c=n.enablePages?0:this.arrowHeight;this.isVertical?r=n.width?0:e.width/100*5:a=n.height?0:e.height/100*5,i.width+=r,i.height+=a;var d,u,p=n.shapePadding,g=0,f=n.shapeWidth,m=0,v=0,y=[],b=0,C=0;this.maxItemHeight=Math.max(R("MeasureText",n.textStyle).height,n.shapeHeight);var x,S=!1,w=t(this.legendCollections);try{for(w.s();!(x=w.n()).done;){var k=x.value;d={fill:k.fill,text:k.text,shape:k.shape,name:"legendRender",cancel:!1},this.chart.trigger("legendRender",d),k.render=!d.cancel,k.text=d.text.indexOf("&")>-1?this.convertHtmlEntities(d.text):d.text,k.fill=d.fill,k.shape=d.shape,k.textSize=R(k.text,n.textStyle),k.render&&""!==k.text&&(S=!0,C=f+p+k.textSize.width+s,this.isVertical?(b=++v*(this.maxItemHeight+s)+s+this.legendTitleSize.height+c,v*(this.maxItemHeight+s)+s+c>i.height&&(b=Math.max(b,v*(this.maxItemHeight+s)+s+c),m+=g,y.push(g),this.totalPages=Math.max(v,this.totalPages||1),g=0,v=1),g=Math.max(C,g)):(n.enablePages||(l=this.isTitle&&"Top"!==o?this.legendTitleSize.width+this.fivePixel:0,l+=h),m+=C,i.width<s+m+l&&(g=Math.max(g,m+s+l-C),0===v&&C!==m&&(v=1),m=C,b=++v*(this.maxItemHeight+s)+s+this.legendTitleSize.height)))}}catch(O){w.e(O)}finally{w.f()}u="Top"===o?this.legendTitleSize.height:0,this.isVertical?(m+=g,this.isPaging=i.width<m+s,b=Math.max(b,(this.totalPages||1)*(this.maxItemHeight+s)+s+c),this.isPaging=this.isPaging&&this.totalPages>1,y[y.length-1]!==g&&y.push(g)):(this.isPaging=i.height<b,b=!n.enablePages&&this.isPaging?this.maxItemHeight+s+s+u:b,this.totalPages=this.totalRowCount=v,b=Math.max(b,this.maxItemHeight+s+s+u),this.isPaging||(m+=this.isTitle&&"Top"!==o?this.fivePixel+this.legendTitleSize.width+this.fivePixel:0)),this.maxColumns=0;var I=this.isVertical?this.getMaxColumn(y,i.width,s,m+s):Math.max(m+s,g);S?this.setBounds(I,b,n,i):this.setBounds(0,0,n,i)}},{key:"convertHtmlEntities",value:function(e){var t=e.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">").replace("&quot;",'"').replace("&nbsp;"," ").replace("&cent;","\xa2").replace("&pound;","\xa3").replace("&yen;","\xa5").replace("&euro;","\u20ac").replace("&copy;","\xa9").replace("&reg;","\xae");return t=t.replace("&#38;","&").replace("&#60;","<").replace("&#62;",">").replace("&#34;",'"').replace("&#160;"," ").replace("&#162;","\xa2").replace("&#163;","\xa3").replace("&#165;","\xa5").replace("&#8364;","\u20ac").replace("&#169;","\xa9").replace("&#174;","\xae")}},{key:"getMaxColumn",value:function(e,i,n,r){var a=n;this.maxColumnWidth=Math.max.apply(null,e);var s,o=t(e);try{for(o.s();!(s=o.n()).done;){s.value;if(a+=this.maxColumnWidth,this.maxColumns++,a+n>i){a-=this.maxColumnWidth,this.maxColumns--;break}}}catch(l){o.e(l)}finally{o.f()}return this.isPaging=a<r&&this.totalPages>1,a===n&&(a=i),this.maxColumns=Math.max(1,this.maxColumns),this.maxWidth=a,a}},{key:"getAvailWidth",value:function(e,t){return this.isVertical&&(t=this.maxWidth),t-(2*this.legend.padding+this.legend.shapeWidth+this.legend.shapePadding)}},{key:"getRenderPoint",value:function(e,t,i,n,r,a,s){var o=this.legend.padding;if(this.isVertical)a===s||n.location.y+1.5*this.maxItemHeight+2*o>r.y+r.height?(e.location.x=n.location.x+(a===s?0:this.maxColumnWidth),e.location.y=t.y,this.pageXCollections.push(e.location.x-this.legend.shapeWidth/2-o),this.totalPages++):(e.location.x=n.location.x,e.location.y=n.location.y+this.maxItemHeight+o);else{var l=n.location.x+i+n.textSize.width;l+(e.textSize.width+i)>r.x+r.width+this.legend.shapeWidth/2?(e.location.y=a===s?n.location.y:n.location.y+this.maxItemHeight+o,e.location.x=t.x):(e.location.y=n.location.y,e.location.x=a===s?n.location.x:l),this.totalPages=this.totalRowCount}var h=this.getAvailWidth(e.location.x,this.legendBounds.width);e.text=ci(+h.toFixed(4),e.text,this.legend.textStyle)}},{key:"getSmartLegendLocation",value:function(e,t,i){var n;switch(this.position){case"Left":n=(e.x-t.width-i.left)/2,t.x=e.x-t.width<i.left?t.x:e.x-t.width-n;break;case"Right":n=(this.chart.availableSize.width-i.right-(e.x+e.width+t.width))/2,t.x=e.x+e.width+t.width>this.chart.availableSize.width-i.right?t.x:e.x+e.width+n;break;case"Top":this.getTitleRect(this.chart),n=(e.y-t.height-(this.titleRect.y+this.titleRect.height))/2,t.y=e.y-t.height<i.top?t.y:e.y-t.height-n;break;case"Bottom":n=(this.chart.availableSize.height-i.bottom-(e.y+e.height+t.height))/2,t.y=e.y+e.height+t.height>this.chart.availableSize.height-i.bottom?t.y:e.y+e.height+n}}},{key:"getTitleRect",value:function(e){if(!e.title)return null;var t=R(e.title,e.titleStyle);this.titleRect=new L(e.availableSize.width/2-t.width/2,e.margin.top,t.width,t.height)}},{key:"legendByIndex",value:function(e,i){var n,r=t(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.pointIndex===e)return a}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"click",value:function(e){var t=e.target.id,i=this.chart,n=[this.legendID+"_text_",this.legendID+"_shape_",this.legendID+"_shape_marker_"];this.chart.accumulationSelectionModule&&Object(f.L)([],this.chart.accumulationSelectionModule.selectedDataIndexes,null,!0),this.chart.animateSeries=!1;for(var r=0,a=n;r<a.length;r++){var s=a[r];if(t.indexOf(s)>-1){var o=parseInt(t.split(s)[1],10);if(this.chart.legendSettings.toggleVisibility&&!isNaN(o)){var l=this.chart.visibleSeries[0],h=Pn(o,l.points),c=this.legendByIndex(o,this.legendCollections);h.visible=!h.visible,c.visible=h.visible,l.sumOfPoints+=h.visible?h.y:-h.y,i.redraw=i.enableAnimation,this.sliceVisibility(o,h.visible),i.removeSvg(),Ci(i),this.chart.refreshPoints(l.points),this.chart.renderElements()}else this.chart.accumulationSelectionModule&&!isNaN(o)&&this.chart.accumulationSelectionModule.legendSelection(this.chart,0,o)}}t.indexOf(this.legendID+"_pageup")>-1?this.changePage(e,!0):t.indexOf(this.legendID+"_pagedown")>-1&&this.changePage(e,!1),i.redraw=!1}},{key:"sliceVisibility",value:function(e,t){var i=this.chart.element.id+"_Series_0_Point_";this.chart.visibleSeries[0].dataLabel.visible&&(i=this.chart.element.id+"_datalabel_Series_0_",this.sliceAnimate(Zt(i+"g_"+e),t))}},{key:"sliceAnimate",value:function(e,t){if(!e)return null;new f.b({}).animate(e,{duration:300,delay:0,name:t?"FadeIn":"FadeOut",end:function(e){e.element.style.visibility=t?"visible":"hidden"}})}},{key:"getModuleName",value:function(){return"AccumulationLegend"}},{key:"destroy",value:function(){}}]),n}(fn));var Yo,Xo,Ko,Jo,Qo,$o,el,tl,il,nl,rl,al,sl,ol,ll,hl,cl,dl,ul,pl,gl,fl,ml,vl,yl,bl=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"addEventListener",value:function(){this.parent.on("initiateChart",this.initiateChartHandler,this),this.parent.on("refreshChartCellObj",this.refreshChartCellObj,this),this.parent.on("updateChart",this.updateChartHandler,this),this.parent.on("deleteChart",this.deleteChart,this),this.parent.on("clearChartBorder",this.clearBorder,this),this.parent.on("insertChart",this.insertChartHandler,this),this.parent.on("chartRangeSelection",this.chartRangeHandler,this),this.parent.on("chartDesignTab",this.chartDesignTabHandler,this),this.parent.on("addChartEle",this.updateChartElement,this)}},{key:"insertChartHandler",value:function(e){var t="Column";switch(e.id){case"clusteredColumn":t="Column";break;case"stackedColumn":t="StackingColumn";break;case"stackedColumn100":t="StackingColumn100";break;case"clusteredBar":t="Bar";break;case"stackedBar":t="StackingBar";break;case"stackedBar100":t="StackingBar100";break;case"area":t="Area";break;case"stackedArea":t="StackingArea";break;case"stackedArea100":t="StackingArea100";break;case"line":t="Line";break;case"stackedLine":t="StackingLine";break;case"stackedLine100":t="StackingLine100";break;case"pie":t="Pie";break;case"doughnut":t="Doughnut";break;case"scatter":t="Scatter"}e.isChart?this.parent.notify("setChart",{chart:[{type:t}]}):this.parent.notify("chartDesignTab",{chartType:t})}},{key:"chartRangeHandler",value:function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,i=this.parent.chartColl,n=i.length,r=0;r<n;r++){var a=document.getElementById(i[r].id);e&&a&&i[r].id===t&&this.parent.notify("initiateChart",{option:i[r],chartCount:this.parent.chartCount,isRefresh:!0})}}},{key:"getPropertyValue",value:function(e,t,i){var n=this.parent.sheets;if(n[i]&&n[i].rows[e]&&n[i].rows[e].cells[t]){var r=Da(e,t,this.parent.sheets[i]),a="";if(r.format){var s={type:br(r.format),value:r&&r.value,format:r&&r.format?r.format:"General",formattedText:r&&r.value,onLoad:!0,isRightAlign:!1,cell:r,rowIdx:e.toString(),colIdx:t.toString()};if(r)if(this.parent.notify("getFormattedCell",s),"number"==typeof s.value){var o=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");s.formattedText=s.formattedText.toString().replace(o,""),a=parseInt(s.formattedText.toString(),10)}else a=s.formattedText.toString()}else a=this.parent.sheets[i].rows[e].cells[t].value;return a=Object(f.Z)(a)?"":a}return""}},{key:"updateChartHandler",value:function(e){var t=this.initiateChartHandler({option:e.chart,isRefresh:!0}),i=this.parent.element.querySelector("."+e.chart.id);if(i){var n=Object(f.N)(i,"chart");Object(f.Z)(n)&&(n=Object(f.N)(i,"accumulationchart")),n.series=t,n.refresh()}}},{key:"refreshChartCellObj",value:function(e){var t,i,n=this.parent.sheets[this.parent.activeSheetIndex],r=Da(e.prevRowIdx,e.prevColIdx,n),a=Da(e.currentRowIdx,e.currentColIdx,n),s=r?r.chart:[],o=s&&s.length?s.length:0;if(r&&r.chart){for(var l=0;l<o;l++){var h=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active")[0],c=document.getElementById(s[l].id);if(Object(f.D)(c,"."+h.classList[1])===h){(t=s[l]).height=e.currentHeight,t.width=e.currentWidth,t.top=e.currentTop,t.left=e.currentLeft,s.splice(l,1);for(var d=0,u=this.parent.chartColl.length;d<u;d++)t.id===this.parent.chartColl[d].id&&(t.height=e.currentHeight,this.parent.chartColl[d].width=e.currentWidth,this.parent.chartColl[d].top=e.currentTop,this.parent.chartColl[d].left=e.currentLeft)}}a&&a.chart&&(i=a.chart,t&&i.push(t)),Ma(e.currentRowIdx,e.currentColIdx,n,i?{chart:i}:{chart:[t]},!0),"chartRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:this.parent.activeSheetIndex},action:"chartRefresh"})}}},{key:"processChartRange",value:function(e,t,i){var n,r,a,s=e[0],o=e[1],l=!1,h=e[2],c=e[3],d=s===h,u=o===c,p=this.getPropertyValue(s,c,t),g=this.getPropertyValue(h,o,t),m=this.getPropertyValue(s,o,t);return hr(g)&&m||(l=!0),Object(f.Z)(m)&&!d&&!u||"Scatter"===i.type&&e[3]-e[1]==1?(n=[s+1,o,h,o],r=[s+1,o+1,h,c],a=[s,o+1,s,c]):Object(f.Z)(g)||!l||d||u?(r=[s,o,h,c],Object(f.Z)(p)||hr(p)||lr(p)?Object(f.Z)(m)&&(d||u)&&(a=[s,o,s,c],d?(r[1]=r[1]+1,a[3]=a[1]):r[0]=r[0]+1):(a=[s,o,s,c],r[0]=r[0]+1)):Object(f.Z)(p)||hr(p)&&m?(n=[s,o,h,o],r=[s,o+1,h,c]):(n=[s+1,o,h,o],r=[s+1,o+1,h,c],a=[s,o+1,s,c]),{xRange:n,yRange:r,lRange:a}}},{key:"toIntrnlRange",value:function(e,t){return e?"string"==typeof e&&(e=Wn[e]):e=Wn[this.parent.sheets[t].selectedRange],e}},{key:"getRangeData",value:function(e){e.range=this.toIntrnlRange(e.range,e.sheetIdx);var t=[];return this.pushRowData(e,e.range[0],e.range[1],e.range[2],e.range[3],t,[],!0,e.isYvalue),t}},{key:"pushRowData",value:function(e,t,i,n,r,a,s,o,l){for(var h=i,c=this.parent.sheets[e.sheetIdx];t<=n;)if(cs(c,t))t++;else{for(i=h;i<=r;)if(ys(c,i))i++;else{var d="",u=Da(t,i,c);if(u&&u.format&&!l){var p={value:u&&u.value,format:u&&u.format?u.format:"General",formattedText:u&&u.value,onLoad:!0,type:u&&br(u.format),rowIdx:t.toString(),colIdx:i.toString(),isRightAlign:!1,cell:u};this.parent.notify("getFormattedCell",p),d=p.formattedText.toString()}else d=u?Object(f.Z)(u.value)?"":u.value:"";a.push({value:d}),i++}t++}s.push(t)}},{key:"toArrayData",value:function(e){for(var t,i=0,n=[],r=e.length;i<r;)t=e[i],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),i++;return n}},{key:"getVirtualXValues",value:function(e){for(var t=1,i=[];t<e;)i.push(t.toString()),t++;return i}},{key:"processChartSeries",value:function(e,t,i,n,r){e=e||{};var a,s,o,l,h,c,d,u="",p={},g={},m=0,v=0,y=[];t=Object(f.Z)(t)?this.parent.getActiveSheet().index:t;var b=this.parent.sheets[t],C=this.getRangeData({range:n,sheetIdx:t,skipFormula:!0,isYvalue:!0}),x=n[2]-n[0]+1-this.parent.hiddenCount(n[0],n[2],"rows",b),S=n[3]-n[1]+1-this.parent.hiddenCount(n[0],n[2],"columns",b);e.isSeriesInRows?(s=r?this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(S+1),i&&(o=this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),l=x):(s=i?this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(x+1),r&&(o=this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),l=S);var w,k=s.length,I=e.isSeriesInRows?1:l;for(Object(f.Z)(e.dataLabelSettings)||(p.visible=e.dataLabelSettings.visible,p.position=e.dataLabelSettings.position);m<l;){for(c=0,h=[],v=e.isSeriesInRows?v:m;c<k;)C[v]&&(hr(a=C[v].value)?a=Number(a):(d=or(a),a=isNaN(d)?0:d),h.push({x:s[c],y:a})),v+=I,c++;if(u=o&&o.length>0?o[m]:"series"+m,e.type){var O=e.type;if("Line"===O||"StackingLine"===O||"StackingLine100"===O)g={dataSource:h,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{visible:!0,width:10,height:10,dataLabel:p}};else if("Scatter"===O)g={dataSource:h,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:p}};else if("Pie"===O||"Doughnut"===O){var R="Pie"===e.type?"0%":"40%",A=p.visible,E=Object(f.Z)(p.position)?"Inside":"Outer"===p.position?"Outside":"Inside";g={dataSource:h,dataLabel:{visible:!Object(f.Z)(A)&&A,position:E,name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",innerRadius:R}}else g={dataSource:h,type:e.type,xName:"x",yName:"y",name:u.toString(),marker:{dataLabel:p}}}y.push(g),m++}return e.type&&(w={series:y,xRange:e.isSeriesInRows?r:i,yRange:n,lRange:e.isSeriesInRows?i:r}),w}},{key:"primaryYAxisFormat",value:function(e){if(Object(f.Z)(e))return"{value}";var t,i=Da(e[0],e[1],this.parent.getActiveSheet());if(i&&i.format){if("Accounting"===(t=br(i.format)))return"${value}";if("Currency"===t)return"${value}";if("Percentage"===t)return"{value}%"}return"{value}"}},{key:"focusChartRange",value:function(e,t,i){var n,r=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var a=this.parent.getActiveSheet(),s=!(!a.frozenRows&&!a.frozenColumns);i&&(s?n=i:this.parent.notify("focusBorder",{startcell:{rowIndex:i[0],colIndex:i[1]},endcell:{rowIndex:i[2],colIndex:i[3]},classes:[r[0],r[1]]})),e&&(s?n?(n[0]=Math.min(i[0],e[0]),n[1]=Math.min(i[1],e[1]),n[2]=Math.max(i[2],e[2]),n[3]=Math.max(i[3],e[3])):n=e:this.parent.notify("focusBorder",{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[r[2],r[3]]})),this.parent.notify("focusBorder",s&&n?{startcell:{rowIndex:Math.min(n[0],t[0]),colIndex:Math.min(n[1],t[1])},endcell:{rowIndex:Math.max(n[2],t[2]),colIndex:Math.max(n[3],t[3])},classes:[r[4],r[5]]}:{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[r[4],r[5]]})}},{key:"clearBorder",value:function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(function(e){Object(f.J)(e)});else for(var t=this.parent.getMainContent(),i=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],n=0,r=i.length;n<r;n++)for(var a=t.querySelectorAll("."+i[n]),s=0,o=a.length;s<o;s++)a[s].classList.remove(i[n])}},{key:"initiateChartHandler",value:function(e){var t,i=e.option;t=!!Object(f.Z)(e.isInitCell)||!e.isInitCell,e.isUndoRedo=!!Object(f.Z)(e.isUndoRedo)||e.isUndoRedo,e.isRefresh=!Object(f.Z)(e.isRefresh)&&e.isRefresh;var n,r,a=this.parent.getActiveSheet(),s=i.range?i.range.indexOf("!")>0?i.range.split("!")[1]:i.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,o=Wn(s),l={};if(this.parent.allowChart||!a.isProtected){var h=i.range&&i.range.indexOf("!")>0?Wa(this.parent,i.range.split("!")[0]):this.parent.activeSheetIndex,c={sheetIndex:h,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:i,range:s,operation:"create"};s=c.range,l=(l=c.options)||{},o.length>0&&o[2]-o[0]<o[3]-o[1]&&(n=!0),l.isSeriesInRows=!!n||!!l.isSeriesInRows&&l.isSeriesInRows,e.dataSheetIdx=Object(f.Z)(e.dataSheetIdx)?h:e.dataSheetIdx;var d=this.processChartRange(o,e.dataSheetIdx,l),u=d.xRange,p=d.yRange,g=d.lRange;h===this.parent.activeSheetIndex&&t&&this.focusChartRange(u,p,g);var m=this.processChartSeries(l,e.dataSheetIdx,u,p,g),v={majorGridLines:i.primaryXAxis&&i.primaryXAxis.majorGridLines&&!Object(f.Z)(i.primaryXAxis.majorGridLines.width)?{width:i.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:i.primaryXAxis&&i.primaryXAxis.minorGridLines&&!Object(f.Z)(i.primaryXAxis.minorGridLines.width)?{width:i.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:i.primaryXAxis&&i.primaryXAxis.minorGridLines&&i.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Category",visible:!i.primaryXAxis||i.primaryXAxis.visible,title:i.primaryXAxis?i.primaryXAxis.title:""},y={lineStyle:{width:0},majorGridLines:i.primaryYAxis&&i.primaryYAxis.majorGridLines&&!Object(f.Z)(i.primaryYAxis.majorGridLines.width)?{width:i.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:i.primaryYAxis&&i.primaryYAxis.minorGridLines&&!Object(f.Z)(i.primaryYAxis.minorGridLines.width)?{width:i.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:i.primaryYAxis&&i.primaryYAxis.minorGridLines&&i.primaryYAxis.minorGridLines.width>0?5:0,labelFormat:this.primaryYAxisFormat(p),visible:!i.primaryYAxis||i.primaryYAxis.visible,title:i.primaryYAxis?i.primaryYAxis.title:""};if(e.isRefresh)return m.series;if(e.isUndoRedo){if(r={type:i.type,theme:i.theme,isSeriesInRows:i.isSeriesInRows,range:i.range,id:i.id,height:i.height,width:i.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},this.parent.notify(Ar,{eventArgs:r,action:"beforeInsertChart"}),r.cancel)return[];i.type=r.type,i.theme=r.theme,i.isSeriesInRows=r.isSeriesInRows,i.range=r.range,i.id=r.id,i.height=r.height,i.width=r.width}var b=i.id+"_overlay",C=e.isPaste?this.parent.getActiveSheet().index:e.option.range&&e.option.range.indexOf("!")>0?Wa(this.parent,e.option.range.split("!")[0]):this.parent.activeSheetIndex,x=this.parent.serviceLocator.getService(Ol),S=!Object(f.Z)(e.isInitCell)&&e.isInitCell?e.range:s,w=x.insertOverlayElement(b,S,C);w.classList.add("e-datavisualization-chart"),w.style.width=i.width+"px",w.style.height=i.height+"px",a.frozenRows||a.frozenColumns?x.adjustFreezePaneSize(i,w,S):(w.style.top=Object(f.Z)(i.top)?w.style.top:i.top+"px",w.style.left=Object(f.Z)(i.left)?w.style.left:i.left+"px",i.top=parseInt(w.style.top.replace("px",""),10),i.left=parseInt(w.style.left.replace("px",""),10)),this.parent.notify("overlayEleSize",{height:i.height,width:i.width});var k="Pie"===i.type||"Doughnut"===i.type?{position:"Bottom",visible:!0}:{};Object(f.Z)(i.legendSettings)||(k.visible=i.legendSettings.visible,k.position=i.legendSettings.position);var I=this.parent.createElement("div",{id:i.id,className:i.id});"Pie"!==i.type&&"Doughnut"!==i.type?(this.chart=new kn({primaryXAxis:v,primaryYAxis:y,chartArea:{border:{width:0}},title:i.title,legendSettings:k,theme:i.theme,series:m.series,tooltip:{enable:!0},width:w.style.width,height:w.style.height,load:function(e){var t=i.theme;t=t||"Material",e.chart.theme=t},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(I)):(this.chart=new qn({title:i.title,legendSettings:k,theme:i.theme,series:m.series,width:w.style.width,height:w.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,load:function(e){var t=i.theme;t=t||"Material",e.chart.theme=t},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(I)),w.appendChild(I),e.isUndoRedo&&this.parent.notify(Rr,{eventArgs:r,action:"insertChart"})}}},{key:"deleteChart",value:function(e){this.clearBorder();var t,i,n,r=null,a=this.parent.getActiveSheet();if(Object(f.Z)(e.id)?(r=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=r?r.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",r=document.getElementById(e.id)),!Object(f.Z)(e.id)&&!Object(f.Z)(r)){e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var s,o=!1,l=0,h=this.parent.chartColl.length;l<h;l++)if(this.parent.chartColl[l].id===e.id.split("_overlay")[0]){s=this.parent.chartColl[l];break}var c={id:s.id,range:s.range,type:s.type,theme:s.theme,height:s.height,width:s.width,isSeriesInRows:s.isSeriesInRows,isInitCell:!0,posRange:null,top:s.top,left:s.left,cancel:!1};if(r){var d,u;if(a.frozenRows||a.frozenColumns){var p=r.getBoundingClientRect();d={clientY:p.top},u={clientX:p.left},p.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent()),p.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(u.target=this.parent.getRowHeaderTable())}else d={clientY:r.offsetTop,isImage:!0},u={clientX:r.offsetLeft,isImage:!0};this.parent.notify("deleteChartColl",{id:e.id}),this.parent.notify("getRowIdxFromClientY",d),this.parent.notify("getColIdxFromClientX",u),o=!0,t=d.clientY,i=u.clientX,a=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify("deleteChartColl",{id:e.id});var g=e.range&&e.range.indexOf("!")>0?Wa(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,m=Wn(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);t=m[0],i=m[1],a=this.parent.sheets[g]}var v=Da(t,i,a);v&&(n=v.chart);for(var y=n?n.length:null,b=0;b<y;b++){var C=document.getElementById(e.id),x=document.getElementById(n[b].id);Object(f.D)(x,"."+C.classList[1])===C&&n.splice(b,1)}o&&(document.getElementById(e.id).remove(),this.parent.notify("removeDesignChart",{})),Ma(t,i,a,{chart:n},!0),c.posRange=Yn(t,i),e.isUndoRedo||this.parent.notify(Rr,{eventArgs:c,action:"deleteChart"})}}},{key:"updateChartModel",value:function(e,t,i,n,r){var a=t;t=t;var s=this.parent.chartColl[n].id;if(!(r&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(var o=0,l=i.chart.length;o<l;o++)if(i.chart[o].id===s)switch(e){case"PHAxes":case"PHAxisTitle":Object(f.Z)(i.chart[o].primaryXAxis)&&(i.chart[o].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),"PHAxes"===e?(i.chart[o].primaryXAxis.visible=t.primaryXAxis.visible,this.parent.chartColl[n].primaryXAxis.visible=t.primaryXAxis.visible):"PHAxisTitle"===e&&(i.chart[o].primaryXAxis.title=t.primaryXAxis.title,this.parent.chartColl[n].primaryXAxis.title=t.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":Object(f.Z)(i.chart[o].primaryYAxis)&&(i.chart[o].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),"PVAxes"===e?(i.chart[o].primaryYAxis.visible=t.primaryYAxis.visible,this.parent.chartColl[n].primaryYAxis.visible=t.primaryYAxis.visible):"PVAxisTitle"===e&&(i.chart[o].primaryYAxis.title=t.primaryYAxis.title,this.parent.chartColl[n].primaryYAxis.title=t.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":i.chart[o].title=t.title,this.parent.chartColl[n].title=t.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(Object(f.Z)(i.chart[o].dataLabelSettings)&&(i.chart[o].dataLabelSettings={},this.parent.chartColl[n].dataLabelSettings={}),"DLNone"===e)i.chart[o].dataLabelSettings.visible=!1,this.parent.chartColl[n].dataLabelSettings.visible=!1;else{var h;i.chart[o].dataLabelSettings.visible=!0,this.parent.chartColl[n].dataLabelSettings.visible=!0,h=r?"Outside"===a.series[0].dataLabel.position?"Outer":"Middle":t.series[0].marker.dataLabel.position,i.chart[o].dataLabelSettings.position=h,this.parent.chartColl[n].dataLabelSettings.position=h}break;case"GLMajorHorizontal":Object(f.Z)(i.chart[o].primaryYAxis)&&(i.chart[o].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),Object(f.Z)(i.chart[o].primaryYAxis.majorGridLines)&&(i.chart[o].primaryYAxis.majorGridLines={},this.parent.chartColl[n].primaryYAxis.majorGridLines={}),i.chart[o].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width,this.parent.chartColl[n].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":Object(f.Z)(i.chart[o].primaryXAxis)&&(i.chart[o].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),Object(f.Z)(i.chart[o].primaryXAxis.majorGridLines)&&(i.chart[o].primaryXAxis.majorGridLines={},this.parent.chartColl[n].primaryXAxis.majorGridLines={}),i.chart[o].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width,this.parent.chartColl[n].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":Object(f.Z)(i.chart[o].primaryYAxis)&&(i.chart[o].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),Object(f.Z)(i.chart[o].primaryYAxis.minorGridLines)&&(i.chart[o].primaryYAxis.minorGridLines={},this.parent.chartColl[n].primaryYAxis.minorGridLines={}),i.chart[o].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width,this.parent.chartColl[n].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":Object(f.Z)(i.chart[o].primaryXAxis)&&(i.chart[o].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),Object(f.Z)(i.chart[o].primaryXAxis.minorGridLines)&&(i.chart[o].primaryXAxis.minorGridLines={},this.parent.chartColl[n].primaryXAxis.minorGridLines={}),i.chart[o].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width,this.parent.chartColl[n].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if(Object(f.Z)(i.chart[o].legendSettings)&&(i.chart[o].legendSettings={},this.parent.chartColl[n].legendSettings={}),i.chart[o].legendSettings.visible=t.legendSettings.visible,this.parent.chartColl[n].legendSettings.visible=t.legendSettings.visible,"LegendNone"!==e){i.chart[o].legendSettings.position=t.legendSettings.position,this.parent.chartColl[n].legendSettings.position=t.legendSettings.position;break}}}},{key:"updateChartElement",value:function(e,t,i,n,r,a){if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var s;switch(e){case"PHAxes":(t=t).primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":(t=t).primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":(t=t).primaryXAxis.title=r;break;case"PVAxisTitle":(t=t).primaryYAxis.title=r;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=r;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(s=(t=t).series,"DLNone"===e)for(var o=0,l=s.length;o<l;o++)a?s[o].dataLabel.visible=!1:s[o].marker.dataLabel.visible=!1;else for(var h=0,c=s.length;h<c;h++)if(a){var d="DLOutsideend"===e?"Outside":"Inside";s[h].dataLabel.visible=!0,s[h].dataLabel.position=d}else{var u="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":s[0].marker.dataLabel.position;s[h].marker.dataLabel.visible=!0,s[h].marker.dataLabel.position=u}t.series=s,a&&t.refresh();break;case"GLMajorHorizontal":(t=t).primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":(t=t).primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":(t=t).primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":(t=t).primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}this.updateChartModel(e,t,i,n,a)}}},{key:"chartDesignTabHandler",value:function(e){var t,i=!1,n=this.parent.sheets[this.parent.activeSheetIndex],r=e.switchRowColumn,a=e.chartType,s=e.chartTheme,o=e.addChartEle,l=null,h=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(h){var c,d;if(n.frozenRows||n.frozenColumns){var u=h.getBoundingClientRect();c={clientY:u.top},d={clientX:u.left},u.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(c.target=this.parent.getColumnHeaderContent()),u.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(d.target=this.parent.getRowHeaderTable())}else c={clientY:h.offsetTop,isImage:!0},d={clientX:h.offsetLeft,isImage:!0};this.parent.notify("getRowIdxFromClientY",c),this.parent.notify("getColIdxFromClientX",d);var p=Da(c.clientY,d.clientX,n),g=h.querySelector(".e-chart");Object(f.Z)(g)&&(g=h.querySelector(".e-accumulationchart"));for(var m=g.getAttribute("id"),v=0,y=this.parent.chartColl.length;v<y;v++)m===this.parent.chartColl[v].id&&(t=v);if(g&&(l=Object(f.N)(g,"chart"),Object(f.Z)(l)&&(l=Object(f.N)(g,"accumulationchart"),i=!0)),r&&!i){this.parent.chartColl[t].isSeriesInRows=!!Object(f.Z)(this.parent.chartColl[t].isSeriesInRows)||!this.parent.chartColl[t].isSeriesInRows;for(var b=0,C=p.chart.length;b<C;b++)p.chart[b].id===m&&(p.chart[b].isSeriesInRows=!!Object(f.Z)(p.chart[b].isSeriesInRows)||!p.chart[b].isSeriesInRows);var x=this.initiateChartHandler({option:this.parent.chartColl[t],isRefresh:!0});l.series=x}if(a){var S=this.parent.chartColl[t].type;this.parent.chartColl[t].type=a;for(var w=0,k=p.chart.length;w<k;w++)p.chart[w].id===m&&(p.chart[w].type=a);if("Pie"!==a&&"Doughnut"!==a)if("Pie"===S||"Doughnut"===S)this.changeCharType(t);else{for(var I=l.series,O=0,R=I.length;O<R;O++)I[O].type=a;l.series=I,l.refresh()}else if("Pie"===S||"Doughnut"===S){for(var A=l.series,E=0,L=A.length;E<L;E++)A[E].innerRadius="Pie"===a?"0%":"40%";l.series=A,l.refresh()}else this.changeCharType(t)}if(s){this.parent.chartColl[t].theme=s;for(var T=0,j=p.chart.length;T<j;T++)p.chart[T].id===m&&(p.chart[T].theme=s);l.theme=s,l.refresh()}if(o)if("ChartTitleAbove"===o||"PHAxisTitle"===o||"PVAxisTitle"===o){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(o,l,p,t,i)}else this.updateChartElement(o,l,p,t,"",i)}}},{key:"changeCharType",value:function(e){var t=document.getElementById(this.parent.chartColl[e].id),i=Object(f.D)(t,".e-datavisualization-chart");i.remove(),this.parent.notify("initiateChart",{option:this.parent.chartColl[e],isInitCell:!1,isUndoRedo:!0,isPaste:!1}),t=document.getElementById(this.parent.chartColl[e].id),(i=Object(f.D)(t,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||i.classList.add("e-ss-overlay-active")}},{key:"titleDlgHandler",value:function(e,t,i,n,r){var a=this,s="";if(!r||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var o=this.parent.serviceLocator.getService(kl),l=this.parent.serviceLocator.getService(Il);l.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:o.getConstant("chart_abovechart"===e?"ChartTitle":"PHAxisTitle"===e?"HorizontalAxisTitle":"VerticalAxisTitle"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){l.dialogInstance.content=a.titleDlgContent(e,t),l.dialogInstance.dataBind(),a.parent.element.focus()},buttons:[{buttonModel:{content:o.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var r=a.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];s=r.getElementsByTagName("input")[0].value,l.hide(),a.updateChartElement(e,t,i,n,s)}}]}),l.dialogInstance.refresh()}}},{key:"titleDlgContent",value:function(e,t){var i=this.parent.serviceLocator.getService(kl).getConstant("EnterTitle"),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),r=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:i}),a=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(r),n.appendChild(a),t&&(a.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:a.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:a.value:t.title?t.title:a.value),n}},{key:"removeEventListener",value:function(){this.parent.isDestroyed||(this.parent.off("initiateChart",this.initiateChartHandler),this.parent.off("refreshChartCellObj",this.refreshChartCellObj),this.parent.off("updateChart",this.updateChartHandler),this.parent.off("deleteChart",this.deleteChart),this.parent.off("clearChartBorder",this.clearBorder),this.parent.off("insertChart",this.insertChartHandler),this.parent.off("chartRangeSelection",this.chartRangeHandler),this.parent.off("chartDesignTab",this.chartDesignTabHandler),this.parent.off("addChartEle",this.updateChartElement))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&Object(f.J)(e),this.chart=null}},{key:"getModuleName",value:function(){return"spreadsheetChart"}}]),e}(),Cl=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},xl=(Xo=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Cl([Object(f.t)(!1)],Xo.prototype,"isFinite",void 0),Cl([Object(f.t)(!0)],Xo.prototype,"enableVirtualization",void 0),Xo),Sl=(Yo=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.apply(this,arguments)}return i}(f.e),Cl([Object(f.t)("Multiple")],Yo.prototype,"mode",void 0),Yo),wl="e-wraptext",kl="spreadsheetLocale",Il="dialog",Ol="shape",Rl={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Al={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},El={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"Ok",Close:"Close",Cancel:"CANCEL",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",T:"Checks whether a value is text and returns the text if it is, or returns empty string if it is not.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",UNIQUE:"Returns a unique values from a range or array",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",TODAY:"Returns the current date as date value.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"Clear All",APPLY:"Apply",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",unProtectPassword:"Password",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnProtectWorkbook:"Unprotect Workbook",UnProtectPasswordAlert:"The password you supplied is not correct.",InCorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF document"},Ll=function(){function e(t){a(this,e),this.colGroupWidth=30,this.parent=t,this.col=t.createElement("col"),this.rowRenderer=t.serviceLocator.getService("row"),this.cellRenderer=t.serviceLocator.getService("cell"),this.addEventListener()}return o(e,[{key:"refreshSelectALLContent",value:function(){var e,t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){var i=this.getSelectAllTable().querySelector("thead"),n=this.rowRenderer.render();i.appendChild(n),e=this.parent.createElement("th",{className:"e-select-all-cell"}),n.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall e-icons",id:"".concat(this.parent.element.id,"_select_all")}))}},{key:"updateLeftColGroup",value:function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var i,n=t.querySelector("table"),r=this.parent.getActiveSheet();if(e)n.querySelector("colgroup").firstElementChild.style.width="".concat(this.colGroupWidth,"px");else{i=this.parent.createElement("colgroup");var a=this.col.cloneNode();a.style.width="".concat(this.colGroupWidth,"px"),i.appendChild(a),n.insertBefore(i,n.querySelector("tbody"))}(r.frozenRows||r.frozenColumns)&&(n=this.getSelectAllTable(),e?n.querySelector("colgroup").firstElementChild.style.width="".concat(this.colGroupWidth,"px"):n.insertBefore(i.cloneNode(!0),n.querySelector("thead"))),this.setPanelWidth(r,t),this.setPanelHeight(r)}},{key:"setPanelWidth",value:function(e,t){var i=this.getScrollSize(!0),n=this.getRowHeaderWidth(e),r=this.parent.enableRtl?"right":"left";if(e.frozenColumns){var a=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];a.style.height="calc(100% - ".concat(i,"px)"),a.style[r]=n-Vs(1)+"Px",a.style.display=""}this.setHeaderPanelWidth(this.getSelectAllContent(),n),this.getColHeaderPanel().style.width="calc(100% - ".concat(n,"px)"),this.getColHeaderPanel().style[r]=n+"px",this.setHeaderPanelWidth(t,n),this.getContentPanel().style.width="calc(100% - ".concat(n,"px)"),this.getContentPanel().style[r]=n+"px";var s=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;s&&(i?s.style.height=i+1+"px":(s.style.height="1px",s.style.borderTopWidth="0px"),(s=s.firstElementChild).style[r]=n+"px",s.style.width="calc(100% - ".concat(n,"px)"),f.d.userAgent.indexOf("Mac OS")>-1&&"safari"===f.d.info.name&&(s.style.height="7px",s.style.top="-7px"))}},{key:"getScrollSize",value:function(e){var t=this.parent.enableRtl?"margin-left":"margin-right";return parseInt(this.headerPanel.style[t],10)?parseInt(this.headerPanel.style[t],10)+(e?1:0):0}},{key:"setHeaderPanelWidth",value:function(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(function(e){t+=parseInt(e.style.width,10)}),e.style.width=t+"px"}},{key:"setPanelHeight",value:function(e){var t=this.getScrollSize(!0);if(e.frozenRows){var i=this.getColHeaderHeight(e);this.headerPanel.style.height=e.showHeaders||e.frozenColumns?"":i+"px",this.contentPanel.style.height="calc(100% - ".concat(i+t,"px)");var n=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];n.style.width=f.d.isDevice?"100%":"calc(100% - ".concat(t,"px)"),n.style.top=i-1-(e.showHeaders?1:0)+"px",n.style.display=""}else this.contentPanel.style.height="calc(100% - ".concat((e.showHeaders?Vs(31):0)+t,"px)")}},{key:"renderPanel",value:function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),t=this.parent.element.id;this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:"".concat(t,"_row_header")})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var i=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&i.classList.add("e-frozen-columns"),e.frozenRows&&i.classList.add("e-frozen-rows"),this.updateHideHeaders(e,i),e.showGridLines||i.classList.add("e-hide-gridlines");var n=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:"".concat(t,"_main_content")}));this.parent.allowScrolling||(n.style.overflow="hidden"),e.frozenRows&&i.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&i.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),f.d.userAgent.indexOf("Mac OS")>-1&&"safari"===f.d.info.name&&i.classList.add("e-mac-safari")}},{key:"initHeaderPanel",value:function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:"".concat(e,"_selectall")})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:"".concat(e,"_col_header")}))}},{key:"createHeaderTable",value:function(){var e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)}},{key:"updateTable",value:function(e,t,i){var n=this,r=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});r.classList.add("e-".concat(t,"-table")),i.appendChild(r),e.forEach(function(e){r.appendChild(n.parent.createElement(e))})}},{key:"renderTable",value:function(e){var t,i,n,r=this,a=this.parent.getActiveSheet(),s=document.createDocumentFragment();if(s.appendChild(this.headerPanel),s.appendChild(this.contentPanel),this.parent.allowScrolling){var o=this.parent.createElement("div",{className:"e-scrollbar"});o.appendChild(this.parent.createElement("div",{className:"e-scroller"})),s.appendChild(o)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var l,h=this.parent.createElement("colgroup"),c=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var d=this.getSelectAllContent().querySelector("colgroup"),u=this.getRowHeaderPanel().querySelector("colgroup"),p=this.getSelectAllContent().querySelector("thead .e-header-row"),g=this.contentPanel.querySelector(".e-row-header tbody"),m=this.getSelectAllContent().querySelector("tbody"),v=this.headerPanel.querySelector(".e-column-header thead"),y=this.headerPanel.querySelector(".e-column-header tbody"),b=this.rowRenderer.render();v.appendChild(b),this.getColHeaderTable().insertBefore(h,v);var C=this.parent.frozenRowCount(a),x=this.parent.frozenColCount(a);this.parent.notify("beforeContentLoaded",{top:e.top,left:e.left});var S,w=a.colCount.toString(),k=a.colCount.toString(),I=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",w),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",k),Object(f.y)(this.parent.getContentTable(),{"aria-rowcount":k,"aria-colcount":w}),e.cells.forEach(function(s,o){if((t=Wn(o))[1]!==e.indexes[1]&&i||(n=r.rowRenderer.render(t[0],!0),x&&C&&t[1]<x&&t[0]<C?((S=m.querySelector(".e-empty"))?m.insertBefore(n,S):m.appendChild(n),i=n):x&&t[1]<x?(g.appendChild(n),i=n):(i=r.rowRenderer.render(t[0]),C&&t[0]<C?(S=y.querySelector(".e-empty"))?y.insertBefore(i,S):y.appendChild(i):c.appendChild(i),t[1]===e.indexes[1]&&(C&&t[0]<C?m.appendChild(n):g.appendChild(n))),t[1]===e.indexes[1]&&n.appendChild(r.cellRenderer.renderRowHeader(t[0]))),i.appendChild(r.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:s,address:o,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:!0,row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isRefreshing:e.isRefreshing,first:I?I.includes("Row")?t[0]===e.indexes[0]?"Row":I.includes("Column")&&t[1]===e.indexes[1]?"Column":"":t[1]===e.indexes[1]?"Column":"":""})),x&&t[1]===x-1&&(i=null),t[0]===e.indexes[0])if(x&&t[1]<x){l=r.updateCol(a,t[1],d);var f=u.querySelector(".e-empty");f?u.insertBefore(l.cloneNode(!0),f):u.appendChild(l.cloneNode(!0)),p.appendChild(r.cellRenderer.renderColHeader(t[1]))}else r.updateCol(a,t[1],h),b.appendChild(r.cellRenderer.renderColHeader(t[1]))}),this.parent.isReact&&this.parent.renderReactTemplates(),c.parentElement.insertBefore(h.cloneNode(!0),c),bs(function(){var t=r.parent.getMainContent(),i=document.getElementById(r.parent.element.id+"_sheet");if(i.appendChild(s),i.style.backgroundColor="",e.top&&(t.parentElement.scrollTop=e.top),e.left&&(t.scrollLeft=e.left,r.parent.getColumnHeaderContent().scrollLeft=e.left),r.parent.notify("contentLoaded",e),r.checkTableWidth(a),r.parent.notify(xr,{action:"renderEditor"}),e.initLoad||r.parent.isOpen||r.parent.hideSpinner(),qs(t,{busy:!1}),r.parent.trigger("dataBound",{}),r.parent.isEdit&&r.parent.notify("initiateEdit",null),e.initLoad){var n=!0;if(r.parent.scrollSettings.enableVirtualization)for(var o=0;o<a.ranges.length;o++)if(a.ranges[o].info.count-1>r.parent.viewport.bottomIndex){n=!1;break}n&&(r.parent.isReact?setTimeout(function(){return r.triggerCreatedEvent()}):r.triggerCreatedEvent())}})}},{key:"triggerCreatedEvent",value:function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?this.parent.created.observers=this.parent.createdHandler.observers:this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger("created",null),this.parent.notify("clearUndoRedoCollection",null))}},{key:"checkTableWidth",value:function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var t=vs(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),i=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-i-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - ".concat(i,"px)"),this.getColHeaderPanel().style.width="calc(100% - ".concat(i,"px)"))}}},{key:"refreshColumnContent",value:function(e){var t,i,n,r,a,s=this,o=0,l=this.parent.getActiveSheet(),h=document.createDocumentFragment(),c=document.createDocumentFragment(),d=this.parent.element.querySelector(".e-sheet-content tbody"),u=this.parent.element.querySelector(".e-column-header tbody"),p=this.parent.element.querySelector(".e-sheet-content colgroup");p=p.cloneNode(),h.appendChild(p),d=h.appendChild(d.cloneNode(!0));var g,f=p.cloneNode();c.appendChild(f),g=this.parent.element.querySelector(".e-column-header thead");var m=(g=c.appendChild(g.cloneNode(!0))).querySelector("tr");m.innerHTML="";var v=this.parent.frozenRowCount(l),y=this.parent.frozenColCount(l);v&&(u=c.appendChild(u.cloneNode(!0))),e.cells.forEach(function(n,h){if((t=Wn(h))[0]===e.indexes[0]&&(a=s.updateCol(l,t[1],f),p.appendChild(a.cloneNode()),m.appendChild(s.cellRenderer.renderColHeader(t[1]))),t[1]-y===e.indexes[1]){if(!(i=t[0]<v?u.children[o]:d.children[o]))return;i.innerHTML="",o++}r=i.appendChild(s.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:n,address:h,row:i,pRow:i.previousSibling,first:e.skipUpdateOnFirst||t[1]!==e.indexes[1]?s.parent.scrollSettings.enableVirtualization&&t[0]===e.indexes[0]&&s.parent.viewport.topIndex!==ro(l,0,!0)?"Row":"":"Column",isRefreshing:!0})),s.checkColMerge(t,e.indexes,r,n),v&&t[0]===v-1&&(o=0)}),bs(function(){Cs(n=s.getColHeaderTable()),n.appendChild(c),Cs(n=s.getContentTable()),n.appendChild(h),s.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),s.parent.isEdit&&s.parent.notify("forRefSelRender",{}),s.parent.allowChart&&s.parent.notify("chartRangeSelection",null),s.parent.isOpen||s.parent.hideSpinner(),qs(s.parent.getMainContent(),{busy:!1})})}},{key:"refreshRowContent",value:function(e){var t,i,n,r,a=this,s=this.colGroupWidth,o=this.parent.getActiveSheet(),l=document.createDocumentFragment(),h=this.parent.createElement("tbody"),c=document.createDocumentFragment(),d=h.cloneNode();c.appendChild(d),l.appendChild(h);var u=this.parent.frozenColCount(o);e.cells.forEach(function(l,c){(t=Wn(c))[1]!==e.indexes[1]&&i||(n=a.rowRenderer.render(t[0],!0),u&&t[1]<u?(d.appendChild(n),i=n):(t[1]===e.indexes[1]&&d.appendChild(n),i=a.rowRenderer.render(t[0]),h.appendChild(i)),t[1]===e.indexes[1]&&(n.appendChild(a.cellRenderer.renderRowHeader(t[0])),s=xs(t[0]+1))),u&&(n=d.lastElementChild||n),r=i.appendChild(a.cellRenderer.render({rowIdx:t[0],colIdx:t[1],cell:l,address:c,lastCell:t[1]===e.indexes[3],row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||t[0]!==e.indexes[0]?a.parent.scrollSettings.enableVirtualization&&t[1]===e.indexes[1]&&a.parent.viewport.leftIndex!==ro(o,0,!0,"columns")?"Column":"":"Row",isRefreshing:!0})),a.checkRowMerge(t,e.indexes,r,l),u&&t[1]===u-1&&(i=null)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),this.contentPanel.querySelector(".e-row-header tbody")&&(Object(f.J)(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(c)),this.contentPanel.querySelector(".e-sheet-content tbody")&&(Object(f.J)(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(l)),this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.isOpen||this.parent.hideSpinner(),qs(this.parent.getMainContent(),{busy:!1})}},{key:"updateCol",value:function(e,t,i){var n=this.col.cloneNode();if(n.style.width=Object(f.M)(ms(e,t,null,!0)),i){var r=i.querySelector(".e-empty");return r?i.insertBefore(n,r):i.appendChild(n)}return n}},{key:"updateColContent",value:function(e){var t=this;bs(function(){var i,n,r,a,s,o,l=0,h=t.parent.getActiveSheet(),c=t.parent.element.querySelector(".e-column-header .e-header-row"),d=c.firstElementChild,u=t.parent.element.querySelector(".e-sheet-content colgroup"),p=t.parent.element.querySelector(".e-column-header colgroup"),g=u.firstElementChild,m=p.firstElementChild,v=t.parent.element.querySelector(".e-sheet-content tbody"),y=t.parent.element.querySelector(".e-column-header tbody"),b=t.parent.frozenRowCount(h),C=t.parent.frozenColCount(h);e.cells.forEach(function(x,S){if(!o){if(i=Wn(S),"first"===e.direction&&i[1]===e.indexes[1]&&t.checkColMerge([i[0],t.parent.viewport.leftIndex+C],e.indexes,((i[0]<b?y:v).rows[l]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],Da(i[0],t.parent.viewport.leftIndex+C,h)||{}),i[0]===e.indexes[0]&&("last"===e.direction?((s=t.col.cloneNode()).style.width=Object(f.M)(ms(h,i[1],null,!0)),u.insertBefore(s,g),p.insertBefore(s.cloneNode(),m),c.insertBefore(t.cellRenderer.renderColHeader(i[1]),d)):(s=t.updateCol(h,i[1],u),p.appendChild(s.cloneNode()),c.appendChild(t.cellRenderer.renderColHeader(i[1]))),t.parent.scrollSettings.enableVirtualization&&e.direction&&(Object(f.J)(u[e.direction+"ElementChild"]),Object(f.J)(p[e.direction+"ElementChild"]),Object(f.J)(c[e.direction+"ElementChild"]))),i[1]===e.indexes[1]){if(i[0]<b)n=y.children[l];else if(!(n=v.children[l]))return void(o=!0);l++,r=n.firstElementChild}a=t.cellRenderer.render({colIdx:i[1],rowIdx:i[0],cell:x,address:S,lastCell:i[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||i[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&i[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction}),"last"===e.direction?(t.checkColMerge(i,e.indexes,a,x,((i[0]<b?y:v).rows[l-1]||{cells:[]}).cells[0]),n.insertBefore(a,r)):n.appendChild(a),t.parent.scrollSettings.enableVirtualization&&e.direction&&Object(f.J)(n[e.direction+"ElementChild"]),b&&i[0]===b-1&&(l=0)}}),t.parent.notify("virtualContentLoaded",{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),t.parent.allowChart&&t.parent.notify("chartRangeSelection",null),t.parent.isEdit&&t.parent.notify("forRefSelRender",{}),t.parent.isOpen||t.parent.hideSpinner(),qs(t.parent.getMainContent(),{busy:!1})})}},{key:"updateRowContent",value:function(e){var t,i,n,r,a=this,s=this.colGroupWidth,o=this.parent.getActiveSheet(),l=0,h=this.parent.getMainContent().querySelector("tbody"),c=this.parent.getRowHeaderContent().querySelector("tbody"),d=document.createDocumentFragment(),u=document.createDocumentFragment();this.parent.showSpinner();var p,g=this.parent.frozenColCount(o),m=this.parent.frozenRowCount(o);e.cells.forEach(function(v,y){r=Wn(y),"first"===e.direction&&r[0]===e.indexes[0]&&(void 0===p&&(p=(r[1]<g?c:h).rows[e.indexes[2]-e.indexes[0]+1]||null),a.checkRowMerge([a.parent.viewport.topIndex+m,r[1]],e.indexes,(p||{cells:[]}).cells[r[1]<g?l+1:l],Da(a.parent.viewport.topIndex+m,r[1],o)||{})),r[1]!==e.indexes[1]&&t||(i=a.rowRenderer.render(r[0],!0),g&&r[1]<g?(d.appendChild(i),t=i):(t=a.rowRenderer.render(r[0]),u.appendChild(t),r[1]===e.indexes[1]&&d.appendChild(i),a.parent.scrollSettings.enableVirtualization&&e.direction&&Object(f.J)(h[e.direction+"ElementChild"])),r[1]===e.indexes[1]&&(i.appendChild(a.cellRenderer.renderRowHeader(r[0])),s=xs(r[0]+1),a.parent.scrollSettings.enableVirtualization&&e.direction&&Object(f.J)(c[e.direction+"ElementChild"]))),g&&(i=d.lastElementChild||i),n=t.appendChild(a.cellRenderer.render({colIdx:r[1],rowIdx:r[2],cell:v,address:y,lastCell:r[1]===e.indexes[3],row:t,pHRow:i.previousSibling,checkNextBorder:"last"===e.direction&&r[2]===e.indexes[2]?"Row":"",pRow:t.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:i,first:"last"!==e.direction||e.skipUpdateOnFirst||r[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction})),"last"===e.direction&&h.rows.length&&a.checkRowMerge(r,e.indexes,n,v,(r[1]<g?c:h).rows[0].cells[r[1]<g?l+1:l]),l++,g&&r[1]===g-1&&(t=null,p=void 0,l=0)}),this.colGroupWidth!==s&&this.updateLeftColGroup(s),"last"===e.direction?(c.insertBefore(d,c.firstElementChild),h.insertBefore(u,h.firstElementChild)):(c.appendChild(d),h.appendChild(u)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify("virtualContentLoaded",{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify("forRefSelRender",null),this.parent.allowChart&&this.parent.notify("chartRangeSelection",{}),this.parent.isOpen||this.parent.hideSpinner(),qs(this.parent.getMainContent(),{busy:!1})}},{key:"checkRowMerge",value:function(e,t,i,n,r){if(this.parent.scrollSettings.enableVirtualization&&i&&(!Object(f.Z)(n.rowSpan)||!Object(f.Z)(n.colSpan))){var a=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e[0]===this.parent.viewport.topIndex+a){if(n.rowSpan<0){var s={td:i,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify("checkMerge",s),s.insideFreezePane)return;this.parent.viewport.topIndex+a>=t[0]&&this.refreshPrevMerge(t[0]+1,e[1])}r&&(r.colSpan>1||r.rowSpan>1)&&this.cellRenderer.refresh(e[0]+(t[2]-t[0])+1,e[1],null,r)}else if(n.rowSpan>1){var o=t[2]+1;e[0]+n.rowSpan-1>o&&e[0]<o&&this.refreshPrevMerge(o,e[1],this.parent.viewport.topIndex+a)}}}},{key:"refreshPrevMerge",value:function(e,t,i){var n=this.parent.getCell(e,t,this.parent.getRow(i||0,null,t));n&&n.rowSpan>1&&this.cellRenderer.refresh(e,t,null,n)}},{key:"checkColMerge",value:function(e,t,i,n,r){if(this.parent.scrollSettings.enableVirtualization&&i&&e[1]===this.parent.viewport.leftIndex+this.parent.frozenColCount(this.parent.getActiveSheet())&&(!Object(f.Z)(n.rowSpan)||!Object(f.Z)(n.colSpan))){if(n.colSpan<0){var a={td:i,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify("checkMerge",a),a.insideFreezePane)return}r&&(r.colSpan>1||r.rowSpan>1)&&this.cellRenderer.refresh(e[0],e[1]+(t[3]-t[1])+1,null,r)}}},{key:"showHideHeaders",value:function(){var e=this,t=this.parent.getActiveSheet();bs(function(){if(t.showHeaders){var i=e.getContentPanel();e.setPanelWidth(t,e.getRowHeaderPanel()),e.setPanelHeight(t),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=i.scrollLeft,e.parent.selectRange(t.selectedRange)}else{if(e.updateHideHeaders(t,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(t),e.parent.frozenColCount(t)||e.parent.frozenRowCount(t))e.setPanelWidth(t,e.getRowHeaderPanel()),e.parent.selectRange(t.selectedRange);else{e.getContentPanel().style.width="";var n=e.parent.enableRtl?"right":"left";e.getContentPanel().style[n]=""}e.getScrollElement().style.left=e.getRowHeaderWidth(t)+"px"}})}},{key:"updateHideHeaders",value:function(e,t){e.showHeaders||t.classList.add("e-hide-headers")}},{key:"rowHeightChange",value:function(e){if(e.threshold){var t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}}},{key:"colWidthChange",value:function(e){if(e.threshold){var t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}}},{key:"getRowHeaderWidth",value:function(e,t){var i=0;if(!t&&e.frozenColumns){var n=Zn(e.topLeftCell)[1];i=vs(e,n,n+e.frozenColumns-1,!0)}return i+=e.showHeaders?Vs(this.colGroupWidth):0}},{key:"getColHeaderHeight",value:function(e,t){var i=Zn(e.topLeftCell)[0];return(e.showHeaders&&!t?Vs(31):0)+ps(e,i,i+e.frozenRows-1,!0)}},{key:"getSelectAllContent",value:function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]}},{key:"getScrollElement",value:function(){return(this.contentPanel.parentElement||this.contentPanel.nextElementSibling).querySelector(".e-scroller")}},{key:"getSelectAllTable",value:function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]}},{key:"getColHeaderTable",value:function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]}},{key:"getRowHeaderTable",value:function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]}},{key:"getContentTable",value:function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]}},{key:"getRowHeaderPanel",value:function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]}},{key:"getColHeaderPanel",value:function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]}},{key:"getContentPanel",value:function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]}},{key:"addEventListener",value:function(){this.parent.on("created",this.triggerCreatedEvent,this),this.parent.on("rowHeightChanged",this.rowHeightChange,this),this.parent.on("colWidthChanged",this.colWidthChange,this),this.parent.on("spreadsheetDestroyed",this.destroy,this)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"removeEventListener",value:function(){this.parent.off("created",this.triggerCreatedEvent),this.parent.off("rowHeightChanged",this.rowHeightChange),this.parent.off("colWidthChanged",this.colWidthChange),this.parent.off("spreadsheetDestroyed",this.destroy)}}]),e}(),Tl=function(){function e(t){a(this,e),this.parent=t,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=t.serviceLocator.getService("cell")}return o(e,[{key:"render",value:function(e,t,i){var n=this.element.cloneNode();if(void 0===e)return n.classList.add("e-header-row"),n;n.classList.add("e-row");var r=this.parent.getActiveSheet();return Object(f.y)(n,{"aria-rowindex":(e+1).toString()}),n.style.height="".concat(ds(r,e,!0),"px"),t&&!i&&(cs(r,e+1)&&!cs(r,e-1)&&n.classList.add("e-hide-start"),0!==e&&cs(r,e-1)&&!cs(r,e+1)&&n.classList.add("e-hide-end")),n}},{key:"refresh",value:function(e,t,i,n){var r,a=this.parent.getActiveSheet();if(n)(r=this.render(e,!0,!0)).appendChild(this.cellRenderer.renderRowHeader(e));else{r=this.render(e);for(var s=this.parent.viewport.leftIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),o=this.parent.viewport.leftIndex;o<=s;o++)r.appendChild(this.cellRenderer.render({colIdx:o,rowIdx:e,cell:Da(e,o,a),address:Yn(e,o),lastCell:o===s,row:r,hRow:i,isHeightCheckNeeded:!0,pRow:t,first:e===this.parent.viewport.topIndex&&ro(a,e,!0)!==ro(a,0,!0)?"Row":""}))}return r}}]),e}(),jl=function(){function e(t){a(this,e),this.parent=t,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=t.createElement("tr",{className:"e-row"}),this.parent.on("updateView",this.updateView,this),this.parent.on("calculateFormula",this.calculateFormula,this)}return o(e,[{key:"renderColHeader",value:function(e){var t=this.th.cloneNode();Object(f.y)(t,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"}),t.innerHTML=Kn(e+1);var i=this.parent.getActiveSheet();return ys(i,e+1)&&t.classList.add("e-hide-start"),0!==e&&ys(i,e-1)&&t.classList.add("e-hide-end"),t}},{key:"renderRowHeader",value:function(e){var t=this.element.cloneNode();return Object(f.w)([t],"e-header-cell"),Object(f.y)(t,{role:"rowheader",tabindex:"-1"}),t.innerHTML=(e+1).toString(),t}},{key:"render",value:function(e){var t,i=this.parent.getActiveSheet(),n=Da(e.rowIdx,e.colIdx,i),r=gs(i,e.colIdx);if(n&&n.validation?t=n.validation:r&&r.validation&&(t=r.validation),e.td=this.element.cloneNode(),e.td.className="e-cell",Object(f.y)(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return e.td;e.isRefresh=!1,this.update(e),e.cell&&e.td&&(t&&t.isHighlighted&&this.parent.notify("addHighlight",{range:Xn([e.rowIdx,e.colIdx]),td:e.td}),this.parent.notify("cFRender",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,isChecked:!1}),e.td&&e.td.children[0]&&"e-cf-databar"===e.td.children[0].className&&(e.cell.style&&e.cell.style.fontSize&&(e.td.children[0].querySelector(".e-databar-value").style.fontSize=e.cell.style.fontSize),e.td.children[0].style.height="100%",e.td.children[0].firstElementChild.nextElementSibling.style.height="100%")),Xs(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)||this.parent.notify("renderFilterCell",{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx});var a={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx};return this.parent.trigger("beforeCellRender",a),this.updateRowHeight({rowIdx:e.rowIdx,cell:a.element,lastCell:e.lastCell,rowHgt:20,row:e.row,hRow:e.hRow,colIdx:e.colIdx,sheet:i}),this.setWrapByValue(i,e),a.element}},{key:"setWrapByValue",value:function(e,t){var i=t.td.classList.contains("e-wraptext"),n=t.td.innerHTML;n.indexOf("\n")>-1&&!i&&n.split("\n").length>1&&(Ma(t.rowIdx,t.colIdx,e,{wrap:!0},!0),this.parent.notify("wrapText",{range:[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],wrap:!0,initial:!0,sheet:e,td:t.td,row:t.row,hRow:t.hRow}))}},{key:"update",value:function(e){var t=this.parent.getActiveSheet(),i=this.processTemplates(e.cell,e.rowIdx,e.colIdx);if(i&&("string"==typeof i?e.td.innerHTML=i:(Cs(e.td),e.td.appendChild(i))),e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(t,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(t,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return;e.cell&&!e.cell.hyperlink&&e.td.querySelector(".e-hyperlink")&&e.td.removeChild(e.td.querySelector(".e-hyperlink"))}e.cell&&e.cell.formula&&(!e.cell.value||e.isRefreshing)&&-1===e.cell.formula.indexOf("UNIQUE")&&this.calculateFormula(e);var n={type:e.cell&&br(e.cell.format),value:e.cell&&e.cell.value,format:e.cell&&e.cell.format?e.cell.format:"General",formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIdx:e.rowIdx.toString(),colIdx:e.colIdx.toString()};e.cell&&this.parent.notify("getFormattedCell",n),Object(f.Z)(e.td)||this.parent.refreshNode(e.td,{type:n.type,result:n.formattedText,curSymbol:Object(f.S)(this.parent.locale,"USD"),isRightAlign:n.isRightAlign,value:n.value||""});var r,a={};if(e.cell){if(e.cell.style&&(a=e.cell.style.properties?Fa(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify("setChart",{chart:e.cell.chart,isInitCell:!0,range:Yn(e.rowIdx,e.colIdx)}),e.cell.hyperlink&&this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.rowSpan>1){var s=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));s>1&&(e.td.rowSpan=s,this.mergeFreezeRow(t,e.rowIdx,e.colIdx,s,e.row))}if(e.cell.colSpan>1){var o=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");o>1&&(e.td.colSpan=o,this.mergeFreezeCol(t,e.rowIdx,e.colIdx,o))}if(e.cell.image)for(var l=0;l<e.cell.image.length;l++)e.cell.image[l]&&this.parent.notify("createImageElement",{options:{src:e.cell.image[l].src,imageId:e.cell.image[l].id,height:e.cell.image[l].height,width:e.cell.image[l].width,top:e.cell.image[l].top,left:e.cell.image[l].left},range:Xn([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),this.parent.allowChart&&e.lastCell&&this.parent.notify("refreshChart",{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),this.applyStyle(e,a),this.parent.allowConditionalFormat&&e.lastCell&&this.parent.notify("checkConditionalFormat",{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td}),"Row"===e.checkNextBorder){var h=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===h||e.cell&&e.cell.style&&e.cell.style.bottomPriority||this.parent.notify(ur,{style:{borderBottom:h},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){var c=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===c||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||this.parent.notify(ur,{style:{borderRight:c},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}e.cell&&e.cell.hyperlink&&!Xs(this.parent,e.rowIdx,e.colIdx,this.parent.activeSheetIndex)&&("string"==typeof e.cell.hyperlink?0!==(r=e.cell.hyperlink).indexOf("http://")&&0!==r.indexOf("https://")&&0!==r.indexOf("ftp://")&&(e.cell.hyperlink=0===r.toLowerCase().indexOf("www.")?"http://"+r:r):0!==(r=e.cell.hyperlink.address).indexOf("http://")&&0!==r.indexOf("https://")&&0!==r.indexOf("ftp://")&&(e.cell.hyperlink.address=0===r.toLowerCase().indexOf("www.")?"http://"+r:r),this.parent.notify("createHyperlinkElement",{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}));if(e.cell&&e.cell.wrap){var d=ds(t,e.rowIdx);this.parent.notify("wrapText",{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:t,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&d>20})}}},{key:"applyStyle",value:function(e,t){(Object.keys(t).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(ur,{style:Object(f.L)({},this.parent.commonCellStyle,t),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate})}},{key:"calculateFormula",value:function(e){var t=Sa(e.cell.formula);this.parent.notify(pr,{action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:t,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing}),e.cell.value=Da(e.rowIdx,e.colIdx,Object(f.Z)(e.sheetIndex)?this.parent.getActiveSheet():Ka(this.parent,e.sheetIndex)).value}},{key:"checkMerged",value:function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){var i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(mr,i);var n=this.parent.frozenRowCount(t),r=this.parent.frozenColCount(t);(t.frozenRows&&t.frozenColumns?i.range[0]<n&&i.range[1]<r?e.rowIdx<n&&e.colIdx<r:i.range[0]<n?e.rowIdx<n:!(i.range[1]<r)||e.colIdx<r:n?i.range[0]>=n||e.rowIdx<n:i.range[1]>=r||e.colIdx<r)&&(e.td.style.display="none")}else e.td.style.display="none";return e.cell.colSpan<0&&(this.parent.notify("checkPrevMerge",e),e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop})),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify("checkPrevMerge",e),e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),!0}return!1}},{key:"mergeFreezeRow",value:function(e,t,i,n,r,a){var s=this.parent.frozenRowCount(e);if(s&&t<s&&t+(n-1)>=s){var o,l,h=0,c=this.parent.frozenColCount(e),d=r||this.parent.getRow(t,null,i),u=[].slice.call(d.parentElement.querySelectorAll(".e-empty"));if(a){var p=t+n-s;if(p<u.length)return;var g=0;if(p===u.length){var m,v,y;for(c&&i<c?(v=Zn(e.topLeftCell)[1],y=c):(v=this.parent.viewport.leftIndex+c,y=this.parent.viewport.rightIndex);v<y;v++)v!==i&&((m=Da(t,v,e,!1,!0)).rowSpan&&t+m.rowSpan-s>g&&(g=t+m.rowSpan-s));if(g===p)return}else g=p;for(var b=t+(n-1),C=g,x=u.length;C<x;C++)h+=ds(e,b),b--,Object(f.J)(u.pop());return this.updateSpanTop(i,c,h,!0),void(u.length||this.updateColZIndex(i,c,!0))}this.updateColZIndex(i,c);for(var S=s,w=t+(n-1);S<=w;S++)h+=-(l=ds(e,S)),s+u.length>S||((o=d.cloneNode()).classList.add("e-empty"),o.style.visibility="hidden",o.style.height=l+"px",d.parentElement.appendChild(o));this.updateSpanTop(i,c,h)}}},{key:"updateSpanTop",value:function(e,t,i,n){var r=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(r.style.top,10))return;i=parseInt(r.style.top,10)+i}if(t&&e<t&&(n||!parseInt(r.style.top,10)||i<parseInt(r.style.top,10))){r.style.top=i+"px";var a=r.nextElementSibling;a&&(a.style.top=i+"px")}}},{key:"mergeFreezeCol",value:function(e,t,i,n,r){var a=this.parent.frozenColCount(e);if(a&&i<a&&i+(n-1)>=a){var s,o,l=this.parent.frozenRowCount(e),h=(t<l?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),c=[].slice.call(h.querySelectorAll(".e-empty"));if(r){var d=i+n-a;if(d<c.length)return;var u=0;if(d===c.length){var p,g,m;for(l&&t<a?(g=l,m=Zn(e.topLeftCell)[0]):(g=this.parent.viewport.bottomIndex,m=this.parent.viewport.topIndex+l);m<g;m++)m!==t&&((p=Da(m,i,e,!1,!0)).colSpan&&i+p.colSpan-a>u&&(u=i+p.colSpan-a));if(u===d)return}else u=d;for(var v=u,y=c.length;v<y;v++)Object(f.J)(c.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(c.length||this.updateRowZIndex(t,l,!0))}this.updateRowZIndex(t,l);for(var b=a,C=i+(n-1);b<=C;b++)a+c.length>b||((s=h.childNodes[0].cloneNode()).classList.add("e-empty"),s.style.visibility="hidden",o=ms(e,b,null,!0),s.style.width=o+"px",h.appendChild(s),b===C&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}}},{key:"updateColZIndex",value:function(e,t,i){e<t?this.updateSelectAllZIndex(i):(this.parent.getColumnHeaderContent().style.zIndex=i?"":"2",this.updatedHeaderZIndex(i))}},{key:"updateSelectAllZIndex",value:function(e){var t=this.parent.element.querySelector(".e-frozen-row"),i=this.parent.element.querySelector(".e-frozen-column");e?(this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),i&&(i.style.zIndex="")):this.parent.getRowHeaderContent().style.zIndex||this.parent.getColumnHeaderContent().style.zIndex?(this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),i&&(i.style.zIndex="4")):this.parent.getSelectAllContent().style.zIndex="2"}},{key:"updatedHeaderZIndex",value:function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var t=this.parent.element.querySelector(".e-frozen-row"),i=this.parent.element.querySelector(".e-frozen-column");i&&(i.style.zIndex="4"),t&&(t.style.zIndex="4")}}},{key:"updateRowZIndex",value:function(e,t,i){e<t?this.updateSelectAllZIndex(i):(this.parent.getRowHeaderContent().style.zIndex=i?"":"2",this.updatedHeaderZIndex(i))}},{key:"processTemplates",value:function(e,t,i){for(var n,r=this.parent.getActiveSheet(),a=r.ranges,s=0,o=a.length;s<o;s++)if(a[s].template&&((n=Wn(a[s].address.length?a[s].address:a[s].startCell))[0]<=t&&n[1]<=i&&n[2]>=t&&n[3]>=i)){if(e)return this.compileCellTemplate(a[s].template,e);if(!Da(t,i,r,!0))return this.compileCellTemplate(a[s].template,Da(t,i,r,null,!0))}return""}},{key:"compileCellTemplate",value:function(e,t){var i;return"string"==typeof e?(i=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,Object(f.F)(i)(t,null,null,"",!0)[0].outerHTML):Object(f.F)(e)(t,this.parent,"ranges","")[0]}},{key:"updateRowHeight",value:function(e){if(e.cell&&e.cell.children.length){var t=e.cell.cloneNode(!0);t.style.width=ms(e.sheet,e.colIdx,!0)+"px",this.tableRow.appendChild(t)}if(e.lastCell&&this.tableRow.childElementCount){var i=e.row||this.parent.getRow(e.rowIdx),n=ds(e.sheet,e.rowIdx),r=this.getRowHeightOnInit();if(r>n){var a=Vs(r);i.style.height="".concat(a,"px"),(e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height="".concat(a,"px"),us(e.sheet,e.rowIdx,r)}this.tableRow.innerHTML=""}}},{key:"getRowHeightOnInit",value:function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t}},{key:"removeStyle",value:function(e,t,i){var n;if(e.style.length){var r=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,i+1])).borderLeft||n.border,a=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,i])).borderTop||n.border;r||a?[].slice.call(e.style).forEach(function(t){r&&a?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!r||t.indexOf("border-right")>-1||a&&"none"!==a)&&(!a||t.indexOf("border-bottom")>-1||r&&"none"!==r)||e.style.removeProperty(t)}):e.removeAttribute("style")}var s=this.parent.getCell(t-1,i);if(s&&s.style.borderBottom){var o=Number(s.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[o,i])).borderBottom||n.border||(s.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(i=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,i])).borderRight||n.border||(l.style.borderRight=""))}},{key:"refreshRange",value:function(e,t,i){var n,r,a=this.parent.getActiveSheet(),s=e.slice();if(Rs(this.parent,s,!0))for(var o=s[0];o<=s[2];o++)if(!cs(a,o))for(var l=s[1];l<=s[3];l++)ys(a,l)||(r=this.parent.getCell(o,l))&&(n={rowIdx:o,colIdx:l,td:r,cell:Da(o,l,a),isRefreshing:t,lastCell:l===s[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""},this.update(n),this.parent.notify("renderFilterCell",{td:r,rowIndex:o,colIndex:l}),i&&this.setWrapByValue(a,n))}},{key:"refresh",value:function(e,t,i,n){var r=this.parent.getActiveSheet();if((n||!cs(r,e)&&!ys(r,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){var a=n||this.parent.getCell(e,t);if(!a)return;this.update({rowIdx:e,colIdx:t,td:a,cell:Da(e,t,r),lastCell:i,isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:""}),this.parent.notify("renderFilterCell",{td:a,rowIndex:e,colIndex:t})}}},{key:"updateView",value:function(e){Object(f.Z)(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex?this.refreshRange(e.indexes,e.refreshing,e.checkWrap):e.refreshing&&this.calculateFormula({cell:Da(e.indexes[0],e.indexes[1],Ka(this.parent,e.sheetIndex),!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})}}]),e}(),Dl=function(){function t(e){a(this,t),this.parent=e,this.addEventListener()}return o(t,[{key:"render",value:function(e){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify("ribbon",null),this.parent.notify("formulaBar",null));var t=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});if(this.parent.enableRtl&&t.classList.add("e-rtl"),this.parent.element.appendChild(t),this.parent.showSheetTabs)this.parent.notify("sheetTabs",null);else{var i=es(this.parent,0);this.parent.notify(pr,{action:"addSheet",sheetName:"Sheet1",index:1,visibleName:i}),this.parent.notify(pr,{action:"initiateDefinedNames"})}this.parent.isMobileView()&&(this.parent.notify("formulaBar",null),this.parent.notify("ribbon",null)),(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),this.setSheetPanelSize(),this.renderSheet(t),this.checkTopLeftCell(!0,e)}},{key:"checkTopLeftCell",value:function(e,t){var i=this.parent.getActiveSheet();this.parent.showSpinner();var n,r="A1"===i.topLeftCell,a=Zn(i.topLeftCell);if(i.topLeftCell!==i.paneTopLeftCell&&(i.frozenRows||i.frozenColumns)){var s=Zn(i.paneTopLeftCell);n=this.parent.scrollSettings.enableVirtualization,r=i.frozenRows&&i.frozenColumns?a[0]+i.frozenRows===s[0]&&a[1]+i.frozenColumns===s[1]:i.frozenRows?a[0]+i.frozenRows===s[0]&&0===a[1]:a[1]+i.frozenColumns===s[1]&&0===a[0],this.parent.viewport.beforeFreezeHeight=a[0]&&s[0]>a[0]?ps(i,0,a[0]-1,!0):0,this.parent.viewport.beforeFreezeWidth=a[1]&&s[1]>a[1]?vs(i,0,a[1]-1,!0):0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;if(!this.parent.scrollSettings.enableVirtualization||r)this.refreshUI({rowIndex:a[0],colIndex:a[1],refresh:"All"},null,e,t),n&&(this.parent.viewport.topIndex=ro(i,0,!0),this.parent.viewport.leftIndex=ro(i,0,!0,"columns"));else{var o=i.paneTopLeftCell===i.topLeftCell?a:Zn(i.paneTopLeftCell),l=this.parent.frozenRowCount(i),h=this.parent.frozenColCount(i),c={preventScroll:!0};c.scrollTop=o[0]>l?ps(i,l||0,o[0]-1):0,c.scrollLeft=o[1]>h?vs(i,h||0,o[1]-1):0,this.parent.notify("onContentScroll",c);var d=this.parent.getThreshold("row"),u=i.frozenRows?a[0]:a[0]>d?ro(i,a[0]-d,!0):0,p=[];i.frozenRows&&p.push(o[0]-d>l?o[0]-d:l),d=this.parent.getThreshold("col");var g=i.frozenColumns?a[1]:a[1]>d?ro(i,a[1]-d,!0,"columns"):0;i.frozenColumns?(p.length||p.push(l),p.push(o[1]-d>h?o[1]-d:h)):p.length&&p.push(h),this.refreshUI({rowIndex:u,colIndex:g,refresh:"All",top:c.scrollTop,left:c.scrollLeft,frozenIndexes:p},null,e,t),n&&(p[0]>=l&&(this.parent.viewport.topIndex=ro(i,p[0]-l,!0)),p[1]>=h&&(this.parent.viewport.leftIndex=ro(i,p[1]-h,!0,"columns")))}}},{key:"renderSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getElementById(this.parent.element.id+"_sheet_panel");e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()}},{key:"refreshUI",value:function(t,i,n,r){var a=this;"All"!==t.refresh&&this.parent.showSpinner();var s=this.parent.serviceLocator.getService("sheet"),o=this.parent.getActiveSheet(),l=es(this.parent),h={rowCount:o.rowCount,colCount:o.colCount};if(t.frozenIndexes=t.frozenIndexes?t.frozenIndexes:[],!i)if(this.parent.scrollSettings.enableVirtualization){var c=t.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),d=t.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),u=this.parent.frozenRowCount(o),p=this.parent.frozenColCount(o);t.frozenIndexes.length&&(c+=t.frozenIndexes[0]-u,d+=t.frozenIndexes[1]-p),c+=o.frozenRows,d+=o.frozenColumns;var g=o.rowCount-1,m=0;this.parent.scrollSettings.isFinite&&c>g&&(m=c-g,c=g,m&&!Object(f.Z)(this.parent.viewport.topIndex)&&(m=this.parent.viewport.topIndex-m>-1?this.parent.viewport.topIndex-m:0,this.parent.viewport.topIndex=t.rowIndex=this.skipHiddenIdx(m,!0))),g=o.colCount-1,m=0,this.parent.scrollSettings.isFinite&&d>g&&(m=d-g,d=g,m&&!Object(f.Z)(this.parent.viewport.leftIndex)&&(m=this.parent.viewport.leftIndex-m>-1?this.parent.viewport.leftIndex-m:0,this.parent.viewport.leftIndex=t.colIndex=this.skipHiddenIdx(m,!0,"columns")));var v=this.parent.skipHidden(t.rowIndex,c);if(t.rowIndex!==v[0]){var y=Zn(o.topLeftCell);y[0]===t.rowIndex&&this.parent.updateTopLeftCell(v[0],y[1],"row"),t.rowIndex=v[0]}var b=t.rowIndex;c=v[1];var C=Zn(o.topLeftCell);v=this.parent.skipHidden(t.colIndex,d,"columns"),t.colIndex!==v[0]&&(C[1]===t.colIndex&&this.parent.updateTopLeftCell(C[0],v[0],"col"),t.colIndex=v[0]);var x=t.colIndex;d=v[1],"Row"===t.refresh&&(b+=u,u&&(c+=C[0])),"Column"===t.refresh&&(x+=p,p&&(d+=C[1])),this.parent.viewport.topIndex=t.rowIndex,this.parent.viewport.bottomIndex=c,this.parent.viewport.leftIndex=t.colIndex,this.parent.viewport.rightIndex=d,i="".concat(Yn(b,x),":").concat(Yn(c,d))}else{if("All"===t.refresh){var S=Zn(o.topLeftCell),w=Zn(o.paneTopLeftCell);if(o.frozenRows){var k=this.parent.frozenRowCount(o);w[0]>k&&(t.top=ps(o,k,w[0]-1))}else t.rowIndex=0,0!==S[0]&&(t.top=ps(o,0,S[0]-1));if(o.frozenColumns){var I=this.parent.frozenRowCount(o);w[1]>I&&(t.left=vs(o,I,w[1]-1))}else t.colIndex=0,0!==S[1]&&(t.left=vs(o,0,S[1]-1))}this.parent.viewport.bottomIndex=o.rowCount-1,this.parent.viewport.rightIndex=o.colCount-1,i="".concat(Yn(t.rowIndex,t.colIndex),":").concat(Yn(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex))}"All"===t.refresh&&this.parent.trigger("beforeDataBound",{}),qs(this.parent.getMainContent(),{busy:!0});var O=this.parent.sheets.length;Na(this.parent,"".concat(l,"!").concat(i),null,null,t.frozenIndexes).then(function(l){if(!(O<a.parent.sheets.length)){var c=a.parent.sheets.indexOf(o);if(-1!==c&&c===a.parent.activeSheetIndex){var d,u=[t.rowIndex,t.colIndex].concat(e(Zn(i.split(":")[1])));switch(t.refresh){case"All":s.renderTable({cells:l,indexes:u,top:t.top,left:t.left,initLoad:n,isRefreshing:r});break;case"Row":s.refreshRowContent({cells:l,indexes:u,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:h}),!1,d={isEdit:!1},a.parent.notify("isFormulaBarEdit",d),d.isEdit&&a.parent.notify(xr,{action:"startEdit",refreshCurPos:!1});break;case"Column":s.refreshColumnContent({cells:l,indexes:u,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:h});break;case"RowPart":s.updateRowContent({cells:l,indexes:u,direction:t.direction,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:h});break;case"ColumnPart":s.updateColContent({cells:l,indexes:u,direction:t.direction,skipUpdateOnFirst:t.skipUpdateOnFirst,prevRowColCnt:h})}a.parent.isReact&&a.parent.renderReactTemplates()}else c>-1&&a.checkTopLeftCell()}}),this.parent.notify("beforeVirtualContentLoaded",{refresh:t.refresh,skipTranslate:t.skipTranslate})}},{key:"skipHiddenIdx",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rows",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.parent.getActiveSheet();return n[i][e]&&n[i][e].hidden&&(e=t?++e:--e,e=this.skipHiddenIdx(e,t,i,n)),e}},{key:"removeSheet",value:function(){Object(f.kb)(document.getElementById(this.parent.element.id+"_sheet"))}},{key:"refreshSheet",value:function(e){this.removeSheet(),this.renderSheet(),this.parent.notify("deInitProperties",{}),this.checkTopLeftCell(!1,e)}},{key:"setSheetPanelSize",value:function(){var e,t=document.getElementById(this.parent.element.id+"_sheet_panel"),i=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(t.style.height="260px",e=230):(e=i.height-Is(t),t.style.height="".concat(e,"px"),e-=32),this.parent.viewport.height=e,this.parent.viewport.width=i.width-32,this.parent.viewport.rowCount=this.roundValue(e,20),this.parent.viewport.colCount=this.roundValue(i.width,64)}},{key:"roundValue",value:function(e,t){var i=e/t,n=Math.round(i);return Math.abs(i-n)<.5?n:n-1}},{key:"moveOrDuplicateSheetHandler",value:function(e){this.parent.notify("refreshSheetTabs",null),e.refresh&&this.refreshSheet(e.isDuplicate)}},{key:"instantiateRenderer",value:function(){this.parent.serviceLocator.register("cell",new jl(this.parent)),this.parent.serviceLocator.register("row",new Tl(this.parent)),this.parent.serviceLocator.register("sheet",new Ll(this.parent))}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}},{key:"addEventListener",value:function(){this.parent.on("initialLoad",this.instantiateRenderer,this),this.parent.on("dataRefresh",this.refreshSheet,this),this.parent.on("spreadsheetDestroyed",this.destroy,this),this.parent.on("moveOrDuplicateSheet",this.moveOrDuplicateSheetHandler,this)}},{key:"removeEventListener",value:function(){this.parent.off("initialLoad",this.instantiateRenderer),this.parent.off("dataRefresh",this.refreshSheet),this.parent.off("spreadsheetDestroyed",this.destroy),this.parent.off("moveOrDuplicateSheet",this.moveOrDuplicateSheetHandler)}}]),t}(),Ml=function(){function e(t){a(this,e),this.parent=t}return o(e,[{key:"show",value:function(e,t){var i,n=this;t=!!Object(f.Z)(t);var r=e.close||null,a={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){n.destroyDialog(),r&&r()},Object(f.L)(a,e),t&&(i=this.parent.serviceLocator.getService(kl).getConstant(a.buttons.length?"Cancel":"Ok"),a.buttons.push({buttonModel:{content:i,isPrimary:0===a.buttons.length},click:this.hide.bind(this)}));var s=this.parent.createElement("div");document.body.appendChild(s),this.dialogInstance=new w.a(a),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(s),this.dialogInstance.refreshPosition()}},{key:"destroyDialog",value:function(){this.dialogInstance.destroy(),Object(f.kb)(this.dialogInstance.element),this.dialogInstance=null}},{key:"hide",value:function(){this.dialogInstance&&this.dialogInstance.hide()}},{key:"destroy",value:function(){this.parent=null}}]),e}(),Fl=function(){function e(t){a(this,e),this.parent=t,this.addEventListener()}return o(e,[{key:"initializeActionBegin",value:function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(i){e.actionEventHandler({evtArgs:i,evtFunc:t,actionType:"begin",eventType:"format"})};var i=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var r=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeSort"})}}},{key:"initializeActionComplete",value:function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(i){e.actionEventHandler({evtArgs:i,evtFunc:t,actionType:"complete",eventType:"sorting"})};var i=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"complete",eventType:"cellSave"})}}},{key:"actionEventHandler",value:function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})}},{key:"actionBeginHandler",value:function(e){this.parent.trigger("actionBegin",{action:e.action,args:e}),"clipboard"!==e.action&&"beforeSort"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"filter"!==e.action&&"cellDelete"!==e.action||this.parent.notify("setActionData",{args:e})}},{key:"actionCompleteHandler",value:function(e){this.parent.notify("triggerDataChange",e),this.parent.trigger("actionComplete",e),"undoRedo"!==e.action&&"gotoSheet"!==e.action&&this.parent.notify("updateUndoRedoCollection",{args:e})}},{key:"addEventListener",value:function(){this.parent.on(Rr,this.actionCompleteHandler,this),this.parent.on(Ar,this.actionBeginHandler,this)}},{key:"removeEventListener",value:function(){this.parent.off(Rr,this.actionCompleteHandler),this.parent.off(Ar,this.actionBeginHandler)}}]),e}(),Pl=function(){function e(t){a(this,e),this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=t}return o(e,[{key:"insertOverlayElement",value:function(e,t,i){var n,r=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),a=Wn(t),s=this.parent.sheets[i],o=this.parent.frozenRowCount(s),l=this.parent.frozenColCount(s),h=As(s,a,o,l,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);if(a[0]>=o&&a[1]<l){var c=this.parent.sheetModule.contentPanel;c.scrollTop&&(h.top-=c.scrollTop,h.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(a[1]>=l&&a[0]<o){var d=this.parent.getScrollElement();d.scrollLeft&&(h.left-=d.scrollLeft,h.left+=this.parent.sheetModule.getRowHeaderWidth(s))}return a[0]<o||a[1]<l?(n=document.getElementById(this.parent.element.id+"_sheet"),o&&(a[0]>=o?h.top+=(s.showHeaders?31:0)+ps(s,Zn(s.topLeftCell)[0],o-1):l||(h.left+=this.parent.sheetModule.getRowHeaderWidth(s,!0))),l&&(a[1]>=l?h.left+=this.parent.sheetModule.getRowHeaderWidth(s):o||(h.left+=s.showHeaders?31:0))):n=this.parent.getMainContent(),r.style.top=h.top+"px",r.style.left=h.left+"px",n.appendChild(r),this.renderResizeHandles(r),this.addEventListener(r),this.originalWidth=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px","")),r}},{key:"adjustFreezePaneSize",value:function(e,t,i){var n=Wn(i),r=this.parent.getActiveSheet(),a=this.parent.frozenRowCount(r),s=this.parent.frozenColCount(r);if(n[0]<a||n[1]<s?(Object(f.Z)(e.top)||(t.style.top=e.top+(r.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),Object(f.Z)(e.left)||(t.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(r,!0)-this.parent.viewport.beforeFreezeWidth+"px")):(Object(f.Z)(e.top)||(t.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(a?ps(r,Zn(r.topLeftCell)[0],a-1):0)+"px"),Object(f.Z)(e.left)||(t.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(s?vs(r,Zn(r.topLeftCell)[1],s-1):0)+"px")),Object(f.Z)(e.top)){var o=Zn(r.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(a&&o===n[0]?0:ps(r,a?o:0,n[0]-1))}if(Object(f.Z)(e.left)){var l=Zn(r.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(s&&l===n[1]?0:vs(r,s?l:0,n[1]-1))}}},{key:"addEventListener",value:function(e){var t=e;f.l.add(t,"mousedown",this.overlayClickHandler,this),f.l.add(t,"mousemove",this.overlayMouseMoveHandler,this),f.l.add(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler,this),f.l.add(document,"mouseup",this.overlayMouseUpHandler,this),this.parent.on("overlayEleSize",this.setOriginalSize,this)}},{key:"setOriginalSize",value:function(e){this.originalHeight=e.height,this.originalWidth=e.width}},{key:"overlayMouseMoveHandler",value:function(e){var t,i,n,r,a,s,o=e.target,l=document.getElementsByClassName("e-ss-overlay-active")[0],h=this.parent.getActiveSheet(),c=h.frozenRows||h.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(h,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":t=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),i=e.clientY-(this.originalMouseY-this.originalResizeTop),t>180&&i>c[0]&&(l.style.height=t+"px",l.style.top=i+"px",this.resizedReorderTop=i,this.currenHeight=t,this.parent.notify("refreshChartSize",{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-r":(n=this.originalWidth+(e.pageX-this.originalMouseX))>180&&(l.style.width=n+"px",this.currentWidth=n,this.parent.notify("refreshChartSize",{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-b":(r=this.originalHeight+(e.pageY-this.originalMouseY))>180&&(l.style.height=r+"px",this.currenHeight=r,this.parent.notify("refreshChartSize",{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-l":a=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),s=e.clientX-(this.originalMouseX-this.originalResizeLeft),a>180&&s>c[1]&&(l.style.width=a+"px",l.style.left=s+"px",this.resizedReorderLeft=s,this.currentWidth=a,this.parent.notify("refreshChartSize",{height:l.style.height,width:l.style.width,overlayEle:l}))}else if(this.isOverlayClicked)if(Object(f.D)(o,".e-sheet")&&!o.classList.contains("e-sheet-content")||o.classList.contains("e-cell")){if(!l)return;var d=e.clientX-this.diffX,u=e.clientY-this.diffY;d>c[1]&&(l.style.left=d+"px"),u>c[0]&&(l.style.top=u+"px"),this.resizedReorderLeft=d<0?0:d,this.resizedReorderTop=u<0?0:u}else this.overlayMouseUpHandler(e,!0)}},{key:"overlayMouseUpHandler",value:function(e,t){if(!this.parent.getActiveSheet().isProtected){this.isResizerClicked=!1;var i=e.target,n=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");i.classList.contains("e-ss-overlay")||(i=Object(f.D)(e.target,".e-datavisualization-chart")?Object(f.D)(e.target,".e-datavisualization-chart"):i);var r=this.parent.getActiveSheet(),a={prevTop:r.frozenRows||r.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:r.frozenRows||r.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?this.resizedReorderLeft:this.originalReorderLeft,id:i.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||t){var s,o,l={clientY:a.prevTop,isImage:!0},h={clientX:a.prevLeft,isImage:!0},c=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(r.frozenRows||r.frozenColumns){if(!c)return;l.isImage=!1,h.isImage=!1,l.target=c,h.target=c,a.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(l.target=this.parent.getColumnHeaderContent()),a.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(h.target=this.parent.getRowHeaderTable());var d=c.getBoundingClientRect();s={clientY:d.top},o={clientX:d.left},d.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(s.target=this.parent.getColumnHeaderContent()),d.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(o.target=this.parent.getRowHeaderTable())}else s={clientY:a.currentTop,isImage:!0},o={clientX:a.currentLeft,isImage:!0};if(this.parent.notify("getRowIdxFromClientY",l),this.parent.notify("getRowIdxFromClientY",s),this.parent.notify("getColIdxFromClientX",h),this.parent.notify("getColIdxFromClientX",o),s.size&&(a.currentTop=s.size),o.size&&(a.currentLeft=o.size),a.prevRowIdx=l.clientY,a.prevColIdx=h.clientX,a.currentRowIdx=s.clientY,a.currentColIdx=o.clientX,(r.frozenColumns||r.frozenRows)&&!Object(f.D)(c,".e-sheet-content")){var u=this.parent.frozenColCount(r),p=this.parent.frozenRowCount(r);if(a.currentRowIdx>=p&&a.currentColIdx>=u){var g=parseInt(c.style.top,10),m=parseInt(c.style.left,10);g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,m+=this.parent.getScrollElement().scrollLeft,m-=this.parent.sheetModule.getRowHeaderWidth(r),c.style.top=g+"px",c.style.left=m+"px",this.parent.getMainContent().appendChild(c)}}n&&n[0]&&n[0].querySelector(".e-control")&&(a.id=n[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(a.id=c.id,n&&n[0]?(a.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",a)):this.parent.notify("refreshImgCellObj",a),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(a.id=i.id.indexOf("overlay")>0?i.id:i.parentElement?i.parentElement.id:"",n&&n[0]?(a.requestType="chartRefresh",this.parent.notify("refreshChartCellObj",a)):this.parent.notify("refreshImgCellObj",a),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}}},{key:"overlayClickHandler",value:function(e){if(!this.parent.getActiveSheet().isProtected){this.isOverlayClicked=!0;var t=e.target,i=e.target;t.classList.contains("e-ss-overlay")||(i=t.parentElement,Object(f.D)(e.target,".e-datavisualization-chart")&&(i=Object(f.D)(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px",""))));var n=this.parent.getActiveSheet();if((n.frozenColumns||n.frozenRows)&&Object(f.D)(i,".e-sheet-content")){var r=parseInt(i.style.top,10),a=parseInt(i.style.left,10);r-=this.parent.sheetModule.contentPanel.scrollTop,r+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,a-=this.parent.getScrollElement().scrollLeft,a+=this.parent.sheetModule.getRowHeaderWidth(n),i.style.top=r+"px",i.style.left=a+"px",document.getElementById(this.parent.element.id+"_sheet").appendChild(i)}this.originalReorderLeft=parseInt(i.style.left,10),this.originalReorderTop=parseInt(i.style.top,10),this.resizedReorderLeft=parseInt(i.style.left,10),this.resizedReorderTop=parseInt(i.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var s=document.getElementsByClassName("e-ss-overlay-active")[0];s&&Object(f.lb)([s],"e-ss-overlay-active"),document.getElementById(i.id).classList.add("e-ss-overlay-active"),t.classList.contains("e-ss-resizer")&&(this.resizer=t.classList[0],this.originalWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),i.classList.contains("e-datavisualization-chart")&&(this.parent.notify("focusChartBorder",{id:i.id}),s||this.parent.notify("insertDesignChart",{id:i.id}));var o=i.getBoundingClientRect();this.prevX=o.left,this.prevY=o.top}}},{key:"renderResizeHandles",value:function(e){for(var t,i=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],n=0,r=e;i.length>n;)t=this.parent.createElement("div",{attrs:{class:i[n]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),r.appendChild(t),n++}},{key:"removeEventListener",value:function(){var e=document.getElementById(this.parent.element.id+"_overlay");e&&(f.l.remove(e,"mousedown",this.overlayClickHandler),f.l.remove(e,"mousemove",this.overlayMouseMoveHandler)),f.l.remove(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler),f.l.remove(document,"mouseup",this.overlayMouseUpHandler),this.parent.off("overlayEleSize",this.setOriginalSize)}},{key:"destroy",value:function(){this.removeEventListener(),this.parent=null}}]),e}(),Nl=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Bl=(Jo=Ko=function(e){l(i,e);var t=c(i);function i(e,n){var r;return a(this,i),(r=t.call(this,e)).viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0},r.needsID=!0,Ko.Inject(No,Bo,_o,po,uo,mo,vo,co,Cr,zo,Uo,Vo,qo,yo,Ho,ko,ta,Tr,jr,ea,vr,Xr,Wo,Kr,bo,wo,Jr,Zo,So,ia,Io,Oo,na,ra,Ro,aa,Ao,oa,Eo,sa,Lo,la,Go,To,Qr,ha,bl,$r),n&&r.appendTo(n),r}return o(i,[{key:"getCell",value:function(e,t,i){return i||(i=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),i?i.cells[t]:i}},{key:"getRow",value:function(e,t,i){if(!t){var n=this.getActiveSheet(),r=this.frozenRowCount(n),a=this.frozenColCount(n);t=Object(f.Z)(i)||e>r-1&&i>a-1?this.getContentTable():e<r&&i<a?this.sheetModule.getSelectAllTable():e<r?this.getColHeaderTable():this.getRowHeaderTable()}return e=this.getViewportIndex(e),t?t.rows[e]:null}},{key:"hiddenCount",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rows",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.getActiveSheet(),r=0,a=e;a<=t;a++)n[i][a]&&n[i][a].hidden&&r++;return r}},{key:"getViewportIndex",value:function(e,t){var i=this.getActiveSheet();if(t){var n=this.frozenColCount(i);if(n){var r=Zn(i.topLeftCell)[1];if(e<n)return e-r+1;e-=n}}else{var a=this.frozenRowCount(i);if(a){var s=Zn(i.topLeftCell)[0];if(e<a)return e-s+1;e-=a}}return this.scrollSettings.enableVirtualization&&(t?(e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex):(e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex)),e}},{key:"preRender",value:function(){r(p(i.prototype),"preRender",this).call(this),this.serviceLocator=new as,this.initServices()}},{key:"initServices",value:function(){this.serviceLocator.register(kl,new f.q(this.getModuleName(),El,this.locale)),this.serviceLocator.register(Il,new Ml(this)),this.serviceLocator.register("actionEvents",new Fl(this)),this.serviceLocator.register(Ol,new Pl(this))}},{key:"render",value:function(){r(p(i.prototype),"render",this).call(this),this.element.setAttribute("tabindex","0"),qs(this.element,{role:"grid"}),this.renderModule=new Dl(this),this.notify("initialLoad",null),this.renderSpreadsheet(),this.wireEvents(),this.created&&(this.created.observers?this.created.observers.length>0&&(this.createdHandler={observers:this.created.observers},this.created.observers=[]):(this.createdHandler=this.created,this.setProperties({created:void 0},!0)))}},{key:"renderSpreadsheet",value:function(){this.cssClass&&Object(f.w)([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),Object(w.f)({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new go(this)),this.scrollSettings.enableVirtualization&&new fo(this),this.renderModule.render(this.refreshing),new xo(this)}},{key:"showSpinner",value:function(){Object(w.l)(this.element)}},{key:"hideSpinner",value:function(){Object(w.j)(this.element)}},{key:"protectSheet",value:function(e,t){"string"==typeof e&&(e=Wa(this,e)),e&&(this.setSheetPropertyOnMute(this.sheets[e],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[e],"protectSettings",t)),e=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),r(p(i.prototype),"protectSheet",this).call(this,e,t)}},{key:"unprotectSheet",value:function(e){"string"==typeof e&&(e=Wa(this,e)),e?this.sheets[e].isProtected=!1:this.getActiveSheet().isProtected=!1,r(p(i.prototype),"unprotectSheet",this).call(this,e)}},{key:"find",value:function(e){var t=this.getActiveSheet().activeCell;if(r(p(i.prototype),"findHandler",this).call(this,e),!e.isAction)return t!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null}},{key:"replace",value:function(e){r(p(i.prototype),"replaceHandler",this).call(this,e={value:e.value,mode:e.mode?e.mode:"Sheet",isCSen:!!e.isCSen&&e.isCSen,isEMatch:!!e.isEMatch&&e.isEMatch,searchBy:e.searchBy?e.searchBy:"By Row",replaceValue:e.replaceValue,replaceBy:e.replaceBy,sheetIndex:e.sheetIndex?e.sheetIndex:this.activeSheetIndex,findOpt:e.findOpt?e.findOpt:""})}},{key:"findAll",value:function(e,t,i,n,r){var a=[];return this.notify("findAllValues",{value:e,mode:t=t||"Sheet",sheetIndex:r=r||this.activeSheetIndex,isCSen:i=i||!1,isEMatch:n=n||!1,findCollection:a}),a}},{key:"goTo",value:function(e){if(e.includes("!")){var t=e.split("!"),i=Wa(this,t[0]);if(void 0===i)return;if(i!==this.activeSheetIndex){var n=t[1].split(":")[0],r=this.sheets[i];this.setSheetPropertyOnMute(r,"activeCell",n),this.setSheetPropertyOnMute(r,"selectedRange",t[1]);var a=Zn(n);if(r.frozenColumns||r.frozenRows){var s=Zn(r.topLeftCell);if(!(r.frozenRows&&a[0]<s[0]||r.frozenColumns&&a[1]<s[1])){var o=this.frozenRowCount(r),l=this.frozenColCount(r),h=[],c=[],d=Zn(r.paneTopLeftCell);o?(h.push(s[0]),c.push(a[0]>=o?a[0]:d[0])):(h.push(a[0]),c.push(a[0])),l?(h.push(s[1]),c.push(a[1]>=l?a[1]:d[1])):(h.push(a[1]),c.push(a[1])),this.setSheetPropertyOnMute(r,"topLeftCell",Yn(h[0],h[1])),this.setSheetPropertyOnMute(r,"paneTopLeftCell",Yn(c[0],c[1]))}}else a[0]<this.viewport.rowCount&&(a[0]=0),a[1]<this.viewport.colCount&&(a[1]=0),this.updateTopLeftCell(a[0],a[1],null,r);return this.activeSheetIndex=i,void this.dataBind()}}var u=Wn(e),p=this.getActiveSheet(),g=this.frozenRowCount(p),f=this.frozenColCount(p),m=this.insideViewport(u[0],u[1]);if(m){this.selectRange(e);var v=Zn(p.paneTopLeftCell),y=this.viewport.height-this.getScrollElement().parentElement.getBoundingClientRect().height,b=0,C=0;if(g)for(var x=Zn(p.topLeftCell)[0];x<g;x++)if((b+=ds(p,x))>y){C=x;break}if(0===C)for(var S=v[0];S<this.viewport.bottomIndex;S++)if((b+=ds(p,S))>y){C=S;break}v[2]=C;var w=0;if(b=0,y=this.viewport.width-this.sheetModule.getScrollSize(),f)for(var k=Zn(p.topLeftCell)[1];k<f;k++)if((b+=ms(p,k))>y){w=k;break}if(0===w)for(var I=v[1];I<this.viewport.rightIndex;I++)if((b+=ms(p,I))>y){w=I;break}if(v[3]=w,u[0]>=v[0]&&u[0]<v[2]&&u[1]>=v[1]&&u[1]<v[3])return;if(g||f){if(v=[].concat(Zn(p.topLeftCell),[g,v[3]]),u[0]>=v[0]&&u[0]<v[2]&&u[1]>=v[1]&&u[1]<v[3])return;if(v[2]=C,v[3]=f,u[0]>=v[0]&&u[0]<v[2]&&u[1]>=v[1]&&u[1]<v[3])return}}var O,R,A,E,L,T,j=this.getMainContent().parentElement;u[0]===g?A=0:(A=ps(p,g,u[0]-1,!0),this.scrollSettings.enableVirtualization&&(T=A+this.getContentTable().getBoundingClientRect().height)>(L=parseFloat(j.querySelector(".e-virtualtrack").style.height))&&(T+=10,(O=j.querySelector(".e-virtualtrack")).style.height="".concat(T,"px"),bs(function(){O.style.height="".concat(L,"px")}))),j.scrollTop=A,j=this.element.getElementsByClassName("e-scroller")[0],u[1]===f?A=0:(A=vs(p,f,u[1]-1,!0),this.scrollSettings.enableVirtualization&&(T=A+this.getContentTable().getBoundingClientRect().width)>(E=parseFloat(j.querySelector(".e-virtualtrack").style.width))&&(T+=10,(O=j.querySelector(".e-virtualtrack")).style.width="".concat(T,"px"),(R=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width="".concat(T,"px"),(O=this.getMainContent().querySelector(".e-virtualtrack")).style.width="".concat(T,"px"),bs(function(){O.style.width="".concat(E,"px"),R.style.width="".concat(E,"px")}))),j.scrollLeft=A,m||this.selectRange(e)}},{key:"insideViewport",value:function(e,t){var i=this.getActiveSheet();if(i.frozenRows||i.frozenColumns){var n=this.frozenRowCount(i),r=this.frozenColCount(i),a=Zn(i.topLeftCell);return(e>=a[0]&&e<n||e>=this.viewport.topIndex+n&&e<=this.viewport.bottomIndex)&&(t>=a[1]&&t<r||t>=this.viewport.leftIndex+r&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex}},{key:"resize",value:function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet()}},{key:"cut",value:function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify("cut",e?{range:Jn(e),sId:this.sheets[Wa(this,Ga(e))]?this.sheets[Wa(this,Ga(e))].id:this.getActiveSheet().id,promise:t}:{promise:t}),t}},{key:"copy",value:function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify("copy",e?{range:Jn(e),sId:this.sheets[Wa(this,Ga(e))]?this.sheets[Wa(this,Ga(e))].id:this.getActiveSheet().id,promise:t}:{promise:t}),t}},{key:"paste",value:function(e,t){this.notify(Ir,{range:e?Jn(e):e,sIdx:e?Wa(this,Ga(e)):e,type:t,isAction:!1,isInternal:!0})}},{key:"updateAction",value:function(e){Ys(e,this)}},{key:"setHeight",value:function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=Object(f.M)(this.height)}},{key:"setWidth",value:function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=Object(f.M)(this.width)}},{key:"setColWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=this.getThreshold("col"),r=this.viewport.leftIndex+this.viewport.colCount+2*n,a=Object(f.Z)(i)?this.getActiveSheet():this.sheets[i];if(a){var s=t,o="number"==typeof e?e+"px":e;if(t=Object(f.Z)(t)?Zn(a.activeCell)[1]:t,a===this.getActiveSheet())if(t>=this.viewport.leftIndex&&t<=r){var l;this.scrollSettings.enableVirtualization&&(t-=this.viewport.leftIndex),l=a.showHeaders?this.getColumnHeaderContent().getElementsByClassName("e-header-cell")[t]:this.getContentTable().getElementsByClassName("e-row")[0].getElementsByClassName("e-cell")[t];var h=ms(a,t,null,!0),c=Vs(parseInt(o,10))-h;c<0&&h<-c&&(Zn(a.activeCell),c=-h);var d=parseInt(l.getAttribute("aria-colindex"),10)-1;this.getActiveSheet()===a&&(this.notify("colWidthChanged",{threshold:c,colIdx:d}),Ws(t,t,o,!0,this))}else{var u,p=ms(a,t);u=parseInt(o,10)>0?-(p-parseInt(o,10)):-p,this.notify("colWidthChanged",{threshold:u,colIdx:t})}gs(a,s).width=parseInt(o,10)>0?parseInt(o,10):0,a.columns[s].customWidth=!0}}},{key:"setRowHeight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=Object(f.Z)(i)?this.getActiveSheet():this.sheets[i-1];if(r){var a=t,s="number"==typeof e?e+"px":e;if(t=Object(f.Z)(t)?Zn(r.activeCell)[0]:t,r===this.getActiveSheet())if(t<=this.viewport.bottomIndex&&t>=this.viewport.topIndex){var o;this.scrollSettings.enableVirtualization&&(t-=this.viewport.topIndex),o=r.showHeaders?this.getRowHeaderContent().getElementsByClassName("e-header-cell")[t].parentElement:this.getContentTable().getElementsByClassName("e-row")[t];var l=ds(r,t,!0),h=Vs(parseInt(s,10))-l;h<0&&l<-h&&(h=-l);var c=parseInt(o.getAttribute("aria-rowindex"),10)-1;this.getActiveSheet()===r&&(this.notify("rowHeightChanged",{threshold:h,rowIdx:c}),Object(f.Z)(n)&&(n=!1),n||(Ws(t,t,s,!1,this),n=!1))}else{var d,u=ds(r,t);d=parseInt(s,10)>0?-(u-parseInt(s,10)):-u,this.notify("rowHeightChanged",{threshold:d,rowIdx:t})}us(r,a,parseInt(s,10)>0?parseInt(s,10):0),r.rows[a].customHeight=!0}}},{key:"autoFit",value:function(e){var t=this.getIndexes(e),i=t.startIdx,n=t.endIdx,r=t.isCol,a=r?Gn("XFD"):1048576;if(i<=a)for(n>a&&(n=a);i<=n;i++)this.notify("setAutoFit",{idx:i,isCol:r})}},{key:"getIndexes",value:function(e){var t,i,n,r;if(-1!==e.indexOf(":")){var a=e.split(":");n=a[0],r=a[1]}else n=e,r=e;if(!Object(f.Z)(n)){var s=this.getAddress(n);n=s.address,t=s.isCol}if(!Object(f.Z)(r)){var o=this.getAddress(r);r=o.address,i=o.isCol}var l=!0===t&&!0===i;return{startIdx:l?Gn(n.toUpperCase()):parseInt(n,10),endIdx:l?Gn(r.toUpperCase()):parseInt(r,10),isCol:l}}},{key:"getAddress",value:function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,{address:e=e.replace(/[0-9]/g,""),isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:{address:e=(parseInt(e,10)-1).toString(),isCol:t}}},{key:"addHyperlink",value:function(e,t){this.insertHyperlink(e,t,"",!0)}},{key:"removeHyperlink",value:function(e){var t,i,n=this.getActiveSheet();if(e&&-1!==e.indexOf("!")){t=e.split("!");for(var r=this.sheets,a=0;a<r.length;a++)r[a].name===t[0]&&(i=a);n=this.sheets[i],e=t[1]}for(var s=Wn(e||this.getActiveSheet().activeCell),o=s[0];o<=s[2];o++)for(var l=s[1];l<=s[3];l++)if(n&&n.rows[o]&&n.rows[o].cells[l]){for(var h=this.getCell(o,l),c=[],d=0;d<h.classList.length;d++)c.push(h.classList[d]);this.notify("deleteHyperlink",{sheet:n,rowIdx:o,colIdx:l});for(var u=0;u<c.length;u++)this.getCell(o,l).classList.contains(c[u])||this.getCell(o,l).classList.add(c[u])}}},{key:"insertHyperlink",value:function(e,t,n,a){if(this.allowHyperlink){var s,o,l,h=this.getActiveSheet();l=Wn(t=t||this.getActiveSheet().activeCell);for(var c=this.getCell(l[0],l[1]),d=[],u=0;u<c.classList.length;u++)d.push(c.classList[u]);var g={hyperlink:e,cell:t,cancel:!1},m={hyperlink:e,cell:t};if(a||this.trigger("beforeHyperlinkCreate",g),!g.cancel){if(r(p(i.prototype),"addHyperlink",this).call(this,e=g.hyperlink,t=g.cell),t&&-1!==t.indexOf("!")){s=t.split("!");for(var v=this.sheets,y=0;y<v.length;y++)v[y].name===s[0]&&(o=y);h=this.sheets[o],t=s[1]}if(!h)return;l=Wn(t=t||this.getActiveSheet().activeCell);var b=h.rows[l[0]].cells[l[1]];if(Object(f.Z)(b.value)||""===b.value?Object(f.Z)(n)||""===n||(b.value=n):b.value!==n&&(b.value=n),a||this.trigger("afterHyperlinkCreate",m),h===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(l);for(var C=0;C<d.length;C++)this.getCell(l[0],l[1]).classList.contains(d[C])||this.getCell(l[0],l[1]).classList.add(d[C]);this.notify("refreshRibbonIcons",null)}}}}},{key:"addDataValidation",value:function(e,t){r(p(i.prototype),"addDataValidation",this).call(this,e,t)}},{key:"removeDataValidation",value:function(e){r(p(i.prototype),"removeDataValidation",this).call(this,e)}},{key:"addInvalidHighlight",value:function(e){r(p(i.prototype),"addInvalidHighlight",this).call(this,e)}},{key:"removeInvalidHighlight",value:function(e){r(p(i.prototype),"removeInvalidHighlight",this).call(this,e)}},{key:"conditionalFormat",value:function(e){r(p(i.prototype),"conditionalFormat",this).call(this,e)}},{key:"clearConditionalFormat",value:function(e){e=e||this.getActiveSheet().selectedRange,r(p(i.prototype),"clearConditionalFormat",this).call(this,e)}},{key:"setPanelSize",value:function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-Is(e)+"px"}}},{key:"open",value:function(e){this.isOpen=!0,r(p(i.prototype),"open",this).call(this,e),this.isOpen&&this.showSpinner()}},{key:"hideRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.getActiveSheet();!this.renderModule||a.frozenRows||a.frozenColumns?r(p(i.prototype),"hideRow",this).call(this,e,t,n):this.notify("hideShow",{startIndex:e,endIndex:t,hide:n})}},{key:"hideColumn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.getActiveSheet();!this.renderModule||a.frozenRows||a.frozenColumns?r(p(i.prototype),"hideColumn",this).call(this,e,t,n):this.notify("hideShow",{startIndex:e,endIndex:t,hide:n,isCol:!0})}},{key:"clear",value:function(e){this.notify("clearViewer",{options:e,isPublic:!0})}},{key:"refresh",value:function(e){this.isReact&&this.clearTemplate(),e?this.notify("blankWorkbook",{}):r(p(i.prototype),"refresh",this).call(this)}},{key:"insertImage",value:function(e,t){var i;for(i=0;i<e.length;i++)this.notify("createImageElement",{options:e[i],range:t||this.getActiveSheet().selectedRange,isPublic:!0})}},{key:"deleteImage",value:function(e,t){this.notify("deleteImage",{id:e,range:t||this.getActiveSheet().selectedRange})}},{key:"getRowHeaderContent",value:function(){return this.sheetModule.getRowHeaderPanel()}},{key:"getColumnHeaderContent",value:function(){return this.sheetModule.getColHeaderPanel()}},{key:"getMainContent",value:function(){return this.sheetModule.getContentPanel()}},{key:"getSelectAllContent",value:function(){return this.sheetModule.getSelectAllContent()}},{key:"getScrollElement",value:function(){return this.sheetModule.getScrollElement()}},{key:"getContentTable",value:function(){return this.sheetModule.getContentTable()}},{key:"getRowHeaderTable",value:function(){return this.sheetModule.getRowHeaderTable()}},{key:"getColHeaderTable",value:function(){return this.sheetModule.getColHeaderTable()}},{key:"getThreshold",value:function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t}},{key:"isMobileView",value:function(){return(this.cssClass.indexOf("e-mobile-view")>-1||f.d.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1}},{key:"getValueRowCol",value:function(e,t,n,a,s){return r(p(i.prototype),"getValueRowCol",this).call(this,e,t,n,a,s)}},{key:"updateCell",value:function(e,t){t=t||this.getActiveSheet().activeCell,r(p(i.prototype),"updateCell",this).call(this,e,t),this.notify("activeCellChanged",null)}},{key:"getRowData",value:function(e,t){return r(p(i.prototype),"getRowData",this).call(this,e,t)}},{key:"sort",value:function(e,t){var n=this;return this.allowSorting?r(p(i.prototype),"sort",this).call(this,e,t).then(function(e){return n.notify("sortComplete",e),Promise.resolve(e)}):Promise.reject()}},{key:"setValueRowCol",value:function(e,t,n,a){if("circular reference: "===t){var s={action:"isCircularReference",argValue:t};this.notify("formulaOperation",s),t=s.argValue}r(p(i.prototype),"setValueRowCol",this).call(this,e,t,n,a),this.notify(xr,{action:"refreshDependentCellValue",rowIdx:n,colIdx:a,sheetIdx:Za(this,e)})}},{key:"getModuleName",value:function(){return"spreadsheet"}},{key:"refreshNode",value:function(e,t){var i;if(e){var n=Object(f.ob)("#"+this.element.id+"_currency",e),r="e-right-align";if(t){if(t.result=Object(f.Z)(t.result)?"":t.result.toString(),n&&Object(f.J)(n),"Accounting"===t.type&&hr(t.value))return e.querySelector("a")?e.querySelector("a").textContent=t.result.split(t.curSymbol).join(""):e.innerHTML="",e.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:"".concat(t.curSymbol),styles:"float: left"})),e.querySelector("a")||(e.innerHTML+=t.result.split(t.curSymbol).join("")),void e.classList.add(r);!t.result||"true"!==t.result.toLowerCase()&&"false"!==t.result.toLowerCase()||(t.result=t.result.toUpperCase(),r="e-center-align",t.isRightAlign=!0),i=t.result,t.isRightAlign?e.classList.add(r):e.classList.remove(r)}if(i=Object(f.Z)(i)?"":i,!Object(f.Z)(e)){var a=e.lastChild,s=e.querySelector(".e-wrap-content");e.querySelector(".e-databar-value")&&(a=e.querySelector(".e-databar-value").lastChild),e.querySelector(".e-hyperlink")&&(a=e.querySelector(".e-hyperlink").lastChild),s&&(s.lastChild||s.appendChild(document.createTextNode("")),a=s.lastChild),!a||3!==a.nodeType&&1!==a.nodeType?e.appendChild(document.createTextNode(i)):a.nodeValue=i}}}},{key:"calculateHeight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e&&e.fontSize||this.cellStyle.fontSize,r="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*r*t+i*r}},{key:"skipHidden",value:function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rows",r=this.getActiveSheet();this.scrollSettings.isFinite&&(i=("rows"===n?r.rowCount:r.colCount)-1);for(var a=e;a<=t;a++)if(r[n][a]&&r[n][a].hidden){if(r.frozenColumns||r.frozenRows){"rows"===n?hs(r,a,{hidden:!1}):fs(r,a,{hidden:!1});continue}if(e===a&&e++,t++,i&&t>i){t=i;break}}return[e,t]}},{key:"updateActiveBorder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".e-ribbon",i=Object(f.ob)("".concat(t," .e-tab-header .e-indicator"),this.element);i.style.display="none",Object(f.rb)(i,{left:"",right:""}),Object(f.rb)(i,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),i.style.display=""}},{key:"undo",value:function(){this.notify("performUndoRedo",{isUndo:!0,isPublic:!0})}},{key:"redo",value:function(){this.notify("performUndoRedo",{isUndo:!1,isPublic:!0})}},{key:"updateUndoRedoCollection",value:function(e){this.notify("updateUndoRedoCollection",{args:e,isPublic:!0})}},{key:"addDefinedName",value:function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify("formulaOperation",t),t.isAdded}},{key:"removeDefinedName",value:function(e,t){return r(p(i.prototype),"removeDefinedName",this).call(this,e,t)}},{key:"mouseClickHandler",value:function(e){this.notify("click",e)}},{key:"mouseDownHandler",value:function(e){this.notify("mouseDown",e)}},{key:"keyUpHandler",value:function(e){Object(f.D)(e.target,".e-find-dlg")?this.notify("findKeyUp",e):this.notify(Sr,e)}},{key:"keyDownHandler",value:function(e){Object(f.D)(e.target,".e-findtool-dlg")||this.notify(wr,e)}},{key:"freeze",value:function(e){var t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(Ar,{eventArgs:t,action:"freezePanes"}),!t.cancel){if(this.on("contentLoaded",this.freezePaneUpdated,this),e.row||e.column){var i=!1;if(this.notify("getFilteredCollection",null),this.filterCollection)for(var n=0,r=this.filterCollection.length;n<r;n++)if(this.filterCollection[n].sheetIndex===this.activeSheetIndex){i=!0;break}i&&this.clearFilter()}this.freezePanes(e.row,e.column),this.notify("refreshRibbonIcons",null)}}},{key:"freezePaneUpdated",value:function(){this.off("contentLoaded",this.freezePaneUpdated);var e=this.getActiveSheet();this.notify(Rr,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})}},{key:"wireEvents",value:function(){f.l.add(this.element,"click",this.mouseClickHandler,this),f.l.add(this.element,js(),this.mouseDownHandler,this),f.l.add(this.element,"keyup",this.keyUpHandler,this),f.l.add(this.element,"keydown",this.keyDownHandler,this),f.l.add(this.element,"noderefresh",this.refreshNode,this),this.on("freeze",this.freeze,this)}},{key:"destroy",value:function(){this.isReact&&this.clearTemplate(),this.unwireEvents(),this.notify("spreadsheetDestroyed",null),r(p(i.prototype),"destroy",this).call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width")}},{key:"unwireEvents",value:function(){f.l.remove(this.element,"click",this.mouseClickHandler),f.l.remove(this.element,js(),this.mouseDownHandler),f.l.remove(this.element,"keyup",this.keyUpHandler),f.l.remove(this.element,"keydown",this.keyDownHandler),f.l.remove(this.element,"noderefresh",this.refreshNode),this.off("freeze",this.freeze)}},{key:"addContextMenuItems",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;this.notify("addContextMenuItems",{items:e,text:t,insertAfter:i,isUniqueId:n})}},{key:"removeContextMenuItems",value:function(e,t){this.notify("removeContextMenuItems",{items:e,isUniqueId:t})}},{key:"enableContextMenuItems",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.notify("enableContextMenuItems",{items:e,enable:t,isUniqueId:i})}},{key:"enableFileMenuItems",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.notify("enableFileMenuItems",{items:e,enable:t,isUniqueId:i})}},{key:"hideFileMenuItems",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;this.notify("hideFileMenuItems",{items:e,hide:t,isUniqueId:i})}},{key:"addFileMenuItems",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;this.notify("addFileMenuItems",{items:e,text:t,insertAfter:i,isUniqueId:n})}},{key:"hideRibbonTabs",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.notify("hideRibbonTabs",{tabs:e,hide:t})}},{key:"enableRibbonTabs",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.notify("enableRibbonTabs",{tabs:e,enable:t})}},{key:"addRibbonTabs",value:function(e,t){this.notify("addRibbonTabs",{items:e,insertBefore:t})}},{key:"enableToolbarItems",value:function(e,t,i){this.notify("enableToolbarItems",[{tab:e,items:t,enable:void 0===i||i}])}},{key:"hideToolbarItems",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.notify("hideToolbarItems",{tab:e,indexes:t,hide:i})}},{key:"addToolbarItems",value:function(e,t,i){this.notify("addToolbarItems",{tab:e,items:t,index:i})}},{key:"selectRange",value:function(e){this.notify("selectRange",{address:e})}},{key:"startEdit",value:function(){this.notify(xr,{action:"startEdit",isNewValueEdit:!1})}},{key:"closeEdit",value:function(){this.notify(xr,{action:"cancelEdit"})}},{key:"endEdit",value:function(){this.notify(xr,{action:"endEdit"})}},{key:"onPropertyChanged",value:function(e,t){var n=this;r(p(i.prototype),"onPropertyChanged",this).call(this,e,t);for(var a=0,s=Object.keys(e);a<s.length;a++){var o=void 0,l=void 0;switch(s[a]){case"enableRtl":if((o=this.getColumnHeaderContent())&&(o=o.parentElement),!o)break;e.enableRtl?(o.style.marginLeft=ws()+"px",o.style.marginRight="",document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl")):(o.style.marginRight=ws()+"px",o.style.marginLeft="",document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl")),this.renderModule.refreshSheet();break;case"cssClass":t.cssClass&&Object(f.lb)([this.element],t.cssClass.split(" ")),e.cssClass&&Object(f.w)([this.element],e.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify("activeSheetChanged",{idx:e.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify("ribbon",{uiUpdate:!0});break;case"showFormulaBar":this.notify("formulaBar",{uiUpdate:!0});break;case"showSheetTabs":this.notify("sheetTabs",null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":this.allowEditing&&this.notify(xr,{action:"renderEditor"});break;case"allowInsert":(l=this.element.getElementsByClassName("e-add-sheet-tab")[0])&&(l.disabled=!this.allowInsert,this.allowInsert?l.classList.contains("e-disabled")&&l.classList.remove("e-disabled"):l.classList.contains("e-disabled")||l.classList.add("e-disabled"));break;case"sheets":if(e.sheets===this.sheets){this.renderModule.refreshSheet(),this.notify("refreshSheetTabs",null);break}Object.keys(e.sheets).forEach(function(i,r){var a=e.sheets[i];if(a.ranges&&Object.keys(a.ranges).length){var s,o=Object.keys(a.ranges);o.forEach(function(e,t){a.ranges[e].info||(s=t)}),o.forEach(function(e,t){a.ranges[e].dataSource&&(Object(f.cb)(s)||!Object(f.cb)(s)&&s===t)&&n.notify("dataSourceChanged",{sheetIdx:i,rangeIdx:e,isLastRange:o.length-1===t,changedData:a.ranges[e].dataSource})})}else if(a.paneTopLeftCell&&t.sheets&&t.sheets[i]&&t.sheets[i].paneTopLeftCell){if(n.activeSheetIndex!==Number(i))return;var l=Zn(a.paneTopLeftCell),h=Zn(t.sheets[i].paneTopLeftCell);if(l[0]!=h[0]){var c=n.frozenRowCount(n.getActiveSheet()),d=l[0]>c?ps(n.getActiveSheet(),c,l[0]-1):0;n.notify("updateScroll",{top:d})}if(l[1]!=h[1]){var u=n.frozenColCount(n.getActiveSheet()),p=l[1]>u?vs(n.getActiveSheet(),u,l[1]-1):0;n.notify("updateScroll",{left:p})}}else 0===r&&n.renderModule.refreshSheet(),n.showSheetTabs&&a.name&&n.notify("sheetNameUpdate",{items:n.element.querySelector(".e-sheet-tabs-items").children[i],value:a.name,idx:i})});break;case"locale":this.refresh();break;case"password":this.password.length>0&&this.showSheetTabs&&(this.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(this.isProtected){var h=this.element.getElementsByClassName("e-add-sheet-tab")[0];h&&(h.disabled=this.isProtected,this.isProtected?h.classList.contains("e-disabled")&&h.classList.add("e-disabled"):h.classList.contains("e-disabled")||h.classList.remove("e-disabled"))}}}}},{key:"requiredModules",value:function(){return function(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]}),e.showFormulaBar&&t.push({member:"formulaBar",args:[e]}),e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]}),e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]})),e.allowOpen&&t.push({member:"open",args:[e]}),e.allowSave&&t.push({member:"save",args:[e]}),e.enableContextMenu&&t.push({member:"contextMenu",args:[e]}),"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]}),e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]}),e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]}),e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]}),e.enableClipboard&&t.push({member:"clipboard",args:[e]}),e.allowCellFormatting&&t.push({member:"cellformat",args:[e]}),e.allowSorting&&t.push({member:"sort",args:[e]}),e.allowResizing&&t.push({member:"resize",args:[e]}),t.push({member:"collaborativeEditing",args:[e]}),t.push({member:"protectSheet",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]}),e.allowUndoRedo&&t.push({member:"undoredo",args:[e]}),e.allowFiltering&&t.push({member:"filter",args:[e]}),e.allowWrap&&t.push({member:"wrapText",args:[e]}),e.allowInsert&&t.push({member:"insert",args:[e]}),e.allowDelete&&t.push({member:"delete",args:[e]}),e.allowDataValidation&&t.push({member:"dataValidation",args:[e]}),e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]}),e.allowMerge&&t.push({member:"merge",args:[e]}),e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"spreadsheetImage",args:[e]}),e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}(e=this,t=[]),ca(e,t),t;var e,t}},{key:"appendTo",value:function(e){r(p(i.prototype),"appendTo",this).call(this,e)}},{key:"filter",value:function(e,t){return this.allowFiltering?(t=t||this.getActiveSheet().selectedRange,r(p(i.prototype),"filter",this).call(this,e,t)):Promise.reject()}},{key:"clearFilter",value:function(e){e?this.notify("clearFilter",{field:e}):r(p(i.prototype),"clearFilter",this).call(this)}},{key:"applyFilter",value:function(e,t){this.notify("initiateFilterUI",{predicates:e,range:t})}},{key:"addCustomFunction",value:function(e,t){r(p(i.prototype),"addCustomFunction",this).call(this,e,t),this.notify("refreshFormulaDatasource",null)}}]),i}(os),Nl([Object(f.t)("")],Jo.prototype,"cssClass",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"allowScrolling",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"allowResizing",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"enableClipboard",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"enableContextMenu",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"enableKeyboardNavigation",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"enableKeyboardShortcut",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"allowUndoRedo",void 0),Nl([Object(f.t)(!0)],Jo.prototype,"allowWrap",void 0),Nl([Object(f.g)({},Sl)],Jo.prototype,"selectionSettings",void 0),Nl([Object(f.g)({},xl)],Jo.prototype,"scrollSettings",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeCellRender",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeSelect",void 0),Nl([Object(f.k)()],Jo.prototype,"select",void 0),Nl([Object(f.k)()],Jo.prototype,"contextMenuBeforeOpen",void 0),Nl([Object(f.k)()],Jo.prototype,"fileMenuBeforeOpen",void 0),Nl([Object(f.k)()],Jo.prototype,"contextMenuBeforeClose",void 0),Nl([Object(f.k)()],Jo.prototype,"dialogBeforeOpen",void 0),Nl([Object(f.k)()],Jo.prototype,"fileMenuBeforeClose",void 0),Nl([Object(f.k)()],Jo.prototype,"contextMenuItemSelect",void 0),Nl([Object(f.k)()],Jo.prototype,"fileMenuItemSelect",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeDataBound",void 0),Nl([Object(f.k)()],Jo.prototype,"dataBound",void 0),Nl([Object(f.k)()],Jo.prototype,"dataSourceChanged",void 0),Nl([Object(f.k)()],Jo.prototype,"cellEdit",void 0),Nl([Object(f.k)()],Jo.prototype,"cellEditing",void 0),Nl([Object(f.k)()],Jo.prototype,"cellSave",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeCellSave",void 0),Nl([Object(f.k)()],Jo.prototype,"created",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeSort",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeHyperlinkCreate",void 0),Nl([Object(f.k)()],Jo.prototype,"afterHyperlinkCreate",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeHyperlinkClick",void 0),Nl([Object(f.k)()],Jo.prototype,"afterHyperlinkClick",void 0),Nl([Object(f.k)()],Jo.prototype,"beforeConditionalFormat",void 0),Nl([Object(f.k)()],Jo.prototype,"actionBegin",void 0),Nl([Object(f.k)()],Jo.prototype,"actionComplete",void 0),Nl([Object(f.k)()],Jo.prototype,"openComplete",void 0),Nl([Object(f.k)()],Jo.prototype,"sortComplete",void 0),Jo=Ko=Nl([f.r],Jo)),Hl=s("SVse"),_l=["template"],zl=["height","id","left","src","top","width"],Vl=[],Ul=((ol=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(Vl),n.directivePropList=zl,n}return i}(g.b)).\u0275fac=function(e){return new(e||ol)(h.Pb(h.P))},ol.\u0275dir=h.Kb({type:ol,selectors:[["e-image"]],inputs:{height:"height",id:"id",left:"left",src:"src",top:"top",width:"width"},features:[h.zb]}),ol),ql=((sl=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"image")}return i}(g.a)).\u0275fac=function(e){return new(e||sl)},sl.\u0275dir=h.Kb({type:sl,selectors:[["e-images"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,Ul,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),sl),Wl=["dataLabelSettings","height","id","isSeriesInRows","legendSettings","primaryXAxis","primaryYAxis","range","theme","title","type","width"],Zl=[],Gl=((al=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(Zl),n.directivePropList=Wl,n}return i}(g.b)).\u0275fac=function(e){return new(e||al)(h.Pb(h.P))},al.\u0275dir=h.Kb({type:al,selectors:[["e-chart"]],inputs:{dataLabelSettings:"dataLabelSettings",height:"height",id:"id",isSeriesInRows:"isSeriesInRows",legendSettings:"legendSettings",primaryXAxis:"primaryXAxis",primaryYAxis:"primaryYAxis",range:"range",theme:"theme",title:"title",type:"type",width:"width"},features:[h.zb]}),al),Yl=((rl=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"chart")}return i}(g.a)).\u0275fac=function(e){return new(e||rl)},rl.\u0275dir=h.Kb({type:rl,selectors:[["e-charts"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,Gl,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),rl),Xl=["chart","colSpan","format","formula","hyperlink","image","index","isLocked","rowSpan","style","validation","value","wrap"],Kl=[],Jl=((nl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,n.tags=["image","chart"],Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(Kl),n.directivePropList=Xl,n}return i}(g.b)).\u0275fac=function(e){return new(e||nl)(h.Pb(h.P))},nl.\u0275dir=h.Kb({type:nl,selectors:[["e-cell"]],contentQueries:function(e,t,i){var n;1&e&&(h.Ib(i,ql,1),h.Ib(i,Yl,1)),2&e&&(h.wc(n=h.gc())&&(t.childImage=n.first),h.wc(n=h.gc())&&(t.childChart=n.first))},inputs:{chart:"chart",colSpan:"colSpan",format:"format",formula:"formula",hyperlink:"hyperlink",image:"image",index:"index",isLocked:"isLocked",rowSpan:"rowSpan",style:"style",validation:"validation",value:"value",wrap:"wrap"},features:[h.zb]}),nl),Ql=((il=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"cells")}return i}(g.a)).\u0275fac=function(e){return new(e||il)},il.\u0275dir=h.Kb({type:il,selectors:[["e-cells"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,Jl,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),il),$l=["cells","customHeight","format","height","hidden","index"],eh=[],th=((tl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,n.tags=["cells"],Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(eh),n.directivePropList=$l,n}return i}(g.b)).\u0275fac=function(e){return new(e||tl)(h.Pb(h.P))},tl.\u0275dir=h.Kb({type:tl,selectors:[["e-row"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,Ql,1),2&e&&h.wc(n=h.gc())&&(t.childCells=n.first)},inputs:{cells:"cells",customHeight:"customHeight",format:"format",height:"height",hidden:"hidden",index:"index"},features:[h.zb]}),tl),ih=((el=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"rows")}return i}(g.a)).\u0275fac=function(e){return new(e||el)},el.\u0275dir=h.Kb({type:el,selectors:[["e-rows"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,th,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),el),nh=["customWidth","format","hidden","index","isLocked","validation","width"],rh=[],ah=(($o=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(rh),n.directivePropList=nh,n}return i}(g.b)).\u0275fac=function(e){return new(e||$o)(h.Pb(h.P))},$o.\u0275dir=h.Kb({type:$o,selectors:[["e-column"]],inputs:{customWidth:"customWidth",format:"format",hidden:"hidden",index:"index",isLocked:"isLocked",validation:"validation",width:"width"},features:[h.zb]}),$o),sh=((Qo=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"columns")}return i}(g.a)).\u0275fac=function(e){return new(e||Qo)},Qo.\u0275dir=h.Kb({type:Qo,selectors:[["e-columns"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,ah,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),Qo),oh=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},lh=["address","dataSource","query","showFieldAsHeader","startCell","template"],hh=[],ch=((fl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(hh),n.directivePropList=lh,n}return i}(g.b)).\u0275fac=function(e){return new(e||fl)(h.Pb(h.P))},fl.\u0275dir=h.Kb({type:fl,selectors:[["e-range"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,_l,1),2&e&&h.wc(n=h.gc())&&(t.template=n.first)},inputs:{address:"address",dataSource:"dataSource",query:"query",showFieldAsHeader:"showFieldAsHeader",startCell:"startCell",template:"template"},features:[h.zb]}),function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);a>3&&s&&Object.defineProperty(t,i,s)}([Object(g.f)(),oh("design:type",Object)],fl.prototype,"template",void 0),fl),dh=((gl=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"ranges")}return i}(g.a)).\u0275fac=function(e){return new(e||gl)},gl.\u0275dir=h.Kb({type:gl,selectors:[["e-ranges"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,ch,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),gl),uh=["cFColor","format","range","type","value"],ph=[],gh=((pl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(ph),n.directivePropList=uh,n}return i}(g.b)).\u0275fac=function(e){return new(e||pl)(h.Pb(h.P))},pl.\u0275dir=h.Kb({type:pl,selectors:[["e-conditionalformat"]],inputs:{cFColor:"cFColor",format:"format",range:"range",type:"type",value:"value"},features:[h.zb]}),pl),fh=((ul=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"conditionalformats")}return i}(g.a)).\u0275fac=function(e){return new(e||ul)},ul.\u0275dir=h.Kb({type:ul,selectors:[["e-conditionalformats"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,gh,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),ul),mh=["activeCell","colCount","columns","conditionalFormats","frozenColumns","frozenRows","index","isProtected","name","paneTopLeftCell","protectSettings","ranges","rowCount","rows","selectedRange","showGridLines","showHeaders","state","topLeftCell","usedRange"],vh=[],yh=((dl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,n.tags=["rows","columns","ranges","conditionalFormats"],Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(vh),n.directivePropList=mh,n}return i}(g.b)).\u0275fac=function(e){return new(e||dl)(h.Pb(h.P))},dl.\u0275dir=h.Kb({type:dl,selectors:[["e-sheet"]],contentQueries:function(e,t,i){var n;1&e&&(h.Ib(i,ih,1),h.Ib(i,sh,1),h.Ib(i,dh,1),h.Ib(i,fh,1)),2&e&&(h.wc(n=h.gc())&&(t.childRows=n.first),h.wc(n=h.gc())&&(t.childColumns=n.first),h.wc(n=h.gc())&&(t.childRanges=n.first),h.wc(n=h.gc())&&(t.childConditionalFormats=n.first))},inputs:{activeCell:"activeCell",colCount:"colCount",columns:"columns",conditionalFormats:"conditionalFormats",frozenColumns:"frozenColumns",frozenRows:"frozenRows",index:"index",isProtected:"isProtected",name:"name",paneTopLeftCell:"paneTopLeftCell",protectSettings:"protectSettings",ranges:"ranges",rowCount:"rowCount",rows:"rows",selectedRange:"selectedRange",showGridLines:"showGridLines",showHeaders:"showHeaders",state:"state",topLeftCell:"topLeftCell",usedRange:"usedRange"},features:[h.zb]}),dl),bh=((cl=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"sheets")}return i}(g.a)).\u0275fac=function(e){return new(e||cl)},cl.\u0275dir=h.Kb({type:cl,selectors:[["e-sheets"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,yh,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),cl),Ch=["comment","name","refersTo","scope"],xh=[],Sh=((hl=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(g.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(xh),n.directivePropList=Ch,n}return i}(g.b)).\u0275fac=function(e){return new(e||hl)(h.Pb(h.P))},hl.\u0275dir=h.Kb({type:hl,selectors:[["e-definedname"]],inputs:{comment:"comment",name:"name",refersTo:"refersTo",scope:"scope"},features:[h.zb]}),hl),wh=((ll=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"definednames")}return i}(g.a)).\u0275fac=function(e){return new(e||ll)},ll.\u0275dir=h.Kb({type:ll,selectors:[["e-definednames"]],contentQueries:function(e,t,i){var n;1&e&&h.Ib(i,Sh,0),2&e&&h.wc(n=h.gc())&&(t.children=n)},features:[h.zb]}),ll),kh=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},Ih=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Oh=["actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeCellFormat","beforeCellRender","beforeCellSave","beforeConditionalFormat","beforeDataBound","beforeHyperlinkClick","beforeHyperlinkCreate","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","contextMenuBeforeClose","contextMenuBeforeOpen","contextMenuItemSelect","created","dataBound","dataSourceChanged","dialogBeforeOpen","fileMenuBeforeClose","fileMenuBeforeOpen","fileMenuItemSelect","openComplete","openFailure","queryCellInfo","saveComplete","select","sortComplete"],Rh=[""],Ah=((vl=function(e){l(i,e);var t=c(i);function i(e,n,r,s){var o;a(this,i),(o=t.call(this)).ngEle=e,o.srenderer=n,o.viewContainerRef=r,o.injector=s,o.tags=["sheets","definedNames"],o.element=o.ngEle.nativeElement,o.injectedModules=o.injectedModules||[];try{var l=o.injector.get("SpreadsheetClipboard");-1===o.injectedModules.indexOf(l)&&o.injectedModules.push(l)}catch(A){}try{var h=o.injector.get("SpreadsheetEdit");-1===o.injectedModules.indexOf(h)&&o.injectedModules.push(h)}catch(E){}try{var c=o.injector.get("SpreadsheetKeyboardNavigation");-1===o.injectedModules.indexOf(c)&&o.injectedModules.push(c)}catch(L){}try{var d=o.injector.get("SpreadsheetKeyboardShortcut");-1===o.injectedModules.indexOf(d)&&o.injectedModules.push(d)}catch(T){}try{var p=o.injector.get("SpreadsheetCollaborativeEditing");-1===o.injectedModules.indexOf(p)&&o.injectedModules.push(p)}catch(j){}try{var f=o.injector.get("SpreadsheetSelection");-1===o.injectedModules.indexOf(f)&&o.injectedModules.push(f)}catch(D){}try{var m=o.injector.get("SpreadsheetContextMenu");-1===o.injectedModules.indexOf(m)&&o.injectedModules.push(m)}catch(M){}try{var v=o.injector.get("SpreadsheetFormulaBar");-1===o.injectedModules.indexOf(v)&&o.injectedModules.push(v)}catch(F){}try{var y=o.injector.get("SpreadsheetRibbon");-1===o.injectedModules.indexOf(y)&&o.injectedModules.push(y)}catch(P){}try{var b=o.injector.get("SpreadsheetSave");-1===o.injectedModules.indexOf(b)&&o.injectedModules.push(b)}catch(N){}try{var C=o.injector.get("SpreadsheetOpen");-1===o.injectedModules.indexOf(C)&&o.injectedModules.push(C)}catch(B){}try{var x=o.injector.get("SpreadsheetSheetTabs");-1===o.injectedModules.indexOf(x)&&o.injectedModules.push(x)}catch(H){}try{var S=o.injector.get("SpreadsheetDataBind");-1===o.injectedModules.indexOf(S)&&o.injectedModules.push(S)}catch(_){}try{var w=o.injector.get("SpreadsheetAllModule");-1===o.injectedModules.indexOf(w)&&o.injectedModules.push(w)}catch(z){}try{var k=o.injector.get("SpreadsheetBasicModule");-1===o.injectedModules.indexOf(k)&&o.injectedModules.push(k)}catch(V){}try{var I=o.injector.get("SpreadsheetCellFormat");-1===o.injectedModules.indexOf(I)&&o.injectedModules.push(I)}catch(U){}try{var O=o.injector.get("SpreadsheetNumberFormat");-1===o.injectedModules.indexOf(O)&&o.injectedModules.push(O)}catch(q){}try{var R=o.injector.get("SpreadsheetFormula");-1===o.injectedModules.indexOf(R)&&o.injectedModules.push(R)}catch(W){}return o.registerEvents(Oh),o.addTwoWay.call(u(o),Rh),Object(g.g)("currentInstance",u(o),o.viewContainerRef),o.context=new g.c,o}return o(i,[{key:"ngOnInit",value:function(){this.context.ngOnInit(this)}},{key:"ngAfterViewInit",value:function(){this.context.ngAfterViewInit(this)}},{key:"ngOnDestroy",value:function(){this.context.ngOnDestroy(this)}},{key:"ngAfterContentChecked",value:function(){this.tagObjects[0].instance=this.childSheets,this.childDefinedNames&&(this.tagObjects[1].instance=this.childDefinedNames),this.context.ngAfterContentChecked(this)}}]),i}(Bl)).\u0275fac=function(e){return new(e||vl)(h.Pb(h.l),h.Pb(h.E),h.Pb(h.P),h.Pb(h.s))},vl.\u0275cmp=h.Jb({type:vl,selectors:[["ejs-spreadsheet"]],contentQueries:function(e,t,i){var n;1&e&&(h.Ib(i,_l,1),h.Ib(i,bh,1),h.Ib(i,wh,1)),2&e&&(h.wc(n=h.gc())&&(t.template=n.first),h.wc(n=h.gc())&&(t.childSheets=n.first),h.wc(n=h.gc())&&(t.childDefinedNames=n.first))},inputs:{activeSheetIndex:"activeSheetIndex",allowCellFormatting:"allowCellFormatting",allowChart:"allowChart",allowConditionalFormat:"allowConditionalFormat",allowDataValidation:"allowDataValidation",allowDelete:"allowDelete",allowEditing:"allowEditing",allowFiltering:"allowFiltering",allowFindAndReplace:"allowFindAndReplace",allowHyperlink:"allowHyperlink",allowImage:"allowImage",allowInsert:"allowInsert",allowMerge:"allowMerge",allowNumberFormatting:"allowNumberFormatting",allowOpen:"allowOpen",allowResizing:"allowResizing",allowSave:"allowSave",allowScrolling:"allowScrolling",allowSorting:"allowSorting",allowUndoRedo:"allowUndoRedo",allowWrap:"allowWrap",cellStyle:"cellStyle",cssClass:"cssClass",definedNames:"definedNames",enableClipboard:"enableClipboard",enableContextMenu:"enableContextMenu",enableKeyboardNavigation:"enableKeyboardNavigation",enableKeyboardShortcut:"enableKeyboardShortcut",enablePersistence:"enablePersistence",enableRtl:"enableRtl",height:"height",isProtected:"isProtected",locale:"locale",openUrl:"openUrl",password:"password",saveUrl:"saveUrl",scrollSettings:"scrollSettings",selectionSettings:"selectionSettings",sheets:"sheets",showFormulaBar:"showFormulaBar",showRibbon:"showRibbon",showSheetTabs:"showSheetTabs",width:"width"},outputs:{actionBegin:"actionBegin",actionComplete:"actionComplete",afterHyperlinkClick:"afterHyperlinkClick",afterHyperlinkCreate:"afterHyperlinkCreate",beforeCellFormat:"beforeCellFormat",beforeCellRender:"beforeCellRender",beforeCellSave:"beforeCellSave",beforeConditionalFormat:"beforeConditionalFormat",beforeDataBound:"beforeDataBound",beforeHyperlinkClick:"beforeHyperlinkClick",beforeHyperlinkCreate:"beforeHyperlinkCreate",beforeOpen:"beforeOpen",beforeSave:"beforeSave",beforeSelect:"beforeSelect",beforeSort:"beforeSort",cellEdit:"cellEdit",cellEditing:"cellEditing",cellSave:"cellSave",contextMenuBeforeClose:"contextMenuBeforeClose",contextMenuBeforeOpen:"contextMenuBeforeOpen",contextMenuItemSelect:"contextMenuItemSelect",created:"created",dataBound:"dataBound",dataSourceChanged:"dataSourceChanged",dialogBeforeOpen:"dialogBeforeOpen",fileMenuBeforeClose:"fileMenuBeforeClose",fileMenuBeforeOpen:"fileMenuBeforeOpen",fileMenuItemSelect:"fileMenuItemSelect",openComplete:"openComplete",openFailure:"openFailure",queryCellInfo:"queryCellInfo",saveComplete:"saveComplete",select:"select",sortComplete:"sortComplete"},features:[h.zb],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),kh([Object(g.f)(),Ih("design:type",Object)],vl.prototype,"template",void 0),vl=kh([Object(g.d)([g.c]),Ih("design:paramtypes",[h.l,h.E,h.P,h.s])],vl)),Eh=((ml=function e(){a(this,e)}).\u0275fac=function(e){return new(e||ml)},ml.\u0275mod=h.Nb({type:ml}),ml.\u0275inj=h.Mb({imports:[[Hl.c]]}),ml),Lh={provide:"SpreadsheetClipboard",useValue:co},Th={provide:"SpreadsheetEdit",useValue:uo},jh={provide:"SpreadsheetKeyboardNavigation",useValue:mo},Dh={provide:"SpreadsheetKeyboardShortcut",useValue:vo},Mh={provide:"SpreadsheetCollaborativeEditing",useValue:Co},Fh={provide:"SpreadsheetSelection",useValue:po},Ph={provide:"SpreadsheetContextMenu",useValue:Uo},Nh={provide:"SpreadsheetFormulaBar",useValue:Bo},Bh={provide:"SpreadsheetRibbon",useValue:No},Hh={provide:"SpreadsheetSave",useValue:Vo},_h={provide:"SpreadsheetOpen",useValue:zo},zh={provide:"SpreadsheetSheetTabs",useValue:_o},Vh={provide:"SpreadsheetDataBind",useValue:Cr},Uh={provide:"SpreadsheetAllModule",useValue:function(){function e(){a(this,e),Bl.Inject(No,Bo,_o,po,uo,mo,vo,co,Cr,zo,Vo,qo,yo,Ho,Wo,bo,Co,wo,Zo,So,ko,Io,Oo,Ro,Ao,Eo,Lo,Go,To,bl)}return o(e,[{key:"getModuleName",value:function(){return"all"}},{key:"destroy",value:function(){}}]),e}()},qh={provide:"SpreadsheetBasicModule",useValue:function(){function e(){a(this,e),Bl.Inject(No,Bo,_o,po,uo,mo,vo,co,Cr,zo,Uo,Vo,qo,yo,Ho,Wo,Co,wo,bo,Zo,So,ko,Io,Oo,Ao,Ro,Eo,Lo,To,Go,bl)}return o(e,[{key:"getModuleName",value:function(){return"basic"}},{key:"destroy",value:function(){}}]),e}()},Wh={provide:"SpreadsheetCellFormat",useValue:yo},Zh={provide:"SpreadsheetNumberFormat",useValue:qo},Gh={provide:"SpreadsheetFormula",useValue:Ho},Yh=((yl=function e(){a(this,e)}).\u0275fac=function(e){return new(e||yl)},yl.\u0275mod=h.Nb({type:yl}),yl.\u0275inj=h.Mb({providers:[Lh,Th,jh,Dh,Mh,Fh,Ph,Nh,Bh,Hh,_h,zh,Vh,Uh,qh,Wh,Zh,Gh],imports:[[Hl.c,Eh],Eh]}),yl)},BrIm:function(e,t,i){"use strict";i.d(t,"e",function(){return v}),i.d(t,"b",function(){return S}),i.d(t,"c",function(){return w}),i.d(t,"a",function(){return R}),i.d(t,"d",function(){return A});var n=i("8Y7J"),r=i("k5hD"),s=i("5YkT"),h=i("SVse"),d=["content"],p=["headerTemplate"],g=[[["div"]]],f=["div"],m=["headerText"],v=function(){var e=function e(){a(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[h.c]]}),e}(),y=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=["content","cssClass","disabled","header","headerTemplate","id","visible"],x=[],S=function(){var e=function(e){l(i,e);var t=c(i);function i(e){var n;return a(this,i),(n=t.call(this)).viewContainerRef=e,Object(r.g)("currentInstance",u(n),n.viewContainerRef),n.registerEvents(x),n.directivePropList=C,n}return i}(r.b);return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.P))},e.\u0275dir=n.Kb({type:e,selectors:[["e-tabitem"]],contentQueries:function(e,t,i){var r;(1&e&&(n.Ib(i,d,1),n.Ib(i,m,1),n.Ib(i,p,1)),2&e)&&(n.wc(r=n.gc())&&(t.content=r.first),n.wc(r=n.gc())&&(t.header_text=r.first),n.wc(r=n.gc())&&(t.headerTemplate=r.first))},inputs:{content:"content",cssClass:"cssClass",disabled:"disabled",header:"header",headerTemplate:"headerTemplate",id:"id",visible:"visible"},features:[n.zb]}),y([Object(r.f)(),b("design:type",Object)],e.prototype,"content",void 0),y([Object(r.f)(),b("design:type",Object)],e.prototype,"header_text",void 0),y([Object(r.f)(),b("design:type",Object)],e.prototype,"headerTemplate",void 0),e}(),w=function(){var e=function(e){l(i,e);var t=c(i);function i(){return a(this,i),t.call(this,"items")}return i}(r.a);return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=n.Kb({type:e,selectors:[["e-tabitems"]],contentQueries:function(e,t,i){var r;(1&e&&n.Ib(i,S,0),2&e)&&(n.wc(r=n.gc())&&(t.children=r))},features:[n.zb]}),e}(),k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},I=["added","adding","created","destroyed","dragged","dragging","onDragStart","removed","removing","selected","selecting"],O=[""],R=function(){var e=function(e){l(i,e);var t=c(i);function i(e,n,s,o){var l;return a(this,i),(l=t.call(this)).ngEle=e,l.srenderer=n,l.viewContainerRef=s,l.injector=o,l.tags=["items"],l.element=l.ngEle.nativeElement,l.injectedModules=l.injectedModules||[],l.registerEvents(I),l.addTwoWay.call(u(l),O),Object(r.g)("currentInstance",u(l),l.viewContainerRef),l.containerContext=new r.c,l}return o(i,[{key:"ngOnInit",value:function(){this.containerContext.ngOnInit(this)}},{key:"ngAfterViewInit",value:function(){this.containerContext.ngAfterViewInit(this)}},{key:"ngOnDestroy",value:function(){this.containerContext.ngOnDestroy(this)}},{key:"ngAfterContentChecked",value:function(){this.tagObjects[0].instance=this.childItems,this.containerContext.ngAfterContentChecked(this)}}]),i}(s.g);return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-tab"]],contentQueries:function(e,t,i){var r;(1&e&&n.Ib(i,w,1),2&e)&&(n.wc(r=n.gc())&&(t.childItems=r.first))},inputs:{allowDragAndDrop:"allowDragAndDrop",animation:"animation",cssClass:"cssClass",dragArea:"dragArea",enableHtmlSanitizer:"enableHtmlSanitizer",enablePersistence:"enablePersistence",enableRtl:"enableRtl",headerPlacement:"headerPlacement",height:"height",heightAdjustMode:"heightAdjustMode",items:"items",loadOn:"loadOn",locale:"locale",overflowMode:"overflowMode",scrollStep:"scrollStep",selectedItem:"selectedItem",showCloseButton:"showCloseButton",width:"width"},outputs:{added:"added",adding:"adding",created:"created",destroyed:"destroyed",dragged:"dragged",dragging:"dragging",onDragStart:"onDragStart",removed:"removed",removing:"removing",selected:"selected",selecting:"selecting"},features:[n.zb],ngContentSelectors:f,decls:1,vars:0,template:function(e,t){1&e&&(n.nc(g),n.mc(0))},encapsulation:2,changeDetection:0}),e=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s}([Object(r.d)([r.c]),k("design:paramtypes",[n.l,n.E,n.P,n.s])],e)}(),A=function(){var e=function e(){a(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[h.c]]}),e}()},e7Im:function(e,t,i){"use strict";i.d(t,"b",function(){return y}),i.d(t,"c",function(){return b}),i.d(t,"a",function(){return C});var n=i("8Y7J"),r=i("k5hD"),s=i("Naoh"),h=i("SVse"),d=["content"],p=["*"],g=function(e,t,i,n){var r,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,i,s):r(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=["afterClose","afterOpen","beforeClose","beforeCollision","beforeOpen","beforeRender","created","destroyed"],v=[""],y=function(){var e=function(e){l(i,e);var t=c(i);function i(e,n,s,o){var l;return a(this,i),(l=t.call(this)).ngEle=e,l.srenderer=n,l.viewContainerRef=s,l.injector=o,l.element=l.ngEle.nativeElement,l.injectedModules=l.injectedModules||[],l.registerEvents(m),l.addTwoWay.call(u(l),v),Object(r.g)("currentInstance",u(l),l.viewContainerRef),l.containerContext=new r.c,l}return o(i,[{key:"ngOnInit",value:function(){this.containerContext.ngOnInit(this)}},{key:"ngAfterViewInit",value:function(){this.containerContext.ngAfterViewInit(this)}},{key:"ngOnDestroy",value:function(){this.containerContext.ngOnDestroy(this)}},{key:"ngAfterContentChecked",value:function(){this.containerContext.ngAfterContentChecked(this)}}]),i}(s.c);return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.l),n.Pb(n.E),n.Pb(n.P),n.Pb(n.s))},e.\u0275cmp=n.Jb({type:e,selectors:[["ejs-tooltip"]],contentQueries:function(e,t,i){var r;(1&e&&n.Ib(i,d,1),2&e)&&(n.wc(r=n.gc())&&(t.content=r.first))},inputs:{animation:"animation",closeDelay:"closeDelay",content:"content",cssClass:"cssClass",enableHtmlParse:"enableHtmlParse",enableHtmlSanitizer:"enableHtmlSanitizer",enablePersistence:"enablePersistence",enableRtl:"enableRtl",height:"height",isSticky:"isSticky",locale:"locale",mouseTrail:"mouseTrail",offsetX:"offsetX",offsetY:"offsetY",openDelay:"openDelay",opensOn:"opensOn",position:"position",showTipPointer:"showTipPointer",target:"target",tipPointerPosition:"tipPointerPosition",width:"width",windowCollision:"windowCollision"},outputs:{afterClose:"afterClose",afterOpen:"afterOpen",beforeClose:"beforeClose",beforeCollision:"beforeCollision",beforeOpen:"beforeOpen",beforeRender:"beforeRender",created:"created",destroyed:"destroyed"},features:[n.zb],ngContentSelectors:p,decls:1,vars:0,template:function(e,t){1&e&&(n.nc(),n.mc(0))},encapsulation:2,changeDetection:0}),g([Object(r.f)(),f("design:type",Object)],e.prototype,"content",void 0),e=g([Object(r.d)([r.c]),f("design:paramtypes",[n.l,n.E,n.P,n.s])],e)}(),b=function(){var e=function e(){a(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({imports:[[h.c]]}),e}(),C=function(){var e=function e(){a(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({providers:[],imports:[[h.c,b],b]}),e}()}}])}();